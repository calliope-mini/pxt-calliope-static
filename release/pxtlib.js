var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(o,a,s,c){return new(s||(s=Promise))(function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((c=c.apply(o,a||[])).next())})},__generator=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};pxt||(pxt={}),function(c){!function(e){var a={},s={},t=!1;function n(){return"undefined"!=typeof mscc&&!mscc.hasConsent()}e.addDefaultProperties=function(t){Object.keys(t).forEach(function(e){"string"==typeof t[e]?a[e]=t[e]:s[e]=t[e]})},e.enable=function(){if(c.aiTrackException&&c.aiTrackEvent&&!t){t=!0,c.debug("setting up app insights");var o=c.tickEvent;c.tickEvent=function(e,t,n){if(o&&o(e,t,n),n&&n.interactiveConsent&&"undefined"!=typeof mscc&&!mscc.hasConsent()&&mscc.setConsent(),t){var r=a||{},i=s||{};Object.keys(t).forEach(function(e){"string"==typeof t[e]?r[e]=t[e]:"number"==typeof t[e]?i[e]=t[e]:r[e]=JSON.stringify(t[e]||"")}),c.aiTrackEvent(e,r,i)}else c.aiTrackEvent(e)};var r=c.reportException;c.reportException=function(e,t){r&&r(e,t);var n={target:c.appTarget.id,version:c.appTarget.versions.target};t&&c.Util.jsonMergeFrom(n,t),c.aiTrackException(e,"exception",n)};var e=c.reportError;c.reportError=function(t,n,r){e&&e(t,n,r);try{throw n}catch(e){var i={target:c.appTarget.id,version:c.appTarget.versions.target,category:t,message:n};r&&c.Util.jsonMergeFrom(i,r),c.aiTrackException(e,"error",i)}}}},e.isCookieBannerVisible=n,e.enableCookies=function(){n()&&mscc.setConsent()}}(c.analytics||(c.analytics={}))}(pxt||(pxt={})),pxt||(pxt={}),function(e){!function(e){var n,r,i,o=0,a=!1;function s(){return n||(n=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}return}()),n}function t(){n&&(i.gain.setTargetAtTime(0,n.currentTime,.015),o=0)}e.mute=function(e){n&&(a=e,t(),e&&r&&(r.disconnect(),i.disconnect(),i=r=void 0))},e.stop=t,e.frequency=function(){return o},e.tone=function(e){if(!(a||e<=0)){o=e;var t=s();if(t)try{r||((r=t.createOscillator()).type="triangle",(i=t.createGain()).connect(t.destination),r.connect(i),r.start(0)),r.frequency.value=e,i.gain.setTargetAtTime(1,n.currentTime,.015)}catch(e){return void(r=void 0)}}}}(e.AudioContextManager||(e.AudioContextManager={}))}(pxt||(pxt={})),(pxt||(pxt={})).tickEvent=function(e){},function(e){(e.pxtc||(e.pxtc={})).__dummy=42}(ts||(ts={}));var pxtc=ts.pxtc;!function(e){var t;(function(f){function t(e){return e.replace(/[^\w .!?\-$]/g,function(e){var t=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-t.length)+t})}f.assert=function(e,t){if(void 0===t&&(t="Assertion failed"),!e)throw new Error(t)},f.flatClone=function(t){if(null==t)return null;var n={};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n},f.clone=function(e){return null==e?null:JSON.parse(JSON.stringify(e))},f.htmlEscape=function(e){return e?e.replace(/([^\w .!?\-$])/g,function(e){return"&#"+e.charCodeAt(0)+";"}):e},f.jsStringQuote=t,f.jsStringLiteral=function(e){return'"'+t(e)+'"'};var n="en",r={},e={};function i(){return n}function o(e){var t=/^(\w{2})-(\w{2}$)/i.exec(e);return t&&t[1]&&t[2]?[t[1].toLowerCase()+"-"+t[2].toUpperCase(),t[1].toLowerCase()]:[(e||"en").toLowerCase()]}function a(e,u){return 0==u.length?e:e.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(e,t,n){var r=u[parseInt(t)],i="",o=/^:f(\d*)\.(\d+)/.exec(n);if(o){var a=parseInt(o[2]),s=parseInt(o[1])||0,c=/^0/.test(o[1])?"0":" ",l=r.toFixed(a);if(0<s&&0<a&&(s+=a+1),0<s)for(;l.length<s;)l=c+l;i=l}else i=":x"==n?"0x"+r.toString(16):void 0===r?"(undef)":null===r?"(null)":r.toString?r.toString():r+"";return":a"==n?/^\s*[euioah]/.test(i.toLowerCase())?i="an "+i:/^\s*[bcdfgjklmnpqrstvwxz]/.test(i.toLowerCase())&&(i="a "+i):":s"==n?i=1==r?"":"s":":q"==n?i=f.htmlEscape(i):":jq"==n?i=f.jsStringQuote(i):":uri"==n?i=encodeURIComponent(i).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==n?i=encodeURI(i).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==n&&(i=(100*r).toFixed(1).toString()+"%"),i})}f.localizeLive=!1,f.localeInfo=function(){return(f.localizeLive?"live-":"")+i()},f.userLanguage=i,f.normalizeLanguageCode=o,f.setUserLanguage=function(e){n=o(e)[0]},f.isUserLanguageRtl=function(){return/^ar|dv|fa|ha|he|ks|ku|ps|ur|yi/i.test(n)},f.TRANSLATION_LOCALE="pxt",f.isTranslationMode=function(){return i()==f.TRANSLATION_LOCALE},f._localize=function(e){return r[e]||e},f.getLocalizedStrings=function(){return r},f.setLocalizedStrings=function(e){r=e},f.translationsCache=function(){return e},f.fmt_va=a,f.fmt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return a(e,t)};var s={};f.dumpLocStats=function(){var t={};Object.keys(s).sort(function(e,t){return s[t]-s[e]}).forEach(function(e){return t[e]=e}),console.log("prioritized list of strings:"),console.log(JSON.stringify(t,null,2))};var c=!0;function l(e,t){if(!e)return e;s[e]=(s[e]||0)+1;var n=f._localize(e);return!c&&n!=e&&/\d:s\}/.test(n)&&(n=n.replace(/\{\d+:s\}/g,"")),a(n=n.replace(/^\{(id|loc):[^\}]+\}/g,""),t)}f.lf_va=l,f.lf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return l(e,t)},f.rlf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return l(e,t)},f.lookup=function(e,t){return e.hasOwnProperty(t)?e[t]:null},f.isoTime=function(e){var t=new Date(1e3*e);return f.fmt("{0}-{1:f02.0}-{2:f02.0} {3:f02.0}:{4:f02.0}:{5:f02.0}",t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())},f.userError=function(e){var t=new Error(e);throw t.isUserError=!0,t},f.isPyLangPref=function(){return"py"==localStorage.getItem("editorlangpref")},f.getEditorLanguagePref=function(){return localStorage.getItem("editorlangpref")},f.setEditorLanguagePref=function(e){localStorage.setItem("editorlangpref",e)},f.deq=function e(t,n){if(t===n)return null;if(!t||!n)return"Null value";if("object"==typeof t&&"object"==typeof n){if(Array.isArray(t)){if(!Array.isArray(n))return"Expected array";if(t.length!=n.length)return"Expected array of length "+t.length+", got "+n.length;for(var r=0;r<t.length;r++)if(null!=e(t[r],n[r]))return"Expected array value "+t[r]+" got "+n[r];return null}var i=Object.keys(t),o=Object.keys(t);if(i.length!=o.length)return"Expected "+i.length+" keys, got "+o.length;for(r=0;r<i.length;r++){if(!Object.prototype.hasOwnProperty.call(n,i[r]))return"Missing key "+i[r];if(null!=e(t[i[r]],n[i[r]]))return"Expected value of "+i[r]+" to be "+t[i[r]]+", got "+n[i[r]]}return null}return"Unable to compare "+t+", "+n}})((t=e.pxtc||(e.pxtc={})).Util||(t.Util={}))}(ts||(ts={}));var ts,pxt,pxtmelody,lf=ts.pxtc.Util.lf;!function(e){var t;(t=e.pxtc||(e.pxtc={})).decodeBase64=function(e){return atob(e)},t.encodeBase64=function(e){return btoa(e)}}(ts||(ts={})),function(w){var x;(function(p){var e=function(){function e(){this.pending=!1,this.cancelled=!1}return e.prototype.startOperation=function(){this.pending=!0},e.prototype.isRunning=function(){return this.pending},e.prototype.onProgress=function(e){this.progressHandler=e},e.prototype.reportProgress=function(e,t){this.progressHandler&&this.progressHandler(e,t)},e.prototype.cancel=function(){this.cancelled=!0,this.pending=!1},e.prototype.cancelAsync=function(){var t=this;return this.cancelled||!this.pending?(this.cancelled=!0,this.pending=!1,Promise.resolve()):(this.cancelled=!0,this.deferred=new Promise(function(e){t.resolve=e}),this.deferred)},e.prototype.isCancelled=function(){return this.cancelled},e.prototype.throwIfCancelled=function(){if(this.isCancelled())throw new Error},e.prototype.resolveCancel=function(){this.pending=!1,this.deferred&&(this.resolve(),this.deferred=void 0,this.resolve=void 0)},e}();function r(e,t){for(var n=0;n<t.length;++n)e.push(t[n])}function t(e){for(var t=[],n=0;n<e.length;++n)r(t,e[n]);return t}function i(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function l(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=n.length-r);for(var o=0;o<i;++o)e[t+o]=n[r+o]}function o(e,t){return e==t?0:e<t?-1:1}function n(n,r){var i={};return function(e){var t=n(e);return i.hasOwnProperty(t)?i[t]:i[t]=r(e)}}function a(e){return e&&(e=e.replace(/\\/g,"/")),e}function s(r){return p.httpRequestCoreAsync(r).then(function(e){if(200!=e.statusCode&&304!=e.statusCode&&!r.allowHttpErrors){var t=p.lf("Bad HTTP status code: {0} at {1}; message: {2}",e.statusCode,r.url,(e.text||"").slice(0,500)),n=new Error(t);return n.statusCode=e.statusCode,Promise.reject(n)}return e.text&&/application\/json/.test(e.headers["content-type"])&&(e.json=JSON.parse(e.text)),e})}function c(e,t){var n="";if(!e)return n;for(var r=0;r<e.length;++r){var i=e.charCodeAt(r);if(i<=127)n+=e.charAt(r);else if(i<=2047)n+=String.fromCharCode(192|i>>6,128|63&i);else{if(!t&&55296<=i&&i<=56319){var o=e.charCodeAt(++r);isNaN(o)||(i=65536+(i-55296<<10)+(o-56320))}n+=i<=65535?String.fromCharCode(224|i>>12,128|i>>6&63,128|63&i):String.fromCharCode(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)}}return n}p.CancellationToken=e,p.codalHash16=function(e){var i=[251,175,119,215,81,14,79,191,103,49,181,143,186,157,0,232,31,32,55,60,152,58,17,237,174,70,160,144,220,90,57,223,59,3,18,140,111,166,203,196,134,243,124,95,222,179,197,65,180,48,36,15,107,46,233,130,165,30,123,161,209,23,97,16,40,91,219,61,100,10,210,109,250,127,22,138,29,108,244,67,207,9,178,204,74,98,126,249,167,116,34,77,193,200,121,5,20,113,71,35,128,13,182,94,25,226,227,199,75,27,41,245,230,224,43,225,177,26,155,150,212,142,218,115,241,73,88,105,39,114,62,255,192,201,145,214,168,158,221,148,154,122,12,84,82,163,44,139,228,236,205,242,217,11,187,146,159,64,86,239,195,42,106,198,118,112,184,172,87,2,173,117,176,229,247,253,137,185,99,164,102,147,45,66,231,52,141,211,194,206,246,238,56,110,78,248,63,240,189,93,92,51,53,183,19,171,72,50,33,104,101,69,8,252,83,120,76,135,85,54,202,125,188,213,96,235,136,208,162,129,190,132,156,38,47,1,7,254,24,4,216,131,89,21,28,133,37,153,149,80,170,68,6,169,234,151];function a(e){for(var t=0,n=0;n<e.length;n++){var r=e[n];t=i[t^r]}return t}return e?function(e,t){for(var n=new Uint8Array(e.length),r=0;r<e.length;++r){var i=e.charCodeAt(r);n[r]=255&i}var o=0;for(r=0;r<t;++r)o|=a(n)<<8*r,n[0]=(n[0]+1)%255;return o}(e,2):0},p.bufferSerial=function(e,t,n,r){void 0===t&&(t=""),void 0===n&&(n="?"),void 0===r&&(r=255);for(var i=0;i<t.length;++i){var o=t[i];if(e[n]=(e[n]||"")+o,"\n"===o||e[n].length>r){var a=e[n];e[n]="",window.postMessage({type:"serial",id:n,data:a},"*")}}},p.blobReadAsDataURL=function(r){return r?new Promise(function(e,t){var n=new FileReader;n.onload=function(){return e(n.result)},n.onerror=function(e){return t(e)},n.readAsDataURL(r)}):Promise.resolve(void 0)},p.fileReadAsBufferAsync=function(r){return r?new Promise(function(t,e){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(new Uint8Array(n.result))},n.readAsArrayBuffer(r)}):Promise.resolve(null)},p.fileReadAsTextAsync=function(r){return r?new Promise(function(t,e){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(n.result)},n.readAsText(r)}):Promise.resolve(null)},p.repeatMap=function(e,t){e=e||0;for(var n=[],r=0;r<e;++r)n.push(t(r));return n},p.listsEqual=function(e,t){if(!e||!t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},p.oops=function(e){throw void 0===e&&(e="OOPS"),new Error(e)},p.reversed=function(e){return(e=e.slice(0)).reverse(),e},p.iterMap=function(t,n){Object.keys(t).forEach(function(e){return n(e,t[e])})},p.mapMap=function(t,n){var r={};return Object.keys(t).forEach(function(e){return r[e]=n(e,t[e])}),r},p.mapStringMapAsync=function(e,n){var r={};return Promise.all(Object.keys(e).map(function(t){return n(t,e[t]).then(function(e){return r[t]=e})})).then(function(){return r})},p.values=function(t){return Object.keys(t||{}).map(function(e){return t[e]})},p.pushRange=r,p.concatArrayLike=function(e){return t(e)},p.concat=t,p.memcpy=l,p.uint8ArrayConcat=function(e){for(var t=0,n=0,r=e;n<r.length;n++)t+=(c=r[n]).length;for(var i=new Uint8Array(t),o=0,a=0,s=e;a<s.length;a++){var c;l(i,o,c=s[a]),o+=c.length}return i},p.jsonTryParse=function(e){try{return JSON.parse(e)}catch(e){return}},p.jsonMergeFrom=function t(n,r){r&&Object.keys(r).forEach(function(e){i(n[e])&&i(r[e])?t(n[e],r[e]):n[e]=p.clone(r[e])})},p.jsonCopyFrom=function(e,t){for(var n=p.clone(t),r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];e[o]=n[o]}},p.jsonFlatten=function(e){var o={},a=function(e,t){if(null!==t&&"object"==typeof t){p.assert(!Array.isArray(t)),e&&(e+=".");for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];a(e+i,t[i])}}else o[e]=t};return a("",e),o},p.jsonUnFlatten=function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++)for(var i=r[n],o=t,a=i.split("."),s=0;s<a.length;++s){var c=a[s];s==a.length-1?o[c]=e[i]:("object"!=typeof o[c]&&(o[c]={}),o=o[c])}return t},p.strcmp=o,p.stringMapEq=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(var i=0,o=n;i<o.length;i++){var a=o[i];if(!t.hasOwnProperty(a))return!1;if(e[a]!==t[a])return!1}return!0},p.endsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(-t.length)!=t)},p.startsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(0,t.length)!=t)},p.contains=function(e,t){return!(e.length<t.length)&&(0==t.length||-1<e.indexOf(t))},p.replaceAll=function(e,t,n){return t?e.split(t).join(n):e},p.sortObjectFields=function(t){var e=Object.keys(t);e.sort(o);var n={};return e.forEach(function(e){return n[e]=t[e]}),n},p.chopArray=function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n},p.unique=function(e,n){var r=[],i={};return e.forEach(function(e){var t=n(e);i.hasOwnProperty(t)||(i[t]=null,r.push(e))}),r},p.groupBy=function(e,n){var r={};return e.forEach(function(e){var t=n(e);r.hasOwnProperty(t)||(r[t]=[]),r[t].push(e)}),r},p.toDictionary=function(e,t){var n={};return e.forEach(function(e){n[t(e)]=e}),n},p.toSet=function(e,t){var n={};return e.forEach(function(e){n[t(e)]=!0}),n},p.toArray=function(e){if(Array.isArray(e))return e;var t=[];if(!e)return t;for(var n=0;n<e.length;++n)t.push(e[n]);return t},p.indexOfMatching=function(e,t){for(var n=0;n<e.length;++n)if(t(e[n]))return n;return-1},p.nextTick=function(e){Promise._async._schedule(e)},p.memoizeString=function(e){return n(function(e){return e},e)},p.memoize=n,p.debounce=function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;return clearTimeout(a),a=setTimeout(function(){a=null,o||r.apply(e,t)},i),n&&r.apply(e,t),a}},p.throttle=function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;a||(a=setTimeout(function(){a=null,o||r.apply(e,t)},i)),n&&r.apply(e,t)}},p.randomPermute=function(e){for(var t=0;t<e.length;++t){var n=m()%e.length,r=e[t];e[t]=e[n],e[n]=r}},p.randomPick=function(e){return 0==e.length?null:e[m()%e.length]},p.timeSince=function(e){var t=(Date.now()-(e*=1e3))/1e3;return isNaN(t)?"":t<-30?(t=-t)<60?p.lf("in a few seconds"):t<120?p.lf("in a minute"):t<3600?p.lf("in {0} minute{0:s}",Math.floor(t/60)):t<7200?p.lf("in an hour"):t<86400?p.lf("in {0} hour{0:s}",Math.floor(t/60/60)):t<2592e3?p.lf("in {0} day{0:s}",Math.floor(t/60/60/24)):t<31536e3?p.lf("in {0} month{0:s}",Math.floor(t/60/60/24/30)):p.lf("in {0} year{0:s}",Math.floor(t/60/60/24/365)):t<0?p.lf("now"):t<10?p.lf("a few seconds ago"):t<60?p.lf("{0} second{0:s} ago",Math.floor(t)):t<120?p.lf("a minute ago"):t<3600?p.lf("{0} minute{0:s} ago",Math.floor(t/60)):t<7200?p.lf("an hour ago"):t<86400?p.lf("{0} hour{0:s} ago",Math.floor(t/60/60)):t<2592e3?p.lf("{0} day{0:s} ago",Math.floor(t/60/60/24)):t<31536e3?p.lf("{0} month{0:s} ago",Math.floor(t/60/60/24/30)):p.lf("{0} year{0:s} ago",Math.floor(t/60/60/24/365))},p.unicodeToChar=function(e){return e.replace(/\\u([\d\w]{4})/gi,function(e,t){return String.fromCharCode(parseInt(t,16))})},p.escapeForRegex=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},p.stripUrlProtocol=function(e){return e.replace(/.*?:\/\//g,"")},p.normalizePath=a,p.pathJoin=function(e,t){if(a(e),a(t),e||t)return e?t?("/"!==e.charAt(e.length-1)&&(e+="/"),"/"==t.charAt(0)&&(t=t.substring(1)),e+t):e:t},p.isNodeJS="undefined"==typeof window,p.requestAsync=s,p.httpGetTextAsync=function(e){return s({url:e}).then(function(e){return e.text})},p.httpGetJsonAsync=function(e){return s({url:e}).then(function(e){return e.json})},p.httpPostJsonAsync=function(e,t){return s({url:e,data:t||{}}).then(function(e){return e.json})},p.stringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n},p.uint8ArrayToString=function(e){for(var t=e.length,n="",r=0;r<t;++r)n+=String.fromCharCode(e[r]);return n},p.fromUTF8=function(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e.charCodeAt(n);t+=37==r||127<r?"%"+r.toString(16):e.charAt(n)}return decodeURIComponent(t)},p.toUTF8=c,p.toHex=function(e){for(var t="",n=0;n<e.length;++n)t+=("0"+e[n].toString(16)).slice(-2);return t},p.fromHex=function(e){for(var t=new Uint8Array(e.length>>1),n=0;n<e.length;n+=2)t[n>>1]=parseInt(e.slice(n,n+2),16);return t};var u=function(){function e(){this.promises={}}return e.prototype.enqueue=function(r,i){var o=this;return new Promise(function(e,t){var n=o.promises[r];n||(n=o.promises[r]=[]),n.push(function(){return i().finally(function(){n.shift(),0==n.length?delete o.promises[r]:n[0]()}).then(e,t)}),1==n.length&&n[0]()})},e}();p.PromiseQueue=u;var h,f,d=function(){function e(){this.waiting=[],this.available=[]}return e.prototype.drain=function(){for(var e=0,t=this.waiting;e<t.length;e++)(0,t[e])(new Error("Promise Buffer Reset"));this.waiting=[],this.available=[]},e.prototype.pushError=function(e){this.push(e)},e.prototype.push=function(e){var t=this.waiting.shift();t?t(e):this.available.push(e)},e.prototype.shiftAsync=function(e){var i=this;if(void 0===e&&(e=0),0<this.available.length){var t=this.available.shift();return t instanceof Error?Promise.reject(t):Promise.resolve(t)}return new Promise(function(t,n){var r=function(e){e instanceof Error?n(e):t(e)};i.waiting.push(r),0<e&&Promise.delay(e).then(function(){var e=i.waiting.indexOf(r);0<=e&&(i.waiting.splice(e,1),n(new Error("Timeout")))})})},e}();function g(){return Date.now()}function m(){var e=new Uint8Array(4);return p.getRandomBuf(e),new Uint32Array(e.buffer)[0]}function v(r,i,o,a){function t(n){pxt.debug("downloading translations for "+r+" "+i+" "+(o||""));var t=(pxt.BrowserUtils.isLocalHost()||pxt.webConfig.isStatic?"https://makecode.com":"")+"/api/translations?lang="+encodeURIComponent(r)+"&filename="+encodeURIComponent(i)+"&approved=true";o&&(t+="&branch="+encodeURIComponent(o));var e={};return a&&(e["If-None-Match"]=a),s({url:t,headers:e}).then(function(t){return 304==t.statusCode||200==t.statusCode?(a=t.headers.etag||"",pxt.BrowserUtils.translationDbAsync().then(function(e){return e.setAsync(r,i,o,a,t.json||n)}).then(function(){return t.json||n})):t.json},function(e){console.log("failed to load translations from "+t)})}return pxt.BrowserUtils.translationDbAsync().then(function(e){return e.getAsync(r,i,o)}).then(function(e){return e?(a=e.etag,300<(Date.now()-e.time)/1e3&&t(e.strings).done(),e.strings):t()})}function y(e){var t=p.normalizeLanguageCode(e),n=t[0],r=t[1],i=pxt.appTarget.appTheme;if(i&&i.availableLocales){if(-1<i.availableLocales.indexOf(n))return!0;if(r&&-1<i.availableLocales.indexOf(r))return!0}return!1}function b(e,t,n,r,i,o,a){if(a=a||h.Editor,"en-US"===(n=p.normalizeLanguageCode(n)[0])||"en"===n)return Promise.resolve(void 0);var s,c,l=n+"/"+o+"/"+a;if(p.translationsCache()[l])return Promise.resolve(p.translationsCache()[l]);switch(a){case h.Editor:s=[{branch:r,staticName:"strings.json",path:"strings.json"},{branch:i,staticName:"target-strings.json",path:e+"/target-strings.json"}];break;case h.Sim:s=[{branch:i,staticName:"sim-strings.json",path:e+"/sim-strings.json"}];break;case h.Apis:s=[{branch:i,staticName:"bundled-strings.json",path:e+"/bundled-strings.json"}]}function u(t){t&&(c||(c={}),Object.keys(t).filter(function(e){return!!t[e]}).forEach(function(e){return c[e]=t[e]}))}if(o){var f=0;return Promise.mapSeries(s,function(e){return v(n,e.path,e.branch).then(u,function(e){console.log(e.message),++f})}).then(function(){return f&&(p.translationsCache()[l]=c),f!==s.length&&c?Promise.resolve(c):(pxt.tickEvent("translations.livetranslationsfailed"),b(e,t,n,r,i,!1,a))})}return Promise.all(s.map(function(e){return p.httpGetJsonAsync(t+"locales/"+n+"/"+e.staticName).catch(function(e){})})).then(function(e){var t={};e.forEach(function(e){return pxt.Util.jsonMergeFrom(t,e)}),Object.keys(t).length&&(c=t,p.translationsCache()[l]=c)},function(e){console.error("failed to load localizations")}).then(function(){return c})}p.PromiseBuffer=d,p.now=g,p.nowSeconds=function(){return Math.round(g()/1e3)},p.cpuUs=function(){var e="undefined"!=typeof performance?performance.now.bind(performance)||performance.moznow.bind(performance)||performance.msNow.bind(performance)||performance.webkitNow.bind(performance)||performance.oNow.bind(performance):Date.now;return p.cpuUs=function(){return 1e3*e()},p.cpuUs()},p.getMime=function(e){var t=/\.([a-zA-Z0-9]+)$/.exec(e);if(!t)return"application/octet-stream";switch(t[1].toLowerCase()){case"txt":return"text/plain";case"html":case"htm":return"text/html";case"css":return"text/css";case"js":return"application/javascript";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"ico":return"image/x-icon";case"manifest":return"text/cache-manifest";case"webmanifest":return"application/manifest+json";case"json":return"application/json";case"svg":return"image/svg+xml";case"eot":return"application/vnd.ms-fontobject";case"ttf":return"font/ttf";case"woff":return"application/font-woff";case"woff2":return"application/font-woff2";case"md":return"text/markdown";case"xml":return"application/xml";case"m4a":return"audio/m4a";case"mp3":return"audio/mp3";default:return"application/octet-stream"}},p.randomUint32=m,p.guidGen=function(){function e(){return(65536|m()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()},p.downloadLiveTranslationsAsync=v,p.pxtLangCookieId="PXT_LANG",p.langCookieExpirationDays=30,p.allLanguages={af:{englishName:"Afrikaans",localizedName:"Afrikaans"},ar:{englishName:"Arabic",localizedName:"العربية"},bg:{englishName:"Bulgarian",localizedName:"български"},ca:{englishName:"Catalan",localizedName:"Català"},cs:{englishName:"Czech",localizedName:"Čeština"},da:{englishName:"Danish",localizedName:"Dansk"},de:{englishName:"German",localizedName:"Deutsch"},el:{englishName:"Greek",localizedName:"Ελληνικά"},en:{englishName:"English",localizedName:"English"},"es-ES":{englishName:"Spanish (Spain)",localizedName:"Español (España)"},"es-MX":{englishName:"Spanish (Mexico)",localizedName:"Español (México)"},fi:{englishName:"Finnish",localizedName:"Suomi"},fr:{englishName:"French",localizedName:"Français"},"fr-CA":{englishName:"French (Canada)",localizedName:"Français (Canada)"},he:{englishName:"Hebrew",localizedName:"עברית"},hr:{englishName:"Croatian",localizedName:"Hrvatski"},hu:{englishName:"Hungarian",localizedName:"Magyar"},"hy-AM":{englishName:"Armenian (Armenia)",localizedName:"Հայերէն (Հայաստան)"},id:{englishName:"Indonesian",localizedName:"Bahasa Indonesia"},is:{englishName:"Icelandic",localizedName:"Íslenska"},it:{englishName:"Italian",localizedName:"Italiano"},ja:{englishName:"Japanese",localizedName:"日本語"},ko:{englishName:"Korean",localizedName:"한국어"},lt:{englishName:"Lithuanian",localizedName:"Lietuvių"},nl:{englishName:"Dutch",localizedName:"Nederlands"},no:{englishName:"Norwegian",localizedName:"Norsk"},nb:{englishName:"Norwegian Bokmal",localizedName:"Norsk bokmål"},pl:{englishName:"Polish",localizedName:"Polski"},"pt-BR":{englishName:"Portuguese (Brazil)",localizedName:"Português (Brasil)"},"pt-PT":{englishName:"Portuguese (Portugal)",localizedName:"Português (Portugal)"},ro:{englishName:"Romanian",localizedName:"Română"},ru:{englishName:"Russian",localizedName:"Русский"},"si-LK":{englishName:"Sinhala (Sri Lanka)",localizedName:"සිංහල (ශ්රී ලංකා)"},sk:{englishName:"Slovak",localizedName:"Slovenčina"},sl:{englishName:"Slovenian",localizedName:"Slovenski"},sr:{englishName:"Serbian",localizedName:"Srpski"},"sv-SE":{englishName:"Swedish (Sweden)",localizedName:"Svenska (Sverige)"},ta:{englishName:"Tamil",localizedName:"தமிழ்"},tr:{englishName:"Turkish",localizedName:"Türkçe"},uk:{englishName:"Ukrainian",localizedName:"Українська"},vi:{englishName:"Vietnamese",localizedName:"Tiếng việt"},"zh-CN":{englishName:"Chinese (Simplified)",localizedName:"简体中文"},"zh-TW":{englishName:"Chinese (Traditional)",localizedName:"繁体中文"}},p.isLocaleEnabled=y,p.updateLocalizationAsync=function(t,n,r,i,o,a,e){return"en-US"===(r=p.normalizeLanguageCode(r)[0])&&(r="en"),r===p.userLanguage()||!y(r)&&!e?(pxt.debug("loc: "+r+" (using built-in)"),Promise.resolve()):(pxt.debug("loc: "+r),b(t,n,r,i,o,a,w.pxtc.Util.TranslationsKind.Editor).then(function(e){return e&&(p.setUserLanguage(r),p.setLocalizedStrings(e),a&&(p.localizeLive=!0)),a?Promise.resolve():w.pxtc.Util.downloadTranslationsAsync(t,n,r,i,o,a,w.pxtc.Util.TranslationsKind.Apis).then(function(e){e&&(w.pxtc.apiLocalizationStrings=e)})}))},(f=h=p.TranslationsKind||(p.TranslationsKind={}))[f.Editor=0]="Editor",f[f.Sim=1]="Sim",f[f.Apis=2]="Apis",p.downloadTranslationsAsync=b,p.capitalize=function(e){return e?e[0].toLocaleUpperCase()+e.slice(1):e},p.uncapitalize=function(e){return(e||"").split(/(?=[A-Z])/g).join(" ").toLowerCase()},p.range=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t},p.multipartPostAsync=function(e,r,t,n){void 0===r&&(r={}),void 0===t&&(t=null),void 0===n&&(n=null);var i,o,a,s="--------------------------0461489f461126c5",c="";Object.keys(r).forEach(function(e){return n=r[t=e],c+=s+"\r\n",c+='Content-Disposition: form-data; name="'+t+'"\r\n\r\n',void(c+=n+"\r\n");var t,n}),t&&(o=n,a=(i=t).split("/").reverse()[0],c+=s+"\r\n",c+='Content-Disposition: form-data; name="files['+i+']"; filename="'+a+'"\r\n',c+="\r\n",c+=o+"\r\n"),c+=s+"--\r\n";var l={url:e,method:"POST",headers:{"Content-Type":"multipart/form-data; boundary="+s.slice(2)},data:c};return p.httpRequestCoreAsync(l)},p.toDataUri=function(e,t){return/^https?:/i.test(e)?e:/^data:/i.test(e)?e:(t||/^<svg/i.test(e)&&(t="image/svg+xml"),/xml|svg/.test(t)?"data:"+t+","+encodeURIComponent(e):"data:"+(t||"image/png")+";base64,"+x.encodeBase64(c(e)))}})((x=w.pxtc||(w.pxtc={})).Util||(x.Util={}))}(ts||(ts={})),function(e){var v;(function(e){v.Util.httpRequestCoreAsync=function(c){return new Promise(function(t,e){var r,i=!1,n=v.Util.clone(c.headers)||{};r=new XMLHttpRequest,c.responseArrayBuffer&&(r.responseType="arraybuffer"),r.onreadystatechange=function(){if(!i&&4==r.readyState){i=!0;var n={statusCode:r.status,headers:{},buffer:r.responseBody||r.response,text:c.responseArrayBuffer?void 0:r.responseText},e=r.getAllResponseHeaders();e.split(/\r?\n/).forEach(function(e){var t=/^\s*([^:]+): (.*)/.exec(e);t&&(n.headers[t[1].toLowerCase()]=t[2])}),t(n)}};var o,a=c.data,s=c.method||(null==a?"GET":"POST");null==a?o=null:a instanceof Uint8Array?o=a:"object"==typeof a?(o=JSON.stringify(a),n["content-type"]="application/json; charset=utf8"):"string"==typeof a?o=a:v.Util.oops("bad data"),r.open(s,c.url),Object.keys(n).forEach(function(e){r.setRequestHeader(e,n[e])}),null==o?r.send():r.send(o)})},v.Util.sha256=n,v.Util.getRandomBuf=function(e){if(window.crypto)window.crypto.getRandomValues(e);else for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())};var g=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function m(e,t){return e>>>t|e<<32-t}function p(e,t){v.Util.assert(8==e.length),v.Util.assert(64==t.length);for(var n=16;n<64;++n){var r=m(t[n-15],7)^m(t[n-15],18)^t[n-15]>>>3,i=m(t[n-2],17)^m(t[n-2],19)^t[n-2]>>>10;t[n]=t[n-16]+r+t[n-7]+i|0}var o=e[0],a=e[1],s=e[2],c=e[3],l=e[4],u=e[5],f=e[6],p=e[7];for(n=0;n<64;++n){var h=p+(i=m(l,6)^m(l,11)^m(l,25))+(l&u^~l&f)+g[n]+t[n]|0,d=o&a^o&s^a&s;p=f,f=u,u=l,l=c+h|0,c=s,s=a,o=h+((r=m(a=o,2)^m(o,13)^m(o,22))+d|0)|0}e[0]+=o,e[1]+=a,e[2]+=s,e[3]+=c,e[4]+=l,e[5]+=u,e[6]+=f,e[7]+=p}function t(e){var o=new Uint32Array(8);o[0]=1779033703,o[1]=3144134277,o[2]=1013904242,o[3]=2773480762,o[4]=1359893119,o[5]=2600822924,o[6]=528734635,o[7]=1541459225;var a=new Uint32Array(64),s=64;function t(e){for(var t=e.length-(s-1),n=0;n<t;n+=s){for(var r=0;r<16;r++){var i=(r<<2)+n;a[r]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]}p(o,a)}}t(e);var n=64-(e.length+9)%64;64==n&&(n=0);for(var r=e.length-e.length%s,i=new Uint8Array(e.length-r+1+n+8),c=0;r<e.length;)i[c++]=e[r++];for(i[c++]=128;0<n--;)i[c++]=0;var l=8*e.length;for(c=i.length;0<l;)i[--c]=255&l,l>>=8;t(i);for(var u="",f=0;f<o.length;++f)u+=("000000000"+o[f].toString(16)).slice(-8);return u.toLowerCase()}function n(e){return t(v.Util.stringToUint8Array(v.Util.toUTF8(e)))}e.sha256buffer=t,e.sha256string=n})((v=e.pxtc||(e.pxtc={})).BrowserImpl||(v.BrowserImpl={}))}(ts||(ts={})),function(e){e.perf||(e.perf={})}(pxt||(pxt={})),pxt.perf.report||(pxt.perf.report=function(){}),pxt.perf.recordMilestone||(pxt.perf.recordMilestone=function(){}),pxt.perf.measureStart||(pxt.perf.measureStart=function(){}),pxt.perf.measureEnd||(pxt.perf.measureEnd=function(){}),function(a){var n;a.U=pxtc.Util,a.Util=pxtc.Util,a.conversionPasses=[];var f,o,s={};function i(e,t){s[e]=t,a.appTarget&&(a.U.jsonCopyFrom(a.appTarget.compile.switches,s),a.U.jsonCopyFrom(n.compile.switches,s))}function r(){var e=a.appTarget.compile;e||(e=a.appTarget.compile={isNative:!1,hasHex:!1,switches:{}}),e.hasHex&&(e.nativeType||(e.nativeType=pxtc.NATIVE_TYPE_THUMB)),e.switches||(e.switches={}),a.U.jsonCopyFrom(e.switches,s),e.jsRefCounting=!1,e.vtableShift||(e.vtableShift=2),e.useUF2||e.useELF||null!=e.noSourceInFlash||(e.noSourceInFlash=!0),void 0===e.utf8&&(e.utf8=!0),a.appTarget.appTheme||(a.appTarget.appTheme={}),a.appTarget.appTheme.embedUrl||(a.appTarget.appTheme.embedUrl=a.appTarget.appTheme.homeUrl);var t=a.appTarget.compileService;t&&t.yottaTarget&&!t.yottaBinary&&(t.yottaBinary="pxt-microbit-app-combined.hex");var n=a.appTarget.appTheme;n&&Object.keys(n).filter(function(e){return/(logo|hero)$/i.test(e)&&/^@cdnUrl@/.test(n[e])}).forEach(function(e){return n[e]=a.BrowserUtils.patchCdn(n[e])});var r=a.appTarget.simulator;if(r&&r.boardDefinition&&r.boardDefinition.visual){var i=r.boardDefinition.visual;i.image&&(i.image=a.BrowserUtils.patchCdn(i.image),i.outlineImage&&(i.outlineImage=a.BrowserUtils.patchCdn(i.outlineImage)))}if(Object.keys(a.appTarget.bundledpkgs).forEach(function(e){var t=a.appTarget.bundledpkgs[e],n=JSON.parse(t[a.CONFIG_NAME]);n.icon&&(n.icon=a.BrowserUtils.patchCdn(n.icon)),t[a.CONFIG_NAME]=a.Package.stringifyConfig(n)}),a.appTarget.queryVariants&&"undefined"!=typeof window){var o=window.location.href;Object.keys(a.appTarget.queryVariants).forEach(function(e){if(new RegExp(e,"i").exec(o)){var t=a.appTarget.queryVariants[e];t&&a.U.jsonMergeFrom(a.appTarget,t)}})}}function c(){a.perf.measureStart("reloadAppTargetVariant");var e=JSON.stringify(a.appTarget);if(a.appTarget=a.U.clone(n),a.appTargetVariant){var t=a.appTarget.variants&&a.appTarget.variants[a.appTargetVariant];t?a.U.jsonMergeFrom(a.appTarget,t):a.U.userError(lf("Variant '{0}' not defined in pxtarget.json",a.appTargetVariant))}r(),a.onAppTargetChanged&&e!=JSON.stringify(a.appTarget)&&a.onAppTargetChanged(),a.perf.measureEnd("reloadAppTargetVariant")}a.setAppTarget=function(e){a.appTarget=e||{},r(),n=a.U.clone(a.appTarget)},a.setBundledApiInfo=function(e){for(var t=0,n=Object.keys(e);t<n.length;t++)for(var r=e[n[t]].apis.byQName,i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=r[a],c=a.lastIndexOf("."),l=r[a]={kind:Math.abs(s.kind||7),qName:a,namespace:a.slice(0,c<0?0:c),name:a.slice(c+1),fileName:"",attributes:s.attributes||{},retType:s.retType||"void",parameters:s.parameters?s.parameters.map(function(e){return{name:e.name,description:e.description||"",type:e.type||"number",initializer:e.initializer,default:e.default,options:e.options||{},isEnum:!!e.isEnum,handlerParameters:e.handlerParameters}}):null,extendsTypes:s.extendsTypes,snippet:s.kind&&s.kind<0?null:void 0,isInstance:!!s.isInstance,isReadOnly:!!s.isReadOnly},u=l.attributes;u.paramDefl||(u.paramDefl={}),u.callingConvention||(u.callingConvention=0),u.paramHelp||(u.paramHelp={}),u.jsDoc||(u.jsDoc=""),u._name=l.name.replace(/@.*/,"")}f=e},a.getBundledApiInfo=function(){return f},a.savedAppTheme=function(){return n?n.appTheme:void 0},a.setCompileSwitch=i,a.setCompileSwitches=function(e){if(e)for(var t=0,n=e.split(/[\s,;:]+/);t<n.length;t++){var r=n[t];r&&i(r,!0)}},a.bundledSvg=function(e){if(e){var t=o&&o[e];if(t)return t;if(a.appTarget.simulator&&a.appTarget.simulator.dynamicBoardDefinition){o||(o={});var n=a.appTarget.bundledpkgs[e];if(n){if(JSON.parse(n["pxt.json"]).core&&n["board.json"]){var r=JSON.parse(n["board.json"]);if(r&&r.visual&&r.visual.image){var i=r.visual.image;/^pkg:\/\//.test(i)&&(i=n[i.slice(6)]),o[e]="data:image/svg+xml;base64,"+ts.pxtc.encodeBase64(a.Util.toUTF8(i))}}return o[e]}}}},a.reloadAppTargetVariant=c,a.setAppTargetVariant=function(e,t){a.debug("app variant: "+e),(t||a.appTargetVariant!==e&&(a.appTargetVariant||e))&&(a.appTargetVariant=e,c())},a.setHwVariant=function(e){e=e.replace(/.*---/,""),/^[\w\-]+$/.test(e)?a.hwVariant=e:a.hwVariant=null},a.hasHwVariants=function(){return!!a.appTarget.variants&&Object.keys(a.appTarget.bundledpkgs).some(function(e){return/^hw---/.test(e)})},a.getHwVariants=function(){return a.appTarget.variants?Object.keys(a.appTarget.bundledpkgs).filter(function(e){return/^hw---/.test(e)}).map(function(e){return JSON.parse(a.appTarget.bundledpkgs[e][a.CONFIG_NAME])}).filter(function(e){return!!a.appTarget.appTheme.experimentalHw||!e.experimentalHw}):[]},a.options={},a.debug="undefined"!=typeof console&&console.debug?function(e){a.options.debug&&console.debug(e)}:function(){},a.log="undefined"!=typeof console&&console.log?function(e){console.log(e)}:function(){},a.reportException=function(e,t){if(console&&(console.error(e),t))try{console.log(t)}catch(e){}},a.reportError=function(e,t,n){if(console&&(console.error(e+": "+t),n))try{a.log(JSON.stringify(n,null,2))}catch(e){}};var l={},u=a.Util.debounce(function(){a.tickEvent("activity",l),l={}},1e4,!1);function t(){return{relprefix:"/--",workerjs:"/worker.js",monacoworkerjs:"/monacoworker.js",gifworkerjs:"/gifjs/gif.worker.js",pxtVersion:"local",pxtRelId:"",pxtCdnUrl:"/cdn/",commitCdnUrl:"/cdn/",blobCdnUrl:"/blb/",cdnUrl:"/cdn/",targetUrl:"",targetVersion:"local",targetRelId:"",targetId:a.appTarget?a.appTarget.id:"",simUrl:"/sim/simulator.html",partsUrl:"/sim/siminstructions.html"}}a.tickActivity=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.filter(function(e){return!!e}).map(function(e){return e.slice(0,64)}).forEach(function(e){return l[e]=(l[e]||0)+1}),u()},a.localWebConfig=t,a.getOnlineCdnUrl=function(){if(!a.webConfig)return null;var e=/^(https:\/\/[^\/]+)/.exec(a.webConfig.commitCdnUrl);return e?e[1]:null},a.setupWebConfig=function(e){e?a.webConfig=e:a.webConfig||(a.webConfig=t())},a.getEmbeddedScript=function(e){return a.U.lookup(a.appTarget.bundledpkgs||{},e)};var e=void 0;function p(){return e||(e=a.Cloud.downloadTargetConfigAsync().then(function(e){return e||{}},function(e){return{}})),e}function h(e){return void 0===e&&(e=null),e||(e=a.appTarget.compile),e.nativeType==ts.pxtc.NATIVE_TYPE_VM?ts.pxtc.BINARY_PXT64:e.useUF2?ts.pxtc.BINARY_UF2:e.useELF?ts.pxtc.BINARY_ELF:ts.pxtc.BINARY_HEX}a.targetConfigAsync=p,a.packagesConfigAsync=function(){return p().then(function(e){return e?e.packages:void 0})},a.CONFIG_NAME="pxt.json",a.SIMSTATE_JSON=".simstate.json",a.SERIAL_EDITOR_FILE="serial.txt",a.CLOUD_ID="pxt/",a.BLOCKS_PROJECT_NAME="blocksprj",a.JAVASCRIPT_PROJECT_NAME="tsprj",a.PYTHON_PROJECT_NAME="pyprj",a.outputName=h,a.isOutputText=function(e){return void 0===e&&(e=null),h(e)==ts.pxtc.BINARY_HEX}}(pxt||(pxt={})),function(i){!function(o){var t,v="this";function n(){if((t={device_while:{name:i.Util.lf("a loop that repeats while the condition is true"),tooltip:i.Util.lf("Run the same sequence of actions while the condition is met."),url:"/blocks/loops/while",category:"loops",block:{message0:i.Util.lf("while %1"),appendField:i.Util.lf("{id:while}do")}},pxt_controls_for:{name:i.Util.lf("a loop that repeats the number of times you say"),tooltip:i.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:i.Util.lf("for %1 from 0 to %2"),variable:i.Util.lf("{id:var}index"),appendField:i.Util.lf("{id:for}do")}},controls_simple_for:{name:i.Util.lf("a loop that repeats the number of times you say"),tooltip:i.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:i.Util.lf("for %1 from 0 to %2"),variable:i.Util.lf("{id:var}index"),appendField:i.Util.lf("{id:for}do")}},pxt_controls_for_of:{name:i.Util.lf("a loop that repeats for each value in an array"),tooltip:i.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:i.Util.lf("for element %1 of %2"),variable:i.Util.lf("{id:var}value"),appendField:i.Util.lf("{id:for_of}do")}},controls_for_of:{name:i.Util.lf("a loop that repeats for each value in an array"),tooltip:i.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:i.Util.lf("for element %1 of %2"),variable:i.Util.lf("{id:var}value"),appendField:i.Util.lf("{id:for_of}do")}},math_op2:{name:i.Util.lf("minimum or maximum of 2 numbers"),tooltip:{min:i.Util.lf("smaller value of 2 numbers"),max:i.Util.lf("larger value of 2 numbers")},url:"/blocks/math",operators:{op:["min","max"]},category:"math"},math_op3:{name:i.Util.lf("absolute number"),tooltip:i.Util.lf("absolute value of a number"),url:"/reference/math",category:"math",block:{message0:i.Util.lf("absolute of %1")}},math_number:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:i.appTarget&&i.appTarget.compile?i.Util.lf("a decimal number"):i.Util.lf("an integer number")},math_integer:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:i.Util.lf("an integer number")},math_whole_number:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:i.Util.lf("a whole number")},math_number_minmax:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math"},math_arithmetic:{name:i.Util.lf("arithmetic operation"),url:"/blocks/math",tooltip:{ADD:i.Util.lf("Return the sum of the two numbers."),MINUS:i.Util.lf("Return the difference of the two numbers."),MULTIPLY:i.Util.lf("Return the product of the two numbers."),DIVIDE:i.Util.lf("Return the quotient of the two numbers."),POWER:i.Util.lf("Return the first number raised to the power of the second number.")},operators:{OP:["ADD","MINUS","MULTIPLY","DIVIDE","POWER"]},category:"math",block:{MATH_ADDITION_SYMBOL:i.Util.lf("{id:op}+"),MATH_SUBTRACTION_SYMBOL:i.Util.lf("{id:op}-"),MATH_MULTIPLICATION_SYMBOL:i.Util.lf("{id:op}×"),MATH_DIVISION_SYMBOL:i.Util.lf("{id:op}÷"),MATH_POWER_SYMBOL:i.Util.lf("{id:op}**")}},math_modulo:{name:i.Util.lf("division remainder"),tooltip:i.Util.lf("Return the remainder from dividing the two numbers."),url:"/blocks/math",category:"math",block:{MATH_MODULO_TITLE:i.Util.lf("remainder of %1 ÷ %2")}},math_js_op:{name:i.Util.lf("math function"),tooltip:{sqrt:i.Util.lf("Returns the square root of the argument"),sin:i.Util.lf("Returns the sine of the argument"),cos:i.Util.lf("Returns the cosine of the argument"),tan:i.Util.lf("Returns the tangent of the argument"),atan2:i.Util.lf("Returns the arctangent of the quotient of the two arguments"),idiv:i.Util.lf("Returns the integer portion of the division operation on the two arguments"),imul:i.Util.lf("Returns the integer portion of the multiplication operation on the two arguments")},url:"/blocks/math",operators:{OP:["sqrt","sin","cos","tan","atan2","idiv","imul"]},category:"math",block:{sqrt:i.Util.lf("{id:op}square root"),sin:i.Util.lf("{id:op}sin"),cos:i.Util.lf("{id:op}cos"),tan:i.Util.lf("{id:op}tan"),atan2:i.Util.lf("{id:op}atan2"),idiv:i.Util.lf("{id:op}integer ÷"),imul:i.Util.lf("{id:op}integer ×")}},math_js_round:{name:i.Util.lf("rounding functions"),tooltip:{round:i.Util.lf("Increases the argument to the next higher whole number if its fractional part is more than one half"),ceil:i.Util.lf("Increases the argument to the next higher whole number"),floor:i.Util.lf("Decreases the argument to the next lower whole number"),trunc:i.Util.lf("Removes the fractional part of the argument")},url:"/blocks/math",operators:{OP:["round","ceil","floor","trunc"]},category:"math",block:{round:i.Util.lf("{id:op}round"),ceil:i.Util.lf("{id:op}ceiling"),floor:i.Util.lf("{id:op}floor"),trunc:i.Util.lf("{id:op}truncate")}},variables_change:{name:i.Util.lf("update the value of a number variable"),tooltip:i.Util.lf("Changes the value of the variable by this amount"),url:"/blocks/variables/change",category:"variables",block:{message0:i.Util.lf("change %1 by %2")}},controls_repeat_ext:{name:i.Util.lf("a loop that repeats and increments an index"),tooltip:i.Util.lf("Do some statements several times."),url:"/blocks/loops/repeat",category:"loops",block:{CONTROLS_REPEAT_TITLE:i.Util.lf("repeat %1 times"),CONTROLS_REPEAT_INPUT_DO:i.Util.lf("{id:repeat}do")}},variables_get:{name:i.Util.lf("get the value of a variable"),tooltip:i.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:i.Util.lf("Create 'set %1'")}},variables_get_reporter:{name:i.Util.lf("get the value of a variable"),tooltip:i.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:i.Util.lf("Create 'set %1'")}},variables_set:{name:i.Util.lf("assign the value of a variable"),tooltip:i.Util.lf("Sets this variable to be equal to the input."),url:"/blocks/variables/assign",category:"variables",block:{VARIABLES_SET:i.Util.lf("set %1 to %2")}},controls_if:{name:i.Util.lf("a conditional statement"),tooltip:{CONTROLS_IF_TOOLTIP_1:i.Util.lf("If a value is true, then do some statements."),CONTROLS_IF_TOOLTIP_2:i.Util.lf("If a value is true, then do the first block of statements. Otherwise, do the second block of statements."),CONTROLS_IF_TOOLTIP_3:i.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements."),CONTROLS_IF_TOOLTIP_4:i.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.")},tooltipSearch:"CONTROLS_IF_TOOLTIP_2",url:"/blocks/logic/if",category:"logic",block:{CONTROLS_IF_MSG_IF:i.Util.lf("{id:logic}if"),CONTROLS_IF_MSG_THEN:i.Util.lf("{id:logic}then"),CONTROLS_IF_MSG_ELSE:i.Util.lf("{id:logic}else"),CONTROLS_IF_MSG_ELSEIF:i.Util.lf("{id:logic}else if")}},lists_create_with:{name:i.Util.lf("create an array"),tooltip:i.Util.lf("Creates a new array."),url:"/reference/arrays/create",category:"arrays",blockTextSearch:"LISTS_CREATE_WITH_INPUT_WITH",block:{LISTS_CREATE_EMPTY_TITLE:i.Util.lf("empty array"),LISTS_CREATE_WITH_INPUT_WITH:i.Util.lf("array of"),LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:i.Util.lf("array"),LISTS_CREATE_WITH_ITEM_TITLE:i.Util.lf("value")}},lists_length:{name:i.Util.lf("array length"),tooltip:i.Util.lf("Returns the number of items in an array."),url:"/reference/arrays/length",category:"arrays",block:{LISTS_LENGTH_TITLE:i.Util.lf("length of array %1")}},lists_index_get:{name:i.Util.lf("get a value in an array"),tooltip:i.Util.lf("Returns the value at the given index in an array."),url:"/reference/arrays/get",category:"arrays",block:{message0:i.Util.lf("%1 get value at %2")}},lists_index_set:{name:i.Util.lf("set a value in an array"),tooltip:i.Util.lf("Sets the value at the given index in an array"),url:"/reference/arrays/set",category:"arrays",block:{message0:i.Util.lf("%1 set value at %2 to %3")}},logic_compare:{name:i.Util.lf("comparing two numbers"),tooltip:{LOGIC_COMPARE_TOOLTIP_EQ:i.Util.lf("Return true if both inputs equal each other."),LOGIC_COMPARE_TOOLTIP_NEQ:i.Util.lf("Return true if both inputs are not equal to each other."),LOGIC_COMPARE_TOOLTIP_LT:i.Util.lf("Return true if the first input is smaller than the second input."),LOGIC_COMPARE_TOOLTIP_LTE:i.Util.lf("Return true if the first input is smaller than or equal to the second input."),LOGIC_COMPARE_TOOLTIP_GT:i.Util.lf("Return true if the first input is greater than the second input."),LOGIC_COMPARE_TOOLTIP_GTE:i.Util.lf("Return true if the first input is greater than or equal to the second input.")},url:"/blocks/logic/boolean",category:"logic",block:{search:"= ≠ < ≤ > ≥"}},logic_operation:{name:i.Util.lf("boolean operation"),tooltip:{LOGIC_OPERATION_TOOLTIP_AND:i.Util.lf("Return true if both inputs are true."),LOGIC_OPERATION_TOOLTIP_OR:i.Util.lf("Return true if at least one of the inputs is true.")},url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_OPERATION_AND:i.Util.lf("{id:op}and"),LOGIC_OPERATION_OR:i.Util.lf("{id:op}or")}},logic_negate:{name:i.Util.lf("logical negation"),tooltip:i.Util.lf("Returns true if the input is false. Returns false if the input is true."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_NEGATE_TITLE:i.Util.lf("not %1")}},logic_boolean:{name:i.Util.lf("a `true` or `false` value"),tooltip:i.Util.lf("Returns either true or false."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_BOOLEAN_TRUE:i.Util.lf("{id:boolean}true"),LOGIC_BOOLEAN_FALSE:i.Util.lf("{id:boolean}false")}},text:{name:i.Util.lf("a piece of text"),tooltip:i.Util.lf("A letter, word, or line of text."),url:"types/string",category:"text",block:{search:i.Util.lf("a piece of text")}},text_length:{name:i.Util.lf("number of characters in the string"),tooltip:i.Util.lf("Returns the number of letters (including spaces) in the provided text."),url:"reference/text/length",category:"text",block:{TEXT_LENGTH_TITLE:i.Util.lf("length of %1")}},text_join:{name:i.Util.lf("join items to create text"),tooltip:i.Util.lf("Create a piece of text by joining together any number of items."),url:"reference/text/join",category:"text",block:{TEXT_JOIN_TITLE_CREATEWITH:i.Util.lf("join")}},procedures_defnoreturn:{name:i.Util.lf("define the function"),tooltip:i.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{PROCEDURES_DEFNORETURN_TITLE:i.Util.lf("function"),PROCEDURE_ALREADY_EXISTS:i.Util.lf("A function named '%1' already exists.")}},procedures_callnoreturn:{name:i.Util.lf("call the function"),tooltip:i.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{PROCEDURES_CALLNORETURN_TITLE:i.Util.lf("call function")}},function_definition:{name:i.Util.lf("define the function"),tooltip:i.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{FUNCTIONS_EDIT_OPTION:i.Util.lf("Edit Function")}},function_call:{name:i.Util.lf("call the function"),tooltip:i.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{FUNCTIONS_CALL_TITLE:i.Util.lf("call")}}})[pxtc.ON_START_TYPE]={name:i.Util.lf("on start event"),tooltip:i.Util.lf("Run code when the program starts"),url:"/blocks/on-start",category:"loops",block:{message0:i.Util.lf("on start %1 %2")}},t[pxtc.PAUSE_UNTIL_TYPE]={name:i.Util.lf("pause until"),tooltip:i.Util.lf("Pause execution of code until the given boolean expression is true"),url:"/blocks/pause-until",category:"loops",block:{message0:i.Util.lf("pause until %1")}},t[pxtc.TS_BREAK_TYPE]={name:i.Util.lf("break"),tooltip:i.Util.lf("Break out of the current loop or switch"),url:"/blocks/loops/break",category:"loops",block:{message0:i.Util.lf("break")}},t[pxtc.TS_CONTINUE_TYPE]={name:i.Util.lf("continue"),tooltip:i.Util.lf("Skip current iteration and continues with the next iteration in the loop"),url:"/blocks/loops/continue",category:"loops",block:{message0:i.Util.lf("continue")}},i.Util.isTranslationMode()){var r=Blockly.Msg;i.Util.values(t).filter(function(e){return e.block}).forEach(function(n){var e=Object.keys(n.block);n.translationIds=i.Util.values(n.block),e.forEach(function(t){return i.crowdin.inContextLoadAsync(n.block[t]).done(function(e){n.block[t]=e,/^[A-Z_]+$/.test(t)&&(r[t]=e)})})})}}o.MATH_FUNCTIONS={unary:["sqrt","sin","cos","tan"],binary:["atan2"],infix:["idiv","imul"]},o.ROUNDING_FUNCTIONS=["round","ceil","floor","trunc"],o.builtinFunctionInfo={"Math.abs":{blockId:"math_op3",params:["x"]},"Math.min":{blockId:"math_op2",params:["x","y"]},"Math.max":{blockId:"math_op2",params:["x","y"]}},o.normalizeBlock=function(e,t){if(void 0===t&&(t=i.log),!e)return e;var n=e.replace(/[^\\]%\s+/g,"%");return n!=e?(t("block has extra spaces: "+e),e):((n=(e=n).replace(/(%\w+)\s*=\s*(\w+)/,"$1=$2"))!=e&&(t("block has space between %name and = : "+e),e=n),n=(n=n.replace(/\s*\|\s*/g,"|")).replace(/^[A-Z]/,function(e){return e.toLowerCase()}))},o.compileInfo=function(n){var a={parameters:[],actualNameToParam:{},definitionNameToParam:{},handlerArgs:[]},e=(1==n.kind||2==n.kind)&&!n.attributes.defaultInstance,s=!!n.attributes._def,c=s?n.attributes._def.parameters.slice(0):void 0,l=s?c.length:n.parameters?n.parameters.length:0,u=o.builtinFunctionInfo[n.qName];s&&n.attributes._expandedDef&&c.push.apply(c,n.attributes._expandedDef.parameters);var f={},p=c?c.filter(function(e){return!e.ref||(f[e.name]=e,!1)}):[];if(e&&s&&c.length){var t=f[v]||c[0],r=t.name,i=!t.shadowBlockId||"variables_get"===t.shadowBlockId;a.thisParameter={actualName:v,definitionName:r,shadowBlockId:t.shadowBlockId,type:n.namespace,defaultValue:i?t.varName:void 0,fieldEditor:d(r,v),fieldOptions:g(r,v),shadowOptions:m(r,v)}}if(n.parameters){var h=e&&!f[v]?1:0;n.parameters.forEach(function(e,t){var n;if(f[e.name]?n=f[e.name]:h<p.length&&(n=p[h],++h),n||!s){var r=void 0;e.options&&e.options.min&&e.options.max&&(r={min:e.options.min.value,max:e.options.max.value});var i=n?n.name:u?u.params[h++]:e.name,o=n&&("variables_get"===n.shadowBlockId||"lists_create_with"==n.shadowBlockId);a.parameters.push({actualName:e.name,type:e.type,defaultValue:o&&n.varName||e.default,definitionName:i,shadowBlockId:n&&n.shadowBlockId,isOptional:!!c&&c.indexOf(n)>=l,fieldEditor:d(i,e.name),fieldOptions:g(i,e.name),shadowOptions:m(i,e.name),range:r})}e.handlerParameters&&e.handlerParameters.forEach(function(t){a.handlerArgs.push({name:t.name,type:t.type,inBlockDef:!!c&&c.some(function(e){return e.ref&&e.name===t.name})})})})}return a.parameters.forEach(function(e){a.actualNameToParam[e.actualName]=e,a.definitionNameToParam[e.definitionName]=e}),a;function d(e,t){return n.attributes.paramFieldEditor&&(n.attributes.paramFieldEditor[e]||n.attributes.paramFieldEditor[t])}function g(e,t){return n.attributes.paramFieldEditorOptions&&(n.attributes.paramFieldEditorOptions[e]||n.attributes.paramFieldEditorOptions[t])}function m(e,t){return n.attributes.paramShadowOptions&&(n.attributes.paramShadowOptions[e]||n.attributes.paramShadowOptions[t])}},o.reporterTypeForArgType=function(e){var t="argument_reporter_custom";return"boolean"!==e&&"number"!==e&&"string"!==e||(t="argument_reporter_"+e),t},o.defaultIconForArgType=function(e){switch(void 0===e&&(e=""),e){case"number":return"calculator";case"string":return"text width";case"boolean":return"random";default:return"align justify"}},o.parseFields=function(e){return e.split("|").map(function(e,t){var n=/([^%]*)\s*%([a-zA-Z0-9_]+)/.exec(e);if(!n)return{n:e,ni:t};var r=n[1];return r&&(r=r.trim()),{n:e,ni:t,pre:r,p:n[2]}})},o.blockDefinitions=function(){return t||n(),t},o.getBlockDefinition=function(e){return t||n(),t[e]}}(i.blocks||(i.blocks={}))}(pxt||(pxt={})),function(G){!function(f){function t(){return"undefined"!=typeof navigator}function e(){return t()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)}function p(){return t()&&/mobi/i.test(navigator.userAgent)}function n(){return t()&&/Mac/i.test(navigator.platform)}function u(){return!!navigator&&/Linux/i.test(navigator.platform)}function h(){return t()&&/arm/i.test(navigator.platform)}function d(){return t()&&/Edge/i.test(navigator.userAgent)}function g(){return t()&&/Trident/i.test(navigator.userAgent)}function m(){return!d()&&!g()&&!!navigator&&(/Chrome/i.test(navigator.userAgent)||/Chromium/i.test(navigator.userAgent))}function v(){return!m()&&!d()&&!!navigator&&/(Macintosh|Safari|iPod|iPhone|iPad)/i.test(navigator.userAgent)}function y(){return!v()&&!!navigator&&(/Firefox/i.test(navigator.userAgent)||/Seamonkey/i.test(navigator.userAgent))}function b(){return t()&&/Opera|OPR/i.test(navigator.userAgent)}function w(){return t()&&/Midori/i.test(navigator.userAgent)}function x(){return t()&&/Epiphany/i.test(navigator.userAgent)}function r(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function i(){return"undefined"!=typeof window&&!!window.pxtElectron}function o(){return"undefined"!=typeof window&&!!window.ipcRenderer}function a(){return i()||o()}function s(){try{return"undefined"!=typeof window&&/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&!/nolocalhost=1/.test(window.location.href)&&!(G.webConfig&&G.webConfig.isStatic)}catch(e){return!1}}function c(){return"undefined"!=typeof window&&!!window.PointerEvent}function k(){return e()?"windows":n()?"mac":u()&&h()?"rpi":u()?"linux":"unknown"}function A(){return d()?"edge":x()?"epiphany":w()?"midori":b()?"opera":g()?"ie":m()?"chrome":v()?"safari":y()?"firefox":"unknown"}function T(){if(!t())return null;var e=[];return b()&&(e=/(Opera|OPR)\/([0-9\.]+)/i.exec(navigator.userAgent)),x()?e=/Epiphany\/([0-9\.]+)/i.exec(navigator.userAgent):w()?e=/Midori\/([0-9\.]+)/i.exec(navigator.userAgent):v()?(e=/Version\/([0-9\.]+)/i.exec(navigator.userAgent))||(e=/(Macintosh|iPod|iPhone|iPad); (CPU|Intel).*?OS (X )?(\d+)/i.exec(navigator.userAgent)):e=m()?/(Chrome|Chromium)\/([0-9\.]+)/i.exec(navigator.userAgent):d()?/Edge\/([0-9\.]+)/i.exec(navigator.userAgent):g()?/(MSIE |rv:)([0-9\.]+)/i.exec(navigator.userAgent):/(Firefox|Seamonkey)\/([0-9\.]+)/i.exec(navigator.userAgent),e&&0!=e.length?e[e.length-1]:null}f.isIFrame=function(){try{return window&&window.self!==window.top}catch(e){return!0}},f.hasNavigator=t,f.isWindows=e,f.isWindows10=function(){return t()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)&&/Windows NT 10/i.test(navigator.userAgent)},f.isMobile=p,f.isIOS=function(){return t()&&/iPad|iPhone|iPod/.test(navigator.userAgent)},f.isMac=n,f.isLinux=u,f.isARM=h,f.isUwpEdge=function(){return"undefined"!=typeof window&&!!window.Windows},f.isEdge=d,f.isIE=g,f.isChrome=m,f.isSafari=v,f.isFirefox=y,f.isOpera=b,f.isMidori=w,f.isEpiphany=x,f.isTouchEnabled=r,f.isPxtElectron=i,f.isIpcRenderer=o,f.isElectron=a,f.isLocalHost=s,f.isLocalHostDev=function(){return s()&&!a()},f.hasPointerEvents=c,f.hasSaveAs=function(){return d()||g()||y()},f.os=k,f.browser=A,f.browserVersion=T;var E=!1;function C(){return p()&&v()&&!/downloadWindowOpen=0/i.test(window.location.href)}function l(e,t,n){var r=C(),i=T(),o=parseInt(i||"0");if(r)n?n.location.href=e:window.open(e,"_self");else if(G.BrowserUtils.isSafari()&&(o<10||0==i.indexOf("10.0")||p())){var a=document.getElementById("downloader");a||(G.debug("injecting downloader iframe"),(a=document.createElement("iframe")).id="downloader",a.style.position="absolute",a.style.right="0",a.style.bottom="0",a.style.zIndex="-1",a.style.width="1px",a.style.height="1px",document.body.appendChild(a)),a.src=e}else if(G.BrowserUtils.isEdge()||G.BrowserUtils.isIE()){var s=atob(e.split(",")[1]),c=G.Util.stringToUint8Array(s),l=new Blob([c],{type:"img/png"});window.navigator.msSaveOrOpenBlob(l,t)}else{var u=window.document.createElement("a");"string"==typeof u.download?(u.href=e,u.download=t,document.body.appendChild(u),u.click(),document.body.removeChild(u)):document.location.href=e}}function _(e,t){var n="data";p()&&v()&&G.appTarget.appTheme.mobileSafariDownloadProtocol&&(n=G.appTarget.appTheme.mobileSafariDownloadProtocol);var r=/downloadProtocol=([a-z0-9:/?]+)/i.exec(window.location.href);return r&&(n=r[1]),n+":"+t+";base64,"+e}function U(e,t,n,r,i){void 0===n&&(n="application/octet-stream"),G.debug("trigger download");var o=window.navigator.msSaveOrOpenBlob&&!G.BrowserUtils.isMobile(),a=_(e,t);try{if(o){var s=new Blob([G.Util.stringToUint8Array(atob(e))],{type:n});window.navigator.msSaveOrOpenBlob(s,t)}else l(a,t,r)}catch(e){i&&i(e),G.debug("saving failed")}return a}function S(n){var r=document.createElement("img");return new Promise(function(e,t){r.onload=function(){return e(r)},r.onerror=function(){return e(void 0)},r.crossOrigin="anonymous",r.src=n})}function P(e){if(/^https?:\/\//i.test(e))return e;var t=(window.MonacoPaths||{})[e];return t||(G.U.startsWith(e,G.webConfig.commitCdnUrl)?e:G.webConfig.commitCdnUrl+e)}f.isBrowserSupported=function(){if(!navigator)return!0;if(/bot|crawler|spider|crawling/i.test(navigator.userAgent))return!0;if(G.appTarget.unsupportedBrowsers&&G.appTarget.unsupportedBrowsers.some(function(e){return e.id==A()}))return!1;var e=T(),t=parseInt(e||"0"),n=m()&&38<=t,r=y()&&31<=t,i=d(),o=v()&&9<=t,a=b()&&m()&&21<=t,s=g()&&11<=t,c=n||r||i||o||a||s,l=w()||u()&&h()&&x();return c=(c=c&&!l)||/anybrowser=(true|1)/.test(window.location.href),E||(G.log("Browser: "+A()+" "+e+" on "+k()),c||G.tickEvent("browser.unsupported",{useragent:navigator.userAgent}),E=!0),c},f.devicePixelRatio=function(){return"undefined"!=typeof window&&window.screen?void 0!==window.screen.systemXDPI&&void 0!==window.screen.logicalXDPI&&window.screen.systemXDPI>window.screen.logicalXDPI?window.screen.systemXDPI/window.screen.logicalXDPI:window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1:1},f.browserDownloadBinText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),U(ts.pxtc.encodeBase64(e),t,n,r,i)},f.browserDownloadText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),U(ts.pxtc.encodeBase64(G.Util.toUTF8(e)),t,n,r,i)},f.isBrowserDownloadInSameWindow=C,f.isBrowserDownloadWithinUserContext=function(){var e=T(),t=parseInt(e||"0");return p()&&v()&&11<=t||/downloadUserContext=1/i.test(window.location.href)},f.browserDownloadDataUri=l,f.browserDownloadUInt8Array=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),U(ts.pxtc.encodeBase64(G.Util.uint8ArrayToString(e)),t,n,r,i)},f.toDownloadDataUri=_,f.browserDownloadBase64=U,f.loadImageAsync=S,f.loadCanvasAsync=function(e){return S(e).then(function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t})},f.imageDataToPNG=function(e){if(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t.toDataURL("image/png")}},f.resolveCdnUrl=P,f.loadStyleAsync=function(e,t){t&&(e="rtl"+e);var r="style-"+e;if(document.getElementById(r))return Promise.resolve();var i=P(e),n=G.Util.toArray(document.head.getElementsByTagName("link")).filter(function(e){return e.getAttribute("href")==i})[0];return n?(n.id||(n.id=r),Promise.resolve()):new Promise(function(e,t){var n=document.createElement("link");n.href=i,n.rel="stylesheet",n.type="text/css",n.id=r,n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(e){return t(e)}),document.head.appendChild(n)})};var O,I={};function N(e,t){return e?t?(e.indexOf("/")==e.length-1?e.substring(0,e.length-1):e)+"/"+(0==t.indexOf("/")?t.substring(1):t):e:t}function F(){var e=t()&&window.navigator;return e&&e.storage&&e.storage.estimate?e.storage.estimate():Promise.resolve({})}f.loadScriptAsync=function(e){var r=P(e),t=I[r];return t||(t=I[r]=new Promise(function(e,t){G.debug("script: loading "+r);var n=document.createElement("script");n.type="text/javascript",n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(e){delete I[r],t(e)}),n.src=r,n.async=!0,document.body.appendChild(n)})),t},f.loadAjaxAsync=function(r){return new Promise(function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(200==n.status?e(n.responseText):t(n.status))},n.open("GET",r,!0),n.send()})},f.loadBlocklyAsync=function(){if(!O){G.debug("blockly: delay load");var e=G.BrowserUtils.loadStyleAsync("blockly.css",ts.pxtc.Util.isUserLanguageRtl());"undefined"==typeof Blockly&&(e=e.then(function(){return G.BrowserUtils.loadScriptAsync("pxtblockly.js")})),e=e.then(function(){G.debug("blockly: loaded")}),O=e}return O},f.patchCdn=function(e){if(!e)return e;var t=G.getOnlineCdnUrl();return t?e.replace("@cdnUrl@",t):e.replace(/@cdnUrl@\/(blob|commit)\/[a-f0-9]{40}\//,"./")},f.initTheme=function(){var e=G.appTarget.appTheme;if(e&&e.accentColor){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(".ui.accent { color: "+e.accentColor+"; }\n                .ui.inverted.menu .accent.active.item, .ui.inverted.accent.menu  { background-color: "+e.accentColor+"; }")),document.getElementsByTagName("head")[0].appendChild(t)}if(G.Util.isUserLanguageRtl()){G.debug("rtl layout"),G.BrowserUtils.addClass(document.body,"rtl"),document.body.style.direction="rtl";var n=G.Util.toArray(document.head.getElementsByTagName("link")),r=n.filter(function(e){return G.Util.endsWith(e.getAttribute("href"),"semantic.css")})[0];if(r){var i=r.getAttribute("data-rtl");i&&(G.debug("swapping to "+i),r.setAttribute("href",i))}var o=n.filter(function(e){return G.Util.endsWith(e.getAttribute("href"),"blockly.css")})[0];if(o){var a=o.getAttribute("data-rtl");a&&(G.debug("swapping to "+a),o.setAttribute("href",a),o.removeAttribute("data-rtl"))}}},f.changeHash=function(e,t){"#"!=e.charAt(0)&&(e="#"+e),t?window.location.hash=e:window.history.replaceState("","",e)},f.urlJoin=N,f.joinURLs=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(t)for(var r=0;r<t.length;r++)e=N(e,t[r]);return e},f.storageEstimateAsync=F,f.scheduleStorageCleanup=t()&&navigator.storage&&navigator.storage.estimate?ts.pxtc.Util.throttle(function(){F().then(function(e){return G.debug("storage estimate: "+(e.usage/e.quota*100>>0)+"%, "+(e.usage/1e6>>0)+"/"+(e.quota/1e6>>0)+"Mb"),e.quota&&e.usage&&1e6<e.quota&&.9<e.usage/e.quota?(G.log("quota usage exceeded, clearing translations"),G.tickEvent("storage.cleanup"),j()):Promise.resolve()}).catch(function(e){G.reportException(e)})},1e4,!1):function(){},f.stressTranslationsAsync=function t(){for(var n="...",e=0;e<16;++e)n+=n+Math.random();return console.log("adding entry "+2*n.length+" bytes"),Promise.delay(1).then(function(){return B()}).then(function(e){return e.setAsync("foobar",Math.random().toString(),"",null,void 0,n)}).then(function(){return G.BrowserUtils.storageEstimateAsync()}).then(function(e){return!e.quota||e.usage/e.quota<.8?t():Promise.resolve()})};var L=function(){function e(){this.translations={}}return e.prototype.key=function(e,t,n){return e+"|"+t+"|"+(n||"master")},e.prototype.get=function(e,t,n){return this.translations[this.key(e,t,n)]},e.prototype.getAsync=function(e,t,n){return Promise.resolve(this.get(e,t,n))},e.prototype.set=function(e,t,n,r,i,o,a){this.translations[this.key(e,t,n)]={etag:r,time:i,strings:o,md:a}},e.prototype.setAsync=function(e,t,n,r,i,o){return this.set(e,t,n,r,G.Util.now(),i),Promise.resolve()},e.prototype.clearAsync=function(){return this.translations={},Promise.resolve()},e}(),R=function(){function e(e,t,n,r){this.name=e,this.version=t,this.upgradeHandler=n,this.quotaExceededHandler=r}return e.prototype.throwIfNotOpened=function(){if(!this._db)throw new Error("Database not opened; call IDBWrapper.openAsync() first")},e.prototype.errorHandler=function(e,t,n){console.error(new Error(this.name+" IDBWrapper error for "+t+": "+e.message)),n(e),"QuotaExceededError"==e.name&&(G.log("storage quota exceeded..."),G.tickEvent("storage.quotaexceedederror"),this.quotaExceededHandler&&this.quotaExceededHandler())},e.prototype.getObjectStore=function(e,t){return void 0===t&&(t="readonly"),this.throwIfNotOpened(),this._db.transaction([e],t).objectStore(e)},e.deleteDatabaseAsync=function(r){return new Promise(function(e,t){var n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).deleteDatabase(r);n.onsuccess=function(){return e()},n.onerror=function(){return t(n.error)}})},e.prototype.openAsync=function(){var r=this;return new Promise(function(e,t){var n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(r.name,r.version);n.onsuccess=function(){r._db=n.result,e()},n.onerror=function(){return r.errorHandler(n.error,"open",t)},n.onupgradeneeded=function(e){return r.upgradeHandler(e,n)}})},e.prototype.getAsync=function(r,i){var o=this;return new Promise(function(e,t){var n=o.getObjectStore(r).get(i);n.onsuccess=function(){return e(n.result)},n.onerror=function(){return o.errorHandler(n.error,"get",t)}})},e.prototype.getAllAsync=function(i){var o=this;return new Promise(function(e,t){var n=o.getObjectStore(i).openCursor(),r=[];n.onsuccess=function(){n.result?(r.push(n.result.value),n.result.continue()):e(r)},n.onerror=function(){return o.errorHandler(n.error,"getAll",t)}})},e.prototype.setAsync=function(i,o){var a=this;return new Promise(function(e,t){var n,r=a.getObjectStore(i,"readwrite");(n=void 0!==o.id&&null!==o.id?r.put(o):r.add(o)).onsuccess=function(){return e()},n.onerror=function(){return a.errorHandler(n.error,"set",t)}})},e.prototype.deleteAsync=function(r,i){var o=this;return new Promise(function(e,t){var n=o.getObjectStore(r,"readwrite").delete(i);n.onsuccess=function(){return e()},n.onerror=function(){return o.errorHandler(n.error,"delete",t)}})},e.prototype.deleteAllAsync=function(r){var i=this;return new Promise(function(e,t){var n=i.getObjectStore(r,"readwrite").clear();n.onsuccess=function(){return e()},n.onerror=function(){return i.errorHandler(n.error,"deleteAll",t)}})},e}();f.IDBWrapper=R;var D,M=function(){function u(e){this.db=e,this.mem=new L}return u.dbName=function(){return"__pxt_translations_"+(G.appTarget.id||"")},u.createAsync=function(){function t(){var e=new R(u.dbName(),2,function(e,t){t.result.createObjectStore(u.TABLE,{keyPath:u.KEYPATH})},function(){j().catch(function(e){})});return e.openAsync().then(function(){return new u(e)})}return t().catch(function(e){return console.log("db: failed to open database, try delete entire store..."),R.deleteDatabaseAsync(u.dbName()).then(function(){return t()})})},u.prototype.getAsync=function(t,n,r){var i=this;t=(t||"en-US").toLowerCase();var e=this.mem.key(t,n,r),o=this.mem.get(t,n,r);return o?Promise.resolve(o):this.db.getAsync(u.TABLE,e).then(function(e){return e?(i.mem.set(t,n,r,e.etag,e.time,e.strings),Promise.resolve(e)):Promise.resolve(void 0)}).catch(function(e){return Promise.resolve(void 0)})},u.prototype.setAsync=function(e,t,n,r,i,o){var a=this;e=(e||"en-US").toLowerCase();var s=this.mem.key(e,t,n),c=G.Util.now();this.mem.set(e,t,n,r,c,i,o),i&&Object.keys(i).filter(function(e){return!i[e]}).forEach(function(e){return delete i[e]});var l={id:s,etag:r,time:c,strings:i,md:o};return this.db.setAsync(u.TABLE,l).finally(function(){return f.scheduleStorageCleanup()}).catch(function(e){return console.log("db: set failed ("+e.message+"), recycling..."),a.clearAsync()})},u.prototype.clearAsync=function(){return this.db.deleteAllAsync(u.TABLE).then(function(){return console.debug("db: all clean")}).catch(function(e){console.error("db: failed to delete all")})},u.TABLE="files",u.KEYPATH="id",u}();function B(){return G.Util.isNodeJS?Promise.resolve(new L):(D||(D=M.createAsync().catch(function(){return new L})),D)}function j(){function t(){var t=M.dbName();return R.deleteDatabaseAsync(t).then(function(){D=void 0}).catch(function(e){G.log("db: failed to delete "+t),D=void 0})}return D?D.then(function(e){return e.clearAsync()}).catch(function(e){return t().done()}):t()}function H(){var e=new RegExp(G.Util.escapeForRegex(G.Util.pxtLangCookieId)+"=(.*?)(?:;|$)").exec(document.cookie);return e&&e[1]||null}f.translationDbAsync=B,f.clearTranslationDbAsync=j,f.pointerEvents=c()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:r()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},f.popupWindow=function(t,e,n,r){try{var i=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,c=a/2-n/2+i,l=s/2-r/2+o,u=window.open(t,e,"width="+n+", height="+r+", top="+l+", left="+c);return u.focus&&u.focus(),u}catch(e){return G.tickEvent("pxt.popupError",{url:t,msg:e.message}),null}},f.containsClass=function(t,e){return e.split(/\s+/).every(function(e){return function(e,t){if(e.classList)return e.classList.contains(t);var n=(e.className+"").split(/\s+/);return!(n.indexOf(t)<0)}(t,e)})},f.addClass=function(t,e){e.split(/\s+/).forEach(function(e){return function(e,t){if(e.classList)e.classList.add(t);else{var n=(e.className+"").split(/\s+/);n.indexOf(t)<0&&(e.className.baseVal+=" "+t)}}(t,e)})},f.removeClass=function(r,e){e.split(/\s+/).forEach(function(e){return n=e,void((t=r).classList?t.classList.remove(n):t.className.baseVal=(t.className+"").split(/\s+/).filter(function(e){return e!=n}).join(" "));var t,n})},f.getCookieLang=H,f.setCookieLang=function(e,t){if(void 0===t&&(t=!1),G.Util.allLanguages[e]&&e!==H()){G.tickEvent("menu.lang.setcookielang",{lang:e,docs:""+t});var n=new Date;n.setTime(n.getTime()+24*G.Util.langCookieExpirationDays*60*60*1e3),document.cookie=G.Util.pxtLangCookieId+"="+e+"; expires="+n.toUTCString()}}}(G.BrowserUtils||(G.BrowserUtils={}))}(pxt||(pxt={})),function(e){var n;(n=e.commands||(e.commands={})).deployCoreAsync=void 0,n.deployFallbackAsync=void 0,n.hasDeployFn=function(){return n.deployCoreAsync||n.deployFallbackAsync},n.deployAsync=function(e,t){return(n.deployCoreAsync||n.deployFallbackAsync)(e,t)},n.patchCompileResultAsync=void 0,n.browserDownloadAsync=void 0,n.saveOnlyAsync=void 0,n.showUploadInstructionsAsync=void 0,n.saveProjectAsync=void 0,n.electronDeployAsync=void 0,n.webUsbPairDialogAsync=void 0,n.onTutorialCompleted=void 0}(pxt||(pxt={})),function(i){function e(){var e;return e||(e=i.U.isNodeJS?Promise.resolve(require("lzma")):Promise.resolve(window.LZMA)).then(function(e){return e||i.reportError("lzma","failed to load"),e}),e}i.lzmaDecompressAsync=function(r){return e().then(function(t){return new Promise(function(n,e){try{t.decompress(r,function(e,t){t&&i.debug("lzma decompression failed"),n(t?void 0:e)})}catch(e){e&&i.debug("lzma decompression failed"),n(void 0)}})})},i.lzmaCompressAsync=function(r){return e().then(function(t){return new Promise(function(n,e){try{t.compress(r,7,function(e,t){t&&i.reportException(t),n(t?void 0:new Uint8Array(e))})}catch(e){i.reportException(e),n(void 0)}})})}}(pxt||(pxt={})),function(Ue){!function(e){var we=pxtc.Util,xe=we.lf;var ke,Ae,Te={"pxt::mkAction":1,"pxt::dumpPerfCounters":1,"pxt::deepSleep":1,"pxt::getConfig":1,"pxtrt::mkMap":1,"pxtrt::mapSet":1,"pxtrt::stclo":1,"pxtrt::mklocRef":1,"pxtrt::stlocRef":1,"pxtrt::ldlocRef":1,"pxtrt::panic":1};function Ee(n){void 0===n&&(n="namespace");var r="",i="",e=function(e,t){void 0===t&&(t=""),i!=e&&(i&&(r+="}\n"),e&&(r+=t||n+" "+e+" {\n"),i=e)},t="    ";return{setNs:e,clear:function(){i=r=""},write:function(e){e.trim()?(e=e.trim().replace(/^\s*/gm,t).replace(/^(\s*)\*/gm,function(e,t){return t+" *"}),r+=e+"\n"):r+="\n"},incrIndent:function(){t+="    "},decrIndent:function(){t=t.slice(4)},finish:function(){return e(""),r}}}function Ce(e){if(!e)return null;e=e.trim();var t=/^\((.*)\)/.exec(e);return t&&(e=t[1]),/^-?(\d+|0[xX][0-9a-fA-F]+)$/.test(e)?parseInt(e):null}e.nsWriter=Ee,e.parseCppInt=Ce;var _e=function(n){function e(e){var t=n.call(this,e)||this;return t.isUserError=!0,t.message=e,t}return __extends(e,n),e}(Error);function l(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e[n];t+=37==r||127<r?"%"+r.toString(16):String.fromCharCode(r)}return decodeURIComponent(t)}function u(e){for(var t="",n=0;n<e.length;n+=2)t=e[n]+e[n+1]+t;return Ue.Util.assert(n==e.length),t}function o(e){var t=[65,20,14,47,184,47,162,187];e:for(var n=0;n<e.length;n+=16)if(e[n]==t[0]){for(var r=0;r<t.length;++r)if(e[n+r]!=t[r])continue e;var i=e[n+8]|e[n+9]<<8,o=e[n+10]|e[n+11]<<8|e[n+12]<<16|e[n+13]<<24,a=(n+=16)+i+o;if(!(a>e.length)){var s=e.slice(n,n+i),c=e.slice(n+i,a);return{meta:l(s),text:c}}}return null}function t(e){function t(e){return Ue.debug(e),Promise.reject(new Error(e))}var n;if(Ue.HF2.read32(e,0)==ts.pxtc.UF2.UF2_MAGIC_START0){var r=ts.pxtc.UF2.toBin(e);r&&(n=o(r.buf))}(1179403647==Ue.HF2.read32(e,0)&&(n=o(e)),58==e[0])&&(n=function(e){if(e){var r,i=0,o=0,a=0,s=0;if(e.split(/\r?\n/).forEach(function(e){var t=/^:10....0041140E2FB82FA2BB(....)(....)(....)(....)(..)/.exec(e);if(t)i=parseInt(u(t[1]),16),o=parseInt(u(t[2]),16),a=i+o,r=new Uint8Array(a);else if(0<a){if(!(t=/^:10....00(.*)(..)$/.exec(e)))return;for(var n=t[1];0<a&&0<n.length;)r[s++]=parseInt(n[0]+n[1],16),n=n.slice(2),a--}}),r&&0==a&&s==r.length){for(var t=new Uint8Array(i),n=new Uint8Array(o),c=0;c<i;++c)t[c]=r[c];for(c=0;c<o;++c)n[c]=r[i+c];return{meta:l(t),text:n}}}}(l(e)||""));if(!n||!n.meta||!n.text)return t("This .hex file doesn't contain source.");var i=JSON.parse(n.meta);return i?"LZMA"==i.compression?Ue.lzmaDecompressAsync(n.text).then(function(e){if(!e)return null;var t=e.slice(0,i.headerSize||i.metaSize||0),n=e.slice(t.length);return t&&Ue.Util.jsonCopyFrom(i,JSON.parse(t)),{meta:i,source:n}}):i.compression?t("Compression type "+i.compression+" not supported."):Promise.resolve({source:l(n.text)}):t("This .hex file is not valid.")}e.PkgConflictError=_e,e.getExtensionInfo=function(c){for(var e={},t="dal.d.ts",l="/source/",n=c.sortedDeps(!0),r=0,i=n;r<i.length;r++)(ne=i[r]).addSnapshot(e,[t,".h",".cpp"]);if(Ae&&we.stringMapEq(e,Ae))return Ue.debug("Using cached extinfo"),ke;Ue.debug("Generating new extinfo");var U=pxtc.emptyExtInfo(),o=Ue.appTarget.compileService;o||(o={gittag:"none",serviceId:"nocompile"}),o=we.clone(o);var a=Ue.appTarget.compile;a||(a={isNative:!1,hasHex:!1,switches:{}});var s=!!o.platformioIni,u="codal"==o.buildEngine||"dockercodal"==o.buildEngine,f="dockermake"==o.buildEngine||"dockercross"==o.buildEngine,S=!s&&!u&&!f,P=a.nativeType==pxtc.NATIVE_TYPE_VM;s?l="/src/":(u||f)&&(l="/pxtapp/");var p="// Configuration defines\n",O="\nPXT_SHIMS_BEGIN\n",I="",N="",h='#include "pxt.h"\n',d="",F=function(e){return d+="   "+g+"("+L+"): "+e+"\n"},L=0,g="",R=Ee("namespace"),D=Ee("declare namespace"),M=Ee("declare namespace"),m="",B={},j={},H={true:"1",false:"0",null:"0",NULL:"0"};function G(e){return e.trim().replace(/[\_\*]$/,"")}for(var v="",y=0,b=n;y<b.length;y++){if(0<=(ne=b[y]).getFiles().indexOf(t)){var w=ne.host().readFile(ne,t);Ue.Util.assert(!!w,t+" not found in "+ne.id),w.split(/\r?\n/).forEach(function(e){var t=/^\s*(\w+) = (.*),/.exec(e);t&&(H[t[1]]=t[2])})}!v&&0<=ne.getFiles().indexOf("Makefile")&&(v=ne.host().readFile(ne,"Makefile"))}var x=["0","false","PXT_UTF8"],z={};function V(e){return e.replace(/\/\/.*/,"").replace(/\/\*/,"")}a.switches.boxDebug&&(z.PXT_BOX_DEBUG=1),a.gc&&(z.PXT_GC=1),a.utf8&&(z.PXT_UTF8=1),a.switches.profile&&(z.PXT_PROFILE=1),a.switches.gcDebug&&(z.PXT_GC_DEBUG=1),a.switches.numFloat&&(z.PXT_USE_FLOAT=1),a.vtableShift&&(z.PXT_VTABLE_SHIFT=a.vtableShift),a.nativeType==pxtc.NATIVE_TYPE_VM&&(z.PXT_VM=1);var q=0,J=!1,$="",W="",X="",Y=!1;function K(){D.setNs(""),D.write(""),D.write(""),(X||W)&&(D.write(W),D.write(X),W=X="")}function k(e,k){var A;X=W=$="",Y=!1;var T=-1;function E(){var e=$.replace(/Methods$/,"");return e==$?null:e}function C(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int32_t":case"int":return"int32";case"uint32_t":case"unsigned":return"uint32";case"TNumber":case"float":case"double":return"number";case"uint16_t":return"uint16";case"int16_t":case"short":return"int16";case"uint8_t":case"byte":return"uint8";case"int8_t":case"sbyte":return"int8";case"bool":return a.shortPointers&&F("use 'boolean' not 'bool' on 8 bit targets"),"boolean";case"StringData*":case"String":case"ImageLiteral_":case"ImageLiteral":return"string";case"Action":return"() => void";case"TValue":return"any";default:return G(e)}}function _(e){switch(e=e.replace(/\s+/g,"")){case"int32_t":case"uint32_t":case"unsigned":case"uint16_t":case"int16_t":case"short":case"uint8_t":case"byte":case"int8_t":case"sbyte":case"int":case"ramint_t":return"I";case"void":return"V";case"float":return"F";case"TNumber":return"N";case"TValue":return"T";case"bool":return"B";case"double":return"D";case"ImageLiteral_":return"T";case"String":return"S";default:return we.lookup(B,e)?"I":"_"+e.replace(/[\*_]+$/,"")}}e=e.replace(/^(\s*#\s*if\s+(\w+)\s*$)([^]*?)(^\s*#\s*(elif|else|endif)\s*$)/gm,function(e,t,n,r,i){return 0<=x.indexOf(n)&&!z[n]?t+r.replace(/[^\n]/g,"")+i:e}),J=!1,q=L=0,M.setNs(""),D.setNs(""),e.split(/\r?\n/).forEach(function(e){++L;var t=V(e);!function(e){var t=V(e);if(J&&0<=t.indexOf("}")&&(J=!1,M.write("}")),J){var n=/^\s*(\w+)\s*(=\s*(.*?))?,?\s*$/.exec(t);if(n){var r=n[1],i=n[3],o="";if(i){i=i.trim();var a=we.lookup(H,i);null!=a&&(o="  // "+i,i=a),null==(q=Ce(i))&&F("cannot determine value of "+t)}else i=++q+"";M.write("    "+G(r)+" = "+i+","+o)}else M.write(e)}}(e);var n,r,i=/^\s*enum\s+(|class\s+|struct\s+)(\w+)\s*({|$)/.exec(t);if(i&&(n=i[2],r=i[3],J=!0,q=-1,M.write(""),M.write(""),(X||W)&&(M.write(W),M.write(X),W=X=""),M.write("declare const enum "+G(n)+" "+r),B[n]=!0,k||(R.setNs($),R.write("enum "+i[2]+" : int;"))),o=e,!J&&!(/^\s*\/\*\*/.test(o)?(Y=!0,W=o+"\n",/\*\//.test(o)&&(Y=!1),1):Y?(W+=o+"\n",/\*\//.test(o)&&(Y=!1),1):/^\s*\/\/%/.test(o)&&(X+=o+"\n",1))){var o;/^typedef.*;\s*$/.test(e)&&(R.setNs($),R.write(e));var a=/^\s*namespace\s+(\w+)/.exec(e);if(a)if($=a[1],E()){K();var s=E();D.setNs($,"declare interface "+s+" {")}else(X||W)&&(K(),D.setNs(G($)),M.setNs(G($)));else{if((a=/^PXT_ABI\((\w+)\)/.exec(e))&&!P&&(O+="PXT_FNPTR(::"+a[1]+"),\n",N+='extern "C" void '+a[1]+"();\n",U.functions.push({name:a[1],argsFmt:[],value:0})),(a=/^#define\s+PXT_COMM_BASE\s+([0-9a-fx]+)/.exec(e))&&(U.commBase=parseInt(a[1])),a=/^\s*(\w+)([\*\&]*\s+[\*\&]*)(\w+)\s*\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(e),!X||!a){if(a=/^\s*extern const (\w+) (\w+);/.exec(e),X&&a)return y={name:$+"::"+a[2],argsFmt:[],value:null},U.functions.push(y),P||(O+="PXT_FNPTR(&::"+y.name+"),\n"),void(X="");if(a=/^\s*(\w+)\s+(\w+)\s*;/.exec(e),X&&a){var c=pxtc.parseCommentString(X);c.indexedInstanceNS&&(A=c,D.setNs(c.indexedInstanceNS),T=0);var l=a[1],u=a[2];if(A)return X=X.trim(),X+=" fixedInstance shim="+A.indexedInstanceShim+"("+T+++")",D.write(""),D.write(W),D.write(X),D.write("const "+u+": "+C(l)+";"),void(X=W="")}return X&&e.trim()?(F("declaration not understood: "+e),void(W=X="")):void 0}A=null;var f=pxtc.parseCommentString(X);$||F("missing namespace declaration");var p=(a[1]+a[2]).replace(/\s+/g,""),h=a[3],d=a[4];X=X.trim().replace(/ \w+\.defl=\w+/g,"");var g=[_(p)],m=[],v=d.split(/,/).filter(function(e){return!!e}).map(function(e){var t=function(e,t){t=t.trim();var n=/(.*)=\s*(-?\w+)$/.exec(t),r="",i="";if(n&&(r=n[2],i="?",t=n[1].trim()),!(n=/^(.*?)(\w+)$/.exec(t)))return F("invalid argument: "+t),{name:"???",type:"int"};var o=n[2];e.paramDefl[o]&&(r=e.paramDefl[o],i="?");var a=r?we.lookup(H,r):null;return null!=a&&(r=a),r&&(null==Ce(r)&&F("Invalid default value (non-integer): "+r),X+=" "+o+".defl="+r),{name:o+i,type:n[1]}}(f,e);return g.push(_(t.type)),m.push(t.type.replace(/ /g,"")),t.name+": "+C(t.type)}),y={name:$+"::"+h,argsFmt:g,value:null};if(W)if(D.setNs(G($)),D.write(""),D.write(W),/ImageLiteral/.test(a[4])&&!/imageLiteral=/.test(X)&&(X+=" imageLiteral=1"),X+=" shim="+y.name,D.write(X),h=G(h),E()){var b=(v[0]||"").replace(/^.*:\s*/,"").trim();b.toLowerCase()!=E().toLowerCase()&&F(xe("Invalid first argument; should be of type '{0}', but is '{1}'",E(),b)),v.shift(),0==v.length&&/\bproperty\b/.test(X)?D.write(h+": "+C(p)+";"):D.write(h+"("+v.join(", ")+"): "+C(p)+";")}else D.write("function "+h+"("+v.join(", ")+"): "+C(p)+";");if(X=W="",k||(R.setNs($),R.write(p+" "+h+"("+d+");")),U.functions.push(y),S)O+="(uint32_t)(void*)::"+y.name+",\n";else if(P){if(we.startsWith(y.name,"pxt::op_")||Te[y.name]||f.expose||!we.startsWith(y.name,"pxt::")&&!we.startsWith(y.name,"pxtrt::")){var w=function(e,t){if("FiberContext*"==t[0])return"::"+e.name;var n="_wrp_"+e.name.replace(/:/g,"_");if(j[e.name])return n;j[e.name]=!0,I+="\nvoid "+n+"(FiberContext *ctx) {\n";for(var r=t.length,i=[],o=!1,a="",s=0;s<r;++s){var c=e.argsFmt[s+1],l=t[s],u="I"==c?"toInt":"B"==c?"numops::toBool":"",f=s==r-1?"ctx->r0":"ctx->sp["+(r-s-2)+"]",p="";switch(l){case"TValue":case"TNumber":break;case"Action":u="asRefAction";break;case"String":u="convertToString",p="ctx, ",o=!0;break;default:u||(u="as"+l.replace(/\*/g,""))}a+="  "+l+" a"+s+" = ("+l+") "+u+"("+p+f+");\n",i.push("a"+s)}o&&(I+="  auto prevSP = ctx->sp;\n"),I+=a,o&&(I+="  if (panicCode) { ctx->sp = prevSP; return; }\n");var h="::"+e.name+"("+i.join(", ")+")";return"V"==e.argsFmt[0]?(I+="  "+h+";\n",I+="  ctx->r0 = NULL;\n"):"I"==e.argsFmt[0]?I+="  ctx->r0 = fromInt("+h+");\n":"B"==e.argsFmt[0]?I+="  ctx->r0 = fromBool("+h+");\n":I+="  ctx->r0 = (TValue)"+h+";\n",o&&(I+="  ctx->sp = prevSP;\n"),1<r&&(I+="  ctx->sp += "+(r-1)+";\n"),I+="}\n",n}(y,m),x=y.argsFmt.length-1;O+='{ "'+y.name+'", (OpFun)'+w+", "+x+" },\n"}}else O+="PXT_FNPTR(::"+y.name+"),\n"}}})}var A=we.clone(o.yottaConfig||{}),T={},E={};if(S&&a.hasHex){var C=o;we.assert(!!C.yottaCorePackage),we.assert(!!C.githubCorePackage),we.assert(!!C.gittag);var _=C.githubCorePackage+"#"+o.gittag;U.yotta.dependencies[C.yottaCorePackage]=_}if(c)for(var Q=!1,Z=function(e){d="",function(e){var t=e.config.platformio;t&&t.dependencies&&we.jsonCopyFrom(U.platformio.dependencies,t.dependencies),U.npmDependencies&&e.config.npmDependencies&&we.jsonCopyFrom(U.npmDependencies,e.config.npmDependencies);var n=e.config.yotta;if(n){if(n.dependencies&&we.jsonCopyFrom(U.yotta.dependencies,n.dependencies),n.config)for(var r=we.jsonFlatten(n.config),i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=we.lookup(E,a),c=r[a];if(!s||s.config.yotta.configIsJustDefaults)E[a]=e,A[a]=c;else if(A[a]===c);else if(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts){var l=new _e(xe("conflict on yotta setting {0} between extensions {1} and {2}",a,e.id,s.id));throw l.pkg0=s,l.pkg1=e,l.settingName=a,l}}if(n.optionalConfig){r=we.jsonFlatten(n.optionalConfig);for(var u=0,f=Object.keys(r);u<f.length;u++)c=r[a=f[u]],T[a]=c}}}(e),e==c?(Q=!0,D.clear(),M.clear()):we.assert(!Q);for(var t=function(e){return we.endsWith(e,".h")},n=0,r=e.getFiles().filter(t).concat(e.getFiles().filter(function(e){return!t(e)}));n<r.length;n++){var i=r[n],o=t(i);if(o||we.endsWith(i,".cpp")){var a=e.config.name+"/"+i;("base"==e.config.name||/^core($|---)/.test(e.config.name))&&o&&(a=i),o&&(h+='#include "'+(S?l.slice(1):"")+a+'"\n'),null==(s=e.readFile(i))&&we.userError(xe("C++ file {0} is missing in extension {1}.",i,e.config.name)),g=a,Ue.debug("Parse C++: "+a),k(s,o),U.extensionFiles[l+a]=s,0==e.level&&(U.onlyPublic=!1),e.verProtocol()&&"pub"!=e.verProtocol()&&"embed"!=e.verProtocol()&&(U.onlyPublic=!1)}if(we.endsWith(i,".c")||we.endsWith(i,".S")||we.endsWith(i,".s")){var s=e.readFile(i);U.extensionFiles[l+e.config.name+"/"+i.replace(/\.S$/,".s")]=s}}d&&(m+=xe("Extension {0}:\n",e.id)+d)},ee=0,te=n;ee<te.length;ee++){var ne;Z(ne=te[ee])}m&&we.userError(m),we.jsonCopyFrom(T,A),we.iterMap(T,function(e,t){null===t&&delete T[e]}),Object.keys(T).filter(function(e){return/-/.test(e)}).forEach(function(e){var t=T[e];delete T[e],T[e.replace(/-/g,"_")]=t}),!S&&o.yottaConfigCompatibility&&Object.keys(T).forEach(function(e){return T["YOTTA_CFG_"+e]=T[e]});var re=we.jsonUnFlatten(T);if(f){var ie={name:"pxt-app",private:!0,dependencies:U.npmDependencies};U.generatedFiles["/package.json"]=JSON.stringify(ie,null,4)+"\n"}else if(u){C=o;var oe=we.clone(C.codalDefinitions)||{},ae=C.codalTarget;"string"==typeof ae&&(ae+=".json");var se={target:ae,definitions:oe,config:oe,application:"pxtapp",output_folder:"build",pxt_gitrepo:C.githubCorePackage,pxt_gittag:C.gittag};we.iterMap(we.jsonFlatten(re),function(e,t){e=e.replace(/^codal\./,"device.").toUpperCase().replace(/\./g,"_"),oe[e]=t}),U.generatedFiles["/codal.json"]=JSON.stringify(se,null,4)+"\n",Ue.debug("codal.json: "+U.generatedFiles["/codal.json"])}else if(s){var ce=o.platformioIni.slice();ce.push("lib_deps ="),we.iterMap(U.platformio.dependencies,function(e,t){var n=/[@#\/]/.test(t)?t:e+"@"+t;ce.push("  "+n)}),U.generatedFiles["/platformio.ini"]=ce.join("\n")+"\n"}else{U.yotta.config=re;var le="pxt-app";o.yottaBinary&&(le=o.yottaBinary.replace(/-combined/,"").replace(/\.hex$/,""));var ue={name:le,version:"0.0.0",description:"Auto-generated. Do not edit.",license:"n/a",dependencies:U.yotta.dependencies,targetDependencies:{},bin:"./source"};U.generatedFiles["/module.json"]=JSON.stringify(ue,null,4)+"\n",Ue.debug("module.json: "+U.generatedFiles["/module.json"])}for(var fe=0,pe=Object.keys(z);fe<pe.length;fe++){var he=pe[fe];p+="#define "+he+" "+z[he]+"\n"}if(a.uf2Family&&(p+="#define PXT_UF2_FAMILY "+a.uf2Family+"\n"),U.generatedFiles[l+"pointers.cpp"]=h+R.finish()+N+I+O+"\nPXT_SHIMS_END\n",U.generatedFiles[l+"pxtconfig.h"]=p,Ue.debug("pxtconfig.h: "+U.generatedFiles[l+"pxtconfig.h"]),S&&(U.generatedFiles["/config.json"]=JSON.stringify(re,null,4)+"\n",Ue.debug("yotta config.json: "+U.generatedFiles["/config.json"])),U.generatedFiles[l+"main.cpp"]='\n#include "pxt.h"\n#ifdef PXT_MAIN\nPXT_MAIN\n#else\nint main() {\n    uBit.init();\n    pxt::start();\n    release_fiber();\n    return 0;   // your program will never reach this line.\n}\n#endif\n',v){var de=Object.keys(U.extensionFiles).concat(Object.keys(U.generatedFiles)),ge="",me=function(e,t){var n=de.filter(function(e){return we.endsWith(e,t)}).map(function(e){return e.slice(1)});ge+=e+" = "+n.join(" ")+"\n"};me("PXT_C",".c"),me("PXT_CPP",".cpp"),me("PXT_S",".s"),me("PXT_HEADERS",".h"),ge+="PXT_SOURCES := $(PXT_C) $(PXT_S) $(PXT_CPP)\n",ge+="PXT_OBJS := $(addprefix bld/, $(PXT_C:.c=.o) $(PXT_S:.s=.o) $(PXT_CPP:.cpp=.o))\n",U.generatedFiles["/Makefile"]=v,U.generatedFiles["/Makefile.inc"]=ge}U.generatedFiles["/functions.json"]=JSON.stringify(U.functions,null,1);var ve=U.extensionFiles;we.jsonCopyFrom(ve,U.generatedFiles);var ye={config:o.serviceId,tag:o.gittag,replaceFiles:ve,dependencies:S?U.yotta.dependencies:null},be=JSON.stringify(ye);return U.sha=we.sha256(be),U.skipCloudBuild=!!o.skipCloudBuild,U.compileData=ts.pxtc.encodeBase64(we.toUTF8(be)),U.shimsDTS=D.finish(),U.enumsDTS=M.finish(),Ae=e,ke=U},e.unpackSourceFromHexFileAsync=function(e){if(e)return Ue.Util.fileReadAsBufferAsync(e).then(function(e){return t(new Uint8Array(e))})},e.unpackSourceFromHexAsync=t}(Ue.cpp||(Ue.cpp={}))}(pxt||(pxt={})),function(d){!function(a){var s,c={};function o(e){var t,o,n,r,i;return c.hasOwnProperty(e.sha)||(c[e.sha]=(t=e,o="",a.showLoading(d.U.lf("Compiling (this may take a minute)...")),(n=t,n.skipCloudBuild?Promise.resolve({hex:["SKIP"]}):d.webConfig&&d.webConfig.isStatic?d.Util.requestAsync({url:d.webConfig.cdnUrl+"hexcache/"+n.sha+".hex"}).then(function(e){if(e.text){var t={enums:[],functions:[],hex:e.text.split(/\r?\n/)};return Promise.resolve(t)}return d.log("Hex info not found in bundled hex cache"),Promise.resolve()}).catch(function(e){return d.log("Error fetching hex info from bundled hex cache"),Promise.resolve()}):d.Cloud.localToken&&window&&d.BrowserUtils.isLocalHost()?(r="compile/"+n.sha,d.Cloud.localRequestAsync(r,i).then(function(e){return e.json})).then(function(e){return e&&!e.notInOfflineCache&&e.hex?(e.hex=e.hex.split(/\r?\n/),e):Promise.resolve(void 0)}).catch(function(e){return Promise.resolve(void 0)}):Promise.resolve(void 0)).then(function(e){return e||function(){if(s)return s;var e=d.getOnlineCdnUrl();if(e)return s=Promise.resolve(e);var t=d.webConfig&&d.webConfig.isStatic;return s=d.Cloud.privateGetAsync("clientconfig",t).then(function(e){return e.primaryCdnUrl})}().then(function(e){return o=e+"/compile/"+t.sha,d.U.httpGetTextAsync(o+".hex")}).then(function(e){return e},function(e){return d.Cloud.privatePostAsync("compile/extension",{data:t.compileData}).then(function(i){return new Promise(function(n,e){var r=function(){var t=i.hex.replace(/\.hex/,".json");return d.log("polling C++ build "+t),d.Util.httpGetJsonAsync(t).then(function(e){d.log("build log "+t.replace(/\.json$/,".log")),e.success?(d.log("fetching "+o+".hex"),n(d.U.httpGetTextAsync(o+".hex"))):(d.log("build failed"),e.mbedresponse&&e.mbedresponse.result&&e.mbedresponse.result.exception&&d.log(e.mbedresponse.result.exception),n(null))},function(e){return setTimeout(r,1e3),null})};r()})})}).then(function(e){return a.hideLoading(),{hex:e&&e.split(/\r?\n/)}})}).finally(function(){a.hideLoading()}))),c[e.sha]}function l(r,i,o,e,a){return void 0===a&&(a=10),r.cacheStoreAsync(o,e).then(function(){return r.cacheGetAsync(i)}).then(function(e){var t;try{t=JSON.parse(e||"[]")}catch(e){console.error("invalid cache entry, clearing entry"),t=[]}(t=t.filter(function(e){return e!=o})).unshift(o);var n=t.slice(a);return t=t.slice(0,a),Promise.map(n,function(e){return r.cacheStoreAsync(e,null)}).then(function(){return r.cacheStoreAsync(i,JSON.stringify(t))})})}function u(n,r,i){return n.cacheGetAsync(r).then(function(e){var t;try{t=JSON.parse(e||"[]")}catch(e){return console.error("invalid cache entry, clearing entry"),n.cacheStoreAsync(r,"[]")}return t[0]!=i?((t=t.filter(function(e){return e!=i})).unshift(i),n.cacheStoreAsync(r,JSON.stringify(t))):null})}a.showLoading=function(e){},a.hideLoading=function(){},a.storeWithLimitAsync=l,a.recordGetAsync=u,a.getHexInfoAsync=function(r,n,e){if(!n.sha)return Promise.resolve(null);if(pxtc.hex.isSetupFor(n))return Promise.resolve(pxtc.hex.currentHexInfo);d.debug("get hex info: "+n.sha);var i="hex-"+n.sha;return r.cacheGetAsync(i).then(function(e){var t;try{t=e?JSON.parse(e):null}catch(e){console.log("invalid cache entry, clearing entry"),t=null}return t&&t.hex?(d.debug("cache hit, size="+e.length),t.hex=function(e){for(var t=[],n=0;n<e.length;n++){var r=/^([@!])(....)$/.exec(e[n]);if(r){var i=parseInt(r[2],16),o=e[++n],a="";if("@"==r[1]){a="";for(var s=parseInt(o,16);0<s--;)a+="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"}else a=ts.pxtc.decodeBase64(o);d.Util.assert(0<a.length),d.Util.assert(a.length%16==0);for(var c=0;c<a.length;){var l=[16,i>>8&255,255&i,0];i+=16;for(var u=0;u<16;++u)l.push(a.charCodeAt(c++));for(var f=0,u=0;u<l.length;++u)f+=l[u];l.push(255&-f);for(var p=":",u=0;u<l.length;++u){var h=255&l[u];h<=15&&(p+="0"),p+=h.toString(16)}t.push(p.toUpperCase())}}else t.push(e[n])}return t}(t.hex),u(r,"hex-keys",i).then(function(){return t})):o(n).then(function(e){var t=e.hex;e.hex=function(e){for(var t=[],n=0,r=0;r<e.length;r+=n){var i=-1,o="";n=0;for(var a=!1;n<500;){var s=/^:10(....)00(.{32})(..)$/.exec(e[r+n]);if(!s)break;var c=s[2],l=/^0+$/.test(c),u=parseInt(s[1],16);if(-1==i)a=l,t.push((a?"@":"!")+s[1]),i=u-16;else{if(l!=a)break;if(i+16!=u)break}a||(o+=c),i=u,n++}if(0==n)t.push(e[r]),n=1;else if(a)t.push(n.toString(16));else{for(var f="",p=0;p<o.length;p+=2)f+=String.fromCharCode(parseInt(o.slice(p,p+2),16));t.push(ts.pxtc.encodeBase64(f))}}return t}(e.hex);var n=JSON.stringify(e);return e.hex=t,l(r,"hex-keys",i,n).then(function(){return e})}).catch(function(e){return d.reportException(e,{sha:n.sha}),Promise.resolve(null)})})}}(d.hex||(d.hex={}))}(pxt||(pxt={})),function(d){!function(a){function f(e,t,n,r,i){if(void 0===n&&(n={}),void 0===r&&(r=null),void 0===i&&(i=null),a.testMode||e==a.TEST_KEY){var o={success:!0};return Promise.resolve({statusCode:200,headers:{},text:JSON.stringify(o),json:o})}return d.Util.multipartPostAsync(t,n,r,i)}function p(e,t,n,r,i){d.Util.assert(!!t&&!!n&&!!r);var o="https://api.crowdin.com/api/project/"+t+"/";return i=i||{},a.testMode?delete i.key:i.key=n,e&&(i.branch=e),o+r+"?"+Object.keys(i).map(function(e){return e+"="+encodeURIComponent(i[e])}).join("&")}function e(e){var t=0;return function(){if(10<t++)throw new Error("Too many API calls for "+e)}}function h(r,i,o,a,s){return a=t(a),d.debug("create directory "+(r||"")+"/"+a),s||(s=e(a)),f(o,p(r,i,o,"add-directory"),{json:"true",name:a}).then(function(e){if(d.debug("crowdin resp: "+e.statusCode),200==e.statusCode||400==e.statusCode)return Promise.resolve();if(500==e.statusCode&&e.text&&50===JSON.parse(e.text).error.code)return d.log("directory already exists"),Promise.resolve();var t=e.json||JSON.parse(e.text)||{error:{}};if(404==e.statusCode&&17==t.error.code){d.log("parent directory missing for "+a);var n=a.replace(/\/[^\/]+$/,"");if(n!=a)return h(r,i,o,n,s).then(function(){return h(r,i,o,a,s)})}throw new Error("cannot create directory "+(r||"")+"/"+a+": "+e.statusCode+" "+JSON.stringify(t))})}function t(e){return e.replace(/\\/g,"/")}function i(e,t){var n=d.appTarget.versions.pxtCrowdinBranch||"",r=d.appTarget.versions.targetCrowdinBranch||"",i=[];if(e.forEach(function(e){return function t(n,r,i,o){var e=r.name,a=i?i+"/"+e:e;switch(r.fullName=a,r.branch=o||"",r.node_type){case"file":n.push(r);break;case"directory":(r.files||[]).forEach(function(e){return t(n,e,a,o)});break;case"branch":(r.files||[]).forEach(function(e){return t(n,e,i,r.name)})}}(i,e,"")}),i=i.filter(function(e){return e.fullName.indexOf("/")<0?e.branch==n:e.branch==r}),t&&(i=i.filter(function(e){return 0==e.fullName.indexOf(t)})),"core"!=d.appTarget.id){var o=d.appTarget.id+"/";i=i.filter(function(e){return e.fullName.indexOf("/")<0||e.fullName.substr(0,o.length)==o||0<=e.fullName.indexOf("common-docs")})}return i}function r(e,t){var n=p("",e,t,"info",{json:"true"});return d.Util.httpGetTextAsync(n).then(function(e){return JSON.parse(e)})}a.KEY_VARIABLE="CROWDIN_KEY",a.testMode=!1,a.TEST_KEY="!!!testmode!!!",a.setTestMode=function(){d.crowdin.testMode=!0,d.log("CROWDIN TEST MODE - files will NOT be uploaded")},a.downloadTranslationsAsync=function(a,s,c,l,u){void 0===u&&(u={});var e=p(a,s,c,"info",{json:"true"}),f={};return l=t(l),d.Util.httpGetTextAsync(e).then(function(e){var t=JSON.parse(e);if(!t)throw new Error("info failed");var i=t.languages.filter(function(e){return"en"!=e.code});d.appTarget&&d.appTarget.appTheme&&d.appTarget.appTheme.availableLocales&&(i=i.filter(function(e){return-1<d.appTarget.appTheme.availableLocales.indexOf(e.code)})),d.log("languages: "+i.map(function(e){return e.code}).join(", "));var o=function(){var n=i.pop();if(!n)return Promise.resolve();var r=p(a,s,c,"export-file",{file:l,language:n.code,export_translated_only:u.translatedOnly?"1":"0",export_approved_only:u.validatedOnly?"1":"0"});return d.log("downloading "+n.name+" - "+n.code+" ("+i.length+" more)"),d.Util.httpGetTextAsync(r).then(function(e){try{var t=JSON.parse(e);t&&(f[n.code]=t)}catch(e){d.log(r+" "+e)}return o()}).delay(1e3)};return o()}).then(function(){return f})},a.createDirectoryAsync=h,a.uploadTranslationAsync=function r(i,o,a,s,n){d.Util.assert(!!o),d.Util.assert(!!a);var c=e(s=t(s));function l(){return u("update-file",{update_option:"update_as_unapproved"})}function u(e,t){return t.type="auto",t.json="",t.escape_quotes="0",c(),f(a,p(i,o,a,e),t,s,n).then(function(e){return function(e){var t=e.statusCode,n=JSON.parse(e.text);if(d.debug("upload result: "+t),404==t&&8==n.error.code)return d.log("create new translation file: "+s),u("add-file",{});if(404==t&&17==n.error.code)return h(i,o,a,s.replace(/\/[^\/]+$/,""),c).then(function(){return l()});if(n.success||53!=n.error.code){if(200==t)return Promise.resolve();throw new Error("Error, upload translation: "+s+", "+t+", "+JSON.stringify(n))}return d.log(s+" being updated, waiting 5s and retry..."),Promise.delay(5e3).then(function(){return r(i,o,a,s,n)})}(e)})}return l()},a.projectInfoAsync=r,a.listFilesAsync=function(e,t,n){return d.log("crowdin: listing files under "+n),r(e,t).then(function(e){if(!e)throw new Error("info failed");var t=i(e.files,n);return d.debug("crowdin: found "+t.length+" under "+n),t.map(function(e){return{fullName:e.fullName,branch:e.branch||""}})})},a.languageStatsAsync=function(e,t,n){var r=p("",e,t,"language-status",{language:n,json:"true"});return d.Util.httpGetJsonAsync(r).then(function(e){return i(e.files)})},a.inContextLoadAsync=function(r){var i=document.createElement("input");i.type="text",i.setAttribute("class","hidden"),i.value=r;var e=new Promise(function(t,e){var n=new MutationObserver(function(){if(r!=i.value){var e=d.Util.rlf(i.value);i.remove(),n.disconnect(),t(e)}});n.observe(i,{attributes:!0})});return document.body.appendChild(i),e}}(d.crowdin||(d.crowdin={}))}(pxt||(pxt={})),function(l){!function(E){var C,P=pxtc.Util,O={},I={},e="\x3c!-- @CMD@ @ARGS@ --\x3e",N={parent:e,short:e,description:"\x3c!-- desc --\x3e",activities:"\x3c!-- activities --\x3e",explicitHints:"\x3c!-- hints --\x3e",flyoutOnly:"\x3c!-- flyout --\x3e",hideIteration:"\x3c!-- iter --\x3e",codeStart:"\x3c!-- start --\x3e",codeStop:"\x3c!-- stop --\x3e"};function t(e,t,n){return e.split(t).join(n)}function n(e){return e=t(e=t(e=t(e=t(e=t(e,"&","&amp;"),"<","&lt;"),">","&gt;"),'"',"&quot;"),"'","&#39;")}function F(e){return e?n(e.replace(/\&([#a-z0-9A-Z]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return"#"==t[0]?String.fromCharCode(parseInt(t.slice(1))):e}})):e}E.htmlQuote=n,E.html2Quote=F;var _=[{rx:/^vimeo\.com\/(\d+)/i,cmd:"### @vimeo $1"},{rx:/^(www\.youtube\.com\/watch\?v=|youtu\.be\/)([\w\-]+(\#t=([0-9]+m[0-9]+s|[0-9]+m|[0-9]+s))?)/i,cmd:"### @youtube $2"}];E.requireMarked=function(){return"undefined"!=typeof marked?marked:"undefined"!=typeof require?require("marked"):void 0};var L=function(e){return"<div class='ui negative message'>"+n(e)+"</div>"};function U(i){var o=P.clone(O),a=P.clone(I),s=P.clone(N),c={},l={},e=i.params,t=i.theme;i.boxes=o,i.macros=a,i.settings=s,i.html=i.html.replace(/<aside\s+([^<>]+)>([^]*?)<\/aside>/g,function(e,t,n){var r=function(e){for(var t={};e.trim();){var n=/\s*([^=\s]+)=("([^"]*)"|'([^']*)'|(\S*))/.exec(e);if(n){var r=n[3]||n[4]||n[5]||"";t[n[1].toLowerCase()]=r}else t[(n=/^\s*(\S+)/.exec(e))[1]]="true";e=e.slice(n[0].length)}return t}(t),i=r["data-name"]||r.id;return i?(/box/.test(r.class)?o[i]=n:/aside/.test(r.class)?o[i]="\x3c!-- BEGIN-ASIDE "+i+" --\x3e"+n+"\x3c!-- END-ASIDE --\x3e":/setting/.test(r.class)?s[i]=n:/menu/.test(r.class)?c[i]=n:/toc/.test(r.class)?l[i]=n:a[i]=n,"\x3c!-- macro "+i+" --\x3e"):L("id or data-name missing on macro")});var u=function(e,t){var n=c.item,r={NAME:e.name};if(e.subitems)n=c["toc-dropdown"]?c["toc-dropdown"]:0==t?c["top-dropdown"]:c["inner-dropdown"],r.ITEMS=e.subitems.map(function(e){return u(e,t+1)}).join("\n");else{if(/^-+$/.test(e.name)&&(n=c.divider),e.path&&!/^(https?:|\/)/.test(e.path))return L("Invalid link: "+e.path);r.LINK=e.path}return D(n,r,["ITEMS"])},f=[{name:lf("Docs"),href:"/docs"}],n=i.TOC||t.TOC||[],p=[],h=function(e){for(var t=0,n=e.subitems||[];t<n.length;t++){var r=n[t];if(h(r))return p.push(e),!0}return!(!i.filepath||!e.path||0!=i.filepath.indexOf(e.path))&&(p.push(e),!0)};n.forEach(h);var d=function(e,t){var n=l.item,r={NAME:e.name};return e.path&&!/^(https?:|\/)/.test(e.path)?L("Invalid link: "+e.path):(/^\//.test(e.path)&&i.versionPath&&(e.path="/"+i.versionPath+e.path),r.LINK=e.path,0<=p.indexOf(e)?(r.ACTIVE="active",r.EXPANDED="true",f.push({name:e.name,href:e.path})):r.EXPANDED="false",e.subitems&&0<e.subitems.length?(n=l["toc-dropdown"]?""!==e.name?l["toc-dropdown"]:l["toc-dropdown-noLink"]:0==t?""!==e.name?l["top-dropdown"]:l["top-dropdown-noHeading"]:1==t?l["inner-dropdown"]:l["nested-dropdown"],r.ITEMS=e.subitems.map(function(e){return d(e,t+1)}).join("\n")):/^-+$/.test(e.name)&&(n=l.divider),D(n,r,["ITEMS"]))};e.menu=(t.docMenu||[]).map(function(e){return u(e,0)}).join("\n"),e.TOC=n.map(function(e){return d(e,0)}).join("\n"),t.appStoreID&&(e.appstoremeta='<meta name="apple-itunes-app" content="app-id='+P.htmlEscape(t.appStoreID)+'"/>');var r="";1<f.length&&(r='\n            <nav class="ui breadcrumb" aria-label="'+lf("Breadcrumb")+'">\n                '+f.map(function(e,t){return'<a class="'+(t==f.length-1?"active":"")+' section"\n                        href="'+F(e.href)+'" aria-current="'+(t==f.length-1?"page":"")+'">'+F(e.name)+"</a>"}).join('<i class="right chevron icon divider"></i>')+"\n            </nav>"),e.breadcrumb=r,t.boardName&&(e.boardname=F(t.boardName)),t.boardNickname&&(e.boardnickname=F(t.boardNickname)),t.driveDisplayName&&(e.drivename=F(t.driveDisplayName)),t.homeUrl&&(e.homeurl=F(t.homeUrl)),e.targetid=t.id||"???",e.targetname=t.name||"Microsoft MakeCode",e.docsheader=t.docsHeader||"Documentation",e.targetlogo=t.docsLogo?'<img aria-hidden="true" role="presentation" class="ui '+(t.logoWide?"small":"mini")+' image" src="'+t.docsLogo+'" />':"";var g=i.ghEditURLs||[];if(g.length){for(var m='<p style="margin-top:1em">\n',v=lf("Edit this page on GitHub"),y=0,b=g;y<b.length;y++){m+='<a href="'+b[y]+'"><i class="write icon"></i>'+v+"</a><br>\n",v=lf("Edit template of this page on GitHub")}m+="</p>\n",e.github=m}else e.github="";var w='\n            <a href="#maincontent" class="ui item link" tabindex="0" role="menuitem">'+lf("Skip to main content")+"</a>\n        ";e.accMenu=w;var x=lf("Print this page"),k='\n            <button id="printbtn" class="circular ui icon right floated button hideprint" title="'+x+'" aria-label="'+x+'">\n                <i class="icon print"></i>\n            </button>\n        ';e.printBtn=k;var A='\n            <a id="togglesidebar" class="launch icon item" tabindex="0" title="Side menu" aria-label="'+lf("Side menu")+'" role="menuitem" aria-expanded="false">\n                <i class="content icon"></i>\n            </a>\n        ';e.sidebarToggle=A;var T=["tocsearch1","tocsearch2"].map(function(e){return'\n                <input type="search" name="q" placeholder="'+lf("Search...")+'" aria-label="'+lf("Search Documentation")+'">\n                <i onclick="document.getElementById(\''+e+'\').submit();" tabindex="0" class="search link icon" aria-label="'+lf("Search")+'" role="button"></i>\n            '});e.searchBar1=T[0],e.searchBar2=T[1];var E="";t.accentColor&&(E+="\n.ui.accent { color: "+t.accentColor+"; }\n.ui.inverted.accent { background: "+t.accentColor+"; }\n"),e.targetstyle=E,e.tocclass=t.lightToc?"lighttoc":"inverted";for(var C=0,_=Object.keys(t);C<_.length;C++){var U=_[C],S=t[U];void 0===e[U]&&"string"==typeof S&&(e[U]=S)}i.finish=function(){return D(i.html,e,["body","menu","accMenu","TOC","prev","next","printBtn","breadcrumb","targetlogo","github","JSON","appstoremeta","sidebarToggle","searchBar1","searchBar2"])}}function S(e){e.image=function(e,t,n){var r='<img class="ui image" src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+=' loading="lazy"',r+=this.options.xhtml?"/>":">"},e.listitem=function(e){var t=/^\s*\[( |x)\]/i.exec(e);return t?'<li class="'+(" "==t[1]?"unchecked":"checked")+'">'+e.slice(t[0].length)+"</li>\n":"<li>"+e+"</li>\n"},e.heading=function(e,t,n){var r=/(.*)#([\w\-]+)\s*$/.exec(e),i="";return r?(e=r[1],i=r[2]):i=n.toLowerCase().replace(/[^\w]+/g,"-"),e&&(e=e.replace(/@(fullscreen|unplugged)/g,"")),"<h"+t+' id="'+this.options.headerPrefix+i+'">'+e+"</h"+t+">"}}function R(e,i){return e.replace(/<!--\s*@(ifn?def)\s+(\w+)\s*-->([^]*?)<!--\s*@endif\s*-->/g,function(e,t,n,r){return"ifdef"==t&&i[n]||"ifndef"==t&&!i[n]?"\x3c!-- "+t+" "+n+" --\x3e"+r+"\x3c!-- endif --\x3e":"\x3c!-- "+t+" "+n+" endif --\x3e"})}function D(e,r,i){return void 0===i&&(i=[]),e?e.replace(/@(\w+)@/g,function(e,t){var n=P.lookup(r,t)||"";return n+="",i.indexOf(t)<0&&(n=F(n)),n}):""}E.prepTemplate=U,E.setupRenderer=S,E.renderConditionalMacros=R,E.renderMarkdown=function(p){var e=!0;p.pubinfo||(e=!1,p.pubinfo={});var h=p.pubinfo;if(p.theme||(p.theme={}),delete p.pubinfo.private,h.time){var t=parseInt(h.time);h.timems||(h.timems=1e3*t+""),h.humantime||(h.humantime=P.isoTime(t))}h.name&&(h.dirname=h.name.replace(/[^A-Za-z0-9_]/g,"-"),h.title=h.name),e&&(h.JSON=JSON.stringify(h,null,4).replace(/</g,"\\u003c"));var n=p.template;n=R(n=n.replace(/<!--\s*@include\s+(\S+)\s*-->/g,function(e,t){return"\x3c!-- include "+t+" --\x3e\n"+((p.theme.htmlDocIncludes||{})[t]||"")+"\n\x3c!-- end include --\x3e\n"}),h),p.locale&&(n=M(n,p.locale).text);var d={html:n,theme:p.theme,filepath:p.filepath,versionPath:p.versionPath,ghEditURLs:p.ghEditURLs,params:h,TOC:p.TOC};U(d),C||(C=E.requireMarked());var o=new C.Renderer;S(o);var a=o.link;o.link=function(e,t,n){var r=new RegExp("^[/#]").test(e),i=r?"":"_blank";return r&&d.versionPath&&(e="/"+d.versionPath+e),a.call(o,e,t,n).replace(/^<a /,"<a "+(i?'target="'+i+'"':"")+' rel="nofollow noopener" ')},C.setOptions({renderer:o,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!0});var r=p.markdown;p.repo&&(r+="\n```package\n"+p.repo.name.replace(/^pxt-/,"")+"=github:"+p.repo.fullName+"#"+(p.repo.tag||"master")+"\n```\n"),r=(r=r.replace(/^\s*https?:\/\/(\S+)\s*$/gm,function(e,t){for(var n=function(e){var n=e.rx.exec(t);if(n)return{value:e.cmd.replace(/\$(\d+)/g,function(e,t){return n[parseInt(t)]||""})+"\n"}},r=0,i=_;r<i.length;r++){var o=n(i[r]);if("object"==typeof o)return o.value}return e})).replace(/@([a-z]+)@/gi,function(e,t){var n=h[t];return!n&&p.throwOnError&&P.userError("unknown macro "+t),n||"unknown macro"});var i=C(r);i=(i=i.replace(/&lt;br\s*\/&gt;/gi,"<br/>")).replace(/(<img [^>]* src=")\/docs\/static\/([^">]+)"/g,function(e,t,n){return t+"/static/"+n+'"'});var g="",m=0;function v(e,t,n){var r=n;return e<=m&&(r=g+r,g="",m=0),r}if(i=i.replace(/<h(\d)[^>]+>\s*([~@])?\s*(.*?)<\/h\d>/g,function(e,t,n,r){var i=/^(\w+)\s+(.*)/.exec(r),o=i?i[1]:r,a=i?i[2]:"";if(a=F(a),o=F(o),t=parseInt(t),n){if("@"==n){var s=P.lookup(d.settings,o);if(null!=s)h[o]=a;else if(null==(s=P.lookup(d.macros,o)))return p.throwOnError&&P.userError("Unknown command: @"+o),L("Unknown command: @"+o);return v(t,0,D(s,{ARGS:a,CMD:o},["ARGS","CMD"]))}if(!o){var c=g;return g="",c}var l=P.lookup(d.boxes,o);if(l){var u=l.split("@BODY@");c=v(t,0,u[0].replace("@ARGS@",a)),g=u[1];var f=l.match(/data-[^>\s]+/gi);return f&&0<=f.indexOf("data-inferred")&&(m=t),c}return p.throwOnError&&P.userError("Unknown box: ~ "+o),L("Unknown box: ~ "+o)}return v(t,0,e)}),g&&(i+=g),!h.title){var s=/<h1[^<>]*>([^<>]+)<\/h1>/.exec(i);s&&(h.title=F(s[1]))}if(!h.description){var c=/<p>([^]+?)<\/p>/.exec(i);c&&(h.description=F(c[1]))}var l=/<div class="ui embed mdvid"[^<>]+?data-placeholder="([^"]+)"[^>]*\/?>/i.exec(i)||/<img class="ui [^"]*image" src="([^"]+)"[^>]*\/?>/i.exec(i);l&&(h.cardLogo=F(l[1])),h.twitter=F(p.theme.twitter||"@msmakecode");var u,f,y={main:""};i=(i=i.replace(/<!-- BEGIN-ASIDE (\S+) -->([^]*?)<!-- END-ASIDE -->/g,function(e,t,n){var r=P.lookup(y,t);return y[t]=(r||"")+n,"\x3c!-- aside --\x3e"})).replace(/\n<\/code>/g,"</code>"),y.main=i,i="";for(var b=0,w=Object.keys(y);b<w.length;b++){var x=w[b];i+=(u=x+"-container",f=y[x],D(d.boxes[u]||"@BODY@",{BODY:f},["BODY"]))}h.body=i,h.name=h.title||"";for(var k=0,A=Object.keys(p.theme);k<A.length;k++){x=A[k];var T=p.theme[x];"string"==typeof T&&(h["theme_"+x]=T)}return d.finish()},E.embedUrl=function(e,t,n,r){return'<div style="position:relative;height:0;padding-bottom:70%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"#"+t+":"+n+'" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe></div>'},E.runUrl=function(e,t,n){return'<div style="position:relative;height:0;padding-bottom:'+t+';overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"?id="+encodeURIComponent(n)+'" allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div>'},E.codeEmbedUrl=function(e,t,n){var r=e+"---codeembed#pub:"+t;return'<div style="position:relative;height:calc('+(n=Math.ceil(n||300))+'px + 5em);width:100%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+r+'" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-scripts allow-same-origin"></iframe></div>'};var c={b:1,strong:1,em:1};function M(e,i){var o={};function a(e){var t=/^(\s*)([^]*?)(\s*)$/.exec(e),n=t[2].replace(/\s+/g," ");if(""==n||/^((IE=edge,.*|width=device-width.*|(https?:\/\/|\/)[\w@\/\.]+|@[\-\w]+@|\{[^\{\}]+\}|[^a-zA-Z]*|(&nbsp;)+)\s*)+$/.test(n))return null;var r=P.lookup(i,n);return r?n=r:o[n]="",t[1]+n+t[3]}function s(e){return e.replace(/&llt;/g,"<").replace(/&ggt;/g,">")}return{text:e=(e=(e=(e="<start>"+(e=e.replace(/<([\/\w]+)([^<>]*)>/g,function(e,t,n){var r=t.replace(/^\//,"").toLowerCase();return 1===c[r]?"&llt;"+t+n+"&ggt;":e}))).replace(/(<([\/\w]+)([^<>]*)>)([^<>]+)/g,function(e,t,n,r,i){if("script"==n||"style"==n)return s(e);var o=a(s(i));return null==o?s(e):t+o})).replace(/(<[^<>]*)(content|placeholder|alt|title)="([^"]+)"/g,function(e,t,n,r){return null==a(r)?e:t+n+'="'+r.replace(/"/g,"''")+'"'})).replace(/^<start>/g,""),missing:o}}function v(e,a){for(var s=0,c=[{level:0,id:"",title:"",start:s,text:"",children:[]}],t=(e=e.replace(/\r/g,"")).split(/\n/),l={},n=function(e){var t=/^\s*(#+)\s*(.*?)(#(\S+)\s*)?$/.exec(e),n=null;if(a&&t)if(t[4])if(l[t[4]])t=null;else{n=function e(t,n){if(t.id==n)return t;for(var r=0,i=t.children;r<i.length;r++){var o=e(i[r],n);if(o)return o}return null}(a,t[4]);var r=function(e){e.id&&(l[e.id]=!0),e.children.forEach(r)};n&&r(n)}else t=null;if(t){var i={level:a?1:t[1].length,title:t[2].trim(),id:t[4]||"",start:s,text:"",children:[]};if(n){e="";for(var o=0;o<n.level;++o)e+="#";e+=" ",e+=i.title||n.title,e+=" #"+i.id}for(;c[c.length-1].level>=i.level;)c.pop();c[c.length-1].children.push(i),c.push(i)}c[c.length-1].text+=e+"\n",s++},r=0,i=t;r<i.length;r++){n(i[r])}return c[0]}E.translate=M,E.buildTOC=function(e){if(!e)return null;var t=l.docs.requireMarked(),n={renderer:new t.Renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,smartypants:!1},r={name:"dummy",subitems:[]},i=[];i.push(r);var o=t.lexer(e,n),a=!1;o.forEach(function(e){switch(e.type){case"heading":e.depth;break;case"list_start":break;case"list_item_start":case"loose_item_start":return a=!0,void i.push({name:"",path:"",subitems:[]});case"text":var r=i[i.length-1];0<=e.text.indexOf("[")?e.text.replace(/^\[(.*)\]\((.*)\)$/i,function(e,t,n){r.name=t,r.path=n.replace(".md","")}):a&&(r.name=e.text);break;case"list_item_end":case"loose_item_end":var t=i.pop();i[i.length-1].subitems.push(t)}a=!1});var s=r.subitems;return s&&0!=s.length?s:null};var y=!(E.visitTOC=function(e,t){e.forEach(function(e){t(e),e.subitems&&e.subitems.forEach(t)})});function b(e,t){if(y||function(){function e(e,t,n){var r=b(e,t).trim();if(n=n.trim(),r!=n)throw console.log("*** Template:\n"+e+"\n*** Input:\n"+t+"\n*** Expected:\n"+n+"\n*** Output:\n"+r),new Error("augment docs test fail")}y=!0;var t="\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nTEx2\n### Example 3\nTEx3\n\n## See also #also\nTAlso\n";e(t,"",t),e(t," ",t),e(t,"\n# @extends\n# #ex2\nMy example\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nMy example\n### Example 3\nTEx3\n\n## See Also These! #also\nMy links\n"),e(t,"\n# @extends\n### #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n")}(),!t)return e;for(var n=v(e,null),r=v(t,n),i={},o={},a=0,s=r.children;a<s.length;a++){var c=s[a];P.assert(0==c.children.length),P.assert(!!c.id),i[c.id]=c.text}var l=function(e){e.id&&void 0!==i[e.id]&&(o[e.id]=!0,e.text=i[e.id],e.children=[]),e.children.forEach(l)};l(n);var u="",f=function(e){u+=e.text,e.children.forEach(f)};f(n);var p="",h=r.text.replace(/^\s*#+\s*@extends.*/gm,"").replace(/^\s*\n/gm,"");h.trim()&&(p+=h.trim()+"\n");for(var d=0,g=r.children;d<g.length;d++){var m=g[d];o[m.id]||(p+=m.text)}return p&&(u+="## Couldn't apply replacement logic to:\n"+p),u}E.augmentDocs=b}(l.docs||(l.docs={}))}(pxt||(pxt={})),function(a){!function(e){function i(e){var t=/```package\s+((.|\s)+?)\s*```/i.exec(e),n=void 0;return t&&(n={},t[1].split("\n").map(function(e){return e.replace(/\s*/g,"")}).filter(function(e){return!!e}).map(function(e){return e.split("=")}).forEach(function(e){return n[e[0]]=e[1]||"*"})),n}function o(e){var t=/```config\s+((.|\s)+?)\s*```/i.exec(e),n=[];return t&&t[1].split("\n").map(function(e){return e.replace(/\s*/g,"")}).filter(function(e){return!!e}).map(function(e){return e.split("=")}).filter(function(e){return"feature"==e[0]&&!!e[1]}).forEach(function(e){return n.push(e[1])}),n.length?n:void 0}function n(e,t){if(t){var n=/```(blocks?|typescript)\s+((.|\s)+?)\s*```/i.exec(t);if(n){var r=i(t);return{name:e,filesOverride:{"main.blocks":'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>',"main.ts":n[2]},dependencies:r,features:o(t)}}}}function t(e){if(!e)return[];var n=[],r=!1,i=void 0,o="";return e.split(/\r?\n/).forEach(function(e){if(/^##/.test(e))i=e.substr(2).trim();else if(/^```codecard$/.test(e))r=!0;else if(/^```$/.test(e)){if(r=!1,i&&o)try{var t=JSON.parse(o);t&&0<t.length&&n.push({name:i,cards:t})}catch(e){a.log("invalid card format in gallery")}o="",i=void 0}else r&&(o+=e+"\n")}),n}e.parsePackagesFromMarkdown=i,e.parseFeaturesFromMarkdown=o,e.parseExampleMarkdown=n,e.parseGalleryMardown=t,e.loadGalleryAsync=function(e){return a.Cloud.markdownAsync(e,a.Util.userLanguage(),a.Util.localizeLive).then(function(e){return t(e)})},e.loadExampleAsync=function(t,e){return a.Cloud.markdownAsync(e,a.Util.userLanguage(),a.Util.localizeLive).then(function(e){return n(t,e)})}}(a.gallery||(a.gallery={}))}(pxt||(pxt={})),function(c){var e=function(){function e(e){var t=this;this.io=e,this.q=new c.U.PromiseQueue,this.dataBuf="",this.numSent=0,this.pktSize=400,this.trace=!1,this.bmpMode=!0,this.targetInfo="",this.onEvent=function(e){},this.io.onData=function(e){return t.onData(e)}}return e.prototype.onData=function(e){for(this.dataBuf+=c.U.uint8ArrayToString(e);0<this.dataBuf.length;){var t=this.dataBuf[0];if("+"==t)this.dataBuf=this.dataBuf.slice(1);else if("$"==t||"%"==t){var n=this.decodeResp(this.dataBuf.slice(1));if(null==n)break;"$"==t?(this.io.sendPacketAsync(this.buildCmd("+")).done(),this.onResponse?this.onResponse(n):0<this.numSent&&this.io.error("unexpected response: "+n)):this.onEvent(n)}else this.io.error("invalid character: "+t)}},e.prototype.buildCmd=function(e){if("+"==e)return c.U.stringToUint8Array(e);for(var t="",n=0;n<e.length;++n){var r=e.charAt(n);"}"==r||"#"==r||"$"==r?(t+="}",t+=String.fromCharCode(32^r.charCodeAt(0))):t+=r}var i=0;e=t;for(n=0;n<e.length;++n)i=i+e.charCodeAt(n)&255;return t="$"+e+"#"+("0"+i.toString(16)).slice(-2),c.U.stringToUint8Array(t)},e.prototype.decodeResp=function(e){for(var t="",n=0;n<e.length;++n){var r=e[n];if("}"==r)++n,t+=String.fromCharCode(32^e.charCodeAt(n));else if("*"==r){++n;for(var i=e.charCodeAt(n)-29,o=t.charAt(t.length-1);0<i--;)t+=o}else{if("#"==r)return 2==e.slice(n+1,n+3).length?(this.dataBuf=e.slice(n+3),t):null;t+=r}}return null},e.prototype.sendCmdOKAsync=function(e){return this.sendCmdAsync(e,function(e){return"OK"==e})},e.prototype.error=function(e){this.io.error(e),this.io.disconnectAsync().done()},e.prototype.sendCmdAsync=function(n,r){var i=this;this.numSent++;var e=this.buildCmd(n);return this.q.enqueue("one",function(){return null===r?i.io.sendPacketAsync(e).then(function(){return null}):new Promise(function(t){i.onResponse=function(e){i.onResponse=null,i.trace&&c.log("GDB: '"+n+"' -> '"+e+"'"),void 0===r||r(e)||i.error("Invalid GDB command response: '"+n+"' -> '"+e+"'"),t(e)},i.io.sendPacketAsync(e).done()})})},e.prototype.sendRCmdAsync=function(e){return this.sendMCmdAsync("qRcmd,"+(t=e,c.U.toHex(c.U.stringToUint8Array(t))));var t},e.prototype.sendMCmdAsync=function(r){var i=this;this.numSent++;var e=this.buildCmd(r),o="";return this.q.enqueue("one",function(){return new Promise(function(n){i.onResponse=function(e){var t;"OK"!=e&&"O"==e[0]?o+=(t=e.slice(1),c.U.uint8ArrayToString(c.U.fromHex(t))):("OK"!=e&&(o+=" - "+e),i.onResponse=null,i.trace&&c.log("Final GDB: '"+r+"' -> '"+o+"'"),n(o))},i.io.sendPacketAsync(e).done()})})},e.prototype.write32Async=function(e,t){var n=new Uint8Array(4);return c.HF2.write32(n,0,t),this.writeMemAsync(e,n)},e.prototype.writeMemAsync=function(e,t){var n=this.pktSize/2-10;return c.U.assert(t.length<n),this.sendCmdOKAsync("M"+e.toString(16)+","+t.length.toString(16)+":"+c.U.toHex(t)).then(function(e){console.log(e)})},e.prototype.readMemAsync=function(e,r){var i=this,o=this.pktSize/2-6;if(o<r){var a=new Uint8Array(r),s=function(t){var n=Math.min(r-t,o);return 0==n?Promise.resolve(a):i.readMemAsync(e+t,n).then(function(e){return c.U.memcpy(a,t,e),s(t+n)})};return s(0)}return this.sendCmdAsync("m"+e.toString(16)+","+r.toString(16)).then(function(e){return c.U.fromHex(e)})},e.prototype.initBMPAsync=function(){var t=this;return Promise.resolve().then(function(){return t.sendRCmdAsync("swdp_scan")}).then(function(e){return t.targetInfo=e,t.sendCmdAsync("vAttach;1",function(e){return"T"==e[0]})}).then(function(){})},e.prototype.initAsync=function(){var t=this;return Promise.delay(1e3).then(function(){return t.sendCmdAsync("!")}).then(function(){return t.sendCmdAsync("qSupported")}).then(function(e){var r={};return e=(e=";"+e+";").replace(/;([^;]+)[=:]([^:;]+)/g,function(e,t,n){return r[t]=n,";"}),t.pktSize=parseInt(r.PacketSize)||1024,c.log("GDB-server caps: "+JSON.stringify(r)+" "+e.replace(/;+/g,";")),t.bmpMode?t.initBMPAsync():t.sendCmdAsync("c").then(function(){})})},e}();c.GDBServer=e}(pxt||(pxt={})),function(T){!function(r){function s(){return!!r.forceProxy||!T.U.isNodeJS&&(!r.token&&!(T.appTarget&&T.appTarget.cloud&&T.appTarget.cloud.noGithubProxy))}r.token=null,r.forceProxy=!1,r.useProxy=s;var i={};function o(e){return r.token&&(0<e.url.indexOf("?")?e.url+="&":e.url+="?",e.url+="access_token="+r.token,e.url+="&anti_cache="+Math.random()),T.U.requestAsync(e)}function c(e){return o({url:e}).then(function(e){return e.json})}var a,e,t=function(){function e(){this.configs={},this.packages={}}return e.prototype.proxyLoadPackageAsync=function(e,t){var n=this,r=e+"/"+t,i=this.packages[r];return i?(T.debug("github cache "+e+"/"+t+"/text"),Promise.resolve(i)):T.U.httpGetJsonAsync(T.Cloud.apiRoot+"gh/"+e+"/"+t+"/text").then(function(e){return n.packages[r]={files:e}})},e.prototype.loadConfigAsync=function(e,t){var n=this;t||(t="master");var r=e+"/"+t,i=this.configs[r];if(i)return T.debug("github cache "+e+"/"+t+"/config"),Promise.resolve(T.U.clone(i));var o=function(e){var t=JSON.parse(e);return n.configs[r]=t,T.U.clone(t)};return s()?this.proxyLoadPackageAsync(e,t).then(function(e){return o(e.files[T.CONFIG_NAME])}):u(e,t,T.CONFIG_NAME).then(function(e){return o(e)})},e.prototype.loadPackageAsync=function(o,t){var a=this;return t||(t="master"),s()?this.proxyLoadPackageAsync(o,t).then(function(e){return T.U.clone(e)}):m(o,t).then(function(r){var i=o+"/"+r,e=a.packages[i];return e?(T.debug("github cache "+o+"/"+t+"/text"),Promise.resolve(T.U.clone(e))):(T.log("Downloading "+o+"/"+t+" -> "+r),u(o,r,T.CONFIG_NAME).then(function(e){var n={files:{}};n.files[T.CONFIG_NAME]=e;var t=JSON.parse(e);return Promise.map(T.allPkgFiles(t).slice(1),function(t){return u(o,r,t).then(function(e){n.files[t]=e})}).then(function(){return a.packages[i]=n,T.U.clone(n)})}))})},e}();function l(n,e,t){return o({url:"https://api.github.com/repos/"+n+"/contents/"+t+"?ref="+e}).then(function(e){var t=e.json;return i[n]=!0,t&&"base64"==t.encoding&&null!=t.content?atob(t.content):T.U.httpGetTextAsync(t.download_url)})}function u(t,n,r){return i[t]?l(t,n,r):T.U.requestAsync({url:"https://raw.githubusercontent.com/"+t+"/"+n+"/"+r,allowHttpErrors:!0}).then(function(e){return 200==e.statusCode?e.text:l(t,n,r)})}function f(n,e){return o({url:/^https:/.test(n)?n:"https://api.github.com/repos/"+n,method:"POST",allowHttpErrors:!0,data:e}).then(function(e){if(200==e.statusCode||202==e.statusCode||201==e.statusCode||204==e.statusCode)return e.json;var t=new Error(lf("Cannot create object at github.com/{0}; code: {1}",n,e.statusCode));throw t.statusCode=e.statusCode,t.isUserError=!0,404==e.statusCode&&(t.needsWritePermission=!0),t})}function p(e,t){for(var n=1;e.refs[t+n];)n++;return t+n}function h(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,f(t+"/git/refs",{ref:"refs/heads/"+n,sha:r})];case 1:return e.sent(),[2,n]}})})}function d(e,n){void 0===n&&(n="tags");var o=null,t=s()?T.U.httpGetJsonAsync(T.Cloud.apiRoot+"gh/"+e+"/refs").then(function(t){var e=Object.keys(t.refs).filter(function(e){return T.U.startsWith(e,"refs/"+n+"/")}).map(function(e){return{ref:e,object:{sha:t.refs[e]}}});return o=t.refs.HEAD,e}):c("https://api.github.com/repos/"+e+"/git/refs/"+n+"/?per_page=100"),a=function(e){return e.replace(/^refs\/[^\/]+\//,"")};return t.then(function(e){e.sort(function(e,t){return T.semver.strcmp(a(e.ref),a(t.ref))});for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[a(i.ref)]=i.object.sha}return{refs:t,head:o}},function(e){return 404==e.statusCode?{refs:{}}:Promise.reject(e)})}function g(e){return"commit"==e.object.type?Promise.resolve(e.object.sha):"tag"==e.object.type?c(e.object.url).then(function(e){return"commit"==e.object.type?e.object.sha:Promise.reject(new Error("Bad type (2nd order) "+e.object.type))}):Promise.reject(new Error("Bad type "+e.object.type))}function m(t,n){return/^[a-f0-9]{40}$/.test(n)?Promise.resolve(n):c("https://api.github.com/repos/"+t+"/git/refs/tags/"+n).then(g,function(e){return c("https://api.github.com/repos/"+t+"/git/refs/heads/"+n).then(g)})}function n(e){return T.Cloud.apiRoot+"gh/"+e.fullName+"/icon"}function v(e,t,n){if(e){var r={owner:e.owner.login.toLowerCase(),fullName:e.full_name.toLowerCase(),name:e.name,description:e.description,defaultBranch:e.default_branch,tag:n,updatedAt:Math.round(new Date(e.updated_at).getTime()/1e3),fork:e.fork,private:e.private};return r.status=y(r,t),r}}function y(e,t){return b(e,t)?a.Banned:(o=r=t,(i=n=e)&&o&&i.owner&&o.approvedOrgs&&o.approvedOrgs.some(function(e){return e.toLowerCase()==i.owner.toLowerCase()})||n&&r&&n.fullName&&r.approvedRepos&&r.approvedRepos.some(function(e){return e.toLowerCase()==n.fullName.toLowerCase()})?a.Approved:a.Unknown);var n,r,i,o}function b(t,e){return n=t,!(!(r=e)||n&&n.owner&&(!r.bannedOrgs||!r.bannedOrgs.some(function(e){return e.toLowerCase()==n.owner.toLowerCase()})))||!!e&&(!t||!t.fullName||!(!e.bannedRepos||!e.bannedRepos.some(function(e){return e.toLowerCase()==t.fullName.toLowerCase()})));var n,r}function w(e,t){var n=k(e),r=y(n,t);return r==a.Banned?Promise.resolve(void 0):s()?T.Util.httpGetJsonAsync(T.Cloud.apiRoot+"gh/"+n.fullName).then(function(e){if(e)return{github:!0,owner:n.owner,fullName:n.fullName,name:e.name,description:e.description,defaultBranch:"master",tag:n.tag,status:r}}).catch(function(e){T.reportException(e)}):c("https://api.github.com/repos/"+n.fullName).then(function(e){return v(e,t,n.tag)})}function x(e){if(e){var t=/^((https:\/\/)?github.com\/)?([^/]+\/[^/#]+)\/?(#(\w+))?$/i.exec(e.trim());if(t){var n={repo:t?t[3].toLowerCase():null,tag:t?t[5]:null};return n.path=n.repo+(n.tag?"#"+n.tag:""),n}}}function k(e){if(e){e=(e=(e=e.replace(/^github:/i,"")).replace(/^https:\/\/github\.com\//i,"")).replace(/\.git\b/i,"");var t,n,r,i,o=/([^#]+)(#(.*))?/.exec(e),a=o?o[1]:null,s=o?o[3]:null;if(o){var c=a.split("/");r=(t=c[0])+"/"+(n=c[1]),2<c.length&&(i=c.slice(2).join("/"))}else r=e.toLowerCase();return{owner:t,project:n,fullName:r,tag:s,fileName:i}}}function A(e){return e?"github:"+e.fullName.toLowerCase()+"#"+(e.tag||"master"):void 0}function B(e){return e?e.split(/\r?\n/):[]}r.MemoryGithubDb=t,r.downloadTextAsync=u,r.db=new t,r.authenticatedUserAsync=function(){return c("https://api.github.com/user")},r.getCommitAsync=function(e,t){return c("https://api.github.com/repos/"+e+"/git/commits/"+t).then(function(t){return c(t.tree.url+"?recursive=1").then(function(e){return t.tree=e,t})})},r.createObjectAsync=function(e,t,n){return f(e+"/git/"+t+"s",n).then(function(e){return e.sha})},r.postCommitComment=function(e,t,n,r,i){return f(e+"/commits/"+t+"/comments",{body:n,path:r,position:i}).then(function(e){return e.id})},r.fastForwardAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,o({url:"https://api.github.com/repos/"+t+"/git/refs/heads/"+n,method:"PATCH",allowHttpErrors:!0,data:{sha:r,force:!1}})];case 1:return[2,200==e.sent().statusCode]}})})},r.putFileAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,o({url:"https://api.github.com/repos/"+t+"/contents/"+n,method:"PUT",allowHttpErrors:!0,data:{message:lf("Initialize empty repo"),content:btoa(T.U.toUTF8(r)),branch:"master"}})];case 1:return 201!=e.sent().statusCode&&T.U.userError("PUT file failed"),[2]}})})},r.createTagAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,f(t+"/git/refs",{ref:"refs/tags/"+n,sha:r})];case 1:return e.sent(),[2]}})})},r.createPRFromBranchAsync=function(t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,f(t+"/pulls",{title:i,body:lf("Automatically created from MakeCode."),head:r,base:n,maintainer_can_modify:!0})];case 1:return[2,e.sent().html_url]}})})},r.mergeAsync=function(t,e,n){return o({url:"https://api.github.com/repos/"+t+"/merges",method:"POST",allowHttpErrors:!0,data:{base:e,head:n}}).then(function(e){if(201==e.statusCode||204==e.statusCode)return e.json.sha;if(409==e.statusCode)return null;throw T.U.userError(lf("Cannot merge in github.com/{1}; code: {2}",t,e.statusCode))})},r.getRefAsync=function(e,t){return c("https://api.github.com/repos/"+e+"/git/refs/heads/"+t).then(g)},r.getNewBranchNameAsync=function(t,n){return void 0===n&&(n="patch-"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,d(t,"heads")];case 1:return[2,p(e.sent(),n)]}})})},r.createNewBranchAsync=h,r.forkRepoAsync=function(a,s,c){return void 0===c&&(c="pr-"),__awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:return[4,f(a+"/forks",{})];case 1:t=e.sent(),n=v(t,null),r=Date.now()+3e5,i=null,e.label=2;case 2:return!i&&Date.now()<r?[4,Promise.delay(1e3)]:[3,8];case 3:e.sent(),e.label=4;case 4:return e.trys.push([4,6,,7]),[4,d(n.fullName,"heads")];case 5:return i=e.sent(),[3,7];case 6:return e.sent(),[3,7];case 7:return[3,2];case 8:if(!i)throw new Error(lf("Timeout waiting for fork"));return o=p(i,c),[4,h(n.fullName,o,s)];case 9:return e.sent(),[2,n.fullName+"#"+o]}})})},r.listRefsAsync=function(e,t){return void 0===t&&(t="tags"),d(e,t).then(function(e){return Object.keys(e.refs)})},r.listRefsExtAsync=d,r.pkgConfigAsync=function(e,t){return void 0===t&&(t="master"),r.db.loadConfigAsync(e,t)},r.downloadPackageAsync=function(e,t){var n=k(e);return n?b(n,t)?(T.tickEvent("github.download.banned"),T.log("Github repo is banned"),Promise.resolve(void 0)):r.db.loadPackageAsync(n.fullName,n.tag):(T.log("Unknown GitHub syntax"),Promise.resolve(void 0))},(e=a=r.GitRepoStatus||(r.GitRepoStatus={}))[e.Unknown=0]="Unknown",e[e.Approved=1]="Approved",e[e.Banned=2]="Banned",r.listUserReposAsync=function(){return c("https://api.github.com/user/repos?per_page=200&sort=updated&affiliation=owner,collaborator").then(function(e){return e.map(function(e){return v(e,null)})})},r.createRepoAsync=function(e,t,n){return f("https://api.github.com/user/repos",{name:e,description:t,private:!!n,has_issues:!0,has_projects:!1,has_wiki:!1}).then(function(e){return v(e,null)})},r.repoIconUrl=function(e){if(e.status==a.Approved)return n(e)},r.mkRepoIconUrl=n,r.repoStatus=y,r.repoAsync=w,r.searchAsync=function(e,t){if(!t)return Promise.resolve([]);var n=e.split("|").map(x).filter(function(e){return!!e});return 0<n.length?Promise.all(n.map(function(e){return w(e.path,t)})).then(function(e){return e.filter(function(e){return e&&e.status!=a.Banned})}):(s()?T.U.httpGetJsonAsync(T.Cloud.apiRoot+"ghsearch/"+T.appTarget.id+"/"+(T.appTarget.platformid||T.appTarget.id)+"?q="+encodeURIComponent(e)):c("https://api.github.com/search/repositories?q="+encodeURIComponent(e+' in:name,description,readme "for PXT/'+(T.appTarget.platformid||T.appTarget.id)+'"'))).then(function(e){return e.items.map(function(e){return v(e,t)}).filter(function(e){return e.status==a.Approved||t.allowUnapproved&&e.status==a.Unknown}).filter(function(e){return!T.appTarget.appTheme.githubUrl||"https://github.com/"+e.fullName!=T.appTarget.appTheme.githubUrl.toLowerCase()})}).catch(function(e){return[]})},r.parseRepoUrl=x,r.parseRepoId=k,r.toGithubDependencyPath=function(e){var t="github:"+e.fullName;return e.tag&&(t+="#"+e.tag),t},r.isGithubId=function(e){return!!e&&"github:"==e.slice(0,7)},r.stringifyRepo=A,r.normalizeRepoId=function(e){var t=k(e);return t.tag=t.tag||"master",A(t)},r.latestVersionAsync=function(e,o){var a=k(e);return a?w(a.fullName,o).then(function(i){if(i)return d(i.fullName,"tags").then(function(e){var t=Object.keys(e.refs);t=T.semver.sortLatestTags(t);var n=T.appTarget.versions&&T.semver.tryParse(T.appTarget.versions.target);if(n&&o.releases&&o.releases["v"+n.major]){var r=o.releases["v"+n.major].map(function(e){return T.github.parseRepoId(e)}).filter(function(e){return e.fullName.toLowerCase()==a.fullName.toLowerCase()})[0];if(r){if(t.some(function(e){return e==r.tag}))return T.debug("approved release "+r.fullName+"#"+r.tag+" for v"+n.major),Promise.resolve(r.tag);T.reportError("packages","approved release "+r.fullName+"#"+r.tag+" for v"+n.major+" not found anymore",{repo:i.fullName})}}return t[0]?Promise.resolve(t[0]):e.head||m(i.fullName,i.defaultBranch)})}):Promise.resolve(null)},r.GIT_JSON=".git.json",r.diff=function(e,t,a){void 0===a&&(a={}),a.ignoreWhitespace&&(e=e.replace(/[\r\n]+$/,""),t=t.replace(/[\r\n]+$/,""));var n=B(e),r=B(t),o=Math.min(a.maxDiffSize||1024,n.length+r.length);if(0==o)return[];var s=65520<n.length?Uint32Array:Uint16Array,c={},l=0,u=i(n),f=i(r);function i(e){for(var t=new s(e.length),n=0,r=0,i=e;r<i.length;r++){var o=i[r];a.ignoreWhitespace&&(o=o.replace(/\s+$/g,"").replace(/^\s+/g,"")),c.hasOwnProperty(o)?t[n]=c[o]:(++l,t[n]=l,c[o]=l),n++}return t}for(var p=new s(2*o+1),h=-1,d=0;d<=o;d++)null!=M(d,p)&&(h=d);if(-1==h)return null;var g=[],m=null;for(d=0;d<=h;d++){var v=g.length?g[g.length-1].slice(0):new s(2*h+1);if(g.push(v),null!=(m=M(d,v)))break}var y=[],b=m;for(d=g.length-1;0<=d;d--){for(var w=g[d],x=0,k=0,A=(x=b==-d||b!=d&&w[o+b-1]<w[o+b+1]?w[o+(k=b+1)]:w[o+(k=b-1)]+1)-b,T=w[o+b]-x-1;0<=T;--T)y.push("  "+n[x+T]);k==b-1?y.push("- "+n[x-1]):0<A&&y.push("+ "+r[A-1]),b=k}if(y.reverse(),a.context==1/0)return y;for(var E=1,C=1,_=0,U=[],S=a.context||3;_<y.length;){for(var P=_;P<y.length&&" "==y[P][0];)P++;if(P==y.length)break;var O=P-S,I=O-_;0<I&&(E+=I,C+=I,_=O);var N=U.length,F=E,L=C;U.push("@@");for(var R=_,D=0;R<y.length;){if(" "==y[R][0]){if(2*S+2<++D){R-=S+2;break}}else D=0;R++}for(;_<R;){switch(U.push(y[_]),y[_][0]){case"-":E++;break;case"+":C++;break;case" ":E++,C++}_++}U[N]="@@ -"+F+","+(E-F)+" +"+L+","+(C-L)+" @@"}return U;function M(e,t){for(var n=-e;n<=e;n+=2){for(var r=0,i=(r=n==-e||n!=e&&t[o+n-1]<t[o+n+1]?t[o+n+1]:t[o+n-1]+1)-n;r<u.length&&i<f.length&&u[r]==f[i];)r++,i++;if((t[o+n]=r)>=u.length&&i>=f.length)return n}return null}},r.diff3=function(e,c,t,n,r){var i=v(e),o=v(t);if(i&&o){for(var a=B(e),s=B(t),l=0,u=[],f=0,p=0,h=0;h<i.length-1;)if(i[h]==f&&o[h]==p)u.push(a[f]),f++,p++,h++;else{for(var d=!0,g=!0,m=h;m<i.length&&(i[m]!=f+m-h&&(d=!1),o[m]!=p+m-h&&(g=!1),null==i[m]||null==o[m]);)m++;if(T.U.assert(m<i.length),d)for(;p<o[m];)u.push(s[p++]);else if(g)for(;f<i[m];)u.push(a[f++]);else if(a.slice(f,i[m]).join("\n")==s.slice(p,o[m]).join("\n"))for(;f<i[m];)u.push(a[f++]);else{for(l++,u.push("<<<<<<< "+n);f<i[m];)u.push(a[f++]);for(u.push("=======");p<o[m];)u.push(s[p++]);u.push(">>>>>>> "+r)}f=i[h=m],p=o[m]}return{merged:u.join("\n"),numConflicts:l}}function v(e){var t=T.github.diff(c,e,{context:1/0});if(t){for(var n=[],r=0,i=0,o=0,a=t;o<a.length;o++){var s=a[o];"+"==s[0]?r++:"-"==s[0]?(n[i]=null,i++):" "==s[0]?(n[i]=r,r++,i++):T.U.oops()}return n.push(r+1),n}}},r.resolveMergeConflictMarker=function(e,t,n,r){var i=B(e);if(!/^<<<<<<<[^<]/.test(i[t]))return e;for(var o=t+1;o<i.length&&!/^=======$/.test(i[o]);)o++;for(var a=o+1;a<i.length&&!/^>>>>>>>[^>]/.test(i[a]);)a++;if(a>=i.length)return e;if(i[t]=void 0,i[o]=void 0,i[a]=void 0,!n)for(var s=t;s<=o;++s)i[s]=void 0;if(!r)for(s=o;s<=a;++s)i[s]=void 0;return i.filter(function(e){return void 0!==e}).join("\n")},r.mergeDiff3Config=function(e,t,n){var r=T.Util.jsonTryParse(e),i=T.Util.jsonTryParse(t),o=T.Util.jsonTryParse(n);if(r&&!o)return e;if(!r)return n||t;if(!i&&o&&(i=o),r&&i&&o){delete r.installedVersion,delete i.installedVersion,delete o.installedVersion;for(var a={},s=0,c=T.U.unique(Object.keys(i).concat(Object.keys(r)).concat(Object.keys(o)),function(e){return e});s<c.length;s++){var l=c[s],u=r[l],f=i[l],p=o[l];if(JSON.stringify(u)==JSON.stringify(p))void 0!==u&&(a[l]=u);else switch(l){case"name":a[l]=(m=p,(d=u)==(g=f)?m:m==g?d:d==lf("Untitled")?m:d);break;case"version":a[l]=0<T.semver.strcmp(u,p)?u:p;break;case"preferredEditor":a[l]=u;break;case"public":a[l]=u&&p;break;case"files":case"testFiles":if(!(h=v(u||[],f||[],p||[])))return;a[l]=h.length?h:void 0;break;case"dependencies":case"testDependencies":var h=y(u||{},f||{},p||{});if(Object.keys(h).length)return;a[l]=h;break;case"description":if(u&&!p)a[l]=u;else{if(u||!p)return;a[l]=p}break;default:return}}return T.Package.stringifyConfig(a)}var d,g,m;function v(e,t,n){for(var r=[],i=0,o=T.U.unique(t.concat(e).concat(n),function(e){return e});i<o.length;i++){var a=o[i],s=-1<e.indexOf(a),c=-1<n.indexOf(a),l=-1<t.indexOf(a);s==c?s&&r.push(a):c==l?s&&r.push(a):c&&r.push(a)}return r}function y(e,t,n){for(var r={},i=0,o=T.U.unique(Object.keys(t).concat(Object.keys(e)).concat(Object.keys(n)),function(e){return e});i<o.length;i++){var a=o[i],s=e[a],c=n[a],l=t[a];if(s==c)s&&(r[a]=s);else{var u=k(s),f=k(c);if(u&&f&&T.semver.tryParse(u.tag)&&T.semver.tryParse(f.tag)&&u.owner&&u.project&&u.owner==f.owner&&u.project==f.project){var p=0<T.semver.strcmp(u.tag,f.tag)?u.tag:f.tag;r[a]="github:"+u.owner+"/"+u.project+"#"+p}else c==l?s&&(r[a]=s):c&&(r[a]=c)}}return r}},r.hasMergeConflictMarker=function(e){return e&&/^(<<<<<<<[^<]|>>>>>>>[^>])/m.test(e)},r.lookupFile=function(e,t){return e?e.tree.tree.find(function(e){return e.path==t}):null},r.reconstructConfig=function(t,e,n){var r={},i=e.tree.tree.map(function(e){return e.path}).filter(function(e){return/\.(ts|blocks|md|jres|asm|json)$/.test(e)}).filter(function(e){return e!=T.CONFIG_NAME});return i.find(function(e){return/\.ts$/.test(e)})||(n.config.files.filter(function(e){return i.indexOf(e)<0}).forEach(function(e){i.push(e),t[e]=n.files[e]}),T.Util.jsonCopyFrom(r,n.config.dependencies)),Object.keys(r).length||(r[T.appTarget.corepkg]="*"),{name:"",files:i,dependencies:r,preferredEditor:i.find(function(e){return/.blocks$/.test(e)})?T.BLOCKS_PROJECT_NAME:T.JAVASCRIPT_PROJECT_NAME}}}(T.github||(T.github={}))}(pxt||(pxt={})),function(e){var t;e.REFCNT_FLASH="0xfffe",e.VTABLE_MAGIC=249,e.ValTypeObject=4,(t=e.BuiltInType||(e.BuiltInType={}))[t.BoxedString=1]="BoxedString",t[t.BoxedNumber=2]="BoxedNumber",t[t.BoxedBuffer=3]="BoxedBuffer",t[t.RefAction=4]="RefAction",t[t.RefImage=5]="RefImage",t[t.RefCollection=6]="RefCollection",t[t.RefRefLocal=7]="RefRefLocal",t[t.RefMap=8]="RefMap",t[t.RefMImage=9]="RefMImage",t[t.MMap=10]="MMap",t[t.User0=16]="User0"}(pxt||(pxt={})),function(m){!function(g){function c(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function l(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function u(e,t){return e[t]|e[t+1]<<8}function n(e){for(var t=new Uint8Array(4*e.length),n=0;n<e.length;++n)c(t,4*n,e[n]);return t}g.HF2_CMD_BININFO=1,g.HF2_MODE_BOOTLOADER=1,g.HF2_MODE_USERSPACE=2,g.HF2_CMD_INFO=2,g.HF2_CMD_RESET_INTO_APP=3,g.HF2_CMD_RESET_INTO_BOOTLOADER=4,g.HF2_CMD_START_FLASH=5,g.HF2_CMD_WRITE_FLASH_PAGE=6,g.HF2_CMD_CHKSUM_PAGES=7,g.HF2_CMD_READ_WORDS=8,g.HF2_CMD_WRITE_WORDS=9,g.HF2_CMD_DMESG=16,g.HF2_FLAG_SERIAL_OUT=128,g.HF2_FLAG_SERIAL_ERR=192,g.HF2_FLAG_CMDPKT_LAST=64,g.HF2_FLAG_CMDPKT_BODY=0,g.HF2_FLAG_MASK=192,g.HF2_SIZE_MASK=63,g.HF2_STATUS_OK=0,g.HF2_STATUS_INVALID_CMD=1,g.HF2_STATUS_EXEC_ERR=2,g.HF2_STATUS_EVENT=128,g.HF2_EV_MASK=8388608,g.write32=c,g.write16=l,g.read32=o,g.read16=u,g.encodeU32LE=n;var t=!(g.decodeU32LE=function(e){for(var t=[],n=0;n<e.length;n+=4)t.push(o(e,n));return t});function f(e){t?m.log("HF2: "+e):m.debug("HF2: "+e)}g.enableLog=function(){t=!0};var e=function(){function e(p){var h=this;this.io=p,this.cmdSeq=m.U.randomUint32(),this.lock=new m.U.PromiseQueue,this.rawMode=!1,this.maxMsgSize=63,this.bootloaderMode=!1,this.reconnectTries=0,this.autoReconnect=!1,this.msgs=new m.U.PromiseBuffer,this.eventHandlers={},this.onSerial=function(e,t){};var d=[];p.onSerial=function(e,t){return h.onSerial(e,t)},p.onData=function(e){var t=e[0]&g.HF2_FLAG_MASK,n=63&e[0],r=new Uint8Array(n);if(m.U.memcpy(r,0,e,1,n),t&g.HF2_FLAG_SERIAL_OUT)h.onSerial(r,t==g.HF2_FLAG_SERIAL_ERR);else if(d.push(r),t!=g.HF2_FLAG_CMDPKT_BODY){m.U.assert(t==g.HF2_FLAG_CMDPKT_LAST);for(var i=0,o=0,a=d;o<a.length;o++){i+=(f=a[o]).length}for(var s=new Uint8Array(i),c=0,l=0,u=d;l<u.length;l++){var f=u[l];m.U.memcpy(s,c,f),c+=f.length}d=[],s[2]&g.HF2_STATUS_EVENT?p.onEvent(s):h.msgs.push(s)}},p.onEvent=function(e){var t=o(e,0),n=m.U.lookup(h.eventHandlers,t+"");n?n(e.slice(4)):f("unhandled event: "+t.toString(16))},p.onError=function(e){f("recv error: "+e.message),h.autoReconnect&&(h.autoReconnect=!1,h.reconnectAsync().then(function(){h.autoReconnect=!0},function(e){f("reconnect error: "+e.message)}))}}return e.prototype.resetState=function(){this.lock=new m.U.PromiseQueue,this.info=null,this.infoRaw=null,this.pageSize=null,this.flashSize=null,this.maxMsgSize=63,this.bootloaderMode=!1,this.msgs.drain()},e.prototype.onEvent=function(e,t){m.U.assert(!!(e&g.HF2_EV_MASK)),this.eventHandlers[e+""]=t},e.prototype.reconnectAsync=function(e){var t=this;return void 0===e&&(e=!1),this.resetState(),e?this.initAsync():(f("reconnect raw="+this.rawMode),this.io.reconnectAsync().then(function(){return t.initAsync()}).catch(function(e){if(t.reconnectTries<5)return t.reconnectTries++,f("error "+e.message+"; reconnecting attempt #"+t.reconnectTries),Promise.delay(500).then(function(){return t.reconnectAsync()});throw e}))},e.prototype.disconnectAsync=function(){return f("disconnect"),this.io.disconnectAsync()},e.prototype.error=function(e){return this.io.error(e)},e.prototype.talkAsync=function(e,t){var n=this;if(this.io.talksAsync)return this.io.talksAsync([{cmd:e,data:t}]).then(function(e){return e[0]});var r=8;t&&(r+=t.length);var i=new Uint8Array(r),o=65535&++this.cmdSeq;c(i,0,e),l(i,4,o),l(i,6,0),t&&m.U.memcpy(i,8,t,0,t.length);var a=0,s=function(){return n.msgs.shiftAsync(1e3).then(function(e){if(u(e,0)!=o){if(a<3)return a++,f("message out of sync, ("+o+" vs "+u(e,0)+"); will re-try"),s();n.error("out of sync")}var t="";switch(e[3]&&(t="; info="+e[3]),e[2]){case g.HF2_STATUS_OK:return e.slice(4);case g.HF2_STATUS_INVALID_CMD:n.error("invalid command"+t);break;case g.HF2_STATUS_EXEC_ERR:n.error("execution error"+t);break;default:n.error("error "+e[2]+t)}return null})};return this.sendMsgAsync(i).then(s)},e.prototype.sendMsgAsync=function(e){return this.sendMsgCoreAsync(e)},e.prototype.sendSerialAsync=function(e,t){return void 0===t&&(t=!1),this.io.sendSerialAsync?this.io.sendSerialAsync(e,t):this.sendMsgCoreAsync(e,t?2:1)},e.prototype.sendMsgCoreAsync=function(r,i){var o=this;void 0===i&&(i=0);var a=new Uint8Array(64),s=function(e){var t=r.length-e;if(t<=0)return Promise.resolve();63<t?(t=63,a[0]=g.HF2_FLAG_CMDPKT_BODY):a[0]=g.HF2_FLAG_CMDPKT_LAST,i&&(a[0]=1==i?g.HF2_FLAG_SERIAL_OUT:g.HF2_FLAG_SERIAL_ERR),a[0]|=t;for(var n=0;n<t;++n)a[n+1]=r[e+n];return o.io.sendPacketAsync(a).then(function(){return s(e+t)})};return this.lock.enqueue("out",function(){return s(0)})},e.prototype.switchToBootloaderAsync=function(){var t=this;return this.bootloaderMode?Promise.resolve():(f("Switching into bootloader mode"),this.io.isSwitchingToBootloader&&this.io.isSwitchingToBootloader(),this.maybeReconnectAsync().then(function(){return t.talkAsync(g.HF2_CMD_START_FLASH).then(function(){},function(e){return t.talkAsync(g.HF2_CMD_RESET_INTO_BOOTLOADER).then(function(){},function(e){}).then(function(){return t.reconnectAsync().catch(function(e){throw"devicenotfound"===e.type&&(e.type="repairbootloader"),e})})})}).then(function(){return t.initAsync()}).then(function(){t.bootloaderMode||t.error("cannot switch into bootloader mode")}))},e.prototype.reflashAsync=function(e){var t=this;return f("reflash"),this.flashAsync(e).then(function(){return Promise.delay(100)}).then(function(){return t.reconnectAsync()})},e.prototype.writeWordsAsync=function(e,t){return m.U.assert(t.length<=64),this.talkAsync(g.HF2_CMD_WRITE_WORDS,n([e,t.length].concat(t))).then(function(){})},e.prototype.readWordsAsync=function(e,t){var n=new Uint8Array(8);return c(n,0,e),c(n,4,t),m.U.assert(t<=64),this.talkAsync(g.HF2_CMD_READ_WORDS,n)},e.prototype.pingAsync=function(){return this.rawMode?Promise.resolve():this.talkAsync(g.HF2_CMD_BININFO).then(function(e){})},e.prototype.maybeReconnectAsync=function(){var t=this;return this.pingAsync().catch(function(e){return t.reconnectAsync().then(function(){return t.pingAsync()})})},e.prototype.flashAsync=function(r){var i=this,o=Date.now(),a=0,s=function(e){if(e>=r.length)return Promise.resolve();var t=r[e],n=new Uint8Array(4+t.payloadSize);return c(n,0,t.targetAddr),m.U.memcpy(n,4,t.data,0,t.payloadSize),i.talkAsync(g.HF2_CMD_WRITE_FLASH_PAGE,n).then(function(){return s(e+1)})};return this.switchToBootloaderAsync().then(function(){var e=256*r.length;return f("Starting flash ("+Math.round(e/1024)+"kB)."),a=Date.now(),16384<i.pageSize?r:p(r,function(e,t){return i.readWordsAsync(e,t)})}).then(function(e){if(e.length!=r.length){var t=256*(r=e).length;f("Performing partial flash ("+Math.round(t/1024)+"kB).")}}).then(function(){return s(0)}).then(function(){var e=Date.now(),t=e-o,n=e-a;f("Flashing done at "+Math.round(256*r.length/n*1e3/1024)+" kB/s in "+t+"ms (reset "+(t-n)+"ms). Resetting.")}).then(function(){return i.talkAsync(g.HF2_CMD_RESET_INTO_APP).catch(function(e){})}).then(function(){})},e.prototype.initAsync=function(){var n=this;return this.rawMode?Promise.resolve():Promise.resolve().then(function(){return n.talkAsync(g.HF2_CMD_BININFO)}).then(function(e){return n.bootloaderMode=e[0]==g.HF2_MODE_BOOTLOADER,n.pageSize=o(e,4),n.flashSize=o(e,8)*n.pageSize,n.maxMsgSize=o(e,12),n.familyID=o(e,16),f("Connected; msgSize "+n.maxMsgSize+"B; flash "+n.flashSize/1024+"kB; "+(n.bootloaderMode?"bootloader":"application")+" mode; family=0x"+n.familyID.toString(16)),n.talkAsync(g.HF2_CMD_INFO)}).then(function(e){n.infoRaw=m.U.fromUTF8(m.U.uint8ArrayToString(e)),m.debug("Info: "+n.infoRaw);var r={};("Header: "+n.infoRaw).replace(/^([\w\-]+):\s*([^\n\r]*)/gm,function(e,t,n){return r[t.replace(/-/g,"")]=n,""}),n.info=r;var t=/v(\d\S+)(\s+(\S+))?/.exec(n.info.Header);n.info.Parsed=t?{Version:t[1],Features:t[3]||""}:{Version:"?",Features:""},f("Board-ID: "+n.info.BoardID+" v"+n.info.Parsed.Version+" f"+n.info.Parsed.Features)}).then(function(){n.reconnectTries=0})},e}();function p(r,e){if(!m.appTarget.compile.flashChecksumAddr)return Promise.resolve(r);var n,t=pxtc.UF2.readBytes(r,m.appTarget.compile.flashChecksumAddr,48),i=pxtc.hex.parseChecksumBlock(t);return i?(n=e,m.appTarget.compile.flashChecksumAddr?n(m.appTarget.compile.flashChecksumAddr,12).then(function(e){var t=pxtc.hex.parseChecksumBlock(e);return t?n(t.endMarkerPos,1).then(function(e){return o(e,0)!=t.endMarker?(m.log("end-marker mismatch"),null):t}):null}):Promise.resolve(null)).then(function(e){if(!e)return r;var n=e.regions.filter(function(t){return i.regions.some(function(e){return t.checksum==e.checksum&&t.length==e.length&&t.start==e.start})});if(0==n.length)return r;f("skipping flash at: "+n.map(function(e){return pxtc.assembler.tohex(e.start)+" ("+e.length/1024+"kB)"}).join(", "));var t=function(t){return n.some(function(e){return e.start<=t&&t<e.start+e.length})};return r.filter(function(e){return!(t(e.targetAddr)&&t(e.targetAddr+e.payloadSize-1))})}):Promise.resolve(r)}g.Wrapper=e,g.onlyChangedBlocksAsync=p}(m.HF2||(m.HF2={}))}(pxt||(pxt={})),function(S){!function(t){var g,e,f,n,m,v,a,p,y=S.Util,h=S.HF2,r=1409050336,i=665147697,o=287358355,d=1888490768,s=915601917,c=h.read32,b=!1;function l(e){return e<<2|2}function w(e){return 1&e?e>>1:0!=e?2&e?e==t.taggedNull?null:e!=t.taggedFalse&&(e==t.taggedTrue||{tagged:e>>2}):{ptr:e}:void 0}function u(e,t){if(y.assert(!(3&e)),y.assert(0<=e),e<2097152){var n=new Uint8Array(t);return e-=a.start,y.memcpy(n,0,a.buf,e,t),Promise.resolve(n)}var r=p.maxMsgSize-32;if(r<t){for(var i=[];0<t;){var o=Math.min(r,t);i.push(u(e,o)),t-=o,e+=o}return Promise.all(i).then(y.uint8ArrayConcat)}return p.readWordsAsync(e,Math.ceil(t/4)).then(function(e){return e.length>t?e.slice(0,t):e})}function x(n){if("object"!=typeof n||!n)return Promise.resolve(n);if("number"==typeof n.ptr){if(3&n.ptr)return Promise.resolve({unalignedPtr:n.ptr});var r=0;return u(n.ptr,56).then(function(t){r=h.read16(t,2);var e=t.length;return r==S.BuiltInType.BoxedString||r==S.BuiltInType.BoxedBuffer?e=h.read16(t,4)+6:r==S.BuiltInType.BoxedNumber&&(e=12),e>t.length?u(n.ptr+t.length,e-t.length).then(function(e){return y.uint8ArrayConcat([t,e])}):e<t.length?t.slice(0,e):t}).then(function(e){return r==S.BuiltInType.BoxedString?y.uint8ArrayToString(e.slice(6)):r==S.BuiltInType.BoxedBuffer?{type:"buffer",data:e.slice(6)}:r==S.BuiltInType.BoxedNumber?new Float64Array(e.buffer.slice(4))[0]:{type:"unknown",tag:r,refcnt:h.read16(e,0),data:e.slice(4)}})}return Promise.resolve(n)}function k(n){for(var e=[],t=function(t){e.push(x(n[t]).then(function(e){n[t]=e}))},r=0,i=Object.keys(n);r<i.length;r++){t(i[r])}return Promise.all(e).then(function(){})}function A(e){for(var t=g.breakpoints,n=t[0],r=1/0,i=0,o=t;i<o.length;i++){var a=o[i],s=e-a.binAddr;0<=s&&s<r&&(r=s,n=a)}return n}function T(l){return b?Promise.resolve():(b=!0,U().then(function(e){for(var t,n,r,i=h.decodeU32LE(l)[0],o={},a=0,s=g.procDebugInfo[0].locals;a<s.length;a++){var c=s[a];t=c,r=void 0,n=e.globals,null===(r=function(){switch(t.type){case"uint32":return h.read32(n,t.index);case"int32":return 0|h.read32(n,t.index);case"uint16":return h.read16(n,t.index);case"int16":return h.read16(n,t.index)<<16>>16;case"uint8":return n[t.index];case"int8":return n[t.index]<<24>>24;default:return null}}())&&(y.assert(0==(3&t.index)),r=w(h.read32(n,t.index))),o[t.name]=r}return m=A(i),u={type:"debugger",subtype:"breakpoint",breakpointId:m.id,globals:o,stackframes:[]},f(),p.talkAsync(d)}).then(function(e){!function(e,t){for(var n=m.binAddr,r=0,i=g.procDebugInfo.filter(function(e){return e.codeStartLoc<=n&&n<=e.codeEndLoc})[0];i&&i!=g.procDebugInfo[0];){var o=A(n),a=y.clone(o);a.functionName=i.name,a.argumentNames=i.args&&i.args.map(function(e){return e.name}),t.stackframes.push({locals:{},funcInfo:a,breakpointId:o.id});for(var s=t.stackframes[t.stackframes.length-1],c=0,l=0,u=i.locals;l<u.length;l++){var f=u[l];y.assert(f.index==c++),s.locals[f.name]=w(e[r++])}n=2147483646&e[r++];for(var p=v[n+""],h=0,d=i.args;h<d.length;h++)f=d[h],s.locals[f.name]=w(e[r+(i.args.length-1-f.index)]);if(!p)break;i=p.from,r+=p.stack-i.localsMark}}(h.decodeU32LE(e),u);var t=[u.globals].concat(u.stackframes.map(function(e){return e.locals}));return Promise.map(t,k)}).then(function(){return t.postMessage(u)}));var u}function E(){b=!1,e=new Promise(function(e,t){f=e})}function C(e){return void 0===e&&(e=!1),Promise.resolve().then(function(){return p.talkAsync(i,h.encodeU32LE([e?1:3]))}).then(E)}function _(){return e||(e=Promise.resolve()),e}function U(){return(n?Promise.resolve(n):p.talkAsync(r).then(function(e){return n={numGlobals:c(e,0),globalsPtr:c(e,4)}})).then(function(e){return p.readWordsAsync(e.globalsPtr,e.numGlobals)}).then(function(e){return{staticState:n,globals:e}})}t.taggedUndefined=0,t.taggedNull=l(1),t.taggedFalse=l(2),t.taggedTrue=l(16),t.postMessage=function(e){return console.log(e)},t.decodeValue=w,t.heapExpandAsync=x,t.heapExpandMapAsync=k,t.startDebugAsync=function(l,e){return(p=e).onEvent(s,T),(b=!1,n=g=null,Promise.resolve()).then(function(){v={};for(var e=[],t=0,n=(g=l).procDebugInfo;t<n.length;t++)e[(o=n[t]).idx]=o;for(var r=0,i=l.procDebugInfo;r<i.length;r++)for(var o,a=0,s=(o=i[r]).calls;a<s.length;a++){var c=s[a];v[c.addr+""]={from:o,to:e[c.procIndex],stack:c.stack}}}).then(function(){var e=g.outfiles[pxtc.BINARY_UF2],t=y.stringToUint8Array(atob(e));a=pxtc.UF2.toBin(t);var n=pxtc.UF2.parseFile(t);return p.reflashAsync(n)}).then(function(){return p.talkAsync(o).catch(function(e){})}).then(function(){return Promise.delay(200)}).then(function(){return p.reconnectAsync()}).then(E).then(_)},t.handleMessage=function(e){if(console.log("HWDBGMSG",e),"debugger"==e.type){var t=!1;switch(e.subtype){case"stepinto":t=!0;case"stepover":C(t)}}},t.resumeAsync=C,t.waitForHaltAsync=_,t.getHwStateAsync=U}(S.HWDBG||(S.HWDBG={}))}(pxt||(pxt={})),function(v){var e=function(){function e(){}return e.prototype.logTime=function(){if(this.start){var e=Date.now()-this.start;v.debug("Icon creation: "+e+"ms")}},e.prototype.convert=function(e){this.start||(this.start=Date.now());var t=atob(e.slice(e.indexOf(",")+1)),n=t.charCodeAt(0),r=t.charCodeAt(1),i=t.charCodeAt(2);if(135===n&&(n=224|t.charCodeAt(1),r=t.charCodeAt(2)|t.charCodeAt(3)<<8,i=t.charCodeAt(4)|t.charCodeAt(5)<<8,t=t.slice(4)),225!=n&&228!=n)return null;if(!this.palette){var o=v.appTarget.runtime.palette.map(function(e){var t=parseInt(e.replace(/#/,""),16);return[t>>0&255,t>>8&255,t>>16&255,255]});o[0][3]=0,this.palette=new Uint8Array(4*o.length);for(var a=0;a<o.length;++a)this.palette[4*a+0]=o[a][0],this.palette[4*a+1]=o[a][1],this.palette[4*a+2]=o[a][2],this.palette[4*a+3]=o[a][3]}if(225==n)return this.genMonochrome(t,r,i);var s=(v.BrowserUtils.isEdge()||v.BrowserUtils.isIE())&&r<100&&i<100?3:1;return this.genColor(t,r,i,s)},e.prototype.genMonochrome=function(e,t,n){var r=t+3&-4,i=54+this.palette.length,o=i+r*n,a=new Uint8Array(o);a[0]=66,a[1]=77,v.HF2.write32(a,2,o),v.HF2.write32(a,10,i),v.HF2.write32(a,14,40),v.HF2.write32(a,18,t),v.HF2.write32(a,22,-n),v.HF2.write16(a,26,1),v.HF2.write16(a,28,8),v.HF2.write32(a,38,2835),v.HF2.write32(a,42,2835),v.HF2.write32(a,46,this.palette.length>>2),a.set(this.palette,54);for(var s=4,c=i,l=1,u=e.charCodeAt(s++),f=0;f<t;++f){c=i+f;for(var p=0;p<n;++p)a[c]=u&l?1:0,c+=r,256==(l<<=1)&&(l=1,u=e.charCodeAt(s++))}return"data:image/bmp;base64,"+btoa(v.U.uint8ArrayToString(a))},e.prototype.genColor=function(e,t,n,r){var i=t*(r=Math.max(1,0|r)),o=n*r,a=i<<2,s=138+a*o,c=new Uint8Array(s);c[0]=66,c[1]=77,v.HF2.write32(c,2,s),v.HF2.write32(c,10,138),v.HF2.write32(c,14,124),v.HF2.write32(c,18,i),v.HF2.write32(c,22,-o),v.HF2.write16(c,26,1),v.HF2.write16(c,28,32),v.HF2.write16(c,30,3),v.HF2.write32(c,38,2835),v.HF2.write32(c,42,2835),v.HF2.write32(c,54,16711680),v.HF2.write32(c,58,65280),v.HF2.write32(c,62,255),v.HF2.write32(c,66,4278190080),c[70]=66,c[71]=71,c[72]=82,c[73]=115;for(var l=4,u=138,f=0;f<i;f++){var p=!1;u=138+(f<<2);for(var h=l,d=e.charCodeAt(l++),g=p?(d>>4&15)<<2:(15&d)<<2,m=0;m<o;m++)c[u]=this.palette[g],c[u+1]=this.palette[g+1],c[u+2]=this.palette[g+2],c[u+3]=this.palette[g+3],u+=a,m%r==r-1&&(p&&(d=e.charCodeAt(l++)),g=(p=!p)?(d>>4&15)<<2:(15&d)<<2);if(f%r==r-1)for(n%2||--l;3&l;)l++;else l=h}return"data:image/bmp;base64,"+btoa(v.U.uint8ArrayToString(c))},e}();v.ImageConverter=e}(pxt||(pxt={})),function(h){var d;(d=h.template||(h.template={})).TS_CONFIG='{\n    "compilerOptions": {\n        "target": "es5",\n        "noImplicitAny": true,\n        "outDir": "built",\n        "rootDir": "."\n    },\n    "exclude": ["pxt_modules/**/*test.ts"]\n}\n',d.packageFiles=function(e){var t=h.appTarget.blocksprj||h.appTarget.tsprj,n=h.U.clone(t.config);delete n.installedVersion,delete n.additionalFilePath,delete n.additionalFilePaths,n.preferredEditor=n.files.find(function(e){return/\.blocks$/.test(e)})?h.BLOCKS_PROJECT_NAME:h.JAVASCRIPT_PROJECT_NAME,n.name=e,n.public=!0,n.version||(n.version="0.0.0");var r={},i={"tsconfig.json":d.TS_CONFIG,"test.ts":"// "+lf("tests go here; this will not be compiled when this package is used as an extension.")+"\n",Makefile:"all: deploy\n\nbuild:\n\tpxt build\n\ndeploy:\n\tpxt deploy\n\ntest:\n\tpxt test\n","README.md":"# @NAME@ !["+lf("Build status badge")+"](https://github.com/@REPO@/workflows/MakeCode/badge.svg)\n\n@DESCRIPTION@\n\n## "+lf("Use this extension")+"\n\n"+lf("This repository can be added as an **extension** in MakeCode.")+"\n\n* "+lf("open @HOMEURL@")+"\n* "+lf("click on **New Project**")+"\n* "+lf("click on **Extensions** under the gearwheel menu")+"\n* "+lf("search for the URL of this repository and import")+"\n\n## "+lf("Edit this extension")+"\n\n"+lf("To edit this repository in MakeCode.")+"\n\n* "+lf("open @HOMEURL@")+"\n* "+lf("click on **Import** then click on **Import URL**")+"\n* "+lf("paste the repository URL and click import")+"\n\n## "+lf("Blocks preview")+"\n\n"+lf("This section shows the blocks code from the last commit in master.")+"\n\n!["+lf("A rendered view of the blocks")+"](https://github.com/@REPO@/raw/master/.makecode/blocks.png)\n\n## "+lf("Supported targets")+"\n\n* for PXT/@TARGET@\n* for PXT/@PLATFORM@\n"+lf("(The metadata above is needed for package search.)")+"\n\n",".gitignore":"built\nnode_modules\nyotta_modules\nyotta_targets\npxt_modules\n*.db\n*.tgz\n.header.json\n",".vscode/settings.json":'{\n    "editor.formatOnType": true,\n    "files.autoSave": "afterDelay",\n    "files.watcherExclude": {\n        "**/.git/objects/**": true,\n        "**/built/**": true,\n        "**/node_modules/**": true,\n        "**/yotta_modules/**": true,\n        "**/yotta_targets": true,\n        "**/pxt_modules/**": true\n    },\n    "files.associations": {\n        "*.blocks": "html",\n        "*.jres": "json"\n    },\n    "search.exclude": {\n        "**/built": true,\n        "**/node_modules": true,\n        "**/yotta_modules": true,\n        "**/yotta_targets": true,\n        "**/pxt_modules": true\n    }\n}',".github/workflows/makecode.yml":"name: MakeCode\n\non: [push]\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [8.x]\n\n    steps:\n      - uses: actions/checkout@v1\n      - name: Use Node.js ${{ matrix.node-version }}\n        uses: actions/setup-node@v1\n        with:\n          node-version: ${{ matrix.node-version }}\n      - name: npm install\n        run: |\n          npm install -g pxt\n          pxt target @TARGET@\n      - name: build\n        run: |\n          pxt install\n          pxt build --cloud\n        env:\n          CI: true\n",".vscode/tasks.json":'\n// A task runner that calls the MakeCode (PXT) compiler\n{\n    "version": "2.0.0",\n    "tasks": [{\n        "label": "pxt deploy",\n        "type": "shell",\n        "command": "pxt deploy --local",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt build",\n        "type": "shell",\n        "command": "pxt build --local",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt install",\n        "type": "shell",\n        "command": "pxt install",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt clean",\n        "type": "shell",\n        "command": "pxt clean",\n        "group": "test",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt serial",\n        "type": "shell",\n        "command": "pxt serial",\n        "group": "test",\n        "problemMatcher": [ "$tsc" ]\n    }]\n}\n'};for(var o in i)r[o]=i[o];for(var o in t.files)"README.md"!=o&&(r[o]=t.files[o]);var a=Object.keys(r).filter(function(e){return/\.(blocks|md|ts|asm|cpp|h|py)$/.test(e)});n.files=a.filter(function(e){return!/test/.test(e)}),n.testFiles=a.filter(function(e){return/test/.test(e)});for(var s=n,c={},l=0,u=["name","version","description","license","dependencies","files","testFiles","testDependencies","public","targetVersions","preferredEditor","additionalFilePath","additionalFilePaths"];l<u.length;l++)o=u[l],s.hasOwnProperty(o)&&(c[o]=s[o]);for(var f=0,p=Object.keys(s);f<p.length;f++)o=p[f],c.hasOwnProperty(o)||(c[o]=s[o]);return r[h.CONFIG_NAME]=h.Package.stringifyConfig(c),r},d.packageFilesFixup=function(n,e){var r=JSON.parse(n[h.CONFIG_NAME]);e&&h.Util.jsonMergeFrom(r,e),r.platform=h.appTarget.platformid||h.appTarget.id,r.target=h.appTarget.id,r.docs=h.appTarget.appTheme.homeUrl||"./",r.homeurl=h.appTarget.appTheme.homeUrl||"???",h.U.iterMap(n,function(e,t){t=t.replace(/@([A-Z]+)@/g,function(e,t){return r[t.toLowerCase()]||""}),n[e]=t})}}(pxt||(pxt={})),function(w){!function(e){var d,t,g,n;(t=d=e.NT||(e.NT={}))[t.Prefix=0]="Prefix",t[t.Postfix=1]="Postfix",t[t.Infix=2]="Infix",t[t.Block=3]="Block",t[t.NewLine=4]="NewLine",(n=g=e.GlueMode||(e.GlueMode={}))[n.None=0]="None",n[n.WithSpace=1]="WithSpace",n[n.NoSpace=2]="NoSpace";var r,i=["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with"];function o(e){return"`"+e.replace(/[\\`${}]/g,function(e){return"\\"+e})+"`"}function a(e){return 20<e.length&&/\n/.test(e)?o(e):JSON.stringify(e)}function s(e,t,n){return{type:e,op:t,children:n}}function c(){return s(d.NewLine,"",[])}function l(e,t){return s(d.Prefix,e,t)}function u(e,t,n){return s(d.Infix,t,null==e?[n]:[e,n])}function m(e){return l(e,[])}function f(e){return s(d.Block,"",e)}function v(e){return l("",e)}function p(e,t){void 0===t&&(t=!1);for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];t?(0<n.length&&n.push(m(",")),n.push(c())):0<n.length&&n.push(m(", ")),n.push(o)}return t&&n.push(c()),v(n)}e.backtickLit=o,e.stringLit=a,e.mkNode=s,e.mkNewLine=c,e.mkPrefix=l,e.mkPostfix=function(e,t){return s(d.Postfix,t,e)},e.mkInfix=u,e.mkText=m,e.mkBlock=f,e.mkGroup=v,e.mkStmt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return n&&n.type==d.Block||e.push(c()),v(e)},e.mkCommaSep=p,function(e){function i(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),v(r?[u(t[0],".",m(e)),m("("),p(t.slice(1),n),m(")")]:[m(e),m("("),p(t,n),m(")")])}function n(e,t,n,r){return i(e+"."+t,n,r)}function r(e,t){return w.U.assert(2==t.length),u(t[0],e,t[1])}e.mkArrayLiteral=function(e){return v([m("["),p(e,!1),m("]")])},e.mkNumberLiteral=function(e){return m(e.toString())},e.mkBooleanLiteral=function(e){return m(e?"true":"false")},e.mkStringLiteral=function(e){return m(a(e))},e.mkPropertyAccess=function(e,t){return v([u(t,".",m(e))])},e.mkCall=i,e.stdCall=function(e,t,n){return i(e,t,n)},e.extensionCall=function(e,t,n){return i(e,t,n,!0)},e.namespaceCall=n,e.mathCall=function(e,t){return n("Math",e,t,!1)},e.mkGlobalRef=function(e){return m(e)},e.mkSimpleCall=r,e.mkWhile=function(e,t){return v([m("while ("),e,m(")"),f(t)])},e.mkComment=function(e){return m("// "+e)},e.mkMultiComment=function(e){var r=[m("/**"),c()];return e.split("\n").forEach(function(e,t,n){e&&(r.push(m(" * "+e)),r.push(c()),t<n.length-1&&(r.push(m(" * ")),r.push(c())))}),v(r.concat([m(" */"),c()]))},e.mkAssign=function(e,t){return r("=",[e,t])},e.mkParenthesizedExpression=function(e){return b(h([e]).output)?e:v([m("("),e,m(")")])}}(r=e.Helpers||(e.Helpers={})),e.H=r;var y={"=":3,"+=":3,"-=":3,"?":4,":":4,"||":5,"&&":6,"|":7,"^":8,"&":9,"==":10,"!=":10,"===":10,"!==":10,"<":11,">":11,"<=":11,">=":11,">>":12,">>>":12,"<<":12,"+":13,"-":13,"*":14,"/":14,"%":14,"**":15,"!":16,"~":16,"P-":16,"P+":16,"++":16,"--":16,".":18};function h(e){var o=[],a={},s="",c="",l=[{}];var t=v(e);return function e(t,n){if(t.type==d.Infix){var r=[],i=w.U.lookup(y,t.op);if(null==i&&w.U.oops("bad infix op: "+t.op),i<n&&c("("),1==t.children.length)c(t.op),e(t.children[0],i),r.push(t.children[0]);else{var o=3!=i&&"**"!=t.op;e(t.children[0],o?i:i+.1),r.push(t.children[0]),"."==t.op?c("."):c(" "+t.op+" "),e(t.children[1],o?i+.1:i),r.push(t.children[1])}i<n&&c(")"),t.type=d.Prefix,t.op="",t.children=r}else for(var a=0,s=t.children;a<s.length;a++)e(s[a],-1);function c(e){"P"==e[0]&&(e=e.slice(1)),r.push(m(e))}}(t,-1),u(t),s||(s+="\n"),{output:s,sourceMap:o};function u(e){e.glueToBlock&&(h(),e.glueToBlock==g.WithSpace&&(s+=" "));var t=f();switch(e.type){case d.Infix:w.U.oops("no infix should be left");break;case d.NewLine:s+="\n"+c;break;case d.Block:!function(e){var t=e.noFinalNewline?"":"\n";if(0==e.children.length)return p(" {\n\t\n}"+t);var n=w.U.clone(l[l.length-1]||{});l.push(n),c+="    "," "!=s[s.length-1]&&p(" ");p("{\n");for(var r=0,i=e.children;r<i.length;r++){var o=i[r];u(o)}c=c.slice(4),h(),p("\n}"+t),l.pop()}(e);break;case d.Prefix:e.canIndentInside?s+=e.op.replace(/\n/g,"\n"+c+"    "):s+=e.op,e.children.forEach(u);break;case d.Postfix:e.children.forEach(u),e.canIndentInside?s+=e.op.replace(/\n/g,"\n"+c+"    "):s+=e.op}var n=f();if(e.id)if(a[e.id]){var r=a[e.id];r.start=Math.min(r.start,t),r.end=Math.max(r.end,n)}else{var i={id:e.id,start:t,end:n};a[e.id]=i,o.push(i)}}function f(){var t=0;return s.replace(/\n/g,function(e){return t++,e}),t}function p(e){s+=e.replace(/\n/g,"\n"+c)}function h(){s=s.replace(/\n *$/,"")}}function b(e){if("("!==e[0]||")"!==e[e.length-1])return!1;for(var t=1,n=1;n<e.length;n++){var r=e[n];if("("===r)t++;else if(")"===r&&0===--t)return n===e.length-1}return!1}e.flattenNode=h,e.isReservedWord=function(e){return-1!==i.indexOf(e)},e.isParenthesized=b}(w.blocks||(w.blocks={}))}(pxt||(pxt={})),function(g){var e=function(){function l(e,t,n,r){this.id=e,this._verspec=t,this.parent=n,this.level=-1,this.isLoaded=!1,this.ignoreTests=!1,this.cppOnly=!1,r&&(this.level=r.level+1),this.addedBy=[r]}return l.stringifyConfig=function(e){return JSON.stringify(e,null,4)+"\n"},l.parseAndValidConfig=function(e){var t=g.Util.jsonTryParse(e);return t&&void 0!==t.name&&"string"==typeof t.name&&t.files&&Array.isArray(t.files)&&t.files.every(function(e){return"string"==typeof e})&&t.dependencies&&Object.keys(t.dependencies).every(function(e){return"string"==typeof t.dependencies[e]})&&t},l.getConfigAsync=function(r,i,o){return Promise.resolve().then(function(){if(g.github.isGithubId(o)){var t=g.github.parseRepoId(o);return g.packagesConfigAsync().then(function(e){return g.github.repoAsync(t.fullName,e)}).then(function(e){return e?g.github.pkgConfigAsync(t.fullName,t.tag):null})}var e=g.patching.upgradePackageReference(r,i,o),n=g.appTarget.bundledpkgs[e];return JSON.parse(n[g.CONFIG_NAME])})},l.corePackages=function(){var t=g.appTarget.bundledpkgs;return Object.keys(t).map(function(e){return JSON.parse(t[e][g.CONFIG_NAME])}).filter(function(e){return!!e})},l.prototype.invalid=function(){return/^invalid:/.test(this.version())},l.prototype.version=function(){return this.resolvedVersion||this._verspec},l.prototype.verProtocol=function(){var e=this.version().split(":");return 1<e.length?e[0]:""},l.prototype.verArgument=function(){var e=this.verProtocol();return e?this.version().slice(e.length+1):this.version()},l.prototype.targetVersion=function(){return this.parent&&this.parent!=this?this.parent.targetVersion():this.config.targetVersions?this.config.targetVersions.target:void 0},l.prototype.commonDownloadAsync=function(){var t=this,e=this.verProtocol();if("pub"==e)return g.Cloud.downloadScriptFilesAsync(this.verArgument());if("github"==e)return g.packagesConfigAsync().then(function(e){return g.github.downloadPackageAsync(t.verArgument(),e)}).then(function(e){return e.files});if("embed"==e){var n=g.getEmbeddedScript(this.verArgument());return Promise.resolve(n)}if("pkg"==e){var r=this.readFile(this.verArgument()),i=ts.pxtc.Util.jsonTryParse(r);return i||g.log("unable to find "+this.verArgument()),Promise.resolve(i)}return Promise.resolve(null)},l.prototype.host=function(){return this.parent._host},l.prototype.readFile=function(e){return this.host().readFile(this,e)},l.prototype.readGitJson=function(){var e=this.readFile(g.github.GIT_JSON);return g.Util.jsonTryParse(e)},l.prototype.resolveDep=function(e){return this.parent.deps.hasOwnProperty(e)?this.parent.deps[e]:null},l.prototype.saveConfig=function(){var e=g.U.clone(this.config);delete e.additionalFilePaths;var t=g.Package.stringifyConfig(e);this.host().writeFile(this,g.CONFIG_NAME,t)},l.prototype.setPreferredEditor=function(e){this.config.preferredEditor!=e&&(this.config.preferredEditor=e,this.saveConfig())},l.prototype.getPreferredEditor=function(){var e=this.config.preferredEditor;if(!e){if(!(0<=this.getFiles().indexOf("main.blocks")))return g.JAVASCRIPT_PROJECT_NAME;var t=this.readFile("main.blocks"),n=this.readFile("main.ts");return!t&&n?g.JAVASCRIPT_PROJECT_NAME:g.BLOCKS_PROJECT_NAME}return e},l.prototype.parseJRes=function(e){void 0===e&&(e={});for(var t=0,n=this.getFiles();t<n.length;t++){var r=n[t];if(g.U.endsWith(r,".jres"))for(var i=JSON.parse(this.readFile(r)),o=i["*"]||{},a=0,s=Object.keys(i);a<s.length;a++){var c=s[a];if("*"!=c){var l=i[c];"string"==typeof l&&(l={data:l});var u=l.namespace||o.namespace||"";u&&(u+=".");var f=l.id||u+c,p=l.icon,h=l.mimeType||o.mimeType,d=l.dataEncoding||o.dataEncoding||"base64";p||"base64"!=d||"image/png"!=h&&"image/jpeg"!=h||(p="data:"+h+";base64,"+l.data),e[f]={id:f,data:l.data,dataEncoding:l.dataEncoding||o.dataEncoding||"base64",icon:p,namespace:u,mimeType:h}}}}return e},l.prototype.resolveVersionAsync=function(){var e=this._verspec;return g.getEmbeddedScript(this.id)?this.resolvedVersion=e="embed:"+this.id:e&&"*"!=e||(this.configureAsInvalidPackage(lf("version not specified for {0}",this.id)),e=this._verspec),Promise.resolve(e)},l.prototype.downloadAsync=function(){var t=this;return this.resolveVersionAsync().then(function(e){if(t.invalid())g.debug("skip download of invalid package "+t.id);else if(/^embed:/.test(e)||t.installedVersion!=e)return g.debug("downloading "+e),t.host().downloadPackageAsync(t).then(function(){t.loadConfig(),g.debug("installed "+t.id+" /"+e)})})},l.prototype.loadConfig=function(){if(0==this.level||!this.invalid()){var e=this.readFile(g.CONFIG_NAME);e||g.U.userError("extension "+this.id+" is missing "+g.CONFIG_NAME),this.parseConfig(e),0!=this.level&&(this.installedVersion=this.version()),this.saveConfig()}},l.prototype.validateConfig=function(){this.config.dependencies||g.U.userError("Missing dependencies in config of: "+this.id),Array.isArray(this.config.files)||g.U.userError("Missing files in config of: "+this.id),("string"!=typeof this.config.name||!this.config.name||this.config.public&&!/^[a-z][a-z0-9\-_]+$/i.test(this.config.name))&&g.U.userError("Invalid extension name: "+this.config.name),this.config.targetVersions&&this.config.targetVersions.target&&0<g.semver.majorCmp(this.config.targetVersions.target,g.appTarget.versions.target)&&g.U.userError(lf("{0} requires target version {1} (you are running {2})",this.config.name,this.config.targetVersions.target,g.appTarget.versions.target))},l.prototype.isPackageInUse=function(n,e){void 0===e&&(e=this.readFile("main.ts"));var r=null,t=g.patching.computePatches(this.targetVersion(),"missingPackage");return t&&t.forEach(function(t){Object.keys(t.map).forEach(function(e){t.map[e]===n&&(r=new RegExp(e,"g"))})}),r||(r=new RegExp(n+"\\.","g")),r.test(e)},l.prototype.getMissingPackages=function(i,o){var e=g.patching.computePatches(this.targetVersion(),"missingPackage"),a={};return o&&e&&e.forEach(function(r){Object.keys(r.map).forEach(function(e){var t=new RegExp(e,"g"),n=r.map[e];o.replace(t,function(e){return i.dependencies[n]||(a[n]="*"),""})})}),a},l.prototype.findConflictsAsync=function(e,f){var p,n=this,h=[];return Promise.resolve().then(function(){return"string"==typeof e?l.getConfigAsync(n.targetVersion(),e,f):Promise.resolve(e)}).then(function(e){if(p=e){var u=p.yotta?g.U.jsonFlatten(p.yotta.config):null;n.parent.sortedDeps().forEach(function(e){if(p.core&&e.config.core&&p.name!=e.config.name)return(a=new g.cpp.PkgConflictError(lf("conflict between core extensions {0} and {1}",p.name,e.id))).pkg0=e,void h.push(a);var t=!1;if(u){var n=e.config||JSON.parse(e.readFile(g.CONFIG_NAME));if(!!n&&!!n.yotta&&!!e.config.yotta.config)for(var r=g.U.jsonFlatten(n.yotta.config),i=0,o=Object.keys(u);i<o.length;i++){var a,s=o[i],c=r[s],l=p.yotta.configIsJustDefaults||n.yotta.configIsJustDefaults;if(r.hasOwnProperty(s)&&c!==u[s]&&!l&&(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts))(a=new g.cpp.PkgConflictError(lf("conflict on yotta setting {0} between extensions {1} and {2}",s,p.name,e.id))).pkg0=e,a.settingName=s,h.push(a),t=!0}}t||p.name!==e.id||e._verspec==f||/^file:/.test(e._verspec)||/^file:/.test(f)||((a=new g.cpp.PkgConflictError(lf("version mismatch for extension {0} (installed: {1}, installing: {2})",e,e._verspec,f))).pkg0=e,a.isVersionConflict=!0,h.push(a))})}return Object.keys(p.dependencies).reduce(function(e,t){return e.then(function(){return n.findConflictsAsync(t,p.dependencies[t])}).then(function(e){return h.push.apply(h,e)})},Promise.resolve())}).then(function(){var r=function(e){var t=[];return e.addedBy.forEach(function(e){e.id!==n.id&&(t.push.apply(r(e)),t.push(e))}),t},e=[];return h.forEach(function(n){e.push.apply(e,r(n.pkg0).map(function(e){var t=new g.cpp.PkgConflictError(n.isVersionConflict?lf("a dependency of {0} has a version mismatch with extension {1} (installed: {1}, installing: {2})",e.id,p.name,n.pkg0._verspec,f):lf("conflict on yotta setting {0} between extensions {1} and {2}",n.settingName,p.name,n.pkg0.id));return t.pkg0=e,t}))}),h.push.apply(h,e),h=h.filter(function(e,t){for(var n=0;n<t;++n)if(e.pkg0.id===h[n].pkg0.id)return!1;return!0})})},l.prototype.configureAsInvalidPackage=function(e){g.log("invalid package "+this.id+": "+e),this._verspec="invalid:"+this.id,this.config={name:this.id,description:e,dependencies:{},files:[]}},l.prototype.parseConfig=function(e,t){try{var n=JSON.parse(e);this.config=n}catch(e){this.configureAsInvalidPackage(lf("Syntax error in pxt.json"))}var r=JSON.stringify(this.config);for(var i in this.config.dependencies){var o=g.patching.upgradePackageReference(this.targetVersion(),i,this.config.dependencies[i]);o!=i&&(delete this.config.dependencies[i],o&&(this.config.dependencies[o]="*"))}t&&(this.config.targetVersions={target:t}),JSON.stringify(this.config)!=r&&this.saveConfig(),this.validateConfig()},l.prototype.patchCorePackage=function(){var t=this;g.Util.assert(g.appTarget.simulator&&g.appTarget.simulator.dynamicBoardDefinition),g.Util.assert(0==this.level);var e=Object.keys(this.config.dependencies).filter(function(e){return!!e&&(e==g.BLOCKS_PROJECT_NAME||e==g.JAVASCRIPT_PROJECT_NAME||JSON.parse((g.appTarget.bundledpkgs[e]||{})[g.CONFIG_NAME]||"{}").core)});if(0==e.length){var n=g.Package.corePackages();n.length&&this.config.dependencies[n[0].name]}else 1<e.length&&(e.pop(),e.forEach(function(e){g.log("removing core package "+e),delete t.config.dependencies[e]}))},l.prototype.dependencies=function(e){if(void 0===e&&(e=!1),!this.config)return{};var t=g.Util.clone(this.config.dependencies||{});return 0==this.level&&this.config.testDependencies&&g.Util.jsonMergeFrom(t,this.config.testDependencies),e&&this.config.cppDependencies&&g.Util.jsonMergeFrom(t,this.config.cppDependencies),t},l.prototype.loadAsync=function(a,e){var s=this;if(void 0===a&&(a=!1),this.isLoaded)return Promise.resolve();var t=Promise.resolve();0==this.level&&g.setAppTargetVariant(null),this.isLoaded=!0;var n=this.readFile(g.CONFIG_NAME);null==n?a||g.U.userError("Package not installed: "+this.id+", did you forget to run `pxt install`?"):t=t.then(function(){return s.parseConfig(n)}),a&&(t=t.then(function(){return s.downloadAsync()})),g.appTarget.simulator&&g.appTarget.simulator.dynamicBoardDefinition&&(0==this.level&&(t=t.then(function(){return s.patchCorePackage()})),t=t.then(function(){if(s.config.compileServiceVariant&&g.setAppTargetVariant(s.config.compileServiceVariant),!(s.config.files.indexOf("board.json")<0)){var e=g.appTarget.simulator.boardDefinition=JSON.parse(s.readFile("board.json"));e.id=s.config.name,g.appTarget.appTheme.boardName=e.boardName||lf("board"),g.appTarget.appTheme.driveDisplayName=e.driveDisplayName||lf("DRIVE");var t=function(e){var t=/^pkg:\/\/(.*)/.exec(e);if(t){var n=t[1],r=s.readFile(n);return g.U.toDataUri(r,g.U.getMime(n))}return e},n=g.appTarget.simulator.boardDefinition;if("object"==typeof n.visual){var r=n.visual;r.image=t(r.image),r.outlineImage=t(r.outlineImage)}}}));var c=function(e,i,o){return void 0===o&&(o=!1),g.U.mapStringMapAsync(e||i.dependencies(o),function(e,t){"hw"==e&&g.hwVariant&&(e="hw---"+g.hwVariant);var n=i.resolveDep(e);if(t=t||"*",n)return n.invalid()?(n.level=Math.min(n.level,i.level+1),n.addedBy.push(i)):(n._verspec==t||/^file:/.test(n._verspec)||/^file:/.test(t)||g.U.userError("Version spec mismatch on "+e),o||(n.level=Math.min(n.level,i.level+1),n.addedBy.push(i))),Promise.resolve();var r=new l(e,t,i.parent,i);return o&&(r.cppOnly=!0),i.parent.deps[e]=r,(i.parent.deps[e.replace(/---.*/,"")]=r).loadAsync(a)})};return t.then(function(){return c(null,s)}).then(function(){if(s.config.palette&&g.appTarget.runtime&&(g.appTarget.runtime.palette=g.U.clone(s.config.palette)),s.config.screenSize&&g.appTarget.runtime&&(g.appTarget.runtime.screenSize=g.U.clone(s.config.screenSize)),0===s.level){var e=s.readFile("main.ts");if(!e)return Promise.resolve(null);var o=s.getMissingPackages(s.config,e),a=!1;return Object.keys(o).reduce(function(e,i){return e.then(function(){return s.findConflictsAsync(i,o[i])}).then(function(e){if(e.length){var t=e.map(function(e){return e.pkg0.id}).join(", "),n=e.map(function(e){return e.settingName}).filter(function(e){return!!e}).join(", ");return g.log("skipping missing package "+i+" because it conflicts with the following packages: "+t+" (conflicting settings: "+n+")"),Promise.resolve(null)}g.log("adding missing package "+i),a=!0,s.config.dependencies[i]="*";var r={};return r[i]=o[i],c(r,s)})},Promise.resolve(null)).then(function(){return a&&(s.saveConfig(),s.validateConfig()),Promise.resolve(null)})}return Promise.resolve(null)}).then(function(){return 0!=s.level?Promise.resolve():Promise.all(g.U.values(s.parent.deps).map(function(e){return c(null,e,!0)}))}).then(function(){g.debug("  installed "+s.id)})},l.prototype.getFiles=function(){return 0!=this.level||this.ignoreTests?this.config.files.slice(0):this.config.files.concat(this.config.testFiles||[])},l.prototype.addSnapshot=function(e,n){void 0===n&&(n=[""]);for(var t=function(t){n.some(function(e){return g.U.endsWith(t,e)})&&(e[r.id+"/"+t]=r.readFile(t))},r=this,i=0,o=this.getFiles();i<o.length;i++){t(o[i])}e[this.id+"/"+g.CONFIG_NAME]=this.readFile(g.CONFIG_NAME)},l.prototype.packageLocalizationStringsAsync=function(n){var r=this,i=g.appTarget.id,e=[this.id+"-jsdoc",this.id],o={},a=g.appTarget.appTheme||{};return this.config.skipLocalization?Promise.resolve(o):g.Util.localizeLive&&"this"!=this.id&&g.appTarget.bundledpkgs[this.id]?(g.debug("loading live translations for "+this.id),Promise.all(e.map(function(t){return g.Util.downloadLiveTranslationsAsync(n,i+"/"+t+"-strings.json",a.crowdinBranch).then(function(e){e&&Object.keys(e).length?g.Util.jsonMergeFrom(o,e):(g.tickEvent("translations.livetranslationsfailed",{filename:t}),g.Util.jsonMergeFrom(o,r.bundledStringsForFile(n,t)))}).catch(function(e){g.tickEvent("translations.livetranslationsfailed",{filename:t}),g.log("error while downloading "+i+"/"+t+"-strings.json"),g.Util.jsonMergeFrom(o,r.bundledStringsForFile(n,t))})})).then(function(){return o})):(e.map(function(e){return r.bundledStringsForFile(n,e)}).filter(function(e){return!!e}).forEach(function(e){return g.Util.jsonMergeFrom(o,e)}),Promise.resolve(o))},l.prototype.bundledStringsForFile=function(e,t){var n={},r=g.Util.normalizeLanguageCode(e),i=r[0],o=r[1],a=this.config.files,s="_locales/"+i+"/"+t+"-strings.json";return-1<a.indexOf(s)?n=JSON.parse(this.readFile(s)):o&&(s="_locales/"+o+"/"+t+"-strings.json",-1<a.indexOf(s)&&(n=JSON.parse(this.readFile(s)))),n},l}(),t=function(n){function e(e){var t=n.call(this,"this","file:.",null,null)||this;return t._host=e,t.deps={},(t.parent=t).addedBy=[t],t.level=0,t.deps[t.id]=t}return __extends(e,n),e.prototype.installAllAsync=function(e){return this.loadAsync(!0,e)},e.prototype.sortedDeps=function(n){var r=this;void 0===n&&(n=!1);var i={},o=[],a=function(e){return e.config?Object.keys(e.config.cppDependencies||{}).length:0},s=function(e){if(e&&!g.U.lookup(i,e.id)){i[e.id]=!0;var t=Object.keys(e.dependencies(n)).map(function(e){return r.resolveDep(e)});t.sort(function(e,t){return a(t)-a(e)||g.U.strcmp(e.id,t.id)}),t.forEach(s),o.push(e.id)}};return s(this),o.map(function(e){return r.resolveDep(e)})},e.prototype.localizationStringsAsync=function(t){var n={};return Promise.all(g.Util.values(this.deps).map(function(e){return e.packageLocalizationStringsAsync(t).then(function(t){t&&Object.keys(t).forEach(function(e){n[e]||(n[e]=t[e])})})})).then(function(){var t=g.U.getLocalizedStrings();return Object.keys(n).forEach(function(e){(g.U.startsWith(e,"{id:subcategory}")||g.U.startsWith(e,"{id:group}"))&&(t[e]||(t[e]=n[e]))}),g.U.setLocalizedStrings(t),Promise.resolve(n)})},e.prototype.getTargetOptions=function(){var e=g.U.clone(g.appTarget.compile);return g.U.assert(!!e),e},e.prototype.getJRes=function(){if(!this._jres){this._jres={};for(var e=0,t=this.sortedDeps();e<t.length;e++){t[e].parseJRes(this._jres)}var n=(g.appTarget.runtime&&g.appTarget.runtime.palette?g.appTarget.runtime.palette:["#000000","#ffffff"]).map(function(e){return("000000"+parseInt(e.replace(/#/,""),16).toString(16)).slice(-6)}).join("");this._jres.__palette={id:"__palette",data:n,dataEncoding:"hex",mimeType:"application/x-palette"}}return this._jres},e.prototype.resolveBannedCategories=function(){var t=this;if(void 0!==this._resolvedBannedCategories)return this._resolvedBannedCategories;var n=[];return g.appTarget&&g.appTarget.runtime&&g.appTarget.runtime.bannedCategories&&g.appTarget.runtime.bannedCategories.length&&(n=g.appTarget.runtime.bannedCategories.slice(),Object.keys(this.deps).map(function(e){return t.deps[e]}).filter(function(e){return!!e}).map(function(e){return g.Util.jsonTryParse(e.readFile(g.CONFIG_NAME))}).filter(function(e){return e&&e.requiredCategories}).forEach(function(e){return e.requiredCategories.forEach(function(e){var t=n.indexOf(e);-1<t&&n.splice(t,1)})}),this._resolvedBannedCategories=n),this._resolvedBannedCategories=n,this._resolvedBannedCategories.length||(this._resolvedBannedCategories=null),this._resolvedBannedCategories},e.prototype.getCompileOptionsAsync=function(n){var c=this;void 0===n&&(n=this.getTargetOptions());var l={sourceFiles:[],fileSystem:{},target:n,hexinfo:{hex:[]},name:this.config?this.config.name:""},e=function(e,t){c.config.files.indexOf(e)<0&&g.U.userError(lf("please add '{0}' to \"files\" in {1}",e,g.CONFIG_NAME)),t="// Auto-generated. Do not edit.\n"+t+"\n// Auto-generated. Do not edit. Really.\n",c.host().readFile(c,e,!0)!==t&&(g.debug("updating "+e+" (size="+t.length+")..."),c.host().writeFile(c,e,t,!0))};return this.loadAsync().then(function(){l.bannedCategories=c.resolveBannedCategories(),l.target.preferredEditor=c.getPreferredEditor(),g.debug("building: "+c.sortedDeps().map(function(e){return e.config.name}).join(", "));var t=g.cpp.getExtensionInfo(c);return t.shimsDTS&&e("shims.d.ts",t.shimsDTS),t.enumsDTS&&e("enums.d.ts",t.enumsDTS),(n.isNative?c.host().getHexInfoAsync(t):Promise.resolve(null)).then(function(e){t=g.U.flatClone(t),n.keepCppFiles||(delete t.compileData,delete t.generatedFiles,delete t.extensionFiles),l.extinfo=t,l.hexinfo=e})}).then(function(){return g.appTarget.compile.shortPointers||"vm"==g.appTarget.compile.nativeType||c.config.binaryonly||!l.target.isNative?null:c.filesToBePublishedAsync(!0)}).then(function(e){if(e){var t=JSON.stringify({name:c.config.name,comment:c.config.description,status:"unpublished",scriptId:c.installedVersion,cloudId:g.CLOUD_ID+g.appTarget.id,editor:c.getPreferredEditor(),targetVersions:g.appTarget.versions}),n=JSON.stringify(e);return g.lzmaCompressAsync(t+n).then(function(e){e&&(l.embedMeta=JSON.stringify({compression:"LZMA",headerSize:t.length,textSize:n.length,name:c.config.name,eURL:g.appTarget.appTheme.embedUrl,eVER:g.appTarget.versions?g.appTarget.versions.target:"",pxtTarget:g.appTarget.id}),l.embedBlob=ts.pxtc.encodeBase64(g.U.uint8ArrayToString(e)))})}return Promise.resolve()}).then(function(){for(var e=0,t=c.sortedDeps();e<t.length;e++)for(var n=t[e],r=0,i=n.getFiles();r<i.length;r++){var o=i[r];if(/\.(ts|asm|py)$/.test(o)){var a=o;0<n.level&&(a="pxt_modules/"+n.id+"/"+o),l.sourceFiles.push(a),l.fileSystem[a]=n.readFile(o)}}l.jres=c.getJRes();var s=g.appTarget.runtime&&g.appTarget.runtime.functionsOptions;return l.allowedArgumentTypes=s&&s.extraFunctionEditorTypes&&s.extraFunctionEditorTypes.map(function(e){return e.typeName}).concat("number","boolean","string"),l})},e.prototype.prepareConfigToBePublished=function(){var i=this,o=g.U.clone(this.config);return delete o.installedVersion,delete o.additionalFilePath,delete o.additionalFilePaths,o.targetVersions||(o.targetVersions=g.Util.clone(g.appTarget.versions)),g.U.iterMap(o.dependencies,function(e,t){if(!t||/^(file|workspace):/.test(t)){t="*";try{var n=i.resolveDep(e).readGitJson();if(n&&n.repo){var r=g.github.parseRepoId(n.repo);r.tag=n.commit.tag||n.commit.sha,t=g.github.stringifyRepo(r)}}catch(e){}o.dependencies[e]=t}}),o},e.prototype.filesToBePublishedAsync=function(o){var a=this;void 0===o&&(o=!1);var s={};return this.loadAsync().then(function(){o||a.config.public||g.U.userError('Only packages with "public":true can be published');var e=a.prepareConfigToBePublished();s[g.CONFIG_NAME]=g.Package.stringifyConfig(e);for(var t=0,n=a.getFiles();t<n.length;t++){var r=n[t];if(r!=g.CONFIG_NAME){var i=a.readFile(r);null==i&&g.U.userError("referenced file missing: "+r),s[r]=i}}return g.U.sortObjectFields(s)})},e.prototype.saveToJsonAsync=function(){var t=this;return this.filesToBePublishedAsync(!0).then(function(e){return{meta:{cloudId:g.CLOUD_ID+g.appTarget.id,targetVersions:g.appTarget.versions,editor:t.getPreferredEditor(),name:t.config.name},source:JSON.stringify(e,null,2)}})},e.prototype.compressToFileAsync=function(){return this.saveToJsonAsync().then(function(e){return g.lzmaCompressAsync(JSON.stringify(e,null,2))})},e.prototype.computePartDefinitions=function(o){if(!o||!o.length)return{};var a={};return this.sortedDeps().forEach(function(r){var e=r.readFile("pxtparts.json");if(e)try{var i=JSON.parse(e);Object.keys(i).forEach(function(e){if(0<=o.indexOf(e)){var t=a[e]=i[e];if("string"==typeof t.visual.image&&/\.svg$/i.test(t.visual.image)){var n=r.readFile(t.visual.image);n||g.reportError("parts","invalid part definition",{error:"missing visual "+t.visual.image}),t.visual.image="data:image/svg+xml,"+encodeURIComponent(n)}}})}catch(e){g.reportError("parts","invalid pxtparts.json file")}}),a},e}(g.Package=e);g.MainPackage=t,g.allPkgFiles=function(e){return[g.CONFIG_NAME].concat(e.files||[]).concat(e.testFiles||[])},g.isPkgBeta=function(e){return e&&/\bbeta\b/.test(e.description)}}(pxt||(pxt={})),function(o){var e;(e=o.patching||(o.patching={})).computePatches=function(e,t){var n=o.appTarget.compile?o.appTarget.compile.patches:void 0;if(n){var r=o.semver.tryParse(e||"0.0.0")||o.semver.tryParse("0.0.0"),i=[];return Object.keys(n).filter(function(e){return o.semver.inRange(e,r)}).forEach(function(e){return i=i.concat(n[e])}),t&&(i=i.filter(function(e){return e.type==t})),i.length?i:void 0}},e.upgradePackageReference=function(e,t,n){if("*"!=n)return t;var r=o.patching.computePatches(e,"package"),i=t;return r&&r.forEach(function(t){Object.keys(t.map).forEach(function(e){i==e&&(i=t.map[e])})}),i},e.patchJavaScript=function(e,t){var n=o.patching.computePatches(e),i=t;return n&&(n.filter(function(e){return"api"===e.type}).forEach(function(n){Object.keys(n.map).forEach(function(e){var t=new RegExp(e,"g");i=i.replace(t,n.map[e])})}),n.filter(function(e){return"userenum"===e.type}).forEach(function(r){Object.keys(r.map).forEach(function(e){var t=new RegExp("enum\\s+"+e+"\\s*{","gm");i=i.replace(t,"enum "+r.map[e]+" {");var n=new RegExp("(^|[^_a-zA-Z0-9])"+e+"(\\s*\\.)","g");i=i.replace(n,"$1"+r.map[e]+"$2")})})),i}}(pxt||(pxt={})),function(e){e.react||(e.react={})}(pxt||(pxt={})),function(f){!function(n){function s(e,t){if(e){if(t){var n=e.major-t.major||e.minor-t.minor||e.patch-t.patch;if(n)return n;if(0==e.pre.length&&0<t.pre.length)return 1;if(0<e.pre.length&&0==t.pre.length)return-1;for(var r=0;r<e.pre.length+1;++r){var i=e.pre[r],o=t.pre[r];if(!i)return o?-1:0;if(!o)return 1;if(/^\d+$/.test(i)){if(!/^\d+$/.test(o))return-1;if(n=parseInt(i)-parseInt(o))return n}else{if(/^\d+$/.test(o))return 1;if(n=f.U.strcmp(i,o))return n}}return 0}return-1}return t?1:0}function a(e){var t=c(e);return t||f.U.userError(f.U.lf("'{0}' doesn't look like a semantic version number",e)),t}function c(e){if("*"===e)return{major:Number.MAX_SAFE_INTEGER,minor:Number.MAX_SAFE_INTEGER,patch:Number.MAX_SAFE_INTEGER,pre:[],build:[]};/^v\d/i.test(e)&&(e=e.slice(1));var t=/^(\d+)\.(\d+)\.(\d+)(-([0-9a-zA-Z\-\.]+))?(\+([0-9a-zA-Z\-\.]+))?$/.exec(e);return t?{major:parseInt(t[1]),minor:parseInt(t[2]),patch:parseInt(t[3]),pre:t[5]?t[5].split("."):[],build:t[7]?t[7].split("."):[]}:null}function l(e){var t=e.major+"."+e.minor+"."+e.patch;return e.pre.length&&(t+="-"+e.pre.join(".")),e.build.length&&(t+="+"+e.build.join(".")),t}function r(e,t){var n=c(e),r=c(t);return n||r?s(n,r):f.U.strcmp(e,t)}function u(e,t){var n=e.split(" - ");if(2!=n.length)return!1;var r=c(n[0]),i=c(n[1]);if(!r||!i)return!1;if(!t)return!0;var o=s(r,t),a=s(t,i);return o<=0&&a<0}n.cmp=s,n.parse=a,n.tryParse=c,n.normalize=function(e){return l(a(e))},n.stringify=l,n.majorCmp=function(e,t){var n=c(e),r=c(t);return n.major-r.major},n.strcmp=r,n.inRange=u,n.sortLatestTags=function(e){var t=e.filter(function(e){return!!n.tryParse(e)});return t.sort(r),t.reverse(),t},n.test=function(){console.log("Test semver");for(var e=["0.9.0","1.0.0-0.3.7","1.0.0-alpha","1.0.0-alpha.1","1.0.0-alpha.beta","1.0.0-beta","1.0.0-beta.2","1.0.0-beta.11","1.0.0-rc.1","1.0.0-x.7.z.92","1.0.0","1.0.1","1.9.0","1.10.0","1.11.0"],t=0;t<e.length;++t){var n=a(e[t]);console.log(e[t],n),f.U.assert(l(n)==e[t]);for(var r=0;r<e.length;++r){var i=s(n,a(e[r]));console.log(e[t],e[r],i),t<r?f.U.assert(i<0):r<t?f.U.assert(0<i):f.U.assert(0==i)}}var o=c("1.2.3");f.U.assert(u("0.1.2 - 2.2.3",o)),f.U.assert(u("1.2.3 - 2.2.3",o)),f.U.assert(!u("0.0.0 - 1.2.3",o)),f.U.assert(!u("1.2.4 - 4.2.3",o)),f.U.assert(!u("0.0.0 - 0.0.1",o))}}(f.semver||(f.semver={}))}(pxt||(pxt={})),function(e){!function(O){O.assert=O.Util.assert,O.oops=O.Util.oops,O.U=O.Util,O.ON_START_TYPE="pxt-on-start",O.ON_START_COMMENT="on start",O.HANDLER_COMMENT="code goes here",O.TS_STATEMENT_TYPE="typescript_statement",O.TS_DEBUGGER_TYPE="debugger_keyword",O.TS_BREAK_TYPE="break_keyword",O.TS_CONTINUE_TYPE="continue_keyword",O.TS_OUTPUT_TYPE="typescript_expression",O.PAUSE_UNTIL_TYPE="pxt_pause_until",O.COLLAPSED_BLOCK="pxt_collapsed_block",O.FUNCTION_DEFINITION_TYPE="function_definition",O.BINARY_JS="binary.js",O.BINARY_ASM="binary.asm",O.BINARY_HEX="binary.hex",O.BINARY_UF2="binary.uf2",O.BINARY_ELF="binary.elf",O.BINARY_PXT64="binary.pxt64",O.NATIVE_TYPE_THUMB="thumb",O.NATIVE_TYPE_VM="vm",O.computeUsedParts=function(r,e){if(void 0===e&&(e=!1),!r.usedSymbols||!pxt.appTarget.simulator||!pxt.appTarget.simulator.parts)return[];var i=[];if(Object.keys(r.usedSymbols).forEach(function(e){var t=r.usedSymbols[e];if(t&&t.attributes.parts){var n=t.attributes.parts;n&&n.split(/[ ,]+/).forEach(function(e){0<e.length&&i.indexOf(e)<0&&i.push(e)})}}),e){var t=pxt.appTarget.simulator.boardDefinition.onboardComponents;t&&(i=i.filter(function(e){return t.indexOf(e)<0}))}return i.sort(),i=i.reverse()},O.blocksCategory=function(e){var t=e?e.attributes.blockNamespace||e.namespace:void 0;return t?O.Util.capitalize(t.split(".")[0]):void 0},O.getBlocksInfo=function(e,t){var n,g=[],m={},v={},y={},r={},i={};function o(e,t){var n="get"==e,r="set"==e,i="number"==t.retType,o=n?v:r?m:y,a=t.namespace+"."+t.retType,s=O.U.lookup(o,a);if(!s){var c="@"+e+"@",l=void 0,u=void 0;if(t.attributes.blockCombineShadow){var f=t.attributes.blockCombineShadow,p=f.match(/^([^,.]*),?([^,.]*)$/);p&&3==p.length&&(l=p[1].trim(),0!=(u=p[2].trim()).length||O.Util.endsWith(f,",")||(u=l,l=""))}var h=(t.attributes.blockSetVariable||t.namespace.toLocaleLowerCase())+"="+(l||""),d="value="+(u||"");(s=o[a]={attributes:{blockId:(i?t.namespace:a)+"_blockCombine_"+e,callingConvention:0,group:t.attributes.group,paramDefl:{},jsDoc:n?O.U.lf("Read value of a property on an object"):O.U.lf("Update value of property on an object")},name:c,namespace:t.namespace,fileName:t.fileName,qName:a+"."+c,pkg:t.pkg,kind:2,parameters:[{name:"property",description:n?O.U.lf("the name of the property to read"):O.U.lf("the name of the property to change"),isEnum:!0,type:"@combined@"},{name:"value",description:r?O.U.lf("the new value of the property"):O.U.lf("the amount by which to change the property"),type:t.retType}].slice(0,n?1:2),retType:n?t.retType:"void",combinedProperties:[]}).attributes.block=n?"%"+h+" %property":r?"set %"+h+" %property to %"+d:"change %"+h+" %property by %"+d,I(s.attributes),g.push(s)}s.combinedProperties.push(t.qName)}for(var a=0,s=O.Util.values(e.byQName);a<s.length;a++){var c=s[a];if("ENUM_GET"===c.attributes.shim&&c.attributes.enumName&&c.attributes.blockId){var l=!1;if(r[c.attributes.enumName]&&(console.warn("Enum block "+c.attributes.blockId+" trying to overwrite enum "+c.attributes.enumName),l=!0),c.attributes.enumMemberName||(console.warn("Enum block "+c.attributes.blockId+" should specify enumMemberName"),l=!0),c.attributes.enumPromptHint||(console.warn("Enum block "+c.attributes.blockId+" should specify enumPromptHint"),l=!0),c.attributes.enumInitialMembers&&c.attributes.enumInitialMembers.length||(console.warn("Enum block "+c.attributes.blockId+" should specify enumInitialMembers"),l=!0),l)continue;var u=parseInt(c.attributes.enumStartValue);r[c.attributes.enumName]={blockId:c.attributes.blockId,name:c.attributes.enumName,memberName:c.attributes.enumMemberName,firstValue:isNaN(u)?void 0:u,isBitMask:c.attributes.enumIsBitMask,isHash:c.attributes.enumIsHash,initialMembers:c.attributes.enumInitialMembers,promptHint:c.attributes.enumPromptHint}}if("KIND_GET"===c.attributes.shim&&c.attributes.blockId){var f=c.attributes.kindNamespace||c.attributes.blockNamespace||c.namespace;if(i[f]){console.warn("More than one block defined for kind "+f);continue}var p=[];if(e.byQName[f])for(var h=0,d=O.Util.values(e.byQName);h<d.length;h++){var b=d[h];b.namespace===f&&b.attributes.isKind&&p.push(b.name)}i[f]={blockId:c.attributes.blockId,name:f,memberName:c.attributes.kindMemberName||f,initialMembers:p,promptHint:c.attributes.enumPromptHint||O.Util.lf("Create a new kind..."),createFunctionName:c.attributes.kindCreateFunction||"create"}}if(c.attributes.blockCombine)/@set/.test(c.name)||o("get",c),c.isReadOnly||("number"==c.retType&&o("change",c),o("set",c));else if(c.attributes.block&&!c.attributes.fixedInstance&&7!=c.kind&&5!=c.kind&&9!=c.kind&&8!=c.kind){if(c.attributes.blockId||(c.attributes.blockId=c.qName.replace(/\./g,"_")),"true"==c.attributes.block){var w=O.U.uncapitalize(c.name);1!=c.kind&&2!=c.kind||(w+=" %"+c.namespace.toLowerCase());for(var x=0,k=c.parameters||[];x<k.length;x++)w+=" %"+k[x].name;c.attributes.block=w,I(c.attributes)}g.push(c)}}for(var A=0,T=g;A<T.length;A++){w=T[A];var E=O.U.lookup(e.byQName,w.namespace);if(E)for(var C=E.attributes,_=w.attributes,U=0,S=["blockNamespace","color","blockGap"];U<S.length;U++){var P=S[U];void 0===_[P]&&C[P]&&(_[P]=C[P])}}return t&&(n=t).length&&(g=g.filter(function(e){var t=(e.attributes.blockNamespace||e.namespace).split(".")[0];return-1===n.indexOf(t)})),{apis:e,blocks:g,blocksById:pxt.Util.toDictionary(g,function(e){return e.attributes.blockId}),enumsByName:r,kindsByName:i}},O.apiLocalizationStrings={},O.localizeApisAsync=function(l,e){var u=O.Util.userLanguage();if("en"==O.Util.userLanguage())return Promise.resolve(l);var f={},p=u.toLowerCase(),h=p+"|jsdoc",d=p+"|block";return e.localizationStringsAsync(u).then(function(c){return Promise.all(O.Util.values(l.byQName).map(function(r){O.apiLocalizationStrings&&O.Util.jsonMergeFrom(c,O.apiLocalizationStrings);var t=r.attributes.locs||{},e=c[r.qName]||t[h];e&&(r.attributes.jsDoc=e,r.parameters&&r.parameters.forEach(function(e){return e.description=c[r.qName+"|param|"+e.name]||t[p+"|param|"+e.name]||e.description}));var i=c["{id:category}"+O.Util.capitalize(r.qName)],o=c[r.qName+"|block"]||t[d];if(!o&&r.attributes.useLoc){var n=l.byQName[r.attributes.useLoc];if(n){var a=c[n.qName+"|block"];r.attributes.block===(n.attributes._untranslatedBlock||n.attributes.block)&&a&&(o=a)}}var s=Promise.resolve();return o&&pxt.Util.isTranslationMode()&&(r.attributes.translationId=o,s=s.then(function(){return pxt.crowdin.inContextLoadAsync(o)}).then(function(e){o=e})),s.then(function(){if(i)r.attributes.block?r.attributes.block=o||r.attributes.block:r.attributes.block=i;else if(r.attributes.block&&o){var e=pxt.blocks.compileInfo(r),t=r.attributes.block;if(r.attributes.block=pxt.blocks.normalizeBlock(o,function(e){return f[r.attributes.blockId+"."+u]=1}),(r.attributes._untranslatedBlock=t)!=r.attributes.block){var n=pxt.blocks.compileInfo(r);JSON.stringify(e)!=JSON.stringify(n)&&(pxt.log("block has non matching arguments: "+t+" vs "+r.attributes.block),r.attributes.block=t)}}I(r.attributes)})}))}).then(function(){return l}).finally(function(){Object.keys(f).length&&pxt.reportError("loc.errors","invalid translation",f)})},O.emptyExtInfo=function(){var e=pxt.appTarget.compileService;e||(e={});var t=!!e.platformioIni,n="dockermake"==e.buildEngine||"dockercross"==e.buildEngine,r={functions:[],generatedFiles:{},extensionFiles:{},sha:"",compileData:"",shimsDTS:"",enumsDTS:"",onlyPublic:!0};return t?r.platformio={dependencies:{}}:n?r.npmDependencies={}:r.yotta={config:{},dependencies:{}},r};var t,a=["weight","imageLiteral","topblockWeight"],s=["advanced","handlerStatement","afterOnStart","optionalVariableArgs","blockHidden","constantShim","blockCombine","enumIsBitMask","enumIsHash","decompileIndirectFixedInstances","topblock","callInDebugger","duplicateShadowOnDrag","argsNullable"];function I(n){if(n.block){var e=n.block.split("||");n._def=t(r(e[0])),n._def||pxt.debug("Unable to parse block def for id: "+n.blockId),e[1]&&(n._expandedDef=t(r(e[1]))),e[1]&&!n._expandedDef&&pxt.debug("Unable to parse expanded block def for id: "+n.blockId)}function t(e){return n._shadowOverrides&&e.parameters.forEach(function(e){var t=n._shadowOverrides[e.name];"unset"===t?delete e.shadowBlockId:null!=t&&(e.shadowBlockId=t)}),e}}function r(f){for(var p,h=[],d=0,e=function(){var t=f[d],e=d,n=void 0;switch(t){case"*":case"_":var r=m(function(e){return e==t}),i="_"===t?2:0;1===r.length?n={kind:1<<i,content:r}:2===r.length?n={kind:2<<i,content:r}:3===r.length?n={kind:3<<i,content:r}:d=e;break;case"`":var o=v("`");if(void 0===o){d=e;break}n={kind:256,content:o};break;case"|":n={kind:32};break;case"\\":d<f.length-1&&(n={kind:16,content:f[1+d++]});break;case"[":var a=v("]");if(void 0!==a&&"("===f[1+d++]){var s=v(")");if(void 0!==s){n={kind:512,content:a,type:s};break}}d=e;break;case"$":case"%":var c=m(function(e){return/[a-zA-Z0-9_=]/.test(e)},!0).split("=");if(2<c.length){d=e;break}var l=void 0;if("("===f[d+1]){var u=d;++d,(l=v(")"))||(d=u)}n={kind:"$"===t?1024:64,content:c[0],type:c[1],name:l}}n?(p&&h.push({kind:128,content:p}),p=void 0,h.push(n)):p?p+=t:p=t};d<f.length;d++)e();p&&h.push({kind:128,content:p});for(var n=[],t=[],o=[],a=0,r="",s=[],i=0;i<h.length;i++){var c=h[i].kind,l=o[o.length-1];if(15&c)if(w(h[i].content),c&a)if(l&c){o.pop();var u=l&(a^=c)|c&a;u&&o.push(u)}else y();else a|=c,o.push(c);else 144&c?r+=h[i].content:1120&c&&b();if(64==c){var g={kind:"param",name:h[i].content,shadowBlockId:h[i].type,ref:!1};h[i].name&&(g.varName=h[i].name),n.push(g),t.push(g)}else if(1024==c){g={kind:"param",name:h[i].content,shadowBlockId:h[i].type,ref:!0};h[i].name&&(g.varName=h[i].name),n.push(g),t.push(g)}else 256==c?(w(),s.push({kind:"image",uri:h[i].content})):512==c?(w(),s.push({kind:"label",text:h[i].content,cssClass:h[i].type})):32==c&&n.push({kind:"break"})}return b(),{parts:n,parameters:t};function m(e,t){void 0===t&&(t=!1);var n="";for(t&&d++;d<f.length&&e(f[d]);)n+=f[d],++d;return n&&d--,n}function v(t){var e=m(function(e){return e!==t},!0);if(f[d+1]===t)return++d,e}function y(){for(var e="",t=[],n=0,r=s;n<r.length;n++){var i=r[n];x(i)?(t.push({content:e,styles:0}),t.push(i),e=""):(e+=i.content,i.endingToken&&(e+=i.endingToken))}s=t,e&&s.push({content:e,styles:0}),o=[],a=0}function b(){for(w(),a&&y();s.length;){var e=s.shift();if(x(e))n.push(e);else{if(!e.content)continue;var t=[];10&e.styles&&t.push("bold"),5&e.styles&&t.push("italics"),n.push({kind:"label",text:e.content,style:t})}}}function w(e){s.push({content:r,styles:a,endingToken:e}),r=""}}function x(e){return!!e.kind}O.parseCommentString=function(e){for(var p={paramDefl:{},callingConvention:0,_source:e},h=!0;h;)h=!1,e=e.replace(/\/\/%[ \t]*([\w\.]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/,function(e,t,n,r,i,o,a){var s=i?JSON.parse(i):n?i||o||a:"true";if(s||(s=""),O.U.startsWith(t,"block.loc."))p.locs||(p.locs={}),p.locs[t.slice("block.loc.".length).toLowerCase()+"|block"]=s;else if(O.U.startsWith(t,"jsdoc.loc."))p.locs||(p.locs={}),p.locs[t.slice("jsdoc.loc.".length).toLowerCase()+"|jsdoc"]=s;else if(O.U.contains(t,".loc.")){p.locs||(p.locs={});var c=t.slice(0,t.indexOf(".loc.")),l=t.slice(t.indexOf(".loc.")+".loc.".length);p.locs[l+"|param|"+c]=s}else if(O.U.endsWith(t,".defl"))-1<s.indexOf(" ")?p.paramDefl[t.slice(0,t.length-5)]='"'+s+'"':p.paramDefl[t.slice(0,t.length-5)]=s,p.explicitDefaults||(p.explicitDefaults=[]),p.explicitDefaults.push(t.slice(0,t.length-5));else if(O.U.endsWith(t,".shadow"))p._shadowOverrides||(p._shadowOverrides={}),p._shadowOverrides[t.slice(0,t.length-7)]=s;else if(O.U.endsWith(t,".fieldEditor"))p.paramFieldEditor||(p.paramFieldEditor={}),p.paramFieldEditor[t.slice(0,t.length-12)]=s;else if(O.U.contains(t,".fieldOptions.")){p.paramFieldEditorOptions||(p.paramFieldEditorOptions={});var u=t.slice(0,t.indexOf(".fieldOptions.")),f=t.slice(t.indexOf(".fieldOptions.")+14,t.length);p.paramFieldEditorOptions[u]||(p.paramFieldEditorOptions[u]={}),p.paramFieldEditorOptions[u][f]=s}else O.U.contains(t,".shadowOptions.")?(p.paramShadowOptions||(p.paramShadowOptions={}),u=t.slice(0,t.indexOf(".shadowOptions.")),f=t.slice(t.indexOf(".shadowOptions.")+15,t.length),p.paramShadowOptions[u]||(p.paramShadowOptions[u]={}),p.paramShadowOptions[u][f]=s):O.U.endsWith(t,".min")?(p.paramMin||(p.paramMin={}),p.paramMin[t.slice(0,t.length-4)]=s):O.U.endsWith(t,".max")?(p.paramMax||(p.paramMax={}),p.paramMax[t.slice(0,t.length-4)]=s):p[t]=s;return h=!0,"//% "});for(var t=0,n=a;t<n.length;t++){var r=n[t];"string"==typeof p[r]&&(p[r]=parseInt(p[r]))}for(var i=0,o=s;i<o.length;i++)r=o[i],"string"==typeof p[r]&&(p[r]="true"==p[r]||"1"==p[r]);if(p.trackArgs&&(p.trackArgs=p.trackArgs.split(/[ ,]+/).map(function(e){return parseInt(e)||0})),p.enumInitialMembers&&(p.enumInitialMembers=p.enumInitialMembers.split(/[ ,]+/)),p.blockExternalInputs&&!p.inlineInputMode&&(p.inlineInputMode="external"),p.paramHelp={},p.jsDoc="",e=e.replace(/\/\*\*([^]*?)\*\//g,function(e,t){return t=(t=t.replace(/\n\s*(\*\s*)?/g,"\n")).replace(/^\s*@param\s+(\w+)\s+(.*)$/gm,function(e,t,n){if(p.paramHelp[t]=n,!p.paramDefl[t]){var r=/\beg\.?:\s*(.+)/.exec(n);if(r&&r[1]){var i=/(?:"([^"]*)")|(?:'([^']*)')|(?:([^\s,]+))/g.exec(r[1]);if(i){var o=i[1]||i[2]||i[3];o||(o=""),-1<o.indexOf(" ")?p.paramDefl[t]='"'+o+'"':p.paramDefl[t]=o}}}return""}),p.jsDoc+=t,""}),p.jsDoc=p.jsDoc.trim(),p.async&&(p.callingConvention=1),p.promise&&(p.callingConvention=2),p.jres&&(p.whenUsed=!0),p.subcategories)try{p.subcategories=JSON.parse(p.subcategories)}catch(e){p.subcategories=void 0}if(p.groups)try{p.groups=JSON.parse(p.groups)}catch(e){p.groups=void 0}if(p.groupIcons)try{p.groupIcons=JSON.parse(p.groupIcons)}catch(e){p.groupIcons=void 0}if(p.groupHelp)try{p.groupHelp=JSON.parse(p.groupHelp)}catch(e){p.groupHelp=void 0}return I(p),p},O.updateBlockDef=I,O.parseBlockDefinition=r,(t=O.hex||(O.hex={})).isSetupFor=function(e){return t.currentSetup==e.sha},t.currentSetup=null,t.parseChecksumBlock=function(e,t){void 0===t&&(t=0);var n=pxt.HF2.read32(e,t);if(133083260!=(2147483647&n))return pxt.log("no checksum block magic"),null;var r=pxt.HF2.read32(e,t+4),i=pxt.HF2.read32(e,t+8);if(3&r)return pxt.log("invalid end marker position"),null;var o=1<<(255&i);if(o!=pxt.appTarget.compile.flashCodeAlign)return pxt.log("invalid page size: "+o),null;for(var a={magic:n,endMarkerPos:r,endMarker:i,regions:[]},s=t+12;s<e.length-7;s+=8){var c={start:o*pxt.HF2.read16(e,s),length:o*pxt.HF2.read16(e,s+2),checksum:pxt.HF2.read32(e,s+4)};if(!c.length||!c.checksum)break;a.regions.push(c)}return a},function(p){function v(t){var e=function(e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)>>>0};if(!t||512!=t.length||e(0)!=p.UF2_MAGIC_START0||e(4)!=p.UF2_MAGIC_START1||e(t.length-4)!=p.UF2_MAGIC_END)return null;var n=e(8),r=e(16);476<r&&(r=256);var i=null,o=0,a=0;if(n&p.UF2_FLAG_FILE){var s=t.slice(32+r),c=s.indexOf(0);0<=c&&(s=s.slice(0,c)),i=O.U.fromUTF8(O.U.uint8ArrayToString(s)),a=e(28)}return n&p.UF2_FLAG_FAMILY_ID_PRESENT&&(o=e(28)),{flags:n,targetAddr:e(12),payloadSize:r,blockNo:e(20),numBlocks:e(24),fileSize:a,familyId:o,data:t.slice(32,32+r),filename:i}}function a(e,t){return!!e&&(e.targetAddr<=t&&t<e.targetAddr+e.payloadSize)}function h(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function s(e){return"string"==typeof e&&(e=parseInt(e)),{currBlock:null,currPtr:-1,blocks:[],ptrs:[],filesize:0,familyId:e||0}}function c(e){for(var t=0;t<e.blocks.length;++t)h(e.blocks[t],20,t),h(e.blocks[t],24,e.blocks.length),e.filename&&h(e.blocks[t],28,e.filesize)}function d(e,t,n,r){void 0===r&&(r=0);var i=e.currBlock,o=t>>8,a=256-(255&t);if(n.length>a){var s=new Uint8Array(n);for(d(e,t,s.slice(0,a));a<n.length;){var c=Math.min(a+256,n.length);d(e,t+a,s.slice(a,c)),a=c}}else{if(o!=e.currPtr){var l=0;i=null;for(var u=0;u<e.ptrs.length;++u)if(e.ptrs[u]==o){i=e.blocks[u];break}i||(i=new Uint8Array(512),e.filename?r|=p.UF2_FLAG_FILE:e.familyId&&(r|=p.UF2_FLAG_FAMILY_ID_PRESENT),h(i,0,p.UF2_MAGIC_START0),h(i,4,p.UF2_MAGIC_START1),h(i,8,r),h(i,12,o<<8),h(i,16,256),h(i,20,e.blocks.length),h(i,28,e.familyId),h(i,508,p.UF2_MAGIC_END),e.filename&&O.U.memcpy(i,288,O.U.stringToUint8Array(O.U.toUTF8(e.filename))),e.blocks.push(i),e.ptrs.push(o)),e.currPtr=o,e.currBlock=i}var f=32+(255&t);for(l=0;l<n.length;++l)i[f+l]=n[l];e.filesize=Math.max(e.filesize,n.length+t)}}p.UF2_MAGIC_START0=171066965,p.UF2_MAGIC_START1=2656915799,p.UF2_MAGIC_END=179400496,p.UF2_FLAG_NONE=0,p.UF2_FLAG_NOFLASH=1,p.UF2_FLAG_FILE=4096,p.UF2_FLAG_FAMILY_ID_PRESENT=8192,p.parseBlock=v,p.parseFile=function(e){for(var t=[],n=0;n<e.length;n+=512){var r=v(e.slice(n,n+512));r&&t.push(r)}return t},p.toBin=function(e,t){if(void 0===t&&(t=void 0),e.length<512)return null;for(var n=-1,r=-1,i=[],o=0;o<e.length;++o){var a=512*o,s=v(e.slice(a,a+512));if(s){if(t&&s.targetAddr+256>t)break;-1==n&&(r=n=s.targetAddr);var c=s.targetAddr-n;c<0||c%4||1048576<c||(0<c&&i.push(new Uint8Array(c)),i.push(e.slice(a+32,a+32+s.payloadSize)),n=s.targetAddr+s.payloadSize)}}for(var l=0,u=0,f=i;u<f.length;u++)l+=(m=f[u]).length;if(0==l)return null;for(var p=new Uint8Array(l),h=0,d=0,g=i;d<g.length;d++){var m=g[d];for(o=0;o<m.length;++o)p[h++]=m[o]}return{buf:p,start:r}},p.readBytes=function(e,t,n){for(var r,i=new Uint8Array(n),o=0;o<n;++o,++t)a(r,t)||(r=e.filter(function(e){return a(e,t)})[0]),r&&(i[o]=r.data[t-r.targetAddr]);return i},p.newBlockFile=s,p.finalizeFile=c,p.concatFiles=function(e){for(var t=0,n=e;t<n.length;t++)c(a=n[t]),a.filename=null;var r=s();r.blocks=O.U.concat(e.map(function(e){return e.blocks}));for(var i=0,o=e;i<o.length;i++){var a;(a=o[i]).blocks=[]}return r},p.serializeFile=function(e){c(e);for(var t="",n=0,r=e.blocks;n<r.length;n++){var i=r[n];t+=O.Util.uint8ArrayToString(i)}return t},p.readBytesFromFile=function e(t,n,r){var i,o=n>>8;if(o==t.currPtr)i=t.currBlock;else{for(var a=0;a<t.ptrs.length;++a)if(t.ptrs[a]==o){i=t.blocks[a];break}i&&(t.currPtr=o,t.currBlock=i)}if(!i)return null;var s=new Uint8Array(r),c=Math.min(r,256-(255&n));O.U.memcpy(s,0,i,32+(255&n),c);var l=r-c;if(0<l){var u=e(t,n+c,l);O.U.memcpy(s,c,u)}return s},p.writeBytes=d,p.writeHex=function(e,t){for(var n="0000",r=0;r<t.length;++r){var i=/:02000004(....)/.exec(t[r]);if(i&&(n=i[1]),i=/^:..(....)00(.*)[0-9A-F][0-9A-F]$/.exec(t[r])){for(var o=parseInt(n+i[1],16),a=i[2],s=[],c=0;c<a.length;c+=2)s.push(parseInt(a[c]+a[c+1],16));d(e,o,s)}}}}(O.UF2||(O.UF2={}))}(e.pxtc||(e.pxtc={}))}(ts||(ts={})),function(e){!function(e){var o=[".","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],f=function(){function s(e,t,n,r,i){void 0===n&&(n=0),void 0===r&&(r=0),this.width=e,this.height=t,this.x0=n,this.y0=r,this.buf=i||new Uint8Array(Math.ceil(e*t/2))}return s.fromData=function(e){return new s(e.width,e.height,e.x0,e.y0,e.data)},s.prototype.set=function(e,t,n){if(e<this.width&&t<this.height&&0<=e&&0<=t){var r=this.coordToIndex(e,t);this.setCore(r,n)}},s.prototype.get=function(e,t){if(e<this.width&&t<this.height&&0<=e&&0<=t){var n=this.coordToIndex(e,t);return this.getCore(n)}return 0},s.prototype.copy=function(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=this.width),void 0===r&&(r=this.height);var i=new s(n,r);i.x0=e,i.y0=t;for(var o=0;o<n;o++)for(var a=0;a<r;a++)i.set(o,a,this.get(e+o,t+a));return i},s.prototype.apply=function(e,t){var n;void 0===t&&(t=!1);for(var r=0;r<e.width;r++)for(var i=0;i<e.height;i++)!(n=e.get(r,i))&&t||this.set(e.x0+r,e.y0+i,n)},s.prototype.equals=function(e){if(this.width===e.width&&this.height===e.height&&this.x0===e.x0&&this.y0===e.y0&&this.buf.length===e.buf.length){for(var t=0;t<this.buf.length;t++)if(this.buf[t]!==e.buf[t])return!1;return!0}return!1},s.prototype.data=function(){return{width:this.width,height:this.height,x0:this.x0,y0:this.y0,data:this.buf}},s.prototype.resize=function(e,t){return n(this,e,t)},s.prototype.coordToIndex=function(e,t){return e+t*this.width},s.prototype.getCore=function(e){var t=Math.floor(e/2);return e%2==0?15&this.buf[t]:(240&this.buf[t])>>4},s.prototype.setCore=function(e,t){var n=Math.floor(e/2);this.buf[n]=e%2==0?240&this.buf[n]|15&t:15&this.buf[n]|(15&t)<<4},s}();e.Bitmap=f;var t=function(){function e(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}return e.prototype.set=function(e,t){var n=e+this.width*t,r=n>>3,i=7&n;this.mask[r]|=1<<i},e.prototype.get=function(e,t){var n=e+this.width*t,r=n>>3,i=7&n;return this.mask[r]>>i&1},e}();function n(e,t,n){var r=new f(t,n);return r.apply(e),r}e.Bitmask=t,e.resizeBitmap=n,e.imageLiteralToBitmap=function(e,t){!(e=(e=(e=e.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:img)/g,"").trim()).replace(/^["`\(\)]*/,"").replace(/["`\(\)]*$/,"")).replace(/&#10;/g,"\n"))&&t&&(e=t);for(var n=e.split("\n"),r=[],i=0,o=0;o<n.length;o++){for(var a=n[o],s=[],c=0;c<a.length;c++)switch(a[c]){case"0":case".":s.push(0);break;case"1":case"#":s.push(1);break;case"2":case"T":s.push(2);break;case"3":case"t":s.push(3);break;case"4":case"N":s.push(4);break;case"5":case"n":s.push(5);break;case"6":case"G":s.push(6);break;case"7":case"g":s.push(7);break;case"8":s.push(8);break;case"9":s.push(9);break;case"a":case"A":case"R":s.push(10);break;case"b":case"B":case"P":s.push(11);break;case"c":case"C":case"p":s.push(12);break;case"d":case"D":case"O":s.push(13);break;case"e":case"E":case"Y":s.push(14);break;case"f":case"F":case"W":s.push(15)}s.length&&(r.push(s),i=Math.max(i,s.length))}var l=r.length,u=new f(i,l);for(o=0;o<l;o++)for(a=r[o],c=0;c<i;c++)c<a.length?u.set(c,o,a[c]):u.set(c,o,0);return u},e.bitmapToImageLiteral=function(e,t){var n="";switch(t){case"python":n='img("""';break;default:n="img`"}if(e)for(var r=0;r<e.height;r++){n+="\n";for(var i=0;i<e.width;i++)n+=o[e.get(i,r)]+" "}switch(n+="\n",t){case"python":n+='""")';break;default:n+="`"}return n}}(e.sprite||(e.sprite={}))}(pxt||(pxt={})),function(n){var e;(e=n.streams||(n.streams={})).createStreamAsync=function(e,t){return n.Cloud.privatePostAsync("streams",{target:e,name:t||"data"}).then(function(e){return e})},e.postPayloadAsync=function(e,t){return n.Util.assert(!!e.privatekey),n.Cloud.privatePostAsync(e.id+"/data?privatekey="+e.privatekey,t)}}(pxt||(pxt={})),function(S){!function(n){var r,e,i,t;(e=r=n.PatternUnits||(n.PatternUnits={}))[e.userSpaceOnUse=0]="userSpaceOnUse",e[e.objectBoundingBox=1]="objectBoundingBox",(t=i=n.LengthUnit||(n.LengthUnit={}))[t.em=0]="em",t[t.ex=1]="ex",t[t.px=2]="px",t[t.in=3]="in",t[t.cm=4]="cm",t[t.mm=5]="mm",t[t.pt=6]="pt",t[t.pc=7]="pc",t[t.percent=8]="percent";var o=function(){function e(e){this.el=C(e)}return e.prototype.attr=function(t){var n=this;return Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),this},e.prototype.setAttribute=function(e,t){return this.el.setAttribute(e,t.toString()),this},e.prototype.setAttributeNS=function(e,t,n){return this.el.setAttributeNS(e,t,n.toString()),this},e.prototype.id=function(e){return this.setAttribute("id",e)},e.prototype.setClass=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.setAttribute("class",e.join(" "))},e.prototype.appendClass=function(e){return S.BrowserUtils.addClass(this.el,e),this},e.prototype.removeClass=function(e){S.BrowserUtils.removeClass(this.el,e)},e.prototype.title=function(e){this.titleElement||(this.titleElement=C("title"),this.el.firstChild?this.el.insertBefore(this.titleElement,this.el.firstChild):this.el.appendChild(this.titleElement)),this.titleElement.textContent=e},e.prototype.setVisible=function(e){return this.setAttribute("visibility",e?"visible":"hidden")},e}(),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.draw=function(e){var t=function(e){switch(e){case"text":return new h;case"circle":return new g;case"rect":return new d;case"line":return new m;case"polygon":return new b;case"polyline":return new y;case"path":return new w;default:return new p(e)}}(e);return this.el.appendChild(t.el),t},t.prototype.element=function(e,t){return t(this.draw(e)),this},t.prototype.group=function(){var e=new c;return this.el.appendChild(e.el),e},t.prototype.appendChild=function(e){this.el.appendChild(e.el)},t.prototype.onDown=function(e){return n.events.down(this.el,e),this},t.prototype.onUp=function(e){return n.events.up(this.el,e),this},t.prototype.onMove=function(e){return n.events.move(this.el,e),this},t.prototype.onEnter=function(e){return n.events.enter(this.el,e),this},t.prototype.onLeave=function(e){return n.events.leave(this.el,e),this},t.prototype.onClick=function(e){return n.events.click(this.el,e),this},t}(n.BaseElement=o),s=function(n){function e(e){var t=n.call(this,"svg")||this;return e&&e.appendChild(t.el),t}return __extends(e,n),e.prototype.define=function(e){return this.defs||(this.defs=new u(this.el)),e(this.defs),this},e}(n.DrawContext=a);n.SVG=s;var c=function(n){function e(e){var t=n.call(this,"g")||this;return e&&e.appendChild(t.el),t}return __extends(e,n),e.prototype.translate=function(e,t){return this.left=e,this.top=t,this.updateTransform()},e.prototype.scale=function(e){return this.scaleFactor=e,this.updateTransform()},e.prototype.def=function(){return new u(this.el)},e.prototype.style=function(){return new f(this.el)},e.prototype.updateTransform=function(){var e="";return null!=this.left&&(e+="translate("+this.left+" "+this.top+")"),null!=this.scaleFactor&&(e+=" scale("+this.scaleFactor+")"),this.setAttribute("transform",e),this},e}(a);n.Group=c;var l=function(e){function t(){return e.call(this,"pattern")||this}return __extends(t,e),t.prototype.units=function(e){return this.setAttribute("patternUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.contentUnits=function(e){return this.setAttribute("patternContentUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.size=function(e,t){return this.setAttribute("width",e),this.setAttribute("height",t),this},t}(a);n.Pattern=l;var u=function(n){function e(e){var t=n.call(this,"defs")||this;return e.appendChild(t.el),t}return __extends(e,n),e.prototype.create=function(e,t){var n;switch(e){case"path":n=new w;break;case"pattern":n=new l;break;case"radialGradient":n=new T;break;case"linearGradient":n=new A;break;case"clipPath":n=new E;break;default:n=new o(e)}return n.id(t),this.el.appendChild(n.el),n},e}(o);n.DefsElement=u;var f=function(n){function e(e){var t=n.call(this,"style")||this;return e.appendChild(t.el),t}return __extends(e,n),e.prototype.content=function(e){this.el.textContent=e},e}(o);n.StyleElement=f;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("x",e),this.setAttribute("y",t),this},t.prototype.moveTo=function(e,t){return this.at(e,t)},t.prototype.fill=function(e,t){return this.setAttribute("fill",e),null!=t&&this.opacity(t),this},t.prototype.opacity=function(e){return this.setAttribute("fill-opacity",e)},t.prototype.stroke=function(e,t){return this.setAttribute("stroke",e),null!=t&&this.strokeWidth(t),this},t.prototype.strokeWidth=function(e){return this.setAttribute("stroke-width",e)},t.prototype.strokeOpacity=function(e){return this.setAttribute("stroke-opacity",e)},t.prototype.clipPath=function(e){return this.setAttribute("clip-path",e)},t}(a),h=function(n){function e(e){var t=n.call(this,"text")||this;return null!=e&&t.text(e),t}return __extends(e,n),e.prototype.text=function(e){return this.el.textContent=e,this},e.prototype.fontFamily=function(e){return this.setAttribute("font-family",e)},e.prototype.fontSize=function(e,t){return this.setAttribute("font-size",U(e,t))},e.prototype.offset=function(e,t,n){return 0!==e&&this.setAttribute("dx",U(e,n)),0!==t&&this.setAttribute("dy",U(t,n)),this},e.prototype.anchor=function(e){return this.setAttribute("text-anchor",e)},e}(n.Drawable=p);n.Text=h;var d=function(e){function t(){return e.call(this,"rect")||this}return __extends(t,e),t.prototype.width=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("width",U(e,t))},t.prototype.height=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("height",U(e,t))},t.prototype.corner=function(e){return this.corners(e,e)},t.prototype.corners=function(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this},t.prototype.size=function(e,t,n){return void 0===n&&(n=i.px),this.width(e,n),this.height(t,n),this},t}(p);n.Rect=d;var g=function(e){function t(){return e.call(this,"circle")||this}return __extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.radius=function(e){return this.setAttribute("r",e)},t}(p);n.Circle=g;!function(e){function t(){return e.call(this,"ellipse")||this}__extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.radius=function(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this}}(p);var m=function(e){function t(){return e.call(this,"line")||this}return __extends(t,e),t.prototype.at=function(e,t,n,r){return this.from(e,t),null!=n&&null!=r&&this.to(n,r),this},t.prototype.from=function(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this},t.prototype.to=function(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this},t}(p);n.Line=m;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.points=function(e){return this.setAttribute("points",e)},t.prototype.with=function(e){return this.points(e.map(function(e){return e.x+" "+e.y}).join(","))},t}(p),y=function(e){function t(){return e.call(this,"polyline")||this}return __extends(t,e),t}(n.PolyElement=v);n.Polyline=y;var b=function(e){function t(){return e.call(this,"polygon")||this}return __extends(t,e),t}(v);n.Polygon=b;var w=function(t){function e(){var e=t.call(this,"path")||this;return e.d=new _,e}return __extends(e,t),e.prototype.update=function(){return this.setAttribute("d",this.d.toAttribute())},e.prototype.path=function(e){return e(this.d),this.update()},e}(p);n.Path=w;var x=function(e){function t(){return e.call(this,"image")||this}return __extends(t,e),t.prototype.src=function(e){return this.setAttributeNS("http://www.w3.org/1999/xlink","href",e)},t.prototype.width=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("width",U(e,t))},t.prototype.height=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("height",U(e,t))},t.prototype.size=function(e,t,n){return void 0===n&&(n=i.px),this.width(e,n),this.height(t,n),this},t}(p);n.Image=x;var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.units=function(e){return this.setAttribute("gradientUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.stop=function(e,t,n){var r=C("stop");return r.setAttribute("offset",e+"%"),null!=t&&r.setAttribute("stop-color",t),null!=n&&r.setAttribute("stop-opacity",n),this.el.appendChild(r),this},t}(o),A=function(e){function t(){return e.call(this,"linearGradient")||this}return __extends(t,e),t.prototype.start=function(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this},t.prototype.end=function(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this},t}(n.Gradient=k);n.LinearGradient=A;var T=function(e){function t(){return e.call(this,"radialGradient")||this}return __extends(t,e),t.prototype.center=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.focus=function(e,t,n){return this.setAttribute("fx",e),this.setAttribute("fy",t),this.setAttribute("fr",n),this},t.prototype.radius=function(e){return this.setAttribute("r",e)},t}(k);n.RadialGradient=T;var E=function(e){function t(){return e.call(this,"clipPath")||this}return __extends(t,e),t.prototype.clipPathUnits=function(e){return e?this.setAttribute("clipPathUnits","objectBoundingBox"):this.setAttribute("clipPathUnits","userSpaceOnUse")},t}(a);function C(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}n.ClipPath=E;var _=function(){function e(){this.ops=[]}return e.prototype.clear=function(){this.ops=[]},e.prototype.moveTo=function(e,t){return this.op("M",e,t)},e.prototype.moveBy=function(e,t){return this.op("m",e,t)},e.prototype.lineTo=function(e,t){return this.op("L",e,t)},e.prototype.lineBy=function(e,t){return this.op("l",e,t)},e.prototype.cCurveTo=function(e,t,n,r,i,o){return this.op("C",e,t,n,r,i,o)},e.prototype.cCurveBy=function(e,t,n,r,i,o){return this.op("c",e,t,n,r,i,o)},e.prototype.qCurveTo=function(e,t,n,r){return this.op("Q",e,t,n,r)},e.prototype.qCurveBy=function(e,t,n,r){return this.op("q",e,t,n,r)},e.prototype.sCurveTo=function(e,t,n,r){return this.op("S",e,t,n,r)},e.prototype.sCurveBy=function(e,t,n,r){return this.op("s",e,t,n,r)},e.prototype.tCurveTo=function(e,t){return this.op("T",e,t)},e.prototype.tCurveBy=function(e,t){return this.op("t",e,t)},e.prototype.arcTo=function(e,t,n,r,i,o,a){return this.op("A",e,t,n,r?1:0,i?1:0,o,a)},e.prototype.arcBy=function(e,t,n,r,i,o,a){return this.op("a",e,t,n,r?1:0,i?1:0,o,a)},e.prototype.close=function(){return this.op("z")},e.prototype.toAttribute=function(){return this.ops.map(function(e){return e.op+" "+e.args.join(" ")}).join(" ")},e.prototype.op=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.ops.push({op:e,args:t}),this},e}();function U(e,t){switch(t){case i.em:return e+"em";case i.ex:return e+"ex";case i.px:return e+"px";case i.in:return e+"in";case i.cm:return e+"cm";case i.mm:return e+"mm";case i.pt:return e+"pt";case i.pc:return e+"pc";case i.percent:return e+"%";default:return e.toString()}}n.PathContext=_}(S.svgUtil||(S.svgUtil={}))}(pxt||(pxt={})),function(e){var t;(function(e){function n(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function r(){return"undefined"!=typeof window&&!!window.PointerEvent}e.isTouchEnabled=n,e.hasPointerEvents=r,e.down=function(e,t){r()?e.addEventListener("pointerdown",t):n()?(e.addEventListener("mousedown",t),e.addEventListener("touchstart",t)):e.addEventListener("mousedown",t)},e.up=function(e,t){r()?e.addEventListener("pointerup",t):(n(),e.addEventListener("mouseup",t))},e.enter=function(e,t){r()?e.addEventListener("pointerover",function(e){t(!!(1&e.buttons))}):n()?e.addEventListener("touchstart",function(e){t(!0)}):e.addEventListener("mouseover",function(e){t(!!(1&e.buttons))})},e.leave=function(e,t){r()?e.addEventListener("pointerleave",t):n()?e.addEventListener("touchend",t):e.addEventListener("mouseleave",t)},e.move=function(e,t){r()?e.addEventListener("pointermove",t):n()?e.addEventListener("touchmove",t):e.addEventListener("mousemove",t)},e.click=function(e,t){e.addEventListener("click",t)}})((t=e.svgUtil||(e.svgUtil={})).events||(t.events={}))}(pxt||(pxt={})),function(e){var t,n,r;t=e.svgUtil||(e.svgUtil={}),n=t.helpers||(t.helpers={}),r=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.at=function(e,t){return this.cx=e,this.cy=t,this.rePosition(),this},e.prototype.text=function(e,t){return void 0===t&&(t=12),n.prototype.text.call(this,e),this.fontSizePixels=t,this.setAttribute("font-size",t+"px"),this.rePosition(),this},e.prototype.rePosition=function(){null!=this.cx&&null!=this.cy&&null!=this.fontSizePixels&&(this.setAttribute("x",this.cx),this.setAttribute("y",this.cy),this.setAttribute("text-anchor","middle"),this.setAttribute("alignment-baseline","middle"))},e}(t.Text),n.CenteredText=r}(pxt||(pxt={})),function(o){!function(e){e.blockColors={loops:"#107c10",logic:"#006970",math:"#712672",variables:"#A80000",functions:"#005a9e",text:"#996600",arrays:"#A94400",advanced:"#3c3c3c",addpackage:"#717171",search:"#000",debug:"#e03030",default:"#dddddd",topblocks:"#aa8f00",recipes:"#717171"},e.blockIcons={loops:"",logic:"",math:"",variables:"",functions:"",text:"",arrays:"",advancedcollapsed:"",advancedexpanded:"",more:"",addpackage:"",search:"",debug:"",default:"",topblocks:"",recipes:""};var r="";function i(e){var t=function(e,t,n){var r=0,i=0,o=0;if(0==t)o=i=r=n;else{var a=Math.floor(e/60),s=e/60-a,c=n*(1-t),l=n*(1-t*s),u=n*(1-t*(1-s));switch(a){case 1:r=l,i=n,o=c;break;case 2:r=c,i=n,o=u;break;case 3:r=c,i=l,o=n;break;case 4:r=u,i=c,o=n;break;case 5:r=n,i=c,o=l;break;case 6:case 0:r=n,i=u,o=c}}return[Math.floor(r),Math.floor(i),Math.floor(o)]}(e,.45,165.75);return"#"+n(t[0])+n(t[1])+n(t[2])}function n(e){var t=e.toString(16);return 1==t.length?"0"+t:t}e.appendToolboxIconCss=function(e,t){if(!(-1<r.indexOf(e)))if(1===t.length){var n=o.Util.unicodeToChar(t);r+="\n                .blocklyTreeIcon."+e+'::before {\n                    content: "'+n+'";\n                }\n            '}else r+="\n                .blocklyTreeIcon."+e+' {\n                    background-image: url("'+o.Util.pathJoin(o.webConfig.commitCdnUrl,encodeURI(t))+'")!important;\n                    width: 30px;\n                    height: 100%;\n                    background-size: 20px !important;\n                    background-repeat: no-repeat !important;\n                    background-position: 50% 50% !important;\n                }\n            '},e.getNamespaceColor=function(e){return e=e.toLowerCase(),o.appTarget.appTheme.blockColors&&o.appTarget.appTheme.blockColors[e]?o.appTarget.appTheme.blockColors[e]:o.toolbox.blockColors[e]?o.toolbox.blockColors[e]:""},e.getNamespaceIcon=function(e){return e=e.toLowerCase(),o.appTarget.appTheme.blockIcons&&o.appTarget.appTheme.blockIcons[e]?o.appTarget.appTheme.blockIcons[e]:o.toolbox.blockIcons[e]?o.toolbox.blockIcons[e]:""},e.advancedTitle=function(){return o.Util.lf("{id:category}Advanced")},e.addPackageTitle=function(){return o.Util.lf("{id:category}Extensions")},e.recipesTitle=function(){return o.Util.lf("{id:category}Tutorials")},e.convertColor=function(e){var t;e=(t=e)?"0x"==t.substring(0,2)?"#"+t.substring(2):t:"#000000";var n=parseInt(e);return isNaN(n)?e:i(n)},e.hueToRgb=i,e.fadeColor=function(e,t,n){(e=e.replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);for(var r="#",i=0;i<3;i++){var o=parseInt(e.substr(2*i,2),16),a=(o=Math.round(Math.min(Math.max(0,n?o+o*t:o-o*t),255))).toString(16);r+=("00"+a).substr(a.length)}return r}}(o.toolbox||(o.toolbox={}))}(pxt||(pxt={})),function(y){!function(e){var g=/^##[^#](.*)$([\s\S]*?)(?=^##[^#]|$(?![\r\n]))/gim,m=/^###[^#](.*)$([\s\S]*?)(?=^###[^#]|$(?![\r\n]))/gim;function v(e,t,s){var n=t||g,c=[];if(e.replace(n,function(e,t,n){var r=function(e,t){var n,r=e;if(t){var i=/#+ ~ tutorialhint([\s\S]*)/i;r=e.replace(i,function(e,t){return n=t,""})}else{var i=/(^[\s\S]*?\S)\s*((```|\!\[[\s\S]+?\]\(\S+?\))[\s\S]*)/im,o=e.match(i);o&&2<o.length&&(r=o[1].trim(),n=o[2].trim())}return{header:r,hint:n}}(n=n.trim(),s&&s.explicitHints),i=r.header,o=r.hint,a={fullscreen:/@(fullscreen|unplugged)/.test(t),unplugged:/@unplugged/.test(t),tutorialCompleted:/@tutorialCompleted/.test(t),contentMd:n,headerContentMd:i,hintContentMd:o,hasHint:o&&0<o.length};return c.push(a),""}),0!=e.indexOf("# Not found"))return c;y.debug("tutorial not found")}e.parseTutorial=function(e){var r,t,n,i=(r={},t=e.replace(/### @(\S+) ([ \S]+)/gi,function(e,t,n){try{r[t]=JSON.parse(n)}catch(e){r[t]=n}return""}),{metadata:r,body:t}),o=i.metadata,a=i.body,s=function(e,t){if(e=(n=e)?n.replace(/```(filterblocks|package|ghost|config|template)\s*\n([\s\S]*?)\n```/gim,"").trim():null,t&&t.activities)return o=t,a=[],s=[],e.replace(g,function(e,t,n){var r=s.length;s.push({name:t||lf("Activity {0}",r),step:a.length});var i=v(n,m,o);return i=i.map(function(e){return e.activity=r,e}),a=a.concat(i),""}),{steps:a,activities:s};var o,a,s,n,r=v(e,null,t);return(!r||r.length<1)&&(r=v(e,m,t)),{steps:r,activities:null}}(a,o),c=s.steps,l=s.activities,u=(n=a.match(/^#[^#](.*)$/im))&&1<n.length?n[1]:null;if(c){var f,p=void 0,h="";return a.replace(/((?!.)\s)+/g,"\n").replace(/```(sim|block|blocks|filterblocks|spy|ghost|typescript|ts|js|javascript|template)?\s*\n([\s\S]*?)\n```/gim,function(e,t,n){switch(t){case"block":case"blocks":case"filterblocks":if(!d(y.BLOCKS_PROJECT_NAME))return;break;case"spy":if(!d(y.PYTHON_PROJECT_NAME))return;break;case"typescript":case"ts":case"javascript":case"js":if(!d(y.JAVASCRIPT_PROJECT_NAME))return;break;case"template":f=n}return h+="\n { \n "+n+"\n } \n",""}),{editor:p||y.BLOCKS_PROJECT_NAME,title:u,steps:c,activities:l,code:h,templateCode:f,metadata:o}}function d(e){return p&&p!=e?(y.debug("tutorial ambiguous: contains snippets of different types"),!1):(p=e,!0)}},e.highlight=function(e){var t=e.textContent;if(/@highlight/.test(t)){t=(t=t.replace(/img\s*\(\s*"{3}(.|\n)*"{3}\s*\)/g,'""" """')).replace(/img\s*\(\s*`(.|\n)*`\s*\)/g,"img` `"),e.textContent="";for(var n=t.split("\n"),r=0;r<n.length;++r){var i=n[r];if(/@highlight/.test(i)){if(void 0!==(i=n[++r])){var o=document.createElement("span");o.className="highlight-line",o.textContent=i,e.appendChild(o)}}else e.appendChild(document.createTextNode(i+"\n"))}}}}(y.tutorial||(y.tutorial={}))}(pxt||(pxt={})),function(u){!function(n){var r,e;n.flattenDiagnosticMessageText=function(e,t){if("string"==typeof e)return e;for(var n=e,r="",i=0;n;){if(i){r+=t;for(var o=0;o<i;o++)r+="  "}r+=n.messageText,i++,n=n.next}return r},(e=r=n.ScriptTarget||(n.ScriptTarget={}))[e.ES3=0]="ES3",e[e.ES5=1]="ES5",e[e.ES6=2]="ES6",e[e.ES2015=2]="ES2015",e[e.Latest=2]="Latest",n.isIdentifierStart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||36===e||95===e||127<e&&c(e,t)},n.isIdentifierPart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||36===e||95===e||127<e&&(n=e,t>=r.ES5?l(n,o):l(n,s));var n},n.reservedWords=["abstract","any","as","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","instanceof","interface","is","let","module","namespace","new","null","package","private","protected","public","require","global","return","set","static","super","switch","symbol","this","throw","true","try","type","typeof","var","void","while","with","yield","async","await","of","Math"],n.escapeIdentifier=function(e){if(!e)return"_";var t=e.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_$]/g,function(e){return u.pxtc.isIdentifierPart(e.charCodeAt(0),u.pxtc.ScriptTarget.ES5)?e:""});return t&&u.pxtc.isIdentifierStart(t.charCodeAt(0),u.pxtc.ScriptTarget.ES5)&&-1===n.reservedWords.indexOf(t)||(t="_"+t),t};var t,i=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],o=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,768,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1155,1159,1162,1319,1329,1366,1369,1369,1377,1415,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1488,1514,1520,1522,1552,1562,1568,1641,1646,1747,1749,1756,1759,1768,1770,1788,1791,1791,1808,1866,1869,1969,1984,2037,2042,2042,2048,2093,2112,2139,2208,2208,2210,2220,2276,2302,2304,2403,2406,2415,2417,2423,2425,2431,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2500,2503,2504,2507,2510,2519,2519,2524,2525,2527,2531,2534,2545,2561,2563,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2649,2652,2654,2654,2662,2677,2689,2691,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2787,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2876,2884,2887,2888,2891,2893,2902,2903,2908,2909,2911,2915,2918,2927,2929,2929,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3006,3010,3014,3016,3018,3021,3024,3024,3031,3031,3046,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3140,3142,3144,3146,3149,3157,3158,3160,3161,3168,3171,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3260,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3299,3302,3311,3313,3314,3330,3331,3333,3340,3342,3344,3346,3386,3389,3396,3398,3400,3402,3406,3415,3415,3424,3427,3430,3439,3450,3455,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3807,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3948,3953,3972,3974,3991,3993,4028,4038,4038,4096,4169,4176,4253,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4957,4959,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5908,5920,5940,5952,5971,5984,5996,5998,6e3,6002,6003,6016,6099,6103,6103,6108,6109,6112,6121,6155,6157,6160,6169,6176,6263,6272,6314,6320,6389,6400,6428,6432,6443,6448,6459,6470,6509,6512,6516,6528,6571,6576,6601,6608,6617,6656,6683,6688,6750,6752,6780,6783,6793,6800,6809,6823,6823,6912,6987,6992,7001,7019,7027,7040,7155,7168,7223,7232,7241,7245,7293,7376,7378,7380,7414,7424,7654,7676,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8204,8205,8255,8256,8276,8276,8305,8305,8319,8319,8336,8348,8400,8412,8417,8417,8421,8432,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11647,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11744,11775,11823,11823,12293,12295,12321,12335,12337,12341,12344,12348,12353,12438,12441,12442,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42539,42560,42607,42612,42621,42623,42647,42655,42737,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43047,43072,43123,43136,43204,43216,43225,43232,43255,43259,43259,43264,43309,43312,43347,43360,43388,43392,43456,43471,43481,43520,43574,43584,43597,43600,43609,43616,43638,43642,43643,43648,43714,43739,43741,43744,43759,43762,43766,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44010,44012,44013,44016,44025,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65024,65039,65056,65062,65075,65076,65101,65103,65136,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],a=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1569,1594,1600,1610,1649,1747,1749,1749,1765,1766,1786,1788,1808,1808,1810,1836,1920,1957,2309,2361,2365,2365,2384,2384,2392,2401,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2784,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2877,2908,2909,2911,2913,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3294,3294,3296,3297,3333,3340,3342,3344,3346,3368,3370,3385,3424,3425,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3946,3976,3979,4096,4129,4131,4135,4137,4138,4176,4181,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6067,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12329,12337,12341,12344,12346,12353,12436,12445,12446,12449,12538,12540,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65138,65140,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],s=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,768,846,864,866,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1155,1158,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1425,1441,1443,1465,1467,1469,1471,1471,1473,1474,1476,1476,1488,1514,1520,1522,1569,1594,1600,1621,1632,1641,1648,1747,1749,1756,1759,1768,1770,1773,1776,1788,1808,1836,1840,1866,1920,1968,2305,2307,2309,2361,2364,2381,2384,2388,2392,2403,2406,2415,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2524,2525,2527,2531,2534,2545,2562,2562,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2649,2652,2654,2654,2662,2676,2689,2691,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2784,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2876,2883,2887,2888,2891,2893,2902,2903,2908,2909,2911,2913,2918,2927,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3006,3010,3014,3016,3018,3021,3031,3031,3047,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3134,3140,3142,3144,3146,3149,3157,3158,3168,3169,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3262,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3297,3302,3311,3330,3331,3333,3340,3342,3344,3346,3368,3370,3385,3390,3395,3398,3400,3402,3405,3415,3415,3424,3425,3430,3439,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3805,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3946,3953,3972,3974,3979,3984,3991,3993,4028,4038,4038,4096,4129,4131,4135,4137,4138,4140,4146,4150,4153,4160,4169,4176,4185,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,4969,4977,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6099,6112,6121,6160,6169,6176,6263,6272,6313,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8255,8256,8319,8319,8400,8412,8417,8417,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12335,12337,12341,12344,12346,12353,12436,12441,12442,12445,12446,12449,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65056,65059,65075,65076,65101,65103,65136,65138,65140,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65381,65470,65474,65479,65482,65487,65490,65495,65498,65500];function c(e,t){return t>=r.ES5?l(e,i):l(e,a)}function l(e,t){if(e<t[0])return!1;for(var n,r=0,i=t.length;r+1<i;){if(n=r+(i-r)/2,t[n-=n%2]<=e&&e<=t[n+1])return!0;e<t[n]?i=n:r=n+2}return!1}n.isUnicodeIdentifierStart=c,(t=n.DiagnosticCategory||(n.DiagnosticCategory={}))[t.Warning=0]="Warning",t[t.Error=1]="Error",t[t.Message=2]="Message"}(u.pxtc||(u.pxtc={}))}(ts||(ts={})),function(h){!function(r){function i(){return!!navigator&&!!navigator.bluetooth&&"TextDecoder"in window&&h.appTarget.appTheme.bluetoothUartConsole&&h.appTarget.appTheme.bluetoothUartFilters&&0<h.appTarget.appTheme.bluetoothUartFilters.length}function o(){return!!navigator&&!!navigator.bluetooth&&!!h.appTarget.appTheme.bluetoothPartialFlashing}r.isAvailable=function(){return i()||o()},r.hasConsole=i,r.hasPartialFlash=o,r.isValidUUID=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(e)};var e=function(){function e(e,t){this.connectionTimeout=2e4,this.connectPromise=void 0,this.id=e,this.aliveToken=t}return e.prototype.debug=function(e){h.debug(this.id+": "+e)},e.prototype.alivePromise=function(e){var r=this;return new Promise(function(t,n){r.aliveToken.isCancelled()&&n(new Error),e.then(function(e){return t(e)},function(e){return n(e)})})},e.prototype.cancelConnect=function(){this.connectPromise=void 0},e.prototype.createConnectPromise=function(){return Promise.resolve()},e.prototype.connectAsync=function(){var t=this;return this.connectPromise||(this.connectPromise=this.alivePromise(this.createConnectPromise())),this.connectPromise.timeout(this.connectionTimeout,"connection timeout").then(function(){return t.aliveToken.throwIfCancelled()}).catch(function(e){throw t.connectPromise=void 0,e})},e.prototype.disconnect=function(){this.cancelConnect()},e.prototype.kill=function(){this.disconnect(),this.aliveToken.cancel()},e}(),t=function(i){function e(e,t,n){var r=i.call(this,e,t.aliveToken)||this;return r.device=t,r.autoReconnect=n,r.autoReconnectDelay=1e3,r.disconnectOnAutoReconnect=!1,r.reconnectPromise=void 0,r.failedConnectionServicesVersion=-1,r.handleDisconnected=r.handleDisconnected.bind(r),r.device.device.addEventListener("gattserverdisconnected",r.handleDisconnected),r}return __extends(e,i),e.prototype.handleDisconnected=function(e){var t=this;this.aliveToken.isCancelled()||(this.disconnect(),this.autoReconnect&&!this.reconnectPromise&&(this.reconnectPromise=Promise.delay(this.autoReconnectDelay).then(function(){return t.exponentialBackoffConnectAsync(8,500)}).finally(function(){return t.reconnectPromise=void 0})))},e.prototype.exponentialBackoffConnectAsync=function(t,n){var r=this;return this.debug("retry connect"),this.aliveToken.throwIfCancelled(),this.connectAsync().then(function(){r.aliveToken.throwIfCancelled(),r.debug("reconnect success"),r.reconnectPromise=void 0}).catch(function(e){return r.debug("reconnect error "+e.message),r.aliveToken.throwIfCancelled(),r.device.isPaired?r.autoReconnect?0==t?(r.debug("give up, max tries"),void(r.reconnectPromise=void 0)):r.failedConnectionServicesVersion==r.device.servicesVersion?(r.debug("services haven't changed, giving up"),void(r.reconnectPromise=void 0)):(r.debug("retry connect "+n+"ms... ("+t+" tries left)"),r.device.connected&&(r.failedConnectionServicesVersion=r.device.servicesVersion),r.disconnectOnAutoReconnect&&r.device.disconnect(),Promise.delay(n).then(function(){return r.exponentialBackoffConnectAsync(--t,1.8*n)})):(r.debug("autoreconnect disabled"),void(r.reconnectPromise=void 0)):(r.debug("give up, device unpaired"),void(r.reconnectPromise=void 0))})},e}(r.BLERemote=e),n=function(o){function e(e,t,n,r){var i=o.call(this,e,t,!0)||this;return i.device=t,i.serviceUUID=n,i.txCharacteristicUUID=r,i.handleValueChanged=i.handleValueChanged.bind(i),i}return __extends(e,o),e.prototype.createConnectPromise=function(){var t=this;return this.debug("connecting"),this.device.connectAsync().then(function(){return t.alivePromise(t.device.gatt.getPrimaryService(t.serviceUUID))}).then(function(e){return t.debug("service connected"),t.service=e,t.alivePromise(t.service.getCharacteristic(t.txCharacteristicUUID))}).then(function(e){return t.debug("tx characteristic connected"),t.txCharacteristic=e,t.txCharacteristic.addEventListener("characteristicvaluechanged",t.handleValueChanged),t.txCharacteristic.startNotifications()}).then(function(){h.tickEvent("webble.connected",{id:t.id})})},e.prototype.handlePacket=function(e){},e.prototype.handleValueChanged=function(e){var t=e.target.value;this.handlePacket(t)},e.prototype.disconnect=function(){if(o.prototype.disconnect.call(this),this.txCharacteristic&&this.device&&this.device.connected)try{this.txCharacteristic.stopNotifications(),this.txCharacteristic.removeEventListener("characteristicvaluechanged",this.handleValueChanged)}catch(e){h.log(this.id+": error "+e.message)}this.service=void 0,this.txCharacteristic=void 0},e}(r.BLEService=t),a=function(n){function o(e){var t=n.call(this,"hf2",e,o.SERVICE_UUID,o.CHARACTERISTIC_TX_UUID)||this;return t.device=e,t}return __extends(o,n),o.prototype.handlePacket=function(e){var t=e.getUint8(0);switch(192&t){case o.BLEHF2_FLAG_SERIAL_OUT:case o.BLEHF2_FLAG_SERIAL_ERR:for(var n=Math.min(e.byteLength-1,-193&t),r="",i=0;i<n;++i)r+=String.fromCharCode(e.getUint8(i+1));r&&window.postMessage({type:"serial",id:this.device.name||"hf2",data:r},"*")}},o.SERVICE_UUID="b112f5e6-2679-30da-a26e-0273b6043849",o.CHARACTERISTIC_TX_UUID="b112f5e6-2679-30da-a26e-0273b604384a",o.BLEHF2_FLAG_SERIAL_OUT=128,o.BLEHF2_FLAG_SERIAL_ERR=192,o}(r.BLETXService=n);r.HF2Service=a;var s,c,l=function(n){function r(e){var t=n.call(this,"uart",e,r.SERVICE_UUID,r.CHARACTERISTIC_TX_UUID)||this;return t.device=e,t}return __extends(r,n),r.prototype.handlePacket=function(e){var t=(new window.TextDecoder).decode(e);t&&window.postMessage({type:"serial",id:this.device.name||"uart",data:t},"*")},r.SERVICE_UUID="6e400001-b5a3-f393-e0a9-e50e24dcca9e",r.CHARACTERISTIC_TX_UUID="6e400002-b5a3-f393-e0a9-e50e24dcca9e",r}(n);r.UARTService=l,(c=s||(s={}))[c.Idle=1]="Idle",c[c.StatusRequested=2]="StatusRequested",c[c.PairingModeRequested=4]="PairingModeRequested",c[c.RegionDALRequested=8]="RegionDALRequested",c[c.RegionMakeCodeRequested=16]="RegionMakeCodeRequested",c[c.Flash=32]="Flash",c[c.EndOfTransmision=64]="EndOfTransmision",c[c.USBFlashRequired=128]="USBFlashRequired";var u=function(n){function a(e){var t=n.call(this,"partial flashing",e,!1)||this;return t.device=e,t.state=s.Idle,t.disconnectOnAutoReconnect=!0,t.handleCharacteristic=t.handleCharacteristic.bind(t),t}return __extends(a,n),a.prototype.clearFlashData=function(){this.version=0,this.mode=0,this.regions=[],this.chunkDelay=a.CHUNK_MIN_DELAY,this.hex=void 0,this.bin=void 0,this.magicOffset=void 0,this.dalHash=void 0,this.makeCodeHash=void 0,this.flashReject=void 0,this.flashResolve=void 0,this.flashOffset=void 0},a.prototype.createConnectPromise=function(){var t=this;return this.debug("connecting to partial flash service"),this.device.connectAsync().then(function(){return t.alivePromise(t.device.gatt.getPrimaryService(a.SERVICE_UUID))}).then(function(e){return t.debug("connecting to characteristic"),t.alivePromise(e.getCharacteristic(a.CHARACTERISTIC_UUID))}).then(function(e){return t.debug("starting notifications"),t.pfCharacteristic=e,t.pfCharacteristic.startNotifications(),t.pfCharacteristic.addEventListener("characteristicvaluechanged",t.handleCharacteristic),t.state==s.PairingModeRequested?(t.debug("checking pairing mode"),t.autoReconnect=!1,t.pfCharacteristic.writeValue(new Uint8Array([a.STATUS]))):Promise.resolve()})},a.prototype.disconnect=function(){if(n.prototype.disconnect.call(this),this.flashPacketToken&&this.flashPacketToken.cancel(),this.pfCharacteristic&&this.device.connected)try{this.pfCharacteristic.stopNotifications(),this.pfCharacteristic.removeEventListener("characteristicvaluechanged",this.handleCharacteristic)}catch(e){h.log("ble: partial flash disconnect error "+e.message)}this.pfCharacteristic=void 0},a.prototype.findMarker=function(e,t){if(!this.bin)return-1;for(;e+t.length<this.bin.length;e+=16){for(var n=!0,r=0;r<t.length;++r)if(t[r]!=this.bin[e+r]){n=!1;break}if(n)return e}return-1},a.prototype.flashAsync=function(e){var t=this;return this.hex?(this.debug("flashing already in progress"),Promise.resolve()):(this.device.pauseLog(),this.createFlashPromise(e).finally(function(){return t.device.resumeLogOnDisconnection()}))},a.prototype.createFlashPromise=function(e){var n=this;if(this.hex)return this.debug("flashing already in progress"),Promise.resolve();this.clearFlashData(),this.hex=e;var t=ts.pxtc.UF2.newBlockFile();ts.pxtc.UF2.writeHex(t,this.hex.split(/\r?\n/));var r=h.appTarget.compile.flashUsableEnd;this.bin=ts.pxtc.UF2.toBin(h.U.stringToUint8Array(ts.pxtc.UF2.serializeFile(t)),r).buf,this.debug("bin bytes "+this.bin.length),this.magicOffset=this.findMarker(0,a.MAGIC_MARKER),this.debug("magic block "+this.magicOffset.toString(16)),this.magicOffset<0&&(this.debug("magic block not found, not a valid HEX file"),h.U.userError(lf("Invalid file"))),this.debug("bytes to flash "+(this.bin.length-this.magicOffset));var i=this.magicOffset+a.MAGIC_MARKER.length;return this.dalHash=h.Util.toHex(this.bin.slice(i,i+8)),this.makeCodeHash=h.Util.toHex(this.bin.slice(i+8,i+16)),this.debug("DAL hash "+this.dalHash),this.debug("MakeCode hash "+this.makeCodeHash),this.connectAsync().then(function(){return new Promise(function(e,t){return n.flashResolve=e,n.flashReject=t,n.debug("check service version"),n.state=s.StatusRequested,n.pfCharacteristic.writeValue(new Uint8Array([a.STATUS]))})}).then(function(){},function(e){h.log("pf: error "+e.message),n.clearFlashData()})},a.prototype.checkStateTransition=function(e,t){return!!(this.state&t)||(this.debug("flash cmd "+e+" in state "+this.state.toString(16)+" "),this.flashReject(new Error),this.clearFlashData(),!1)},a.prototype.handleCharacteristic=function(e){var t=this;this.aliveToken.isCancelled()&&(this.flashReject(new Error),this.clearFlashData());var n=event.target.value,r=new Uint8Array(n.buffer),i=r[0];if(this.state!=s.Idle)switch(i){case a.STATUS:if(!this.checkStateTransition(i,s.StatusRequested|s.PairingModeRequested))return;this.version=r[1],this.mode=r[2],this.debug("flash service version "+this.version+" mode "+this.mode),this.debug("reading DAL region"),this.state=s.RegionDALRequested,this.pfCharacteristic.writeValue(new Uint8Array([a.REGION_INFO,a.REGION_DAL])).then(function(){});break;case a.REGION_INFO:if(!this.checkStateTransition(i,s.RegionDALRequested|s.RegionMakeCodeRequested))return;var o=this.regions[r[1]]={start:r[2]<<24|r[3]<<16|r[4]<<8|r[5],end:r[6]<<24|r[7]<<16|r[8]<<8|r[9],hash:h.Util.toHex(r.slice(10))};if(this.debug("read region "+r[1]+" start "+o.start.toString(16)+" end "+o.end.toString(16)+" hash "+o.hash),r[1]==a.REGION_DAL){if(o.hash!=this.dalHash)return h.tickEvent("webble.flash.DALrequired"),this.debug("DAL hash does not match, partial flashing not possible"),this.state=s.USBFlashRequired,this.flashReject(new Error("USB flashing required")),void this.clearFlashData();this.debug("DAL hash match, reading makecode region"),this.state=s.RegionMakeCodeRequested,this.pfCharacteristic.writeValue(new Uint8Array([a.REGION_INFO,a.REGION_MAKECODE])).then(function(){})}else if(r[1]==a.REGION_MAKECODE)if(o.start!=this.magicOffset&&(this.debug("magic offset and MakeCode region.start not matching"),h.U.userError(lf("Invalid file"))),o.hash==this.makeCodeHash)h.tickEvent("webble.flash.noop"),this.debug("MakeCode hash matches, same code!"),this.debug("restart application mode"),this.pfCharacteristic.writeValue(new Uint8Array([a.RESET,a.MODE_APPLICATION])).then(function(){t.state=s.Idle,t.flashResolve(),t.clearFlashData()});else{if(this.mode!=a.MODE_PAIRING)return this.debug("application mode, reset into pairing mode"),this.state=s.PairingModeRequested,this.autoReconnect=!0,void this.pfCharacteristic.writeValue(new Uint8Array([a.RESET,a.MODE_PAIRING])).then(function(){});this.flashOffset=o.start,this.flashPacketNumber=0,this.debug("starting to flash from address "+this.flashOffset.toString(16)),this.flashNextPacket()}break;case a.FLASH_DATA:if(!this.checkStateTransition(i,s.Flash))return;switch(r[1]){case a.PACKET_OUT_OF_ORDER:this.debug("packet out of order"),this.flashPacketToken.cancel(),this.flashPacketNumber+=4,this.chunkDelay=Math.min(this.chunkDelay+10,a.CHUNK_MAX_DELAY),this.flashNextPacket();break;case a.PACKET_WRITTEN:this.chunkDelay=Math.max(this.chunkDelay-1,a.CHUNK_MIN_DELAY),this.flashOffset+=64,this.flashPacketNumber+=4,this.flashOffset>=this.bin.length?(this.debug("end transmission"),this.state=s.EndOfTransmision,this.pfCharacteristic.writeValue(new Uint8Array([a.END_OF_TRANSMISSION])).finally(function(){t.flashResolve&&t.flashResolve(),t.clearFlashData()})):this.flashNextPacket()}break;default:this.debug("unknown message "+h.Util.toHex(r)),this.disconnect()}},a.prototype.flashNextPacket=function(){var r=this;this.state=s.Flash,this.flashPacketToken=new h.Util.CancellationToken,this.flashPacketToken.startOperation();var t=this.bin.slice(this.flashOffset,this.flashOffset+64);this.debug("flashing "+this.flashOffset.toString(16)+" / "+this.bin.length.toString(16)+" "+((this.flashOffset-this.magicOffset)/(this.bin.length-this.magicOffset)*100>>0)+"%");var i=new Uint8Array(20);Promise.delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=r.flashOffset>>8&255,i[2]=r.flashOffset>>0&255,i[3]=r.flashPacketNumber;for(var e=0;e<16;e++)i[4+e]=t[e];return r.pfCharacteristic.writeValue(i)}).delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=r.flashOffset>>24&255,i[2]=r.flashOffset>>16&255,i[3]=r.flashPacketNumber+1;for(var e=0;e<16;e++)i[4+e]=t[16+e]||0;return r.pfCharacteristic.writeValue(i)}).delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=0,i[2]=0,i[3]=r.flashPacketNumber+2;for(var e=0;e<16;e++)i[4+e]=t[32+e]||0;return r.pfCharacteristic.writeValue(i)}).delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=0,i[2]=0,i[3]=r.flashPacketNumber+3;for(var e=0;e<16;e++)i[4+e]=t[48+e]||0;return r.pfCharacteristic.writeValue(i)}).then(function(){var t=r.flashOffset,n=function(){return Promise.delay(500).then(function(){if(t!=r.flashOffset||r.flashPacketToken.isCancelled()||r.aliveToken.isCancelled()||r.state!=s.Flash)return Promise.resolve();r.debug("packet transfer deadlock, force restart"),i[0]=a.FLASH_DATA,i[1]=0,i[2]=0,i[3]=-1;for(var e=0;e<16;e++)i[4+e]=0;return r.pfCharacteristic.writeValue(i).then(function(){return n()})})};n().catch(function(e){r.flashReject&&(r.flashReject(new Error("failed packet transfer")),r.clearFlashData())})}).catch(function(){r.flashPacketToken.resolveCancel()})},a.SERVICE_UUID="e97dd91d-251d-470a-a062-fa1922dfa9a8",a.CHARACTERISTIC_UUID="e97d3b10-251d-470a-a062-fa1922dfa9a8",a.REGION_INFO=0,a.FLASH_DATA=1,a.PACKET_OUT_OF_ORDER=170,a.PACKET_WRITTEN=255,a.END_OF_TRANSMISSION=2,a.STATUS=238,a.RESET=255,a.MODE_PAIRING=0,a.MODE_APPLICATION=1,a.REGION_SOFTDEVICE=0,a.REGION_DAL=1,a.REGION_MAKECODE=2,a.MAGIC_MARKER=h.Util.fromHex("708E3B92C615A841C49866C975EE5197"),a.CHUNK_MIN_DELAY=0,a.CHUNK_MAX_DELAY=75,a}(t);r.PartialFlashingService=u;var f=function(n){function e(e){var t=n.call(this,"ble",new h.Util.CancellationToken)||this;return t.device=void 0,t.services=[],t.pendingResumeLogOnDisconnection=!1,t.servicesVersion=0,t.device=e,t.handleDisconnected=t.handleDisconnected.bind(t),t.handleServiceAdded=t.handleServiceAdded.bind(t),t.handleServiceChanged=t.handleServiceChanged.bind(t),t.handleServiceRemoved=t.handleServiceRemoved.bind(t),t.device.addEventListener("gattserverdisconnected",t.handleDisconnected),t.device.addEventListener("serviceadded",t.handleServiceAdded),t.device.addEventListener("servicechanged",t.handleServiceChanged),t.device.addEventListener("serviceremoved",t.handleServiceRemoved),i()&&(t.services.push(t.uartService=new l(t)),t.services.push(t.hf2Service=new a(t))),o()&&t.services.push(t.partialFlashingService=new u(t)),t.aliveToken.startOperation(),t}return __extends(e,n),e.prototype.startServices=function(){this.services.filter(function(e){return e.autoReconnect}).forEach(function(e){return e.connectAsync().catch(function(){})})},e.prototype.pauseLog=function(){this.uartService&&(this.uartService.autoReconnect=!1,this.uartService.disconnect()),this.hf2Service&&(this.hf2Service.autoReconnect=!1,this.hf2Service.disconnect())},e.prototype.resumeLogOnDisconnection=function(){this.pendingResumeLogOnDisconnection=!0},e.prototype.resumeLog=function(){this.uartService&&(this.uartService.autoReconnect=!0,this.uartService.connectAsync().catch(function(){})),this.hf2Service&&(this.hf2Service.autoReconnect=!0,this.hf2Service.connectAsync().catch(function(){}))},Object.defineProperty(e.prototype,"isPaired",{get:function(){return this===r.bleDevice},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.device.name||"?"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return this.device&&this.device.gatt&&this.device.gatt.connected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gatt",{get:function(){return this.device.gatt},enumerable:!0,configurable:!0}),e.prototype.createConnectPromise=function(){var e=this;return this.debug("connecting gatt server"),this.alivePromise(this.device.gatt.connect().then(function(){return e.debug("gatt server connected")}))},e.prototype.handleServiceAdded=function(e){this.debug("service added"),this.servicesVersion++},e.prototype.handleServiceRemoved=function(e){this.debug("service removed"),this.servicesVersion++},e.prototype.handleServiceChanged=function(e){this.debug("service changed"),this.servicesVersion++},e.prototype.handleDisconnected=function(e){var t=this;this.debug("disconnected"),this.disconnect(),this.pendingResumeLogOnDisconnection&&(this.pendingResumeLogOnDisconnection=!1,Promise.delay(500).then(function(){return t.resumeLog()}))},e.prototype.disconnect=function(){if(n.prototype.disconnect.call(this),this.services.forEach(function(e){return e.disconnect()}),this.connected){this.debug("disconnect");try{this.device.gatt&&this.device.gatt.connected&&this.device.gatt.disconnect()}catch(e){this.debug("gatt disconnect error "+e.message)}}},e}(e);function p(){if(r.bleDevice)return Promise.resolve();h.log("ble: requesting device");var e=[];return i()&&(e.push(l.SERVICE_UUID),e.push(a.SERVICE_UUID)),o()&&e.push(u.SERVICE_UUID),navigator.bluetooth.requestDevice({filters:h.appTarget.appTheme.bluetoothUartFilters,optionalServices:e}).then(function(e){return h.log("ble: received device "+e.name),r.bleDevice=new f(e),r.bleDevice.startServices(),r.bleDevice.connectAsync()})}r.BLEDevice=f,r.bleDevice=void 0,r.isPaired=function(){return!!r.bleDevice},r.pairAsync=function(){return r.bleDevice&&(r.bleDevice.kill(),r.bleDevice=void 0),p().catch(function(e){r.bleDevice&&r.bleDevice.aliveToken&&r.bleDevice.aliveToken.resolveCancel(),h.log("ble: error "+e.message)})},r.flashAsync=function(e,t){void 0===t&&(t={}),h.tickEvent("webble.flash");var n=e.outfiles[ts.pxtc.BINARY_HEX];return p().then(function(){return r.bleDevice.partialFlashingService.flashAsync(n)}).then(function(){return h.tickEvent("webble.flash.success")}).catch(function(e){throw h.tickEvent("webble.fail.fail",{message:e.message}),e})}}(h.webBluetooth||(h.webBluetooth={}))}(pxt||(pxt={})),function(l){!function(o){var t=function(n){function e(e){var t=n.call(this,e)||this;return t.message=e,t}return __extends(e,n),e}(Error);o.USBError=t;o.filters=[{classCode:255,subclassCode:42}];var r=!0;o.setFilters=function(e){r=!1,o.filters=e};var n,i=function(){function e(e){var t=this;this.dev=e,this.ready=!1,this.readLoopStarted=!1,this.onData=function(e){},this.onError=function(e){},this.onEvent=function(e){},navigator.usb.addEventListener("disconnect",function(e){e.device==t.dev&&(t.log("Device disconnected"),t.clearDev())})}return e.prototype.clearDev=function(){this.dev=null,this.epIn=null,this.epOut=null},e.prototype.error=function(e){throw new t(l.U.lf("USB error on device {0} ({1})",this.dev.productName,e))},e.prototype.log=function(e){e="WebUSB: "+e,l.log(e)},e.prototype.disconnectAsync=function(){var e=this;return this.dev?(this.ready=!1,this.log("close device"),this.dev.close().catch(function(e){}).then(function(){return e.clearDev(),Promise.delay(500)})):Promise.resolve()},e.prototype.reconnectAsync=function(){var t=this;return this.log("reconnect"),this.disconnectAsync().then(a).then(function(e){return t.log("got device: "+e.manufacturerName+" "+e.productName),t.dev=e,t.initAsync()})},e.prototype.sendPacketAsync=function(e){var t=this;return this.dev?(l.Util.assert(e.length<=64),this.epOut?this.dev.transferOut(this.epOut.endpointNumber,e).then(function(e){"ok"!=e.status&&t.error("USB OUT transfer failed")}):this.dev.controlTransferOut({requestType:"class",recipient:"interface",request:9,value:512,index:this.iface.interfaceNumber},e).then(function(e){"ok"!=e.status?t.error("USB CTRL OUT transfer failed"):r||t.recvOne()})):Promise.reject(new Error("Disconnected"))},e.prototype.recvOne=function(){var t=this;this.recvPacketAsync().then(function(e){t.onData(e)},function(e){t.onError(e)})},e.prototype.readLoop=function(){var t=this;if(!this.readLoopStarted){this.readLoopStarted=!0,this.log("start read loop");var n=function(){t.ready?t.recvPacketAsync().then(function(e){e[0]?(t.onData(e),n()):Promise.delay(500).then(n)},function(e){t.dev&&t.onError(e),Promise.delay(300).then(n)}):Promise.delay(300).then(n)};n()}},e.prototype.recvPacketAsync=function(){var n=this,e=function(e){"ok"!=e.status&&n.error("USB IN transfer failed");var t=new Uint8Array(e.data.buffer);return 0==t.length?n.recvPacketAsync():t};return this.dev?this.epIn?this.dev.transferIn(this.epIn.endpointNumber,64).then(e):this.dev.controlTransferIn({requestType:"class",recipient:"interface",request:1,value:256,index:this.iface.interfaceNumber},64).then(e):Promise.reject(new Error("Disconnected"))},e.prototype.initAsync=function(){var t=this;if(!this.dev)return Promise.reject(new Error("Disconnected"));var n=this.dev;return this.log("open device"),n.open().then(function(){return t.log("select configuration"),n.selectConfiguration(1)}).then(function(){t.log("got "+n.configurations[0].interfaces.length+" interfaces");var e=n.configurations[0].interfaces.filter(function(e){for(var t=e.alternates[0],n=0,r=o.filters;n<r.length;n++){var i=r[n];if((null==i.classCode||t.interfaceClass===i.classCode)&&!(null!=i.subclassCode&&t.interfaceSubclass!==i.subclassCode||null!=i.protocolCode&&t.interfaceProtocol!==i.protocolCode)){if(0==t.endpoints.length)return!0;if(2==t.endpoints.length&&t.endpoints.every(function(e){return 64==e.packetSize}))return!0}}return!1})[0];return e||t.error("cannot find supported USB interface"),t.altIface=e.alternates[0],t.iface=e,t.altIface.endpoints.length&&(t.epIn=t.altIface.endpoints.filter(function(e){return"in"==e.direction})[0],t.epOut=t.altIface.endpoints.filter(function(e){return"out"==e.direction})[0],l.Util.assert(64==t.epIn.packetSize),l.Util.assert(64==t.epOut.packetSize)),t.log("claim interface"),n.claimInterface(e.interfaceNumber)}).then(function(){t.log("device ready"),t.ready=!0,(t.epIn||r)&&t.readLoop()})},e}();function a(){return navigator.usb.getDevices().then(function(e){if(!e||!e.length){var t=new Error(l.U.lf("No USB device selected or connected; try pairing!"));throw t.isUserError=!0,t.type="devicenotfound",t}return e[0]})}function s(){return n||(n=a().then(function(e){var t=new i(e);return t.initAsync().then(function(){return t})}).catch(function(e){return n=null,Promise.reject(e)})),n}function c(){if(navigator.usb){var e=/Windows NT (\d+\.\d+)/.exec(navigator.userAgent);return!(e&&parseFloat(e[1])<6.3)}return!1}o.pairAsync=function(){return navigator.usb.requestDevice({filters:o.filters}).then(function(e){return s()}).then(function(e){return e.reconnectAsync()})},o.isPairedAsync=function(){return o.isEnabled?a().then(function(e){return!0}).catch(function(){return!1}):Promise.resolve(!1)},o.mkPacketIOAsync=s,o.isEnabled=!1,o.setEnabled=function(e){c()||(e=!1),o.isEnabled=e},o.isAvailable=c}(l.usb||(l.usb={}))}(pxt||(pxt={})),function(s){!function(e){var n=s.Util,r={};function a(o){var a={},s=0,e=new n.PromiseQueue,t=new Promise(function(e,t){a.ready=e});e.enqueue("main",function(){return t});return{opAsync:function(r,i){return e.enqueue("main",function(){return new Promise(function(t,n){var e=""+s++;a[e]=function(e){e?e.errorMessage?n(new Error(e.errorMessage)):t(e):n(new Error("no response"))},o({id:e,op:r,arg:i})})})},recvHandler:function(e){if(a.hasOwnProperty(e.id)){var t=a[e.id];delete a[e.id],t(e.result)}}}}function i(e){var t=new Worker(e),n=a(function(e){return t.postMessage(e)});return t.onmessage=function(e){s.perf.measureStart("webworker recvHandler"),n.recvHandler(e.data),s.perf.measureEnd("webworker recvHandler")},n}e.getWorker=function(e){var t=r[e];return t||(t=r[e]=i(e)),t},e.wrap=a,e.makeWebWorker=i,e.makeWebSocket=function(e,n){void 0===n&&(n=null);var i=new WebSocket(e),o=[],r=a(function(e){var t=JSON.stringify(e);o?o.push(t):i.send(t)});return i.onmessage=function(e){var t=JSON.parse(e.data);n&&null==t.id?n(t):r.recvHandler(t)},i.onopen=function(e){s.debug("socket opened");for(var t=0,n=o;t<n.length;t++){var r=n[t];i.send(r)}o=null},i.onclose=function(e){s.debug("socket closed")},i.onerror=function(e){s.debug("socket errored")},r}}(s.worker||(s.worker={}))}(pxt||(pxt={})),function(e){var b;(function(m){function v(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];return e.replace(/{(\d+)}/g,function(e,t){return n[+t]})}m.debug=!1,m.lf=v;var g=y("opcode name doesn't match","<name>"),a=function(){function e(e,t,n,r,i){var o=this;this.opcode=n,this.mask=r,this.is32bit=i,this.canBeShared=!1,b.assert((n&r)==n),this.ei=e,this.code=t.replace(/\s+/g," "),this.friendlyFmt=t.replace(/\$\w+/g,function(e){return o.ei.encoders[e]?o.ei.encoders[e].pretty:e});var a=u(t);this.name=a[0],this.args=a.slice(1)}return e.prototype.emit=function(e){var t=e.words;if(t[0]!=this.name)return g;for(var n=this.opcode,r=1,i=0,o=[],a=null,s=null,c=null,l=0;l<this.args.length;++l){var u=this.args[l],f=t[r++];if("$"==u[0]){var p=this.ei.encoders[u],h=null;if(p.isRegister){if(null==(h=this.ei.registerNo(f)))return y("expecting register name",f);this.ei.isPush(this.opcode)?i++:this.ei.isPop(this.opcode)&&i--}else if(p.isImmediate){if(f=f.replace(/^#/,""),null==(h=e.bin.parseOneInt(f)))return y("expecting number",f);this.ei.isAddSP(this.opcode)?i=-h/this.ei.wordSize():this.ei.isSubSP(this.opcode)&&(i=h/this.ei.wordSize())}else if(p.isRegList){if("{"!=f)return y("expecting {",f);for(h=0;"}"!=t[r];){if(!(f=t[r++]))return y("expecting }",t[r-2]);var d=this.ei.registerNo(f);if(null==d)return y("expecting register name",f);if(h&1<<d)return y("duplicate register name",f);h|=1<<d,this.ei.isPush(this.opcode)?i++:this.ei.isPop(this.opcode)&&i--,","==t[r]&&r++}f=t[r++]}else if(p.isLabel){if(f=f.replace(/^#/,""),/^[+-]?\d+$/.test(f))a="rel"+(h=parseInt(f,10));else if(/^0x[0-9a-fA-F]+$/.test(f))a="abs"+(h=parseInt(f,16));else if(a=f,null==(h=this.ei.getAddressFromLabel(e.bin,this,f,p.isWordAligned))){if(e.bin.finalEmit)return y("unknown label",f);h=8}if(this.ei.is32bit(this)){s=h,c=f;continue}}else b.oops();if(null==h)return y("didn't understand it",f);if(o.push(h),null==(h=p.encode(h)))return y("argument out of range or mis-aligned",f);b.assert(0==(n&h)),n|=h}else if(u!=f)return y("expecting "+u,f)}return t[r]?y("trailing tokens",t[r]):this.ei.is32bit(this)?this.ei.emit32(n,s,e.bin.normalizeExternalLabel(c)):{stack:i,opcode:n,numArgs:o,labelName:e.bin.normalizeExternalLabel(a)}},e.prototype.toString=function(){return this.friendlyFmt},e}();m.Instruction=a;var l=function(){function e(e,t){this.bin=e,this.text=t}return e.prototype.getOpExt=function(){return this.instruction?this.instruction.code:""},e.prototype.getOp=function(){return this.instruction?this.instruction.name:""},e.prototype.update=function(e){this.bin.peepOps++,(e=e.replace(/^\s*/,""))||this.bin.peepDel++,e&&(e+="      "),e="    "+e,this.text=e+"; WAS: "+this.text.trim(),this.instruction=null,this.numArgs=null,this.words=u(e)||[],0==this.words.length?this.type="empty":"@"==this.words[0][0]&&(this.type="directive")},e}();m.Line=l;var s=function(){function e(e){this.baseOffset=0,this.checkStack=!0,this.inlineMode=!1,this.normalizeExternalLabel=function(e){return e},this.currLineNo=0,this.scope="",this.scopeId=0,this.errors=[],this.labels={},this.equs={},this.stackpointers={},this.stack=0,this.commPtr=0,this.peepOps=0,this.peepDel=0,this.peepCounts={},this.stats="",this.throwOnError=!1,this.disablePeepHole=!1,this.stackAtLabel={},this.currLine=new l(this,"<start>"),this.currLine.lineNo=0,this.ei=e,this.ei.file=this}return e.prototype.emitShort=function(e){b.assert(0<=e&&e<=65535),this.buf.push(e)},e.prototype.emitOpCode=function(e){this.emitShort(e)},e.prototype.location=function(){return 2*this.buf.length},e.prototype.pc=function(){return this.location()+this.baseOffset},e.prototype.parseOneInt=function(e){if(!e)return null;if(/^\d+$/.test(e))return parseInt(e,10);var t=e.indexOf("-");if(0<t)return this.parseOneInt(e.slice(0,t))-this.parseOneInt(e.slice(t+1));var n=1;if(0<=e.indexOf("*"))for(var r=null;r=/^([^\*]*)\*(.*)$/.exec(e);){var i=this.parseOneInt(r[1]);if(null==i)return null;n*=i,e=r[2]}if("-"==e[0]?(n*=-1,e=e.slice(1)):"+"==e[0]&&(e=e.slice(1)),/^\d+$/.test(e))return n*parseInt(e,10);if(b.U.endsWith(e,"|1"))return 1|this.parseOneInt(e.slice(0,e.length-2));if(b.U.endsWith(e,"-1"))return this.parseOneInt(e.slice(0,e.length-2))-1;if(b.U.endsWith(e,"+1"))return this.parseOneInt(e.slice(0,e.length-2))+1;var o=/(.*)>>(\d+)$/.exec(e);if(o){var a=this.parseOneInt(o[1]);return(a&=~(-16777216&this.baseOffset))>>parseInt(o[2])}var s=null;return"0"==e[0]&&("x"==e[1]||"X"==e[1]?(r=/^0x([a-f0-9]+)$/i.exec(e))&&(s=parseInt(r[1],16)):"b"!=e[1]&&"B"!=e[1]||(r=/^0b([01]+)$/i.exec(e))&&(s=parseInt(r[1],2))),0<=e.indexOf("@")&&((r=/^(\w+)@(-?\d+)$/.exec(e))&&(1!=n&&this.directiveError(v("multiplication not supported with saved stacks")),this.stackpointers.hasOwnProperty(r[1])?s=this.ei.wordSize()*this.ei.computeStackOffset(r[1],this.stack-this.stackpointers[r[1]]+parseInt(r[2])):this.directiveError(v("saved stack not found"))),(r=/^(.*)@(hi|lo|fn)$/.exec(e))&&this.looksLikeLabel(r[1])&&null!=(s=this.lookupLabel(r[1],!0))&&("fn"==r[2]?s=this.ei.toFnPtr(s,this.baseOffset,r[1]):0<=(s>>=1)&&s<=65535?"hi"==r[2]?s=s>>8&255:"lo"==r[2]?s&=255:b.oops():(this.directiveError(v("@hi/lo out of range")),s=null))),null==s&&this.looksLikeLabel(e)&&null!=(s=this.lookupLabel(e,!0))&&1==this.ei.postProcessRelAddress(this,1)&&(s+=this.baseOffset),null==s||isNaN(s)?null:s*n},e.prototype.looksLikeLabel=function(e){return!/^(r\d|pc|sp|lr)$/i.test(e)&&/^[\.a-zA-Z_][\.:\w+]*$/.test(e)},e.prototype.scopedName=function(e){return"."==e[0]&&this.scope?this.scope+"$"+e:e},e.prototype.lookupLabel=function(e,t){void 0===t&&(t=!1);var n=null,r=this.scopedName(e);return this.labels.hasOwnProperty(r)?(n=this.labels[r],n=this.ei.postProcessRelAddress(this,n)):this.lookupExternalLabel&&null!=(n=this.lookupExternalLabel(e))&&(n=this.ei.postProcessAbsAddress(this,n)),null==n&&this.equs.hasOwnProperty(r)&&(n=this.equs[r]),null==n&&t&&(this.finalEmit?this.directiveError(v("unknown label: {0}",e)):n=11111),n},e.prototype.align=function(e){for(b.assert(2==e||4==e||8==e||16==e);this.location()%e!=0;)this.emitOpCode(0)},e.prototype.pushError=function(e,t){void 0===t&&(t="");var n={scope:this.scope,message:v("  -> Line {2} ('{1}'), error: {0}\n{3}",e,this.currLine.text,this.currLine.lineNo,t),lineNo:this.currLine.lineNo,line:this.currLine.text,coremsg:e,hints:t};if(this.errors.push(n),this.throwOnError)throw new Error(n.message)},e.prototype.directiveError=function(e){this.pushError(e)},e.prototype.emitString=function(e,t){function n(e,t){return 255&(e.charCodeAt(t)||0)}void 0===t&&(t=!1);var r,i=/^\s*([\w\.]+\s*:\s*)?.\w+\s+(".*")\s*$/.exec(e);if(i&&null!=(r=function(e){e=e.replace(/\\\\/g,"\\B").replace(/\\(['\?])/g,function(e,t){return t}).replace(/\\[z0]/g,"\0").replace(/\\x([0-9a-f][0-9a-f])/gi,function(e,t){return"\\u00"+t}).replace(/\\B/g,"\\\\");try{return JSON.parse(e)}catch(e){return null}}(i[2])))if(this.align(2),t)for(var o=0;o<r.length;o++)this.emitShort(r.charCodeAt(o));else for(o=0;o<r.length+1;o+=2)this.emitShort(n(r,o+1)<<8|n(r,o));else this.directiveError(v("expecting string"))},e.prototype.parseNumber=function(e){var t=this.parseOneInt(e.shift());return null==t?null:t},e.prototype.parseNumbers=function(e){e=e.slice(1);for(var t=[];;){var n=this.parseNumber(e);if(null==n){this.directiveError(v("cannot parse number at '{0}'",e[0]));break}if(t.push(n),","!=e[0]){if(null==e[0])break;this.directiveError(v("expecting number, got '{0}'",e[0]));break}if(e.shift(),null==e[0])break}return t},e.prototype.emitSpace=function(e){var t=this.parseNumbers(e);if(1==t.length&&t.push(0),2!=t.length)this.directiveError(v("expecting one or two numbers"));else if(t[0]%2!=0)this.directiveError(v("only even space supported"));else{var n=255&t[1];n|=n<<8;for(var r=0;r<t[0];r+=2)this.emitShort(n)}},e.prototype.emitBytes=function(e){var t=this.parseNumbers(e);t.length%2!=0&&(this.directiveError(".bytes needs an even number of arguments"),t.push(0));for(var n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];0<=r&&i<=255&&0<=i&&r<=255?this.emitShort(255&r|(255&i)<<8):this.directiveError(v("expecting uint8"))}},e.prototype.emitHex=function(e){var r=this;e.slice(1).forEach(function(e){if(","!=e)if(e.length%4!=0)r.directiveError(".hex needs an even number of bytes");else if(/^[a-f0-9]+$/i.test(e))for(var t=0;t<e.length;t+=4){var n=parseInt(e.slice(t,t+4),16);n=(255&n)<<8|n>>8&255,r.emitShort(n)}else r.directiveError(".hex needs a hex number")})},e.prototype.handleDirective=function(e){var t,n=this,r=e.words,i=function(){2!=r.length&&n.directiveError(v("expecting one argument"))};switch(r[0]){case".ascii":case".asciz":case".string":this.emitString(e.text);break;case".utf16":this.emitString(e.text,!0);break;case".align":if(i(),null!=(t=this.parseOneInt(r[1]))){if(0==t)return;t<=4?this.align(1<<t):this.directiveError(v("expecting 1, 2, 3 or 4 (for 2, 4, 8, or 16 byte alignment)"))}else this.directiveError(v("expecting number"));break;case".balign":if(i(),null!=(t=this.parseOneInt(r[1]))){if(1==t)return;2==t||4==t||8==t||16==t?this.align(t):this.directiveError(v("expecting 2, 4, 8, or 16"))}else this.directiveError(v("expecting number"));break;case".p2align":i(),null!=(t=this.parseOneInt(r[1]))?this.align(1<<t):this.directiveError(v("expecting number"));break;case".byte":this.emitBytes(r);break;case".hex":this.emitHex(r);break;case".hword":case".short":case".2bytes":this.parseNumbers(r).forEach(function(e){-32768<=e&&e<=65535?n.emitShort(65535&e):n.directiveError(v("expecting int16"))});break;case".word":case".4bytes":case".long":this.parseNumbers(r).forEach(function(e){-2147483648<=e&&e<=4294967295?(n.emitShort(65535&e),n.emitShort(e>>16&65535)):n.directiveError(v("expecting int32"))});break;case".skip":case".space":this.emitSpace(r);break;case".set":case".equ":/^\w+$/.test(r[1])||this.directiveError(v("expecting name"));var o=this.parseNumbers(r.slice(","==r[2]||"="==r[2]?2:1));1!=o.length&&this.directiveError(v("expecting one value")),void 0!==this.equs[r[1]]&&this.equs[r[1]]!=o[0]&&this.directiveError(v("redefinition of {0}",r[1])),this.equs[r[1]]=o[0];break;case".startaddr":this.location()&&this.directiveError(v(".startaddr can be only be specified at the beginning of the file")),i(),this.baseOffset=this.parseOneInt(r[1]);break;case"@stackmark":i(),this.stackpointers[r[1]]=this.stack;break;case"@stackempty":this.checkStack&&(null==this.stackpointers[r[1]]?this.directiveError(v("no such saved stack")):this.stackpointers[r[1]]!=this.stack&&this.directiveError(v("stack mismatch")));break;case"@scope":this.scope=r[1]||"",this.currLineNo=this.scope?0:this.realCurrLineNo;break;case".syntax":case"@nostackcheck":this.checkStack=!1;break;case"@dummystack":i(),this.stack+=this.parseOneInt(r[1]);break;case".section":case".global":this.stackpointers={},this.stack=0,this.scope="$S"+this.scopeId++;break;case".comm":(r=r.filter(function(e){return","!=e})).shift();var a=this.parseOneInt(r[1]),s=0;if(s=r[2]?this.parseOneInt(r[2]):4,null==this.lookupLabel(r[0])){for(this.commPtr||(this.commPtr=this.lookupExternalLabel("_pxt_comm_base")||0,this.commPtr||this.directiveError(v("PXT_COMM_BASE not defined")));this.commPtr&s-1;)this.commPtr++;this.labels[this.scopedName(r[0])]=this.commPtr-this.baseOffset,this.commPtr+=a}break;case".file":case".text":case".cpu":case".fpu":case".eabi_attribute":case".code":case".thumb_func":case".type":case".fnstart":case".save":case".size":case".fnend":case".pad":case".globl":case".local":case"@":break;default:/^\.cfi_/.test(r[0])||this.directiveError(v("unknown directive"))}},e.prototype.handleOneInstruction=function(e,t){var n=t.emit(e);return!n.error&&(this.stack+=n.stack,this.checkStack&&this.stack<0&&this.pushError(v("stack underflow")),e.location=this.location(),e.opcode=n.opcode,e.stack=n.stack,this.emitOpCode(n.opcode),null!=n.opcode2&&this.emitOpCode(n.opcode2),null!=n.opcode3&&this.emitOpCode(n.opcode3),e.instruction=t,e.numArgs=n.numArgs,!0)},e.prototype.handleInstruction=function(n){var t=this;if(!n.instruction||!this.handleOneInstruction(n,n.instruction)){var e=function(e){return t.ei.instructions.hasOwnProperty(e)?t.ei.instructions[e]:[]};if(!n.instruction)for(var r=e(n.words[0]),i=0;i<r.length;++i)if(this.handleOneInstruction(n,r[i]))return;var o=n.words[0].toLowerCase().replace(/s$/,"").replace(/[^a-z]/g,""),a="",s=e(o).concat(e(o+"s"));0<s.length&&s.forEach(function(e){var t=e.emit(n);a+=v("   Maybe: {0} ({1} at '{2}')\n",e.toString(),t.error,t.errorAt)}),this.pushError(v("assembly error"),a)}},e.prototype.buildLine=function(e,n){var r=this,t=function(e){var t=new l(r,e);return t.scope=r.scope,t.lineNo=r.currLineNo,n.push(t),t},i=t(e),o=u(i.text)||[],a=(i.words=o)[0]||"";if(":"==a.charAt(a.length-1)){var s=/^([\.\w]+):$/.exec(o[0]);if(s){if(i.type="label",i.text=s[1]+":",i.words=[s[1]],!(1<o.length))return;o.shift(),a=((i=t(e.replace(/^[^:]*:/,""))).words=o)[0]||""}}var c=a.charAt(0);"."==c||"@"==c?(i.type="directive","@scope"==i.words[0]&&this.handleDirective(i)):0==i.words.length?i.type="empty":i.type="instruction"},e.prototype.prepLines=function(e){var t=this;this.currLineNo=0,this.realCurrLineNo=0,this.lines=[],e.split(/\r?\n/).forEach(function(e){10<t.errors.length||(t.currLineNo++,t.realCurrLineNo++,t.buildLine(e,t.lines))})},e.prototype.iterLines=function(){var r=this;this.stack=0,this.buf=[],this.scopeId=0,this.lines.forEach(function(e){if(!(10<r.errors.length)&&0!=(r.currLine=e).words.length)if("label"==e.type){var t=r.scopedName(e.words[0]);if(r.prevLabel=t,r.finalEmit){null!=r.equs[t]&&r.directiveError(v(".equ redefined as label"));var n=r.labels[t];null==n&&b.oops(),0==r.errors.length&&n!=r.location()&&b.oops("invalid location: "+r.location()+" != "+n+" at "+t),b.assert(0<r.errors.length||n==r.location()),r.reallyFinalEmit&&(r.stackAtLabel[t]=r.stack)}else r.labels.hasOwnProperty(t)?r.directiveError(v("label redefinition")):r.inlineMode&&/^_/.test(t)?r.directiveError(v("labels starting with '_' are reserved for the compiler")):r.labels[t]=r.location();e.location=r.location()}else"directive"==e.type?r.handleDirective(e):"instruction"==e.type?r.handleInstruction(e):"empty"==e.type||b.oops()})},e.prototype.getSource=function(r,e,t){var i=this;void 0===e&&(e=1),void 0===t&&(t=0);var o=0,n=function(e){var t=i.labels[e]||o,n=t-o;return o=t,n},a=this.buf?this.location():0,s=n("_code_end"),c=n("_helpers_end"),l=n("_vtables_end"),u=n("_literals_end"),f=o,p=a+this.baseOffset&16777215;t&&t<p&&b.U.userError(v("program too big by {0} bytes!",p-t));var h=v("; total bytes: {0} ({1}% of {2}k flash with {3} free)",p,(100*p/(t=t||131072)).toFixed(1),(t/1024).toFixed(1),t-p),d=v("; generated code sizes (bytes): {0} (incl. {1} user, {2} helpers, {3} vtables, {4} lits); src size {5}\n",f,s,c,l,u,a-f)+v("; assembly: {0} lines; density: {1} bytes/stmt; ({2} stmts)\n",this.lines.length,Math.round(100*s/e)/100,e)+h+"\n"+this.stats+"\n\n",g=!1;return this.lines.forEach(function(e,t){if("_stored_program"==e.words[0])return d+='_stored_program: .string "..."\n',void(g=!0);if(g)g=!1;else{var n=e.text;if(r){if("@stackempty"==e.words[0]&&i.lines[t-1].text==e.text)return;if(!(n=n.replace(/; WAS: .*/,"")).trim())return}m.debug&&("label"!=e.type&&"instruction"!=e.type||(n+=" \t; 0x"+(e.location+i.baseOffset).toString(16))),d+=n+"\n"}}),d},e.prototype.peepHole=function(){for(var e=this.lines.filter(function(e){return"empty"!=e.type}),t=0;t<e.length;++t){var n=e[t];if(!/^user/.test(n.scope)){var r=e[t+1];if(r){var i=e[t+2];"instruction"==n.type&&this.ei.peephole(n,r,i)}}}},e.prototype.clearLabels=function(){this.labels={},this.commPtr=0},e.prototype.peepPass=function(e){this.disablePeepHole||(this.peepOps=0,this.peepDel=0,this.peepCounts={},this.peepHole(),this.throwOnError=!0,this.finalEmit=!1,this.clearLabels(),this.iterLines(),b.assert(!this.checkStack||0==this.stack),this.finalEmit=!0,this.reallyFinalEmit=e||0==this.peepOps,this.iterLines(),this.stats+=v("; peep hole pass: {0} instructions removed and {1} updated\n",this.peepDel,this.peepOps-this.peepDel))},e.prototype.getLabels=function(){var n=this;return this.userLabelsCache||(this.userLabelsCache=b.U.mapMap(this.labels,function(e,t){return t+n.baseOffset})),this.userLabelsCache},e.prototype.emit=function(e){if(b.assert(null==this.buf),this.prepLines(e),!(0<this.errors.length||(this.clearLabels(),this.iterLines(),this.checkStack&&0!=this.stack&&this.directiveError(v("stack misaligned at the end of the file")),0<this.errors.length||(this.ei.expandLdlit(this),this.clearLabels(),this.iterLines(),this.finalEmit=!0,this.reallyFinalEmit=this.disablePeepHole,this.iterLines(),0<this.errors.length))))for(var t=0;t<5&&(pxt.debug("Peephole OPT, pass "+t),this.peepPass(5==t),0!=this.peepOps);++t);},e}(),e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(m.File=s);m.VMFile=e;var t=function(){function e(){var o=this;this.file=null,this.addEnc=function(e,t,n){var r={name:e,pretty:t,encode:n,isRegister:/^\$r\d/.test(e),isImmediate:/^\$i\d/.test(e),isRegList:/^\$rl\d/.test(e),isLabel:/^\$l[a-z]/.test(e)};return o.encoders[e]=r},this.inrange=function(e,t,n){return Math.floor(t)!=t?null:t<0?null:e<t?null:n},this.inminmax=function(e,t,n,r){return Math.floor(n)!=n?null:n<e?null:t<n?null:r},this.inseq=function(e,t){var n=e.indexOf(t);return n<0?null:n},this.inrangeSigned=function(e,t,n){return Math.floor(t)!=t?null:t<-(e+1)?null:e<t?null:n&(e<<1|1)},this.addInst=function(e,t,n,r){var i=new a(o,e,t,n,r);return o.instructions.hasOwnProperty(i.name)||(o.instructions[i.name]=[]),o.instructions[i.name].push(i),i},this.encoders={},this.instructions={}}return e.prototype.toFnPtr=function(e,t,n){return e},e.prototype.wordSize=function(){return-1},e.prototype.computeStackOffset=function(e,t){return t},e.prototype.is32bit=function(e){return!1},e.prototype.emit32=function(e,t,n){return null},e.prototype.postProcessRelAddress=function(e,t){return t},e.prototype.postProcessAbsAddress=function(e,t){return t},e.prototype.peephole=function(e,t,n){},e.prototype.registerNo=function(e){return null},e.prototype.getAddressFromLabel=function(e,t,n,r){return void 0===r&&(r=!1),null},e.prototype.isPop=function(e){return!1},e.prototype.isPush=function(e){return!1},e.prototype.isAddSP=function(e){return!1},e.prototype.isSubSP=function(e){return!1},e.prototype.testAssembler=function(){b.assert(!1)},e.prototype.expandLdlit=function(e){},e}();function u(e){var t=[],n="";e:for(var r=0;r<e.length;++r)switch(e[r]){case"[":case"]":case"!":case"{":case"}":case",":n&&(t.push(n),n=""),t.push(e[r]);break;case" ":case"\t":case"\r":case"\n":n&&(t.push(n),n="");break;case";":break e;default:n+=e[r]}return n&&(t.push(n),n=""),t[0]?t:null}function y(e,t){return{stack:null,opcode:null,error:e,errorAt:t}}function c(e){return e<0||65535<e?("0x"+e.toString(16)).toLowerCase():("0x"+("000"+e.toString(16)).slice(-4)).toLowerCase()}m.AbstractProcessor=t,m.emitErr=y,m.expectError=function(e,t){var n=new s(e);n.emit(t),0==n.errors.length&&b.oops("ASMTEST: expecting error for: "+t)},m.tohex=c,m.expect=function(e,t){var n=[],r=t.replace(/^([0-9a-fA-F]{4,8})\s/gm,function(e,t){return n.push(parseInt(t.slice(0,4),16)),8==t.length&&n.push(parseInt(t.slice(4,8),16)),""}),i=new s(e);i.throwOnError=!0,i.disablePeepHole=!0,i.emit(r),0<i.errors.length&&(console.debug(i.errors[0].message),b.oops("ASMTEST: not expecting errors")),i.buf.length!=n.length&&b.oops("ASMTEST: wrong buf len");for(var o=0;o<n.length;++o)i.buf[o]!=n[o]&&b.oops("ASMTEST: wrong buf content at "+o+" , exp:"+c(n[o])+", got: "+c(i.buf[o]))}})((b=e.pxtc||(e.pxtc={})).assembler||(b.assembler={}))}(ts||(ts={})),function(f){!function(n){var a=pxtc.Util;n.apiRoot=f.BrowserUtils.isLocalHost()||a.isNodeJS?"https://www.makecode.com/api/":"/api/",n.accessToken="";var r=!(n.localToken="");function i(e){var t=new Error(a.lf("Cannot access {0} while offline",e));return t.isOffline=!0,Promise.delay(1e3).then(function(){return Promise.reject(t)})}function l(e,t){return f.U.requestAsync({url:"/api/"+e,headers:{Authorization:n.localToken},method:t?"POST":"GET",data:t||void 0,allowHttpErrors:!0})}function u(t){return t.url=f.webConfig&&f.webConfig.isStatic&&!t.forceLiveEndpoint?f.webConfig.relprefix+t.url:n.apiRoot+t.url,t.allowGzipPost=!0,n.isOnline()?(t.headers||(t.headers={}),f.BrowserUtils.isLocalHost()?n.localToken&&(t.headers.Authorization=n.localToken):n.accessToken&&(t.headers["x-td-access-token"]=n.accessToken),a.requestAsync(t).catch(function(e){return 0==e.statusCode?(r&&(r=!1,n.onOffline()),i(t.url)):Promise.reject(e)})):i(t.url)}n.onOffline=function(){},n.hasAccessToken=function(){return!!n.accessToken},n.localRequestAsync=l,n.privateRequestAsync=u,n.privateGetTextAsync=function(e,t){return u({url:e,headers:t}).then(function(e){return e.text})},n.privateGetAsync=function(e,t){return void 0===t&&(t=!1),u({url:e,forceLiveEndpoint:t}).then(function(e){return e.json})},n.downloadTargetConfigAsync=function(){if(!n.isOnline())return Promise.resolve(void 0);var e=f.appTarget.versions&&f.appTarget.versions.target,t=f.webConfig&&f.webConfig.isStatic?"targetconfig.json":"config/"+f.appTarget.id+"/targetconfig"+(e?"/v"+e:"");return f.BrowserUtils.isLocalHost()?l(t).then(function(e){return e?e.json:void 0}):n.privateGetAsync(t)},n.downloadScriptFilesAsync=function(e){return u({url:e+"/text",forceLiveEndpoint:!0}).then(function(e){return JSON.parse(e.text)})};var o=f.BrowserUtils.isLocalHostDev()?1:36e5;function s(e,t,n,r){var i,o=f.webConfig&&f.webConfig.isStatic,a=f.appTarget.versions&&f.appTarget.versions.target||"?";if(o){var s=/\/?docs\//.test(i=e),c=/\.\w+$/.test(i);s||(i="docs/"+i),c||(i+=".md")}else i="md/"+f.appTarget.id+"/"+e.replace(/^\//,"")+"?targetVersion="+encodeURIComponent(a);return o||"en"==t||(i+="&lang="+encodeURIComponent(t),n&&(i+="&live=1")),f.BrowserUtils.isLocalHost()&&!n?l(i).then(function(e){return 404==e.statusCode?u({url:i,method:"GET"}).then(function(e){return{md:e.text,etag:e.headers.etag}}):{md:e.text,etag:void 0}}):u({url:i,method:"GET",headers:r?{"If-None-Match":r}:void 0}).then(function(e){return{md:e.text,etag:e.headers.etag}})}function e(){return navigator&&navigator.onLine}n.markdownAsync=function(r,i,e){return f.BrowserUtils.translationDbAsync().then(function(n){return n.getAsync(i,r,"").then(function(t){return t&&Date.now()-t.time>o&&s(r,i,e,t.etag).then(function(e){return n.setAsync(i,r,"",e.etag,void 0,e.md||t.md)}).catch(function(){}).done(),t&&t.md?t.md:s(r,i,e).then(function(e){return n.setAsync(i,r,"",e.etag,void 0,e.md).then(function(){return e.md})}).catch(function(){return""})})})},n.privateDeleteAsync=function(e){return u({url:e,method:"DELETE"}).then(function(e){return e.json})},n.privatePostAsync=function(e,t,n){return void 0===n&&(n=!1),u({url:e,data:t||{},forceLiveEndpoint:n}).then(function(e){return e.json})},n.isLoggedIn=function(){return!!n.accessToken},n.isNavigatorOnline=e,n.isOnline=function(){return"undefined"!=typeof navigator&&e()&&(r=!0),r},n.getServiceUrl=function(){return n.apiRoot.replace(/\/api\/$/,"")},n.getUserId=function(){var e=/^0(\w+)\./.exec(n.accessToken);return e?e[1]:null},n.parseScriptId=function(e){var t=f.appTarget;if(e&&t.appTheme&&t.cloud&&t.cloud.sharing){var n=["makecode.com"];t.appTheme.embedUrl&&n.push(t.appTheme.embedUrl),t.appTheme.shareUrl&&n.push(t.appTheme.shareUrl);var r="^((https://)?(?:"+(n=a.unique(n,function(e){return e}).map(function(e){return a.escapeForRegex(a.stripUrlProtocol(e).replace(/\/$/,"")).toLowerCase()})).join("|")+")/)?(api/oembed?url=.*%2F([^&]*)&.*?|([a-z0-9-_]+))$",i=new RegExp(r,"i").exec(e.trim()),o=i&&(!i[1]||0<=n.indexOf(a.escapeForRegex(i[1].replace(/https:\/\//,"").replace(/\/$/,"")).toLowerCase()))&&(i[3]||i[4])?i[3]?i[3]:i[4]:null;if(o)return"_"==o[0]&&13==o.length?o:23==o.length&&/^[0-9\-]+$/.test(o)?o:void 0}}}(f.Cloud||(f.Cloud={}))}(pxt||(pxt={})),function(e){var t=function(){function e(e){this.numCols=8,this.numRows=8,this.polyphonic=!1,e&&(this.tempo=e),this.resetMelody()}return e.prototype.setTempo=function(e){this.tempo=e},e.prototype.getArray=function(){return this.melody},e.prototype.setArray=function(e){this.melody=e},e.prototype.getColor=function(e){return 0},e.prototype.getValue=function(e,t){return this.melody[e][t]},e.prototype.getWidth=function(){return this.numCols},e.prototype.getHeight=function(){return this.numRows},e.prototype.updateMelody=function(e,t){var n=!this.melody[e][t];if(n&&!this.polyphonic)for(var r=0;r<this.numRows;r++)this.melody[r][t]=!1;this.melody[e][t]=n},e.prototype.getStringRepresentation=function(){for(var e="",t=new Array(this.numCols),n=0,r=0;r<this.numRows;r++){var i=0;t[r]=[];for(var o=0;o<this.numCols;o++)this.melody[o][r]&&(t[r].push(a(o)),i++);n<i&&(n=i)}if(0==n)return"- - - - - - - - ";for(o=0;o<n;o++)for(r=0;r<this.numCols;r++)t[r]&&0<t[r].length?e+=t[r].shift()+" ":e+="- ";return e},e.prototype.parseNotes=function(e){for(var t=(e=e.trim()).split(" "),n=0;n<t.length;n++){for(var r=0;r<this.numRows;r++)this.melody[r][n]=!1;"-"!=t[n]&&(this.melody[i(t[n])][n]=!0)}},e.prototype.setPolyphonic=function(e){this.polyphonic=e},e.prototype.isPolyphonic=function(){return this.polyphonic},e.prototype.resetMelody=function(){this.melody=new Array(this.numCols);for(var e=0;e<this.numCols;e++)this.melody[e]=new Array(this.numRows).fill(!1)},e}();function a(e){var t="";switch(e){case 0:t="C5";break;case 1:t="B";break;case 2:t="A";break;case 3:t="G";break;case 4:t="F";break;case 5:t="E";break;case 6:t="D";break;case 7:t="C"}return t}function i(e){var t=-1;switch(e){case"C5":t=0;break;case"B":t=1;break;case"A":t=2;break;case"G":t=3;break;case"F":t=4;break;case"E":t=5;break;case"D":t=6;break;case"C":t=7}return t}e.MelodyArray=t,e.rowToNote=a,e.noteToRow=i,e.getColorClass=function(e){var t="melody-default";switch(e){case 0:t="melody-red";break;case 1:t="melody-orange";break;case 2:t="melody-yellow";break;case 3:t="melody-green";break;case 4:t="melody-teal";break;case 5:t="melody-blue";break;case 6:t="melody-purple";break;case 7:t="melody-violet"}return t}}(pxtmelody||(pxtmelody={})),function(a){var e=function(){function e(){var e=this;this.value=null,this.visible=!1,this.timeouts=[],this.numSamples=a.SampleMelodies.length,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("id","melody-editor-gallery-outer"),this.contentDiv=document.createElement("div"),this.contentDiv.setAttribute("id","melody-editor-gallery"),this.itemBackgroundColor="#DCDCDC",this.itemBorderColor="white",this.initStyles(),this.containerDiv.appendChild(this.contentDiv),this.containerDiv.style.display="none",this.contentDiv.addEventListener("animationend",function(){e.visible||(e.containerDiv.style.display="none")}),this.contentDiv.addEventListener("wheel",function(e){e.stopPropagation()},!0)}return e.prototype.getElement=function(){return this.containerDiv},e.prototype.getValue=function(){return this.value},e.prototype.show=function(e){this.pending=e,this.containerDiv.style.display="block",this.buildDom(),this.visible=!0,pxt.BrowserUtils.removeClass(this.contentDiv,"hidden-above"),pxt.BrowserUtils.addClass(this.contentDiv,"shown")},e.prototype.hide=function(){this.visible=!1,pxt.BrowserUtils.removeClass(this.contentDiv,"shown"),pxt.BrowserUtils.addClass(this.contentDiv,"hidden-above"),this.value=null,this.stopMelody()},e.prototype.clearDomReferences=function(){this.contentDiv=null,this.containerDiv=null},e.prototype.layout=function(e,t,n){this.containerDiv.style.left=e+"px",this.containerDiv.style.top=t+"px",this.containerDiv.style.height=n+"px"},e.prototype.buildDom=function(){for(;this.contentDiv.firstChild;)this.contentDiv.removeChild(this.contentDiv.firstChild);var e=a.SampleMelodies;this.buttons=[];for(var t=0;t<e.length;t++)this.mkButton(e[t],t,"255px","45px")},e.prototype.initStyles=function(){var e=document.createElement("style");e.textContent="\n            #melody-editor-gallery {\n                margin-top: -100%;\n            }\n\n            #melody-editor-gallery.hidden-above {\n                margin-top: -100%;\n                animation: slide-up 0.2s 0s ease;\n            }\n\n            #melody-editor-gallery.shown {\n                margin-top: 0px;\n                animation: slide-down 0.2s 0s ease;\n            }\n\n            @keyframes slide-down {\n                0% {\n                    margin-top: -100%;\n                }\n                100% {\n                    margin-top: 0px;\n                }\n            }\n\n            @keyframes slide-up {\n                0% {\n                    margin-top: 0px;\n                }\n                100% {\n                    margin-top: -100%;\n                }\n            }\n            ",this.containerDiv.appendChild(e)},e.prototype.mkButton=function(e,t,n,r){var i=this,o=p("div",{className:"melody-gallery-button melody-editor-card",role:"menuitem",id:":"+t}),a=p("i",{className:"music icon melody-icon"}),s=p("div",{className:"melody-editor-text"});s.innerText=e.name;var c=this.createColorBlock(e),l=p("div",{className:"melody-editor-button left-button",role:"button",title:e.name},function(){return i.handleSelection(e)});l.appendChild(a),l.appendChild(s),l.appendChild(c),o.appendChild(l);var u=p("div",{className:"melody-editor-button right-button",role:"button",title:lf("Preview {0}",e.name)},function(){return i.togglePlay(e,t)}),f=p("i",{className:"play icon"});this.buttons[t]=f,u.appendChild(f),o.appendChild(u),this.contentDiv.appendChild(o)},e.prototype.handleSelection=function(e){if(this.pending){var t=this.pending;this.pending=void 0,t(e.notes)}},e.prototype.playNote=function(e,t,n){var r=0;switch(e){case"C5":r=523;break;case"B":r=494;break;case"A":r=440;break;case"G":r=392;break;case"F":r=349;break;case"E":r=330;break;case"D":r=294;break;case"C":r=262}this.timeouts.push(setTimeout(function(){pxt.AudioContextManager.tone(r)},t*this.getDuration(n))),this.timeouts.push(setTimeout(function(){pxt.AudioContextManager.stop()},(t+1)*this.getDuration(n)))},e.prototype.getDuration=function(e){return 6e4/e},e.prototype.previewMelody=function(e){this.stopMelody();for(var t=e.notes.split(" "),n=0;n<t.length;n++)this.playNote(t[n],n,e.tempo)},e.prototype.togglePlay=function(e,t){var n=this.buttons[t];pxt.BrowserUtils.containsClass(n,"play icon")?(this.resetPlayIcons(),pxt.BrowserUtils.removeClass(n,"play icon"),pxt.BrowserUtils.addClass(n,"stop icon"),this.previewMelody(e),this.timeouts.push(setTimeout(function(){pxt.BrowserUtils.removeClass(n,"stop icon"),pxt.BrowserUtils.addClass(n,"play icon")},e.notes.split(" ").length*this.getDuration(e.tempo)))):(pxt.BrowserUtils.removeClass(n,"stop icon"),pxt.BrowserUtils.addClass(n,"play icon"),this.stopMelody())},e.prototype.stopMelody=function(){for(;this.timeouts.length;)clearTimeout(this.timeouts.shift());pxt.AudioContextManager.stop()},e.prototype.resetPlayIcons=function(){for(var e=0;e<this.numSamples;e++){var t=this.buttons[e];if(pxt.BrowserUtils.containsClass(t,"stop icon")){pxt.BrowserUtils.removeClass(t,"stop icon"),pxt.BrowserUtils.addClass(t,"play icon");break}}},e.prototype.createColorBlock=function(e){var t=document.createElement("div");pxt.BrowserUtils.addClass(t,"melody-color-block");for(var n=e.notes.split(" "),r=0;r<n.length;r++){var i=a.getColorClass(a.noteToRow(n[r])),o=document.createElement("div");0==r?pxt.BrowserUtils.addClass(o,"left-edge sliver "+i):r==n.length-1?pxt.BrowserUtils.addClass(o,"right-edge sliver "+i):pxt.BrowserUtils.addClass(o,"sliver "+i),t.appendChild(o)}return t},e}();function p(e,t,n){return function(e,t,n){if(t)for(var r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];"className"===o?e.setAttribute("class",t[o]+""):e.setAttribute(o,t[o]+"")}n&&e.addEventListener("click",n);return e}(document.createElement(e),t,n)}a.MelodyGallery=e}(pxtmelody||(pxtmelody={})),function(e){var t=function(e,t,n){this.name=e,this.notes=t,this.tempo=n};e.MelodyInfo=t,e.SampleMelodies=[new t(lf("Scale"),"C5 B A G F E D C",120),new t(lf("Reverse"),"C D E F G A B C5",120),new t(lf("Mystery"),"E B C5 A B G A F",120),new t(lf("Gilroy"),"A F E F D G E F",120),new t(lf("Falling"),"C5 A B G A F G E",120),new t(lf("Hopeful"),"G B A G C5 B A B",120),new t(lf("Tokyo"),"B A G A G F A C5",120),new t(lf("Paris"),"G F G A - F E D",120),new t(lf("Rising"),"E D G F B A C5 B",120),new t(lf("Sitka"),"C5 G B A F A C5 B",120)]}(pxtmelody||(pxtmelody={}));