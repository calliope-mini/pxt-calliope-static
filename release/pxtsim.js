var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim;!function(t){var e,n;(e=t.accessibility||(t.accessibility={})).makeFocusable=function(t){t.setAttribute("focusable","true"),t.setAttribute("tabindex","0")},e.enableKeyboardInteraction=function(t,n,r){n&&t.addEventListener("keydown",function(t){var e="number"==typeof t.which?t.which:t.keyCode;32!==e&&13!==e||n()}),r&&t.addEventListener("keyup",function(t){var e="number"==typeof t.which?t.which:t.keyCode;32!==e&&13!==e||r()})},e.setAria=function(t,e,n){e&&!t.hasAttribute("role")&&t.setAttribute("role",e),n&&!t.hasAttribute("aria-label")&&t.setAttribute("aria-label",n)},e.setLiveContent=function(t){n||((n=document.createElement("div")).setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("aria-hidden","false"),n.setAttribute("style","position: absolute !important;display: block;visibility: visible;overflow: hidden;width: 1px;height: 1px;margin: -1px;border: 0;padding: 0;clip: rect(0 0 0 0);"),document.body.appendChild(n)),n.textContent!==t&&(n.textContent=t)}}(pxsim||(pxsim={})),function(m){var p="blue",d="red",h="orange";var f=function(t){return 0<t.reduce(function(t,e){return t+(e?1:0)},0)};function g(t,e){var n={};for(var r in t)n[r]=t[r];for(var i in e)n[i]=e[i];return n}function v(t){m.U.assert(!!t,"Invalid pin: "+t);var e=/^(\w+)\.\s*(?:[a-z]*)?([A-Z][A-Z\d_]+)$/.exec(t);return e?e[2]:void 0}function c(t){return"-Z"===t.orientation&&"male"===t.style}m.readPin=v;var e=function(){function t(t){this.availablePowerPins={top:{fiveVolt:m.mkRange(26,51).map(function(t){return{type:"breadboard",row:"+",col:""+t}}),threeVolt:m.mkRange(26,51).map(function(t){return{type:"breadboard",row:"+",col:""+t}}),ground:m.mkRange(26,51).map(function(t){return{type:"breadboard",row:"-",col:""+t}})},bottom:{fiveVolt:m.mkRange(1,26).map(function(t){return{type:"breadboard",row:"+",col:""+t}}),threeVolt:m.mkRange(1,26).map(function(t){return{type:"breadboard",row:"+",col:""+t}}),ground:m.mkRange(1,26).map(function(t){return{type:"breadboard",row:"-",col:""+t}})}},this.opts=t}return t.prototype.allocPartIRs=function(i,u,g){var o=this,l=[],c=function(t,e,n,r){for(var i=[],o=0;o<t.numberOfPins;o++){var s=t.pinDefinitions[o],a=void 0;if("string"==typeof s.target)a=s.target;else{var u=s.target.pinInstantiationIdx;if(!n||void 0===n[u])return void console.log("error: parts no pin found for PinInstantiationIdx: "+u+'. (Is the part missing an ArgumentRole or "trackArgs=" annotations?)');a=n[u]}var l=t.visual.pinLocations[o],c=g.yOffset+l.y,p=Math.round(c/t.visual.pinDistance),d=c-p*t.visual.pinDistance,h=g.xOffset+l.x,f=Math.round(h/t.visual.pinDistance),m={partRelativeRowIdx:p,partRelativeColIdx:f,xOffset:h-f*t.visual.pinDistance,yOffset:d};i.push({def:s,loc:l,target:a,bbFit:m})}return{name:e,def:t,pins:i,partParams:r||{},bbFit:g}},t=i.instantiations||[];return i.instantiation&&t.push(i.instantiation),t.forEach(function(t){if("singleton"===t.kind)l.push(c(i,u));else if("function"===t.kind){var a=t,n=a.fullyQualifiedName.split(","),e={};n.forEach(function(t){o.opts.fnArgs[t]&&o.opts.fnArgs[t].forEach(function(t){e[t]=1})});var r=Object.keys(e);if(!r||!r.length)return void console.log("error: parts failed to read pin(s) from callsite for: "+n);r.forEach(function(t){var e=t.split(",");if(e.length==a.argumentRoles.length){var o=[],s={};e.forEach(function(t,e){var n=a.argumentRoles[e];if(void 0!==n.partParameter&&(s[n.partParameter]=t),void 0!==n.pinInstantiationIdx){var r=n.pinInstantiationIdx,i=v(t);o[r]=i}}),l.push(c(i,u,o,s))}else console.log("error: parts mismatch between number of arguments at callsite (function name: "+n+") vs number of argument roles in part definition (part: "+u+").")})}}),l.filter(function(t){return!!t})},t.prototype.computePartDimensions=function(t,e){var n=t.visual.pinLocations,o=t.pinDefinitions,r=t.numberOfPins;m.U.assert(n.length===r,'Mismatch between "numberOfPins" and length of "visual.pinLocations" for "'+e+'"'),m.U.assert(o.length===r,'Mismatch between "numberOfPins" and length of "pinDefinitions" for "'+e+'"'),m.U.assert(0<r,'Part "'+e+'" has no pins');var i,s,a,u,l=n.map(function(t,e){return n={idx:e},r=t,i=o[e],g(g(n,r),i);var n,r,i}).filter(function(t){return"-Z"===t.orientation}),c=0<l.length,p=t.visual.pinDistance;if(c){var d=l[0],h=Math.ceil(d.x/p),f=Math.ceil(d.y/p);i=h*p-d.x,s=f*p-d.y,a=Math.ceil((i+t.visual.width)/p)+1,u=Math.ceil((s+t.visual.height)/p)+1}else a=Math.ceil(t.visual.width/p),u=Math.ceil(t.visual.height/p),i=a*p-t.visual.width,s=u*p-t.visual.height;return{xOffset:i,yOffset:s,rowCount:u,colCount:a}},t.prototype.allocColumns=function(t){var e=t.length,n=m.visuals.BREADBOARD_MID_COLS-t.map(function(t){return t.colCount}).reduce(function(t,e){return t+e},0);n<=0&&console.log("Not enough breadboard space!");var r=Math.floor(n/(e-1+2)),i=n-r*(e-1),o=Math.floor(i/2),s=(Math.ceil(i/2),1+o);return t.map(function(t){var e=s;return s+=t.colCount+r,e})},t.prototype.placeParts=function(t){var r=m.visuals.BREADBOARD_MID_ROWS+2,i=this.allocColumns(t.map(function(t){return t.bbFit})),o=t.map(function(t){var e=r-t.bbFit.rowCount,n=Math.floor(e/2);return 4<n&&(n=4),n<1&&(n=1),n});return t.map(function(t,e){var n=o[e];return g({startColumnIdx:i[e],startRowIdx:n},t)})},t.prototype.nextColor=function(){return(!this.availableWireColors||this.availableWireColors.length<=0)&&(this.availableWireColors=m.visuals.GPIO_WIRE_COLORS.map(function(t){return t})),this.availableWireColors.pop()},t.prototype.allocWireIRs=function(a){var u=this,l=[],t=a.pins.map(function(t,e){var n,r=t.target,i=a.startColumnIdx+t.bbFit.partRelativeColIdx,o=m.visuals.getColumnName(i),s=a.startRowIdx+t.bbFit.partRelativeRowIdx;(7<=s&&(s-=2),c(t.def))?n={type:"breadboard",row:s<5?"j":"a",col:o,style:t.def.style}:n={type:"breadboard",row:m.visuals.getRowName(s),col:o,xOffset:t.bbFit.xOffset/a.def.visual.pinDistance,yOffset:t.bbFit.yOffset/a.def.visual.pinDistance,style:t.def.style};return{start:n,end:r,color:"ground"===r?p:"threeVolt"===r?d:"fiveVolt"===r?h:"number"==typeof t.def.colorGroup?l[t.def.colorGroup]?l[t.def.colorGroup]:l[t.def.colorGroup]=u.nextColor():u.nextColor(),pinIdx:e}});return g(a,{wires:t})},t.prototype.allocLocation=function(t,e){var n=this;if("ground"===t||"threeVolt"===t||"fiveVolt"==t){if("ground"===t&&this.powerUsage.singleGround)return{type:"dalboard",pin:this.getBoardGroundPin()};if("threeVolt"===t&&this.powerUsage.singleThreeVolt)return{type:"dalboard",pin:this.getBoardThreeVoltPin()};if("fiveVolt"===t&&this.powerUsage.singleFiveVolt)return{type:"dalboard",pin:this.getBoardFiveVoltPin()};m.U.assert(!!e.referenceBBPin);var r=this.opts.getBBCoord(e.referenceBBPin),i=[this.availablePowerPins.top.ground[0]||this.availablePowerPins.top.threeVolt[0],this.availablePowerPins.bottom.ground[0]||this.availablePowerPins.bottom.threeVolt[0]].map(function(t){return n.opts.getBBCoord(t)});i[0]&&i[1]||console.debug('No more available "'+t+'" locations!');var o=0==m.visuals.findClosestCoordIdx(r,i),s=void 0;o?"ground"===t?s=this.availablePowerPins.top.ground:"threeVolt"===t?s=this.availablePowerPins.top.threeVolt:"fiveVolt"===t&&(s=this.availablePowerPins.top.fiveVolt):"ground"===t?s=this.availablePowerPins.bottom.ground:"threeVolt"===t?s=this.availablePowerPins.bottom.threeVolt:"fiveVolt"===t&&(s=this.availablePowerPins.bottom.fiveVolt);var a=s.map(function(t){return n.opts.getBBCoord(t)}),u=m.visuals.findClosestCoordIdx(r,a),l=s[u];return o?(this.availablePowerPins.top.ground.splice(u,1),this.availablePowerPins.top.threeVolt.splice(u,1)):(this.availablePowerPins.bottom.ground.splice(u,1),this.availablePowerPins.bottom.threeVolt.splice(u,1)),l}if("breadboard"===t.type)return t;if("MOSI"===t||"MISO"===t||"SCK"===t)return this.opts.boardDef.spiPins||console.debug("No SPI pin mappings found!"),{type:"dalboard",pin:l=this.opts.boardDef.spiPins[t]};if("SDA"===t||"SCL"===t)return this.opts.boardDef.i2cPins||console.debug("No I2C pin mappings found!"),{type:"dalboard",pin:l=this.opts.boardDef.i2cPins[t]};m.U.assert("string"==typeof t,"Unknown location type: "+t);var c=t,p=this.opts.boardDef.gpioPinMap[c]||c;return p?{type:"dalboard",pin:p}:void console.debug("unknown pin location for "+c)},t.prototype.getBoardGroundPin=function(){var t=this.opts.boardDef.groundPins&&this.opts.boardDef.groundPins[0]||null;return t||console.debug("No available ground pin on board!"),t},t.prototype.getBoardThreeVoltPin=function(){var t=this.opts.boardDef.threeVoltPins&&this.opts.boardDef.threeVoltPins[0]||null;return t||console.debug("No available 3.3V pin on board!"),t},t.prototype.getBoardFiveVoltPin=function(){var t=this.opts.boardDef.fiveVoltPins&&this.opts.boardDef.fiveVoltPins[0]||null;return t||console.debug("No available 5V pin on board!"),t},t.prototype.allocPowerWires=function(t){var e,n,r=this.getBoardGroundPin(),i=this.getBoardThreeVoltPin(),o=this.getBoardFiveVoltPin();this.opts.boardDef.attachPowerOnRight?(e={type:"breadboard",row:"-",col:"50"},n={type:"breadboard",row:"-",col:"25"}):(e={type:"breadboard",row:"-",col:"26"},n={type:"breadboard",row:"-",col:"1"});var s=[],a=[],u=[];t.bottomGround&&t.topGround&&s.push({start:this.allocLocation("ground",{referenceBBPin:e}),end:this.allocLocation("ground",{referenceBBPin:n}),color:p}),t.topGround?s.push({start:this.allocLocation("ground",{referenceBBPin:e}),end:{type:"dalboard",pin:r},color:p}):t.bottomGround&&s.push({start:this.allocLocation("ground",{referenceBBPin:n}),end:{type:"dalboard",pin:r},color:p}),t.bottomThreeVolt&&t.bottomGround?a.push({start:this.allocLocation("threeVolt",{referenceBBPin:e}),end:this.allocLocation("threeVolt",{referenceBBPin:n}),color:d}):t.bottomFiveVolt&&t.bottomGround&&u.push({start:this.allocLocation("fiveVolt",{referenceBBPin:e}),end:this.allocLocation("fiveVolt",{referenceBBPin:n}),color:h}),t.topThreeVolt?a.push({start:this.allocLocation("threeVolt",{referenceBBPin:e}),end:{type:"dalboard",pin:i},color:d}):t.bottomThreeVolt&&a.push({start:this.allocLocation("threeVolt",{referenceBBPin:n}),end:{type:"dalboard",pin:i},color:h}),t.topFiveVolt&&!t.topThreeVolt?u.push({start:this.allocLocation("fiveVolt",{referenceBBPin:e}),end:{type:"dalboard",pin:o},color:d}):t.bottomFiveVolt&&!t.bottomThreeVolt&&u.push({start:this.allocLocation("fiveVolt",{referenceBBPin:n}),end:{type:"dalboard",pin:o},color:h});var l=[];0<s.length&&l.push({wireIndices:s.map(function(t,e){return e})});var c=s.length;return 0<a.length&&l.push({wireIndices:a.map(function(t,e){return e+c})}),0<u.length&&l.push({wireIndices:a.map(function(t,e){return e+c+a.length})}),{wires:s.concat(a).concat(u),assembly:l}},t.prototype.allocWire=function(t){var r=this,i=[t.start,t.end],n=i.map(function(t){return"ground"===t||"threeVolt"===t||"fiveVolt"===t}),o=i.map(function(t,e){return n[e]?void 0:r.allocLocation(t,{})});if((o=o.map(function(t,e){if(t)return t;var n=o[1-e];return r.allocLocation(i[e],{referenceBBPin:n})}))[0]&&o[1])return{start:o[0],end:o[1],color:t.color}},t.prototype.allocPart=function(i){var t=i.pins.filter(function(t){return c(t.def)}).map(function(t){var e=i.startRowIdx+t.bbFit.partRelativeRowIdx;7<=e&&(e-=2);var n=m.visuals.getRowName(e),r=i.startColumnIdx+t.bbFit.partRelativeColIdx;return{type:"breadboard",row:n,col:m.visuals.getColumnName(r)}});return{name:i.name,visual:i.def.visual,bbFit:i.bbFit,startColumnIdx:i.startColumnIdx,startRowIdx:i.startRowIdx,breadboardConnections:t,params:i.partParams,simulationBehavior:i.def.simulationBehavior}},t.prototype.allocAll=function(){var t,o=this,e=this.opts.partsList.map(function(t){return{name:t,def:o.opts.partDefs[t]}}).filter(function(t){return!!t.def});if(0<e.length){var i=e.map(function(t){return o.computePartDimensions(t.def,t.name)}),s=[];e.forEach(function(t,e){var n=i[e],r=o.allocPartIRs(t.def,t.name,n);s=s.concat(r)});var n=this.placeParts(s).map(function(t){return o.allocWireIRs(t)}),r=n.map(function(t){return t.wires}).reduce(function(t,e){return t.concat(e)},[]).map(function(t){return n=[(e=t).start,e.end],r=n.map(function(t){return"ground"===t}),i=n.map(function(t){return"threeVolt"===t}),o=n.map(function(t){return"fiveVolt"===t}),s=n.map(function(t){return function(t){var e=!1;if("string"!=typeof t&&"breadboard"===t.type){var n=t.row;e=0<=["a","b","c","d","e"].indexOf(n)}return e}(t)}),a=f(r),u=f(i),l=f(o),c=f(s),{topGround:a&&!c,topThreeVolt:u&&!c,topFiveVolt:l&&!c,bottomGround:a&&c,bottomThreeVolt:u&&c,bottomFiveVolt:l&&c,singleGround:a,singleThreeVolt:u,singleFiveVolt:l};var e,n,r,i,o,s,a,u,l,c});this.powerUsage=((t=r.reduce(function(t,e){return{topGround:t.topGround||e.topGround,topThreeVolt:t.topThreeVolt||e.topThreeVolt,topFiveVolt:t.topFiveVolt||e.topFiveVolt,bottomGround:t.bottomGround||e.bottomGround,bottomThreeVolt:t.bottomThreeVolt||e.bottomThreeVolt,bottomFiveVolt:t.bottomFiveVolt||e.bottomFiveVolt,singleGround:e.singleGround?null===t.singleGround:t.singleGround,singleThreeVolt:e.singleThreeVolt?null===t.singleThreeVolt:t.singleThreeVolt,singleFiveVolt:e.singleFiveVolt?null===t.singleFiveVolt:t.singleFiveVolt}},{topGround:!1,topThreeVolt:!1,topFiveVolt:!1,bottomGround:!1,bottomThreeVolt:!1,bottomFiveVolt:!1,singleGround:null,singleThreeVolt:null,singleFiveVolt:null})).singleGround&&(t.topGround=t.bottomGround=!1),t.singleThreeVolt&&(t.topThreeVolt=t.bottomThreeVolt=!1),t.singleFiveVolt&&(t.topFiveVolt=t.bottomFiveVolt=!1),t);var a=this.allocPowerWires(this.powerUsage),u=n.map(function(t,e){var n=o.allocPart(t),r=t.wires.map(function(t){return o.allocWire(t)});if(!r.some(function(t){return!t})){var i=[];return t.wires.forEach(function(t,e){i[t.pinIdx]=e}),{part:n,wires:r,assembly:t.def.assembly.map(function(t){return{part:t.part,wireIndices:(t.pinIndices||[]).map(function(t){return i[t]})}})}}}).filter(function(t){return!!t}),l=[a].concat(u).filter(function(t){return t.assembly&&t.assembly.length});return{partsAndWires:l,wires:[],parts:[],hideBreadboard:!l.some(function(t){return t.part&&t.part.breadboardConnections&&0<t.part.breadboardConnections.length||t.wires&&t.wires.some(function(t){return"breadboard"==t.end.type&&"croc"!=t.end.style||"breadboard"==t.start.type&&"croc"!=t.start.style})})}}return{partsAndWires:[],wires:[],parts:[]}},t}();m.allocateDefinitions=function(t){return new e(t).allocAll()}}(pxsim||(pxsim={})),function(t){!function(a){var t=function(t){this.seq=0,this.type=t},e=function(r){function t(t,e){var n=r.call(this,"response")||this;return n.request_seq=t.seq,n.command=t.command,e?(n.success=!1,n.message=e):n.success=!0,n}return __extends(t,r),t}(a.Message=t);a.Response=e;var n=function(r){function t(t,e){var n=r.call(this,"event")||this;return n.event=t,e&&(n.body=e),n}return __extends(t,r),t}(t);a.Event=n;var r=function(t,e,n,r,i){void 0===n&&(n=0),this.name=t,this.path=e,this.sourceReference=n,r&&(this.origin=r),i&&(this.adapterData=i)};a.Source=r;var i=function(t,e,n){void 0===n&&(n=!1),this.name=t,this.variablesReference=e,this.expensive=n};a.Scope=i;var o=function(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this.id=t,this.source=n,this.line=r,this.column=i,this.name=e};a.StackFrame=o;var s=function(t,e){this.id=t,this.name=e||"Thread #"+t};a.Thread=s;var u=function(t,e,n,r,i){void 0===n&&(n=0),this.name=t,this.value=e,this.variablesReference=n,"number"==typeof i&&(this.namedVariables=i),"number"==typeof r&&(this.indexedVariables=r)};a.Variable=u;var l=function(t,e,n,r){this.verified=t,"number"==typeof e&&(this.line=e),"number"==typeof n&&(this.column=n),r&&(this.source=r)};a.Breakpoint=l;var c=function(t,e){this.id=t,this.name=e};a.Module=c;var p=function(t,e,n){void 0===n&&(n=0),this.label=t,this.start=e,this.length=n};a.CompletionItem=p;var d=function(i){function t(t,e,n){void 0===n&&(n=null);var r=i.call(this,"stopped")||this;(r.body={reason:t,threadId:e},n)&&(r.body.text=n);return r}return __extends(t,i),t}(n);a.StoppedEvent=d;var h=function(r){function t(t,e){var n=r.call(this,"continued")||this;return n.body={threadId:t},"boolean"==typeof e&&(n.body.allThreadsContinued=e),n}return __extends(t,r),t}(n);a.ContinuedEvent=h;var f=function(t){function e(){return t.call(this,"initialized")||this}return __extends(e,t),e}(n);a.InitializedEvent=f;var m=function(n){function t(t){var e=n.call(this,"terminated")||this;"boolean"==typeof t&&(e.body={restart:t});return e}return __extends(t,n),t}(n);a.TerminatedEvent=m;var g=function(i){function t(t,e,n){void 0===e&&(e="console");var r=i.call(this,"output")||this;return r.body={category:e,output:t},void 0!==n&&(r.body.data=n),r}return __extends(t,i),t}(n);a.OutputEvent=g;var v=function(r){function t(t,e){var n=r.call(this,"thread")||this;return n.body={reason:t,threadId:e},n}return __extends(t,r),t}(n);a.ThreadEvent=v;var b=function(r){function t(t,e){var n=r.call(this,"breakpoint")||this;return n.body={reason:t,breakpoint:e},n}return __extends(t,r),t}(n);a.BreakpointEvent=b;var y=function(r){function t(t,e){var n=r.call(this,"module")||this;return n.body={reason:t,module:e},n}return __extends(t,r),t}(n);a.ModuleEvent=y;var w=function(){function t(){this._pendingRequests={}}return t.prototype.start=function(t){var r=this;this._sequence=1,this.host=t,this.host.onData(function(t){if("request"===t.type)r.dispatchRequest(t);else if("response"===t.type){var e=t,n=r._pendingRequests[e.seq];n&&(delete r._pendingRequests[e.seq],n(e))}})},t.prototype.stop=function(){this.host&&this.host.close()},t.prototype.sendEvent=function(t){this.send("event",t)},t.prototype.sendResponse=function(t){0<t.seq?console.error("attempt to send more than one response for command "+t.command):this.send("response",t)},t.prototype.sendRequest=function(t,e,n,r){var i=this,o={command:t};if(e&&0<Object.keys(e).length&&(o.arguments=e),this.send("request",o),r){this._pendingRequests[o.seq]=r;var s=setTimeout(function(){clearTimeout(s);var t=i._pendingRequests[o.seq];t&&(delete i._pendingRequests[o.seq],t(new a.Response(o,"timeout")))},n)}},t.prototype.send=function(t,e){if(e.type=t,e.seq=this._sequence++,this.host){var n=JSON.stringify(e);this.host.send(n)}},t.prototype.dispatchRequest=function(t){},t}(),x=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t._debuggerLinesStartAt1=!1,t._debuggerColumnsStartAt1=!1,t._clientLinesStartAt1=!0,t._clientColumnsStartAt1=!0,t}return __extends(o,e),o.prototype.shutdown=function(){},o.prototype.dispatchRequest=function(t){var e=new a.Response(t);try{if("initialize"===t.command){var n=t.arguments;if("boolean"==typeof n.linesStartAt1&&(this._clientLinesStartAt1=n.linesStartAt1),"boolean"==typeof n.columnsStartAt1&&(this._clientColumnsStartAt1=n.columnsStartAt1),"path"!==n.pathFormat)this.sendErrorResponse(e,2018,"debug adapter only supports native paths",null);else{var r=e;r.body={},this.initializeRequest(r,n)}}else"launch"===t.command?this.launchRequest(e,t.arguments):"attach"===t.command?this.attachRequest(e,t.arguments):"disconnect"===t.command?this.disconnectRequest(e,t.arguments):"setBreakpoints"===t.command?this.setBreakPointsRequest(e,t.arguments):"setFunctionBreakpoints"===t.command?this.setFunctionBreakPointsRequest(e,t.arguments):"setExceptionBreakpoints"===t.command?this.setExceptionBreakPointsRequest(e,t.arguments):"configurationDone"===t.command?this.configurationDoneRequest(e,t.arguments):"continue"===t.command?this.continueRequest(e,t.arguments):"next"===t.command?this.nextRequest(e,t.arguments):"stepIn"===t.command?this.stepInRequest(e,t.arguments):"stepOut"===t.command?this.stepOutRequest(e,t.arguments):"stepBack"===t.command?this.stepBackRequest(e,t.arguments):"restartFrame"===t.command?this.restartFrameRequest(e,t.arguments):"goto"===t.command?this.gotoRequest(e,t.arguments):"pause"===t.command?this.pauseRequest(e,t.arguments):"stackTrace"===t.command?this.stackTraceRequest(e,t.arguments):"scopes"===t.command?this.scopesRequest(e,t.arguments):"variables"===t.command?this.variablesRequest(e,t.arguments):"setVariable"===t.command?this.setVariableRequest(e,t.arguments):"source"===t.command?this.sourceRequest(e,t.arguments):"threads"===t.command?this.threadsRequest(e):"evaluate"===t.command?this.evaluateRequest(e,t.arguments):"stepInTargets"===t.command?this.stepInTargetsRequest(e,t.arguments):"gotoTargets"===t.command?this.gotoTargetsRequest(e,t.arguments):"completions"===t.command?this.completionsRequest(e,t.arguments):this.customRequest(t.command,e,t.arguments)}catch(t){this.sendErrorResponse(e,1104,"{_stack}",{_exception:t.message,_stack:t.stack})}},o.prototype.initializeRequest=function(t,e){t.body.supportsConditionalBreakpoints=!1,t.body.supportsHitConditionalBreakpoints=!1,t.body.supportsFunctionBreakpoints=!1,t.body.supportsConfigurationDoneRequest=!0,t.body.supportsEvaluateForHovers=!1,t.body.supportsStepBack=!1,t.body.supportsSetVariable=!1,t.body.supportsRestartFrame=!1,t.body.supportsStepInTargetsRequest=!1,t.body.supportsGotoTargetsRequest=!1,t.body.supportsCompletionsRequest=!1,this.sendResponse(t)},o.prototype.disconnectRequest=function(t,e){this.sendResponse(t),this.shutdown()},o.prototype.launchRequest=function(t,e){this.sendResponse(t)},o.prototype.attachRequest=function(t,e){this.sendResponse(t)},o.prototype.setBreakPointsRequest=function(t,e){this.sendResponse(t)},o.prototype.setFunctionBreakPointsRequest=function(t,e){this.sendResponse(t)},o.prototype.setExceptionBreakPointsRequest=function(t,e){this.sendResponse(t)},o.prototype.configurationDoneRequest=function(t,e){this.sendResponse(t)},o.prototype.continueRequest=function(t,e){this.sendResponse(t)},o.prototype.nextRequest=function(t,e){this.sendResponse(t)},o.prototype.stepInRequest=function(t,e){this.sendResponse(t)},o.prototype.stepOutRequest=function(t,e){this.sendResponse(t)},o.prototype.stepBackRequest=function(t,e){this.sendResponse(t)},o.prototype.restartFrameRequest=function(t,e){this.sendResponse(t)},o.prototype.gotoRequest=function(t,e){this.sendResponse(t)},o.prototype.pauseRequest=function(t,e){this.sendResponse(t)},o.prototype.sourceRequest=function(t,e){this.sendResponse(t)},o.prototype.threadsRequest=function(t){this.sendResponse(t)},o.prototype.stackTraceRequest=function(t,e){this.sendResponse(t)},o.prototype.scopesRequest=function(t,e){this.sendResponse(t)},o.prototype.variablesRequest=function(t,e){this.sendResponse(t)},o.prototype.setVariableRequest=function(t,e){this.sendResponse(t)},o.prototype.evaluateRequest=function(t,e){this.sendResponse(t)},o.prototype.stepInTargetsRequest=function(t,e){this.sendResponse(t)},o.prototype.gotoTargetsRequest=function(t,e){this.sendResponse(t)},o.prototype.completionsRequest=function(t,e){this.sendResponse(t)},o.prototype.customRequest=function(t,e,n){this.sendErrorResponse(e,1014,"unrecognized request",null)},o.prototype.sendErrorResponse=function(t,e,n,r){var i;"number"==typeof e?(i={id:e,format:n},r&&(i.variables=r),i.showUser=!0):i=e,t.success=!1,o.formatPII(i.format,!0,i.variables),t.body||(t.body={}),t.body.error=i,this.sendResponse(t)},o.prototype.convertClientLineToDebugger=function(t){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?t:t+1:this._clientLinesStartAt1?t-1:t},o.prototype.convertDebuggerLineToClient=function(t){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?t:t-1:this._clientLinesStartAt1?t+1:t},o.prototype.convertClientColumnToDebugger=function(t){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?t:t+1:this._clientColumnsStartAt1?t-1:t},o.prototype.convertDebuggerColumnToClient=function(t){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?t:t-1:this._clientColumnsStartAt1?t+1:t},o.prototype.convertClientPathToDebugger=function(t){return this._clientPathsAreURIs!=this._debuggerPathsAreURIs?this._clientPathsAreURIs?o.uri2path(t):o.path2uri(t):t},o.prototype.convertDebuggerPathToClient=function(t){return this._debuggerPathsAreURIs!=this._clientPathsAreURIs?this._debuggerPathsAreURIs?o.uri2path(t):o.path2uri(t):t},o.path2uri=function(t){var e=t.replace(/\\/g,"/");return"/"!==e[0]&&(e="/"+e),encodeURI("file://"+e)},o.uri2path=function(t){return t},o.formatPII=function(t,n,r){return t.replace(o._formatPIIRegexp,function(t,e){return n&&0<e.length&&"_"!==e[0]?t:r[e]&&r.hasOwnProperty(e)?r[e]:t})},o._formatPIIRegexp=/{([^}]+)}/g,o}(a.ProtocolServer=w);a.DebugSession=x}(t.protocol||(t.protocol={}))}(pxsim||(pxsim={})),function(t){!function(t){t.injectPolyphils=function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(t,e){return void 0!==t&&null!=t&&(e=!e||e<0?0:+e,this.substring(e,e+t.length)===t)}}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{writable:!0,enumerable:!0,value:function(t){if(null==this)throw new TypeError("this is null or not defined");for(var e=Object(this),n=e.length>>>0,r=arguments[1]>>0,i=r<0?Math.max(n+r,0):Math.min(r,n),o=arguments[2],s=void 0===o?n:o>>0,a=s<0?Math.max(n+s,0):Math.min(s,n);i<a;)e[i]=t,i++;return e}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{writable:!0,enumerable:!0,value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var r=arguments[1],i=0;i<n;){var o=e[i];if(t.call(r,o,i,e))return o;i++}}}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint16Array.prototype.slice||Object.defineProperty(Uint16Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint32Array.prototype.slice||Object.defineProperty(Uint32Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint8Array.prototype.fill||Object.defineProperty(Uint8Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint16Array.prototype.fill||Object.defineProperty(Uint16Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint32Array.prototype.fill||Object.defineProperty(Uint32Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint8Array.prototype.some||Object.defineProperty(Uint8Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint16Array.prototype.some||Object.defineProperty(Uint16Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint32Array.prototype.some||Object.defineProperty(Uint32Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint8Array.prototype.reverse||Object.defineProperty(Uint8Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Uint16Array.prototype.reverse||Object.defineProperty(Uint16Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Uint32Array.prototype.reverse||Object.defineProperty(Uint32Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Math.imul||(Math.imul=function(t,e){var n=65535&t,r=65535&e;return n*r+((t>>>16&65535)*r+n*(e>>>16&65535)<<16>>>0)|0}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},writable:!0,configurable:!0})};var e=function(){function t(t){this._func=t,this._evaluated=!1}return Object.defineProperty(t.prototype,"value",{get:function(){return this._evaluated||(this._value=this._func(),this._evaluated=!0),this._value},enumerable:!0,configurable:!0}),t}();function u(t){t=t.replace(/\\/g,"/");var e=[];return t.split("/").forEach(function(t){".."===t&&e.length?e.pop():t&&"."!==t&&e.push(t)}),e}t.Lazy=e,t.getNormalizedParts=u,t.normalizePath=function(t){return u(t).join("/")},t.relativePath=function(t,e){for(var n=u(t),r=u(e),i=0;n[i]===r[i]&&++i!==n.length&&i!==r.length;);for(var o=n.slice(i),s=r.slice(i),a=0;a<o.length;a++)s.unshift("..");return s.join("/")},t.pathJoin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";return t.forEach(function(t){t.replace(/\\/g,"/"),t.lastIndexOf("/")===t.length-1&&(t=t.slice(0,t.length-1)),n+="/"+t}),n},t.toArray=function(t){if(Array.isArray(t))return t;for(var e=[],n=0;n<t.length;++n)e.push(t[n]);return e}}(t.util||(t.util={}))}(pxsim||(pxsim={})),function(u){u.getWarningMessage=function(t){for(var e={type:"debugger",subtype:"warning",breakpointIds:[],message:t},n=u.runtime.currFrame;null!=n;)e.breakpointIds.push(n.lastBrkId),n=n.parent;return e};var t=function(){function t(t){var r=this;for(var e in this.fileMap={},this.idMap={},t.forEach(function(t){var e=t[0],n=t[1];r.fileMap[n.source.path]||(r.fileMap[n.source.path]=[]),r.fileMap[n.source.path].push(t),r.idMap[e]=n}),this.fileMap){var n=this.fileMap[e];this.fileMap[e]=n.sort(function(t,e){var n=t[1],r=e[1];return n.line===r.line?r.endLine===n.endLine?n.column-r.column:r.endLine-n.endLine:n.line-r.line})}}return t.prototype.getById=function(t){return this.idMap[t]},t.prototype.verifyBreakpoint=function(t,e){var n,r=this.fileMap[t];if(r)for(var i=0,o=r;i<o.length;i++){var s=o[i],a=s[0],u=s[1];u.line<=e.line&&u.endLine>=e.line&&(n=[a,u])}return n?(n[1].verified=!0,n):[-1,{verified:!1}]},t}();function d(t,e){switch(typeof t){case"string":case"number":case"boolean":return t;case"function":return{text:"(function)",type:"function"};case"undefined":return null;case"object":if(!t)return null;if(t instanceof u.RefObject){e&&(e[t.id]=t);var n=u.RefObject.toDebugString(t),r=n.startsWith("[")?"array":n;return{id:t.id,preview:n,hasFields:null!==t.fields||n.startsWith("["),type:r}}return t._width&&t._height?{text:t._width+"x"+t._height,type:"image"}:{text:"(object)",type:"object"};default:throw new Error}}function s(t,c,e,p){return function(t,e){for(var n={},r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];/^__/.test(o)||!/___\d+$/.test(o)||p&&-1===p.indexOf(o)||(n[o.replace(/___\d+$/,"")]=d(t[o],c))}if(t.fields&&e)for(var s=0,a=e;s<a.length;s++)o=(o=a[s]).substring(o.lastIndexOf(".")+1),n[o]=d(h(t.vtable.iface[o],t),c);if(t.fields)for(var u=0,l=Object.keys(t.fields).filter(function(t){return!t.startsWith("_")});u<l.length;u++)o=l[u],n[o.replace(/___\d+$/,"")]=d(t.fields[o],c);else Array.isArray(t.data)&&t.data.forEach(function(t,e){n[e]=d(t,c)});return n}(t,e)}function h(t,e){for(var n={pc:0,arg0:e,fn:t,parent:{}};n.fn;)n=n.fn(n);return n.retval}function a(n,r){var t=n.fn?n.fn.info:null;if(t){var e={thisParam:d(n.argL,r),params:[]};if(t.argumentNames){var i=t.argumentNames;e.params=i.map(function(t,e){return{name:t,value:d(n["arg"+e],r)}})}return{locals:s(n,r),funcInfo:t,breakpointId:n.lastBrkId,arguments:e}}}u.BreakpointMap=t,u.dumpHeap=s,u.getBreakpointMsg=function(t,e,n){for(var r={},i={type:"debugger",subtype:"breakpoint",breakpointId:e,globals:s(u.runtime.globals,r,void 0,n),stackframes:[]};null!=t;){var o=a(t,r);o&&i.stackframes.push(o),t=t.parent}return{msg:i,heap:r}};var e=function(r){function n(t){var e=r.call(this)||this,n={onDebuggerBreakpoint:function(t){return e.onDebuggerBreakpoint(t)},onDebuggerWarning:function(t){return e.onDebuggerWarning(t)},onDebuggerResume:function(){return e.onDebuggerResume()},onStateChanged:function(t){return e.onStateChanged(t)}};return e.driver=new u.SimulatorDriver(t,n),e}return __extends(n,r),n.prototype.runCode=function(t,e,n,r,i){this.breakpoints=r,this.projectDir&&this.fixBreakpoints(),this.sendEvent(new u.protocol.InitializedEvent),this.driver.run(t,{parts:e,fnArgs:n,boardDefinition:i})},n.prototype.stopSimulator=function(t){void 0===t&&(t=!1),this.driver.stop(t)},n.prototype.initializeRequest=function(t,e){t.body.supportsConditionalBreakpoints=!1,t.body.supportsHitConditionalBreakpoints=!1,t.body.supportsFunctionBreakpoints=!1,t.body.supportsEvaluateForHovers=!1,t.body.supportsStepBack=!1,t.body.supportsSetVariable=!1,t.body.supportsRestartFrame=!1,t.body.supportsStepInTargetsRequest=!1,t.body.supportsGotoTargetsRequest=!1,t.body.supportsCompletionsRequest=!1,t.body.supportsConfigurationDoneRequest=!0,this.sendResponse(t)},n.prototype.disconnectRequest=function(t,e){this.sendResponse(t),this.shutdown()},n.prototype.launchRequest=function(t,e){this.projectDir||(this.projectDir=u.util.normalizePath(e.projectDir),this.breakpoints&&this.fixBreakpoints()),this.sendResponse(t)},n.prototype.setBreakPointsRequest=function(i,o){var s=this;i.body={breakpoints:[]};var a=[];o.breakpoints.forEach(function(t){if(s.breakpoints){var e=s.breakpoints.verifyBreakpoint(u.util.relativePath(s.projectDir,o.source.path),t),n=e[0],r=e[1];i.body.breakpoints.push(r),r.verified&&a.push(n)}else i.body.breakpoints.push({verified:!1})}),this.driver.setBreakpoints(a),this.sendResponse(i)},n.prototype.continueRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.Resume),this.sendResponse(t)},n.prototype.nextRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.StepOver),this.sendResponse(t)},n.prototype.stepInRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.StepInto),this.sendResponse(t)},n.prototype.stepOutRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.StepOut),this.sendResponse(t)},n.prototype.pauseRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.Pause),this.sendResponse(t)},n.prototype.threadsRequest=function(t){t.body={threads:[{id:n.THREAD_ID,name:"main"}]},this.sendResponse(t)},n.prototype.stackTraceRequest=function(t,e){if(this.lastBreak){var n=this.state.getFrames();t.body={stackFrames:n}}this.sendResponse(t)},n.prototype.scopesRequest=function(t,e){this.state&&(t.body={scopes:this.state.getScopes(e.frameId)}),this.sendResponse(t)},n.prototype.variablesRequest=function(t,e){this.state&&(t.body={variables:this.state.getVariables(e.variablesReference)}),this.sendResponse(t)},n.prototype.onDebuggerBreakpoint=function(t){if(this.lastBreak=t,this.state=new i(this.lastBreak,this.breakpoints,this.projectDir),t.exceptionMessage){var e=t.exceptionMessage.replace(/___\d+/g,"");this.sendEvent(new u.protocol.StoppedEvent("exception",n.THREAD_ID,e))}else this.sendEvent(new u.protocol.StoppedEvent("breakpoint",n.THREAD_ID))},n.prototype.onDebuggerWarning=function(t){},n.prototype.onDebuggerResume=function(){this.sendEvent(new u.protocol.ContinuedEvent(n.THREAD_ID,!0))},n.prototype.onStateChanged=function(t){switch(t){case u.SimulatorState.Paused:break;case u.SimulatorState.Running:this.sendEvent(new u.protocol.ContinuedEvent(n.THREAD_ID,!0));break;case u.SimulatorState.Stopped:this.sendEvent(new u.protocol.TerminatedEvent)}},n.prototype.fixBreakpoints=function(){for(var t in this.breakpoints.idMap){var e=this.breakpoints.idMap[t];e.source.path=u.util.pathJoin(this.projectDir,e.source.path),e.line=this.convertDebuggerLineToClient(e.line),e.endLine=this.convertDebuggerLineToClient(e.endLine),e.column=this.convertDebuggerColumnToClient(e.column),e.endColumn=this.convertDebuggerColumnToClient(e.endColumn)}},n.THREAD_ID=1,n}(u.protocol.DebugSession);u.SimDebugSession=e;var i=function(){function t(t,e,n){this._message=t,this._map=e,this._dir=n,this._currentId=1,this._frames={},this._vars={};var r=this.nextId();this._vars[r]=this.getVariableValues(this._message.globals),this._globalScope={name:"Globals",variablesReference:r,expensive:!1}}return t.prototype.getFrames=function(){var r=this;return this._message.stackframes.map(function(t,e){var n=r._map.getById(t.breakpointId);if(n)return{id:(r._frames[t.breakpointId]=t).breakpointId,name:t.funcInfo?t.funcInfo.functionName:0===e?"main":"anonymous",line:n.line,column:n.column,endLine:n.endLine,endColumn:n.endLine,source:n.source}}).filter(function(t){return!!t})},t.prototype.getScopes=function(t){var e=this._frames[t];if(e){var n=this.nextId();return this._vars[n]=this.getVariableValues(e.locals),[{name:"Locals",variablesReference:n,expensive:!1},this._globalScope]}return[this._globalScope]},t.prototype.getVariables=function(t){var e=this._vars[t];return e&&e.value||[]},t.prototype.getVariableValues=function(s){var a=this;return new u.util.Lazy(function(){var t=[];for(var e in s){var n=s[e],r=void 0,i=0;null===n?r="null":void 0===n?r="undefined":"object"==typeof n?(r="(object)",i=a.nextId(),a._vars[i]=a.getVariableValues(n)):r=n.toString();var o=e.substr(0,e.lastIndexOf("___"));t.push({name:o,value:r,variablesReference:i})}return t})},t.prototype.nextId=function(){return this._currentId++},t}()}(pxsim||(pxsim={})),function(u){function l(t){function e(){try{window.print()}catch(t){}}void 0===t&&(t=0),t?setTimeout(e,t):e()}function c(t,e){r({type:"pxtsim",action:"event",tick:t,data:e})}function r(t){"undefined"!=typeof window&&window.parent&&window.parent!==window&&window.parent.postMessage(t,"*")}function n(){setInterval(function(){u.Runtime.postMessage({type:"simulator",command:"reload"})},3e3)}u.print=l,function(t){function e(t){t.origin;var e=t.data||{},n=e.type;if(n)switch(n){case"run":s(e);break;case"instructions":u.instructions.renderInstructions(e);break;case"stop":o();break;case"mute":a(e.mute);break;case"stopsound":u.AudioContextManager.stopAll();break;case"print":l();break;case"recorder":!function(t){if(!i)return;switch(t.action){case"start":i.startRecording(t.width);break;case"stop":i.stopRecording()}}(e);break;case"screenshot":u.Runtime.postScreenshotAsync(e).done();break;case"custom":u.handleCustomMessage&&u.handleCustomMessage(e);break;case"pxteditor":break;case"debugger":i&&i.handleDebuggerMsg(e);break;case"simulator":var r=e;switch(r.command){case"focus":c("simulator.focus",{timestamp:r.timestamp});break;case"blur":c("simulator.blur",{timestamp:r.timestamp})}default:!function(t){if(!i||i.dead)return;i.board.receiveMessage(t)}(e)}}var i;function o(){i&&(i.kill(),i.board&&i.board.kill())}function s(t){o(),t.mute&&a(t.mute),t.localizedStrings&&u.localization.setLocalizedStrings(t.localizedStrings),(i=new u.Runtime(t)).board.initAsync(t).done(function(){i.run(function(t){u.dumpLivePointers(),u.Runtime.postMessage({type:"toplevelcodefinished"})})})}function a(t){u.AudioContextManager.mute(t)}t.start=function(){window.addEventListener("message",e,!1),t.frameid=window.location.hash.slice(1),"undefined"!=typeof window&&window.applicationCache&&(window.applicationCache.status===window.applicationCache.UPDATEREADY&&n(),window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status===window.applicationCache.UPDATEREADY&&n()})),u.Runtime.postMessage({type:"ready",frameid:t.frameid})},t.stop=o,t.run=s}(u.Embed||(u.Embed={})),u.tickEvent=c,u.reportError=function(t,e,n){r({type:"pxtsim",action:"event",tick:"error",category:t,message:e,data:n})},u.reload=n}(pxsim||(pxsim={})),pxsim.util.injectPolyphils(),"undefined"!=typeof window&&window.addEventListener("load",function(t){pxsim.Embed.start()}),function(O){!function(t){var l=10,r=30,s=function(t){return t+"x"},a=20,T=3,F=5,M=5,c=40,p=50,d=1.5,e=[816*.95,1056*.95],n=[1,1],i=n[0],o=n[1],u=(e[0]-86.4)/o-48*o,h=465,f=400,L=1.7,m=.17,g=.25,v=.3,b=.23,y="\n            .instr-panel {\n                margin: 20px;\n                padding: 24px;\n                border-width: 4px;\n                border-color: gray;\n                border-style: solid;\n                border-radius: 20px;\n                display: inline-block;\n                width: "+u+"px;\n                height: "+((e[1]-86.4)/i-48*i)+"px;\n                position: relative;\n                overflow: hidden;\n                page-break-inside: avoid;\n            }\n            .board-svg {\n                margin: 0 auto;\n                display: block;\n                position: absolute;\n                bottom: 24px;\n                left: "+((u-h)/2+24)+"px;\n            }\n            .panel-num-outer {\n                position: absolute;\n                left: "+-4+"px;\n                top: "+-4+"px;\n                width: 120px;\n                height: 120px;\n                border-width: 4px;\n                border-style: solid;\n                border-color: gray;\n                border-radius: 20px 0 20px 0;\n            }\n            .panel-num {\n                margin: 10px 0;\n                text-align: center;\n                font-size: 80px;\n            }\n            .cmp-div {\n                display: inline-block;\n            }\n            .reqs-div {\n                margin-left: 144px;\n                margin-top: 5px;\n            }\n            .partslist-wire,\n            .partslist-cmp {\n                margin: 10px;\n            }\n            .partslist-wire {\n                display: inline-block;\n            }\n            ";function w(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r={l:0,t:0,w:0,h:0},i=document.createElementNS("http://www.w3.org/2000/svg","svg");n.appendChild(i),i.appendChild(t.el);var o={viewBox:t.x+" "+t.y+" "+t.w+" "+t.h,preserveAspectRatio:"xMidYMid"};r.w=t.w,r.h=t.h;var s=function(t){r.h*=t,r.w*=t,o.width=r.w,o.height=r.h};e.cmpScale&&s(e.cmpScale),e.cmpWidth&&e.cmpWidth<r.w?s(e.cmpWidth/r.w):e.cmpHeight&&e.cmpHeight<r.h&&s(e.cmpHeight/r.h),O.svg.hydrate(i,o);var a=r.l,u=r.t,l=r.w,c=r.h,p=function(t){if(t<r.l){var e=r.l-t;r.l=t,r.w+=e}},d=function(t){var e=r.l+r.w;if(e<t){var n=t-e;r.w+=n}},h=function(t){if(t<r.t){var e=r.t-t;r.t=t,r.h+=e}},f=function(t){var e=r.t+r.h;if(e<t){var n=t-e;r.h+=n}},m=[-.3,.3],g=m[0],v=m[1],b=[1.4,1];if(e&&e.top){var y=(P=e.topSize)/b[0],w=[a+l/2,u-T-(_=P/b[1])/2],x=w[0],C=w[1],R=O.visuals.mkTxt(x,C,P,0,e.top,g,v);O.U.addClass(R,"cmp-lbl"),n.appendChild(R);var k=y*e.top.length;h(C-_/2),p(x-k/2),d(x+k/2)}if(e&&e.bot){y=(P=e.botSize)/b[0];var S=[a+l/2,u+c+T+(_=P/b[1])/2];x=S[0],C=S[1],R=O.visuals.mkTxt(x,C,P,0,e.bot,g,v);O.U.addClass(R,"cmp-lbl"),n.appendChild(R);k=y*e.bot.length;f(C+_/2),p(x-k/2),d(x+k/2)}if(e&&e.right){var _=(P=e.rightSize)/b[1],I=(k=(y=P/b[0])*e.right.length,[a+l+F+k/2,u+c/2]),E=(x=I[0],I[1]);R=O.visuals.mkTxt(x,E,P,0,e.right,g,v);O.U.addClass(R,"cmp-lbl"),n.appendChild(R),h(E-_/2),d(x+k/2),f(E+_/2)}if(e&&e.left){_=(P=e.leftSize)/b[1],k=(y=P/b[0])*e.left.length;var P,B=[a-M-k/2,u+c/2];x=B[0],E=B[1],R=O.visuals.mkTxt(x,E,P,0,e.left,g,v);O.U.addClass(R,"cmp-lbl"),n.appendChild(R),h(E-_/2),p(x-k/2),f(E+_/2)}var D={viewBox:r.l+" "+r.t+" "+r.w+" "+r.h,width:r.w*L,height:r.h*L,preserveAspectRatio:"xMidYMid"};O.svg.hydrate(n,D);var A=document.createElement("div");return A.appendChild(n),A}function x(t,e){var n,r=O.runtime.board;if("wire"==t)n=O.visuals.mkWirePart([0,0],e.wireClr||"red",e.crocClips);else{var i=t;if("string"==typeof i.builtIn)n=(0,r.builtinPartVisuals[i.builtIn])([0,0]);else n=O.visuals.mkGenericPartSVG(i)}return w(n,e)}function C(t,e,n){void 0===n&&(n=!1);var r={state:O.runtime.board,boardDef:t.boardDef,forceBreadboardLayout:!0,forceBreadboardRender:t.allAlloc.requiresBreadboard,partDefs:t.cmpDefs,maxWidth:e+"px",fnArgs:t.fnArgs,wireframe:n,partsList:[]},i=new O.visuals.BoardHost(O.visuals.mkBoardView({visual:r.boardDef.visual,boardDef:r.boardDef,wireframe:r.wireframe}),r),o=i.getView();return O.U.addClass(o,"board-svg"),i}function R(){var t=document.createElement("div");return O.U.addClass(t,"instr-panel"),t}function k(i){var t,o=R(),e=w((t=i.boardDef,O.visuals.mkBoardView({visual:t.visual,boardDef:t}).getView()),{left:s(1),leftSize:r,cmpScale:m});o.appendChild(e);var n=w(new O.visuals.Breadboard({}).getSVGAndSize(),{left:s(1),leftSize:r,cmpScale:g});return o.appendChild(n),i.allCmps.forEach(function(t){var e=1;"buttonpair"===t.visual.builtIn&&(e=2);var n=x(t.visual,{left:s(e),leftSize:r,cmpScale:v});O.U.addClass(n,"partslist-cmp"),o.appendChild(n)}),i.allWireColors.forEach(function(t){var e=i.colorToWires[t].length,n=i.boardDef.pinStyles[t]||"female",r=x("wire",{left:s(e),leftSize:a,wireClr:t,cmpScale:b,crocClips:"croc"==n});O.U.addClass(r,"partslist-wire"),o.appendChild(r)}),o}function S(t,r){var e=R(),n=C(r,h,!0);!function(r,i,o){var t=r.getView();0<i&&O.U.addClass(t,"grayed");for(var e=function(n){var t=o.stepToCmps[n];t&&t.forEach(function(t){var e=r.addPart(t);n===i&&(t.breadboardConnections.forEach(function(t){return r.highlightBreadboardPin(t)}),O.U.addClass(e.element,"notgrayed"))});var e=o.stepToWires[n];e&&e.forEach(function(t){var e=r.addWire(t);e&&n===i&&("breadboard"==t.start.type?r.highlightBreadboardPin(t.start):r.highlightBoardPin(t.start.pin),"breadboard"==t.end.type?r.highlightBreadboardPin(t.end):r.highlightBoardPin(t.end.pin),r.highlightWire(e))})},n=0;n<=i;n++)e(n)}(n,t,r),e.appendChild(n.getView());var i=document.createElement("div");O.U.addClass(i,"panel-num-outer"),O.U.addClass(i,"noselect"),e.appendChild(i);var o=document.createElement("div");O.U.addClass(o,"panel-num"),o.textContent=t+1+"",i.appendChild(o);var s=document.createElement("div");O.U.addClass(s,"reqs-div"),e.appendChild(s);var a=r.stepToWires[t]||[],u=function(t){if("breadboard"===t.type){var e=t;return"("+e.row+","+e.col+")"}return t.pin};return a.forEach(function(t){var e=!1;"dalboard"==t.end.type&&(e="croc"==r.boardDef.pinStyles[t.end.pin]);var n=x("wire",{top:u(t.end),topSize:l,bot:u(t.start),botSize:l,wireClr:t.color,cmpHeight:c,crocClips:e});O.U.addClass(n,"cmp-div"),s.appendChild(n)}),(r.stepToCmps[t]||[]).forEach(function(o){("buttonpair"===o.visual.builtIn?[o.breadboardConnections[0],o.breadboardConnections[2]]:[o.breadboardConnections[0]]).forEach(function(t,e){var n;t?n="("+t.row+","+t.col+")":n="";var r=d;"buttonpair"===o.visual.builtIn&&(r*=.5);var i=x(o.visual,{top:n,topSize:l,cmpHeight:p,cmpScale:r});O.U.addClass(i,"cmp-div"),s.appendChild(i)})}),e}function _(t,e){e.boardDef.pinStyles||(e.boardDef.pinStyles={}),e.configData&&O.setConfigData(e.configData.cfg,e.configData.cfgKey);var n={type:"run",code:"",boardDefinition:e.boardDef,partDefinitions:e.partDefinitions};O.runtime=new O.Runtime(n),O.runtime.board=null,O.initCurrentRuntime(n);var r=document.createElement("style");r.textContent+=y,document.head.appendChild(r);var i,o,s,a=e.partDefinitions,u=new O.visuals.Breadboard({}),l=function(t){var e=O.allocateDefinitions(t),i=[],o=[],s=1;e.partsAndWires.forEach(function(t){var n=t.part,r=t.wires;t.assembly.forEach(function(t,e){t.part&&n&&(o[s+e]=[n]),t.wireIndices&&0<t.wireIndices.length&&r&&(i[s+e]=t.wireIndices.map(function(t){return r[t]}))}),s+=t.assembly.length});var n=s-1,r=e.partsAndWires.map(function(t){return t.part}).filter(function(t){return!!t}),a=e.partsAndWires.map(function(t){return t.wires||[]}).reduce(function(t,e){return t.concat(e)},[]),u={},l=[];return a.forEach(function(t){u[t.color]||(u[t.color]=[],l.push(t.color)),u[t.color].push(t)}),{boardDef:t.boardDef,cmpDefs:t.partDefs,fnArgs:t.fnArgs,allAlloc:e,stepToWires:i,stepToCmps:o,allWires:a,allCmps:r,lastStep:n,colorToWires:u,allWireColors:l}}({boardDef:e.boardDef,partDefs:a,partsList:e.parts,fnArgs:e.fnArgs,getBBCoord:u.getCoord.bind(u)}),c=(i=l,o=document.getElementById("front-panel"),(s=C(i,f,!1)).addAll(i.allAlloc),o.appendChild(s.getView()),k(l));t.appendChild(c);for(var p=0;p<=l.lastStep;p++){var d=S(p,l);t.appendChild(d)}e.print&&O.print(2e3)}t.renderParts=_,t.renderInstructions=function(t){document.getElementById("proj-title").innerText=t.options.name||"",_(document.body,t.options)}}(O.instructions||(O.instructions={}))}(pxsim||(pxsim={})),function(o){function s(t,e){if(void 0===e&&(e="sim: check failed"),!t)throw new Error(e)}o.quiet=!1,o.check=s,o.title="";var n={},r={};o.getConfig=function(t){return r.hasOwnProperty(t+"")?r[t+""]:null},o.getConfigKey=function(t){return n.hasOwnProperty(t)?n[t]:null},o.getAllConfigKeys=function(){return Object.keys(n)},o.setConfigKey=function(t,e){n[t]=e},o.setConfig=function(t,e){r[t]=e},o.setConfigData=function(t,e){r=t,n=e},o.getConfigData=function(){return{cfg:r,cfgKey:n}},o.setTitle=function(t){o.title=t};var i=function(){function t(){o.runtime?this.id=o.runtime.registerLiveObject(this):this.id=0}return t.prototype.destroy=function(){},t.prototype.scan=function(t){throw o.U.userError("scan not implemented")},t.prototype.gcKey=function(){throw o.U.userError("gcKey not implemented")},t.prototype.gcSize=function(){throw o.U.userError("gcSize not implemented")},t.prototype.gcIsStatic=function(){return!1},t.prototype.print=function(){o.runtime&&o.runtime.refCountingDebug&&console.log("RefObject id:"+this.id)},t.prototype.toDebugString=function(){return"(object)"},t.toAny=function(t){return t&&t.toAny?t.toAny():t},t.toDebugString=function(t){return null===t?"null":void 0===t?"undefined;":t.vtable&&t.vtable.name?t.vtable.name:t.toDebugString?t.toDebugString():"string"==typeof t?JSON.stringify(t):t.toString()},t}();o.RefObject=i;var a=function(t,e,n){this.func=t,this.caps=e,this.args=n};o.FnWrapper=a;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields={},t}return __extends(t,e),t.prototype.scan=function(t){for(var e=0,n=Object.keys(this.fields);e<n.length;e++){var r=n[e];t(r,this.fields[r])}},t.prototype.gcKey=function(){return this.vtable.name},t.prototype.gcSize=function(){return this.vtable.numFields+1},t.prototype.destroy=function(){this.fields=null,this.vtable=null},t.prototype.print=function(){o.runtime&&o.runtime.refCountingDebug&&console.log("RefRecord id:"+this.id+" ("+this.vtable.name+")")},t}(i);o.RefRecord=u;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=[],t}return __extends(t,e),t.prototype.scan=function(t){for(var e=0;e<this.fields.length;++e)t("_cap"+e,this.fields[e])},t.prototype.gcKey=function(){return o.functionName(this.func)},t.prototype.gcSize=function(){return this.fields.length+3},t.prototype.isRef=function(t){return s(0<=t&&t<this.fields.length),t<this.len},t.prototype.ldclo=function(t){return s(0<=(t>>=2)&&t<this.fields.length),this.fields[t]},t.prototype.destroy=function(){this.fields=null,this.func=null},t.prototype.print=function(){o.runtime&&o.runtime.refCountingDebug&&console.log("RefAction id:"+this.id+" len:"+this.fields.length)},t}(i);o.RefAction=l,function(t){t.seedAddRandom=function(t){},t.mkAction=function(t,e){var n=new l;n.len=t,n.func=e;for(var r=0;r<t;++r)n.fields.push(null);return n},t.runAction=function(t,e){var n=o.getResume();n(t instanceof l?new a(t.func,t.fields,e):new a(t,null,e))};var v={};t.dumpPerfCounters=function(){if(o.runtime&&o.runtime.perfCounters){for(var t="calls,us,name\n",e=0,n=o.runtime.perfCounters;e<n.length;e++){var r=n[e];r.lastFew.sort();var i=r.lastFew[r.lastFew.length>>1];t+=r.numstops+","+r.value+","+r.name+","+i+"\n"}!function(t){for(var e,n,r="",i=function(t,e){r+=t.length>=e?t:("              "+t).slice(-e)},o=function(t){return i(""+Math.round(t),6)},s=function(t,e){i(Math.round(e)+"",8),r+=" /",o(t),r+=" =",o(e/t)},a=0,u=t.split(/\n/);a<u.length;a++){var l=u[a];if(l&&/^\d/.test(l)){var c=l.split(/,/),p=v[c[2]];p||(v[c[2]]=p={stops:0,us:0,meds:[]}),e=c[2],n=25,r+=e.length>=n?e:(e+"                         ").slice(0,n);var d=parseInt(c[0]),h=parseInt(c[1]);s(d,h),r+=" |",s(d-p.stops,h-p.us),r+=" ~";var f=parseInt(c[3]);o(f),10<p.meds.length&&p.meds.shift(),p.meds.push(f);var m=p.meds.slice();m.sort(function(t,e){return t-e});var g=m[m.length>>1];r+=" ~~",o(g),p.stops=d,p.us=h,r+="\n"}}console.log(r)}(t)}}}(o.pxtcore||(o.pxtcore={}));var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.v=null,t}return __extends(t,e),t.prototype.scan=function(t){t("*",this.v)},t.prototype.gcKey=function(){return"LOC"},t.prototype.gcSize=function(){return 2},t.prototype.destroy=function(){},t.prototype.print=function(){o.runtime&&o.runtime.refCountingDebug&&console.log("RefRefLocal id:"+this.id+" v:"+this.v)},t}(i);o.RefRefLocal=t;var e,c,p,d,h,f,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vtable=o.mkMapVTable(),t.data=[],t}return __extends(t,e),t.prototype.scan=function(t){for(var e=0,n=this.data;e<n.length;e++){var r=n[e];t(r.key,r.val)}},t.prototype.gcKey=function(){return"{...}"},t.prototype.gcSize=function(){return 2*this.data.length+4},t.prototype.findIdx=function(t){for(var e=0;e<this.data.length;++e)if(this.data[e].key==t)return e;return-1},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.data.length;++t)this.data[t].val=0;this.data=[]},t.prototype.print=function(){o.runtime&&o.runtime.refCountingDebug&&console.log("RefMap id:"+this.id+" size:"+this.data.length)},t.prototype.toAny=function(){var e={};return this.data.forEach(function(t){e[t.key]=i.toAny(t.val)}),e},t}(i);function g(){o.runtime&&o.runtime.dumpLivePointers()}o.RefMap=m,o.dumpLivePointers=g,(e=o.numops||(o.numops={})).toString=function(t){return null===t?"null":void 0===t?"undefined":t.toString()},e.toBoolDecr=function(t){return!!t},e.toBool=function(t){return!!t},(c=o.langsupp||(o.langsupp={})).toInt=function(t){return 0|t},c.toFloat=function(t){return t},c.ignore=function(t){return t},(p=o.pxtcore||(o.pxtcore={})).ptrOfLiteral=function(t){return t},p.debugMemLeaks=function(){g()},p.templateHash=function(){return 0},p.programHash=function(){return 0},p.programName=function(){return o.title},p.programSize=function(){return 0},p.afterProgramPage=function(){return 0},p.getConfig=function(t,e){var n=o.getConfig(t);return null==n?e:n},p.toInt=function(t){return t>>0},p.toUInt=function(t){return t>>>0},p.toDouble=function(t){return t},p.toFloat=function(t){return t},p.fromInt=function(t){return t},p.fromUInt=function(t){return t},p.fromDouble=function(t){return t},p.fromFloat=function(t){return t},p.fromBool=function(t){return!!t},function(r){function n(t,e){if(e+="",t instanceof u)return t.fields[e];var n=t.findIdx(e);return n<0?void 0:t.data[n].val}function i(t,e,n){if(e+="",t instanceof u){t.fields[e]=n}else{var r=t.findIdx(e);r<0?t.data.push({key:e,val:n}):t.data[r].val=n}}r.toInt8=function(t){return(255&t)<<24>>24},r.toInt16=function(t){return(65535&t)<<16>>16},r.toInt32=function(t){return 0|t},r.toUInt32=function(t){return t>>>0},r.toUInt8=function(t){return 255&t},r.toUInt16=function(t){return 65535&t},r.nullFix=function(t){return null==t||!1===t?0:!0===t?1:t},r.nullCheck=function(t){null==t&&o.U.userError("Dereferencing null/undefined value.")},r.panic=function(t){o.U.userError("PANIC! Code "+t)},r.stringToBool=function(t){return t?1:0},r.ptrToBool=function(t){return t?1:0},r.emptyToNull=function(t){return""==t?0:t},r.ldlocRef=function(t){return t.v},r.stlocRef=function(t,e){t.v=e},r.mklocRef=function(){return new t},r.stclo=function(t,e,n){return s(0<=e&&e<t.fields.length),s(null===t.fields[e]),t.fields[e]=n,t},r.runtimeWarning=function(t){o.Runtime.postMessage(o.getWarningMessage(t))},r.mkMap=function(){return new m},r.mapGet=function(t,e){return n(t,r.mapKeyNames[e])},r.mapSet=function(t,e,n){return i(t,r.mapKeyNames[e],n)},r.mapGetByString=n,r.mapDeleteByString=function(t,e){t instanceof m||r.panic(923);var n=t.findIdx(e);return 0<=n&&t.data.splice(n,1),!0},r.mapSetGeneric=i,r.mapGetGeneric=n,r.mapSetByString=i,r.keysOf=function(t){var e=new o.RefCollection;if(t instanceof m)for(var n=0,r=t.data;n<r.length;n++){var i=r[n];e.push(i.key)}return e}}(d=o.pxtrt||(o.pxtrt={})),(h=o.pxtcore||(o.pxtcore={})).mkClassInstance=function(t){s(!!t.methods);var e=new u;return e.vtable=t,e},h.switch_eq=function(t,e){return t==e},h.typeOf=function(t){return typeof t},(f=o.thread||(o.thread={})).panic=d.panic,f.pause=function(t){var e=o.getResume();o.runtime.schedule(function(){e()},t)},f.runInBackground=function(t){o.runtime.runFiberAsync(t).done()},f.forever=function(e){d.nullCheck(e),function t(){o.runtime.runFiberAsync(e).then(function(){return Promise.delay(20)}).then(t).done()}()}}(pxsim||(pxsim={})),function(p){var r,t,e,n,i,o=function(e){function t(){var t=e.call(this)||this;return t.data=[],t}return __extends(t,e),t.prototype.scan=function(t){for(var e=0;e<this.data.length;++e)t("["+e+"]",this.data[e])},t.prototype.gcKey=function(){return"[...]"},t.prototype.gcSize=function(){return this.data.length+2},t.prototype.toArray=function(){return this.data.slice(0)},t.prototype.toAny=function(){return this.data.map(function(t){return p.RefObject.toAny(t)})},t.prototype.toDebugString=function(){for(var t="[",e=0;e<this.data.length;++e){0<e&&(t+=",");var n=p.RefObject.toDebugString(this.data[e]);if(100<t.length+n.length){0==e&&(t+=n.substr(0,100)),t+="...";break}t+=n}return t+="]"},t.prototype.destroy=function(){for(var t=this.data,e=0;e<t.length;++e)t[e]=0;this.data=[]},t.prototype.isValidIndex=function(t){return 0<=t&&t<this.data.length},t.prototype.push=function(t){this.data.push(t)},t.prototype.pop=function(){return this.data.pop()},t.prototype.getLength=function(){return this.data.length},t.prototype.setLength=function(t){this.data.length=t},t.prototype.getAt=function(t){return this.data[t]},t.prototype.setAt=function(t,e){this.data[t]=e},t.prototype.insertAt=function(t,e){this.data.splice(t,0,e)},t.prototype.removeAt=function(t){return this.data.splice(t,1)[0]},t.prototype.indexOf=function(t,e){return this.data.indexOf(t,e)},t.prototype.print=function(){},t}(p.RefObject);p.RefCollection=o,function(t){function r(t,e){if(p.pxtrt.nullCheck(t),t.isValidIndex(e))return t.removeAt(e)}function i(t,e,n){return p.pxtrt.nullCheck(t),t.indexOf(e,n)}t.mk=function(){return new o},t.isArray=function(t){return t instanceof o},t.length=function(t){return p.pxtrt.nullCheck(t),t.getLength()},t.setLength=function(t,e){p.pxtrt.nullCheck(t),t.setLength(e)},t.push=function(t,e){p.pxtrt.nullCheck(t),t.push(e)},t.pop=function(t,e){return p.pxtrt.nullCheck(t),t.pop()},t.getAt=function(t,e){return p.pxtrt.nullCheck(t),t.getAt(e)},t.removeAt=r,t.insertAt=function(t,e,n){p.pxtrt.nullCheck(t),t.insertAt(e,n)},t.setAt=function(t,e,n){p.pxtrt.nullCheck(t),t.setAt(e,n)},t.indexOf=i,t.removeElement=function(t,e){p.pxtrt.nullCheck(t);var n=i(t,e,0);return 0<=n?(r(t,n),1):0}}(p.Array_||(p.Array_={})),(t=r=p.Math_||(p.Math_={})).imul=Math.imul||function(t,e){var n=65535&t,r=65535&e;return n*r+((t>>>16&65535)*r+n*(e>>>16&65535)<<16>>>0)|0},t.idiv=function(t,e){return(0|t)/(0|e)|0},t.round=function(t){return Math.round(t)},t.roundWithPrecision=function(t,e){if((e|=0)<=0)return Math.round(t);if(0==t)return 0;for(var n=0;0==n&&e<21;){var r=Math.pow(10,e++);n=Math.round(t*r+Number.EPSILON)/r}return n},t.ceil=function(t){return Math.ceil(t)},t.floor=function(t){return Math.floor(t)},t.sqrt=function(t){return Math.sqrt(t)},t.pow=function(t,e){return Math.pow(t,e)},t.clz32=function(t){return Math.clz32(t)},t.log=function(t){return Math.log(t)},t.log10=function(t){return Math.log10(t)},t.log2=function(t){return Math.log2(t)},t.exp=function(t){return Math.exp(t)},t.sin=function(t){return Math.sin(t)},t.sinh=function(t){return Math.sinh(t)},t.cos=function(t){return Math.cos(t)},t.cosh=function(t){return Math.cosh(t)},t.tan=function(t){return Math.tan(t)},t.tanh=function(t){return Math.tanh(t)},t.asin=function(t){return Math.asin(t)},t.asinh=function(t){return Math.asinh(t)},t.acos=function(t){return Math.acos(t)},t.acosh=function(t){return Math.acosh(t)},t.atan=function(t){return Math.atan(t)},t.atanh=function(t){return Math.atanh(t)},t.atan2=function(t,e){return Math.atan2(t,e)},t.trunc=function(t){return 0<t?Math.floor(t):Math.ceil(t)},t.random=function(){return Math.random()},t.randomRange=function(t,e){if(t==e)return t;if(e<t){var n=t;t=e,e=n}return Math.floor(t)==t&&Math.floor(e)==e?t+Math.floor(Math.random()*(e-t+1)):t+Math.random()*(e-t)},function(t){function n(t,e){return p.pxtrt.nullFix(t)==p.pxtrt.nullFix(e)}t.lt=function(t,e){return t<e},t.le=function(t,e){return t<=e},t.neq=function(t,e){return!n(t,e)},t.eq=n,t.eqDecr=function(t,e){return p.pxtrt.nullFix(t)==p.pxtrt.nullFix(e)},t.gt=function(t,e){return e<t},t.ge=function(t,e){return e<=t},t.div=function(t,e){return 0|Math.floor(t/e)},t.mod=function(t,e){return t%e},t.bnot=function(t){return~t},t.toString=function(t){return t+""}}(p.Number_||(p.Number_={})),(e=p.thumb||(p.thumb={})).adds=function(t,e){return t+e|0},e.subs=function(t,e){return t-e|0},e.divs=function(t,e){return 0|Math.floor(t/e)},e.muls=function(t,e){return r.imul(t,e)},e.ands=function(t,e){return t&e},e.orrs=function(t,e){return t|e},e.eors=function(t,e){return t^e},e.lsls=function(t,e){return t<<e},e.lsrs=function(t,e){return t>>>e},e.asrs=function(t,e){return t>>e},e.bnot=function(t){return~t},e.ignore=function(t){return t},function(t){function n(t){return t<<16>>16}t.adds=function(t,e){return n(t+e)},t.subs=function(t,e){return n(t-e)},t.divs=function(t,e){return n(Math.floor(t/e))},t.muls=function(t,e){return n(r.imul(t,e))},t.ands=function(t,e){return n(t&e)},t.orrs=function(t,e){return n(t|e)},t.eors=function(t,e){return n(t^e)},t.lsls=function(t,e){return n(t<<e)},t.lsrs=function(t,e){return(65535&t)>>>e},t.asrs=function(t,e){return n(t>>e)},t.bnot=function(t){return~t},t.ignore=function(t){return t}}(p.avr||(p.avr={})),(n=p.String_||(p.String_={})).stringConv=function(t){var e=p.getResume();t instanceof p.RefRecord&&t.vtable.toStringMethod?p.runtime.runFiberAsync(t.vtable.toStringMethod,t).done(function(){e(p.runtime.currFrame.retval+"")}):e(t+"")},n.mkEmpty=function(){return""},n.fromCharCode=function(t){return String.fromCharCode(t)},n.toNumber=function(t){return parseFloat(t)},n.concat=function(t,e){return t+e},n.substring=function(t,e,n){return p.pxtrt.nullCheck(t),t.slice(e,e+n)},n.equals=function(t,e){return t==e},n.compare=function(t,e){return t==e?0:t<e?-1:1},n.compareDecr=function(t,e){return t==e?0:t<e?-1:1},n.length=function(t){return t.length},n.substr=function(t,e,n){return t.substr(e,n)},n.charAt=function(t,e){return t.charAt(e)},n.charCodeAt=function(t,e){return p.pxtrt.nullCheck(t),n=t,r=e,p.pxtrt.nullCheck(n),0<=r&&r<n.length?t.charCodeAt(e):0;var n,r},n.indexOf=function(t,e,n){return p.pxtrt.nullCheck(t),null==e?-1:t.indexOf(e,n)},n.lastIndexOf=function(t,e,n){return p.pxtrt.nullCheck(t),null==e?-1:t.lastIndexOf(e,n)},n.includes=function(t,e,n){return p.pxtrt.nullCheck(t),null!=e&&t.includes(e,n)},(i=p.Boolean_||(p.Boolean_={})).toString=function(t){return t?"true":"false"},i.bang=function(t){return!t};var d=function(n){function t(t){var e=n.call(this)||this;return e.data=t,e.isStatic=!1,e}return __extends(t,n),t.prototype.scan=function(t){},t.prototype.gcKey=function(){return"Buffer"},t.prototype.gcSize=function(){return 2+(this.data.length+3>>2)},t.prototype.gcIsStatic=function(){return this.isStatic},t.prototype.print=function(){},t}(p.RefObject);p.RefBuffer=d,function(t){var i,e;function l(t){var e=function(t){switch(t){case i.Int8LE:return-1;case i.UInt8LE:return 1;case i.Int16LE:return-2;case i.UInt16LE:return 2;case i.Int32LE:return-4;case i.UInt32LE:return 4;case i.Int8BE:return-10;case i.UInt8BE:return 10;case i.Int16BE:return-20;case i.UInt16BE:return 20;case i.Int32BE:return-40;case i.UInt32BE:return 40;case i.Float32LE:return 4;case i.Float32BE:return 40;case i.Float64LE:return 8;case i.Float64BE:return 80;default:throw p.U.userError("bad format")}}(t),n=!1;e<0&&(n=!0,e=-e);var r=!1;return 10<=e&&(r=!0,e/=10),{size:e,signed:n,swap:r,isFloat:t>=i.Float32LE}}function r(t){return new d(new Uint8Array(t))}function o(t,e){return p.pxtrt.nullCheck(t),0<=e&&e<t.data.length}function n(t,e){return o(t,e)?t.data[e]:0}function s(t,e,n){o(t,e)&&(t.data[e]=n)}function a(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=-1),n<0||n>t.data.length||(r<0&&(r=t.data.length),r=Math.min(r,t.data.length-n),t.data.fill(e,n,n+r))}function u(t,e,n,r,i){if(n.buffer===t.buffer)u(t,e,n.slice(r,r+i),0,i);else for(var o=0;o<i;++o)t[e+o]=n[r+o]}(e=i=t.NumberFormat||(t.NumberFormat={}))[e.Int8LE=1]="Int8LE",e[e.UInt8LE=2]="UInt8LE",e[e.Int16LE=3]="Int16LE",e[e.UInt16LE=4]="UInt16LE",e[e.Int32LE=5]="Int32LE",e[e.Int8BE=6]="Int8BE",e[e.UInt8BE=7]="UInt8BE",e[e.Int16BE=8]="Int16BE",e[e.UInt16BE=9]="UInt16BE",e[e.Int32BE=10]="Int32BE",e[e.UInt32LE=11]="UInt32LE",e[e.UInt32BE=12]="UInt32BE",e[e.Float32LE=13]="Float32LE",e[e.Float64LE=14]="Float64LE",e[e.Float32BE=15]="Float32BE",e[e.Float64BE=16]="Float64BE",t.getNumber=function(t,e,n){var r=l(e);if(r.isFloat){var i=t.data.buffer.slice(n,n+r.size);return r.swap&&new Uint8Array(i).reverse(),4==r.size?new Float32Array(i)[0]:new Float64Array(i)[0]}for(var o=0,s=0;s<r.size;++s){o<<=8;var a=r.swap?n+s:n+r.size-s-1;o|=t.data[a]}if(r.signed){var u=32-8*r.size;o=o<<u>>u}else o>>>=0;return o},t.setNumber=function(t,e,n,r){var i=l(e);if(i.isFloat){var o=new Uint8Array(i.size);4==i.size?new Float32Array(o.buffer)[0]=r:new Float64Array(o.buffer)[0]=r,i.swap&&o.reverse();for(var s=0;s<i.size;++s)t.data[n+s]=o[s]}else for(s=0;s<i.size;++s){var a=i.swap?n+i.size-s-1:n+s;t.data[a]=255&r,r>>=8}},t.createBuffer=r,t.createBufferFromHex=function(t){for(var e=r(t.length>>1),n=0;n<t.length;n+=2)e.data[n>>1]=parseInt(t.slice(n,n+2),16);return e.isStatic=!0,e},t.getBytes=function(t){return t.data},t.getUint8=function(t,e){return n(t,e)},t.getByte=n,t.setUint8=function(t,e,n){s(t,e,n)},t.setByte=s,t.length=function(t){return t.data.length},t.fill=a,t.slice=function(t,e,n){return e=Math.min(t.data.length,e),n<0&&(n=t.data.length),n=Math.min(n,t.data.length-e),new d(t.data.slice(e,e+n))},t.toHex=function(t){for(var e="0123456789abcdef",n="",r=0;r<t.data.length;++r)n+=e[t.data[r]>>4],n+=e[15&t.data[r]];return n},t.toString=function(t){return p.U.fromUTF8(p.U.uint8ArrayToString(t.data))};var c=-2147483648;t.shift=function(t,e,n,r){r<0&&(r=t.data.length-n),n<0||n+r>t.data.length||n+r<n||0==r||0==e||e==c||0!=r&&0!=e&&e!=c&&(e<=-r||r<=e?a(t,0):e<0?(e=-e,u(t.data,n+e,t.data,n,r-e),t.data.fill(0,n,n+e)):(r-=e,u(t.data,n,t.data,n+e,r),t.data.fill(0,n+r,n+r+e)))},t.rotate=function(t,e,n,r){if(r<0&&(r=t.data.length-n),!(n<0||n+r>t.data.length||n+r<n||0==r||0==e||e==c)){e<0&&(e+=r<<8),(e%=r)<0&&(e+=r);for(var i=t.data,o=e,s=0,a=o,u=r;s!=a;){var l=i[s+n];i[s+++n]=i[a+n],i[a+++n]=l,a==u?a=o:s==o&&(o=a)}}},t.write=function(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=-1),i<0&&(i=n.data.length),r<0||e<0||e>t.data.length||(i=Math.min(n.data.length-r,t.data.length-e))<0||u(t.data,e,n.data,r,i)}}(p.BufferMethods||(p.BufferMethods={}))}(pxsim||(pxsim={})),function(e){(e.control||(e.control={})).createBufferFromUTF8=function(t){return new e.RefBuffer(e.U.stringToUint8Array(e.U.toUTF8(t)))}}(pxsim||(pxsim={})),function(t){var e,n;e=t.localization||(t.localization={}),n={},e.setLocalizedStrings=function(t){n=t||{}},e.lf=function(t){return n[t]||t}}(pxsim||(pxsim={})),function(pxsim){var MIN_MESSAGE_WAIT_MS=200,tracePauseMs=0,U;!function(t){function e(t){for(;t.firstChild;)t.removeChild(t.firstChild)}var n;t.containsClass=function(e,t){return t.split(/\s+/).every(function(t){return function(t,e){if(t.classList)return t.classList.contains(e);var n=(t.className+"").split(/\s+/);return!(n.indexOf(e)<0)}(e,t)})},t.addClass=function(e,t){t.split(/\s+/).forEach(function(t){return function(t,e){if(t.classList)t.classList.add(e);else{var n=(t.className+"").split(/\s+/);n.indexOf(e)<0&&(t.className.baseVal+=" "+e)}}(e,t)})},t.removeClass=function(r,t){t.split(/\s+/).forEach(function(t){return n=t,void((e=r).classList?e.classList.remove(n):e.className.baseVal=(e.className+"").split(/\s+/).filter(function(t){return t!=n}).join(" "));var e,n})},t.remove=function(t){t.parentElement.removeChild(t)},t.removeChildren=e,t.clear=function(t){e(t)},t.assert=function(t,e){if(void 0===e&&(e="Assertion failed"),!t)throw new Error(e)},t.repeatMap=function(t,e){t=t||0;for(var n=[],r=0;r<t;++r)n.push(e(r));return n},t.userError=function(t){var e=new Error(t);throw e.isUserError=!0,e},t.now=function(){return Date.now()},t.perfNowUs=function(){return n||(n="undefined"!=typeof performance?performance.now.bind(performance)||performance.moznow.bind(performance)||performance.msNow.bind(performance)||performance.webkitNow.bind(performance)||performance.oNow.bind(performance):Date.now),1e3*n()},t.nextTick=function(t){Promise._async._schedule(t)},t.stringToUint8Array=function(t){for(var e=t.length,n=new Uint8Array(e),r=0;r<e;++r)n[r]=255&t.charCodeAt(r);return n},t.uint8ArrayToString=function(t){for(var e=t.length,n="",r=0;r<e;++r)n+=String.fromCharCode(t[r]);return n},t.fromUTF8=function(t){if(!t)return"";for(var e="",n=0;n<t.length;++n){var r=255&t.charCodeAt(n);e+=37==r||127<r?"%"+r.toString(16):t.charAt(n)}return decodeURIComponent(e)},t.toUTF8=function(t,e){var n="";if(!t)return n;for(var r=0;r<t.length;++r){var i=t.charCodeAt(r);if(i<=127)n+=t.charAt(r);else if(i<=2047)n+=String.fromCharCode(192|i>>6,128|63&i);else{if(!e&&55296<=i&&i<=56319){var o=t.charCodeAt(++r);isNaN(o)||(i=65536+(i-55296<<10)+(o-56320))}n+=i<=65535?String.fromCharCode(224|i>>12,128|i>>6&63,128|63&i):String.fromCharCode(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)}}return n}}(U=pxsim.U||(pxsim.U={}));var BreakLoopException=function(){},pxtcore;function getResume(){return pxsim.runtime.getResume()}pxsim.BreakLoopException=BreakLoopException,function(t){function e(t){var e=pxsim.runtime.currTryFrame();e||U.userError("unhandled exception: "+t);var n=e.handlerFrame;throw(pxsim.runtime.currFrame=n).pc=e.handlerPC,n.tryFrame=e.parent,n.thrownValue=t,n.hasThrownValue=!0,new BreakLoopException}t.beginTry=function(t){pxsim.runtime.currFrame.tryFrame={parent:pxsim.runtime.currTryFrame(),handlerPC:t,handlerFrame:pxsim.runtime.currFrame}},t.endTry=function(){var t=pxsim.runtime.currFrame;t.tryFrame=t.tryFrame.parent},t.throwValue=e,t.getThrownValue=function(){var t=pxsim.runtime.currFrame;return U.assert(t.hasThrownValue),t.hasThrownValue=!1,t.thrownValue},t.endFinally=function(){var t=pxsim.runtime.currFrame;t.hasThrownValue&&(t.hasThrownValue=!1,e(t.thrownValue))}}(pxtcore=pxsim.pxtcore||(pxsim.pxtcore={})),pxsim.getResume=getResume;var SERIAL_BUFFER_LENGTH=16,BaseBoard=function(){function t(){var e=this;this.messageListeners=[],this.serialOutBuffer="",this.messages=[],this.lastSerialTime=0,this.debouncedPostAll=function(){var t=Date.now();t-e.lastSerialTime>MIN_MESSAGE_WAIT_MS?(clearTimeout(e.serialTimeout),e.messages.length&&(Runtime.postMessage({type:"bulkserial",data:e.messages,id:pxsim.runtime.id,sim:!0}),e.messages=[],e.lastSerialTime=t)):e.serialTimeout=setTimeout(e.debouncedPostAll,50)},this.id="b"+Math.round(2147483647*Math.random()),this.bus=new pxsim.EventBus(pxsim.runtime)}return t.prototype.updateView=function(){},t.prototype.receiveMessage=function(t){this.dispatchMessage(t)},t.prototype.dispatchMessage=function(t){for(var e=0,n=this.messageListeners;e<n.length;e++){(0,n[e])(t)}},t.prototype.addMessageListener=function(t){this.messageListeners.push(t)},Object.defineProperty(t.prototype,"storedState",{get:function(){return this.runOptions?(this.runOptions.storedState||(this.runOptions.storedState={}),this.runOptions.storedState):{}},enumerable:!0,configurable:!0}),t.prototype.initAsync=function(t){return this.runOptions=t,Promise.resolve()},t.prototype.setStoredState=function(t,e){null==e?delete this.storedState[t]:this.storedState[t]=e,Runtime.postMessage({type:"simulator",command:"setstate",stateKey:t,stateValue:e})},t.prototype.onDebuggerResume=function(){},t.prototype.screenshotAsync=function(t){return Promise.resolve(void 0)},t.prototype.kill=function(){},t.prototype.writeSerial=function(t){this.serialOutBuffer+=t,(/\n/.test(this.serialOutBuffer)||this.serialOutBuffer.length>SERIAL_BUFFER_LENGTH)&&(this.messages.push({time:Date.now(),data:this.serialOutBuffer}),this.debouncedPostAll(),this.serialOutBuffer="")},t}();pxsim.BaseBoard=BaseBoard;var CoreBoard=function(e){function t(){var t=e.call(this)||this;return t.updateSubscribers=[],t.updateView=function(){t.updateSubscribers.forEach(function(t){return t()})},t.builtinParts={},t.builtinVisuals={},t.builtinPartVisuals={},t}return __extends(t,e),t.prototype.kill=function(){e.prototype.kill.call(this),pxsim.AudioContextManager.stopAll()},t}(BaseBoard);pxsim.CoreBoard=CoreBoard;var BareBoard=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(BaseBoard),LogType,dG;function initBareRuntime(){pxsim.runtime.board=new BareBoard;var t=pxsim;t.basic={pause:pxsim.thread.pause,showNumber:function(t){var e=getResume();console.log("SHOW NUMBER:",t),U.nextTick(e)}},t.serial={writeString:function(t){return pxsim.runtime.board.writeSerial(t)}},t.pins={createBuffer:pxsim.BufferMethods.createBuffer},t.control={inBackground:pxsim.thread.runInBackground}}pxsim.initBareRuntime=initBareRuntime,dG=LogType||(LogType={}),dG[dG.UserSet=0]="UserSet",dG[dG.BackAdd=1]="BackAdd",dG[dG.BackRemove=2]="BackRemove";var EventQueue=function(){function t(t,e){this.runtime=t,this.valueToArgs=e,this.max=5,this.events=[],this.awaiters=[],this._handlers=[],this._addRemoveLog=[]}return t.prototype.push=function(t,e){if(0<this.awaiters.length)if(e){var n=this.awaiters.shift();n&&n()}else{var r=this.awaiters.slice();this.awaiters=[],r.forEach(function(t){return t()})}return 0==this.handlers.length||this.events.length>this.max?Promise.resolve():(this.events.push(t),this.lock?Promise.resolve():this.poke())},t.prototype.poke=function(){var r=this;this.lock=!0;var t=this.events;return this.events=[],Promise.each(t,function(n){return Promise.each(r.handlers,function(t){return(e=r.runtime).runFiberAsync.apply(e,[t].concat(r.valueToArgs?r.valueToArgs(n):[n]));var e})}).then(function(){return 0<r.events.length?r.poke():(r.lock=!1,r._addRemoveLog.forEach(function(t){t.log===LogType.BackAdd?r.addHandler(t.act):t.log===LogType.BackRemove?r.removeHandler(t.act):r.setHandler(t.act)}),r._addRemoveLog=[],Promise.resolve())})},Object.defineProperty(t.prototype,"handlers",{get:function(){return this._handlers},enumerable:!0,configurable:!0}),t.prototype.setHandler=function(t){this.lock?this._addRemoveLog.push({act:t,log:LogType.UserSet}):this._handlers=[t]},t.prototype.addHandler=function(t){this.lock?this._addRemoveLog.push({act:t,log:LogType.BackAdd}):-1==this._handlers.indexOf(t)&&this._handlers.push(t)},t.prototype.removeHandler=function(t){if(this.lock)this._addRemoveLog.push({act:t,log:LogType.BackRemove});else{var e=this._handlers.indexOf(t);-1!=e&&this._handlers.splice(e,1)}},t.prototype.addAwaiter=function(t){this.awaiters.push(t)},t}();function _leave(t,e){return t.parent.retval=e,t.parent}function syntheticRefAction(e){return pxtcore.mkAction(0,function(t){return _leave(t,e(t))})}pxsim.EventQueue=EventQueue,pxsim.initCurrentRuntime=void 0,pxsim.handleCustomMessage=void 0,pxsim.syntheticRefAction=syntheticRefAction;var TimeoutScheduled=function(t,e,n,r){this.id=t,this.fn=e,this.totalRuntime=n,this.timestampCall=r};pxsim.TimeoutScheduled=TimeoutScheduled;var PausedTimeout=function(t,e){this.fn=t,this.timeRemaining=e};function mkVTable(t){return{name:t.name,numFields:t.numFields,classNo:t.classNo,methods:t.methods,iface:t.iface,lastSubtypeNo:t.lastSubtypeNo,toStringMethod:t.toStringMethod,maxBgInstances:t.maxBgInstances}}pxsim.PausedTimeout=PausedTimeout,pxsim.mkVTable=mkVTable;var mapVTable=null;function mkMapVTable(){return mapVTable||(mapVTable=mkVTable({name:"_Map",numFields:0,classNo:0,lastSubtypeNo:0,methods:null})),mapVTable}function functionName(t){var e=t.info;return e?e.functionName+" ("+e.fileName+":"+(e.line+1)+":"+(e.column+1)+")":"()"}pxsim.mkMapVTable=mkMapVTable,pxsim.functionName=functionName;var Runtime=function(){function Runtime(msg){var _this=this;this.numGlobals=1e3,this.dead=!1,this.running=!1,this.idleTimer=void 0,this.recording=!1,this.recordingTimer=0,this.recordingLastImageData=void 0,this.recordingWidth=void 0,this.startTime=0,this.startTimeUs=0,this.pausedTime=0,this.lastPauseTimestamp=0,this.globals={},this.otherFrames=[],this.loopLock=null,this.loopLockWaitList=[],this.heapSnapshots=[],this.timeoutsScheduled=[],this.timeoutsPausedOnBreakpoint=[],this.pausedOnBreakpoint=!1,this.perfOffset=0,this.perfElapsed=0,this.perfStack=0,this.refCountingDebug=!1,this.refObjId=1,this.numDisplayUpdates=0,U.assert(!!pxsim.initCurrentRuntime),this.id=msg.id,this.refCountingDebug=!!msg.refCountingDebug;var threadId=0,breakpoints=null,currResume,dbgHeap,dbgResume,breakFrame=null,lastYield=Date.now(),userGlobals,__this=this,evalIface={runtime:this,oops:oops,doNothing:doNothing,pxsim:pxsim,globals:this.globals,setupYield:setupYield,maybeYield:maybeYield,setupDebugger:setupDebugger,isBreakFrame:isBreakFrame,breakpoint:breakpoint,trace:trace,checkStack:checkStack,leave:_leave,checkResumeConsumed:checkResumeConsumed,setupResume:setupResume,setupLambda:setupLambda,checkSubtype:checkSubtype,failedCast:failedCast,buildResume:buildResume,mkVTable:mkVTable};function oops(t){throw new Error("sim error: "+t)}function doNothing(t){return t.pc=-1,_leave(t,t.parent.retval)}function flushLoopLock(){for(;0<__this.loopLockWaitList.length&&!__this.loopLock;){__this.loopLockWaitList.shift()()}}var yieldReset=function(){};function setupYield(t){yieldReset=t}function loopForSchedule(t){var e=new Object,n=t.pc;return __this.loopLock=e,__this.otherFrames.push(t),function(){__this.dead||(U.assert(t.pc==n),U.assert(__this.loopLock===e),__this.loopLock=null,loop(t),flushLoopLock())}}function maybeYield(t,e,n){if(__this.pausedOnBreakpoint)return!1;__this.cleanScheduledExpired(),yieldReset();var r=Date.now();return 20<=r-lastYield&&(lastYield=r,t.pc=e,t.r0=n,setTimeout(loopForSchedule(t),5),!0)}function setupDebugger(t,e){return(breakpoints=new Uint8Array(t))[0]=msg.breakOnStart?1:0,userGlobals=e,breakpoints}function isBreakFrame(t){if(!breakFrame)return!0;for(var e=breakFrame;e;e=e.parent)if(e==t)return!0;return!1}function breakpoint(e,n,t,r){var i={};__this.loopLock=i,U.assert(!dbgResume),U.assert(!dbgHeap),e.pc=n,e.r0=r;var o=pxsim.getBreakpointMsg(e,t,userGlobals),s=o.msg,a=o.heap;return dbgHeap=a,Runtime.postMessage(s),breakpoints[0]=0,breakFrame=null,__this.pauseScheduled(),dbgResume=function(t){if(dbgHeap=dbgResume=null,__this.dead)return null;switch(__this.resumeAllPausedScheduled(),__this.board.onDebuggerResume(),pxsim.runtime=__this,U.assert(e.pc==n),breakpoints[0]=0,breakFrame=null,t.subtype){case"resume":break;case"stepover":breakpoints[0]=1,breakFrame=e;break;case"stepinto":breakpoints[0]=1;break;case"stepout":breakpoints[0]=1,breakFrame=e.parent||e}U.assert(__this.loopLock==i),__this.loopLock=null,__this.otherFrames.push(e),loop(e),flushLoopLock()},null}function trace(t,e,n,r){setupResume(e,n),"<main>"===r.functionName||"main.ts"===r.fileName?(Runtime.postMessage({type:"debugger",subtype:"trace",breakpointId:t}),pxsim.thread.pause(tracePauseMs||1)):pxsim.thread.pause(0),checkResumeConsumed()}function handleDebuggerMsg(t){switch(t.subtype){case"config":var e=t;if(e.setBreakpoints&&breakpoints){breakpoints.fill(0);for(var n=0,r=e.setBreakpoints;n<r.length;n++){var i=r[n];breakpoints[i]=1}}break;case"traceConfig":tracePauseMs=t.interval;break;case"pause":breakpoints[0]=1,breakFrame=null;break;case"resume":case"stepover":case"stepinto":case"stepout":dbgResume&&dbgResume(t);break;case"variables":var o=t,s=void 0;if(dbgHeap){var a=dbgHeap[o.variablesReference];void 0!==a&&(s=pxsim.dumpHeap(a,dbgHeap,o.fields))}Runtime.postMessage({type:"debugger",subtype:"variables",req_seq:t.seq,variables:s})}}function removeFrame(t){for(var e=__this.otherFrames,n=e.length-1;0<=n;--n)if(e[n]===t)return void e.splice(n,1);U.userError("frame cannot be removed!")}function loop(e){if(__this.dead)console.log("Runtime terminated");else{U.assert(!__this.loopLock),__this.perfStartRuntime(),removeFrame(e);try{for(pxsim.runtime=__this;e;)__this.currFrame=e,__this.currFrame.overwrittenPC=!1,e=e.fn(e),__this.maybeUpdateDisplay(),__this.currFrame.overwrittenPC&&(e=__this.currFrame);__this.perfStopRuntime()}catch(t){if(t instanceof BreakLoopException)return void U.nextTick(loopForSchedule(__this.currFrame));if(__this.perfStopRuntime(),__this.errorHandler)__this.errorHandler(t);else{console.error("Simulator crashed, no error handler",t.stack);var n=pxsim.getBreakpointMsg(e,e.lastBrkId,userGlobals).msg;n.exceptionMessage=t.message,n.exceptionStack=t.stack,Runtime.postMessage(n),__this.postError&&__this.postError(t)}}}}function checkStack(t){100<t&&U.userError("Stack overflow")}function actionCall(t){return t.depth=t.parent.depth+1,checkStack(t.depth),t.pc=0,t}function setupTop(t){var e=setupTopCore(t);return setupResume(e,0),e}function setupTopCore(t){var e={parent:null,pc:0,depth:0,threadId:++threadId,fn:function(){return t&&t(e.retval),null}};return e}function topCall(t,e){U.assert(!!__this.board),U.assert(!__this.running),__this.setRunning(!0);var n={parent:setupTopCore(e),fn:t,depth:0,pc:0};__this.otherFrames=[n],loop(actionCall(n))}function checkResumeConsumed(){currResume&&oops("getResume() not called")}function setupResume(t,e){currResume=buildResume(t,e)}function setupLambda(t,e){e instanceof pxsim.RefAction?(t.fn=e.func,t.caps=e.fields):t.fn=e}function checkSubtype(t,e){if(!t)return!1;var n=t.vtable;return e===n||n&&e.classNo<=n.classNo&&n.classNo<=e.lastSubtypeNo}function failedCast(t){pxsim.control&&pxsim.control.dmesgValue&&pxsim.control.dmesgValue(t),oops("failed cast on "+t)}function buildResume(o,s){currResume&&oops("already has resume"),o.pc=s;var a=Date.now();__this.otherFrames.push(o);var u=function(t){if(!__this.dead){if(!__this.loopLock){pxsim.runtime=__this;var e=Date.now();if(3<e-a&&(lastYield=e),U.assert(o.pc==s),t instanceof pxsim.FnWrapper){var n=t,r={parent:o,fn:n.func,lambdaArgs:n.args,pc:0,caps:n.caps,depth:o.depth+1},i={};return __this.loopLock=i,removeFrame(o),__this.otherFrames.push(r),U.nextTick(function(){U.assert(__this.loopLock===i),__this.loopLock=null,loop(actionCall(r)),flushLoopLock()})}return o.retval=t,loop(o)}__this.loopLockWaitList.push(function(){return u(t)})}};return u}var entryPoint=eval(msg.code)(evalIface);this.run=function(t){return topCall(entryPoint,t)},this.getResume=function(){currResume||oops("noresume");var t=currResume;return currResume=null,t},this.setupTop=setupTop,this.handleDebuggerMsg=handleDebuggerMsg,this.entry=entryPoint,this.overwriteResume=function(t){currResume=null,0<=t&&(_this.currFrame.pc=t),_this.currFrame.overwrittenPC=!0},pxsim.runtime=this,pxsim.initCurrentRuntime(msg)}return Runtime.prototype.registerLiveObject=function(t){return this.refObjId++},Runtime.prototype.runningTime=function(){return U.now()-this.startTime-this.pausedTime},Runtime.prototype.runningTimeUs=function(){return 4294967295&U.perfNowUs()-this.startTimeUs>>0},Runtime.prototype.runFiberAsync=function(n,r,i,o){var s=this;return new Promise(function(t,e){return U.nextTick(function(){(pxsim.runtime=s).setupTop(t),pxtcore.runAction(n,[r,i,o])})})},Runtime.prototype.currTryFrame=function(){for(var t=this.currFrame;t;t=t.parent)if(t.tryFrame)return t.tryFrame;return null},Runtime.prototype.traceObjects=function(){for(var s={};2<this.heapSnapshots.length;)this.heapSnapshots.shift();var t={count:0,size:0,name:"TOTAL"},n={TOTAL:t};function a(t,e,n){if(void 0===n&&(n=null),e instanceof pxsim.RefObject){var r=e;if(!r.gcIsStatic()){var i=s[r.id];if(i)n&&i.pointers.push([n,t]);else{var o={obj:r,path:null,pointers:[[n,t]]};s[r.id]=o,r.scan(function(t,e){e instanceof pxsim.RefObject&&!s[e.id]&&a(t,e,o)})}}}}this.heapSnapshots.push({visited:s,statsByType:n});for(var e=0,r=Object.keys(this.globals);e<r.length;e++){a((m=r[e]).replace(/___\d+$/,""),this.globals[m])}var i=this.otherFrames.slice();this.currFrame&&i.indexOf(this.currFrame)<0&&i.unshift(this.currFrame);for(var o=0,u=this.getThreads();o<u.length;o++)for(var l=u[o],c="Thread-"+this.rootFrame(l).threadId,p=l;p;p=p.parent){for(var d=c+"."+functionName(p.fn),h=0,f=Object.keys(p);h<f.length;h++){var m=f[h];if(/^(r0|arg\d+|.*___\d+)/.test(m)){var g=p[m];g instanceof pxsim.RefObject&&a(d+"."+(m=m.replace(/___.*/,"")),g)}}if(p.caps)for(var v=0,b=p.caps;v<b.length;v++){a(d+".cap",b[v])}}var y=Object.keys(s).map(function(t){return s[t]});y.sort(function(t,e){return e.obj.gcSize()-t.obj.gcSize()});var w=function(t){if(null==t.path){var e="";t.path="(cycle)";for(var n=0,r=t.pointers;n<r.length;n++){var i=r[n],o=i[0],s=i[1];if(null==o)return void(t.path=s);w(o);var a=o.path+"."+s;(!e||e.length>a.length)&&(e=a)}t.path=e}};y.forEach(w);for(var x=[t],C=0,R=y;C<R.length;C++){var k=R[C],S=k.obj.gcSize(),_=k.obj.gcKey();n.hasOwnProperty(_)||x.push(n[_]={count:0,size:0,name:_}),(D=n[_]).size+=S,D.count++,t.size+=S,t.count++}x.sort(function(t,e){return t.size-e.size});for(var I="",E=function(t){return("        "+t.toString()).slice(-7)},P=0,B=x;P<B.length;P++){var D=B[P];I+=E(4*D.size)+E(D.count)+" "+D.name+"\n"}var A=function(t){return E(4*t.obj.gcSize())+" "+t.obj.gcKey()+" "+t.path},T=y.slice(0,20).map(A).join("\n"),F="";if(3<=this.heapSnapshots.length){var M=this.heapSnapshots[this.heapSnapshots.length-3].visited,L=this.heapSnapshots[this.heapSnapshots.length-2].visited;F=y.filter(function(t){return!M[t.obj.id]&&L[t.obj.id]}).filter(function(t){return!((e=t.obj)instanceof pxsim.RefRecord&&e.vtable&&e.vtable.maxBgInstances&&n[e.gcKey()].count<=e.vtable.maxBgInstances);var e}).map(A).join("\n")}return"Threads:\n"+this.threadInfo()+"\n\nSummary:\n"+I+"\n\nLarge Objects:\n"+T+"\n\nNew Objects:\n"+F},Runtime.prototype.getThreads=function(){var t=this.otherFrames.slice();return this.currFrame&&t.indexOf(this.currFrame)<0&&t.unshift(this.currFrame),t},Runtime.prototype.rootFrame=function(t){for(var e=t;e.parent;)e=e.parent;return e},Runtime.prototype.threadInfo=function(){for(var t="",e=0,n=this.getThreads();e<n.length;e++){var r=n[e];t+="Thread "+this.rootFrame(r).threadId+":\n";for(var i=0,o=pxsim.getBreakpointMsg(r,r.lastBrkId).msg.stackframes;i<o.length;i++){var s=o[i].funcInfo;t+="   at "+s.functionName+" ("+s.fileName+":"+(s.line+1)+":"+(s.column+1)+")\n"}t+="\n"}return t},Runtime.postMessage=function(t){t&&("undefined"!=typeof window&&window.parent&&window.parent.postMessage&&window.parent.postMessage(t,"*"),Runtime.messagePosted&&Runtime.messagePosted(t))},Runtime.postScreenshotAsync=function(e){var t=pxsim.runtime&&pxsim.runtime.board;return(t?t.screenshotAsync().catch(function(t){console.debug("screenshot failed")}):Promise.resolve(void 0)).then(function(t){return Runtime.postMessage({type:"screenshot",data:t,delay:e&&e.delay})})},Runtime.requestToggleRecording=function(){var t=pxsim.runtime;t&&Runtime.postMessage({type:"recorder",action:t.recording?"stop":"start"})},Runtime.prototype.restart=function(){this.kill(),setTimeout(function(){return pxsim.Runtime.postMessage({type:"simulator",command:"restart"})},500)},Runtime.prototype.kill=function(){this.dead=!0,this.stopRecording(),this.stopIdle(),this.setRunning(!1)},Runtime.prototype.updateDisplay=function(){this.board.updateView(),this.postFrame()},Runtime.prototype.startRecording=function(t){var e=this;!this.recording&&this.running&&(this.recording=!0,this.recordingTimer=setInterval(function(){return e.postFrame()},66),this.recordingLastImageData=void 0,this.recordingWidth=t)},Runtime.prototype.stopRecording=function(){this.recording&&(this.recordingTimer&&clearInterval(this.recordingTimer),this.recording=!1,this.recordingTimer=0,this.recordingLastImageData=void 0,this.recordingWidth=void 0)},Runtime.prototype.postFrame=function(){var o=this;if(this.recording&&this.running){var s=pxsim.U.now();this.board.screenshotAsync(this.recordingWidth).then(function(t){if(o.recordingLastImageData&&t&&o.recordingLastImageData.data.byteLength==t.data.byteLength){var e=o.recordingLastImageData.data,n=t.data,r=e.byteLength,i=0;for(i=0;i<r&&e[i]==n[i];++i);if(i==r)return}o.recordingLastImageData=t,Runtime.postMessage({type:"screenshot",data:t,time:s})})}},Runtime.prototype.queueDisplayUpdate=function(){this.numDisplayUpdates++},Runtime.prototype.maybeUpdateDisplay=function(){this.numDisplayUpdates&&(this.numDisplayUpdates=0,this.updateDisplay())},Runtime.prototype.setRunning=function(t){this.running!=t&&(this.running=t,this.running?(this.startTime=U.now(),this.startTimeUs=U.perfNowUs(),Runtime.postMessage({type:"status",frameid:pxsim.Embed.frameid,runtimeid:this.id,state:"running"})):(this.stopRecording(),this.stopIdle(),Runtime.postMessage({type:"status",frameid:pxsim.Embed.frameid,runtimeid:this.id,state:"killed"})),this.stateChanged&&this.stateChanged())},Runtime.prototype.dumpLivePointers=function(){},Runtime.prototype.setupPerfCounters=function(t){t&&t.length&&(this.perfCounters=t.map(function(t){return new PerfCounter(t)}))},Runtime.prototype.perfStartRuntime=function(){0!==this.perfOffset?this.perfStack++:this.perfOffset=U.perfNowUs()-this.perfElapsed},Runtime.prototype.perfStopRuntime=function(){this.perfStack?this.perfStack--:(this.perfElapsed=this.perfNow(),this.perfOffset=0)},Runtime.prototype.perfNow=function(){return 0===this.perfOffset&&U.userError("bad time now"),U.perfNowUs()-this.perfOffset|0},Runtime.prototype.startPerfCounter=function(t){if(this.perfCounters){var e=this.perfCounters[t];e.start&&U.userError("startPerf"),e.start=this.perfNow()}},Runtime.prototype.stopPerfCounter=function(t){if(this.perfCounters){var e=this.perfCounters[t];e.start||U.userError("stopPerf");var n=this.perfNow()-e.start;e.start=0,e.value+=n,e.numstops++;var r=e.lastFewPtr++;r>=e.lastFew.length&&(r=0,e.lastFewPtr=1),e.lastFew[r]=n}},Runtime.prototype.startIdle=function(){var e=this;void 0===this.idleTimer&&(this.idleTimer=setInterval(function(){if(e.running&&!e.pausedOnBreakpoint){var t=e.board.bus;t&&t.queueIdle()}},20))},Runtime.prototype.stopIdle=function(){void 0!==this.idleTimer&&(clearInterval(this.idleTimer),this.idleTimer=void 0)},Runtime.prototype.schedule=function(e,t){var n=this;if(t<=0&&(t=0),this.pausedOnBreakpoint)return this.timeoutsPausedOnBreakpoint.push(new PausedTimeout(e,t)),-1;var r=U.now(),i=new TimeoutScheduled(-1,e,t,r);return i.id=setTimeout(function(){var t=n.timeoutsScheduled.indexOf(i);0<=t&&n.timeoutsScheduled.splice(t,1),e()},t),this.timeoutsScheduled.push(i),i.id},Runtime.prototype.pauseScheduled=function(){var r=this;this.pausedOnBreakpoint=!0,this.timeoutsScheduled.forEach(function(t){clearTimeout(t.id);var e=U.now()-t.timestampCall,n=t.totalRuntime-e;n<=0&&(n=1),r.timeoutsPausedOnBreakpoint.push(new PausedTimeout(t.fn,n))}),this.lastPauseTimestamp=U.now(),this.timeoutsScheduled=[]},Runtime.prototype.resumeAllPausedScheduled=function(){var e=this;this.pausedOnBreakpoint=!1,this.timeoutsPausedOnBreakpoint.forEach(function(t){e.schedule(t.fn,t.timeRemaining)}),this.lastPauseTimestamp&&(this.pausedTime+=U.now()-this.lastPauseTimestamp,this.lastPauseTimestamp=0),this.timeoutsPausedOnBreakpoint=[]},Runtime.prototype.cleanScheduledExpired=function(){var n=U.now();this.timeoutsScheduled=this.timeoutsScheduled.filter(function(t){var e=n-t.timestampCall;return t.totalRuntime>e})},Runtime}();pxsim.Runtime=Runtime;var PerfCounter=function(t){this.name=t,this.start=0,this.numstops=0,this.value=0,this.lastFew=new Uint32Array(32),this.lastFewPtr=0};pxsim.PerfCounter=PerfCounter}(pxsim||(pxsim={})),function(a){var u,t,n,e;(t=u=a.SimulatorState||(a.SimulatorState={}))[t.Unloaded=0]="Unloaded",t[t.Stopped=1]="Stopped",t[t.Pending=2]="Pending",t[t.Starting=3]="Starting",t[t.Running=4]="Running",t[t.Paused=5]="Paused",t[t.Suspended=6]="Suspended",(e=n=a.SimulatorDebuggerCommand||(a.SimulatorDebuggerCommand={}))[e.StepInto=0]="StepInto",e[e.StepOver=1]="StepOver",e[e.StepOut=2]="StepOut",e[e.Resume=3]="Resume",e[e.Pause=4]="Pause";var r=function(){function t(t,e){void 0===e&&(e={}),this.container=t,this.options=e,this.themes=["blue","red","green","yellow"],this.runId="",this.nextFrameId=0,this.frameCounter=0,this.traceInterval=0,this.breakpointsSet=!1,this._runOptions={},this.state=u.Unloaded,this.frameCleanupTimeout=0,this.debuggerSeq=1,this.debuggerResolvers={}}return t.prototype.isDebug=function(){return this._runOptions&&!!this._runOptions.debug},t.prototype.hasParts=function(){return this._runOptions&&this._runOptions.parts&&!!this._runOptions.parts.length},t.prototype.setDirty=function(){this.state==a.SimulatorState.Running&&this.suspend()},t.prototype.setPending=function(){this.setState(u.Pending)},t.prototype.focus=function(){var t=this.simFrames()[0];t&&t.focus()},t.prototype.setStarting=function(){this.setState(u.Starting)},t.prototype.setHwDebugger=function(t){t?(this.hwdbg=t,this.setState(u.Running),this.container.style.opacity="0.3"):(delete this.container.style.opacity,this.hwdbg=null,this.setState(u.Running),this.stop())},t.prototype.handleHwDebuggerMsg=function(t){this.hwdbg&&this.handleMessage(t)},t.prototype.setThemes=function(t){a.U.assert(t&&0<t.length),this.themes=t},t.prototype.startRecording=function(t){this.simFrames()[0]&&this.postMessage({type:"recorder",action:"start",width:t})},t.prototype.stopRecording=function(){this.postMessage({type:"recorder",action:"stop"})},t.prototype.setFrameState=function(t){var e=t.nextElementSibling,n=e.nextElementSibling;switch(this.state){case u.Pending:case u.Starting:e.style.display="",e.className="",n.style.display="";break;case u.Stopped:case u.Suspended:a.U.addClass(t,this.state==u.Stopped||this._runOptions&&this._runOptions.autoRun?this.stoppedClass:this.invalidatedClass),this._runOptions&&this._runOptions.autoRun?e.style.display="none":(e.style.display="",e.className="videoplay xicon icon"),n.style.display="none",this.scheduleFrameCleanup();break;default:a.U.removeClass(t,this.stoppedClass),a.U.removeClass(t,this.invalidatedClass),e.style.display="none",n.style.display="none"}},t.prototype.setState=function(t){var e=this;this.state!=t&&(this.state=t,this.freeze(this.state==u.Paused),this.simFrames().forEach(function(t){return e.setFrameState(t)}),this.options.onStateChanged&&this.options.onStateChanged(this.state))},t.prototype.freeze=function(t){var n="pause-overlay";t?a.util.toArray(this.container.querySelectorAll("div.simframe")).forEach(function(t){if(!t.querySelector("div."+n)){var e=document.createElement("div");e.className=n,e.onclick=function(t){return t.preventDefault(),!1},t.appendChild(e)}}):a.util.toArray(this.container.querySelectorAll("div.simframe div."+n)).forEach(function(t){return t.parentElement.removeChild(t)})},t.prototype.simFrames=function(t){void 0===t&&(t=!1);var e=a.util.toArray(this.container.getElementsByTagName("iframe")),n=this.loanedIFrame();return n&&!t&&e.unshift(n),e},t.prototype.postMessage=function(t,e){if(this.hwdbg)this.hwdbg.postMessage(t);else{var n=this.simFrames();e&&t&&t.broadcast&&(n.length<2?(this.container.appendChild(this.createFrame()),n=this.simFrames()):n[1].dataset.runid!=this.runId&&this.startFrame(n[1]));for(var r=0;r<n.length;++r){var i=n[r];if((!e||i.contentWindow!=e)&&(i.contentWindow&&(i.contentWindow.postMessage(t,"*"),"recorder"==t.type&&"start"==t.action)))break}}},t.prototype.createFrame=function(t){var e=this,n=document.createElement("div");n.className="simframe ui embed";var r=document.createElement("iframe");r.id="sim-frame-"+this.nextId(),r.title=a.localization.lf("Simulator"),r.allowFullscreen=!0,r.setAttribute("allow","autoplay"),r.setAttribute("sandbox","allow-same-origin allow-scripts");var i=this.options.simUrl||(window.pxtConfig||{}).simUrl||"/sim/simulator.html";r.className="no-select",r.src=i+"#"+r.id,r.frameBorder="0",r.dataset.runid=this.runId,n.appendChild(r);var o=document.createElement("i");o.className="videoplay xicon icon",o.style.display="none",o.onclick=function(t){return t.preventDefault(),e.state!=u.Running&&e.state!=u.Starting&&(e.options.restart?e.options.restart():e.start()),r.focus(),!1},n.appendChild(o);var s=document.createElement("div");return s.className="ui active loader",o.style.display="none",n.appendChild(s),this._runOptions&&this.applyAspectRatioToFrame(r),n},t.prototype.preload=function(t){this.simFrames().length||(this.container.appendChild(this.createFrame()),this.applyAspectRatio(t),this.setStarting())},t.prototype.stop=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this.clearDebugger(),this.postMessage({type:"stop"}),this.setState(e?u.Starting:u.Stopped),t&&this.unload()},t.prototype.suspend=function(){this.postMessage({type:"stop"}),this.setState(u.Suspended)},t.prototype.unload=function(){this.cancelFrameCleanup(),a.U.removeChildren(this.container),this.setState(u.Unloaded),this._runOptions=void 0,this._currentRuntime=void 0,this.runId=void 0},t.prototype.mute=function(t){this._currentRuntime&&(this._currentRuntime.mute=t),this.postMessage({type:"mute",mute:t})},t.prototype.stopSound=function(){this.postMessage({type:"stopsound"})},t.prototype.isLoanedSimulator=function(t){return!!this.loanedSimulator&&this.loanedIFrame()==t},t.prototype.loanSimulator=function(){return this.loanedSimulator||(this.loanedSimulator=this.container.firstElementChild||this.createFrame(),this.loanedSimulator.parentNode&&this.container.removeChild(this.loanedSimulator)),this.loanedSimulator},t.prototype.unloanSimulator=function(){this.loanedSimulator&&(this.loanedSimulator.parentNode&&this.loanedSimulator.parentNode.removeChild(this.loanedSimulator),this.container.insertBefore(this.loanedSimulator,this.container.firstElementChild),delete this.loanedSimulator)},t.prototype.loanedIFrame=function(){return this.loanedSimulator&&this.loanedSimulator.parentNode&&this.loanedSimulator.querySelector("iframe")},t.prototype.cancelFrameCleanup=function(){this.frameCleanupTimeout&&(clearTimeout(this.frameCleanupTimeout),this.frameCleanupTimeout=0)},t.prototype.scheduleFrameCleanup=function(){var t=this;this.cancelFrameCleanup(),this.frameCleanupTimeout=setTimeout(function(){t.frameCleanupTimeout=0,t.cleanupFrames()},5e3)},t.prototype.applyAspectRatio=function(e){var n=this;(e||this._runOptions)&&this.simFrames().forEach(function(t){return n.applyAspectRatioToFrame(t,e)})},t.prototype.applyAspectRatioToFrame=function(t,e){var n=e||this._runOptions.aspectRatio;t.parentElement.style.paddingBottom=100/n+"%"},t.prototype.cleanupFrames=function(){var e=this,t=this.simFrames(!0);t.shift(),t.forEach(function(t){e.state!=u.Stopped&&t.dataset.runid==e.runId||(e.options.removeElement?e.options.removeElement(t.parentElement):t.parentElement.remove())})},t.prototype.hide=function(e){var n=this;if(this.suspend(),this.options.removeElement){var t=this.simFrames();t.forEach(function(t){n.options.removeElement(t.parentElement,e)}),0==t.length&&e&&e()}},t.prototype.unhide=function(){var e=this;this.options.unhideElement&&this.simFrames().forEach(function(t){e.options.unhideElement(t.parentElement)})},t.prototype.run=function(t,e){void 0===e&&(e={}),this._runOptions=e,this.runId=this.nextId(),this._currentRuntime={type:"run",boardDefinition:e.boardDefinition,parts:e.parts,fnArgs:e.fnArgs,code:t,partDefinitions:e.partDefinitions,mute:e.mute,highContrast:e.highContrast,light:e.light,cdnUrl:e.cdnUrl,localizedStrings:e.localizedStrings,refCountingDebug:e.refCountingDebug,version:e.version,clickTrigger:e.clickTrigger,breakOnStart:e.breakOnStart,storedState:e.storedState},this.start()},t.prototype.restart=function(){this.stop(),this.start()},t.prototype.areBreakpointsSet=function(){return this.breakpointsSet},t.prototype.start=function(){if(this.clearDebugger(),this.addEventListeners(),this.applyAspectRatio(),this.scheduleFrameCleanup(),this._currentRuntime){this.breakpointsSet=!1;var t=this.simFrames()[0];if(t)this.startFrame(t);else{var e=this.createFrame(this._runOptions&&this._runOptions.light);this.container.appendChild(e),t=e.firstElementChild}this.setState(u.Running),this.setTraceInterval(this.traceInterval)}},t.prototype.startFrame=function(t){if(!this._currentRuntime||!t.contentWindow)return!1;var e=JSON.parse(JSON.stringify(this._currentRuntime)),n="",r=/player=([A-Za-z0-9]+)/i.exec(window.location.href);return r&&(n=r[1]),e.frameCounter=++this.frameCounter,e.options={theme:this.themes[this.nextFrameId++%this.themes.length],player:n},e.id=e.options.theme+"-"+this.nextId(),t.dataset.runid=this.runId,t.dataset.runtimeid=e.id,t.contentWindow.postMessage(e,"*"),this.setFrameState(t),!0},t.prototype.handleMessage=function(t,e){switch(t.type||""){case"ready":var n=t.frameid;(r=document.getElementById(n))&&(this.startFrame(r),this.options.revealElement&&this.options.revealElement(r)),this.options.onSimulatorReady&&this.options.onSimulatorReady();break;case"status":var r;n=t.frameid;if(r=document.getElementById(n)){var i=t;switch(i.state){case"killed":i.runtimeid==r.dataset.runtimeid&&this.setState(u.Stopped)}}break;case"simulator":this.handleSimulatorCommand(t);break;case"serial":case"pxteditor":case"screenshot":case"custom":case"recorder":break;case"debugger":this.handleDebuggerMessage(t);break;case"toplevelcodefinished":this.options.onTopLevelCodeEnd&&this.options.onTopLevelCodeEnd();break;default:this.postMessage(t,e)}},t.prototype.addEventListeners=function(){var e=this;this.listener||(this.listener=function(t){e.hwdbg||e.handleMessage(t.data,t.source)},window.addEventListener("message",this.listener,!1))},t.prototype.removeEventListeners=function(){this.listener&&(window.removeEventListener("message",this.listener,!1),this.listener=void 0)},t.prototype.resume=function(t){var e;switch(t){case n.Resume:e="resume",this.setState(u.Running);break;case n.StepInto:e="stepinto",this.setState(u.Running);break;case n.StepOut:e="stepout",this.setState(u.Running);break;case n.StepOver:e="stepover",this.setState(u.Running);break;case n.Pause:e="pause";break;default:return void console.debug("unknown command")}this.postMessage({type:"debugger",subtype:e})},t.prototype.setBreakpoints=function(t){this.breakpointsSet=!0,this.postDebuggerMessage("config",{setBreakpoints:t})},t.prototype.setTraceInterval=function(t){this.traceInterval=t,this.postDebuggerMessage("traceConfig",{interval:t})},t.prototype.variablesAsync=function(t,e){return this.postDebuggerMessageAsync("variables",{variablesReference:t,fields:e}).then(function(t){return t},function(t){})},t.prototype.handleSimulatorCommand=function(t){this.options.onSimulatorCommand&&this.options.onSimulatorCommand(t)},t.prototype.clearDebugger=function(){var e=this,n=new Error("Debugging cancelled");Object.keys(this.debuggerResolvers).forEach(function(t){(0,e.debuggerResolvers[t].reject)(n)}),this.debuggerResolvers={},this.debuggerSeq++},t.prototype.handleDebuggerMessage=function(t){("trace"!==t.subtype&&console.log("DBG-MSG",t.subtype,t),t.seq)&&((s=this.debuggerResolvers[t.seq].resolve)&&s(t));switch(t.subtype){case"warning":this.options.onDebuggerWarning&&this.options.onDebuggerWarning(t);break;case"breakpoint":var e=t;if(this.state==u.Running){e.exceptionMessage?this.suspend():this.setState(u.Paused),this.options.onDebuggerBreakpoint&&this.options.onDebuggerBreakpoint(e);for(var n=e.exceptionMessage+"\n",r=0,i=e.stackframes;r<i.length;r++){var o=i[r].funcInfo;n+="   at "+o.functionName+" ("+o.fileName+":"+(o.line+1)+":"+(o.column+1)+")\n"}e.exceptionMessage&&console.error(n)}else console.error("debugger: trying to pause from "+this.state);break;case"trace":this.options.onTraceMessage&&this.options.onTraceMessage(t);break;default:var s,a=t.req_seq;if(a)(s=this.debuggerResolvers[a].resolve)&&(delete this.debuggerResolvers[a],s(t))}},t.prototype.postDebuggerMessageAsync=function(r,i){var o=this;return void 0===i&&(i={}),new Promise(function(t,e){var n=o.debuggerSeq++;o.debuggerResolvers[n.toString()]={resolve:t,reject:e},o.postDebuggerMessage(r,i,n)})},t.prototype.postDebuggerMessage=function(t,e,n){void 0===e&&(e={});var r=JSON.parse(JSON.stringify(e));r.type="debugger",r.subtype=t,n&&(r.seq=n),this.postMessage(r)},t.prototype.nextId=function(){return this.nextFrameId+++(Math.random()+""+Math.random()).replace(/[^\d]/,"")},Object.defineProperty(t.prototype,"stoppedClass",{get:function(){return this.options&&this.options.stoppedClass||"grayscale"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invalidatedClass",{get:function(){return this.options&&this.options.invalidatedClass||"sepia"},enumerable:!0,configurable:!0}),t}();a.SimulatorDriver=r}(pxsim||(pxsim={})),function(_){_.mkRange=function(t,e){for(var n=[];t<e;t++)n.push(t);return n};var t=function(){function t(t,e){this.runtime=t,this.valueToArgs=e,this.queues={},this.backgroundHandlerFlag=!1,this.nextNotifyEvent=1024,this.schedulerID=15,this.idleEventID=2}return t.prototype.setBackgroundHandlerFlag=function(){this.backgroundHandlerFlag=!0},t.prototype.setNotify=function(t,e){this.notifyID=t,this.notifyOneID=e},t.prototype.setIdle=function(t,e){this.schedulerID=t,this.idleEventID=e},t.prototype.start=function(t,e,n,r){void 0===r&&(r=!1);var i=(n?"back":"fore")+":"+t+":"+e;return!this.queues[i]&&r&&(this.queues[i]=new _.EventQueue(this.runtime,this.valueToArgs)),this.queues[i]},t.prototype.listen=function(t,e,n){t==this.schedulerID&&e==this.idleEventID&&this.runtime.startIdle();var r=this.start(t,e,this.backgroundHandlerFlag,!0);this.backgroundHandlerFlag?r.addHandler(n):r.setHandler(n),this.backgroundHandlerFlag=!1},t.prototype.removeBackgroundHandler=function(e){var n=this;Object.keys(this.queues).forEach(function(t){t.startsWith("back:")&&n.queues[t].removeHandler(e)})},t.prototype.getQueues=function(t,e,n){var r=[this.start(0,0,n)];return 0==t&&0==e||(e&&r.push(this.start(0,e,n)),t&&r.push(this.start(t,0,n)),t&&e&&r.push(this.start(t,e,n))),r},t.prototype.queue=function(t,e,n){if(void 0===n&&(n=null),!_.runtime.pausedOnBreakpoint){var r=this.notifyID&&this.notifyOneID&&t==this.notifyOneID;r&&(t=this.notifyID);var i=this.getQueues(t,e,!0).concat(this.getQueues(t,e,!1));this.lastEventValue=e,this.lastEventTimestampUs=_.U.perfNowUs(),Promise.each(i,function(t){return t?t.push(n,r):Promise.resolve()})}},t.prototype.queueIdle=function(){this.schedulerID&&this.idleEventID&&this.queue(this.schedulerID,this.idleEventID)},t.prototype.wait=function(t,e,n){this.start(t,e,!1,!0).addAwaiter(n)},t.prototype.getLastEventValue=function(){return this.lastEventValue},t.prototype.getLastEventTime=function(){return 4294967295&this.lastEventTimestampUs-_.runtime.startTimeUs},t}();_.EventBus=t;var e=function(){function t(n){var r=this;this.runtime=n,this.queue=[],this.process=function(){var t=r.queue[0];if(t&&!r.runtime.dead){n=r.runtime;var e=t.frame();n.queueDisplayUpdate(),n.maybeUpdateDisplay(),!1===e?(r.queue.shift(),r.queue[0]&&(r.queue[0].setTimeoutHandle=setTimeout(r.process,r.queue[0].interval)),t.whenDone(!1)):t.setTimeoutHandle=setTimeout(r.process,t.interval)}}}return t.prototype.cancelAll=function(){var t=this.queue;this.queue=[];for(var e=0,n=t;e<n.length;e++){var r=n[e];r.whenDone(!0),r.setTimeoutHandle&&clearTimeout(r.setTimeoutHandle)}},t.prototype.cancelCurrent=function(){var t=this.queue[0];t&&(this.queue.shift(),t.whenDone(!0),t.setTimeoutHandle&&clearTimeout(t.setTimeoutHandle))},t.prototype.enqueue=function(t){t.whenDone||(t.whenDone=function(){}),this.queue.push(t),1==this.queue.length&&this.process()},t.prototype.executeAsync=function(n){var r=this;return _.U.assert(!n.whenDone),new Promise(function(t,e){n.whenDone=t,r.enqueue(n)})},t}();function n(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function r(){return"undefined"!=typeof window&&!!window.PointerEvent}_.AnimationQueue=e,function(t){var e,r,i,o,s=0,w=!1;function x(){return e||(e=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(t){}return}()),e}function u(){i&&(i.gain.value=0),s=0,o&&o.pause()}function n(){u(),p()}t.mute=function(t){w=t,n();var e=x();!t&&e&&"suspended"===e.state&&e.resume()},t.stopAll=n,t.stop=function(){u()},t.frequency=function(){return s};var a,l=[null,"triangle","sawtooth","sine"],c=[];function C(t,e){var n,r=l[t];if(r){var i=x().createOscillator();return i.type=r,i.frequency.value=e,i}if(5==t)n=function(){if(!a)for(var t=(a=x().createBuffer(1,1e5,x().sampleRate)).getChannelData(0),e=251771520,n=0;n<1e5;n++)e^=e<<13,e^=e>>17,e^=e<<5,t[n]=(1023&e)/512-1;return a}();else{if(!(11<=t&&t<=15))return null;n=function(t){if(!c[t]){for(var e=x().createBuffer(1,1024,x().sampleRate),n=e.getChannelData(0),r=0;r<1024;r++)n[r]=r<t/100*1024?1:-1;c[t]=e}return c[t]}(10*(t-10))}var o=x().createBufferSource();return o.buffer=n,o.loop=!0,5!=t&&(o.playbackRate.value=e/(x().sampleRate/1024)),o}var R=[],k=function(){function t(){}return t.prototype.mute=function(){this.generator&&(this.generator.stop(),this.generator.disconnect()),this.gain&&this.gain.disconnect(),this.gain=null,this.generator=null},t.prototype.remove=function(){var t=R.indexOf(this);0<=t&&R.splice(t,1),this.mute()},t}(),S=1;function p(){for(S++;R.length;)R[0].remove()}function d(l){var c=S,p=x(),d=0,h=new k,f=-1,m=-1,g=0;5<R.length&&R[0].remove(),R.push(h);var v=function(t,e){return t/1024/2*(e?.7:1)},b=function(){h.mute(),g=0,m=f=-1},y=function(){if(d>=l.data.length||!l.data[d])return Promise.delay(g).then(b);var t=l.data[d],e=_.BufferMethods.getNumber(l,_.BufferMethods.NumberFormat.UInt16LE,d+2),n=_.BufferMethods.getNumber(l,_.BufferMethods.NumberFormat.UInt16LE,d+4),r=_.BufferMethods.getNumber(l,_.BufferMethods.NumberFormat.UInt16LE,d+6),i=_.BufferMethods.getNumber(l,_.BufferMethods.NumberFormat.UInt16LE,d+8),o=_.BufferMethods.getNumber(l,_.BufferMethods.NumberFormat.UInt16LE,d+10),s=11<=t&&t<=15,a=v(r,s),u=v(i,s);if(!p||c!=S)return Promise.delay(n);if(f!=t||m!=e){if(h.generator)return Promise.delay(g).then(function(){return b(),y()});if(h.generator=w?null:C(t,e),!h.generator)return Promise.delay(n);if(f=t,m=e,h.gain=p.createGain(),h.gain.gain.value=a,o!=e)if(null!=h.generator.frequency)h.generator.frequency.linearRampToValueAtTime(o,p.currentTime+(g+n)/1e3);else if(null!=h.generator.playbackRate){h.generator.playbackRate.linearRampToValueAtTime(o/(x().sampleRate/1024),p.currentTime+(g+n)/1e3)}h.generator.connect(h.gain),h.gain.connect(p.destination),h.generator.start()}return d+=12,h.gain.gain.setValueAtTime(a,p.currentTime+g/1e3),g+=n,h.gain.gain.linearRampToValueAtTime(u,p.currentTime+g/1e3),y()};return y().then(function(){return h.remove()})}function h(t,e){if(!(w||t<=0)){s=t;var n=x();if(n){r&&(r.stop(),r.disconnect(),r=void 0),e=Math.max(0,Math.min(1,e));try{r=n.createOscillator(),i=n.createGain(),r.type="triangle",r.connect(i),i.connect(n.destination),i.gain.value=e,r.start(0)}catch(t){return void(i=r=void 0)}r.frequency.value=t,i.gain.value=e}}}t.muteAllChannels=p,t.queuePlayInstructions=function(t,e){var n=S;Promise.delay(t).then(function(){return n!=S?Promise.resolve():d(e)}).done()},t.playInstructionsAsync=d,t.tone=h,t.playBufferAsync=function(r){return r?new Promise(function(t){function e(){t&&t(),t=void 0}var n="data:audio/wav;base64,"+window.btoa(function(t){for(var e=t.length,n="",r=0;r<e;++r)n+=String.fromCharCode(t[r]);return n}(r.data));o=new Audio(n),w&&(o.volume=0),o.onended=function(){return e()},o.onpause=function(){return e()},o.onerror=function(){return e()},o.play()}):Promise.resolve()},t.sendMidiMessage=function(t){var e=t.data;if(e.length){var n,r=e[0]>>4,i=15&e[0],o=e[1]||0,s=(n=o,440*Math.pow(2,(n-69)/12)),a=e[2]||0;8==r||9==r&&0==a?u():9==r&&(h(s,1),9==i&&setTimeout(function(){return u()},500))}}}(_.AudioContextManager||(_.AudioContextManager={})),_.isTouchEnabled=n,_.hasPointerEvents=r,_.pointerEvents=r()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:n()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"}}(pxsim||(pxsim={})),function(D){!function(e){function o(e,n){return function(t){return t*(n/e)}}function n(t,e){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}e.translateEl=function(t,e){D.svg.hydrate(t,{transform:"translate("+e[0]+" "+e[1]+")"})},e.composeSVG=function(t){var e=[t.el1,t.el2],n=e[0],r=e[1];D.U.assert(0==n.x&&0==n.y&&0==r.x&&0==r.y,"el1 and el2 x,y offsets not supported");var i=function(t,e,n){return D.svg.hydrate(t,{x:e,y:n})},o=function(t,e,n){return D.svg.hydrate(t,{width:e+"px",height:n+"px"})},s=t.scaleUnit2,a=t.scaleUnit2/t.scaleUnit1,u=n.w*a,l=n.h*a;o(n.el,u,l);var c=1*r.w,p=1*r.h;o(r.el,c,p);var d=t.margin,h=d[0],f=d[1],m=d[2],g=d[3],v=t.middleMargin,b=Math.max(u,c),y=f+(b-u)/2,w=h;i(n.el,y,w);var x=f+(b-c)/2,C=w+l+v;i(r.el,x,C);var R,k,S,_=[w,w+l,C,C+p],I=f+b+g,E=h+l+v+p+m,P=D.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+I+" "+E,class:"sim-bb"});R=P,k=t.maxWidth,S=t.maxHeight,k&&D.svg.hydrate(R,{width:k}),S&&D.svg.hydrate(R,{height:S}),i(P,0,0);var B=D.svg.child(P,"g");return P.appendChild(n.el),P.appendChild(r.el),{under:B,over:D.svg.child(P,"g"),host:P,edges:_,scaleUnit:s,toHostCoord1:function(t){var e=t[0],n=t[1];return[e*a+y,n*a+w]},toHostCoord2:function(t){var e=t[0],n=t[1];return[1*e+x,1*n+C]}}},e.mkScaleFn=o,e.mkImageSVG=function(t){var e=o(t.imageUnitDist,t.targetUnitDist),n=e(t.width),r=e(t.height),i=D.svg.elt("image",{width:n,height:r});return i.setAttributeNS("http://www.w3.org/1999/xlink","href",""+t.image),{el:i,w:n,h:r,x:0,y:0}},e.findDistSqrd=n,e.findClosestCoordIdx=function(e,t){return t.map(function(t){return n(e,t)}).reduce(function(t,e,n,r){return e<r[t]?n:t},0)},e.mkTxt=function(t,e,n,r,i,o,s){var a=D.svg.elt("text");s=s||.3;var u=(o=o||-.33333)*n*i.length,l=s*n;return D.svg.hydrate(a,{style:"font-size:"+n+"px;",transform:"translate("+t+" "+e+") rotate("+r+") translate("+u+" "+l+")"}),D.U.addClass(a,"noselect"),a.textContent=i,a},e.GPIO_WIRE_COLORS=["pink","orange","yellow","green","purple"],e.WIRE_COLOR_MAP={black:"#514f4d",white:"#fcfdfc",gray:"#acabab",purple:"#a772a1",blue:"#01a6e8",green:"#3cce73",yellow:"#ece600",orange:"#fdb262",red:"#f44f43",brown:"#c89764",pink:"#ff80fa"},e.mapWireColor=function(t){return e.WIRE_COLOR_MAP[t]||t},e.PIN_DIST=15,e.rgbToHsl=function(t){var e,n,r,i=[t[0]/255,t[1]/255,t[2]/255],o=i[0],s=i[1],a=i[2],u=Math.min(o,s,a),l=Math.max(o,s,a),c=l-u,p=l+u;return r=p/2*100,0===c?n=e=0:(l===o?e=(s-a)/c%6*60:l===s?e=60*((a-o)/c+2):l===a&&(e=60*((o-s)/c+4)),n=50<r?c/(2-p)*100:c/p*100),[Math.floor(e),Math.floor(n),Math.floor(r)]}}(D.visuals||(D.visuals={}))}(pxsim||(pxsim={})),function(a){var s;!function(t){function o(t,e,n){var r={class:t,d:e};n&&(r.title=n);var i=s.elt("path");return s.hydrate(i,r),i}function i(t,e){void 0===e&&(e=!1);var n=s.elt("linearGradient");s.hydrate(n,{id:t,x1:"0%",y1:"0%",x2:e?"100%":"0%",y2:e?"0%":"100%"});s.child(n,"stop",{offset:"0%"}),s.child(n,"stop",{offset:"100%"}),s.child(n,"stop",{offset:"100%"}),s.child(n,"stop",{offset:"100%"});return n}function r(t){var e=s.elt("title");return e.textContent=t,e}t.parseString=function(t){return(new DOMParser).parseFromString(t,"image/svg+xml").getElementsByTagName("svg").item(0)},t.toDataUri=function(t){return"data:image/svg+xml,"+encodeURI(t)},t.cursorPoint=function(t,e,n){return t.x=null!=n.clientX?n.clientX:n.pageX,t.y=null!=n.clientY?n.clientY:n.pageY,t.matrixTransform(e.getScreenCTM().inverse())},t.rotateElement=function(t,e,n,r){t.setAttribute("transform","translate("+e+","+n+") rotate("+(r+90)+") translate("+-e+","+-n+")")},t.hydrate=function(t,e){for(var n in e)"title"==n?s.title(t,e[n]):t.setAttributeNS(null,n,e[n])},t.elt=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&s.hydrate(n,e),n},t.child=function(t,e,n){var r=s.elt(e,n);return t.appendChild(r),r},t.mkPath=o,t.path=function(t,e,n,r){var i=o(e,n,r);return t.appendChild(i),i},t.fill=function(t,e){t.style.fill=e},t.filter=function(t,e){t.style.filter=e},t.fills=function(t,e){t.forEach(function(t){return t.style.fill=e})},t.isTouchEnabled=function(){return"undefined"!=typeof window&&("ontouchstart"in window||0<navigator.maxTouchPoints)},t.onClick=function(e,n){var r=!1;a.pointerEvents.down.forEach(function(t){return e.addEventListener(t,function(t){return r=!0},!1)}),e.addEventListener(a.pointerEvents.up,function(t){return!r||(r=!1,n(t),t.preventDefault(),!1)},!1)},t.buttonEvents=function(e,n,r,i,o){var s=!1;a.pointerEvents.down.forEach(function(t){return e.addEventListener(t,function(t){return s=!0,r&&r(t),!0},!1)}),e.addEventListener(a.pointerEvents.move,function(t){return!s||(n&&n(t),t.preventDefault(),!1)},!1),e.addEventListener(a.pointerEvents.up,function(t){s=!1,i&&i(t)},!1),e.addEventListener(a.pointerEvents.leave,function(t){s=!1,i&&i(t)},!1),e.addEventListener("keydown",function(t){s=!1,o&&o(t)})},t.mkLinearGradient=i,t.linearGradient=function(t,e,n){void 0===n&&(n=!1);var r=i(e,n);return t.appendChild(r),r},t.setGradientColors=function(t,e,n){t&&(t.childNodes[0].style.stopColor=e,t.childNodes[1].style.stopColor=e,t.childNodes[2].style.stopColor=n,t.childNodes[3].style.stopColor=n)},t.setGradientValue=function(t,e){t.childNodes[1].getAttribute("offset")!=e&&(t.childNodes[1].setAttribute("offset",e),t.childNodes[2].setAttribute("offset",e))},t.animate=function(t,e){a.U.addClass(t,e);var n=t.parentElement;n&&(n.removeChild(t),n.appendChild(t))},t.mkTitle=r,t.title=function(t,e){var n=r(e);return t.appendChild(n),n},t.toHtmlColor=function(t){return"rgba("+(t>>16&255)+", "+(t>>8&255)+", "+(255&t)+", "+(t>>24&1)+")"}}(s=a.svg||(a.svg={}))}(pxsim||(pxsim={})),function(t){var e=function(t){this.id=t};t.Button=e;var n=function(t){this.props=t,this.usesButtonAB=!1,this.aBtn=new e(this.props.ID_BUTTON_A),this.bBtn=new e(this.props.ID_BUTTON_B),this.abBtn=new e(this.props.ID_BUTTON_AB),this.abBtn.virtual=!0};t.ButtonPairState=n}(pxsim||(pxsim={})),function(t){var e=function(){this.usesHeading=!1,this.heading=90};(pxsim||(pxsim={})).CompassState=e}(),function(t){var e=function(){function t(){this.files={}}return t.prototype.append=function(t,e){this.files[t]=(this.files[t]||"")+e},t.prototype.remove=function(t){delete this.files[t]},t}();t.FileSystemState=e}(pxsim||(pxsim={})),function(t){var e=function(){this.usesLightLevel=!1,this.lightLevel=128};(pxsim||(pxsim={})).LightSensorState=e}(),function(t){var p,e;(e=p=t.NeoPixelMode||(t.NeoPixelMode={}))[e.RGB=0]="RGB",e[e.RGBW=1]="RGBW";var n=function(){function t(){this.buffers={},this.colors={},this.dirty={}}return t.prototype.updateBuffer=function(t,e){this.buffers[e]=t,this.dirty[e]=!0},t.prototype.getColors=function(t,e){var n=this.colors[t]||(this.colors[t]=[]);if(this.dirty[t]){var r=this.buffers[t]||(this.buffers[t]=new Uint8Array([]));this.readNeoPixelBuffer(r,n,e),this.dirty[t]=!1}return n},t.prototype.readNeoPixelBuffer=function(t,e,n){for(var r=t,i=n===p.RGBW?4:3,o=Math.floor(r.length/i),s=0;s<o;s++){var a=r[s*i+1],u=r[s*i+0],l=r[s*i+2],c=0;4===i&&(c=r[s*i+3]),e[s]=[a,u,l,c]}},t}();t.NeoPixelState=n}(pxsim||(pxsim={})),function(h){!function(d){d.mkBoardView=function(t){var e=t.visual;return new d.GenericBoardSvg({visualDef:e,boardDef:t.boardDef,wireframe:t.wireframe})};var t=function(){function t(t,e){var n=this;this.parts=[],this.boardView=t,(this.opts=e).boardDef.pinStyles||(e.boardDef.pinStyles={}),this.state=e.state;var r=e.partsList,i=0<r.length||e.forceBreadboardLayout;if(i){this.breadboard=new d.Breadboard({wireframe:e.wireframe});var o=e.boardDef.marginWhenBreadboarding||[0,0,40,0],s=d.composeSVG({el1:this.boardView.getView(),scaleUnit1:this.boardView.getPinDist(),el2:this.breadboard.getSVGAndSize(),scaleUnit2:this.breadboard.getPinDist(),margin:[o[0],o[1],20,o[3]],middleMargin:o[2],maxWidth:e.maxWidth,maxHeight:e.maxHeight}),a=s.under,u=s.over;this.view=s.host;var l=s.edges;this.fromMBCoord=s.toHostCoord1,this.fromBBCoord=s.toHostCoord2,this.partGroup=u,this.partOverGroup=h.svg.child(this.view,"g"),this.style=h.svg.child(this.view,"style",{}),this.defs=h.svg.child(this.view,"defs",{}),this.wireFactory=new d.WireFactory(a,u,l,this.style,this.getLocCoord.bind(this),this.getPinStyle.bind(this));var c=h.allocateDefinitions({boardDef:e.boardDef,partDefs:e.partDefs,fnArgs:e.fnArgs,getBBCoord:this.breadboard.getCoord.bind(this.breadboard),partsList:r});c.partsAndWires.length||e.forceBreadboardLayout?(this.addAll(c),c.requiresBreadboard||e.forceBreadboardRender?c.hideBreadboard&&this.breadboard&&this.breadboard.hide():i=!1):i=!1}if(!i){delete this.breadboard,delete this.wireFactory,delete this.partOverGroup,delete this.partGroup,delete this.style,delete this.defs,delete this.fromBBCoord,delete this.fromMBCoord;var p=this.boardView.getView().el;this.view=p,this.partGroup=h.svg.child(this.view,"g"),this.partOverGroup=h.svg.child(this.view,"g"),e.maxWidth&&h.svg.hydrate(this.view,{width:e.maxWidth}),e.maxHeight&&h.svg.hydrate(this.view,{height:e.maxHeight})}this.state.updateSubscribers.push(function(){return n.updateState()})}return t.prototype.highlightBoardPin=function(t){this.boardView.highlightPin(t)},t.prototype.highlightBreadboardPin=function(t){this.breadboard.highlightLoc(t)},t.prototype.highlightWire=function(t){t.wires.forEach(function(t){h.U.addClass(t,"highlight"),t.style.visibility="visible"}),h.U.addClass(t.endG,"highlight")},t.prototype.getView=function(){return this.view},t.prototype.screenshotAsync=function(i){var t=this.view.cloneNode(!0);t.setAttribute("width",this.view.width.baseVal.value+""),t.setAttribute("height",this.view.height.baseVal.value+"");var e=(new XMLSerializer).serializeToString(t),o="data:image/svg+xml,"+encodeURIComponent(e.replace(/\s+/g," ").replace(/"/g,"'"));return new Promise(function(n,t){var r=document.createElement("img");r.onload=function(){var t=document.createElement("canvas");t.width=r.width,t.height=r.height,0<i?(t.width=i,t.height=r.height*i/r.width|0):t.width<200?(t.width*=2,t.height*=2):480<t.width&&(t.width/=2,t.height/=2);var e=t.getContext("2d");e.drawImage(r,0,0,t.width,t.height),n(e.getImageData(0,0,t.width,t.height))},r.onerror=function(t){console.log(t),n(void 0)},r.src=o})},t.prototype.updateState=function(){this.parts.forEach(function(t){return t.updateState()})},t.prototype.getBBCoord=function(t){var e=this.breadboard.getCoord(t);return this.fromBBCoord(e)},t.prototype.getPinCoord=function(t){var e=this.boardView.getCoord(t);if(e)return this.fromMBCoord(e);console.error("Unable to find coord for pin: "+t)},t.prototype.getLocCoord=function(t){var e;if("breadboard"===t.type){var n=t;e=this.getBBCoord(n)}else{var r=t.pin;e=this.getPinCoord(r)}return e||console.debug("Unknown location: "+name),e},t.prototype.getPinStyle=function(t){return"breadboard"==t.type?"female":this.opts.boardDef.pinStyles[t.pin]||"female"},t.prototype.addPart=function(t){var e=this,n=null;if(t.simulationBehavior){var r=t.simulationBehavior,i=this.state.builtinVisuals[r],o=this.state.builtinParts[r];(n=i()).init(this.state.bus,o,this.view,t.params)}else{var s=t.visual;n=new d.GenericPart(s)}this.parts.push(n),this.partGroup.appendChild(n.element),n.overElement&&this.partOverGroup.appendChild(n.overElement),n.defs&&n.defs.forEach(function(t){return e.defs.appendChild(t)}),this.style.textContent+=n.style||"";var a=t.startColumnIdx,u=t.startRowIdx,l={type:"breadboard",row:d.getRowName(u),col:d.getColumnName(a),xOffset:t.bbFit.xOffset/t.visual.pinDistance,yOffset:t.bbFit.yOffset/t.visual.pinDistance},c=this.getBBCoord(l);n.moveToCoord(c);var p="sim-"+t.name+"-cmp";return h.U.addClass(n.element,p),h.U.addClass(n.element,"sim-cmp"),n.updateTheme(),n.updateState(),n},t.prototype.addWire=function(t){return this.wireFactory.addWire(t.start,t.end,t.color)},t.prototype.addAll=function(i){var o=this;i.partsAndWires.forEach(function(t){var e=t.wires,n=e&&e.every(function(t){return o.wireFactory.checkWire(t.start,t.end)});n&&e.forEach(function(t){return i.wires.push(o.addWire(t))});var r=t.part;!r||e&&!n||i.parts.push(o.addPart(r))}),i.requiresBreadboard=!!i.wires.length||!!i.parts.length},t}();d.BoardHost=t}(h.visuals||(h.visuals={}))}(pxsim||(pxsim={})),function(Z){!function(B){B.BREADBOARD_MID_ROWS=10,B.BREADBOARD_MID_COLS=30;var D=[4,4],t=B.BREADBOARD_MID_ROWS+D.length,A=[4,9,14,19],e=25+A.length,T=15*(B.BREADBOARD_MID_COLS+3),F=15*(t+4+5.5),M=F*(2/3),L=F*(.5*(1-2/3)),n=15*(B.BREADBOARD_MID_COLS-1),O=(T-n)/2,U=L+(M-15*(t-1))/2,N=15*(e-1),V=(T-N)/2,q=(L-15)/2,W=V,G=q+L+M,r=1.3,i=6,o=2,l=1.3,j=-90,s="abcdefghij".split("").reverse();function z(t){return""+(t+1)}function H(t){return s[t]}function K(f){for(var m=f.xOffset||0,r=f.yOffset||0,g=[],v=Z.svg.elt("g"),b=f.colStartIdx||0,i=f.rowStartIdx||0,o=function(t){return t?t.slice(0,t.length):[]},y=function(t,e){for(var n,r=0;0<=(n=t.indexOf(e));)t.splice(n,1),r+=1;return r},s=0,a=o(f.rowIdxsWithGap),t=function(t){for(var c=0,p=o(f.colIdxsWithGap),d=r+t*f.pinDist+s*f.pinDist,h=t+i,e=function(t){var e=m+t*f.pinDist+c*f.pinDist,n=t+b,r=function(t){return Z.svg.hydrate(t.el,"circle"==t.el.tagName?{cx:e,cy:d}:{x:e-.5*t.w,y:d-.5*t.h}),v.appendChild(t.el),t.el},i=r(f.mkPin()),o=r(f.mkHoverPin()),s=f.getRowName(h),a=f.getColName(n),u=f.getGroupName?f.getGroupName(h,n):null,l={el:i,hoverEl:o,cx:e,cy:d,row:s,col:a,group:u};g.push(l),c+=y(p,n)},n=0;n<f.colCount;n++)e(n);s+=y(a,h)},e=0;e<f.rowCount;e++)t(e);return{g:v,allPins:g}}function Y(){var t=Z.svg.elt("rect"),e=i;return Z.svg.hydrate(t,{class:"sim-bb-pin",rx:o,ry:o,width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}}function J(){var t=Z.svg.elt("rect"),e=i*r;return Z.svg.hydrate(t,{class:"sim-bb-pin-hover",rx:o,ry:o,width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}}function Q(t,e,n,r,i,o,s){var a=B.mkTxt(t,e,n,r,i);Z.U.addClass(a,"sim-bb-label"),s&&s.forEach(function(t){return Z.U.addClass(a,t)});var u=B.mkTxt(t,e,n*l,r,i);return Z.U.addClass(u,"sim-bb-label-hover"),s&&s.forEach(function(t){return Z.U.addClass(u,t)}),{el:a,hoverEl:u,txt:i,group:o}}B.getColumnName=z,B.getRowName=H,B.mkGrid=K;var a=function(){function t(t){this.allPins=[],this.allLabels=[],this.allPowerBars=[],this.rowColToPin={},this.rowColToLbls={},this.buildDom(),t.wireframe&&Z.U.addClass(this.bb,"sim-bb-outline")}return t.prototype.hide=function(){this.bb.style.display="none"},t.prototype.updateLocation=function(t,e){Z.svg.hydrate(this.bb,{x:t+"px",y:e+"px"})},t.prototype.getPin=function(t,e){var n=this.rowColToPin[t];if(!n)return null;var r=n[e];return r||null},t.prototype.getCoord=function(t){var e=t.row,n=t.col,r=t.xOffset,i=t.yOffset,o=this.getPin(e,n);if(!o)return null;var s=15*(r||0),a=15*(i||0);return[o.cx+s,o.cy+a]},t.prototype.getPinDist=function(){return 15},t.prototype.buildDom=function(){var a=this;this.bb=Z.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+T+" "+F,class:"sim-bb",width:T+"px",height:F+"px"}),this.styleEl=Z.svg.child(this.bb,"style",{}),this.styleEl.textContent+='\n        /* bread board */\n        .sim-bb-background {\n            fill:#E0E0E0;\n        }\n        .sim-bb-pin {\n            fill:#999;\n        }\n        .sim-bb-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width: 7.5px;\n            stroke: transparent;\n            fill: #777;\n        }\n        .sim-bb-pin-hover:hover {\n            visibility: visible;\n            fill:#444;\n        }\n        .sim-bb-group-wire {\n            stroke: #999;\n            stroke-width: 3.75px;\n            visibility: hidden;\n        }\n        .sim-bb-pin-group {\n            pointer-events: all;\n        }\n        .sim-bb-label,\n        .sim-bb-label-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            fill:#555;\n            pointer-events: all;\n            stroke-width: 0;\n            cursor: default;\n        }\n        .sim-bb-label-hover {\n            visibility: hidden;\n            fill:#000;\n            font-weight: bold;\n        }\n        .sim-bb-bar {\n            stroke-width: 0;\n        }\n        .sim-bb-blue {\n            fill:#1AA5D7;\n            stroke:#1AA5D7\n        }\n        .sim-bb-red {\n            fill:#DD4BA0;\n            stroke:#DD4BA0;\n        }\n        .sim-bb-pin-group:hover .sim-bb-pin-hover,\n        .sim-bb-pin-group:hover .sim-bb-group-wire,\n        .sim-bb-pin-group:hover .sim-bb-label-hover {\n            visibility: visible;\n        }\n        .sim-bb-pin-group:hover .sim-bb-label {\n            visibility: hidden;\n        }\n        /* outline mode */\n        .sim-bb-outline .sim-bb-background {\n            stroke-width: 2.142857142857143px;\n            fill: #FFF;\n            stroke: #000;\n        }\n        .sim-bb-outline .sim-bb-mid-channel {\n            fill: #FFF;\n            stroke: #888;\n            stroke-width: 2px;\n        }\n        /* grayed out */\n        .grayed .sim-bb-background {\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-red,\n        .grayed .sim-bb-blue {\n            fill: #BBB;\n        }\n        .grayed .sim-bb-bar {\n            fill: #FFF;\n        }\n        .grayed .sim-bb-pin {\n            fill: #000;\n            stroke: #FFF;\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-label {\n            fill: none;\n        }\n        .grayed .sim-bb-background {\n            stroke-width: 7.5px;\n            stroke: #555;\n        }\n        .grayed .sim-bb-group-wire {\n            stroke: #DDD;\n        }\n        .grayed .sim-bb-channel {\n            visibility: hidden;\n        }\n        /* highlighted */\n        .sim-bb-label.highlight {\n            visibility: hidden;\n        }\n        .sim-bb-label-hover.highlight {\n            visibility: visible;\n        }\n        .sim-bb-blue.highlight {\n            fill:#1AA5D7;\n        }\n        .sim-bb-red.highlight {\n            fill:#DD4BA0;\n        }\n        .sim-bb-bar.highlight {\n            stroke-width: 0px;\n        }\n        ',this.defs=Z.svg.child(this.bb,"defs",{}),Z.svg.child(this.bb,"rect",{class:"sim-bb-background",width:T,height:F,rx:4.5,ry:4.5});var i="sim-bb-channel-grad",t=Z.svg.elt("linearGradient");Z.svg.hydrate(t,{id:i,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),this.defs.appendChild(t);Z.svg.child(t,"stop",{offset:"0%",style:"stop-color: #AAA;"}),Z.svg.child(t,"stop",{offset:"20%",style:"stop-color: #CCC;"}),Z.svg.child(t,"stop",{offset:"80%",style:"stop-color: #CCC;"}),Z.svg.child(t,"stop",{offset:"100%",style:"stop-color: #AAA;"});var e=function(t,e,n){var r=Z.svg.child(a.bb,"rect",{class:"sim-bb-channel "+(n||""),y:t-e/2,width:T,height:e});return r.setAttribute("fill","url(#"+i+")"),r};e(L+M/2,15,"sim-bb-mid-channel"),e(L,.75,"sim-bb-sml-channel"),e(L+M,.75,"sim-bb-sml-channel");var n=function(t,e){return""+(t<B.BREADBOARD_MID_ROWS/2?"b":"t")+z(e)},r=function(t){return 0===t?"-":"+"},o=function(t,e){var n=e<25?"b":"t";return""+r(t)+n},s=K({xOffset:O,yOffset:U,rowCount:B.BREADBOARD_MID_ROWS,colCount:B.BREADBOARD_MID_COLS,pinDist:15,mkPin:Y,mkHoverPin:J,getRowName:H,getColName:z,getGroupName:n,rowIdxsWithGap:D});s.g;this.allPins=this.allPins.concat(s.allPins);var u=K({xOffset:W,yOffset:G,rowCount:2,colCount:25,pinDist:15,mkPin:Y,mkHoverPin:J,getRowName:r,getColName:z,getGroupName:o,colIdxsWithGap:A});u.g;this.allPins=this.allPins.concat(u.allPins);var l=K({xOffset:V,yOffset:q,rowCount:2,colCount:25,colStartIdx:25,pinDist:15,mkPin:Y,mkHoverPin:J,getRowName:r,getColName:z,getGroupName:o,colIdxsWithGap:A.map(function(t){return t+25})});l.g;this.allPins=this.allPins.concat(l.allPins),this.allPins.forEach(function(t){var e=t.el,n=t.row,r=t.col,i=t.hoverEl,o="("+n+","+r+")";Z.svg.hydrate(e,{title:o}),Z.svg.hydrate(i,{title:o})}),this.allPins.forEach(function(t){var e=a.rowColToPin[t.row];e||(e=a.rowColToPin[t.row]={}),e[t.col]=t});for(var c=function(t,e,n,r,i,o){var s=a.getCoord({type:"breadboard",row:t,col:e});return Q(s[0]+n,s[1]+r,10.5,-90,i,o)},p=0;p<B.BREADBOARD_MID_COLS;p++){var d=z(p),h=c(H(0),d,0,-15,d,n(0,p));this.allLabels.push(h);var f=B.BREADBOARD_MID_ROWS-1,m=c(H(f),d,0,15,d,n(f,p));this.allLabels.push(m)}for(var g=0;g<B.BREADBOARD_MID_ROWS;g++){var v=H(g);h=c(v,z(0),-15,0,v);this.allLabels.push(h);m=c(v,z(B.BREADBOARD_MID_COLS-1),15,0,v);this.allLabels.push(m)}var b=[Q(13.05,L+M+12,30,j,"-",o(0,0),["sim-bb-blue"]),Q(12,L+M+L-12,25.5,j,"+",o(1,0),["sim-bb-red"]),Q(T-12+1.05,L+M+12,30,j,"-",o(0,24),["sim-bb-blue"]),Q(T-12,L+M+L-12,25.5,j,"+",o(1,24),["sim-bb-red"])];this.allLabels=this.allLabels.concat(b);var y=[Q(13.05,12,30,j,"-",o(0,25),["sim-bb-blue"]),Q(12,L-12,25.5,j,"+",o(1,25),["sim-bb-red"]),Q(T-12+1.05,12,30,j,"-",o(0,49),["sim-bb-blue"]),Q(T-12,L-12,25.5,j,"+",o(1,49),["sim-bb-red"])];this.allLabels=this.allLabels.concat(y);var w={};this.allLabels.forEach(function(t){t.el;var e=t.txt;(w[e]=w[e]||[]).push(t)});this.allPins.forEach(function(e){var t,n=e.row,r=e.col,i=(e.group,a.rowColToLbls[n]||(a.rowColToLbls[n]={})),o=i[r]||(i[r]=[]);"-"===(t=e).row||"+"===t.row?Number(r)<=25?b.filter(function(t){return t.group==e.group}).forEach(function(t){return o.push(t)}):y.filter(function(t){return t.group==e.group}).forEach(function(t){return o.push(t)}):(w[n].forEach(function(t){return o.push(t)}),w[r].forEach(function(t){return o.push(t)}))});var x=N+22.5,C=(x-N)/2,R=function(t,e,n,r){var i=Z.svg.elt("rect");return Z.svg.hydrate(i,{class:"sim-bb-bar "+r,x:t,y:e-1.5,width:x,height:3}),{el:i,group:n}},k=[R(W-C,G-9,o(0,49),"sim-bb-blue"),R(W-C,G+15+9,o(1,49),"sim-bb-red"),R(V-C,q-9,o(0,0),"sim-bb-blue"),R(V-C,q+15+9,o(1,0),"sim-bb-red")];this.allPowerBars=this.allPowerBars.concat(k),this.allPowerBars.forEach(function(t){return a.bb.appendChild(t.el)});var S=this.allPins.map(function(t){return t.group}).filter(function(t,e,n){return n.indexOf(t)==e}),_=S.map(function(t){return Z.svg.elt("g")});_.forEach(function(t){return Z.U.addClass(t,"sim-bb-pin-group")}),_.forEach(function(t,e){return Z.U.addClass(t,"group-"+S[e])});var I={};S.forEach(function(t,e){return I[t]=_[e]});var E={};this.allPins.forEach(function(t,e){var n=t.group;(E[n]||(E[n]=[])).push(t)}),S.forEach(function(t){var e=E[t],n=[e.map(function(t){return t.cx}),e.map(function(t){return t.cy})],r=n[0],i=n[1],o=function(t){return t.reduce(function(t,e){return t<e?t:e})},s=function(t){return t.reduce(function(t,e){return e<t?t:e})},a=[o(r),s(r),o(i),s(i)],u=a[0],l=a[1],c=a[2],p=a[3],d=Z.svg.elt("rect"),h=Math.max(l-u,1e-4),f=Math.max(p-c,1e-4);Z.svg.hydrate(d,{x:u,y:c,width:h,height:f}),Z.U.addClass(d,"sim-bb-group-wire"),I[t].appendChild(d)}),this.allPins.forEach(function(t){var e=I[t.group];e.appendChild(t.el),e.appendChild(t.hoverEl)});var P=Z.svg.elt("g");Z.svg.hydrate(P,{class:"sim-bb-group-misc"}),_.push(P),this.allLabels.forEach(function(t){if(t.group){var e=I[t.group];e.appendChild(t.el),e.appendChild(t.hoverEl)}else P.appendChild(t.el),P.appendChild(t.hoverEl)}),_.forEach(function(t){return a.bb.appendChild(t)})},t.prototype.getSVGAndSize=function(){return{el:this.bb,y:0,x:0,w:T,h:F}},t.prototype.highlightLoc=function(t){var e=t.row,n=t.col,r=this.rowColToPin[e][n];r.cx,r.cy;this.rowColToLbls[e][n].forEach(function(t){Z.U.addClass(t.el,"highlight"),Z.U.addClass(t.hoverEl,"highlight")})},t}();B.Breadboard=a}(Z.visuals||(Z.visuals={}))}(pxsim||(pxsim={})),function(w){!function(f){f.BOARD_SYTLE="\n        .noselect {\n            -webkit-touch-callout: none; /* iOS Safari */\n            -webkit-user-select: none;   /* Chrome/Safari/Opera */\n            -khtml-user-select: none;    /* Konqueror */\n            -moz-user-select: none;      /* Firefox */\n            -ms-user-select: none;       /* Internet Explorer/Microsoft Edge */\n            user-select: none;           /* Non-prefixed version, currently\n                                            not supported by any browser */\n        }\n\n        .sim-board-pin {\n            fill:#999;\n            stroke:#000;\n            stroke-width:"+f.PIN_DIST/3+"px;\n        }\n        .sim-board-pin-lbl {\n            fill: #333;\n        }\n        .gray-cover {\n            fill:#FFF;\n            opacity: 0.3;\n            stroke-width:0;\n            visibility: hidden;\n        }\n        .sim-board-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width:"+f.PIN_DIST/6+'px;\n        }\n        .sim-board-pin-hover:hover {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-lbl {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            fill: #555;\n        }\n        .sim-board-pin-lbl-hover {\n            fill: red;\n        }\n        .sim-board-outline .sim-board-pin-lbl-hover {\n            fill: black;\n        }\n        .sim-board-pin-lbl,\n        .sim-board-pin-lbl-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            pointer-events: all;\n            stroke-width: 0;\n        }\n        .sim-board-pin-lbl-hover {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + .sim-board-pin-lbl,\n        .sim-board-pin-lbl.highlight {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + * + .sim-board-pin-lbl-hover,\n        .sim-board-pin-lbl-hover.highlight {\n            visibility: visible;\n        }\n        /* Graying out */\n        .grayed .sim-board-pin-lbl:not(.highlight) {\n            fill: #AAA;\n        }\n        .grayed .sim-board-pin:not(.highlight) {\n            fill:#BBB;\n            stroke:#777;\n        }\n        .grayed .gray-cover {\n            visibility: inherit;\n        }\n        .grayed .sim-cmp:not(.notgrayed) {\n            opacity: 0.3;\n        }\n        /* Highlighting */\n        .sim-board-pin-lbl.highlight {\n            fill: #000;\n            font-weight: bold;\n        }\n        .sim-board-pin.highlight {\n            fill:#999;\n            stroke:#000;\n        }\n        ';var m=.7*f.PIN_DIST,g=1.5*m,v=.66666*f.PIN_DIST,b=.66666*f.PIN_DIST+f.PIN_DIST/3,y=0,t=function(){function t(t){var r=this;this.props=t,this.allPins=[],this.allLabels=[],this.pinNmToLbl={},this.pinNmToPin={},this.id=y++;var s=t.visualDef,e=t.wireframe&&s.outlineImage?s.outlineImage:s.image,n=f.mkImageSVG({image:e,width:s.width,height:s.height,imageUnitDist:s.pinDist,targetUnitDist:f.PIN_DIST}),a=f.mkScaleFn(s.pinDist,f.PIN_DIST);this.width=n.w,this.height=n.h;var i=n.el;this.element=w.svg.elt("svg"),w.svg.hydrate(this.element,{version:"1.0",viewBox:"0 0 "+this.width+" "+this.height,class:"sim sim-board-id-"+this.id,x:"0px",y:"0px"}),t.wireframe&&w.U.addClass(this.element,"sim-board-outline"),this.style=w.svg.child(this.element,"style",{}),this.style.textContent+=f.BOARD_SYTLE,this.defs=w.svg.child(this.element,"defs",{}),this.g=w.svg.elt("g"),this.element.appendChild(this.g),this.g.appendChild(i),this.background=i,w.svg.hydrate(i,{class:"sim-board"});var u=function(){var t=w.svg.elt("circle"),e=v;return w.svg.hydrate(t,{class:"sim-board-pin",r:e/2}),{el:t,w:e,h:e,x:0,y:0}},l=function(){var t=w.svg.elt("circle"),e=b;return w.svg.hydrate(t,{class:"sim-board-pin-hover",r:e/2}),{el:t,w:e,h:e,x:0,y:0}},c=function(){var t=w.svg.elt("rect"),e=v;return w.svg.hydrate(t,{class:"sim-board-pin",width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}},p=function(){var t=w.svg.elt("rect"),e=b;return w.svg.hydrate(t,{class:"sim-board-pin-hover",width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}},o=s.pinBlocks.map(function(e,t){var n=a(e.x)+f.PIN_DIST/2,r=a(e.y)+f.PIN_DIST/2,i=e.labels.length,o=f.mkGrid({xOffset:n,yOffset:r,rowCount:1,colCount:i,pinDist:f.PIN_DIST,mkPin:s.useCrocClips?u:c,mkHoverPin:s.useCrocClips?l:p,getRowName:function(){return""+(t+1)},getColName:function(t){return e.labels[t]},getGroupName:function(){return e.labels.join(" ")}});o.allPins,o.g;return w.U.addClass(o.g,"sim-board-pin-group"),o}),d=[];o.forEach(function(t,n){return t.allPins.forEach(function(t,e){r.allPins.push(t),d.push(s.pinBlocks[n])})}),this.allPins.forEach(function(t){var e=t.col;w.svg.hydrate(t.el,{title:e}),w.svg.hydrate(t.hoverEl,{title:e})}),this.allPins.forEach(function(t){r.pinNmToPin[t.col]=t});var h=function(t,e,n,r,i){var o,s;"below"===i?(s=t,o=e+12+.25*n*r.length):(s=t,o=e-11-.32*n*r.length);return f.mkTxt(s,o,n,-90,r)};this.allLabels=this.allPins.map(function(t,e){var n=d[e];return function(t,e,n,r){var i=h(t,e,m,n,r);w.U.addClass(i,"sim-board-pin-lbl");var o=h(t,e,g,n,r);return w.U.addClass(o,"sim-board-pin-lbl-hover"),{el:i,hoverEl:o,txt:n}}(t.cx,t.cy,t.col,n.labelPosition||"above")}),this.allPins.forEach(function(t,e){var n=r.allLabels[e];r.pinNmToLbl[t.col]=n}),this.allPins.forEach(function(t,e){var n=r.allLabels[e];r.g.appendChild(t.el),r.g.appendChild(t.hoverEl),r.g.appendChild(n.el),r.g.appendChild(n.hoverEl)})}return t.prototype.findPin=function(t){var e=this.pinNmToPin[t];return!e&&this.props.boardDef.gpioPinMap&&(t=this.props.boardDef.gpioPinMap[t])&&(e=this.pinNmToPin[t]),e},t.prototype.findPinLabel=function(t){var e=this.pinNmToLbl[t];return!e&&this.props.boardDef.gpioPinMap&&(t=this.props.boardDef.gpioPinMap[t])&&(e=this.pinNmToLbl[t]),e},t.prototype.getCoord=function(t){var e=this.findPin(t);return e?[e.cx,e.cy]:null},t.prototype.mkGrayCover=function(t,e,n,r){var i=w.svg.elt("rect");return w.svg.hydrate(i,{x:t,y:e,width:n,height:r,class:"gray-cover"}),i},t.prototype.getView=function(){return{el:this.element,w:this.width,h:this.height,x:0,y:0}},t.prototype.getPinDist=function(){return f.PIN_DIST},t.prototype.highlightPin=function(t){var e=this.findPinLabel(t),n=this.findPin(t);e&&n&&(w.U.addClass(e.el,"highlight"),w.U.addClass(e.hoverEl,"highlight"),w.U.addClass(n.el,"highlight"),w.U.addClass(n.hoverEl,"highlight"))},t}();f.GenericBoardSvg=t}(w.visuals||(w.visuals={}))}(pxsim||(pxsim={})),function(r){!function(e){function n(t){return e.mkImageSVG({image:t.image,width:t.width,height:t.height,imageUnitDist:t.pinDistance,targetUnitDist:e.PIN_DIST})}e.mkGenericPartSVG=n;var t=function(){function t(t){this.style="",this.defs=[];var e=n(t).el;this.element=r.svg.elt("g"),this.element.appendChild(e)}return t.prototype.moveToCoord=function(t){e.translateEl(this.element,t)},t.prototype.init=function(t,e,n){},t.prototype.updateState=function(){},t.prototype.updateTheme=function(){},t}();e.GenericPart=t}(r.visuals||(r.visuals={}))}(pxsim||(pxsim={})),function(L){!function(B){var t,a=B.PIN_DIST/2.5,_=15,I=100;function D(t){return t.replace(/\#/g,"-").replace(/\(/g,"-").replace(/\)/g,"-").replace(/\,/g,"-").replace(/\./g,"-").replace(/\s/g,"")}function A(t,e,n,r){var i=function(t){return t[0]+", "+t[1]},o=t[0],s=t[1],a=e[0],u=e[1],l=u-s,c=[o,s+l*n],p=[a,u-l*n],d=L.svg.mkPath("sim-bb-wire","M"+i(t)+" C"+i(c)+" "+i(p)+" "+i(e));return L.U.addClass(d,"wire-stroke-"+r),d}function T(t,e,n){var r=function(t){return t[0]+", "+t[1]},i=L.svg.mkPath("sim-bb-wire","M"+r(t)+" L"+r(e));return L.U.addClass(i,"wire-stroke-"+n),i}function F(t,e){var n=B.PIN_DIST/4,r=L.svg.elt("circle"),i=t[0],o=t[1],s=a/2+n/2;return L.svg.hydrate(r,{cx:i,cy:o,r:s,class:"sim-bb-wire-end"}),L.U.addClass(r,"wire-fill-"+e),r.style["stroke-width"]=n+"px",r}function E(t,e,n){var r=.24*B.PIN_DIST,i=10*r,o=2*r,s=6*r,a=r,u=B.PIN_DIST/4,l=t[0],c=t[1],p=e?-1:1,d=L.svg.elt("g"),h=L.svg.elt("rect"),f=i,m=o,g=l-m/2,v=c-f/2;L.svg.hydrate(h,{x:g,y:v,width:m,height:f,rx:.5,ry:.5,class:"sim-bb-wire-end"}),h.style["stroke-width"]=u+"px";var b=L.svg.elt("rect"),y=s,w=a,x=l-w/2,C=c+p*(f/2+y/2)-y/2;return L.svg.hydrate(b,{x:x,y:C,width:w,height:y,class:"sim-bb-wire-bare-end"}),b.style.fill="#bbb",d.appendChild(b),d.appendChild(h),{el:d,x:g-u,y:Math.min(v,C),w:m+2*u,h:f+y}}function M(t,e,n){var r=.24*B.PIN_DIST,i=4*r,o=10*r,s=3.5*r,a=3.5*r,u=B.PIN_DIST/4,l=t[0],c=t[1],p=e?-1:1,d=L.svg.elt("g"),h=L.svg.elt("polygon"),f=o,m=i,g=l-m/2,v=c-f/2,b=e?.15:.3,y=e?.7:1-.7,w=e?.3:.15;L.svg.hydrate(h,{points:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.map(function(t){return(e=t)[0]+","+e[1];var e}).join(" ")}([g+m*b,v],[g+m*(1-b),v],[g+m,v+f*y],[g+m*(1-w),v+f],[g+m*w,v+f],[g,v+f*y])}),L.svg.hydrate(h,{rx:.5,ry:.5,class:"sim-bb-wire-end"}),h.style["stroke-width"]=u+"px";var x=L.svg.elt("rect"),C=s,R=a,k=l-R/2,S=c+p*(f/2+C/2)-C/2;return L.svg.hydrate(x,{x:k,y:S,width:R,height:C,class:"sim-bb-wire-bare-end"}),d.appendChild(x),d.appendChild(h),{el:d,x:g-u,y:Math.min(v,S),w:m+2*u,h:f+C}}B.WIRES_CSS="\n        .sim-bb-wire {\n            fill:none;\n            stroke-linecap: round;\n            stroke-width:"+a+"px;\n            pointer-events: none;\n        }\n        .sim-bb-wire-end {\n            stroke:#333;\n            fill:#333;\n        }\n        .sim-bb-wire-bare-end {\n            fill: #ccc;\n        }\n        .sim-bb-wire-hover {\n            stroke-width: "+a+"px;\n            visibility: hidden;\n            stroke-dasharray: "+B.PIN_DIST/10+","+B.PIN_DIST/1.5+";\n            /*stroke-opacity: 0.4;*/\n        }\n        .grayed .sim-bb-wire-ends-g:not(.highlight) .sim-bb-wire-end {\n            stroke: #777;\n            fill: #777;\n        }\n        .grayed .sim-bb-wire:not(.highlight) {\n            stroke: #CCC;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-end {\n            stroke: red;\n            fill: red;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-bare-end {\n            stroke: #FFF;\n            fill: #FFF;\n        }\n        ",(t=B.WireEndStyle||(B.WireEndStyle={}))[t.BBJumper=0]="BBJumper",t[t.OpenJumper=1]="OpenJumper",t[t.Croc=2]="Croc",B.mkWirePart=function(t,e,n){void 0===n&&(n=!1);var r,i=L.svg.elt("g"),o=t[0],s=t[1],a=[o-_,s-I/2],u=[o+_,s+I/2];e=B.mapWireColor(e),r=n?M(a,!0,e):E(a,!0,e);var l,c,p,d,h,f,m,g,v,b,y,w,x=(c=u,p=e,d=function(t){return t[0]+", "+t[1]},h=(l=a)[0],f=l[1],m=c[0],g=c[1],b=[h,f+.8*(v=g-f)],y=[m,g-.8*v],(w=L.svg.mkPath("sim-bb-wire","M"+d(l)+" C"+d(b)+" "+d(y)+" "+d(c))).style.stroke=p,{el:w,x:Math.min(h,m),y:Math.min(f,g),w:Math.abs(h-m),h:Math.abs(f-g)}),C=E(u,!1,e);i.appendChild(x.el),i.appendChild(r.el),i.appendChild(C.el);var R=Math.min(r.x,C.x),k=Math.max(r.x+r.w,C.x+C.w),S=Math.min(r.y,C.y);return{el:i,x:R,y:S,w:k-R,h:Math.max(r.y+r.h,C.y+C.h)-S}};var e=function(){function t(t,e,n,r,i,o){this.nextWireId=0,this.styleEl=r,this.styleEl.textContent+=B.WIRES_CSS,this.underboard=t,this.overboard=e,this.boardEdges=n,this.getLocCoord=i,this.getPinStyle=o}return t.prototype.indexOfMin=function(t){for(var e=0,n=t[0],r=1;r<t.length;r++)t[r]<n&&(n=t[r],e=r);return e},t.prototype.closestEdgeIdx=function(e){var t=this.boardEdges.map(function(t){return Math.abs(e[1]-t)});return this.indexOfMin(t)},t.prototype.closestEdge=function(t){return this.boardEdges[this.closestEdgeIdx(t)]},t.prototype.drawWire=function(t,e,n){var i=this,r=[],o=L.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),s=function(t){var e,n=B.PIN_DIST/2,r=i.closestEdge(t);return e=r-t[1]<0?r-n:r+n,[t[0],e]},a=this.nextWireId++,u=D(n),l=F(t,u),c=F(e,u),p=L.svg.child(o,"g",{class:"sim-bb-wire-ends-g"});p.appendChild(l),p.appendChild(c);var d=this.closestEdgeIdx(t),h=this.closestEdgeIdx(e);if(d==h){var f=T(t,e,u);o.appendChild(f),r.push(f)}else{var m=s(t),g=s(e),v=T(t,m,u),b=T(e,g,u),y=void 0,w=void 0;!(1!=d&&2!=d||1!=h&&2!=h)?(y=A(m,g,.7,u),w=A(m,g,.7,u)):(y=T(m,g,u),w=T(m,g,u)),L.U.addClass(w,"sim-bb-wire-hover"),o.appendChild(v),r.push(v),o.appendChild(b),r.push(b),this.underboard.appendChild(y),r.push(y),o.appendChild(w),r.push(w);var x="sim-bb-wire-id-"+a,C=function(t){return L.U.addClass(t,x)};C(p),C(w),this.styleEl.textContent+="\n                    ."+x+":hover ~ ."+x+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}var R="\n                .wire-stroke-"+u+" {\n                    stroke: "+B.mapWireColor(n)+";\n                }\n                .wire-fill-"+u+" {\n                    fill: "+B.mapWireColor(n)+";\n                }\n                ";return this.styleEl.textContent+=R,{endG:p,end1:l,end2:c,wires:r}},t.prototype.drawWireWithCrocs=function(t,e,n,r){var i=this;void 0===r&&(r=!1);var o=[],s=L.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),a=this.nextWireId++,u=D(n),l=F(t,u),c=e,p=e[0],d=e[1],h=[p=(e=[p,d+40])[0],(d=e[1])+-17],f=(r?function(t,e,n){var r=.24*B.PIN_DIST,i=4*r,o=1.2*r,s=10*r,a=r,u=B.PIN_DIST/4,l=t[0],c=t[1],p=e?-1:1,d=L.svg.elt("g"),h=L.svg.elt("rect"),f=i,m=o,g=l-m/2,v=c+10-f/2;L.svg.hydrate(h,{x:g,y:v,width:m,height:f,rx:.5,ry:.5,class:"sim-bb-wire-end"}),h.style["stroke-width"]=u+"px";var b=L.svg.elt("rect"),y=s,w=a,x=l-w/2,C=c+10+p*(f/2+y/2)-y/2;return L.svg.hydrate(b,{x:x,y:C,width:w,height:y,class:"sim-bb-wire-bare-end"}),b.style.fill="#bbb",d.appendChild(b),d.appendChild(h),{el:d,x:g-u,y:Math.min(v,C),w:m+2*u,h:f+y}}(h,!0):M(h,!0)).el,m=L.svg.child(s,"g",{class:"sim-bb-wire-ends-g"});m.appendChild(l);var g,v,b,y,w=this.closestEdgeIdx(t),x=this.closestEdgeIdx(c);if(w==x){var C=T(t,e,u);s.appendChild(C),o.push(C)}else{var R=(g=t,b=B.PIN_DIST/2,y=i.closestEdge(g),v=y-g[1]<0?y-b:y+b,[g[0],v]),k=T(t,R,u),S=void 0,_=void 0;!(1!=w&&2!=w||1!=x&&2!=x)?(S=A(R,e,.7,u),_=A(R,e,.7,u)):(S=T(R,e,u),_=T(R,e,u)),L.U.addClass(_,"sim-bb-wire-hover"),s.appendChild(k),o.push(k),this.underboard.appendChild(S),o.push(S);var I="sim-bb-wire-id-"+a,E=function(t){return L.U.addClass(t,I)};E(m),E(_),this.styleEl.textContent+="\n                    ."+I+":hover ~ ."+I+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}m.appendChild(f);var P="\n                .wire-stroke-"+u+" {\n                    stroke: "+B.mapWireColor(n)+";\n                }\n                .wire-fill-"+u+" {\n                    fill: "+B.mapWireColor(n)+";\n                }\n                ";return this.styleEl.textContent+=P,{endG:m,end1:l,end2:f,wires:o}},t.prototype.checkWire=function(t,e){var n=this.getLocCoord(t),r=this.getLocCoord(e);return!!n&&!!r},t.prototype.addWire=function(t,e,n){var r=this.getLocCoord(t),i=this.getLocCoord(e);if(r&&i){var o=this.getPinStyle(e);return"dalboard"==e.type&&"croc"==o?this.drawWireWithCrocs(r,i,n):this.drawWire(r,i,n)}console.debug("unable to allocate wire for "+t+" or "+e)},t}();B.WireFactory=e}(L.visuals||(L.visuals={}))}(pxsim||(pxsim={}));