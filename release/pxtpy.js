var pxt;!function(e){var n,t;n=e.py||(e.py={}),(t=n.VarModifier||(n.VarModifier={}))[t.NonLocal=0]="NonLocal",t[t.Global=1]="Global"}(pxt||(pxt={})),function(Je){!function(O){var R,D,b,M,B,q,G,z=Je.blocks,x=0,t=0,Q=0,s="???",r=!1,u=void 0,W=void 0;function o(e){return null==e}function f(e){return null!=e}function p(e){return Je.tickEvent("python.todo",{kind:e.kind}),z.mkStmt(z.mkText("TODO: "+e.kind))}function i(e){return Je.tickEvent("python.todo",{kind:e.kind}),z.mkText(" {TODO: "+e.kind+"} ")}var a=k({primType:"string"}),l=k({primType:"number"}),c=k({primType:"boolean"}),m=k({primType:"void"}),d=k({primType:"any"}),j=void 0,y={string:a,number:l,boolean:c,void:m,any:d};function V(e){var n=Je.U.flatClone(e);return delete n.pyAST,delete n.pyInstanceType,delete n.pyRetType,delete n.pySymbolType,delete n.moduleTypeMarker,delete n.declared,n.parameters&&(n.parameters=n.parameters.map(function(e){return delete(e=Je.U.flatClone(e)).pyType,e})),n}function H(e){if("("==e[0]&&Je.U.endsWith(e,")"))return H(e.slice(1,-1));var n=e.indexOf(" => ");if(0<n){var t=e.slice(n+4);if(-1==t.indexOf(")[]")){var r=H(t),i=e.slice(1,n-1);return h(r,(i?i.split(/, /):[]).map(function(e){return H(e.replace(/\w+\??: /,""))}))}}if(Je.U.endsWith(e,"[]"))return g(H(e.slice(0,-2)));if("_py.Array"===e)return g(d);var a=Je.U.lookup(y,e);if(a)return a;if(!!e&&!isNaN(e))return l;if("T"==e||"U"==e)return k({primType:"'"+e});var o=v(e+"@type")||v(e);return o?7==o.kind?l:8==o.kind||9==o.kind?o.pyInstanceType||k({classType:o}):6==o.kind?l:($(null,9502,Je.U.lf("'{0}' is not a type near '{1}'",e,s||"???")),k({primType:e})):($(null,9501,Je.U.lf("unknown type '{0}' near '{1}'",e,s||"???")),k({primType:e}))}function N(e){return e.attributes.shim&&"@"==e.attributes.shim[0]}function T(e){if(!e.pySymbolType){if(s=e.pyQName,e.parameters){N(e)&&(e.parameters=[{name:"literal",description:"",type:"string",options:{}}]);for(var n=0,t=e.parameters;n<t.length;n++){var r=t[n];r.pyType||(r.pyType=H(r.type))}}var i=e.pyRetType;if(le(e)?e.pyRetType=k({moduleType:e}):e.retType?e.pyRetType=H(e.retType):e.pyRetType||(Je.U.oops("no type for: "+e.pyQName),e.pyRetType=k({})),i&&X(e.pyAST,i,e.pyRetType),3==e.kind||1==e.kind){var a=e.parameters.map(function(e){return e.pyType});if(a.some(o))return $(null,9526,Je.U.lf("function symbol is missing parameter types near '{1}'",s||"???")),k({});e.pySymbolType=h(e.pyRetType,a.filter(f))}else e.pySymbolType=e.pyRetType;8!=e.kind&&9!=e.kind||(e.pyInstanceType=k({classType:e})),s=void 0}return e.pySymbolType}function v(e){return Je.U.lookup(D,e)||Je.U.lookup(R,e)}function E(e){if(e){var n=v(e);return n&&T(n),n}}function k(e){void 0===e&&(e={});var n=Je.U.flatClone(e);return n.tid=++t,n}function g(e){return k({primType:"@array",typeArgs:[e]})}function h(e,n){return k({primType:"@fn"+n.length,typeArgs:[e].concat(n)})}function C(){return b.currFun||b.currClass||b.currModule}function S(){for(var e=C();e&&e.parent;)e=e.parent;return e}function U(){return"main"==b.currModule.name&&!b.currFun&&!b.currClass}function I(e,n,t){t||(t=C());var r=t.vars[e];if(!r){var i=A(t);i&&(i+=".");var a=i+e;r=ee(t)?Y(4,e):Z(4,a),t.vars[e]=r}for(var o=0,s=Object.keys(n);o<s.length;o++){var u=s[o];r[u]=n[u]}return r}function w(e){return e.union?(e.union=w(e.union),e.union):e}function A(e){var n=e,t="";n.parent&&"FunctionDef"!==n.parent.kind&&"AsyncFunctionDef"!==n.parent.kind&&((t=A(n.parent))?t+=".":t="");var r=e;return"Module"==e.kind&&"main"==r.name?"":r.name?t+r.name:t+"?"+e.kind}function P(e){var n=Je.U.lookup(ke,e);if(n)return n;for(var t=0,r=Je.U.values(b.currModule.vars);t<r.length;t++){var i=r[t];if(i.isImport){if(i.expandsTo==e)return i.pyName||$(null,9553,lf("missing pyName")),i.pyName;if(i.isImport&&Je.U.startsWith(e,(i.expandsTo||"")+"."))return i.pyName+e.slice(i.expandsTo.length)}}return e}function _(e){var n=function(e){return r?e:""};return(e=w(e)).primType?e.typeArgs&&"@array"==e.primType?_(e.typeArgs[0])+"[]":Je.U.startsWith(e.primType,"@fn")&&e.typeArgs?"("+e.typeArgs.slice(1).map(function(e){return"_: "+_(e)}).join(", ")+") => "+_(e.typeArgs[0]):e.primType+n("/P"):e.classType&&e.classType.pyQName?P(e.classType.pyQName)+n("/C"):e.moduleType&&e.moduleType.pyQName?P(e.moduleType.pyQName)+n("/M"):"?"+e.tid}function $(e,n,t){var r,i,a,o;B.push((r=e,i=pxtc.DiagnosticCategory.Error,a=n,o=t,r||(r=u),r&&b&&b.currModule?{fileName:M,start:r.startPos,length:r.endPos-r.startPos,line:void 0,column:void 0,code:a,category:i,messageText:o}:{fileName:M,start:0,length:0,line:void 0,column:void 0,code:a,category:i,messageText:o}))}function K(e){return e.primType?e.primType:e.classType?e.classType:e.moduleType?(e.moduleType.moduleTypeMarker||(e.moduleType.moduleTypeMarker={}),e.moduleType.moduleTypeMarker):null}function L(e){return!K(w(e))}function F(e,n,t){var r;(n=w(n)).classType!=t&&(L(n)?n.classType=t:X(e,n,(T(r=t),r.pyInstanceType||$(null,9527,Je.U.lf("Instance type symbol '{0}' is missing pyInstanceType",r)),r.pyInstanceType)))}function J(e,n){X(e,ue(e),n)}function X(e,n,t){if(n!==t&&(n=w(n))!==(t=w(t)))if("any"!==n.primType){var r,i,a=K(n),o=K(t);if(a&&o)if(a===o){if(n.union=t,n.typeArgs&&t.typeArgs)for(var s=0;s<Math.min(n.typeArgs.length,t.typeArgs.length);++s)X(e,n.typeArgs[s],t.typeArgs[s]);n.union=t}else r=n,i=t,$(e,9500,Je.U.lf("types not compatible: {0} and {1}",_(r),_(i)));else a&&!o?X(e,t,n):(Q++,n.union=t)}else n.union=t}function Y(e,n){var t=/(.*)\.(.*)/.exec(n),r=t?t[2]:n;return{kind:e,name:r,pyName:r,qName:n,pyQName:n,namespace:t?t[1]:"",attributes:{},pyRetType:k()}}function Z(e,n){var t=D[n];return t?(t.kind=e,t):((t=Y(e,n)).pyQName||$(null,9527,Je.U.lf("Symbol '{0}' is missing pyQName",n)),D[t.pyQName]=t)}function ee(e){for(var n=e;n;){if("FunctionDef"==n.kind)return!0;n=n.parent}return!1}function ne(e,n,t){if(!n.symInfo){var r=A(n);Je.U.endsWith(r,".__init__")&&(r=r.slice(0,-9)+".__constructor"),ee(t=t||C())?n.symInfo=Y(e,r):n.symInfo=Z(e,r);var i=n.symInfo;i.pyAST=n,i.pyName||$(null,9528,Je.U.lf("Symbol '{0}' is missing pyName",i.qName||i.name)),t.vars[i.pyName]=i}return n.symInfo}function te(e){var n=e.symInfo.qName;return Je.U.values(D).filter(function(e){return e.namespace==n&&2==e.kind})}function re(e,n,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var i=e.pyQName+"."+n,a=E(i);if(a)return a;if(!r)for(var o=0,s=e.extendsTypes||[];o<s.length;o++){var u;if(u=E(s[o])){u==e&&Je.U.userError("field lookup loop on: "+u.qName+" / "+n);var l=re(u,n,!0);if(l)return l}}return!t&&e.pyAST&&"ClassDef"==e.pyAST.kind?((u=Z(2,i)).isInstance=!0,u):null}function ie(e,n,t){void 0===t&&(t=!1);for(var r,i,a,o=ue(e),s=0,u=[(r=w(o)).classType].concat(ae(r.primType),[r.moduleType]).filter(f);s<u.length;s++){var l=u[s],c=re(l,n,t);if(c)return!!l.moduleTypeMarker?c.isInstance&&$(null,9505,Je.U.lf("the field '{0}' of '{1}' is not static",n,l.pyQName)):(c.isInstance||$(null,9504,Je.U.lf("the field '{0}' of '{1}' is static",n,l.pyQName)),Ie(a=e,"super")&&0==a.args.length?c.isProtected=!0:"Name"==(i=e).kind&&"self"==i.id&&(b.currClass||$(null,9529,Je.U.lf("no class context found for {0}",c.pyQName)),c.namespace!=b.currClass.symInfo.qName&&(c.isProtected=!0))),c}return null}function ae(e){var n=[];return"@array"==e?n=[v("_py.Array"),v("Array")]:"string"==e&&(n=[v("_py.String"),v("String")]),n.filter(function(e){return!!e})}function oe(e){var n=C(),t=Je.U.lookup(n.vars,e);return t||null}function se(e){if(!e)return null;var n,t=e.indexOf(".");if(0<t)(n=oe(e.slice(0,t)))&&n.pyQName!=n.pyName&&(e=n.pyQName+e.slice(t));else if(n=oe(e))return n;return E(e)}function ue(e){return e.tsType?w(e.tsType):(e.tsType=k(),e.tsType)}function le(e){if(!e)return!1;switch(e.kind){case 5:case 9:case 8:case 6:return!0;default:return!1}}function ce(e){var n,t=Je.U.flatClone(b);try{n=e()}finally{b=t}return n}function fe(e,n){return 0==n.length?z.mkText(""):z.mkGroup([z.mkText("/* TODO: "+e+" "),z.mkGroup(n),z.mkText(" */"),z.mkNewLine()])}function pe(e){var n=Be(e.value);return e.arg?z.mkInfix(z.mkText(e.arg),"=",n):z.mkGroup([z.mkText("**"),n])}function me(e){if(!e)return k();var n=Ce(e);if(n){var t=v(n+"@type")||v(n);if(t){if(T(t),6==t.kind)return l;if(t.pyInstanceType)return t.pyInstanceType}$(e,9506,Je.U.lf("cannot find type '{0}'",n))}return $(e,9507,Je.U.lf("invalid type syntax")),k({})}var de={Sub:1,Div:1,Pow:1,LShift:1,RShift:1,BitOr:1,BitXor:1,BitAnd:1,FloorDiv:1,Mult:1},ye={Add:"+",Sub:"-",Mult:"*",MatMult:"Math.matrixMult",Div:"/",Mod:"%",Pow:"**",LShift:"<<",RShift:">>",BitOr:"|",BitXor:"^",BitAnd:"&",FloorDiv:"Math.idiv",And:"&&",Or:"||",Eq:"==",NotEq:"!=",Lt:"<",LtE:"<=",Gt:">",GtE:">=",Is:"===",IsNot:"!==",In:"py.In",NotIn:"py.NotIn"},ve={Invert:"~",Not:"!",UAdd:"P+",USub:"P-"},ke={"adafruit_bus_device.i2c_device.I2CDevice":"pins.I2CDevice"};function ge(e){b.blockDepth++;var n=z.mkBlock(e.map(qe));return b.blockDepth--,n}function xe(e){e.vars||(e.vars={},e.parent=C(),e.blockDepth=b.blockDepth)}function Te(e){return"?"==_(e)[0]?z.mkText(""):z.mkText(": "+_(e))}function e(n,e){try{return ce(e)}catch(e){return console.log(e),z.mkStmt(fe("conversion failed for "+(n.name||n.kind),[]))}}function he(e){if(!e||!e.pyAST)return!1;if("FunctionDef"!=e.pyAST.kind)return!1;var n=e.pyAST;return!(!n.callers||1!=n.callers.length)&&!n.callers[0].inCalledPosition}function Se(k,g){return void 0===g&&(g=!1),e(k,function(){var e=!!b.currClass&&!b.currFun,n=U(),t=!!b.currFun;xe(k);var r=se(A(k)),i=ne(e?1:3,k);if(!g&&(r&&r.declared===x&&$(k,9520,lf("Duplicate function declaration")),i.declared=x,he(i)))return z.mkText("");e&&(i.isInstance=!0),b.currFun=k;var a="",o=k.name,s=[fe("decorators",k.decorator_list.filter(function(e){return"property"==Ce(e)?!(a="get"):"Attribute"!=e.kind||"setter"!=e.attr||"Name"!=e.value.kind||(o=e.value.id,!(a="set"))}).map(Be))];if(1<=k.body.length&&"Raise"==k.body[0].kind&&(k.alwaysThrows=!0),e)if(b.currClass||$(k,9531,lf("method '{0}' is missing current class context",i.pyQName)),i.pyRetType||$(k,9532,lf("method '{0}' is missing a return type",i.pyQName)),"__init__"==k.name)s.push(z.mkText("constructor")),F(k,i.pyRetType,b.currClass.symInfo);else{if("__get__"==o||"__set__"==o){var u=k.vars.value;if("__set__"==o&&u){var l=re(b.currClass.symInfo,"__get__");l&&l.pyAST&&"FunctionDef"==l.pyAST.kind&&X(k,u.pyRetType,l.pyRetType)}o=o.replace(/_/g,"")}a||(a="_"==o[0]?i.isProtected?"protected":"private":"public"),s.push(z.mkText(a+" "),Ue(o))}else Je.U.assert(!a),"_"==k.name[0]||n||g||t?s.push(z.mkText("function "),Ue(o)):s.push(z.mkText("export function "),Ue(o));s.push(function(r,e){var i=r.args;i.kwonlyargs.length&&$(r,9517,Je.U.lf("keyword-only arguments not supported yet"));var n=i.args.slice();if(e?("self"!=n[0].arg&&$(r,9518,Je.U.lf("first argument of method has to be called 'self'")),n.shift()):n.some(function(e){return"self"==e.arg})&&$(r,9519,Je.U.lf("non-methods cannot have an argument called 'self'")),!r.symInfo.parameters){var a=i.defaults.length-n.length;r.symInfo.parameters=n.map(function(e){e.annotation||$(r,9519,Je.U.lf("Arg '{0}' missing annotation",e.arg));var n=me(e.annotation),t="";return 0<=a&&(t=z.flattenNode([Be(i.defaults[a])]).output,X(e,n,ue(i.defaults[a]))),a++,{name:e.arg,description:"",type:"",initializer:t,default:t,pyType:n}})}var t=r.symInfo.parameters.map(function(e){var n=I(e.name,{isParam:!0});e.pyType||$(r,9530,Je.U.lf("parameter '{0}' missing pyType",e.name)),X(r,T(n),e.pyType);var t=[Ue(e.name),Te(e.pyType)];return e.default&&t.push(z.mkText(" = "+e.default)),z.mkGroup(t)});return i.vararg&&t.push(z.mkText("TODO *"+i.vararg.arg)),i.kwarg&&t.push(z.mkText("TODO **"+i.kwarg.arg)),z.H.mkParenthesizedExpression(z.mkCommaSep(t))}(k,e),k.returns?Te(me(k.returns)):z.mkText("")),T(i);var c=k.body.map(qe);if("__init__"==k.name){b.currClass||$(k,9533,lf("__init__ method '{0}' is missing current class context",i.pyQName));for(var f=0,p=te(b.currClass);f<p.length;f++){var m=p[f],d=m.pyAST;d&&d.value&&c.push(z.mkStmt(z.mkText("this."+Ee(m.pyName)+" = "),Be(d.value)))}}var y=Qe(k);s.push(z.mkBlock(y.concat(c)));var v=z.mkGroup(s);return g?s[s.length-1].noFinalNewline=!0:v=z.mkStmt(v),v})}var be={FunctionDef:function(e){return Se(e)},ClassDef:function(u){return e(u,function(){xe(u);var e=ne(8,u);Je.U.assert(!b.currClass);var n=U();(b.currClass=u).isNamespace=u.decorator_list.some(function(e){return"Name"==e.kind&&"namespace"==e.id});var t,r,i=u.isNamespace?[z.mkText("namespace "),Ue(u.name)]:[fe("keywords",u.keywords.map(pe)),fe("decorators",u.decorator_list.map(Be)),z.mkText(n?"class ":"export class "),Ue(u.name)];if(!u.isNamespace&&0<u.bases.length)if("Enum"==Ce(u.bases[0]))u.isEnum=!0;else{i.push(z.mkText(" extends ")),i.push(z.mkCommaSep(u.bases.map(Be)));var a=(t=u.bases[0],(r=se(Ce(t)))&&r.pyAST&&"ClassDef"==r.pyAST.kind?r.pyAST:null);a&&(u.baseClass=a,e.extendsTypes=[a.symInfo.pyQName])}var o=ge(u.body);i.push(o);var s=te(u).filter(function(e){return 2==e.kind&&e.isInstance}).map(function(e){return e.pyName&&e.pyRetType||$(u,9535,lf("field definition missing py name or ret type",e.qName)),e}).map(function(e){return z.mkStmt((n=e).pyName&&"_"==n.pyName[0]?n.isProtected?z.mkText("protected "):z.mkText("private "):z.mkText(""),Ue(e.pyName),Te(e.pyRetType));var n});return o.children=s.concat(o.children),z.mkStmt(z.mkGroup(i))})},Return:function(e){if(e.value){var n=b.currFun;return n&&(n.symInfo.pyRetType||$(e,9536,lf("function '{0}' missing return type",n.symInfo.pyQName)),J(e.value,n.symInfo.pyRetType)),z.mkStmt(z.mkText("return "),Be(e.value))}return z.mkStmt(z.mkText("return"))},AugAssign:function(e){var n=ye[e.op];return 3<n.length?z.mkStmt(z.mkInfix(Be(e.target),"=",z.H.mkCall(n,[Be(e.target),Be(e.value)]))):z.mkStmt(Be(e.target),z.mkText(" "+n+"= "),Be(e.value))},Assign:function(e){return n(e)},AnnAssign:function(e){return n(e)},For:function(e){if(Je.U.assert(0==e.orelse.length),Ie(e.iter,"range")){var n=e.iter,t=Be(e.target),r=Ue(Ce(e.target));J(e.target,l);var i=1==n.args.length?z.mkText("0"):Be(n.args[0]),a=Be(n.args[1==n.args.length?0:1]);return z.mkStmt(z.mkText("for ("),z.mkInfix(t,"=",i),z.mkText("; "),z.mkInfix(r,"<",a),z.mkText("; "),3<=n.args.length?z.mkInfix(r,"+=",Be(n.args[2])):z.mkPostfix([r],"++"),z.mkText(")"),ge(e.body))}return J(e.iter,g(ue(e.target))),z.mkStmt(z.mkText("for ("),Be(e.target),z.mkText(" of "),Be(e.iter),z.mkText(")"),ge(e.body))},While:function(e){return Je.U.assert(0==e.orelse.length),z.mkStmt(z.mkText("while ("),Be(e.test),z.mkText(")"),ge(e.body))},If:function(e){var t=function(e){var n=[z.mkText("if ("),Be(e.test),z.mkText(")"),ge(e.body)];return e.orelse.length&&(n[n.length-1].noFinalNewline=!0,1==e.orelse.length&&"If"==e.orelse[0].kind?(n.push(z.mkText(" else ")),Je.U.pushRange(n,t(e.orelse[0]))):n.push(z.mkText(" else"),ge(e.orelse))),n};return z.mkStmt(z.mkGroup(t(e)))},With:function(e){if(1==e.items.length&&(o=e.items[0].context_expr,s="pins.I2CDevice",(u=ue(o)).classType&&u.classType.pyQName==s||_(u)==s)){var n=e.items[0],t=[],r=Be(n.context_expr);if(n.optional_vars){var i=Ce(n.optional_vars);if(i){var a=I(i,{isLocal:!0});i=Ee(i),t.push(z.mkStmt(z.mkText("const "+i+" = "),r)),a.pyRetType||$(e,9537,lf("function '{0}' missing return type",a.pyQName)),J(n.context_expr,a.pyRetType),r=z.mkText(i)}}return t.push(z.mkStmt(z.mkInfix(r,".",z.mkText("begin()")))),Je.U.pushRange(t,e.body.map(qe)),t.push(z.mkStmt(z.mkInfix(r,".",z.mkText("end()")))),z.mkGroup(t)}var o,s,u,l=[],c=e.items.map(function(e,n){var t="with"+n;if(e.optional_vars){var r=Ce(e.optional_vars);Je.U.assert(null!=r),I(r,{isLocal:!0}),t=Ee(r)}return l.push(z.mkStmt(z.mkText(t+".end()"))),z.mkStmt(z.mkText("const "+t+" = "),z.mkInfix(Be(e.context_expr),".",z.mkText("begin()")))});return Je.U.pushRange(c,e.body.map(qe)),Je.U.pushRange(c,l),z.mkBlock(c)},Raise:function(e){var n=e.exc||e.cause;if(!n)return z.mkStmt(z.mkText("throw"));var t=void 0;if(n&&"Call"==n.kind){var r=n;1==r.args.length&&(t=Be(r.args[0]))}return t||(t=z.mkGroup([z.mkText("`"),Be(n),z.mkText("`")])),z.mkStmt(z.H.mkCall("control.fail",[t]))},Assert:function(e){return e.msg||$(e,9537,lf("assert missing message")),z.mkStmt(z.H.mkCall("control.assert",[e.test,e.msg].filter(function(e){return!!e}).map(Be)))},Import:function(e){for(var n=0,t=e.names;n<t.length;n++){var r=t[n];r.asname&&I(r.asname,{expandsTo:r.name}),i=e,a=r.name,void 0,E(a)||$(i,9503,Je.U.lf("No module named '{0}'",a))}var i,a;return z.mkText("")},ImportFrom:function(e){for(var n=[],t=0,r=e.names;t<r.length;t++){var i=r[t];if("*"==i.name)e.module||$(e,9538,lf("import missing module name")),I(e.module,{isImportStar:!0});else{var a=e.module+"."+i.name,o=E(a),s=i.asname||i.name;le(o)?(I(s,{isImport:o,expandsTo:a}),n.push(z.mkStmt(z.mkText("import "+Ee(s)+" = "+a)))):I(s,{expandsTo:a})}}return z.mkGroup(n)},ExprStmt:function(e){return"Str"==e.value.kind?((n=e.value.s).trim().split(/\n/).length<=1?n=n.trim():n+="\n",z.mkStmt(z.mkText("/** "+n+" */"))):z.mkStmt(Be(e.value));var n},Pass:function(e){return z.mkStmt(z.mkText(""))},Break:function(e){return z.mkStmt(z.mkText("break"))},Continue:function(e){return z.mkStmt(z.mkText("break"))},Delete:function(e){return p(e)},Try:function(e){for(var n=[z.mkText("try"),ge(e.body.concat(e.orelse))],t=0,r=e.handlers;t<r.length;t++){var i=r[t];n.push(z.mkText("catch ("),i.name?Ue(i.name):z.mkText("_")),i.type&&n.push(z.mkText("/* instanceof "),Be(i.type),z.mkText(" */")),n.push(z.mkText(")"),ge(i.body))}return e.finalbody.length&&n.push(z.mkText("finally"),ge(e.finalbody)),z.mkStmt(z.mkGroup(n))},AsyncFunctionDef:function(e){return p(e)},AsyncFor:function(e){return p(e)},AsyncWith:function(e){return p(e)},Global:function(e){for(var n=S(),t=(C(),0),r=e.names;t<r.length;t++){var i=r[t];Je.U.lookup(n.vars,i)||$(e,9521,Je.U.lf("No binding found for global variable")),I(i,{modifier:O.VarModifier.Global}).firstRefPos<e.startPos&&$(e,9522,Je.U.lf("Variable referenced before global declaration"))}return z.mkStmt(z.mkText(""))},Nonlocal:function(e){for(var n=S(),t=C(),r=0,i=e.names;r<i.length;r++){var a=i[r],o=ze(a,t);o&&o!==n&&o.vars[a].modifier!==O.VarModifier.Global||$(e,9523,Je.U.lf("No binding found for nonlocal variable")),I(a,{modifier:O.VarModifier.NonLocal}).firstRefPos<e.startPos&&$(e,9524,Je.U.lf("Variable referenced before nonlocal declaration"))}return z.mkStmt(z.mkText(""))}};function n(e){var n,t;if("Assign"===e.kind){if(1!=e.targets.length)return p(e);t=e.targets[0],n=e.value,null}else{if("AnnAssign"!==e.kind)return e;t=e.target,n=e.value||null,e.annotation}var r="",i=!!n&&Ie(n,"const"),a=Ce(t)||"";if(U()||b.currClass||b.currFun||"_"==a[0]||(r="export "),a&&b.currClass&&!b.currFun){i=!(!n||!b.currClass.isNamespace);var o=re(b.currClass.symInfo,a);if(o||$(e,9544,lf("cannot get class field")),0==x)return z.mkText("/* skip for now */");o.pyRetType||$(e,9539,lf("function '{0}' missing return type",o.pyQName)),J(t,o.pyRetType),o.isInstance=!1,r=b.currClass.isNamespace?"export "+(i?"const":"let")+" ":"static "}if(!n)return p(e);if(J(t,ue(n)),i)return I(Ce(t),{}),/^static /.test(r)||/const/.test(r)||(r+="const "),z.mkStmt(z.mkText(r),z.mkInfix(Be(t),"=",Be(n)));if(!r&&"Tuple"==t.kind){var s=t,u=[z.mkText("let "),z.mkText("[")];if(s.elts.filter(function(e){return"Name"!==e.kind}).length)return p(e);var l=s.elts.map(function(e){return e}).map(function(e){Le(e,"identifierCompletion"),ue(e);Re(e);return Ne(e,!0)});return u.push(z.mkCommaSep(l)),u.push(z.mkText("]")),z.mkStmt(z.mkInfix(z.mkGroup(u),"=",Be(n)))}if("Name"===t.kind){var c=C().vars[a];c&&4===c.kind&&void 0===c.modifier&&(void 0===c.firstAssignPos||c.firstAssignPos>t.startPos)&&(c.firstAssignPos=t.startPos,c.firstAssignDepth=b.blockDepth)}return z.mkStmt(z.mkText(r),z.mkInfix(Be(t),"=",Be(n)))}function Ne(e,n){void 0===n&&(n=!1);var t=e.id,r=se(t),i=C().vars[t];return void 0===e.isdef&&(!r||4===r.kind&&r!==i?b.currClass&&!b.currFun?(e.isdef=!1,r=I(t,{})):r=I(t,{isLocal:e.isdef=!0}):e.isdef=!1,e.symbolInfo=r,e.tsType||$(e,9540,lf("definition missing ts type")),r.pyRetType||$(e,9568,lf("missing py return type")),X(e,e.tsType,r.pyRetType)),e.isdef&&We(r,C())&&(e.isdef=!1),De(r,e),e.isdef&&!n?z.mkGroup([z.mkText("let "),Ue(t)]):Ue(t)}function Ee(e){return z.isReservedWord(e)?e+"_":e||e}function Ce(e){if("Name"==e.kind){var n=e.id,t=oe(n);return t&&t.expandsTo?t.expandsTo:n}if("Attribute"==e.kind){var r=Ce(e.value);if(r)return r+"."+e.attr}$(null,9542,lf("Cannot get name of unknown expression kind '{0}'",e.kind))}function Ue(e){return"self"==e?z.mkText("this"):z.mkText(Ee(e))}function Ie(e,n){return"Call"==e.kind&&Ce(e.func)===n}function we(e,n,t){var r=ye[n];return Je.U.assert(!!r),3<r.length?z.H.mkCall(r,[e,t]):z.mkInfix(e,r,t)}var Ae={memoryview:{n:"",t:j},const:{n:"",t:l},"micropython.const":{n:"",t:l}};var Pe,_e=(Pe={},Object.keys(pxtc.ts2PyFunNameMap).forEach(function(e){var n=pxtc.ts2PyFunNameMap[e];if(n&&n.n){var t={n:e,t:function(e){switch(e){case ts.SyntaxKind.StringKeyword:return a;case ts.SyntaxKind.NumberKeyword:return l;case ts.SyntaxKind.BooleanKeyword:return c;case ts.SyntaxKind.VoidKeyword:return m;case ts.SyntaxKind.AnyKeyword:return d;default:return j}}(n.t),scale:n.scale};Pe[n.n]=t}}),Object.keys(Ae).forEach(function(e){Pe[e]=Ae[e]}),Pe);function Ke(e){return q&&e.startPos<=q.position&&q.position<=e.endPos}function Le(e,n){100<x&&q&&null==W&&(q.type==n||"symbol"==q.type)&&Ke(e)&&(W=e,G=C())}function Fe(e,n){if(n&&n.pyAST&&"FunctionDef"==n.pyAST.kind){var t=n.pyAST;t.callers||(t.callers=[]),t.callers.indexOf(e)<0&&t.callers.push(e)}}var Oe={BoolOp:function(e){for(var n=Be(e.values[0]),t=1;t<e.values.length;++t)n=we(n,e.op,Be(e.values[t]));return n},BinOp:function(e){var n=function(e){if("Mod"==e.op&&"Str"==e.left.kind&&("Tuple"==e.right.kind||"List"==e.right.kind)){var n=e.left.s,o=e.right.elts;o=o.slice();var s=[z.mkText("`")];return n.replace(/([^%]+)|(%[\d\.]*([a-zA-Z%]))/g,function(e,n,t,r){if(n)s.push(z.mkText(n.replace(/[`\\$]/g,function(e){return"\\"+e})));else{var i=o.shift(),a=i?Be(i):z.mkText("???");s.push(z.mkText("${"),a,z.mkText("}"))}return""}),s.push(z.mkText("`")),z.mkGroup(s)}return null}(e);return n||(n=we(Be(e.left),e.op,Be(e.right)),de[e.op]&&(J(e.left,l),J(e.right,l),e.tsType||$(e,9570,lf("binary op missing ts type")),X(e,e.tsType,l)),n)},UnaryOp:function(e){var n=ve[e.op];return Je.U.assert(!!n),z.mkInfix(null,n,Be(e.operand))},Lambda:function(e){return i(e)},IfExp:function(e){return z.mkInfix(z.mkInfix(Be(e.test),"?",Be(e.body)),":",Be(e.orelse))},Dict:function(e){return i(e)},Set:function(e){return i(e)},ListComp:function(e){return i(e)},SetComp:function(e){return i(e)},DictComp:function(e){return i(e)},GeneratorExp:function(n){if(1==n.generators.length&&"Comprehension"==n.generators[0].kind){var t=n.generators[0];if(0==t.ifs.length)return ce(function(){var e=Ce(t.target);return I(e,{isParam:!0}),z.mkInfix(Be(t.iter),".",z.H.mkCall("map",[z.mkGroup([Ue(e),z.mkText(" => "),Be(n.elt)])]))})}return i(n)},Await:function(e){return i(e)},Yield:function(e){return i(e)},YieldFrom:function(e){return i(e)},Compare:function(e){if(1==e.ops.length&&("In"==e.ops[0]||"NotIn"==e.ops[0])){w(ue(e.comparators[0]))==a&&J(e.left,a);var n=z.mkInfix(Be(e.comparators[0]),".",z.H.mkCall("indexOf",[Be(e.left)]));return z.mkInfix(n,"In"==e.ops[0]?">=":"<",z.mkText("0"))}for(var t=we(Be(e.left),e.ops[0],Be(e.comparators[0])),r=1;r<e.ops.length;++r)t=we(t,"And",we(Be(e.comparators[r-1]),e.ops[r],Be(e.comparators[r])));return t},Call:function(e){e.func.inCalledPosition=!0;var n,t=Ce(e.func),r=se(t),i=r&&8==r.kind,a=r,o=void 0,s="";if(i)a=se(r.pyQName+".__constructor");else if("Attribute"==e.func.kind){var u=e.func;((n=ue(o=u.value)).classType||n.primType)&&(s=u.attr,(a=ie(o,s,!0))&&(s=a.name))}var l=e.args.slice();if("super"==t&&0==l.length)return b.currClass&&b.currClass.baseClass&&(e.tsType||$(e,9543,lf("call expr missing ts type")),F(e,e.tsType,b.currClass.baseClass.symInfo)),z.mkText("super");if(!a){var c=Je.U.lookup(_e,t);if(c&&(s=""),s&&(t=_(n)+"."+s,(c=Je.U.lookup(_e,t))||"@array"!=K(w(n))||(t="Array."+s,c=Je.U.lookup(_e,t))),s="",c)if("."==c.n[0]&&l.length){if(n=ue(o=l.shift()),s=c.n.slice(1),(a=ie(o,s))&&2==a.kind)return z.mkInfix(Be(o),".",z.mkText(s))}else a=E(c.n)}if(Ie(e,"str"))return z.mkInfix(z.mkText('""'),"+",Be(e.args[0]));a||$(e,9508,Je.U.lf("can't find called function \""+t+'"'));var f=a?a.parameters:null,p=[];if(f){for(l.length>f.length&&$(e,9510,Je.U.lf("too many arguments in call to '{0}'",a.pyQName));l.length<f.length;)l.push(null);l=l.slice(0,f.length);for(var m=function(n){var e=f.findIndex(function(e){return e.name==n.arg});e<0?$(n,9511,Je.U.lf("'{0}' doesn't have argument named '{1}'",a.pyQName,n.arg)):null!=l[e]?$(n,9512,Je.U.lf("argument '{0} already specified in call to '{1}'",n.arg,a.pyQName)):l[e]=n.value},d=0,y=e.keywords;d<y.length;d++){m(y[d])}for(var v=l.length-1;0<=v&&("undefined"==f[v].initializer&&null==l[v]);v--)l.pop();for(v=0;v<l.length;++v){null!=(k=l[v])||f[v].initializer?k?(f[v].pyType||$(e,9545,lf("formal arg missing py type")),"any"!==f[v].pyType.primType&&J(k,f[v].pyType),"Name"==k.kind&&he(k.symbolInfo)?p.push(Se(k.symbolInfo.pyAST,!0)):p.push(Be(k))):(f[v].initializer||$(e,9547,lf("formal arg missing initializer")),p.push(z.mkText(f[v].initializer))):($(e,9513,Je.U.lf("missing argument '{0}' in call to '{1}'",f[v].name,a.pyQName)),p.push(z.mkText("null")))}}else a&&$(e,9509,Je.U.lf("calling non-function")),p=l.map(Be);if(!W&&q&&"signature"==q.type&&Ke(e)){W=e,G=C();for(v=q.auxResult=0;v<l.length;++v){var k;if(q.auxResult=v,!(k=l[v]))break;if(k.startPos<=q.position&&q.position<=k.endPos)break}}if(a)if(a.pyRetType||$(e,9549,lf("function missing pyRetType")),J(e,a.pyRetType),(e.symbolInfo=a).attributes.py2tsOverride){var g=function(e){var n,t=new RegExp(/([^\$]*\()?([^\$\(]*)\$(\d)(?:(?:(?:=(\d+|'[a-zA-Z0-9_]*'|false|true|null|undefined))|(\?)|))/,"y"),r=[],i=0;for(;i=t.lastIndex,(n=t.exec(e))&&(n[1]&&r.push({kind:"text",text:n[1]}),r.push({kind:"arg",prefix:n[2],index:parseInt(n[3]),default:n[4],isOptional:!!n[5]})),n;);null!=i?r.push({kind:"text",text:e.substr(i)}):r.push({kind:"text",text:e});return{parts:r}}(a.attributes.py2tsOverride);if(g){s&&!o&&$(e,9550,lf("missing recv"));var x=function(e,n,t){for(var r=[],i=0,a=e.parts;i<a.length;i++){var o=a[i];if("text"===o.kind)r.push(z.mkText(o.text));else if(n[o.index]||o.default)o.prefix&&r.push(z.mkText(o.prefix)),n[o.index]?r.push(n[o.index]):r.push(z.mkText(o.default));else if(!o.isOptional)return}if(t)return z.mkInfix(t,".",z.mkGroup(r));return z.mkGroup(r)}(g,p,s?Be(o):void 0);return x||$(e,9555,lf("buildOverride failed unexpectedly")),x}}else if(a.attributes.pyHelper)return z.mkGroup([z.mkInfix(z.mkText("_py"),".",z.mkText(a.attributes.pyHelper)),z.mkText("("),z.mkCommaSep(o?[Be(o)].concat(p):p),z.mkText(")")]);var T,h=s?z.mkInfix(Be(o),".",z.mkText(s)):Be(e.func),S=[h,z.mkText("("),z.mkCommaSep(p),z.mkText(")")];return a&&1==p.length&&N(a)&&(S=[h,(T=p[0],T.type==z.NT.Prefix&&'"'==T.op[0]?z.mkText(z.backtickLit(JSON.parse(T.op))):T)]),i&&(r&&r.pyQName||$(e,9551,lf("missing namedSymbol or pyQName")),S[0]=z.mkText(P(r.pyQName)),S.unshift(z.mkText("new "))),z.mkGroup(S)},Num:function(e){return e.tsType||$(e,9556,lf("tsType missing")),X(e,e.tsType,l),z.mkText(e.ns)},Str:function(e){return e.tsType||$(e,9557,lf("tsType missing")),X(e,e.tsType,a),z.mkText(z.stringLit(e.s))},FormattedValue:function(e){return i(e)},JoinedStr:function(e){return i(e)},Bytes:function(e){return z.mkText("hex`"+Je.U.toHex(new Uint8Array(e.s))+"`")},NameConstant:function(e){return null!=e.value&&(e.tsType||$(e,9558,lf("tsType missing")),X(e,e.tsType,c)),z.mkText(JSON.stringify(e.value))},Ellipsis:function(e){return i(e)},Constant:function(e){return i(e)},Attribute:function(e){var n=Be(e.value),t=ue(e.value),r=ie(e.value,e.attr),i=e.attr;if(Le(e,"memberCompletion"),r)e.symbolInfo=r,Fe(e,r),e.tsType&&r.pyRetType||$(e,9559,lf("tsType or pyRetType missing")),X(e,e.tsType,r.pyRetType),i=r.name;else if(t.moduleType){var a=E(t.moduleType.pyQName+"."+e.attr);a?(e.symbolInfo=a,Fe(e,a),J(e,T(a)),i=a.name):$(e,9514,Je.U.lf("module '{0}' has no attribute '{1}'",t.moduleType.pyQName,e.attr))}else 2<x&&$(e,9515,Je.U.lf("unknown object type; cannot lookup attribute '{0}'",e.attr));return z.mkInfix(n,".",z.mkText(Ee(i)))},Subscript:function(e){if("Index"==e.slice.kind){var n=e.slice.value;return 2<x&&L(ue(n))&&J(n,l),z.mkGroup([Be(e.value),z.mkText("["),Be(n),z.mkText("]")])}if("Slice"==e.slice.kind){var t=e.slice;return z.mkInfix(Be(e.value),".",z.H.mkCall("slice",[t.lower?Be(t.lower):z.mkText("0"),t.upper?Be(t.upper):null].filter(f)))}return i(e)},Starred:function(e){return z.mkGroup([z.mkText("... "),Be(e.value)])},Name:function(e){if(Le(e,"identifierCompletion"),"self"==e.id&&b.currClass)return e.tsType||$(e,9560,lf("missing tsType")),F(e,e.tsType,b.currClass.symInfo),z.mkText("this");var n=Re(e);return n&&n.isImport?Ue(n.name):(De(n,e),0<=e.ctx.indexOf("Load")?(n&&!n.qName&&$(e,9561,lf("missing qName")),Ue(n?n.qName:Ce(e))):Ne(e))},List:Me,Tuple:Me};function Re(e){var n=se(e.id);if(!n){var t=Je.U.lookup(_e,e.id);t&&(n=se(t.n))}if(n){if(e.symbolInfo=n,e.tsType||$(e,9562,lf("missing tsType")),X(e,e.tsType,T(n)),n.isImport)return n;Fe(e,n)}else 0<x&&$(e,9516,Je.U.lf("name '{0}' is not defined",e.id));return n}function De(e,n){if(e){if(e.modifier===O.VarModifier.Global)(t=S())&&t.vars[e.name]&&(e=t.vars[e.name]);else if(e.modifier===O.VarModifier.NonLocal){var t;(t=ze(e.name,C()))&&(e=t.vars[e.name])}(void 0===e.firstRefPos||e.firstRefPos>n.startPos)&&(e.firstRefPos=n.startPos)}}function Me(e){return e.tsType||$(e,9563,lf("missing tsType")),X(e,e.tsType,g(e.elts[0]?ue(e.elts[0]):k())),z.mkGroup([z.mkText("["),z.mkCommaSep(e.elts.map(Be)),z.mkText("]")])}function Be(e){var n=Oe[(u=e).kind];return n||Je.U.oops(e.kind+" - unknown expr"),ue(e),n(e)}function qe(e){var n=be[(u=e).kind];n||Je.U.oops(e.kind+" - unknown stmt");var t=(e._comments||[]).map(function(e){return e.value}),r=n(e);return t.length&&(r=z.mkGroup(t.map(function(e){return z.mkStmt(z.H.mkComment(e))}).concat(r))),r}function Ge(e){return!e||(e.type==z.NT.Prefix&&""==e.op?e.children.every(Ge):e.type==z.NT.NewLine)}function ze(e,n){if(n){var t=n.vars&&n.vars[e];return t&&t.modifier!=O.VarModifier.NonLocal?n:ze(e,n.parent)}}function Qe(e){for(var n,t,r,i,a=[],o=0,s=Object.keys(e.vars);o<s.length;o++){var u=s[o];We(n=e.vars[u],e)&&a.push((void 0,r=Ue((t=n).name),i=_(T(t)),z.mkStmt(z.mkGroup([z.mkText("let "),r,z.mkText(": "+i+";")]))))}return a}function We(e,n){return!!(4===e.kind&&void 0===e.modifier&&(e.firstRefPos<e.firstAssignPos||e.firstAssignDepth>n.blockDepth))}function je(e){if(Je.U.assert("Module"==e.kind),!e.tsBody){var n;b={currClass:void 0,currFun:void 0,currModule:n=e,blockDepth:0},M=n.tsFilename.replace(/\.ts$/,".py"),e.vars||(e.vars={});var t=Qe(e).concat(e.body.map(qe));if(!t.every(Ge))return"main"==e.name?t:[z.mkText("namespace "+e.name+" "),z.mkBlock(t)]}}function Ve(e){x=e,B=[],u=void(Q=0)}function He(r){var e=[],n={};B=[],r.sourceFiles||$(null,9566,lf("missing sourceFiles"));var t=r.sourceFiles.filter(function(e){return Je.U.endsWith(e,".py")});if(0==t.length)return{generated:n,diagnostics:B};var i=function(e,n){return e.substr(0,e.length-n.length)},a=Je.U.toDictionary(t,function(e){return i(e,".py")}),o=r.sourceFiles.filter(function(e){return Je.U.endsWith(e,".ts")}).filter(function(e){return i(e,".ts")in a});r.apisInfo||$(null,9567,lf("missing apisInfo")),M=t[0],function(e,n){D={},R={};for(var t=Je.U.toDictionary(n,function(e){return e}),r=function(e){if(t.hasOwnProperty(e.fileName))return"continue";var n=e;n.extendsTypes&&(n.extendsTypes=n.extendsTypes.filter(function(e){return e!=n.qName})),n.pyQName&&n.qName||$(null,9526,Je.U.lf("Symbol '{0}' is missing qName for '{1}'",n.name,n.pyQName?"ts":"py")),R[n.pyQName]=n,R[n.qName]=n},i=0,a=Je.U.values(e.byQName);i<a.length;i++)r(a[i]);j=H("Buffer")}(r.apisInfo,o),q=void 0,r.generatedFiles||(r.generatedFiles=[]);for(var s=0,u=t;s<u.length;s++){var l=u[s],c=l,f=l.replace(/\.py$/,"").replace(/.*\//,""),p=r.fileSystem[l];try{M=l;var m=Je.py.lex(p),d=Je.py.parse(p,c,m);Je.U.pushRange(B,d.diagnostics),e.push({kind:"Module",body:d.stmts,blockDepth:0,name:f,source:p,tsFilename:c.replace(/\.py$/,".ts")})}catch(e){console.log("Parse error",e)}}for(var y=B,v=0;v<5;++v){Ve(v);for(var k=0,g=e;k<g.length;k++){var x=g[k];try{je(x)}catch(e){console.log("Conv pass error",e)}}if(0==Q)break}Ve(1e3),W=void 0,q=r.syntaxInfo;for(var T=0,h=e;T<h.length;T++){x=h[T];try{var S=je(x);if(!S)continue;d=z.flattenNode(S);r.sourceFiles.push(x.tsFilename),r.generatedFiles.push(x.tsFilename),r.fileSystem[x.tsFilename]=d.output,n[x.tsFilename]=d.output}catch(e){console.log("Conv error",e)}}B=y.concat(B);if(q&&(q.symbols=[]),W&&$(null,9569,lf("type annotation error; this should be unreachable")),q&&W){W=W;var b=Je.U.values(R).concat(Je.U.values(D));if(q.beginPos=W.startPos,q.endPos=W.endPos,q.symbols||(q.symbols=[]),"memberCompletion"==q.type&&"Attribute"==W.kind){var N=ue(W.value);if(N.moduleType)for(var E=0,C=b;E<C.length;E++){(P=C[E]).isInstance||P.namespace!=N.moduleType.qName||q.symbols.push(P)}else if(N.classType||N.primType){var U=N.classType||ae(N.primType).reduce(function(e,n){return e||n},null);if(U){U.extendsTypes&&U.qName||$(null,9567,lf("missing extendsTypes or qName"));for(var I=U.extendsTypes.concat(U.qName),w=0,A=b;w<A.length;w++){var P;(P=A[w]).isInstance&&0<=I.indexOf(P.namespace)&&q.symbols.push(P)}}}}else if("identifierCompletion"==q.type){var _=[],K=function(e){(function(e){switch(e.kind){case 6:case 7:case 4:case 3:case 5:return!0;case 2:case 1:return!e.isInstance;default:return!1}})(e)&&_.indexOf(e)<0&&q.symbols.push(e)};_=q.symbols.slice();for(var L=G;L;L=L.parent)L&&L.vars&&Je.U.values(L.vars).forEach(K);b.forEach(K)}else{var F=W.symbolInfo;F&&q.symbols.push(F)}q.symbols=q.symbols.map(V)}return{generated:n,diagnostics:function(){for(var e=0,n=B;e<n.length;e++){var t=n[e];O.patchPosition(t,r.fileSystem[t.fileName])}return B}()}}function $e(e){return e.target.preferredEditor==Je.PYTHON_PROJECT_NAME?He(e).diagnostics:[]}O.py2ts=He,O.convert=$e,Je.conversionPasses.push($e)}(Je.py||(Je.py={}))}(pxt||(pxt={})),function(K){!function(h){var S,e;(e=S=h.TokenType||(h.TokenType={}))[e.Id=0]="Id",e[e.Op=1]="Op",e[e.Keyword=2]="Keyword",e[e.Number=3]="Number",e[e.String=4]="String",e[e.NewLine=5]="NewLine",e[e.Comment=6]="Comment",e[e.Indent=7]="Indent",e[e.Dedent=8]="Dedent",e[e.EOF=9]="EOF",e[e.Error=10]="Error";var b,N,i,E,a={False:!0,None:!0,True:!0,and:!0,as:!0,assert:!0,async:!0,await:!0,break:!0,class:!0,continue:!0,def:!0,del:!0,elif:!0,else:!0,except:!0,finally:!0,for:!0,from:!0,global:!0,if:!0,import:!0,in:!0,is:!0,lambda:!0,nonlocal:!0,not:!0,or:!0,pass:!0,raise:!0,return:!0,try:!0,while:!0,with:!0,yield:!0},C=[],U={"%":"Mod","&":"BitAnd","*":"Mult","**":"Pow","+":"Add","-":"Sub","/":"Div","//":"FloorDiv","<<":"LShift",">>":"RShift","@":"MatMult","^":"BitXor","|":"BitOr"},I={"!":"Bang","!=":"NotEq","(":"LParen",")":"RParen",",":"Comma","->":"Arrow",".":"Dot",":":"Colon",";":"Semicolon","<":"Lt","<=":"LtE","=":"Assign","==":"Eq",">":"Gt",">=":"GtE","[":"LSquare","]":"RSquare","{":"LBracket","}":"RBracket","~":"Invert"},w={b:/^[_0-1]$/,B:/^[_0-1]$/,o:/^[_0-7]$/,O:/^[_0-7]$/,x:/^[_0-9a-fA-F]$/,X:/^[_0-9a-fA-F]$/},A={b:2,B:2,o:8,O:8,x:16,X:16},P=0,_=0;function r(e,n){for(var t=0,r=0,i=0;i<e;++i)10==n.charCodeAt(i)&&(t++,r=i);return{line:t,column:e-r-1}}function s(e){switch(e.type){case S.Id:return"id("+e.value+")";case S.Op:return"'"+N[e.value]+"'";case S.Keyword:return e.value;case S.Number:return"num("+e.value+")";case S.String:return e.stringPrefix+JSON.stringify(e.value);case S.NewLine:return"<nl>";case S.Comment:return"/* "+e.value+" */";case S.Indent:return"indent"+e.value;case S.Dedent:return"dedent";case S.Error:return"[ERR: "+e.value+"]";case S.EOF:return"End of file";default:return"???"}}h.position=r,h.patchPosition=function(e,n){if(!e.start&&!e.length)return e.start=0,e.length=0,e.line=0,void(e.column=0);var t=r(e.start,n);e.line=t.line,e.column=t.column,0<e.length&&(t=r(e.start+e.length-1,n),e.endLine=t.line,e.endColumn=t.column+2)},h.tokenToString=s,h.friendlyTokenToString=function(e,n){var t=e.endPos-e.startPos;return(0==t?s(e):20<t?"`"+n.slice(e.startPos,e.startPos+20)+"`...":"`"+n.slice(e.startPos,e.endPos)+"`").replace(/\r/g,"").replace(/\n/g,"\\n").replace(/\t/g,"\\t")},h.tokensToString=function(e){for(var n="",t=0,r=0,i=e;r<i.length;r++){var a=i[r],o=s(a);70<t+o.length&&(t=0,n+="\n"),0!=t&&(n+=" "),n+=o,t+=o.length,a.type!=S.NewLine&&a.type!=S.Comment||(t=0,n+="\n")}return n},h.lex=function(e){for(0==C.length&&function(){var s={'"':c,"'":c,"#":v,"\\":y,".":g};b=K.U.clone(I);for(var e=0,n=Object.keys(U);e<n.length;e++){var t=n[e];b[t]=U[t],b[t+"="]=U[t]+"Assign"}N={};for(var r=0,i=Object.keys(b);r<i.length;r++){var t=i[r];N[b[t]]=t}for(var a=function(e){if(h.rx.isIdentifierStart(e))C[e]=u;else{var n=String.fromCharCode(e);if(s.hasOwnProperty(n))C[e]=s[n];else if(b.hasOwnProperty(n)){for(var t=!1,r=b[n],i=0,a=Object.keys(b);i<a.length;i++){var o=a[i];o!=n&&o.startsWith(n)&&(t=!0)}C[e]=t?function(){return function(e){var n=E.slice(_,P+1);if(2==n.length&&b.hasOwnProperty(n)){var t=E.slice(_,P+2);3==t.length&&b.hasOwnProperty(t)?(P+=2,e=b[t]):(P++,e=b[n])}l(e)}(r)}:function(){return l(r)}}else h.rx.isSpace(e)?C[e]=function(){}:13==e?C[e]=function(){10==E.charCodeAt(P)&&P++,f()}:h.rx.isNewline(e)?C[e]=f:x(e)?C[e]=k:C[e]=T}},o=0;o<128;++o)a(o)}(),E=e,i=[],_=P=0,r();P<E.length;){_=P;var n=E.charCodeAt(P++);n<128?C[n]():h.rx.isIdentifierStart(n)?u():h.rx.isSpace(n)||(h.rx.isNewline(n)?f():T())}return _=P,f(),p(S.EOF,""),i;function p(e,n,t){var r={type:e,value:n,startPos:_,endPos:P,auxValue:t};return i.push(r),r}function m(e){p(S.Error,e)}function u(){for(;h.rx.isIdentifierChar(E.charCodeAt(P));)P++;var e=E.slice(_,P),n=E.charCodeAt(P);a.hasOwnProperty(e)?p(S.Keyword,e):34==n||39==n?t(e):p(S.Id,e)}function l(e){p(S.Op,e)}function d(e){switch(e){case 97:return 7;case 98:return 8;case 102:return 12;case 110:return 10;case 114:return 13;case 116:return 9;case 118:return 11;default:return 0}}function t(e){var n=E.charCodeAt(P++),t=!1;E.charCodeAt(P)==n&&E.charCodeAt(P+1)==n&&(P+=2,t=!0);for(var r=0<=(e=e.toLowerCase()).indexOf("r"),i="",a="";;){var o=E.charCodeAt(P++);if(o==n){if(!t)break;if(E.charCodeAt(P)==n&&E.charCodeAt(P+1)==n){P+=2;break}a+="\\"+String.fromCharCode(n),i+=String.fromCharCode(n)}else if(92==o){var s=E.charCodeAt(P++);if(13==s&&10==E.charCodeAt(P)&&(s=10,P++),34==s||39==s||92==s)r&&(a+="\\",i+="\\"),a+="\\"+String.fromCharCode(s),i+=String.fromCharCode(s);else if(!r&&d(s))a+="\\"+String.fromCharCode(s),i+=String.fromCharCode(d(s));else if(h.rx.isNewline(s))r&&(i+="\\"+String.fromCharCode(s),a+="\\\\",a+=10==s?"\\n":"\\u"+("0000"+s.toString(16)).slice(-4));else if(r||48!=s)if(r||117!=s&&120!=s)a+="\\\\"+String.fromCharCode(s),i+="\\"+String.fromCharCode(s);else{var u=117==s?4:2,l=E.slice(P,P+u);P+=u;var c=parseInt(l,16);isNaN(c)&&m(K.U.lf("invalid unicode or hex escape")),a+="\\"+String.fromCharCode(s)+l,i+=String.fromCharCode(c)}else a+="\\\\x00",i+="\0"}else{if(isNaN(o)){m(K.U.lf("end of file in a string"));break}if(h.rx.isNewline(o)&&!t){m(K.U.lf("new line in a string"));break}i+=String.fromCharCode(o),a+=String.fromCharCode(o)}}var f=p(S.String,i);f.quoted=a,f.stringPrefix=e}function c(){P--,t("")}function f(){p(S.NewLine,""),r()}function r(){for(var e=0;;){var n=E.charCodeAt(P);if(9!=n){if(32!=n)break;e++,P++}else e=e+8&-8,P++}p(S.Indent,""+e)}function y(){var e=E.charCodeAt(P);h.rx.isNewline(e)?(P++,13==e&&10==E.charCodeAt(P)&&P++):m(K.U.lf("unexpected character after line continuation character"))}function v(){for(p(S.NewLine,"");P<E.length&&!h.rx.isNewline(E.charCodeAt(P));)P++;p(S.Comment,E.slice(_+1,P)),13==E.charCodeAt(P)&&10==E.charCodeAt(P+1)&&P++,P++,r()}function k(){var e=E[_],n="";if("0"==e){var t=E[P],r=w[t];if(r){for(P++;;){var i=E[P];if(!r.test(i))break;n+=i,P++}if(n){var a=parseInt(n,A[t]);isNaN(a)&&m(K.U.lf("invalid number")),p(S.Number,e+t+n,a)}else m(K.U.lf("expecting numbers to follow 0b, 0o, 0x"));return}}var o=!1,s=!1,u=!1;for(P=_;;){if(i=E.charCodeAt(P),!u||43!=i&&45!=i)if(u=!1,95==i||x(i));else if(s||o||46!=i){if(s||69!=i&&101!=i)break;u=s=!0}else o=!0;n+=String.fromCharCode(i),P++}!o&&!s&&"0"==e&&1<n.length&&!/^0+/.test(n)&&m(K.U.lf("unexpected leading zero"));var l=parseFloat(n);isNaN(l)&&m(K.U.lf("invalid number")),p(S.Number,n,l)}function g(){x(E.charCodeAt(P))?k():p(S.Op,"Dot")}function x(e){return 48<=e&&e<=57}function T(){m(K.U.lf("invalid token"))}}}(K.py||(K.py={}))}(pxt||(pxt={})),function(Ie){!function(p){var m,a,i,o,s,d,u,y,v,k=!1,g="";function x(){return a[s]}function l(){for(;a[s];s++){var e=a[s];if(e.type!=p.TokenType.Comment){if(0<=m&&e.type==p.TokenType.Op)switch(e.value){case"LParen":case"LSquare":case"LBracket":m++;break;case"RParen":case"RSquare":case"RBracket":m--}if(e.type!=p.TokenType.Error){if(0<m){if(e.type==p.TokenType.NewLine||e.type==p.TokenType.Indent)continue}else if(e.type==p.TokenType.Indent){if(a[s+1].type==p.TokenType.NewLine){s++;continue}var n=parseInt(e.value),t=u[u.length-1];if(n==t)continue;if(t<n)return void u.push(n);e.type=p.TokenType.Dedent;for(var r=0;u.length;){var i=u[u.length-1];if(!(n<i)){for(i!=n&&h(9552,Ie.U.lf("inconsitent indentation"));1<r;)a.splice(s,0,e),r--;return}u.pop(),r++}}return}h(9551,e.value)}else d.push(e)}}function T(){(y=x()).type!=p.TokenType.EOF&&(s++,l())}function h(e,n){n||(n=Ie.U.lf("invalid syntax")),e||(e=9550);var t=x(),r={code:e,category:pxtc.DiagnosticCategory.Error,messageText:Ie.U.lf("{0} near {1}",n,p.friendlyTokenToString(t,i)),fileName:o,start:t.startPos,length:t.endPos?t.endPos-t.startPos:0,line:0,column:0};p.patchPosition(r,i),k&&Ie.log(g+"TS"+e+" "+r.messageText+" at "+(r.line+1)+","+(r.column+1)),v.push(r),9572!=e&&100<v.length&&Ie.U.userError(Ie.U.lf("too many parse errors"))}function n(e,n){var t=x();(t.type==e&&t.value==n||(h(9553,Ie.U.lf("expecting {0}",p.tokenToString({type:e,value:n,startPos:0,endPos:0}))),t.type!=p.TokenType.NewLine))&&T()}function S(){n(p.TokenType.NewLine,"")}function c(e){n(p.TokenType.Keyword,e)}function f(e){n(p.TokenType.Op,e)}function b(){var e=x();return e.type==p.TokenType.Keyword?e.value:""}function N(){var e=x();return e.type==p.TokenType.Op?e.value:""}var E={if:function e(){var n=C("If");T();n.test=j();n.body=r();"elif"==b()?n.orelse=[e()]:n.orelse=I();return U(n)},while:function(){var e=C("While");return c("while"),e.test=j(),e.body=r(),e.orelse=I(),U(e)},for:function(){var e=C("For");return c("for"),e.target=M(),B(e.target),c("in"),e.iter=D(),e.body=r(),e.orelse=I(),U(e)},try:function(){var e=C("Try");c("try"),e.body=r(),e.handlers=[];for(var n=!1;"except"==b();){var t=C("ExceptHandler");e.handlers.push(t),T(),"Colon"!=N()?(n&&h(),t.type=j(),"as"==b()?(T(),t.name=xe()):t.name=void 0):(n=!0,t.type=void 0,t.name=void 0),t.body=r()}e.orelse=I(),0==e.handlers.length&&e.orelse.length&&h();"finally"==b()?(T(),e.finalbody=r()):e.finalbody=[];return U(e)},with:function(){var e=C("With");return c("with"),e.items=ve(Ie.U.lf("with item"),w),e.body=r(),U(e)},def:function(){var e=C("FunctionDef");c("def"),e.name=xe(),f("LParen"),e.args=Q(!0),f("RParen"),e.returns=void 0,"Arrow"==N()&&(T(),e.returns=j());return e.body=r(),U(e)},class:function(){var e=C("ClassDef");if(c("class"),e.name=xe(),"LParen"==N()){var n=Te();e.bases=n.args,e.keywords=n.keywords}else e.bases=[],e.keywords=[];return e.body=r(),U(e)}},t={del:function(){var e=C("Delete");return c("del"),e.targets=ye(Ie.U.lf("expression"),oe),U(e)},pass:function(){var e=C("Pass");return c("pass"),U(e)},break:function(){var e=C("Break");return T(),U(e)},continue:function(){var e=C("Continue");return T(),U(e)},return:function(){var e=C("Return");T(),P()?e.value=void 0:e.value=D();return U(e)},raise:function(){var e=C("Raise");c("raise"),e.exc=void 0,e.cause=void 0,P()||(e.exc=j(),"from"==b()&&(T(),e.cause=j()));return U(e)},global:_,nonlocal:function(){var e=_();return e.kind="Nonlocal",e},import:function(){var e=C("Import");return T(),e.names=ve(Ie.U.lf("import name"),L),U(e)},from:function(){var e=C("ImportFrom");T(),e.level=function(){for(var e=0;;)if("Dot"==N())e+=1,T();else{if("Ellipsis"!=N())return e;e+=3,T()}}(),x().type==p.TokenType.Id?e.module=K():e.module=void 0;e.level||e.module||h();if(c("import"),"Mult"==N()){T();var n=C("Alias");n.name="*",e.names=[n]}else"LParen"==N()?(T(),e.names=ye(Ie.U.lf("import name"),F),f("RParen")):e.names=ye(Ie.U.lf("import name"),F);return U(e)},assert:function(){var e=C("Assert");T(),e.test=j(),"Comma"==N()?(T(),e.msg=j()):e.msg=void 0;return U(e)},yield:function(){x();if(T(),"from"==b()){var e=C("YieldFrom");return e.value=j(),A(U(e))}var n=C("Yield");P()||(n.value=D());return A(U(n))}};function r(){return f("Colon"),function(){{if(x().type==p.TokenType.NewLine){var e=g;k&&(Ie.log(g+"{"),g+="  "),T();var n=NaN;x().type!=p.TokenType.Indent?h(9554,Ie.U.lf("expecting indent")):n=parseInt(x().value),T();for(var t=z();;){if(x().type==p.TokenType.Dedent){var r=isNaN(n)||parseInt(x().value)<n;if(T(),r)break}Ie.U.pushRange(t,z())}return k&&(g=e,Ie.log(g+"}")),t}return G()}}()}function C(e,n){var t=n||x();return{startPos:t.startPos,endPos:t.endPos,kind:e}}function U(e){return e.endPos=y.endPos,e}function I(){return"else"==b()?(T(),r()):[]}function w(){var e=C("WithItem");return e.context_expr=j(),e.optional_vars=void 0,"as"==b()&&(T(),e.optional_vars=oe()),U(e)}function A(e){var n=C("ExprStmt");return n.startPos=e.startPos,n.endPos=e.endPos,n.value=e,n}function P(){var e=x();return e.type==p.TokenType.NewLine||e.type==p.TokenType.Op&&"Semicolon"==e.value}function _(){var e=C("Global");for(T(),e.names=[];e.names.push(xe()),"Comma"==N();)T();return U(e)}function K(){for(var e="";;){if(e+=xe(),"Dot"!=N())return e;e+=".",T()}}function L(){var e=C("Alias");return e.name=K(),"as"==b()?(T(),e.asname=xe()):e.asname=void 0,U(e)}function F(){var e=C("Alias");return e.name=xe(),"as"==b()?(T(),e.asname=xe()):e.asname=void 0,U(e)}function O(e,n){var t=C("Tuple",e);return t.elts=n,U(t)}function e(e){var n=x(),t=ye(Ie.U.lf("expression"),e),r=t[0];return 1!=t.length?O(n,t):r}function R(){return e(ue)}function D(){return e(j)}function M(){return e(oe)}function B(e){"Tuple"==e.kind?e.elts.forEach(B):e.ctx="Store"}function q(){var e=Ie.U.lookup(t,b());return e?e():function(){var e=x(),n=R(),t=N();if("Assign"==t){var r=C("Assign");for(r.targets=[n];;){if(T(),n=R(),"Assign"!=(t=N())){r.value=n;break}r.targets.push(n)}return r.targets.forEach(B),U(r)}if("Colon"==t){var i=C("AnnAssign");return i.target=n,T(),i.annotation=j(),"Assign"==N()&&(T(),i.value=j()),i.simple=e.type==p.TokenType.Id&&"Name"==n.kind?1:0,B(i.target),U(i)}if(Ie.U.endsWith(t,"Assign")){var a=C("AugAssign");return a.target=n,a.op=t.replace("Assign",""),T(),a.value=D(),B(a.target),U(a)}if("Semicolon"==t||x().type==p.TokenType.NewLine){var o=C("ExprStmt");return o.value=n,U(o)}return h(9555,Ie.U.lf("unexpected token")),T(),null}()}function G(){for(var e=[q()];"Semicolon"==N()&&(T(),x().type!=p.TokenType.NewLine);)e.push(q());return S(),e.filter(function(e){return!!e})}function z(){x().type==p.TokenType.Indent&&(h(9573,Ie.U.lf("unexpected indent")),T());for(var e=v.length,n=[];"MatMult"==N();)T(),n.push(Se()),S();var t=b(),r=Ie.U.lookup(E,b()),i=[],a=d;(d=[],"class"==t||"def"==t)?((f=r()).decorator_list=n,i=[f]):n.length?h(9556,Ie.U.lf("decorators not allowed here")):i=r?[r()]:G();a.length&&i.length&&(i[0]._comments=a);var o,s,u=[];if(v.length>e){for(m=-1;y.type!=p.TokenType.Dedent&&y.type!=p.TokenType.NewLine&&(T(),k&&u.push(p.tokenToString(x())),x().type!=p.TokenType.EOF););m=0,k&&Ie.log(g+"skip: "+u.join(", "))}if(k)for(var l=0,c=i;l<c.length;l++){var f=c[l];o="stmt",s=f,k&&Ie.log(g+o+": "+s.kind)}return i}function Q(n){var e=C("Arguments");for(e.args=[],e.defaults=[],e.kwonlyargs=[],e.kw_defaults=[],e.vararg=void 0;;){var t=N();if("Colon"==t||"RParen"==t)break;if("Mult"==t)e.vararg&&h(9557,Ie.U.lf("multiple *arg")),T(),x().type==p.TokenType.Id?e.vararg=a():e.vararg=void 0;else if("Pow"==t)e.kwarg&&h(9558,Ie.U.lf("multiple **arg")),T(),e.kwarg=a();else{e.kwarg&&h(9559,Ie.U.lf("arguments after **"));var r=a(),i=void 0;"Assign"==N()&&(T(),i=j()),void 0!==e.vararg&&i?(e.kwonlyargs.push(r),e.kw_defaults.push(i)):(e.args.push(r),i?e.defaults.push(i):e.defaults.length&&h(9560,Ie.U.lf("non-default argument follows default argument")))}if("Comma"!=N())break;T()}return e.kwarg||(e.kwarg=void 0),e.vararg||(e.vararg=void 0),U(e);function a(){var e=C("Arg");return e.arg=xe(),e.annotation=void 0,n&&"Colon"==N()&&(T(),e.annotation=j()),e}}function W(e){var n=C("Lambda");return T(),n.args=Q(!1),f("Colon"),n.body=e?le():j(),U(n)}function j(){if("lambda"==b())return W();var e=x(),n=$();if("if"==b()){var t=C("IfExp",e);return t.body=n,c("if"),t.test=$(),c("else"),t.orelse=j(),U(t)}return n}function V(e,n){var t=x(),r=n();if(b()==e){var i=C("BoolOp",t);for(i.op="or"==e?"Or":"And",i.values=[r];b()==e;)c(e),i.values.push(n());return U(i)}return r}function H(){return V("and",J)}function $(){return V("or",H)}function J(){if("not"==b()){var e=C("UnaryOp");return T(),e.op="Not",e.operand=J(),U(e)}return function(){var e=x(),n=oe();if(!Y())return n;var t=C("Compare",e);t.left=n,t.comparators=[],t.ops=[];for(;;){var r=Y();if(!r)break;T(),"NotIn"==r?c("in"):"Is"==r&&"not"==b()&&(T(),r="IsNot"),t.ops.push(r),t.comparators.push(oe())}return U(t)}()}var X={Lt:"Lt",Gt:"Gt",Eq:"Eq",GtE:"GtE",LtE:"LtE",NotEq:"NotEq",in:"In",not:"NotIn",is:"Is"};function Y(){return X[N()]||X[b()]||null}var Z={Invert:"Invert",Sub:"USub",Add:"UAdd"};function ee(e,n){for(var t=x(),r=e();;){var i=N();if(!(i&&0<=n.indexOf(","+i+",")))return r;var a=C("BinOp",t);a.left=r,a.op=i,T(),a.right=e(),r=a}}function ne(){return ee(be,",Mult,MatMult,Div,Mod,FloorDiv,")}function te(){return ee(ne,",Add,Sub,")}function re(){return ee(te,",LShift,RShift,")}function ie(){return ee(re,",BitAnd,")}function ae(){return ee(ie,",BitXor,")}function oe(){return ee(ae,",BitOr,")}function se(){var e=x(),n=void 0;if("Colon"!=N()&&(n=j()),"Colon"==N()){var t;(t=C("Slice",e)).lower=n,T();var r=N();return t.upper="Colon"!=r&&"Comma"!=r&&"RSquare"!=r?j():void 0,t.step=void 0,"Colon"==N()&&(T(),"Comma"!=(r=N())&&"RSquare"!=r&&(t.step=j())),U(t)}return n||h(9570,Ie.U.lf("unable to parse lower subscript")),(t=C("Index")).value=n,U(t)}function ue(){if("Mult"==N()){var e=C("Starred");return e.value=oe(),U(e)}return j()}function le(){return"lambda"==b()?W(!0):$()}function ce(){for(var e=[];;){var n=C("Comprehension");for(n.is_async=0,e.push(n),c("for"),n.target=M(),B(n.target),c("in"),n.iter=$(),n.ifs=[];"if"==b();)T(),n.ifs.push(le());if("for"!=b())return e}}function fe(){var e=x();if("Mult"==N()){var n=C("Starred");return T(),n.value=j(),U(n)}if("Pow"==N()){n=C("Keyword");return T(),n.arg=void 0,n.value=j(),U(n)}var t=j();return"Assign"==N()?("Name"!=t.kind&&h(9561,Ie.U.lf("invalid keyword argument; did you mean ==?")),T(),(n=C("Keyword",e)).arg=t.id||"???",n.value=j(),U(n)):"for"==b()?((n=C("GeneratorExp",e)).elt=t,n.generators=ce(),U(n)):t}function pe(){var e=C("NameConstant");return e.value=void 0,T(),U(e)}function me(){var e=x();if(e.type==p.TokenType.Id){var n=C("Name");return T(),n.id=e.value,n.ctx="Load",U(n)}if(e.type==p.TokenType.Number){n=C("Num");return T(),n.ns=e.value,n.n=e.auxValue,U(n)}if(e.type==p.TokenType.String){T();for(var t=e.value;x().type==p.TokenType.String;)t+=x().value,T();return"b"==e.stringPrefix?(n=C("Bytes",e)).s=Ie.U.toArray(Ie.U.stringToUint8Array(t)):(n=C("Str",e)).s=t,U(n)}if(e.type==p.TokenType.Keyword){if("None"==e.value||"True"==e.value||"False"==e.value){n=C("NameConstant");return T(),n.value="True"==e.value||"False"!=e.value&&void 0,U(n)}return h(9564,Ie.U.lf("expecting atom")),pe()}if(e.type==p.TokenType.Op){var r=e.value;return"LParen"==r?ge("RParen","Tuple","GeneratorExp"):"LSquare"==r?ge("RSquare","List","ListComp"):"LBracket"==r?function(){var s=x();if(T(),"Pow"==N())return T(),t(void 0,oe());if("RBracket"==N()){var e=C("Dict",s);return T(),e.keys=[],e.values=[],U(e)}var n=ue();return"Starred"!=n.kind&&"Colon"==N()?(T(),t(n,j())):function(e){if("for"==b()){"Starred"==e.kind&&h(9562,Ie.U.lf("iterable unpacking cannot be used in comprehension"));var n=C("SetComp",s);return n.elt=e,n.generators=ce(),U(n)}var t=C("Set",s);if(t.elts=[e],"Comma"==N()){var r=ke("RBracket",Ie.U.lf("set element"),ue);t.elts=[e].concat(r)}else f("RBracket");return U(t)}(n);function u(){if("Pow"==N())return T(),[null,oe()];var e=j();return f("Colon"),[e,j()]}function t(e,n){if("for"==b()){e||h(9563,Ie.U.lf("dict unpacking cannot be used in dict comprehension"));var t=C("DictComp",s);return t.key=e,t.value=n,t.generators=ce(),U(t)}var r=C("Dict",s);if(r.keys=[e],r.values=[n],"Comma"==N())for(var i=0,a=ke("RBracket",Ie.U.lf("dict element"),u);i<a.length;i++){var o=a[i];2<=o.length&&o[0]&&o[1]&&(r.keys.push(o[0]),r.values.push(o[1]))}else f("RBracket");return U(r)}}():(h(9565,Ie.U.lf("unexpected operator")),pe())}return h(9566,Ie.U.lf("unexpected token")),pe()}function de(){var e=N();return"RParen"==e||"RSquare"==e||"RBracket"==e||"Colon"==e||"Semicolon"==e||(!!Ie.U.endsWith(e,"Assign")||("in"==b()||x().type==p.TokenType.NewLine))}function ye(e,n){var t=[];if(de())return t;for(;;){t.push(n());var r="Comma"==N();if(r&&T(),de())return t;if(!r)return h(9567,Ie.U.lf("expecting {0}",e)),t}}function ve(e,n){for(var t=[];t.push(n()),"Comma"==N();)T();return t}function ke(e,n,t){T();var r=[];if(N()!=e)for(;;){r.push(t());var i="Comma"==N();if(i&&T(),N()==e)break;if(!i){h(9568,Ie.U.lf("expecting {0}",n));break}}return f(e),r}function ge(e,n,t){var r=x();if(T(),N()==e)return T(),(a=C(n,r)).elts=[],U(a);var i=ue();if("for"==b())return(a=C(t,r)).elt=i,a.generators=ce(),f(e),U(a);if("Comma"==N()){var a=C(n,r);return T(),a.elts=ye(Ie.U.lf("expression"),ue),a.elts.unshift(i),f(e),U(a)}return f(e),"List"==n?((a=C(n,r)).elts=[i],U(a)):i}function xe(){var e=x();return e.type!=p.TokenType.Id&&h(9569,Ie.U.lf("expecting identifier")),T(),e.value}function Te(){for(var e=[],n=[],t=0,r=ke("RParen",Ie.U.lf("argument"),fe);t<r.length;t++){var i=r[t];"Keyword"==i.kind?n.push(i):(n.length&&h(9570,Ie.U.lf("positional argument follows keyword argument")),e.push(i))}return{args:e,keywords:n}}function he(e,n){var t=N();if("LParen"==t){(i=C("Call",e)).func=n;var r=Te();return i.args=r.args,i.keywords=r.keywords,U(i)}if("LSquare"==t){var i,a=x();(i=C("Subscript",e)).value=n;var o=ke("RSquare",Ie.U.lf("subscript"),se);if(0==o.length)h(9571,Ie.U.lf("need non-empty index list"));else if(1==o.length)i.slice=o[0];else if(o.every(function(e){return"Index"==e.kind})){var s=o[0];s.value=O(a,o.map(function(e){return e.value})),i.slice=s}else{var u=C("ExtSlice",a);u.dims=o,i.slice=U(u)}return U(i)}return"Dot"==t?((i=C("Attribute",e)).value=n,T(),i.attr=xe(),U(i)):n}function Se(){for(var e=x(),n=me();;){var t=he(e,n);if(t===n)return n;n=t}}function be(){if(Z[N()]){var e=C("UnaryOp");return e.op=Z[N()],T(),e.operand=be(),U(e)}return function(){x();var e=Se();if("Pow"==N()){var n=C("BinOp");return T(),n.left=e,n.op="Pow",n.right=be(),U(n)}return e}()}var Ne={kind:1,id:2,n:3,s:4,func:5,key:6,elt:7,elts:8,keys:9,left:10,ops:11,comparators:12,names:13,items:14,test:15,targets:16,dims:17,context_expr:18,name:19,bases:20,type:21,inClass:22,target:23,annotation:24,simple:25,op:26,operand:27,right:28,values:29,iter:30,ifs:31,is_async:32,value:33,slice:34,attr:35,generators:36,args:37,keywords:38,body:39,handlers:40,orelse:41,finalbody:42,decorator_list:43,kwonlyargs:44,kw_defaults:45,defaults:46,arg:47},Ee={lineno:1,col_offset:1,startPos:1,endPos:1,kind:1},Ce={body:1,orelse:1,finalbody:1},Ue={_comments:1,ctx:1,ns:1};p.dump=function(e,y){void 0===y&&(y=!1);for(var v=function(e,n){if(Array.isArray(n)){for(var t="",r=0;r<n.length;++r)0<r&&(t+=", "),t+=v(e,n[r]);return"["+t+"]"}if(!n||!n.kind)return JSON.stringify(n);var i="",a=Object.keys(n);a.sort(function(e,n){return(Ne[e]||100)-(Ne[n]||100)||Ie.U.strcmp(e,n)});for(var o=0,s=a;o<s.length;o++){var u=s[o];if(!(Ie.U.lookup(Ee,u)||y&&Ie.U.lookup(Ue,u)))if(i&&(i+=", "),i+=u+"=",Array.isArray(n[u])&&n[u].length&&Ie.U.lookup(Ce,u)){i+="[\n";for(var l=e+"  ",c=0,f=n[u];c<f.length;c++){var p=f[c];i+=l+v(l,p)+"\n"}i+=e+"]"}else if("_comments"==u){i+="[\n",l=e+"  ";for(var m=0,d=n[u];m<d.length;m++)p=d[m],i+=l+JSON.stringify(p.value)+"\n";i+=e+"]"}else i+=v(e,n[u])}return n.kind+"("+i+")"},n="",t=0,r=e;t<r.length;t++){var i=r[t];n+=v("",i)+"\n"}return n},p.parse=function(e,n,t){i=e,o=n,a=t,d=[],u=[s=m=0],v=[];var r=[];try{if(y=a[0],l(),x().type!=p.TokenType.EOF)for(r=z();x().type!=p.TokenType.EOF;)Ie.U.pushRange(r,z())}catch(e){h(9572,Ie.U.lf("exception: {0}",e.message))}return{stmts:r,diagnostics:v}}}(Ie.py||(Ie.py={}))}(pxt||(pxt={})),function(G){!function(n){function B(e,n,t){var r={fileName:e.getSourceFile().fileName,start:e.getStart(),length:e.getEnd()-e.getStart(),line:void 0,column:void 0,code:n,category:pxtc.DiagnosticCategory.Error,messageText:t},i=new Error(t);throw i.pyDiagnostic=r,i}n.decompileToPython=function(e,n){var t={blocksInfo:void 0,outfiles:{},diagnostics:[],success:!0,times:{}};try{var r=function(e,t){var y=[{vars:{}}],v=e.getTypeChecker(),n=(new ts.pxtc.LSHost(e),e.getSourceFile(t)),r=G.U.toSet(["ArithmeticError","AssertionError","AttributeError","BaseException","BlockingIOError","BrokenPipeError","BufferError","BytesWarning","ChildProcessError","ConnectionAbortedError","ConnectionError","ConnectionRefusedError","ConnectionResetError","DeprecationWarning","EOFError","Ellipsis","EnvironmentError","Exception","False","FileExistsError","FileNotFoundError","FloatingPointError","FutureWarning","GeneratorExit","IOError","ImportError","ImportWarning","IndentationError","IndexError","InterruptedError","IsADirectoryError","KeyError","KeyboardInterrupt","LookupError","MemoryError","NameError","None","NotADirectoryError","NotImplemented","NotImplementedError","OSError","OverflowError","PendingDeprecationWarning","PermissionError","ProcessLookupError","RecursionError","ReferenceError","ResourceWarning","RuntimeError","RuntimeWarning","StopAsyncIteration","StopIteration","SyntaxError","SyntaxWarning","SystemError","SystemExit","TabError","TimeoutError","True","TypeError","UnboundLocalError","UnicodeDecodeError","UnicodeEncodeError","UnicodeError","UnicodeTranslateError","UnicodeWarning","UserWarning","ValueError","Warning","ZeroDivisionError","_","__build_class__","__debug__","__doc__","__import__","__loader__","__name__","__package__","__spec__","abs","all","any","ascii","bin","bool","bytearray","bytes","callable","chr","classmethod","compile","complex","copyright","credits","delattr","dict","dir","divmod","enumerate","eval","exec","exit","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","license","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","quit","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],function(e){return e}),i=ts.pxtc.decompiler.buildRenameMap(e,n,r),a=i[0],m=i[1],o=pxtc.getApiInfo(e),s=G.U.mapMap(o.byQName,function(e,n){return n.fileName==t?void 0:n});return n.getChildren().map(g).reduce(function(e,n){return e.concat(n)},[]).join("\n");function A(e){if(!e.getSourceFile())return null;var n=e.getText(),t=s[n];return t&&t.pyQName?t.pyQName:n in pxtc.ts2PyFunNameMap?pxtc.ts2PyFunNameMap[n].n:null}function P(e){var n=A(e);if(n)return n;if(!ts.isIdentifier(e))return B(e,3001,"Unsupported advanced name format: "+e.getText());var t=e.text,r=e.getSourceFile();if(a&&r){var i=a.getRenameForPosition(e.getStart());i&&(t=i.name)}return t}function k(e,n){return 0!=(e.flags&n)}function u(e,n){var t=v.getTypeAtLocation(e);return k(t,n)}function _(e){return u(e,ts.TypeFlags.StringLike)}function S(e){return u(e,ts.TypeFlags.NumberLike)}function g(e){switch(e.kind){case ts.SyntaxKind.SyntaxList:return e._children.map(g).reduce(function(e,n){return e.concat(n)},[]);case ts.SyntaxKind.EndOfFileToken:case ts.SyntaxKind.OpenBraceToken:case ts.SyntaxKind.CloseBraceToken:return[];default:return function(e){var n=[];if(0<e.getLeadingTriviaWidth()){var t=e.getFullText().slice(0,e.getLeadingTriviaWidth()),r=t.split("\n"),i=r.map(function(e){var n=e.trim();return n?n.startsWith("//")?["comment","#"+n.slice(2,n.length)]:"unknown":"blank"}).filter(function(e){return"unknown"!==e}).map(function(e){return"blank"===e?"":e[1]});i&&!i[0]&&i.shift(),i&&!i[i.length-1]&&i.pop(),n=n.concat(i)}return n=n.concat(b(e))}(e)}}function b(e){return ts.isVariableStatement(e)?e.declarationList.declarations.map(I).reduce(function(e,n){return e.concat(n)},[]):ts.isClassDeclaration(e)?function(e){var n=[];if(!e.name)return B(e,3011,"Unsupported: anonymous class");var t=e.members.every(x),r=P(e.name);t?n.push("class "+r+"(Enum):"):n.push("class "+r+":");var i=e.members.map(T).reduce(function(e,n){return e.concat(n)},[]).filter(function(e){return e});return i.length&&(n=n.concat(i.map(q))),n}(e):ts.isEnumDeclaration(e)?function(e){var n=[];n.push("class "+P(e.name)+"(Enum):");var t=e.members.every(function(e){return!!e.initializer}),r=!e.members.every(function(e){return!!e.initializer});if(!t&&!r)return B(e,3005,"Unsupported enum decleration: has mixture of explicit and implicit initialization");if(t)return B(e,3006,"Unsupported: explicit enum initialization");for(var i=0,a=0,o=e.members;a<o.length;a++){var s=o[a];n.push(q(P(s.name)+" = "+i++))}return n}(e):ts.isExpressionStatement(e)?function(e){var n=E(e.expression);if(n)return n;var t=M(e.expression),r=t[0];return t[1].concat([""+r])}(e):ts.isFunctionDeclaration(e)?C(e):ts.isIfStatement(e)?(p=function e(n){var t=[],r=M(n.expression),i=r[0],a=r[1];t=t.concat(a);var o="if "+i+":",s=[],u=N(n.thenStatement);if(s=s.concat(u),n.elseStatement)if(ts.isIfStatement(n.elseStatement)){var l=e(n.elseStatement),c=l.supportStmts,f=l.ifStmt,p=l.rest,m="el"+f;t=t.concat(c),s.push(m),s=s.concat(p)}else{s.push("else:");var d=N(n.elseStatement);s=s.concat(d)}return{supportStmts:t,ifStmt:o,rest:s}}(e),m=p.supportStmts,d=p.ifStmt,y=p.rest,m.concat([d]).concat(y)):ts.isForStatement(e)?function(e){var n=function(e){if(!e.initializer)return null;if(e.initializer.kind!==ts.SyntaxKind.VariableDeclarationList)return null;var n=e.initializer;if(1!==n.declarations.length)return null;var t=n.declarations[0],r=P(t.name);if(!t.initializer||!function n(e,t){var r=function(e){return n(e,t)};return ts.isBinaryExpression(e)?r(e.left)&&r(e.right):ts.isPropertyAccessExpression(e)?r(e.expression):ts.isPrefixUnaryExpression(e)||ts.isPostfixUnaryExpression(e)?e.operator!==ts.SyntaxKind.PlusPlusToken&&e.operator!==ts.SyntaxKind.MinusMinusToken&&r(e.operand):ts.isParenthesizedExpression(e)?r(e.expression):ts.isArrayLiteralExpression(e)?e.elements.map(r).reduce(function(e,n){return e&&n},!0):ts.isElementAccessExpression(e)?r(e.expression)&&(!e.argumentExpression||r(e.argumentExpression)):t(e)}(t.initializer,function(e){switch(e.kind){case ts.SyntaxKind.PropertyAccessExpression:case ts.SyntaxKind.BinaryExpression:case ts.SyntaxKind.ParenthesizedExpression:case ts.SyntaxKind.ArrayLiteralExpression:case ts.SyntaxKind.ElementAccessExpression:case ts.SyntaxKind.TrueKeyword:case ts.SyntaxKind.FalseKeyword:case ts.SyntaxKind.NullKeyword:case ts.SyntaxKind.UndefinedKeyword:case ts.SyntaxKind.NumericLiteral:case ts.SyntaxKind.StringLiteral:case ts.SyntaxKind.NoSubstitutionTemplateLiteral:return!0;case ts.SyntaxKind.CallExpression:case ts.SyntaxKind.NewExpression:case ts.SyntaxKind.FunctionExpression:case ts.SyntaxKind.ArrowFunction:case ts.SyntaxKind.Identifier:case ts.SyntaxKind.ThisKeyword:return!1;case ts.SyntaxKind.PrefixUnaryExpression:case ts.SyntaxKind.PostfixUnaryExpression:var n=e;return n.operator!==ts.SyntaxKind.PlusPlusToken&&n.operator!==ts.SyntaxKind.MinusMinusToken}return!1})||!S(t.initializer))return null;var i=M(t.initializer),a=i[0];if(i[1].length)return null;var o=a;if(!e.condition)return null;if(!ts.isBinaryExpression(e.condition))return null;if(!ts.isIdentifier(e.condition.left))return null;if(P(e.condition.left)!=r)return null;if(!S(e.condition.right))return null;var s=M(e.condition.right),u=s[0];if(s[1].length)return null;var l,c,f=u;if(e.condition.operatorToken.kind===ts.SyntaxKind.LessThanEqualsToken)l=u,(c=Math.floor(Number(l)))!==1/0&&String(c)===l?f=""+(Number(u)+1):f+=" + 1";else if(e.condition.operatorToken.kind!==ts.SyntaxKind.LessThanToken)return null;return e.incrementor&&(ts.isPostfixUnaryExpression(e.incrementor)||ts.isPrefixUnaryExpression(e.incrementor))?e.incrementor.operator!==ts.SyntaxKind.PlusPlusToken?null:o<f?{name:r,fromIncl:o,toExcl:f}:null:null}(e);if(n){var t=n.name,r=n.fromIncl,i=n.toExcl,a="0"===r?"for "+t+" in range("+i+"):":"for "+t+" in range("+r+", "+i+"):",o=N(e.statement);return[a].concat(o)}var s,u=[];if(e.initializer)if(ts.isVariableDeclarationList(e.initializer)){var l=e.initializer.declarations.map(I).reduce(function(e,n){return e.concat(n)},[]);u=u.concat(l)}else{var c=M(e.initializer),f=c[0],p=c[1];u=u.concat(p).concat([f])}if(e.condition){var m=M(e.condition),d=m[0],y=m[1];u=u.concat(y),s=d}else s="True";var v="while "+s+":";u.push(v);var k=b(e.statement).map(q);if(0!==k.length||e.incrementor||(k=[q("pass")]),u=u.concat(k),e.incrementor){var g=E(e.incrementor);if(g)u=u.concat(g.map(q));else{var x=M(e.incrementor),T=x[0],h=x[1];u=u.concat(h).concat([q(T)])}}return u}(e):ts.isForOfStatement(e)?function(e){if(!ts.isVariableDeclarationList(e.initializer))return B(e,3003,"Unsupported expression in for..of initializer: "+e.initializer.getText());var n=e.initializer.declarations.map(function(e){return P(e.name)});if(1!==n.length)return B(e,3004,"Unsupported multiple declerations in for..of: "+e.initializer.getText());var t=n[0],r=M(e.expression),i=r[0],a=r[1];a.push("for "+t+" in "+i+":");var o=N(e.statement);return a=a.concat(o)}(e):ts.isWhileStatement(e)?(s=M((o=e).expression),u=s[0],l=s[1],c=N(o.statement).map(q),f="while "+u+":",l.concat([f]).concat(c)):ts.isReturnStatement(e)?function(e){if(!e.expression)return["return"];var n=M(e.expression),t=n[0],r=n[1],i="return "+t;return r.concat([i])}(e):ts.isBlock(e)?h(e):ts.isTypeAliasDeclaration(e)?(i=e,a=pxtc.emitType(i.type),[P(i.name)+" = "+a]):ts.isEmptyStatement(e)?[]:ts.isModuleDeclaration(e)?(t=P((n=e).name),r=n.body&&n.body.getChildren().map(g).reduce(function(e,n){return e.concat(n)},[]).map(function(e){return q(e)}),["@namespace","class "+t+":"].concat(r||[])):B(e,3002,"Not implemented: "+ts.SyntaxKind[e.kind]+" ("+e.kind+")");var n,t,r,i,a,o,s,u,l,c,f,p,m,d,y}function N(e){var n=b(e).map(q);return n.length<1&&(n=[q("pass")]),n}function x(e){if(e.kind!==ts.SyntaxKind.PropertyDeclaration)return!1;var n=e;if(!n.modifiers||1!==n.modifiers.length)return!1;for(var t=0,r=n.modifiers;t<r.length;t++){var i=r[t];if(i.kind!==ts.SyntaxKind.StaticKeyword)return!1}return!!n.initializer&&n.initializer.kind===ts.SyntaxKind.NumericLiteral}function T(e){switch(e.kind){case ts.SyntaxKind.PropertyDeclaration:return function(e){var n=P(e.name);if(e.initializer){var t=M(e.initializer),r=t[0],i=t[1];return i.concat([n+" = "+r])}return[]}(e);case ts.SyntaxKind.MethodDeclaration:case ts.SyntaxKind.Constructor:return C(e);default:return["# unknown ClassElement "+e.kind]}}function E(e){if(n=e,!ts.isPrefixUnaryExpression(n)&&!ts.isPostfixUnaryExpression(n)||n.operator!==ts.SyntaxKind.MinusMinusToken&&n.operator!==ts.SyntaxKind.PlusPlusToken)return null;var n,t=M(e.operand),r=t[0],i=t[1],a=e.operator===ts.SyntaxKind.MinusMinusToken?" -= 1":" += 1",o=i;return o.push(""+r+a),o}function h(e){var n=e.getChildren().map(g).reduce(function(e,n){return e.concat(n)},[]);return n}function C(e,n,t,r){var i=[];e.kind!==ts.SyntaxKind.MethodDeclaration&&e.kind!==ts.SyntaxKind.Constructor||i.push("self");var a,o,s=t?O(e.parameters,t):e.parameters,u=s.map(function(e){return U(e,!r)}),l=(i=i.concat(u)).join(", "),c=[];if(e.kind===ts.SyntaxKind.Constructor)a="__init__";else if(n)a=n;else{if(!e.name)return B(e,3012,"Unsupported: anonymous function decleration");a=P(e.name)}if(c.push("def "+a+"("+l+"):"),o={vars:{}},y.unshift(o),!e.body)return B(e,3013,"Unsupported: function decleration without body");var f=[];if(ts.isBlock(e.body))f=h(e.body);else{var p=M(e.body),m=p[0],d=p[1];(f=f.concat(d)).push(m)}return f.length?c=c.concat(f.map(q)):c.push(q("pass")),y.shift(),c}function U(e,n){void 0===n&&(n=!0);var t=e.altName||P(e.name),r="";if(e.type&&n){var i=pxtc.emitType(e.type);r=": "+i}var a="";if(e.initializer){var o=M(e.initializer),s=o[0],u=o[1];if(u.length)return B(e,3007,"TODO: complex expression in parameter default value not supported. Expression: "+e.initializer.getText());a=" = "+s}return""+t+r+a}function I(e){var n=[],t=P(e.name);if(e.initializer){var r=M(e.initializer),i=r[0],a=r[1];n=n.concat(a);var o=void 0;if(e.type){var s=pxtc.emitType(e.type);o=t+": "+s+" = "+i}else o=t+" = "+i;return n.push(o),n}return n}function K(e){return[e,[]]}function L(e,n){switch(e){case ts.SyntaxKind.BarBarToken:return"or";case ts.SyntaxKind.AmpersandAmpersandToken:return"and";case ts.SyntaxKind.ExclamationToken:return"not";case ts.SyntaxKind.LessThanToken:return"<";case ts.SyntaxKind.LessThanEqualsToken:return"<=";case ts.SyntaxKind.GreaterThanToken:return">";case ts.SyntaxKind.GreaterThanEqualsToken:return">=";case ts.SyntaxKind.EqualsEqualsEqualsToken:case ts.SyntaxKind.EqualsEqualsToken:return"==";case ts.SyntaxKind.ExclamationEqualsEqualsToken:case ts.SyntaxKind.ExclamationEqualsToken:return"!=";case ts.SyntaxKind.EqualsToken:return"=";case ts.SyntaxKind.PlusToken:return"+";case ts.SyntaxKind.MinusToken:return"-";case ts.SyntaxKind.AsteriskToken:return"*";case ts.SyntaxKind.PlusEqualsToken:return"+=";case ts.SyntaxKind.MinusEqualsToken:return"-=";case ts.SyntaxKind.PercentToken:return"%";case ts.SyntaxKind.SlashToken:return"/";case ts.SyntaxKind.PlusPlusToken:case ts.SyntaxKind.MinusMinusToken:return B(n,3008,"Unsupported ++ and -- in an expression (not a statement or for loop)");case ts.SyntaxKind.AmpersandToken:return"&";case ts.SyntaxKind.CaretToken:return"^";case ts.SyntaxKind.LessThanLessThanToken:return"<<";case ts.SyntaxKind.GreaterThanGreaterThanToken:return">>";case ts.SyntaxKind.GreaterThanGreaterThanGreaterThanToken:return B(n,3009,"Unsupported operator: >>>");case ts.SyntaxKind.AsteriskAsteriskToken:return"**";default:return G.tickEvent("depython.todo",{op:e}),"# TODO unknown op: "+e}}function w(e,n){if(void 0===n&&(n=!1),ts.isPropertyAccessExpression(e)){var t=[P(e.name)];return n&&ts.isIdentifier(e.expression)?t:w(e.expression,n).concat(t)}return ts.isIdentifier(e)?[P(e)]:[]}function p(e,n,t,r,i){if((ts.isFunctionExpression(e)||ts.isArrowFunction(e))&&n&&n.type&&ts.isFunctionTypeNode(n.type)){var a=void 0,o=function(e,n,t,r){var i="";n&&(i=w(n,!0).map(pxtc.snakify).join("_"));var a=[];if(t&&1<t.length&&r&&1<r.length)for(var o=0;o<t.length&&o<r.length;o++){var s=r[o],u=v.getTypeAtLocation(s);if(k(u,ts.TypeFlags.EnumLike)){var l=w(s,!0).map(pxtc.snakify);a=a.concat(l)}}var c=a.join("_"),f="";i||c||!e||(f=P(e.name));var p=([i,c,f].filter(function(e){return e}).map(pxtc.snakify).map(function(e){return e.toLowerCase()}).join("_")||"my_callback").split("_");4<p.length&&(p=function(e){for(var n={},t=[],r=0,i=e;r<i.length;r++){var a=i[r];a in n||(n[a]=!0,t.push(a))}return t}(p));for(var m=G.U.toDictionary(["any","on","event"],function(e){return e});2<p.length;){var d=y(p,m);if(d.length==p.length)break;p=d}return 1==p.length&&(p=["on",p[0]]),p.join("_");function y(e,n){for(var t=[],r=!1,i=0,a=e;i<a.length;i++){var o=a[i];o in n&&!r?r=!0:t.push(o)}return t}}(n,t,r,i);return R(e,o,a,!0)}return M(e)}function F(r){var e=v.getTypeAtLocation(r.expression),n=v.typeToTypeNode(e),i=ts.createNodeArray([]);if(ts.isFunctionTypeNode(n)&&(i=n.parameters,r.arguments&&i.length<r.arguments.length))return G.tickEvent("depython.todo",{kind:r.kind}),B(r,3010,"TODO: Unsupported call site where caller the arguments outnumber the callee parameters: "+r.getText());var t=M(r.expression),a=t[0],o=t[1],s=(r.arguments||ts.createNodeArray()).map(function(e,n,t){return p(e,i[n],r.expression,i,t)}),u=s.map(function(e){e[0];var n=e[1];return n}).reduce(function(e,n){return e.concat(n)},o);if(0===a.indexOf("_py.py_")){if(s.length<=0)return B(r,3014,"Unsupported: call expression has no arguments for _py.py_ fn");a=a.substr(7).split("_").filter(function(e,n){return 0!==n}).join("_");var l=s.shift()[0],c=s.map(function(e){var n=e[0];return e[1],n}).join(", ");return[l+"."+a+"("+c+")",u]}var f=s.map(function(e){var n=e[0];return e[1],n}).join(", ");return[a+"("+f+")",u]}function O(e,n){for(var t=[],r={},i=0;i<Math.max(e.length,n.length);i++){var a=void 0;if(e[i])a=e[i],r[P(a.name)]=!0;else{var o=P((a=n[i]).name);r[o]&&(o=pxtc.decompiler.getNewName(o,r),a=Object.assign({altName:o},n[i]))}t.push(a)}return ts.createNodeArray(t,!1)}function R(e,n,t,r){if(!ts.isBlock(e.body)){var i=M(e.body),a=i[0],o=i[1];if(0===o.length){var s=t?O(e.parameters,t):e.parameters,u=s.map(function(e){return U(e,!1)}).join(", "),l=u.length?"lambda "+u+": "+a:"lambda: "+a;return K(l)}}var c,f=e.name?P(e.name):("string"!=typeof(c=n||"my_function")&&(c=P(c)),m[c]?pxtc.decompiler.getNewName(c,m):(m[c]=!0,c)),p=C(e,f,t,r);return[f,p]}function D(e){switch(e){case ts.SyntaxKind.ExclamationToken:return" ";case ts.SyntaxKind.PlusToken:case ts.SyntaxKind.MinusToken:return"";default:return" "}}function M(e){switch(e.kind){case ts.SyntaxKind.BinaryExpression:return function(e){var n=_(e.left),t=_(e.right),r=e.operatorToken.kind===ts.SyntaxKind.PlusToken&&(n||t),i=function(e){return"str("+e+")"},a=M(e.left),o=a[0],s=a[1];r&&!n&&(o=i(o));var u=L(e.operatorToken.kind,e),l=M(e.right),c=l[0],f=l[1];r&&!t&&(c=i(c));var p=s.concat(f);return[o+" "+u+" "+c,p]}(e);case ts.SyntaxKind.PropertyAccessExpression:return function(e){var n=A(e);if(n)return K(n);var t=M(e.expression),r=t[0],i=t[1],a=P(e.name);return"length"===a?["len("+r+")",i]:[r+"."+a,i]}(e);case ts.SyntaxKind.CallExpression:case ts.SyntaxKind.NewExpression:return F(e);case ts.SyntaxKind.FunctionExpression:case ts.SyntaxKind.ArrowFunction:return R(e);case ts.SyntaxKind.PrefixUnaryExpression:return E=L((N=e).operator,N),C=M(N.operand),U=C[0],I=C[1],w=D(N.operator),[""+E+w+U,I];case ts.SyntaxKind.PostfixUnaryExpression:return x=L((g=e).operator,g),T=M(g.operand),h=T[0],S=T[1],b=D(g.operator),[""+h+b+x,S];case ts.SyntaxKind.ParenthesizedExpression:return y=M(e.expression),v=y[0],k=y[1],["("+v+")",k];case ts.SyntaxKind.ArrayLiteralExpression:return m=e.elements.map(M),d=m.map(function(e){e[0];var n=e[1];return n}).reduce(function(e,n){return e.concat(n)},[]),["["+m.map(function(e){var n=e[0];return e[1],n}).join(", ")+"]",d];case ts.SyntaxKind.ElementAccessExpression:return function(e){if(!e.argumentExpression)return B(e,3015,"Unsupported: element access expression without an argument expression");var n=M(e.expression),t=n[0],r=n[1],i=M(e.argumentExpression),a=i[0],o=i[1],s=r.concat(o);return[t+"["+a+"]",s]}(e);case ts.SyntaxKind.NoSubstitutionTemplateLiteral:case ts.SyntaxKind.TaggedTemplateExpression:return function(e){if(ts.isNoSubstitutionTemplateLiteral(e))return K('"""'+e.text+'"""');var n=M(e.tag),t=n[0],r=n[1],i=M(e.template),a=i[0],o=i[1],s=r.concat(o);return[t+"("+a+")",s]}(e);case ts.SyntaxKind.TrueKeyword:return K("True");case ts.SyntaxKind.FalseKeyword:return K("False");case ts.SyntaxKind.ThisKeyword:return K("self");case ts.SyntaxKind.NullKeyword:case ts.SyntaxKind.UndefinedKeyword:return K("None");case ts.SyntaxKind.Identifier:return"undefined"==(p=e).text?K("None"):K(P(p));case ts.SyntaxKind.NumericLiteral:case ts.SyntaxKind.StringLiteral:return K(e.getText());case ts.SyntaxKind.ConditionalExpression:return t=M((n=e).condition),r=t[0],i=t[1],a=M(n.whenTrue),o=a[0],s=a[1],u=M(n.whenFalse),l=u[0],c=u[1],f=i.concat(s).concat(c),[o+" if "+r+" else "+l,f];default:return[e.getText(),["# unknown expression:  "+e.kind]]}var n,t,r,i,a,o,s,u,l,c,f,p,m,d,y,v,k,g,x,T,h,S,b,N,E,C,U,I,w}}(e,n),i=n.replace(/(\.py)?\.\w*$/i,"")+".py";t.outfiles[i]=r}catch(e){e.pyDiagnostic?t.diagnostics=[e.pyDiagnostic]:G.reportException(e),t.success=!1}return t},n.INDENT="    ";var t,q=(t=1,function(e){return""+n.INDENT.repeat(t)+e})}(G.py||(G.py={}))}(pxt||(pxt={})),function(e){var n,t,r;n=e.py||(e.py={}),t=n.rx||(n.rx={}),r=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,t.isIdentifierStart=function(e){return ts.pxtc.isIdentifierStart(e,ts.pxtc.ScriptTarget.ES5)},t.isIdentifierChar=function(e){return ts.pxtc.isIdentifierPart(e,ts.pxtc.ScriptTarget.ES5)},t.isSpace=function(e){return!!(32===e||9===e||11===e||12===e||160===e||5760<=e&&r.test(String.fromCharCode(e)))},t.isNewline=function(e){return 10===e||13===e||8232===e||8233===e}}(pxt||(pxt={}));