!function o(a,s,l){function c(t,e){if(!s[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[t]={exports:{}};a[t][0].call(i.exports,function(e){return c(a[t][1][e]||e)},i,i.exports,o,a,s,l)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./data"),s=e("./sui"),l=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.openJavaScript=t.openJavaScript.bind(t),t.openPython=t.openPython.bind(t),t.showLanguagePicker=t.showLanguagePicker.bind(t),t.toggleHighContrast=t.toggleHighContrast.bind(t),t.goHome=t.goHome.bind(t),t}return i(e,n),e.prototype.openJavaScript=function(){pxt.tickEvent("accmenu.editor.openJS",void 0,{interactiveConsent:!0}),this.props.parent.openJavaScript()},e.prototype.openPython=function(){pxt.tickEvent("accmenu.editor.openPY",void 0,{interactiveConsent:!0}),this.props.parent.openPython()},e.prototype.showLanguagePicker=function(){pxt.tickEvent("accmenu.editor.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()},e.prototype.toggleHighContrast=function(){pxt.tickEvent("accmenu.editor.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()},e.prototype.goHome=function(){pxt.tickEvent("accmenu.editor.home",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog()},e.prototype.componentWillReceiveProps=function(e){var t={};null!=e.highContrast&&(t.highContrast=e.highContrast),0<Object.keys(t).length&&this.setState(t)},e.prototype.shouldComponentUpdate=function(e,t,n){return this.state.highContrast!=t.highContrast},e.prototype.renderCore=function(){var e=this.props.parent.state.highContrast,t=pxt.appTarget.appTheme,n=!pxt.shell.isControllerMode();return o.createElement("div",{className:"ui accessibleMenu borderless fixed menu",role:"menubar"},o.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon js",text:lf("Skip to JavaScript editor"),onClick:this.openJavaScript}),t.python?o.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon python",text:lf("Skip to Python editor"),onClick:this.openPython}):void 0,t.selectLanguage?o.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon globe",text:lf("Select Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?o.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,n?o.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"home",text:lf("Go Home"),onClick:this.goHome}):void 0)},e}(a.Component);n.EditorAccessibilityMenu=l;var c=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.newProject=t.newProject.bind(t),t.importProjectDialog=t.importProjectDialog.bind(t),t.showLanguagePicker=t.showLanguagePicker.bind(t),t.toggleHighContrast=t.toggleHighContrast.bind(t),t}return i(e,n),e.prototype.newProject=function(){pxt.tickEvent("accmenu.home.new",void 0,{interactiveConsent:!0}),this.props.parent.newProject()},e.prototype.importProjectDialog=function(){pxt.tickEvent("accmenu.home.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.importProjectDialog()},e.prototype.showLanguagePicker=function(){pxt.tickEvent("accmenu.home.langpicker"),this.props.parent.showLanguagePicker()},e.prototype.toggleHighContrast=function(){pxt.tickEvent("accmenu.home.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()},e.prototype.componentWillReceiveProps=function(e){var t={};null!=e.highContrast&&(t.highContrast=e.highContrast),0<Object.keys(t).length&&this.setState(t)},e.prototype.shouldComponentUpdate=function(e,t,n){return this.state.highContrast!=t.highContrast},e.prototype.renderCore=function(){var e=this.state.highContrast,t=pxt.appTarget.appTheme;return o.createElement("div",{className:"ui accessibleMenu borderless fixed menu",role:"menubar"},o.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"add circle",text:lf("New Project"),onClick:this.newProject}),o.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"upload",text:lf("Import Project"),onClick:this.importProjectDialog}),t.selectLanguage?o.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon globe",text:lf("Select Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?o.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0)},e}(a.Component);n.HomeAccessibilityMenu=c},{"./data":44,"./sui":100,react:284}],2:[function(s,e,t){"use strict";var r,n=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(o,a,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((l=l.apply(o,a||[])).next())})},o=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(t,"__esModule",{value:!0});var H,l,z,V=s("react"),c=s("react-dom"),h=s("./workspace"),u=s("./cloudsync"),a=s("./data"),W=s("./package"),m=s("./core"),G=s("./sui"),d=s("./simulator"),p=s("./compiler"),K=s("./cmds"),f=s("./appcache"),g=s("./screenshot"),v=s("./hidbridge"),X=s("./share"),Y=s("./lang"),J=s("./accessibility"),$=s("./tutorial"),Q=s("./editortoolbar"),Z=s("./simtoolbar"),y=s("./dialogs"),ee=s("./filelist"),te=s("./container"),ne=s("./scriptsearch"),re=s("./projects"),ie=s("./scriptmanager"),oe=s("./cloud"),ae=s("./extensions"),b=s("./sounds"),_=s("./make"),w=s("./blocksSnippets"),k=s("./monacoSnippets"),se=s("./greenscreen"),x=s("./socketbridge"),E=s("./webusb"),C=s("./monaco"),S=s("./pxtjson"),T=s("./serial"),A=s("./blocks"),N=s("./gitjson"),le=s("./serialindicator"),O=s("./draganddrop"),ce=s("./notification"),P=s("./electron"),I=s("./blocklyFieldView"),D=pxt.Cloud,L=pxt.Util,R=s("./hinttooltip");function j(){return H?Promise.resolve(H):(z||(z=[]),new Promise(function(e){z.push(e)}))}pxsim.util.injectPolyphils();var B=function(i){function q(e){var o=i.call(this,e)||this;o.allEditors=[],o.screenshotHandlers=[],o.autoRunSimulatorDebounced=pxtc.Util.debounce(function(){L.now()-o.lastChangeTime<1e3?pxt.debug("sim: skip auto, debounced"):o.state.active?o.blocksEditor&&o.blocksEditor.isDropdownDivVisible()?pxt.debug("sim: skip blocks auto, field editor is open"):o.runSimulator({debug:!!o.state.debugging,background:!0}):pxt.debug("sim: skip blocks auto, !active")},1e3,!0),o._slowTypeCheck=0,o.typecheck=pxtc.Util.debounce(function(){if(!o.editor.isIncomplete()){var r=L.now(),i=o.editor.snapshotState();p.typecheckAsync().done(function(e){var t=L.now();if(!pxt.options.light&&1e4<t-r&&1<o._slowTypeCheck++&&(pxt.tickEvent("light.typecheck"),pxt.options.light=!0),o.editor.setDiagnostics(o.editorFile,i),a.invalidate("open-pkg-meta:"+W.mainEditorPkg().getPkgId()),o.state.autoRun){var n=W.mainEditorPkg().outputPkg.files["output.txt"];n&&!n.numDiagnosticsOverride&&o.state.autoRun&&o.autoRunSimulatorDebounced()}o.maybeShowPackageErrors()})}},1e3,!1),o.markdownChangeHandler=L.debounce(function(){o.state.currFile&&/\.md$/i.test(o.state.currFile.name)&&o.setSideMarkdown(o.editor.getCurrentSource())},4e3,!1),o.editorChangeHandler=L.debounce(function(){o.editor.isIncomplete()||(o.saveFileAsync().done(),o.typecheck()),o.markdownChangeHandler()},500,!1),o.hexFileImporters=[{id:"default",canImport:function(e){return e.meta.cloudId=="ks/"+pxt.appTarget.id||e.meta.cloudId==pxt.CLOUD_ID+pxt.appTarget.id||L.startsWith(e.meta.cloudId,pxt.CLOUD_ID+pxt.appTarget.id)},importAsync:function(e,t){var n={target:pxt.appTarget.id,targetVersion:t.meta.targetVersions?t.meta.targetVersions.target:void 0,editor:t.meta.editor,name:t.meta.name,meta:{},pubId:"",pubCurrent:!1},r=JSON.parse(t.source);return h.installAsync(n,r).then(function(e){return o.loadHeaderAsync(e,null)})}}],o.resourceImporters=[new T.ResourceImporter],o.checkWebUSBVariant=!0,o.closeOnEscape=function(e){m.keyCodeFromEvent(e)===m.ESC_KEY&&(e.preventDefault(),o.toggleSimulatorFullscreen())},o.hintManager=new R.HintManager,o.handleScriptManagerDialogClose=function(){o.home.forceUpdate(),h.syncAsync().done()},o.handleHomeRef=function(e){o.home=e},o.handleScriptSearchRef=function(e){o.scriptSearch=e},o.handleExtensionRef=function(e){o.extensions=e},o.handleScriptManagerDialogRef=function(e){o.scriptManagerDialog=e},o.handleImportDialogRef=function(e){o.importDialog=e},o.handleExitAndSaveDialogRef=function(e){o.exitAndSaveDialog=e},o.handleNewProjectNameDialogRef=function(e){o.newProjectNameDialog=e},o.handleShareEditorRef=function(e){o.shareEditor=e},o.handleLanguagePickerRef=function(e){o.languagePicker=e},o.handleChooseHwDialogRef=function(e){o.chooseHwDialog=e},o.handleSignInDialogRef=function(e){o.signInDialog=e},o.handleChooseRecipeDialogRef=function(e){o.chooseRecipeDialog=e},document.title=pxt.appTarget.title||pxt.appTarget.name,o.reload=!1,o.settings=JSON.parse(pxt.storage.getLocal("editorSettings")||"{}");var t=o.shouldShowHomeScreen(),n=/hc=(\w+)/.test(window.location.href);n&&m.setHighContrast(!0);var r=pxt.appTarget.simulator;return o.state={showFiles:!1,home:t,active:"visible"==document.visibilityState||pxt.BrowserUtils.isElectron()||pxt.winrt.isWinRT()||pxt.appTarget.appTheme.dontSuspendOnVisibility,collapseEditorTools:r.headless,highContrast:n,simState:pxt.editor.SimState.Stopped,autoRun:o.autoRunOnStart()},o.settings.editorFontSize||(o.settings.editorFontSize=/mobile/i.test(navigator.userAgent)?15:19),o.settings.fileHistory||(o.settings.fileHistory=[]),t&&o.homeLoaded(),o.hwDebug=o.hwDebug.bind(o),o.hideLightbox=o.hideLightbox.bind(o),o.openSimSerial=o.openSimSerial.bind(o),o.openDeviceSerial=o.openDeviceSerial.bind(o),o.toggleGreenScreen=o.toggleGreenScreen.bind(o),o.toggleSimulatorFullscreen=o.toggleSimulatorFullscreen.bind(o),o.cloudSignInComplete=o.cloudSignInComplete.bind(o),o.toggleSimulatorCollapse=o.toggleSimulatorCollapse.bind(o),o.initScreenshots(),o.hintManager.addHint(q.tutorialCardId,o.tutorialCardHintCallback.bind(o)),o}return n(q,i),q.prototype.autoRunOnStart=function(){return pxt.appTarget.simulator&&((pxt.options.light?!!pxt.appTarget.simulator.autoRunLight:!!pxt.appTarget.simulator.autoRun)||!!pxt.appTarget.simulator.emptyRunCode)},q.prototype.initScreenshots=function(){var o=this;window.addEventListener("message",function(e){var t=e.data;if(t&&o.state.header)if("screenshot"==t.type){if(!(i=t).data)return;if(r=o.screenshotHandlers[o.screenshotHandlers.length-1])r(i);else{var n=pxt.BrowserUtils.imageDataToPNG(i.data);pxt.appTarget.compile.saveAsPNG&&o.encodeProjectAsPNGAsync(n,!1).done(),g.saveAsync(o.state.header,n).done(function(){pxt.debug("screenshot saved")})}}else if("recorder"==t.type){var r,i=t;(r=o.screenshotHandlers[o.screenshotHandlers.length-1])&&r({event:i.action})}},!1)},q.prototype.shouldShowHomeScreen=function(){var e=ue(),t=pxt.shell.isSandboxMode()||pxt.shell.isReadOnly(),n=pxt.appTarget.appTheme.allowParentController||pxt.shell.isControllerMode()||/^#editor/.test(window.location.hash);return!t&&!n&&!pe(e)},q.prototype.updateVisibility=function(){var e=this;if(!(pxt.BrowserUtils.isElectron()||pxt.winrt.isWinRT()||pxt.appTarget.appTheme.dontSuspendOnVisibility)){var t="visible"==document.visibilityState;if(pxt.debug("page visibility: "+t),this.setState({active:t}),!t&&this.state.autoRun)d.driver.state==pxsim.SimulatorState.Running&&(this.suspendSimulator(),this.setState({resumeOnVisibility:!0})),this.saveFileAsync().done();else if(h.isSessionOutdated()){pxt.debug("workspace changed, reloading...");var n=this.state.header?this.state.header.id:"";h.initAsync().done(function(){return!e.state.home&&n?e.loadHeaderAsync(h.getHeader(n),e.state.editorState):Promise.resolve()})}else this.state.resumeOnVisibility&&(this.setState({resumeOnVisibility:!1}),this.runSimulator())}},q.prototype.saveSettings=function(){if(!this.reload){var e=this.editorFile;e&&e.epkg.getTopHeader()&&this.editor.hasHistory()&&this.pushFileHistory(e.epkg.getTopHeader().id,e.getName(),this.editor.getViewState()),pxt.storage.setLocal("editorSettings",JSON.stringify(this.settings))}},q.prototype.pushFileHistory=function(e,t,n){var r=this.settings,i={id:e,name:t,pos:n};for(r.fileHistory=r.fileHistory.filter(function(e){return e.id!=i.id||e.name!=i.name});100<r.fileHistory.length;)r.fileHistory.pop();r.fileHistory.unshift(i)},q.prototype.popFileHistory=function(){this.settings.fileHistory.shift()},q.prototype.openProjectInLegacyEditor=function(r){var i=this;if(!this.editorFile||!this.editorFile.epkg||!this.editorFile.epkg.getTopHeader())return Promise.resolve();var o=this.editorFile.epkg.getTopHeader();return pxt.tickEvent("update.openLegacyEditor",{version:o.targetVersion}),h.copyProjectToLegacyEditor(o,r).then(function(e){i.pushFileHistory(e.id,i.editorFile.getName(),i.editor.getViewState()),pxt.storage.setLocal("editorSettings",JSON.stringify(i.settings));var t=pxt.appTarget.appTheme;if(t&&t.editorVersionPaths&&t.editorVersionPaths[r]){var n=t.editorVersionPaths[r];window.location.href=pxt.Util.pathJoin(window.location.origin,n+"#editor")}else window.location.href=pxt.Util.pathJoin(window.location.origin,"v"+o.targetVersion+"#editor")}).catch(function(e){m.warningNotification(lf("Importing to older editor version only supported in web browsers"))})},q.prototype.componentDidUpdate=function(){var e=this;this.saveSettings(),this.editor.domUpdate(),d.setState(this.state.header?this.state.header.editor:"",this.state.tutorialOptions&&!!this.state.tutorialOptions.tutorial),this.editor.resize();var t=Promise.resolve();this.editor&&this.editor.isReady&&(t=t.then(function(){return e.updateEditorFileAsync()})),this.editor&&(t=t.then(function(){e.editor.updateBreakpoints(),e.editor.updateToolbox()})),t.done()},q.prototype.fireResize=function(){if(document.createEvent){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)}else document.fireEvent("onresize")},q.prototype.updateEditorLogo=function(e,t){if(pxt.appTarget.appTheme.hideMenuBar){var n=document.getElementById("editorlogo");if(n)return n.style.left=e+"px",n.style.display="block",n.style.background=t||"",n.offsetHeight}return 0},q.prototype.saveFileAsync=function(){var t=this;return this.editorFile?this.saveTypeScriptAsync().then(function(){var e=t.editor.getCurrentSource();return e!=t.editorFile.content&&d.setDirty(),t.editor.isIncomplete()?Promise.resolve():t.editorFile.setContentAsync(e)}):Promise.resolve()},q.prototype.isEmbedSimActive=function(){return this.state.embedSimView},q.prototype.isBlocksActive=function(){return!this.state.embedSimView&&this.editor==this.blocksEditor&&this.editorFile&&"main.blocks"==this.editorFile.name},q.prototype.isJavaScriptActive=function(){return!this.state.embedSimView&&this.editor==this.textEditor&&this.editorFile&&"main.ts"==this.editorFile.name},q.prototype.isPythonActive=function(){return!this.state.embedSimView&&this.editor==this.textEditor&&this.editorFile&&"main.py"==this.editorFile.name},q.prototype.isAnyEditeableJavaScriptOrPackageActive=function(){return this.editor==this.textEditor&&this.editorFile&&!this.editorFile.isReadonly()&&/(\.ts|pxt.json)$/.test(this.editorFile.name)},q.prototype.openPython=function(e){if(void 0===e&&(e=!0),!this.updatingEditorFile){if(this.isPythonActive())return this.state.embedSimView&&this.setState({embedSimView:!1}),void(e&&this.textEditor.editor.focus());if(this.textEditor&&(this.textEditor.giveFocusOnLoading=e),this.isBlocksActive())this.blocksEditor.openPython();else if(this.isJavaScriptActive())this.openPythonAsync().done();else{var t=W.mainEditorPkg();t.files["main.py"]||t.setFile("main.py","# ..."),this.setFile(W.mainEditorPkg().files["main.py"])}pxt.Util.setEditorLanguagePref("py")}},q.prototype.openJavaScript=function(e){if(void 0===e&&(e=!0),!this.updatingEditorFile){if(this.isJavaScriptActive())return this.state.embedSimView&&this.setState({embedSimView:!1}),void(e&&this.textEditor.editor.focus());if(this.textEditor&&(this.textEditor.giveFocusOnLoading=e),this.isBlocksActive())this.blocksEditor.openTypeScript();else if(this.isPythonActive())this.openTypeScriptAsync().done();else{var t=W.mainEditorPkg().files,n=t["main.ts"];n||(n=t[Object.keys(t).find(function(e){return/\.ts$/.test(e)})]),this.setFile(n)}pxt.Util.setEditorLanguagePref("js")}},q.prototype.openBlocks=function(){var e=this;if(!this.updatingEditorFile)if(this.isBlocksActive())this.state.embedSimView&&this.setState({embedSimView:!1});else{var t=W.mainEditorPkg().files["main.blocks"];if(this.isJavaScriptActive()||this.shouldTryDecompile&&!this.state.embedSimView)this.textEditor.openBlocks();else if(this.isAnyEditeableJavaScriptOrPackageActive()||!t.content)this.saveFileAsync().then(function(){return e.textEditor.openBlocks()});else{var n=this.state.header;n&&n.editor!==pxt.BLOCKS_PROJECT_NAME?this.textEditor.openBlocks():this.setFile(t)}this.shouldTryDecompile=!1}},q.prototype.openSettings=function(){this.setFile(W.mainEditorPkg().lookupFile("this/pxt.json"))},q.prototype.openSimSerial=function(){this.openSerial(!0)},q.prototype.openDeviceSerial=function(){this.openSerial(!1)},q.prototype.openSerial=function(e){if(pxt.appTarget.serial&&pxt.appTarget.serial.useEditor&&(this.editor!=this.serialEditor||this.serialEditor.isSim!=e)){var t=W.mainEditorPkg();if(t){t.lookupFile("this/"+pxt.SERIAL_EDITOR_FILE)||t.setFile(pxt.SERIAL_EDITOR_FILE,"serial\n",!0),this.serialEditor.setSim(e);var n="serial."+(e?"simulator":"device")+"EditorOpened";pxt.tickEvent(n),this.setFile(t.lookupFile("this/"+pxt.SERIAL_EDITOR_FILE))}}},q.prototype.openPreviousEditor=function(){var t=this.state.header.id,e=this.settings.fileHistory[0];this.editorFile&&e.id==t&&e.name==this.editorFile.getName()&&this.popFileHistory();var n=this.settings.fileHistory.find(function(e){return e.id==t});if(n){var r=W.mainEditorPkg().lookupFile(n.name);if(r)return void this.setSideFile(r)}var i=!!W.mainEditorPkg().files["main.blocks"];"monacoEditor"!=this.prevEditorId&&i?this.openBlocks():this.openJavaScript(!1)},q.prototype.openTypeScriptAsync=function(){return this.saveTypeScriptAsync(!0)},q.prototype.openPythonAsync=function(){var t=this,n=W.mainEditorPkg().files["main.py"];if(n){var r=W.mainEditorPkg().files["main.ts"].content;return this.textEditor.convertPythonToTypeScriptAsync().then(function(e){return e==r?(pxt.debug("ts -> py shortcut"),t.setFile(n),Promise.resolve()):t.convertTypeScriptToPythonAsync()})}return this.convertTypeScriptToPythonAsync()},q.prototype.convertTypeScriptToPythonAsync=function(){var n=this,r=this.editor.snapshotState(),e=this.saveTypeScriptAsync(!1).then(function(){return p.pyDecompileAsync("main.ts")}).then(function(e){if(e&&e.success){var t=e.outfiles["main.py"];return n.saveVirtualFileAsync(pxt.PYTHON_PROJECT_NAME,t,!0)}return n.editor.setDiagnostics(n.editorFile,r),Promise.resolve()}).catch(function(e){pxt.reportException(e),m.errorNotification(lf("Oops, something went wrong trying to convert your code."))});return open&&(e=m.showLoadingAsync("switchtopython",lf("switching to Python..."),e)),e},q.prototype.openSimView=function(){this.state.embedSimView?this.startStopSimulator():(this.setState({embedSimView:!0}),this.startSimulator())},q.prototype.typecheckNow=function(){this.saveFileAsync().done(),this.typecheck()},q.prototype.showPackageErrorsOnNextTypecheck=function(){this.setState({suppressPackageWarning:!1})},q.prototype.maybeShowPackageErrors=function(t){var n=this;if(void 0===t&&(t=!1),pxt.perf.measureStart("maybeShowPackageErrors"),this.state.currFile){var e=this.state.currFile;if(!pxt.editor.isBlocks(e)&&"main.ts"!==e.name)return!1}if(!this.state.suppressPackageWarning||t){this.setState({suppressPackageWarning:!0});var r=p.getPackagesWithErrors();if(r.length){var i=this.state.header,o=pxt.semver.parse(pxt.appTarget.versions.target),a=pxt.semver.parse(i.targetVersion),s=void 0;return h.isBrowserWorkspace()&&o.major!==a.major&&(s=function(){n.openProjectInLegacyEditor(a.major)}),y.showPackageErrorDialogAsync(r,p.updatePackagesAsync,s).then(function(e){e?n.reloadHeaderAsync():t||n.openHome()}),pxt.perf.measureEnd("maybeShowPackageErrors"),!0}}return pxt.perf.measureEnd("maybeShowPackageErrors"),!1},q.prototype.initEditors=function(){var e=this;this.textEditor=new C.Editor(this),this.pxtJsonEditor=new S.Editor(this),this.serialEditor=new T.Editor(this),this.blocksEditor=new A.Editor(this),this.gitjsonEditor=new N.Editor(this);var t=function(){e.editorFile&&(e.editorFile.inSyncWithEditor&&pxt.tickActivity("edit","edit."+e.editor.getId().replace(/Editor$/,"")),e.editorFile.markDirty()),e.lastChangeTime=L.now(),e.state.simState!=pxt.editor.SimState.Stopped&&pxt.appTarget.simulator&&pxt.appTarget.simulator.stopOnChange&&e.stopSimulator(),e.editorChangeHandler()};this.allEditors=[this.pxtJsonEditor,this.gitjsonEditor,this.blocksEditor,this.serialEditor,this.textEditor],this.allEditors.forEach(function(e){return e.changeCallback=t}),this.editor=this.allEditors[this.allEditors.length-1]},q.prototype.componentWillMount=function(){this.initEditors(),this.initDragAndDrop()},q.prototype.componentDidMount=function(){var r=this;this.allEditors.forEach(function(e){return e.prepare()}),d.init(document.getElementById("boardview"),{orphanException:function(e){m.warningNotification(lf("Program Error: {0}",e.exceptionMessage))},highlightStatement:function(e,t){if(r.state.debugging&&!d.driver.areBreakpointsSet()&&t&&!t.exceptionMessage){var n=void 0;if(r.isAnyEditeableJavaScriptOrPackageActive()?n=r.textEditor.getBreakpoints():r.isBlocksActive()&&(n=r.blocksEditor.getBreakpoints()),n=n||[],d.driver.setBreakpoints(n),-1===n.indexOf(t.breakpointId))return r.dbgPauseResume(),!0}return!!r.editor&&r.editor.highlightStatement(e,t)},restartSimulator:function(){return r.restartSimulator()},onStateChanged:function(e){switch(e){case pxsim.SimulatorState.Paused:case pxsim.SimulatorState.Unloaded:case pxsim.SimulatorState.Suspended:case pxsim.SimulatorState.Pending:case pxsim.SimulatorState.Stopped:r.setState({simState:pxt.editor.SimState.Stopped});break;case pxsim.SimulatorState.Running:r.setState({simState:pxt.editor.SimState.Running})}},onSimulatorReady:function(){},setState:function(e,t){W.mainEditorPkg().setSimState(e,t)},editor:this.state.header?this.state.header.editor:""}),this.forceUpdate(),this.loadBlocklyAsync()},q.prototype.componentDidCatch=function(e,t){var n=this;try{m.killLoadingQueue(),pxsim.U.remove(document.getElementById("loading")),this.setState({hasError:!0}),pxt.tickEvent("pxt.criticalerror",{error:e||"",info:t||""});var r=pxt.storage.getLocal("lastcriticalerror")?Date.parse(pxt.storage.getLocal("lastcriticalerror")):Date.now();(!r||!isNaN(r)&&6e4<Date.now()-r)&&(pxt.storage.setLocal("lastcriticalerror",(new Date).toISOString()),setTimeout(function(){n.reloadEditor()},2e3))}catch(e){}},q.prototype.pickEditorFor=function(t){return this.allEditors.filter(function(e){return e.acceptsFile(t)})[0]},q.prototype.updateEditorFileAsync=function(t){var n=this;if(void 0===t&&(t=null),this.state.active&&!this.updatingEditorFile&&(this.state.currFile!=this.editorFile||t)){var e=!1;return this.updatingEditorFile=!0,m.showLoadingAsync("updateeditorfile",lf("loading editor..."),Promise.resolve()).then(function(){return e=n.state.simState!=pxt.editor.SimState.Stopped,n.state.currFile.virtual||n.state.debugging||(n.stopSimulator(),(e||n.state.autoRun)&&(d.setPending(),n.setState({simState:pxt.editor.SimState.Pending}))),n.saveSettings(),n.saveFileAsync()}).then(function(){n.editorFile=n.state.currFile;var e=n.editor;return n.prevEditorId=e.getId(),n.editor=t||n.pickEditorFor(n.editorFile),n.allEditors.forEach(function(e){return e.setVisible(e==n.editor)}),e?e.unloadFileAsync():Promise.resolve()}).then(function(){return n.editor.loadFileAsync(n.editorFile,n.state.highContrast)}).then(function(){if(n.saveFileAsync().done(),n.editor!=n.textEditor&&n.editor!=n.blocksEditor||n.typecheck(),n.state.editorPosition)n.editor.setViewState(n.state.editorPosition),n.setState({editorPosition:void 0});else{var e=n.settings.fileHistory.find(function(e){return e.id==n.state.header.id&&e.name==n.editorFile.getName()});e&&n.editor.setViewState(e.pos)}te.SideDocs.notify({type:"fileloaded",name:n.editorFile.getName(),locale:pxt.Util.localeInfo()}),n.state.showBlocks&&n.editor==n.textEditor&&n.textEditor.openBlocks()}).finally(function(){n.updatingEditorFile=!1,n.forceUpdate()}).then(function(){n.state.currFile.virtual||!e||n.state.autoRun?n.typecheck():n.startSimulator()})}this.state.editorPosition&&this.editorFile==this.state.editorPosition.file&&(this.editor.setViewState(this.state.editorPosition),this.setState({editorPosition:void 0}))},q.prototype.setFile=function(e,t){if(e){"main.ts"===e.name&&(this.shouldTryDecompile=!0);var n=this.state.header,r=!1;n&&"this"===(e.epkg&&e.epkg.getPkgId())&&(this.isBlocksFile(e.name)?(n.editor=pxt.BLOCKS_PROJECT_NAME,r=!(n.pubCurrent=!1)):this.isTypescriptFile(e.name)?(n.editor=pxt.JAVASCRIPT_PROJECT_NAME,r=!(n.pubCurrent=!1)):this.isPythonFile(e.name)&&(n.editor=pxt.PYTHON_PROJECT_NAME,r=!(n.pubCurrent=!1)),r&&W.mainPkg.setPreferredEditor(n.editor));var i={currFile:e,showBlocks:!1,embedSimView:!1,autoRun:this.autoRunOnStart()};void 0!==t&&(i.editorPosition={lineNumber:t,column:1,file:e}),this.setState(i)}},q.prototype.setSideFile=function(e,t){e.name!=this.state.currFile.name&&pxt.editor.isBlocks(e)?(pxt.tickEvent("sidebar.showBlocks"),this.openBlocks()):((this.isTextEditor()||this.isPxtJsonEditor())&&(this.textEditor.giveFocusOnLoading=!1),this.setFile(e,t))},q.prototype.navigateToError=function(e){if(e){var t=e.fileName;/^(pxt_modules|built)\//.test(t)||(t="this/"+t);var n=W.mainEditorPkg().lookupFile(t);n&&this.setSideFile(n,e.line+1)}},q.prototype.removeFile=function(e,t){var n=this;void 0===t&&(t=!1);var r=function(){W.mainEditorPkg().removeFileAsync(e.name).then(function(){return W.mainEditorPkg().saveFilesAsync(!0)}).then(function(){return n.reloadHeaderAsync()}).done()};t?r():m.confirmAsync({header:lf("Remove {0}",e.name),body:lf("You are about to remove a file from your project. You can't undo this. Are you sure?"),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Remove it")}).done(function(e){e&&r()})},q.prototype.updateFileAsync=function(e,t,n){var r=this,i=W.mainEditorPkg();return i.setContentAsync(e,t).then(function(){return n&&r.setFile(i.lookupFile("this/"+e)),i.savePkgAsync()}).then(function(){return r.reloadHeaderAsync()})},q.prototype.setSideMarkdown=function(e){var t=this.refs.sidedoc;t&&t.setMarkdown(e)},q.prototype.setSideDoc=function(e,t){void 0===t&&(t=!0);var n=this.refs.sidedoc;n&&(e?n.setPath(e,t):n.collapse())},q.prototype.setTutorialInstructionsExpanded=function(e){var t=this,n=this.state.tutorialOptions;n.tutorialStepExpanded=e,n.autoexpandStep=e,this.setState({tutorialOptions:n},function(){t.editor==t.blocksEditor?t.blocksEditor.hideFlyout():t.editor==t.textEditor&&t.textEditor.hideFlyout()})},q.prototype.setTutorialStep=function(e){if(this.typecheckNow(),this.refs[q.tutorialCardId]&&-1<e){var t=this.state.tutorialOptions;t.tutorialStep=e,t.tutorialStepExpanded=!1,this.setState({tutorialOptions:t}),t.tutorialStepInfo[e].fullscreen&&this.showTutorialHint(),t.tutorialStepInfo[e].tutorialCompleted&&pxt.commands.onTutorialCompleted&&pxt.commands.onTutorialCompleted(),this.editor.closeFlyout()}},q.prototype.handleMessage=function(e){var t=this;switch(e.type){case"opendoc":window.open(e.url,"_blank"),this.setState({sideDocsCollapsed:!0,sideDocsLoadUrl:""});break;case"tutorial":switch(e.subtype){case"loaded":var n=e;n.toolboxSubset&&0<Object.keys(n.toolboxSubset).length&&(this.setState({editorState:{searchBar:!1,filters:{blocks:n.toolboxSubset,defaultState:pxt.editor.FilterState.Hidden}}}),this.editor.filterToolbox(n.showCategories));var r=this.state.tutorialOptions;r.tutorialReady=!0,r.tutorialStepInfo=n.stepInfo,this.setState({tutorialOptions:r}),r.tutorialStepInfo[0].fullscreen&&this.showTutorialHint(),m.hideLoading("tutorial");break;case"error":var i=e;pxt.reportException(i.message),m.errorNotification(lf("We're having trouble loading this tutorial, please try again later.")),this.setState({tutorialOptions:void 0});var o=W.mainEditorPkg().header;o.isDeleted=!0,o.tutorial=void 0,h.saveAsync(o,{}).then(function(){t.openHome()}).finally(function(){return m.hideLoading("tutorial")})}}},q.prototype.reloadHeaderAsync=function(){return this.loadHeaderAsync(this.state.header,this.state.editorState)},q.prototype.tryCheckTargetVersionAsync=function(e){var t=this,n=e||"0.0.0";if(pxt.semver.majorCmp(n,pxt.appTarget.versions.target)<0&&pxt.tickEvent("patch.load.legacy",{targetVersion:n}),0<pxt.semver.majorCmp(n,pxt.appTarget.versions.target)){pxt.tickEvent("patch.load.future",{targetVersion:n});var r=[];return pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.homeUrl&&r.push({label:lf("Get latest"),icon:"external alternate",url:pxt.appTarget.appTheme.homeUrl}),m.dialogAsync({header:lf("Oops, this project is too new!"),body:lf("This project was created in a newer version of this editor. Please try again in that editor."),disagreeLbl:lf("Ok"),buttons:r}).then(function(){return t.openHome()})}},q.prototype.loadHeaderAsync=function(o,a){var s=this;if(!o)return Promise.resolve();var e=this.tryCheckTargetVersionAsync(o.targetVersion);if(e)return e.then(function(){return s.openHome()});pxt.debug("loading "+o.id+" (pxt v"+o.targetVersion+")"),this.stopSimulator(!0),pxt.appTarget.simulator&&pxt.appTarget.simulator.aspectRatio&&d.driver.preload(pxt.appTarget.simulator.aspectRatio),this.clearSerial(),this.firstRun=!0,this.setState({autoRun:this.autoRunOnStart(),tracing:void 0});var t=this.state.editorState;return t&&a&&(void 0===a.filters&&(a.filters=t.filters),void 0===a.hasCategories&&(a.hasCategories=t.hasCategories),void 0===a.searchBar&&(a.searchBar=t.searchBar)),!o.cloudSync&&this.cloudSync()&&(o.cloudSync=!0),(o.backupRef?h.restoreFromBackupAsync(o):Promise.resolve()).then(function(){return W.loadPkgAsync(o.id)}).then(function(){return s.state&&s.state.header==o||s.showPackageErrorsOnNextTypecheck(),d.setDirty(),p.newProjectAsync()}).then(function(){return p.applyUpgradesAsync()}).then(function(){return s.loadTutorialTemplateCodeAsync()}).then(function(){var e=W.getEditorPkg(W.mainPkg);W.mainPkg.config.preferredEditor&&(o.editor=W.mainPkg.config.preferredEditor);var t=e.getMainFile(),n=o.editor!=pxt.BLOCKS_PROJECT_NAME&&s.settings.fileHistory.filter(function(e){return e.id==o.id})[0];n&&(t=e.lookupFile(n.name)||t),!n&&o.editor&&t.getVirtualFileName(o.editor)&&(t=e.lookupFile("this/"+t.getVirtualFileName(o.editor))||t),pxt.editor.isBlocks(t)&&!t.content&&(t.content||(t=e.lookupFile("this/"+t.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME))||t)),"main.ts"===t.name&&(s.shouldTryDecompile=!0),s.setState({home:!1,showFiles:!!o.githubId,editorState:a,tutorialOptions:o.tutorial,header:o,projectName:o.name,currFile:t,sideDocsLoadUrl:"",debugging:!1}),W.getEditorPkg(W.mainPkg).onupdate=function(){s.loadHeaderAsync(o,s.state.editorState).done()},W.mainPkg.getCompileOptionsAsync().catch(function(e){if(e instanceof pxt.cpp.PkgConflictError){var t=e,n=function(e){return{label:lf("Remove {0}",e.id),class:"pink",icon:"trash",onclick:function(){m.showLoading("removedep",lf("Removing {0}...",e.id)),W.mainEditorPkg().removeDepAsync(e.id).then(function(){return s.reloadHeaderAsync()}).finally(function(){return m.hideLoading("removedep")})}}};m.dialogAsync({hideCancel:!0,buttons:[n(t.pkg1),n(t.pkg0)],header:lf("Extensions cannot be used together"),body:lf("Extensions '{0}' and '{1}' cannot be used together, because they use incompatible settings ({2}).",t.pkg1.id,t.pkg0.id,t.settingName)})}}).done();var r=s.pickEditorFor(t),i=e.lookupFile("this/README.md");return!o.githubId&&i&&i.content&&i.content.trim()?s.setSideMarkdown(i.content):W.mainPkg&&W.mainPkg.config&&W.mainPkg.config.documentation&&s.setSideDoc(W.mainPkg.config.documentation,r==s.blocksEditor),h.saveAsync(o)}).then(function(){return s.loadTutorialFiltersAsync()}).finally(function(){pxt.BrowserUtils.changeHash("#editor",!0),document.getElementById("root").focus(),s.editorLoaded()})},q.prototype.loadTutorialFiltersAsync=function(){var n=this,r=W.mainEditorPkg().header;if(!r||!r.tutorial||!r.tutorial.tutorialMd)return Promise.resolve();pxt.perf.measureStart("loadTutorial loadBlockly");var i=r.tutorial;return this.loadBlocklyAsync().then(function(){return $.getUsedBlocksAsync(i.tutorialCode)}).then(function(e){var t={searchBar:!1};e&&0<Object.keys(e).length&&(t.filters={blocks:e,defaultState:pxt.editor.FilterState.Hidden},t.hasCategories=!(r.tutorial.metadata&&r.tutorial.metadata.flyoutOnly)),n.setState({editorState:t}),n.editor.filterToolbox(!0),i.tutorialStepInfo[r.tutorial.tutorialStep].fullscreen&&n.showTutorialHint()}).catch(function(e){pxt.tickEvent("tutorial.faileddecompile",{tutorialId:i.tutorial}),m.errorNotification(lf("Oops, an error occured as we were loading the tutorial.")),n.exitTutorial(!0)}).finally(function(){pxt.perf.measureEnd("loadTutorial loadBlockly")})},q.prototype.loadTutorialTemplateCodeAsync=function(){var e=W.mainEditorPkg().header;if(!e||!e.tutorial||!e.tutorial.templateCode)return Promise.resolve();var t=e.tutorial.templateCode;delete e.tutorial.templateCode;var n=Promise.resolve();return e.editor===pxt.JAVASCRIPT_PROJECT_NAME?W.mainEditorPkg().setFile("main.ts",t):n=e.editor===pxt.PYTHON_PROJECT_NAME?p.decompilePythonSnippetAsync(t).then(function(e){e&&W.mainEditorPkg().setFile("main.py",e)}):p.decompileBlocksSnippetAsync(t).then(function(e){e&&W.mainEditorPkg().setFile("main.blocks",e)}),n.then(function(){return h.saveAsync(e)})},q.prototype.removeProject=function(){var t=this;W.mainEditorPkg().header&&m.confirmDelete(W.mainEditorPkg().header.name,function(){var e=W.mainEditorPkg().header;return e.isDeleted=!0,h.saveAsync(e,{}).then(function(){return t.openHome()})})},q.prototype.isHexFile=function(e){return/\.(hex|uf2)$/i.test(e)},q.prototype.isBlocksFile=function(e){return/\.blocks$/i.test(e)},q.prototype.isTypescriptFile=function(e){return/\.ts$/i.test(e)},q.prototype.isPythonFile=function(e){return/\.py$/i.test(e)},q.prototype.isProjectFile=function(e){return/\.(pxt|mkcd|mkcd-\w+)$/i.test(e)},q.prototype.isPNGFile=function(e){return pxt.appTarget.compile.saveAsPNG&&/\.png$/i.test(e)},q.prototype.isAssetFile=function(e){var t=pxt.appTarget.runtime?pxt.appTarget.runtime.assetExtensions:null;if(t){var n=e.replace(/.*\./,"").toLowerCase();return 0<=t.indexOf(n)}return!1},q.prototype.importProjectCoreAsync=function(e,n){var r=this;return(e[0]=="{".charCodeAt(0)?Promise.resolve(pxt.U.uint8ArrayToString(e)):pxt.lzmaDecompressAsync(e)).then(function(e){var t=JSON.parse(e);r.importHex(t,n)}).catch(function(e){m.warningNotification(lf("Sorry, we could not import this project.")),r.openHome()})},q.prototype.importHexFile=function(e,t){var n=this;e&&pxt.cpp.unpackSourceFromHexFileAsync(e).then(function(e){return n.importHex(e,t)}).catch(function(e){pxt.reportException(e),m.warningNotification(lf("Sorry, we could not recognize this file."))})},q.prototype.importBlocksFiles=function(t,e){var n=this;t&&ts.pxtc.Util.fileReadAsTextAsync(t).done(function(e){n.newProject({filesOverride:{"main.blocks":e,"main.ts":"  "},name:t.name.replace(/\.blocks$/i,"")||lf("Untitled")})})},q.prototype.importTypescriptFile=function(t,e){var n=this;t&&ts.pxtc.Util.fileReadAsTextAsync(t).done(function(e){n.newProject({filesOverride:{"main.blocks":"","main.ts":e||"  "},name:t.name.replace(/\.ts$/i,"")||lf("Untitled")})})},q.prototype.importProjectFile=function(e,t){var n=this;e&&ts.pxtc.Util.fileReadAsBufferAsync(e).then(function(e){return n.importProjectCoreAsync(e,t)})},q.prototype.importPNGFile=function(e,t){var n=this;e&&ts.pxtc.Util.fileReadAsBufferAsync(e).then(function(e){return g.decodeBlobAsync("data:image/png;base64,"+btoa(pxt.Util.uint8ArrayToString(e)))}).then(function(e){return n.importProjectCoreAsync(e,t)})},q.prototype.importPNGBuffer=function(e){var t=this;g.decodeBlobAsync("data:image/png;base64,"+btoa(pxt.Util.uint8ArrayToString(new Uint8Array(e)))).then(function(e){return t.importProjectCoreAsync(e)})},q.prototype.importAssetFile=function(n){ts.pxtc.Util.fileReadAsBufferAsync(n).then(function(e){var t=n.name.replace(/.*[\/\\]/,"");return W.mainEditorPkg().saveAssetAsync(t,e)}).done()},q.prototype.importHex=function(t,n){var r=this;if(!t||!t.meta){if(!t||!t[pxt.CONFIG_NAME])return m.warningNotification(lf("Sorry, we could not recognize this file.")),void(n&&n.openHomeIfFailed&&this.openHome());t=u.reconstructMeta(t)}if("object"==typeof t.source&&(t.source=JSON.stringify(t.source)),this.hexFileImporters.some(function(e){return"default"==e.id&&e.canImport(t)})){var e=this.tryCheckTargetVersionAsync(t.meta.targetVersions&&t.meta.targetVersions.target);if(e)return void e.done(function(){n&&n.openHomeIfFailed&&r.newProject()})}if(n&&n.extension){if(pxt.tickEvent("import.extension"),ts.pxtc.Util.jsonTryParse(t.source)){var i=t.meta.name,o=t.meta.name+".json",a=W.mainEditorPkg();a&&(pxt.debug("adding "+o+" to package"),a.setContentAsync(o,t.source).then(function(){return a.updateConfigAsync(function(e){e.dependencies||(e.dependencies={}),e.dependencies[i]="pkg:"+o})}).then(function(){return a.savePkgAsync()}).done(function(){return r.reloadHeaderAsync()}))}}else{var s=this.hexFileImporters.filter(function(e){return e.canImport(t)})[0];s?(pxt.tickEvent("import",{id:s.id}),m.hideDialog(),m.showLoading("importhex",lf("loading project...")),pxt.editor.initEditorExtensionsAsync().then(function(){return s.importAsync(r,t).done(function(){return m.hideLoading("importhex")},function(e){pxt.reportException(e,{importer:s.id}),m.hideLoading("importhex"),m.errorNotification(lf("Oops, something went wrong when importing your project")),n&&n.openHomeIfFailed&&r.openHome()})})):(m.warningNotification(lf("Sorry, we could not import this project.")),pxt.tickEvent("warning.importfailed"),n&&n.openHomeIfFailed&&this.openHome())}},q.prototype.importProjectAsync=function(e,t){var n=this,r=e.header;return r||(r={target:pxt.appTarget.id,targetVersion:void 0,editor:pxt.BLOCKS_PROJECT_NAME,name:lf("Untitled"),meta:{},pubId:"",pubCurrent:!1}),h.installAsync(r,e.text).then(function(e){return n.loadHeaderAsync(e,t)})},q.prototype.importTutorialAsync=function(e){try{var t=ge(e,"untitled","untitled","",!1),n=t.options,r=t.editor,i=pxt.gallery.parsePackagesFromMarkdown(e);return this.createProjectAsync({name:"untitled",tutorial:n,preferredEditor:r,dependencies:i})}catch(e){return L.userError("Could not import tutorial"),Promise.reject(e)}},q.prototype.initDragAndDrop=function(){var n=this;O.setupDragAndDrop(document.body,function(e){return e.size<1e6&&n.isHexFile(e.name)||n.isBlocksFile(e.name)},function(e){e&&(pxt.tickEvent("dragandrop.open"),n.importFile(e[0]))},function(t){n.isPNGFile(t)&&pxt.Util.httpRequestCoreAsync({url:t,method:"GET",responseArrayBuffer:!0}).then(function(e){return n.importUri(t,e.buffer)}).catch(function(e){return m.handleNetworkError(e)})})},q.prototype.importUri=function(e,t){this.isPNGFile(e)&&this.importPNGBuffer(t)},q.prototype.importFile=function(t,e){if(t&&!pxt.shell.isReadOnly())if(this.isHexFile(t.name))this.importHexFile(t,e);else if(this.isBlocksFile(t.name))this.importBlocksFiles(t,e);else if(this.isTypescriptFile(t.name))this.importTypescriptFile(t,e);else if(this.isProjectFile(t.name))this.importProjectFile(t,e);else if(this.isAssetFile(t.name))this.importAssetFile(t);else if(this.isPNGFile(t.name))this.importPNGFile(t,e);else{var n=this.resourceImporters.filter(function(e){return e.canImport(t)})[0];n?n.importAsync(this,t).done():m.warningNotification(lf("Oops, don't know how to load this file!"))}},q.prototype.importProjectFromFileAsync=function(e,n){var r=this;return pxt.lzmaDecompressAsync(e).then(function(e){var t=JSON.parse(e);return r.importHex(t,n)}).catch(function(){return r.newProject()})},q.prototype.syncPreferredEditor=function(){var e=this.getPreferredEditor();e&&W.mainPkg.setPreferredEditor(e)},q.prototype.exportProjectToFileAsync=function(){return this.syncPreferredEditor(),W.mainPkg.compressToFileAsync()},q.prototype.exportAsync=function(){return pxt.debug("exporting project"),this.exportProjectToFileAsync().then(function(e){return ts.pxtc.encodeBase64(L.uint8ArrayToString(e))})},q.prototype.downloadScreenshotAsync=function(){return pxt.appTarget.compile.saveAsPNG?this.saveProjectAsPNGAsync(!1):this.requestScreenshotAsync().then(function(e){return pxt.BrowserUtils.browserDownloadDataUri(e,W.genFileName(".png"))})},q.prototype.pushScreenshotHandler=function(e){this.screenshotHandlers.push(e)},q.prototype.popScreenshotHandler=function(){this.screenshotHandlers.pop()},q.prototype.requestScreenshotAsync=function(){var n=this;return this.requestScreenshotPromise?this.requestScreenshotPromise:(this.setState({screenshoting:!0}),d.driver.postMessage({type:"screenshot"}),this.requestScreenshotPromise=new Promise(function(t,e){n.pushScreenshotHandler(function(e){return t(pxt.BrowserUtils.imageDataToPNG(e.data))})}).timeout(1e3).catch(function(e){pxt.tickEvent("screenshot.timeout")}).finally(function(){n.popScreenshotHandler(),n.requestScreenshotPromise=void 0,n.setState({screenshoting:!1})}))},q.prototype.encodeProjectAsPNGAsync=function(t,n){var r=this;return this.exportProjectToFileAsync().then(function(e){return g.encodeBlobAsync(r.state.header.name,t,e)}).then(function(e){var t=W.genFileName(".png");return pxt.BrowserUtils.browserDownloadDataUri(e,t),n?m.dialogAsync({header:lf("Project Saved!"),disagreeLbl:lf("Got it!"),disagreeClass:"green",hasCloseIcon:!1,jsx:V.createElement("div",{className:"ui items"},V.createElement("div",{className:"item"},V.createElement("div",{className:"ui small image"},V.createElement("a",{download:t,className:"ui link",href:e},V.createElement("img",{src:e,alt:lf("Project cartridge"),title:lf("Click to download again")}))),V.createElement("div",{className:"content"},V.createElement("div",{className:"description"},V.createElement("p",null,lf("Your project is saved in this image."),lf("Import or drag it into the editor to reload it."))))))}):Promise.resolve()})},q.prototype.saveProjectAsPNGAsync=function(t){var n=this;return this.requestScreenshotAsync().then(function(e){return n.encodeProjectAsPNGAsync(e,t)})},q.prototype.saveProjectToFileAsync=function(){var e=W.mainPkg;return me()?(pxt.BrowserUtils.browserDownloadText(e.readFile("main.blocks"),W.genFileName(".blocks"),"application/xml"),Promise.resolve()):pxt.commands.saveProjectAsync?(m.infoNotification(lf("Saving...")),this.syncPreferredEditor(),e.saveToJsonAsync().then(function(e){return pxt.commands.saveProjectAsync(e)})):pxt.appTarget.compile.saveAsPNG?this.saveProjectAsPNGAsync(!0):this.exportProjectToFileAsync().then(function(e){var t=W.genFileName(".mkcd");pxt.BrowserUtils.browserDownloadUInt8Array(e,t,"application/octet-stream")})},q.prototype.cloudSync=function(){return this.hasSync()},q.prototype.cloudSignInDialog=function(){var e=this,t=u.providers();0!=t.length&&(1==t.length?t[0].loginAsync().then(function(){e.cloudSignInComplete()}):this.signInDialog.show())},q.prototype.cloudSignOut=function(){var n=this;m.confirmAsync({header:lf("Sign out"),body:lf("You are signing out. Make sure that you commited all your changes, local projects will be deleted."),agreeClass:"red",agreeIcon:"sign out",agreeLbl:lf("Sign out")}).then(function(e){if(e){var t=!!n.state.header;return h.resetCloudAsync().then(function(){t&&n.openHome(),n.home&&n.home.forceUpdate()})}return Promise.resolve()})},q.prototype.cloudSignInComplete=function(){var e=this;pxt.log("cloud sign in complete"),F(),u.syncAsync().then(function(){e.forceUpdate()}).done()},q.prototype.openHome=function(){var e=this;!pxt.shell.isControllerMode()&&(this.stopSimulator(!0),this.editor&&this.editor.unloadFileAsync(),pxt.BrowserUtils.changeHash("",!0),this.editorFile=void 0,this.setStateAsync({home:!0,tracing:void 0,fullscreen:void 0,tutorialOptions:void 0,editorState:void 0,debugging:void 0,header:void 0,currFile:void 0,fileState:void 0}).then(function(){return e.allEditors.forEach(function(e){return e.setVisible(!1)}),e.homeLoaded(),e.showPackageErrorsOnNextTypecheck(),h.syncAsync()}).done())},q.prototype.homeLoaded=function(){pxt.tickEvent("app.home")},q.prototype.editorLoaded=function(){pxt.tickEvent("app.editor")},q.prototype.reloadEditor=function(){try{window.removeEventListener("hashchange",he),l&&(pxt.BrowserUtils.isIFrame()&&("pub"===l.cmd||"sandbox"===l.cmd)||"tutorial"==l.cmd)?location.hash="#"+l.cmd+":"+l.arg:this.state&&this.state.home?location.hash="#reload":this.state&&this.state.header&&!this.state.header.isDeleted&&(location.hash="#editor"),location.reload()}catch(e){pxt.reportException(e),location.reload()}},q.prototype.getPreferredEditor=function(){if(this.editor==this.blocksEditor)return pxt.BLOCKS_PROJECT_NAME;if(this.editor==this.textEditor)switch(this.textEditor.fileType){case"python":return pxt.PYTHON_PROJECT_NAME;default:return pxt.JAVASCRIPT_PROJECT_NAME}},q.prototype.openExtension=function(e,t,n){pxt.tickEvent("app.openextension",{extension:e}),this.extensions.showExtension(e,t,n)},q.prototype.handleExtensionRequest=function(e){this.extensions.handleExtensionRequest(e)},q.prototype.newEmptyProject=function(e,t){this.newProject({filesOverride:{"main.blocks":'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>'},name:e,documentation:t})},q.prototype.newProject=function(e){var t=this;return void 0===e&&(e={}),pxt.tickEvent("app.newproject"),m.showLoading("newproject",lf("creating new project...")),this.createProjectAsync(e).then(function(){return t.autoChooseBoardAsync()}).then(function(){return Promise.delay(500)}).finally(function(){return m.hideLoading("newproject")})},q.prototype.createProjectAsync=function(t){var n=this;pxt.perf.measureStart("createProjectAsync"),this.setSideDoc(void 0),t.prj||(t.prj=pxt.appTarget.blocksprj);var e=pxt.U.clone(t.prj.config);e.name=t.name||lf("Untitled"),e.documentation=t.documentation;var r=L.clone(t.prj.files);if(t.filesOverride&&L.jsonCopyFrom(r,t.filesOverride),t.dependencies&&L.jsonMergeFrom(e.dependencies,t.dependencies),t.extensionUnderTest){var i=h.getHeader(t.extensionUnderTest);i&&(e.dependencies[i.name]="workspace:"+i.id)}return t.tsOnly&&(e.files=e.files.filter(function(e){return"main.blocks"!=e}),delete r["main.blocks"]),t.preferredEditor&&(e.preferredEditor=t.preferredEditor),e.preferredEditor==pxt.PYTHON_PROJECT_NAME&&e.files.indexOf("main.py")<0&&(e.files.push("main.py"),r["main.py"]="\n"),t.tutorial&&t.tutorial.metadata&&(t.tutorial.metadata.codeStart&&(r["_onCodeStart.ts"]="control._onCodeStart('"+pxt.U.htmlEscape(t.tutorial.metadata.codeStart)+"')",e.files.splice(e.files.indexOf("main.ts"),0,"_onCodeStart.ts")),t.tutorial.metadata.codeStop&&(r["_onCodeStop.ts"]="control._onCodeStop('"+pxt.U.htmlEscape(t.tutorial.metadata.codeStop)+"')",e.files.push("_onCodeStop.ts"))),r[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(e),h.installAsync({name:e.name,meta:{},editor:t.preferredEditor||t.prj.id,pubId:"",pubCurrent:!1,target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target,cloudSync:this.cloudSync(),temporary:t.temporary,tutorial:t.tutorial,extensionUnderTest:t.extensionUnderTest},r).then(function(e){return n.loadHeaderAsync(e,{filters:t.filters})}).then(function(){return pxt.perf.measureEnd("createProjectAsync")})},q.prototype.autoChooseBoardAsync=function(e){return pxt.appTarget.appTheme.chooseBoardOnNewProject&&pxt.appTarget.simulator&&pxt.appTarget.simulator.dynamicBoardDefinition?this.showBoardDialogAsync(e,!1):Promise.resolve()},q.prototype.importExampleAsync=function(e){var n,r=this,t=e.name,i=e.path,o=e.loadBlocks,a=e.prj;return m.showLoading("changingcode",lf("loading...")),pxt.gallery.loadExampleAsync(t.toLowerCase(),i).then(function(e){if(!e)return Promise.resolve();var t=e;return a&&(t.prj=a),n=e.features,o?r.createProjectAsync(t).then(function(){return r.loadBlocklyAsync().then(p.getBlocksAsync).then(function(e){return p.decompileAsync("main.ts",e)}).then(function(e){pxt.debug("example decompilation: "+e.success),e.success&&r.overrideBlocksFile(e.outfiles["main.blocks"])})}):(t.tsOnly=!0,r.createProjectAsync(t).then(function(){return Promise.delay(500)}))}).then(function(){return r.autoChooseBoardAsync(n)}).finally(function(){return m.hideLoading("changingcode")})},q.prototype.switchTypeScript=function(){var e=W.mainEditorPkg(),t=this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),n=e.files[t];this.setFile(n)},q.prototype.saveBlocksToTypeScriptAsync=function(){return this.blocksEditor.saveToTypeScriptAsync()},q.prototype.saveVirtualFileAsync=function(e,t,n){var r=this;t=t||"\n";var i=W.mainEditorPkg(),o=this.editorFile.getVirtualFileName(e);return L.assert(o!=this.editorFile.name),i.setContentAsync(o,t).then(function(){if(n){var e=i.files[o];r.setFile(e)}})},q.prototype.saveTypeScriptAsync=function(t){var n=this;if(void 0===t&&(t=!1),!this.editor||!this.state.currFile||this.editorFile.epkg!=W.mainEditorPkg()||this.reload)return Promise.resolve();var e=t?this.textEditor.loadMonacoAsync():Promise.resolve();return e=e.then(function(){return n.editor.saveToTypeScriptAsync()}).then(function(e){return void 0===e&&t?m.confirmAsync({header:lf("Oops, there is a problem converting your code."),body:lf("We are unable to convert your code back to JavaScript."),agreeLbl:lf("Done"),agreeClass:"cancel",agreeIcon:"cancel"}).then(function(e){}):void 0===e||n.editorFile.name==n.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)?Promise.resolve():n.saveVirtualFileAsync(pxt.JAVASCRIPT_PROJECT_NAME,e,t)}),t?m.showLoadingAsync("switchtojs",lf("switching to JavaScript..."),e,0):e},q.prototype.resetWorkspace=function(){var e=this;return this.reload=!0,window.location.hash="#reload",h.resetAsync().done(function(){return e.reloadEditor()},function(){return e.reloadEditor()})},q.prototype.pair=function(){return(pxt.commands.webUsbPairDialogAsync?pxt.commands.webUsbPairDialogAsync(m.confirmAsync):Promise.resolve(1)).then(function(e){return e?pxt.usb.pairAsync().then(function(){K.setWebUSBPaired(!0),m.infoNotification(lf("Device paired! Try downloading now."))},function(e){m.errorNotification(lf("Failed to pair the device: {0}",e.message))}):Promise.resolve()})},q.prototype.saveAndCompile=function(){var t=this;if(this.state.header)return this.setState({isSaving:!0}),(this.state.projectName!==lf("Untitled")?Promise.resolve(!0):this.showRenameProjectDialogAsync()).then(function(e){return e?t.saveProjectNameAsync().then(function(){return t.saveFileAsync()}).then(function(){!pxt.appTarget.compile.hasHex||pxt.appTarget.compile.useMkcd||pxt.appTarget.compile.saveAsPNG||me()?t.saveProjectToFileAsync().finally(function(){t.setState({isSaving:!1})}).done():t.compile(!0)}):(t.setState({isSaving:!1}),Promise.resolve())})},q.prototype.checkForHwVariant=function(){var a=this;if(pxt.hwVariant||!pxt.hasHwVariants())return!1;var s=pxt.getHwVariants();return 0!=s.length&&(pxt.usb.isEnabled&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.checkForHwVariantWebUSB&&this.checkWebUSBVariant?v.initAsync(!0).then(function(e){if(e.familyID)for(var t=0,n=s;t<n.length;t++){var r=n[t],i=pxt.U.clone(pxt.appTarget.compile);if(r.compileServiceVariant){var o=pxt.appTarget.variants[r.compileServiceVariant];o.compile&&pxt.U.jsonCopyFrom(i,o.compile)}if(parseInt(i.uf2Family)===e.familyID)return pxt.setHwVariant(r.name),pxt.tickEvent("projects.choosehwvariant",{hwid:pxt.hwVariant,card:"HID-"+pxt.hwVariant}),void a.reloadHeaderAsync().then(function(){return a.compile()})}a.checkWebUSBVariant=!1,a.checkForHwVariant()},function(){return E.showWebUSBPairingInstructionsAsync(null).then(function(){a.checkForHwVariant()},function(e){a.checkWebUSBVariant=!1,a.checkForHwVariant()})}).then(function(){pxt.perf.recordMilestone("HID bridge init finished")}):this.showChooseHwDialog(),!0)},q.prototype.beforeCompile=function(){},q.prototype.compile=function(i){var o=this;if(void 0===i&&(i=!1),pxt.tickEvent("compile"),pxt.debug("compiling..."),!this.checkForHwVariant())if(pxt.appTarget.compile.saveAsPNG&&pxt.hasHwVariants()&&!pxt.hwVariant)this.saveAndCompile();else{this.beforeCompile();var a=void 0;if(pxt.appTarget.compile.useModulator||!pxt.BrowserUtils.isBrowserDownloadInSameWindow()||pxt.BrowserUtils.isBrowserDownloadWithinUserContext()||(a=window.open("")),this.state.compiling)pxt.tickEvent("compile.double");else{var e=this.state.simState!=pxt.editor.SimState.Stopped;e&&this.state.simState==pxt.editor.SimState.Pending&&pxt.appTarget.simulator.emptyRunCode&&!this.isBlocksEditor()&&(e=!1),this.setState({compiling:!0}),this.clearSerial(),this.editor.beforeCompile(),e&&this.stopSimulator();var r=this.editor.snapshotState();this.syncPreferredEditor(),p.compileAsync({native:!0,forceEmit:!0}).then(function(e){o.editor.setDiagnostics(o.editorFile,r);var t=pxt.outputName();if(!e.outfiles[t])return pxt.tickEvent("compile.noemit"),m.warningNotification(lf("Compilation failed, please check your code for errors.")),Promise.resolve(null);e.saveOnly=i,e.userContextWindow=a,e.downloadFileBaseName=W.genFileName(""),e.confirmAsync=m.confirmAsync;var n=o.state.header;return n&&(e.headerId=n.id),pxt.commands.patchCompileResultAsync?pxt.commands.patchCompileResultAsync(e).then(function(){return e}):e}).then(function(e){if(!e)return Promise.resolve();if(i)return pxt.commands.saveOnlyAsync(e);e.success||o.maybeShowPackageErrors(!0)||m.confirmAsync({header:lf("Compilation failed"),body:lf("Ooops, looks like there are errors in your program."),hideAgree:!0,disagreeLbl:lf("Close")});var r=Date.now();return pxt.tickEvent("deploy.start"),pxt.commands.deployAsync(e,{reportDeviceNotFoundAsync:function(e,t){return pxt.tickEvent("deploy.devicenotfound"),o.showDeviceNotFoundDialogAsync(e,t)},reportError:function(e){return pxt.tickEvent("deploy.reporterror"),m.errorNotification(e)},showNotification:function(e){return m.infoNotification(e)}}).then(function(){var e=Date.now()-r;pxt.tickEvent("deploy.finished",{elapsedMs:e})}).catch(function(e){if(e.notifyUser)m.warningNotification(e.message);else{var t=pxt.appTarget.appTheme.useUploadMessage?lf("Upload failed, please try again."):lf("Download failed, please try again.");m.warningNotification(t)}var n=Date.now()-r;if(pxt.tickEvent("deploy.exception",{notifyUser:e.notifyUser,elapsedMs:n}),pxt.reportException(e),a)try{a.close()}catch(e){}})}).catch(function(e){if(pxt.reportException(e),m.errorNotification(lf("Compilation failed, please contact support.")),a)try{a.close()}catch(e){}}).finally(function(){o.setState({compiling:!1,isSaving:!1}),e&&o.runSimulator()}).done()}}},q.prototype.showDeviceNotFoundDialogAsync=function(e,t){pxt.tickEvent("compile.devicenotfound");var n=pxt.outputName().replace(/[^.]*/,""),r=W.genFileName(n);return K.setWebUSBPaired(!1),m.dialogAsync({header:lf("Oops, we couldn't find your {0}",pxt.appTarget.appTheme.boardName),body:lf("Please make sure your {0} is connected and try again.",pxt.appTarget.appTheme.boardName),buttons:[{label:lf("Troubleshoot"),className:"focused",icon:"help",url:e,onclick:function(){pxt.tickEvent("compile.devicenotfound.troubleshoot")}},t?{label:r,icon:"download",className:"lightgrey",onclick:function(){return pxt.tickEvent("compile.devicenotfound.download"),pxt.commands.saveOnlyAsync(t)}}:void 0],hideCancel:!0,hasCloseIcon:!0})},q.prototype.overrideTypescriptFile=function(e){this.textEditor&&this.textEditor.overrideFile(e)},q.prototype.overrideBlocksFile=function(e){this.blocksEditor&&this.blocksEditor.overrideFile(e)},q.prototype.startStopSimulator=function(e){switch(this.state.simState){case pxt.editor.SimState.Starting:case pxt.editor.SimState.Pending:break;case pxt.editor.SimState.Running:this.stopSimulator(!1,e);break;default:this.maybeShowPackageErrors(!0),this.startSimulator(e),e&&e.clickTrigger&&d.driver.focus()}},q.prototype.toggleTrace=function(e){var t=this,n=!!this.state.tracing,r=!!this.state.debugging;n?(this.editor.clearHighlightedStatements(),d.setTraceInterval(0)):d.setTraceInterval(e||d.SLOW_TRACE_INTERVAL),this.setState({tracing:!n,debugging:r&&!n},function(){return t.restartSimulator()})},q.prototype.setTrace=function(e,t){!!this.state.tracing!=e?this.toggleTrace(t):this.state.tracing&&(d.setTraceInterval(t||d.SLOW_TRACE_INTERVAL),this.startSimulator())},q.prototype.proxySimulatorMessage=function(e){d.proxy({type:"custom",content:e})},q.prototype.toggleSimulatorCollapse=function(){var e=this.state;pxt.tickEvent("simulator.toggleCollapse",{view:"computer",collapsedTo:""+!e.collapseEditorTools},{interactiveConsent:!0}),e.simState==pxt.editor.SimState.Stopped&&e.collapseEditorTools&&this.startStopSimulator(),e.collapseEditorTools?this.expandSimulator():this.collapseSimulator()},q.prototype.expandSimulator=function(){pxt.appTarget.simulator.headless?d.unhide():this.startSimulator(),this.setState({collapseEditorTools:!1})},q.prototype.collapseSimulator=function(){var e=this;d.hide(function(){e.setState({collapseEditorTools:!0})})},q.prototype.toggleSimulatorFullscreen=function(){this.state.fullscreen?document.removeEventListener("keydown",this.closeOnEscape):(document.addEventListener("keydown",this.closeOnEscape),d.driver.focus()),this.closeFlyout(),this.setState({fullscreen:!this.state.fullscreen})},q.prototype.closeFlyout=function(){this.editor.closeFlyout()},q.prototype.toggleMute=function(){this.setMute(!this.state.mute)},q.prototype.setMute=function(e){d.mute(e),this.setState({mute:e})},q.prototype.openInstructions=function(){var e=this,t=this.state.simState!=pxt.editor.SimState.Stopped;t&&this.stopSimulator(),_.makeAsync().finally(function(){t&&e.startSimulator()})},q.prototype.printCode=function(){if(this.state.header){var e=W.mainEditorPkg().getAllFiles(),t=pxt.webConfig.docsUrl||"/--docs",n=H.isBlocksActive()?"blocks":"typescript";window.localStorage.printjob=JSON.stringify(e);var r=t+"#print:job:"+n+":"+pxt.Util.localeInfo();m.dialogAsync({header:lf("Print Code"),hasCloseIcon:!0,hideCancel:!0,size:"large",jsx:V.createElement("div",{className:"ui container"},V.createElement("div",{id:"printcontainer",style:{position:"relative",height:0,paddingBottom:"40%",overflow:"hidden"}},V.createElement("iframe",{frameBorder:"0","aria-label":lf("Print preview"),sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:r})))}).done(function(e){})}},q.prototype.clearSerial=function(){this.serialEditor.clear();var e=this.refs.simIndicator,t=this.refs.devIndicator;e&&e.clear(),t&&t.clear()},q.prototype.shouldStartSimulator=function(){switch(this.state.simState){case pxt.editor.SimState.Starting:case pxt.editor.SimState.Running:return!1}return!!pxt.shell.isControllerMode()||!this.state.home},q.prototype.isSimulatorRunning=function(){return this.state.simState==pxt.editor.SimState.Running},q.prototype.restartSimulator=function(){var e=this.state.tracing||this.state.debugging;this.state.simState==pxt.editor.SimState.Stopped||d.driver.isDebug()!=!!e?this.startSimulator():(d.driver.stopSound(),d.driver.restart()),d.driver.focus(),e||this.blocksEditor.clearBreakpoints()},q.prototype.startSimulator=function(e){var t=this;pxt.tickEvent("simulator.start");var n=this.state.debugging||this.state.tracing,r=d.driver.isDebug()==n,i=e&&e.clickTrigger;return pxt.debug("start sim (autorun "+this.state.autoRun+")"),!this.shouldStartSimulator()&&r?(pxt.log("Ignoring call to start simulator, either already running or we shouldn't start."),Promise.resolve()):this.saveFileAsync().then(function(){return t.runSimulator({debug:n,clickTrigger:i})})},q.prototype.stopSimulator=function(e,t){pxt.perf.measureStart("stopSimulator"),pxt.tickEvent("simulator.stop");var n=t&&t.clickTrigger;pxt.debug("sim: stop (autorun "+this.state.autoRun+")"),this.runToken&&(this.runToken.cancel(),this.runToken=null),d.stop(e);var r=this.state.autoRun&&!n;this.setState({simState:pxt.editor.SimState.Stopped,autoRun:r}),pxt.perf.measureEnd("stopSimulator")},q.prototype.suspendSimulator=function(){pxt.tickEvent("simulator.suspend"),this.runToken&&(this.runToken.cancel(),this.runToken=null),d.suspend()},q.prototype.runSimulator=function(r){var i=this;void 0===r&&(r={});var o=this.firstRun&&r.background&&pxt.appTarget.simulator&&!!pxt.appTarget.simulator.emptyRunCode&&!this.isBlocksEditor();this.firstRun=!1,pxt.debug("sim: start run (autorun "+this.state.autoRun+", first "+this.firstRun+")"),this.runToken&&this.runToken.cancel();var a=new pxt.Util.CancellationToken;return(this.runToken=a).startOperation(),function(){var e=i.editor?i.editor.getId().replace(/Editor$/,""):"unknown";if(r.background){if(pxt.tickActivity("autorun","autorun."+e),localStorage.getItem("noAutoRun"))return Promise.resolve()}else pxt.tickEvent(r.debug?"debug":"run",{editor:e});r.background||i.editor.beforeCompile(),i.state.tracing&&(r.trace=!0),r.debug&&(r.debugExtensionCode=pxt.appTarget.appTheme.debugExtensionCode&&!i.isBlocksActive()),i.syncPreferredEditor(),d.stop(!1,!0);var t=i.autoRunOnStart()&&i.isBlocksEditor()&&(i.state.autoRun||!!r.clickTrigger),n=i.editor.snapshotState();return i.setStateAsync({simState:pxt.editor.SimState.Starting,autoRun:t}).then(function(){return o?Promise.resolve(p.emptyCompileResult()):p.compileAsync(r)}).then(function(e){a.isCancelled()?pxt.debug("sim: cancelled"):(i.clearSerial(),i.editor.setDiagnostics(i.editorFile,n),e.outfiles[pxtc.BINARY_JS]?a.isCancelled()||(pxt.debug("sim: run"),d.run(W.mainPkg,r.debug,e,{mute:i.state.mute,highContrast:i.state.highContrast,light:pxt.options.light,clickTrigger:r.clickTrigger,storedState:W.mainEditorPkg().getSimState(),autoRun:i.state.autoRun}),i.blocksEditor.setBreakpointsMap(e.breakpoints),i.textEditor.setBreakpointsMap(e.breakpoints),a.isCancelled()?(pxt.debug("sim: cancelled 2"),d.stop(),i.setState({simState:pxt.editor.SimState.Stopped})):i.setState({showParts:d.driver.hasParts()})):r.background||(m.warningNotification(lf("Oops, we could not run this project. Please check your code for errors.")),d.stop(),i.setState({simState:pxt.editor.SimState.Stopped})))}).finally(function(){a.isCancelled()||a.resolveCancel(),a=null})}()},q.prototype.simDebug=function(){pxt.tickEvent("menu.debug.sim"),this.stopSimulator(),this.runSimulator({debug:!0})},q.prototype.hwDebug=function(){pxt.tickEvent("menu.debug.hw");var e=Promise.resolve();return this.state.simState==pxt.editor.SimState.Running&&d.driver.isDebug()||(e=this.runSimulator({debug:!0})),e.then(function(){return d.driver.setHwDebugger({postMessage:function(e){pxt.HWDBG.handleMessage(e)}}),pxt.HWDBG.postMessage=function(e){return d.driver.handleHwDebuggerMsg(e)},Promise.join(p.compileAsync({debug:!0,native:!0}),v.initAsync()).then(function(e){return pxt.HWDBG.startDebugAsync(e[0],e[1])})})},q.prototype.toggleDebugging=function(){var e=this,t=!this.state.debugging;this.setState({debugging:t,tracing:!1},function(){e.renderCore(),e.editor&&(e.editor.updateBreakpoints(),e.editor.updateToolbox()),e.restartSimulator()})},q.prototype.dbgPauseResume=function(){d.dbgPauseResume()},q.prototype.dbgStepOver=function(){d.dbgStepOver()},q.prototype.dbgStepInto=function(){d.dbgStepInto()},q.prototype.dbgInsertBreakpoint=function(){this.editor.insertBreakpoint()},q.prototype.editText=function(){var e=this;this.editor!=this.textEditor&&(this.updateEditorFileAsync(this.textEditor).then(function(){e.textEditor.editor.focus()}),this.forceUpdate())},q.prototype.showScriptManager=function(){this.scriptManagerDialog.show()},q.prototype.importProjectDialog=function(){this.importDialog.show()},q.prototype.renderPythonAsync=function(e){return p.decompilePythonSnippetAsync(e.ts).then(function(e){return{python:e}})},q.prototype.blocksScreenshotAsync=function(e){return pxt.blocks.layout.screenshotEnabled()&&this.blocksEditor&&this.blocksEditor.isReady&&this.blocksEditor.editor?pxt.blocks.layout.screenshotAsync(this.blocksEditor.editor,e):Promise.resolve(void 0)},q.prototype.renderBlocksAsync=function(t){return p.getBlocksAsync().then(function(e){return p.decompileBlocksSnippetAsync(t.ts,e)}).then(function(e){var t=pxt.blocks.render(e,{snippetMode:!0,layout:pxt.blocks.BlockLayout.Align,splitSvg:!1}),n=t.getAttribute("viewBox").split(/\s+/).map(function(e){return parseInt(e)});return{svg:t,xml:pxt.blocks.layout.blocklyToSvgAsync(t,n[0],n[1],n[2],n[3])}})},q.prototype.launchFullEditor=function(){L.assert(pxt.shell.isSandboxMode());var t=pxt.appTarget.appTheme.embedUrl;/\/$/.test(t)||(t+="/");var e=W.mainPkg,n=W.getEditorPkg(e);pxt.shell.isReadOnly()?(n.header.pubId,t+="#pub:"+n.header.pubId,window.open(t,"_blank")):this.exportAsync().done(function(e){pxt.tickEvent("sandbox.openfulleditor"),t+="#project:"+e,window.open(t,"_blank")})},q.prototype.anonymousPublishAsync=function(r){var i=this;pxt.tickEvent("publish"),this.setState({publishing:!0});var o=W.mainPkg,a=W.getEditorPkg(o);return this.saveProjectNameAsync().then(function(){return i.saveFileAsync()}).then(function(){return o.filesToBePublishedAsync(!0)}).then(function(e){if(a.header.pubCurrent&&!r)return Promise.resolve(a.header.pubId);var t={description:o.config.description},n=i.blocksEditor.contentSize();return n&&(t.blocksHeight=n.height,t.blocksWidth=n.width),h.anonymousPublishAsync(a.header,e,t,r).then(function(e){return e.id})}).finally(function(){i.setState({publishing:!1})}).catch(function(e){throw m.errorNotification(e.message),e})},q.prototype.updateHeaderName=function(e){var t=this;this.setState({projectName:e}),this.debouncedSaveProjectName||(this.debouncedSaveProjectName=L.debounce(function(){t.saveProjectNameAsync().done()},pxt.options.light?2e3:500,!1)),this.debouncedSaveProjectName()},q.prototype.saveProjectNameAsync=function(){if(!this.state.projectName||!this.state.header)return Promise.resolve();try{return this.updateHeaderNameAsync(this.state.projectName)}catch(e){return pxt.reportException(e),Promise.resolve()}},q.prototype.updateHeaderNameAsync=function(e){var t=this;if(W.mainPkg.config.name==e)return Promise.resolve();W.mainPkg.config.name=e,pxt.debug("saving project name to "+e);var n=W.mainEditorPkg().lookupFile("this/"+pxt.CONFIG_NAME),r=JSON.parse(n.content);return r.name=e,n.setContentAsync(pxt.Package.stringifyConfig(r)).then(function(){t.state.header&&t.setState({projectName:e})}).then(function(){return h.renameAsync(t.state.header,e)})},q.prototype.isTextEditor=function(){return this.editor==this.textEditor},q.prototype.isPxtJsonEditor=function(){return this.editor==this.pxtJsonEditor},q.prototype.isBlocksEditor=function(){return this.editor==this.blocksEditor},q.prototype.loadBlocklyAsync=function(){return this.blocksEditor.loadBlocklyAsync()},q.prototype.showReportAbuse=function(){var e=this.state.tutorialOptions&&this.state.tutorialOptions.tutorialReportId||this.state.header&&this.state.header.pubCurrent&&this.state.header.pubId;y.showReportAbuseAsync(e)},q.prototype.showAboutDialog=function(){y.showAboutDialogAsync(this)},q.prototype.showShareDialog=function(e){var t=this.state.header;t&&this.shareEditor.show(t,e)},q.prototype.showLanguagePicker=function(){this.languagePicker.show()},q.prototype.showImportUrlDialog=function(){y.showImportUrlDialogAsync().then(function(e){e&&(pxt.github.isGithubId(e)?de(e):fe(e).done())},function(e){m.errorNotification(lf("Sorry, the project url looks invalid."))}).done()},q.prototype.showImportGithubDialog=function(){y.showImportGithubDialogAsync().then(function(e){"NEW"===e?y.showCreateGithubRepoDialogAsync().then(function(e){e&&de(e)}):e&&de(e)},function(e){m.errorNotification(lf("Sorry, that repository looks invalid."))}).done()},q.prototype.showImportFileDialog=function(t){var n=this;y.showImportFileDialogAsync(t).done(function(e){e&&(pxt.tickEvent("app.open.file"),n.importFile(e,t))})},q.prototype.showResetDialog=function(){var t=this;y.showResetDialogAsync().done(function(e){return e?Promise.resolve().then(function(){return pxt.winrt.releaseAllDevicesAsync()}).then(function(){return t.resetWorkspace()}):Promise.resolve()})},q.prototype.showExitAndSaveDialog=function(){this.setState({debugging:!1}),this.state.projectName!==lf("Untitled")?this.openHome():this.exitAndSaveDialog.show()},q.prototype.askForProjectNameAsync=function(){return this.newProjectNameDialog.askNameAsync()},q.prototype.showPackageDialog=function(){this.scriptSearch.showExtensions()},q.prototype.showBoardDialogAsync=function(e,t){return this.scriptSearch.showBoardsAsync(e,t)},q.prototype.showModalDialogAsync=function(e){return m.dialogAsync({header:e.header,body:e.body,hideCancel:!0,hasCloseIcon:!0,buttons:e.buttons})},q.prototype.showExperimentsDialog=function(){this.scriptSearch.showExperiments()},q.prototype.showChooseHwDialog=function(){this.chooseHwDialog&&this.chooseHwDialog.show()},q.prototype.showRecipesDialog=function(){this.chooseRecipeDialog&&this.chooseRecipeDialog.show()},q.prototype.showRenameProjectDialogAsync=function(){var r=this;if(!this.state.header)return Promise.resolve(!1);var e={header:lf("Rename your project"),agreeLbl:lf("Save"),agreeClass:"green",placeholder:lf("Enter your project name here")};return m.promptAsync(e).then(function(n){return null===n?Promise.resolve(!1):new Promise(function(e,t){r.setState({projectName:n},function(){return e()})}).then(function(){return r.saveProjectNameAsync()}).then(function(){return!0})})},q.prototype.startTutorial=function(e,t,n){pxt.tickEvent("tutorial.start"),this.startTutorialAsync(e,t,n)},q.prototype.startTutorialAsync=function(o,e,a){var s=this;m.hideDialog(),m.showLoading("tutorial",lf("starting tutorial...")),b.initTutorial();var l,t,r=pxt.Cloud.parseScriptId(o),c=pxt.github.parseRepoId(o),u=void 0,p=!0,d={},f=void 0,n=lf("Please check your internet access and ensure the tutorial is valid.");return a=a&&!!this.state.header,/^\//.test(o)?(l=e||o.split("/").reverse()[0].replace("-"," "),t=pxt.Cloud.markdownAsync(o,pxt.Util.userLanguage(),pxt.Util.localizeLive).then(function(e){return e&&(d=pxt.gallery.parsePackagesFromMarkdown(e),f=pxt.gallery.parseFeaturesFromMarkdown(e),p=!0),e}).catch(function(e){m.errorNotification(n),m.handleNetworkError(e)})):r?(pxt.tickEvent("tutorial.shared"),t=h.downloadFilesByIdAsync(r).then(function(e){var t=JSON.parse(e["pxt.json"]);d=t.dependencies||{},l=t.name||lf("Untitled"),p=!1,u=r;var n=e["README.md"];return n&&(pxt.Util.jsonMergeFrom(d,pxt.gallery.parsePackagesFromMarkdown(n)),f=pxt.gallery.parseFeaturesFromMarkdown(n)),n}).catch(function(e){m.errorNotification(n),m.handleNetworkError(e)})):t=c&&c.owner&&c.project?pxt.packagesConfigAsync().then(function(e){switch(pxt.github.repoStatus(c,e)){case pxt.github.GitRepoStatus.Banned:throw lf("This tutorial has been banned.");default:u="https://github.com/"+c.fullName}return pxt.github.downloadPackageAsync(c.fullName,e)}).then(function(e){var t=JSON.parse(e.files["pxt.json"]);t.files.find(function(e){return/\.ts/.test(e)})?(d={})[c.project]=pxt.github.toGithubDependencyPath(c):d=t.dependencies||{},l=t.name||lf("Untitled"),p=!1;var n=(c.fileName||"README")+".md",r=pxt.Util.normalizeLanguageCode(pxt.Util.userLanguage()),i=r&&r[1]&&e.files["_locales/"+r[0]+"-"+r[1]+"/"+n]||r&&r[0]&&e.files["_locales/"+r[0]+"/"+n]||e.files[n];return i&&(pxt.Util.jsonMergeFrom(d,pxt.gallery.parsePackagesFromMarkdown(i)),f=pxt.gallery.parseFeaturesFromMarkdown(i)),i}).catch(function(e){m.errorNotification(n),m.handleNetworkError(e)}):Promise.resolve(void 0),t.then(function(e){if(!e)throw new Error(lf("Tutorial not found"));var t=ge(e,o,l,u,!!a),n=t.options,r=t.editor;if(a){var i=W.mainEditorPkg().header;return i.tutorial=n,i.tutorialCompleted=void 0,s.loadHeaderAsync(i)}return s.createProjectAsync({name:l,tutorial:n,preferredEditor:r,dependencies:d})}).then(function(){return p?s.autoChooseBoardAsync(f):Promise.resolve()}).catch(function(e){m.errorNotification(n),m.handleNetworkError(e)}).finally(function(){return m.hideLoading("tutorial")})},q.prototype.completeTutorialAsync=function(){var t=this;pxt.tickEvent("tutorial.complete"),m.showLoading("leavingtutorial",lf("leaving tutorial..."));var e=this.state.header.tutorial;return e&&(this.state.tutorialOptions&&this.state.tutorialOptions.tutorialRecipe?this.state.header.tutorialCompleted=void 0:this.state.header.tutorialCompleted={id:e.tutorial,steps:e.tutorialStepInfo.length},this.state.header.tutorial=void 0),pxt.BrowserUtils.isIE()?(this.exitTutorial(),Promise.resolve()):this.exitTutorialAsync().then(function(){var e=W.mainEditorPkg().header;return t.loadHeaderAsync(e)}).finally(function(){return m.hideLoading("leavingtutorial")}).then(function(){pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.appTheme.shareFinishedTutorials&&(pxt.tickEvent("tutorial.share",void 0,{interactiveConsent:!1}),t.showShareDialog(lf("Well done! Would you like to share your project?")))})},q.prototype.exitTutorial=function(e){var t=this;pxt.tickEvent("tutorial.exit"),m.showLoading("leavingtutorial",lf("leaving tutorial..."));var n=this.state.header&&this.state.header.tutorial,r=n&&!!n.tutorialRecipe;this.exitTutorialAsync(e).finally(function(){m.hideLoading("leavingtutorial"),r||t.openHome()})},q.prototype.exitTutorialAsync=function(e){var t=this,n=W.mainEditorPkg().header;n.isDeleted=e;var r=W.mainEditorPkg().getAllFiles();return h.saveAsync(n,r).then(function(){return Promise.delay(500)}).finally(function(){t.setState({tutorialOptions:void 0,tracing:void 0,editorState:void 0}),m.resetFocus()})},q.prototype.showTutorialHint=function(e){var t=this.refs[q.tutorialCardId];t&&t.showHint(!0,e)},q.prototype.getExpandedCardStyle=function(e){var t=this.refs[q.tutorialCardId],n=2;return e&&(n+=2),t?{top:"calc("+t.getCardHeight()+"px + "+n+"em)"}:null},q.prototype.pokeUserActivity=function(){this.state.tutorialOptions&&this.state.tutorialOptions.tutorial&&this.hintManager.pokeUserActivity(q.tutorialCardId,this.state.tutorialOptions.tutorialHintCounter)},q.prototype.stopPokeUserActivity=function(){this.hintManager.stopPokeUserActivity()},q.prototype.tutorialCardHintCallback=function(){var e=this,t=this.state.tutorialOptions;t.tutorialHintCounter=t.tutorialHintCounter+1,this.setState({pokeUserComponent:q.tutorialCardId,tutorialOptions:t}),setTimeout(function(){e.setState({pokeUserComponent:null})},3e3)},q.prototype.toggleHighContrast=function(){var e=this,t=!this.state.highContrast;pxt.tickEvent("app.highcontrast",{on:t?1:0}),this.setState({highContrast:t},function(){e.isSimulatorRunning()&&e.startSimulator()}),m.setHighContrast(t),this.editor&&this.editor.isReady&&this.editor.setHighContrast(t)},q.prototype.toggleGreenScreen=function(){var e=!this.state.greenScreen;pxt.tickEvent("app.greenscreen",{on:e?1:0}),this.setState({greenScreen:e})},q.prototype.setBannerVisible=function(e){this.setState({bannerVisible:e})},q.prototype.hideLightbox=function(){this.setState({lightbox:!1})},q.prototype.showLightbox=function(){this.setState({lightbox:!0})},q.prototype.renderCore=function(){!function(e){if(H=e,z){for(;z.length;)z.shift()(e);z=void 0}}(this);var e=pxt.appTarget.appTheme,t=pxt.appTarget.simulator,n=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&!pxt.shell.isControllerMode(),r=pxt.shell.isSandboxMode(),i=!this.editor.isVisible||this.getPreferredEditor()===pxt.BLOCKS_PROJECT_NAME,o=!(r||e.hideSideDocs),a=this.state.tutorialOptions,s=!!a&&!!a.tutorial,l=s&&a.tutorialStepExpanded,c=s&&a.metadata&&a.metadata.hideIteration,u=this.state.debugging,p=this.state.home&&!r,d=!!this.state.header&&!p,f=this.state,h=f.lightbox,m=f.greenScreen,g=this.state.editorState&&!1===this.state.editorState.hasCategories,v=e.hideEditorToolbar,y=e.transparentEditorToolbar,b=e.hideMenuBar||c,_=t&&t.headless,w=e.selectLanguage,k=d&&!v&&this.editor.hasEditorToolbar(),x=pxt.appTarget.serial&&!!pxt.appTarget.serial.useEditor,E=o&&this.state.sideDocsLoadUrl&&!this.state.sideDocsCollapsed,C=k&&!p&&!s&&!r&&!e.simCollapseInMenu&&(!_||u),S=(this.state.hideEditorFloats||this.state.collapseEditorTools)&&(!s||_),T=this.state.collapseEditorTools&&(!s||_),A=!!e.logoWide,N=!r&&pxt.hasHwVariants(),O=!!e.recipes,P=l?this.getExpandedCardStyle(g):null,I=e.invertedMenu&&e.invertedMonaco,D=this.state.collapseEditorTools?lf("Show the simulator"):lf("Hide the simulator"),L=K.isNativeHost()||pxt.winrt.isWinRT()||pxt.BrowserUtils.isElectron(),R=["ui",h?"dimmable dimmed":"dimmable",S?"hideEditorFloats":"",T?"collapsedEditorTools":"",y?"transparentEditorTools":"",I?"inverted-theme":"",this.state.fullscreen?"fullscreensim":"",this.state.highContrast?"hc":"",E?"sideDocs":"",pxt.shell.layoutTypeClass(),p?"inHome":"",s?"tutorial":"",l?"tutorialExpanded":"",u?"debugger":"",pxt.options.light?"light":"",pxt.BrowserUtils.isTouchEnabled()?"has-touch":"",b?"hideMenuBar":"",!k||y?"hideEditorToolbar":"",this.state.bannerVisible?"notificationBannerVisible":"",this.state.debugging?"debugging":"",r&&this.isEmbedSimActive()?"simView":"",L?"app":"",m?"greenscreen":"",A?"logo-wide":"",_?"headless":"",g?"flyoutOnly":"",c?"hideIteration":"","full-abs"],j=G.cx(R);if(this.state.hasError)return V.createElement("div",{id:"root",className:"ui middle aligned center aligned grid",style:{height:"100%",alignItems:"center"}},V.createElement("div",{className:"ui raised segment inverted purple"},V.createElement("h2",null,lf("Oops")),lf("We detected a problem and we will reload the editor in a few seconds..")));var B=pxt.Util.isUserLanguageRtl(),M=(this.state.collapseEditorTools||B)&&!(this.state.collapseEditorTools&&B),F=!r&&!(i||W.mainPkg&&W.mainPkg.config&&W.mainPkg.config.preferredEditor==pxt.BLOCKS_PROJECT_NAME),U=this.hasCloud();return V.createElement("div",{id:"root",className:j},m?V.createElement(se.WebCam,{close:this.toggleGreenScreen}):void 0,b||p?void 0:V.createElement("header",{className:"menubar",role:"banner"},d?V.createElement(J.EditorAccessibilityMenu,{parent:this,highContrast:this.state.highContrast}):void 0,V.createElement(ce.NotificationBanner,{parent:this}),V.createElement(te.MainMenu,{parent:this})),s&&V.createElement("div",{id:"maineditor",className:r?"sandbox":"",role:"main"},V.createElement($.TutorialCard,{ref:q.tutorialCardId,parent:this,pokeUser:this.state.pokeUserComponent==q.tutorialCardId}),g&&V.createElement($.WorkspaceHeader,null)),V.createElement("div",{id:"simulator",className:"simulator"},V.createElement("div",{id:"filelist",className:"ui items"},V.createElement("div",{id:"boardview",className:"ui vertical editorFloat",role:"region","aria-label":lf("Simulator"),tabIndex:p?-1:0}),V.createElement(Z.SimulatorToolbar,{parent:this}),V.createElement("div",{className:"ui item portrait hide hidefullscreen"},pxt.options.debug?V.createElement(G.Button,{key:"hwdebugbtn",className:"teal",icon:"xicon chip",text:"Dev Debug",onClick:this.hwDebug}):""),x?V.createElement("div",{id:"serialPreview",className:"ui editorFloat portrait hide hidefullscreen"},V.createElement(le.SerialIndicator,{ref:"simIndicator",isSim:!0,onClick:this.openSimSerial}),V.createElement(le.SerialIndicator,{ref:"devIndicator",isSim:!1,onClick:this.openDeviceSerial})):void 0,F?V.createElement(ee.FileList,{parent:this}):void 0,!_&&V.createElement("div",{id:"filelistOverlay",role:"button",title:lf("Open in fullscreen"),onClick:this.toggleSimulatorFullscreen}))),V.createElement("div",{id:"maineditor",className:(r?"sandbox":"")+(u?"debugging":""),role:"main","aria-hidden":p},C&&V.createElement(G.Button,{id:"computertogglesim",className:"computer only collapse-button large",icon:"inverted chevron "+(M?"right":"left"),title:D,onClick:this.toggleSimulatorCollapse}),C&&V.createElement(G.Button,{id:"mobiletogglesim",className:"mobile tablet only collapse-button large",icon:"inverted chevron "+(this.state.collapseEditorTools?"up":"down"),title:D,onClick:this.toggleSimulatorCollapse}),this.allEditors.map(function(e){return e.displayOuter(P)})),p?V.createElement("div",{id:"homescreen",className:"full-abs"},V.createElement("div",{className:"ui home projectsdialog"},V.createElement("header",{className:"menubar",role:"banner"},V.createElement(J.HomeAccessibilityMenu,{parent:this,highContrast:this.state.highContrast}),V.createElement(re.ProjectsMenu,{parent:this})),V.createElement(re.Projects,{parent:this,ref:this.handleHomeRef}))):void 0,k?V.createElement("div",{id:"editortools",role:"complementary","aria-label":lf("Editor toolbar")},V.createElement(Q.EditorToolbar,{ref:"editortools",parent:this})):void 0,o?V.createElement(te.SideDocs,{ref:"sidedoc",parent:this,sideDocsCollapsed:this.state.sideDocsCollapsed,docsUrl:this.state.sideDocsLoadUrl}):void 0,r?void 0:V.createElement(ne.ScriptSearch,{parent:this,ref:this.handleScriptSearchRef}),r?void 0:V.createElement(ae.Extensions,{parent:this,ref:this.handleExtensionRef}),p?V.createElement(re.ImportDialog,{parent:this,ref:this.handleImportDialogRef}):void 0,U?V.createElement(oe.SignInDialog,{parent:this,ref:this.handleSignInDialogRef,onComplete:this.cloudSignInComplete}):void 0,p&&e.scriptManager?V.createElement(ie.ScriptManagerDialog,{parent:this,ref:this.handleScriptManagerDialogRef,onClose:this.handleScriptManagerDialogClose}):void 0,r?void 0:V.createElement(re.ExitAndSaveDialog,{parent:this,ref:this.handleExitAndSaveDialogRef}),r?void 0:V.createElement(re.NewProjectNameDialog,{parent:this,ref:this.handleNewProjectNameDialogRef}),N?V.createElement(re.ChooseHwDialog,{parent:this,ref:this.handleChooseHwDialogRef}):void 0,O?V.createElement($.ChooseRecipeDialog,{parent:this,ref:this.handleChooseRecipeDialogRef}):void 0,r||!n?void 0:V.createElement(X.ShareEditor,{parent:this,ref:this.handleShareEditorRef,loading:this.state.publishing}),w?V.createElement(Y.LanguagePicker,{parent:this,ref:this.handleLanguagePickerRef}):void 0,r?V.createElement(te.SandboxFooter,{parent:this}):void 0,b?V.createElement("div",{id:"editorlogo"},V.createElement("a",{className:"poweredbylogo"})):void 0,h?V.createElement(G.Dimmer,{isOpen:!0,active:h,portalClassName:"tutorial",className:"ui modal",shouldFocusAfterRender:!1,closable:!0,onClose:this.hideLightbox}):void 0)},q.tutorialCardId="tutorialcard",q}(a.Component);function M(){return H}function F(){var e;u.loginCheck(),(e=m.parseQueryString((location.hash||"#").slice(1).replace(/%local_token/,"local_token"))).local_token&&(pxt.storage.setLocal("local_token",e.local_token),location.hash=location.hash.replace(/(%23)?[\#\&\?]*local_token.*/,"")),D.localToken=pxt.storage.getLocal("local_token")||""}t.ProjectView=B;var U={workspace:h,require:s,core:m,getEditor:M,monaco:C,blocks:A,compiler:p,pkg:W,getsrc:function(){pxt.log(H.editor.getCurrentSource())},sim:d,apiAsync:m.apiAsync,assembleCurrent:function(){p.compileAsync({native:!0}).then(function(){return p.assembleAsync(M().editorFile.content)}).then(function(e){var t=e.words;pxt.debug("["+t.map(function(e){return"0x"+e.toString(16)}).join(",")+"]")})},log:function(e){console.log(e)},cloudsync:u};function ue(){var e=/^#(\w+)(:([:\.\/\-\+\=\w]+))?/.exec(window.location.hash);return e?{cmd:e[1],arg:e[3]||""}:{cmd:"",arg:""}}function q(e,t){if(!e)return!1;var n=H;if(!n)return!1;switch(pe(e)&&n.setState({home:!1}),e.cmd){case"doc":pxt.tickEvent("hash.doc"),n.setSideDoc(e.arg,n.editor===n.blocksEditor);break;case"follow":return pxt.tickEvent("hash.follow"),n.newEmptyProject(void 0,e.arg),!0;case"newproject":return pxt.tickEvent("hash.newproject"),n.newEmptyProject(),pxt.BrowserUtils.changeHash(""),!0;case"newjavascript":return pxt.tickEvent("hash.newjavascript"),n.newProject({prj:pxt.appTarget.blocksprj,filesOverride:{"main.blocks":""}}),pxt.BrowserUtils.changeHash(""),!0;case"testproject":pxt.tickEvent("hash.testproject");var r=e.arg,i=h.getHeader(r);if(i){var o=h.getHeaders().filter(function(e){return e.extensionUnderTest==i.id})[0];o?n.loadHeaderAsync(o):n.newProject({prj:pxt.appTarget.blocksprj,name:lf("test {0}",i.name),extensionUnderTest:r})}return pxt.BrowserUtils.changeHash(""),!0;case"gettingstarted":return pxt.tickEvent("hash.gettingstarted"),n.newProject(),pxt.BrowserUtils.changeHash(""),!0;case"tutorial":return pxt.tickEvent("hash.tutorial"),n.startTutorial(e.arg),pxt.BrowserUtils.changeHash("editor"),!0;case"recipe":return pxt.tickEvent("hash.recipe"),n.startTutorial(e.arg,void 0,!0),pxt.BrowserUtils.changeHash("editor"),!0;case"home":return pxt.tickEvent("hash.home"),n.openHome(),pxt.BrowserUtils.changeHash(""),!0;case"sandbox":case"pub":case"edit":return pxt.tickEvent("hash."+e.cmd),pxt.BrowserUtils.changeHash(""),/^(github:|https:\/\/github\.com\/)/.test(e.arg)?de(e.arg):fe(e.arg).done(),!0;case"sandboxproject":case"project":pxt.tickEvent("hash."+e.cmd);var a=L.stringToUint8Array(atob(e.arg));return pxt.BrowserUtils.changeHash(""),m.showLoading("loadingproject",lf("loading project...")),n.importProjectFromFileAsync(a).finally(function(){return m.hideLoading("loadingproject")}),!0;case"reload":return t&&pxt.BrowserUtils.changeHash(""),!1;case"github":var s=e.arg.split(":",2),l=(r=s[0],s[1]),c=h.getHeader(r);if(c)switch(l){case"create-repository":return pxt.BrowserUtils.changeHash(""),H.loadHeaderAsync(c).then(function(){return u.githubProvider().createRepositoryAsync(c.name,c)}).done(function(e){return e&&H.reloadHeaderAsync()}),!0}}return!1}function pe(e){if(!e)return!1;switch(e.cmd){case"follow":case"newproject":case"newjavascript":case"testproject":case"tutorial":case"recipe":case"projects":case"sandbox":case"pub":case"edit":case"sandboxproject":case"project":case"github":return!0;default:return!1}}function de(r){return i(this,void 0,void 0,function(){var t,n;return o(this,function(e){switch(e.label){case 0:m.showLoading("loadingheader",lf("importing GitHub project...")),e.label=1;case 1:return e.trys.push([1,6,7,8]),(t=h.getHeaders().find(function(e){return e.githubId==r}))?[3,3]:[4,h.importGithubAsync(r)];case 2:t=e.sent(),e.label=3;case 3:return t?[4,H.loadHeaderAsync(t,null)]:[3,5];case 4:e.sent(),e.label=5;case 5:return[3,8];case 6:return n=e.sent(),m.handleNetworkError(n),[3,8];case 7:return m.hideLoading("loadingheader"),[7];case 8:return[2]}})})}function fe(t){m.showLoading("loadingheader",lf("loading project..."));var e=h.getHeaders().find(function(e){return e.pubId==t}),n=e?Promise.resolve(e):h.installByIdAsync(t);return n.then(function(e){return H.loadHeaderAsync(e,null)}).catch(m.handleNetworkError).finally(function(){return m.hideLoading("loadingheader")}),n}window.E=U;var he=function(e){q(ue(),!1)};function me(){try{return/saveblocks=1/.test(window.location.href)&&!!W.mainPkg.readFile("main.blocks")}catch(e){return!1}}function ge(e,t,n,r,i){var o=pxt.tutorial.parseTutorial(e);if(!o)throw new Error(lf("Invalid tutorial format"));return{options:{tutorial:t,tutorialName:o.title||n,tutorialReportId:r,tutorialStep:0,tutorialReady:!0,tutorialHintCounter:0,tutorialStepInfo:o.steps,tutorialActivityInfo:o.activities,tutorialMd:e,tutorialCode:o.code,tutorialRecipe:!!i,templateCode:o.templateCode,autoexpandStep:!0,metadata:o.metadata},editor:o.editor}}pxt.winrt.captureInitialActivation(),document.addEventListener("DOMContentLoaded",function(){pxt.perf.recordMilestone("DOM loaded"),pxt.setupWebConfig(window.pxtConfig);var u=pxt.webConfig;pxt.options.debug=/dbg=1/i.test(window.location.href),pxt.options.light=/light=1/i.test(window.location.href)||pxt.BrowserUtils.isARM()||pxt.BrowserUtils.isIE(),pxt.options.light&&pxsim.U.addClass(document.body,"light");var e=/wsport=(\d+)/i.exec(window.location.href);if(e?(pxt.options.wsPort=parseInt(e[1])||3233,pxt.BrowserUtils.changeHash(window.location.hash.replace(e[0],""))):pxt.options.wsPort=3233,W.setupAppTarget(window.pxtTargetBundle),pxt.setBundledApiInfo(window.pxtTargetBundle.apiInfo),function(){pxt.analytics.enable(),pxt.editor.enableControllerAnalytics();var e={};if("undefined"!=typeof window){var t=window.screen;e["screen.width"]=t.width,e["screen.height"]=t.height,e["screen.availwidth"]=t.availWidth,e["screen.availheight"]=t.availHeight,e["screen.innerWidth"]=window.innerWidth,e["screen.innerHeight"]=window.innerHeight,e["screen.devicepixelratio"]=pxt.BrowserUtils.devicePixelRatio()}pxt.tickEvent("editor.loaded",e)}(),!pxt.BrowserUtils.isBrowserSupported()&&!/skipbrowsercheck=1/i.exec(window.location.href))return pxt.tickEvent("unsupported"),window.location.href="/browsers",void m.showLoading("browsernotsupported",lf("Sorry, this browser is not supported."));F(),l=ue(),f.init(function(){return H.reloadEditor()}),I.init(),pxt.hex.showLoading=function(e){return m.showLoading("hexcloudcompiler",e)},pxt.hex.hideLoading=function(){return m.hideLoading("hexcloudcompiler")},pxt.docs.requireMarked=function(){return s("marked")};var t=function(e,t){return H.importHex(e,t)},n=/^(https:\/\/[^/]+)/.exec(window.location.href);n&&(D.apiRoot=n[1]+"/api/");var r=m.parseQueryString(window.location.href);r.hw&&(pxt.setHwVariant(r.hw),pxt.tickEvent("projects.choosehwvariant",{hwid:pxt.hwVariant,card:"QUERY-"+pxt.hwVariant})),pxt.setCompileSwitches(r.compiler||r.compile);var i=pxt.shell.isSandboxMode()||pxt.shell.isReadOnly(),o=pxt.shell.isControllerMode(),p=pxt.appTarget.appTheme;r.ws?h.setupWorkspace(r.ws):(p.allowParentController||o)&&pxt.BrowserUtils.isIFrame()?h.setupWorkspace("iframe"):i?h.setupWorkspace("mem"):pxt.winrt.isWinRT()?h.setupWorkspace("uwp"):pxt.BrowserUtils.isIpcRenderer()?h.setupWorkspace("idb"):(pxt.BrowserUtils.isLocalHost()||pxt.BrowserUtils.isPxtElectron())&&h.setupWorkspace("fs"),Promise.resolve().then(function(){var e=window.location.href,t=!1,n=!1,r=void 0;if(/[&?]translate=1/.test(e)&&!pxt.BrowserUtils.isIE())console.log("translation mode"),t=n=!0,r=ts.pxtc.Util.TRANSLATION_LOCALE;else{var i=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(window.location.href);i&&0<=window.location.hash.indexOf(i[0])&&pxt.BrowserUtils.changeHash(window.location.hash.replace(i[0],"")),r=i?i[3]:pxt.BrowserUtils.getCookieLang()||p.defaultLocale||navigator.userLanguage||navigator.language;var o=/staticlang=1/i.test(window.location.href);t=!(o||pxt.BrowserUtils.isPxtElectron()||p.disableLiveTranslations)||i&&!!i[1],n=!!i&&!!i[2]}var a=pxt.appTarget.id,s=u.commitCdnUrl,l=pxt.appTarget.versions.pxtCrowdinBranch,c=pxt.appTarget.versions.targetCrowdinBranch;return L.updateLocalizationAsync(a,s,r,l,c,t,n).then(function(){pxt.Util.isLocaleEnabled(r)?(pxt.BrowserUtils.setCookieLang(r),Y.setInitialLang(r)):pxt.tickEvent("unavailablelocale",{lang:r,force:n?"true":"false"}),pxt.tickEvent("locale",{lang:pxt.Util.userLanguage(),live:t?"true":"false"}),ts.pxtc.Util.downloadTranslationsAsync(a,s,r,l,c,t,ts.pxtc.Util.TranslationsKind.Sim).done(function(e){return e&&d.setTranslations(e)})})}).then(function(){return pxt.BrowserUtils.initTheme(),pxt.editor.experiments.syncTheme(),K.init(),(p.allowParentController||p.allowPackageExtensions||p.allowSimulatorTelemetry||pxt.shell.isControllerMode())&&pxt.editor.bindEditorMessages(j),h.initAsync()}).then(function(e){return c.render(V.createElement(B,null),G.appElement),e&&H.setState({editorState:e}),function(){var e=pxt.appTarget.serial&&pxt.appTarget.serial.useHF2&&pxt.winrt.isWinRT(),t=pxt.appTarget.serial&&pxt.BrowserUtils.isLocalHost()&&!!D.localToken;if(e||t||pxt.usb.isEnabled)if(v.shouldUse()||pxt.usb.isEnabled)v.configureHidSerial(function(e,t){var n=L.fromUTF8(L.uint8ArrayToString(e));window.postMessage({type:"serial",id:"n/a",data:n},"*")});else{pxt.debug("initializing serial pipe");var n=new WebSocket("ws://localhost:"+pxt.options.wsPort+"/"+D.localToken+"/serial"),r={};n.onopen=function(e){pxt.debug("serial: socket opened")},n.onclose=function(e){pxt.debug("serial: socket closed")},n.onerror=function(e){pxt.debug("serial: error")},n.onmessage=function(e){try{var t=JSON.parse(e.data);t&&"serial"==t.type&&pxt.Util.bufferSerial(r,t.data,t.id)}catch(t){pxt.debug("unknown message: "+e.data)}}}}(),window.addEventListener("hashchange",he),x.tryInit(),function(){if(!pxt.appTarget.appTheme||!pxt.appTarget.appTheme.extendEditor)return Promise.resolve();pxt.debug("loading editor extensions...");var e={blocklyToolbox:w.getToolboxDefinition(),monacoToolbox:k.getToolboxDefinition(),projectView:H};return pxt.BrowserUtils.loadScriptAsync("editor.js").then(function(){return pxt.editor.initExtensionsAsync(e)}).then(function(e){e.hexFileImporters&&e.hexFileImporters.forEach(function(e){pxt.debug("\tadded hex importer "+e.id),H.hexFileImporters.push(e)}),e.resourceImporters&&e.resourceImporters.forEach(function(e){pxt.debug("\tadded resource importer "+e.id),H.resourceImporters.push(e)}),e.deployAsync&&(pxt.debug("\tadded custom deploy core async"),pxt.commands.deployCoreAsync=e.deployAsync),e.saveOnlyAsync&&(pxt.debug("\tadded custom save only async"),pxt.commands.saveOnlyAsync=e.saveOnlyAsync),e.saveProjectAsync&&(pxt.debug("\tadded custom save project async"),pxt.commands.saveProjectAsync=e.saveProjectAsync),e.showUploadInstructionsAsync&&(pxt.debug("\tadded custom upload instructions async"),pxt.commands.showUploadInstructionsAsync=e.showUploadInstructionsAsync),e.patchCompileResultAsync&&(pxt.debug("\tadded build patch"),pxt.commands.patchCompileResultAsync=e.patchCompileResultAsync),e.beforeCompile&&(H.beforeCompile=e.beforeCompile),e.toolboxOptions&&(e.toolboxOptions.blocklyToolbox&&w.overrideToolbox(e.toolboxOptions.blocklyToolbox),e.toolboxOptions.monacoToolbox&&k.overrideToolbox(e.toolboxOptions.monacoToolbox)),e.blocklyPatch&&(pxt.blocks.extensionBlocklyPatch=e.blocklyPatch),e.webUsbPairDialogAsync&&(pxt.commands.webUsbPairDialogAsync=e.webUsbPairDialogAsync),e.onTutorialCompleted&&(pxt.commands.onTutorialCompleted=e.onTutorialCompleted)})}()}).then(function(){return P.initElectron(H),pxt.winrt.initAsync(t)}).then(function(){return pxt.winrt.hasActivationProjectAsync()}).then(function(e){if(H.shouldShowHomeScreen()&&!e)return Promise.resolve();if(H.setState({home:!1}),l.cmd&&q(l,!0))return Promise.resolve();if(e)return pxt.winrt.loadActivationProject();var t=H.settings.fileHistory.filter(function(e){return!!h.getHeader(e.id)})[0],n=h.getHeaders()[0];return t&&(n=h.getHeader(t.id)),n?H.loadHeaderAsync(n,H.state.editorState):(H.newProject(),Promise.resolve())}).then(function(){return pxsim.U.remove(document.getElementById("loading")),h.loadedAsync()}).done(),document.addEventListener("visibilitychange",function(e){H&&H.updateVisibility()}),window.addEventListener("unload",function(e){H&&H.saveSettings()}),window.addEventListener("resize",function(e){H&&H.editor&&(H.editor.resize(e),pxt.BrowserUtils.isIOS()&&setTimeout(function(){H.editor.resize(e)},1e3))},!1);var a=window.ipcRenderer;a&&a.on("responseFromApp",function(e,t){try{d.driver.postMessage(JSON.parse(t))}catch(e){}}),window.addEventListener("message",function(e){var t=e.data;if(t)if("parent"!=e.data.__proxy)if("tutorial"!=t.type&&"opendoc"!=t.type)if("sidedocready"===t.type&&pxt.BrowserUtils.isLocalHost()&&D.localToken)te.SideDocs.notify({type:"localtoken",localToken:D.localToken});else if("importfile"!=t.type);else{var n=t;H&&H.importFile(new File(n.parts,n.filename))}else H&&H.editor&&H.handleMessage(t);else{pxt.debug("received parent proxy message"+e.data),delete e.data.__proxy;var r=window.ipcRenderer;r?r.sendToHost("sendToApp",e.data):window.parent&&window!=window.parent&&window.parent.postMessage(e.data,"*")}},!1)})},{"./accessibility":1,"./appcache":3,"./blocklyFieldView":5,"./blocks":6,"./blocksSnippets":7,"./cloud":10,"./cloudsync":11,"./cmds":12,"./compiler":14,"./container":40,"./core":41,"./data":44,"./dialogs":51,"./draganddrop":53,"./editortoolbar":54,"./electron":55,"./extensions":57,"./filelist":58,"./gitjson":62,"./greenscreen":64,"./hidbridge":65,"./hinttooltip":66,"./lang":69,"./make":70,"./monaco":73,"./monacoSnippets":77,"./notification":79,"./package":81,"./projects":82,"./pxtjson":83,"./screenshot":85,"./scriptmanager":86,"./scriptsearch":87,"./serial":88,"./serialindicator":89,"./share":90,"./simtoolbar":91,"./simulator":92,"./socketbridge":97,"./sounds":98,"./sui":100,"./tutorial":103,"./webusb":104,"./workspace":105,marked:207,react:284,"react-dom":240}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./core");n.init=function(e){var t=window.applicationCache;function n(){console.log("app cache update ready ("+t.status+")"),t.status===window.applicationCache.UPDATEREADY&&(r.infoNotification(lf("Update download complete. Reloading... ")),setTimeout(function(){pxt.tickEvent("appcache.updated"),e()},3e3))}t&&(pxt.appTarget.appTheme&&pxt.appTarget.appTheme.noReloadOnUpdate||(t.status===window.applicationCache.UPDATEREADY?n():t.addEventListener("updateready",function(){n()},!1)))}},{"./core":41}],4:[function(e,t,n){"use strict";var r;function o(){return r||(r=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}}()),r}Object.defineProperty(n,"__esModule",{value:!0}),n.play=function(e,t){if(void 0===t&&(t=1),e){var n=o();if(n){var r=n.createBufferSource();r.buffer=e;var i=n.createGain();i.gain.value=t,r.connect(i),i.connect(n.destination),r.start(0)}}},n.loadAsync=function(n){var r=o();return new Promise(function(t,e){r.decodeAudioData(n,function(e){return t(e)},function(){t(void 0)})})}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i,o,a=e("react"),r=e("react-dom"),s=e("./components/ImageFieldEditor"),l=e("./components/TilemapFieldEditor"),c=function(){function e(e){var i=this;this.contentDiv=e,this.resizeContentCore=function(){i.resizeFrameRef=void 0;var e=i.editorBounds,t=20,n=20;e.width-2*t<500&&(n=t=0),e.height-2*n<610&&(n=Math.min(e.height-610,0)/2,t=0),i.contentBounds={left:e.left+t,top:e.top+n,width:e.width-2*t,height:e.height-2*n},i.contentDiv.style.left=i.contentBounds.left+"px",i.contentDiv.style.top=i.contentBounds.top+"px",i.contentDiv.style.width=i.contentBounds.width+"px",i.contentDiv.style.height=i.contentBounds.height+"px",i.overlayDiv.style.left=e.left+"px",i.overlayDiv.style.top=e.top+"px",i.overlayDiv.style.width=e.width+"px",i.overlayDiv.style.height=e.height+"px",i.componentRef&&i.visible&&i.componentRef.onResize&&i.componentRef.onResize()},this.handleOutsideClick=function(e){var t,n,r;i.contentBounds&&(t=e.clientX,n=e.clientY,r=i.contentBounds,!(t<r.left||t>r.left+r.width||n<r.top||n>r.top+r.height)||i.hide())}}return e.prototype.injectElement=function(e){r.render(e,this.contentDiv)},e.prototype.setRef=function(e){(this.componentRef=e)&&this.persistentData&&(e.restorePersistentData(this.persistentData),this.persistentData=void 0)},e.prototype.show=function(){!this.visible&&this.contentDiv&&(this.visible=!0,this.resize(this.editorBounds),this.contentDiv.style.display="",this.overlayDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.overlayDiv,"blocks-editor-field-overlay"),this.contentDiv.parentElement.appendChild(this.overlayDiv),this.overlayDiv.addEventListener("mousedown",this.handleOutsideClick),document.addEventListener("mousedown",this.handleOutsideClick))},e.prototype.hide=function(){this.visible&&this.contentDiv&&(this.visible=!1,this.resizeFrameRef&&cancelAnimationFrame(this.resizeFrameRef),this.clearContents(),this.contentDiv.style.display="none",this.overlayDiv.parentElement.removeChild(this.overlayDiv),document.removeEventListener("mousedown",this.handleOutsideClick),this.hideCallback&&this.hideCallback())},e.prototype.onHide=function(e){this.hideCallback=e},e.prototype.getResult=function(){return this.componentRef?this.componentRef.getValue():void 0},e.prototype.resize=function(e){this.editorBounds=e,this.visible&&(this.resizeFrameRef&&cancelAnimationFrame(this.resizeFrameRef),this.resizeFrameRef=requestAnimationFrame(this.resizeContentCore))},e.prototype.dispose=function(){this.contentDiv&&(this.hide(),this.contentDiv=null)},e.prototype.getPersistentData=function(){return this.componentRef.getPersistentData()},e.prototype.restorePersistentData=function(e){this.componentRef?this.componentRef.restorePersistentData(e):this.persistentData=e},e.prototype.clearContents=function(){for(r.unmountComponentAtNode(this.contentDiv);this.contentDiv.firstChild;)this.contentDiv.removeChild(this.contentDiv.firstChild)},e}();function u(){o&&o.dispose(),o=void 0}n.FieldEditorView=c,n.setEditorBounds=function(e){o&&o.resize(e),i=e},n.init=function(){pxt.react.getFieldEditorView=function(e,t,n){o&&o.dispose();var r=function(e){e&&o&&(o.setRef(e),e.init(t,u,n))};switch(o=new c(document.getElementById("blocks-editor-field-div")),e){case"image-editor":o.injectElement(a.createElement(s.ImageFieldEditor,{ref:r,singleFrame:!0}));break;case"animation-editor":o.injectElement(a.createElement(s.ImageFieldEditor,{ref:r,singleFrame:!1}));break;case"tilemap-editor":o.injectElement(a.createElement(l.TilemapFieldEditor,{ref:r}))}return i&&o.resize(i),o}},n.dismissIfVisible=u},{"./components/ImageFieldEditor":37,"./components/TilemapFieldEditor":38,react:284,"react-dom":240}],6:[function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("react"),s=e("react-dom"),l=e("./package"),c=e("./core"),i=e("./toolboxeditor"),u=e("./compiler"),p=e("./toolbox"),E=e("./blocksSnippets"),d=e("./workspace"),f=e("./simulator"),h=e("./dialogs"),m=e("./blocklyFieldView"),g=e("./createFunction"),v=e("./snippetBuilder"),C=pxt.Util,y=e("./debuggerToolbox"),b=function(i){function e(){var t=null!==i&&i.apply(this,arguments)||this;return t.isFirstBlocklyLoad=!0,t.functionsDialog=null,t.showCategories=!0,t.markIncomplete=!1,t.handleToolboxRef=function(e){t.toolbox=e},t.handleDebuggerToolboxRef=function(e){t.debuggerToolbox=e},t.flyoutBlockXmlCache={},t.flyoutXmlList=[],t.flyouts={},t}return o(e,i),e.prototype.setBreakpointsMap=function(e){var n=this,r={};e&&this.compilationResult&&(e.forEach(function(e){var t=pxt.blocks.findBlockId(n.compilationResult.sourceMap,{start:e.line,length:e.endLine-e.line});t&&(r[t]=e.id)}),this.breakpointsByBlock=r)},e.prototype.setBreakpointsFromBlocks=function(){this.breakpointsSet=this.getBreakpoints(),f.driver.setBreakpoints(this.breakpointsSet)},e.prototype.getBreakpoints=function(){var t=this,n=[],r=this.breakpointsByBlock;return r&&this.editor&&this.editor.getAllBlocks().forEach(function(e){r[e.id]&&e.isBreakpointSet()&&n.push(t.breakpointsByBlock[e.id])}),n},e.prototype.addBreakpointFromEvent=function(e){this.breakpointsSet.push(this.breakpointsByBlock[e]),f.driver.setBreakpoints(this.breakpointsSet)},e.prototype.removeBreakpointFromEvent=function(e){var t=this.breakpointsByBlock[e];this.breakpointsSet.filter(function(e){return e!=t}),f.driver.setBreakpoints(this.breakpointsSet)},e.prototype.clearBreakpoints=function(){f.driver.setBreakpoints([])},e.prototype.setVisible=function(e){i.prototype.setVisible.call(this,e),this.isVisible=e;var t="#blocksEditor .blocklyToolboxDiv, #blocksEditor .blocklyWidgetDiv, #blocksEditor .blocklyToolboxDiv";this.isVisible?(pxt.Util.toArray(document.querySelectorAll(t)).forEach(function(e){return e.style.display=""}),this.parent.fireResize()):(pxt.Util.toArray(document.querySelectorAll(t)).forEach(function(e){return e.style.display="none"}),this.editor&&Blockly.hideChaff())},e.prototype.saveToTypeScriptAsync=function(){var t=this;if(!this.typeScriptSaveable)return Promise.resolve(void 0);this.clearHighlightedStatements();try{return pxt.blocks.compileAsync(this.editor,this.blockInfo).then(function(e){return t.compilationResult=e,pxt.tickActivity("blocks.compile"),t.compilationResult.source})}catch(t){return pxt.reportException(t),c.errorNotification(lf("Sorry, we were not able to convert this program.")),Promise.resolve(void 0)}},e.prototype.updateBlocksInfo=function(e){this.blockInfo=e,this.refreshToolbox()},e.prototype.domUpdate=function(){var n=this;if(this.delayLoadXml){if(this.loadingXml)return;pxt.debug("loading blockly"),pxt.perf.measureStart("domUpdate loadBlockly"),this.loadingXml=!0;var e=document.createElement("div");e.className="ui active dimmer";var t=document.createElement("div");t.className="ui text loader",t.appendChild(document.createTextNode(lf("Loading blocks..."))),e.appendChild(t);var r=document.getElementById("blocksEditor");r.appendChild(e),u.clearCaches(),this.loadingXmlPromise=this.loadBlocklyAsync().then(function(){return u.getBlocksAsync()}).then(function(e){n.blockInfo=e,pxt.blocks.initialize(n.blockInfo),n.nsMap=n.partitionBlocks(),n.refreshToolbox(),pxt.debug("loading block workspace");var t=n.delayLoadXml;n.delayLoadXml=void 0,n.loadBlockly(t),n.resize(),Blockly.svgResize(n.editor),n.isFirstBlocklyLoad=!1}).finally(function(){n.loadingXml=!1;try{r.removeChild(e)}catch(e){}pxt.perf.measureEnd("domUpdate loadBlockly")}),this.loadingXmlPromise.done(),this.loadingXmlPromise=null}},e.prototype.isDropdownDivVisible=function(){return"undefined"!=typeof Blockly&&Blockly.DropDownDiv&&Blockly.DropDownDiv.isVisible()},e.prototype.beforeCompile=function(){"undefined"!=typeof Blockly&&(Blockly.DropDownDiv.hide(),Blockly.WidgetDiv.hide())},e.prototype.saveBlockly=function(){return this.delayLoadXml?this.delayLoadXml:this.serializeBlocks()},e.prototype.serializeBlocks=function(e){var t=pxt.blocks.saveWorkspaceXml(this.editor,!e&&this.parent.state&&this.parent.state.header&&!!this.parent.state.header.githubId);return e&&(t=t.replace(/(x|y|id)="[^"]*"/g,"")),pxt.debug(t),t},e.prototype.loadBlockly=function(e){if(this.serializeBlocks()==e)return this.typeScriptSaveable=!0,pxt.debug("blocks already loaded..."),!1;this.typeScriptSaveable=!1,pxt.blocks.clearWithoutEvents(this.editor);try{var t=e||'<block type="'+ts.pxtc.ON_START_TYPE+'"></block>',n=Blockly.Xml.textToDom(t);pxt.blocks.domToWorkspaceNoEvents(n,this.editor),this.initLayout(),this.editor.clearUndo(),this.reportDeprecatedBlocks(),this.typeScriptSaveable=!0}catch(e){return pxt.log(e),pxt.blocks.clearWithoutEvents(this.editor),this.switchToTypeScript(),this.changeCallback(),!1}return this.changeCallback(),!0},e.prototype.initLayout=function(){var r,i,o=!1,e=!this.editor.toolbox_&&this.editor.flyout_;this.editor.getTopComments(!1).forEach(function(e){var t=e.getBoundingRectangle().left,n=e.getBoundingRectangle().top;(void 0===r||t<r)&&(r=t),(void 0===i||n<i)&&(i=n),o=o||10==t&&10==n}),this.editor.getTopBlocks(!1).forEach(function(e){var t=e.getBoundingRectangle().left,n=e.getBoundingRectangle().top;(void 0===r||t<r)&&(r=t),(void 0===i||n<i)&&(i=n),o=o||e.type!=ts.pxtc.ON_START_TYPE&&10==t&&10==n}),o&&!e?pxt.blocks.layout.flow(this.editor,{useViewWidth:!0}):(this.editor.getTopComments(!1).forEach(function(e){return e.moveBy(-r,-i)}),this.editor.getTopBlocks(!1).forEach(function(e){return e.moveBy(-r,-i)}),this.editor.scrollX=10,this.editor.scrollY=10,this.editor.resizeContents())},e.prototype.initPrompts=function(){Blockly.alert=function(e,t){return c.confirmAsync({hideCancel:!0,header:lf("Alert"),agreeLbl:lf("Ok"),agreeClass:"positive",agreeIcon:"checkmark",body:e,size:"tiny"}).then(function(){t&&t()})},Blockly.confirm=function(e,t){return c.confirmAsync({header:lf("Confirm"),body:e,agreeLbl:lf("Yes"),agreeClass:"positive",agreeIcon:"checkmark",disagreeLbl:lf("No"),disagreeClass:"cancel",disagreeIcon:"cancel",size:"tiny"}).then(function(e){t(1==e)})},Blockly.prompt=function(e,t,n){return c.promptAsync({header:e,initialValue:t,agreeLbl:lf("Ok"),disagreeLbl:lf("Cancel"),size:"tiny"}).then(function(e){n(e)})},pxt.Util.isTranslationMode()&&(pxt.blocks.promptTranslateBlock=h.promptTranslateBlock)},e.prototype.initBlocklyToolbox=function(){var e=this,t=Blockly.Toolbox.prototype.position;Blockly.Toolbox.prototype.position=function(){t.call(this),e.resizeToolbox()};var n=this;Blockly.WorkspaceSvg.prototype.refreshToolboxSelection=function(){var e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.flyout_&&n.toolbox.refreshSelection()};var r=Blockly.hideChaff;Blockly.hideChaff=function(e){r(e),e||n.hideFlyout()}},e.prototype.initWorkspaceSounds=function(){var n=this,r=Blockly.WorkspaceAudio.prototype.play;Blockly.WorkspaceAudio.prototype.play=function(e,t){n&&n.parent.state.mute&&(t=0),r.call(this,e,t)}},e.prototype.reportDeprecatedBlocks=function(){var t={};for(var e in this.blockInfo.blocks.forEach(function(e){e.attributes.deprecated&&(t[e.attributes.blockId]=0)}),this.editor.getAllBlocks().forEach(function(e){0<=t[e.type]&&t[e.type]++}),t)0!==t[e]&&pxt.tickEvent("blocks.usingDeprecated",{block:e,count:t[e]})},e.prototype.contentSize=function(){return this.editor?pxt.blocks.blocksMetrics(this.editor):void 0},e.prototype.isIncomplete=function(){var e=this.editor&&this.editor.currentGesture_&&this.editor.currentGesture_.isDraggingBlock_;return e&&(this.markIncomplete=!0),e},e.prototype.prepare=function(){this.isReady=!0},e.prototype.prepareBlockly=function(e){var r=this;pxt.perf.measureStart("prepareBlockly");var t=document.getElementById("blocksEditor");pxsim.U.clear(t),this.editor=Blockly.inject(t,this.getBlocklyOptions(e)),this.editor.options.hasCategories;var n=Blockly.Colours;C.jsonMergeFrom(n,pxt.appTarget.appTheme.blocklyColors||{}),Blockly.Colours=n;var i=!1;this.editor.addChangeListener(function(e){if(Blockly.Events.disableOrphans(e),("ui"!=e.type||r.markIncomplete)&&(r.changeCallback(),r.markIncomplete=!1),"create"==e.type){var t=e.xml.getAttribute("type");"variables_set"==t&&r.clearFlyoutCaches(),pxt.tickEvent("blocks.create",{block:t}),"SHADOW"==e.xml.tagName&&r.cleanUpShadowBlocks(),r.parent.state.tutorialOptions&&r.parent.state.tutorialOptions.metadata&&r.parent.state.tutorialOptions.metadata.flyoutOnly||r.parent.setState({hideEditorFloats:!1}),d.fireEvent({type:"create",editor:"blocks",blockId:t})}else if("var_create"==e.type||"var_rename"==e.type||"delete"==e.type)r.clearFlyoutCaches();else if("ui"==e.type)if("category"==e.element){var n=!!e.newValue;n&&pxt.analytics.enableCookies(),r.parent.setState({hideEditorFloats:n})}else"breakpointSet"==e.element?r.setBreakpointsFromBlocks():"melody-editor"==e.element&&(e.newValue?(i=r.parent.state.simState!=pxt.editor.SimState.Stopped,r.parent.stopSimulator()):i&&r.parent.startSimulator());null!=r.parent.state.tutorialOptions&&r.parent.pokeUserActivity()}),this.shouldShowCategories()&&this.renderToolbox(),this.hideFlyout(),this.initPrompts(),this.initBlocklyToolbox(),this.initWorkspaceSounds(),this.resize(),pxt.perf.measureEnd("prepareBlockly")},e.prototype.resize=function(e){var t=this.getBlocksAreaDiv();if(t){var n=this.getBlocksEditorDiv();n&&this.editor&&(n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px",Blockly.svgResize(this.editor),this.resizeToolbox(),this.resizeFieldEditorView())}},e.prototype.resizeToolbox=function(){if(this.getBlocksEditorDiv()){var e=this.getBlocklyToolboxDiv();e&&(this.parent.isBlocksActive()&&this.parent.updateEditorLogo(e.offsetWidth),this.getBlocklyOptions(this.showCategories).horizontalLayout||(e.style.height="100%"))}},e.prototype.resizeFieldEditorView=function(){var e=this.getBlocksEditorDiv();if(e){var t=this.getBlocklyToolboxDiv();if(t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect();m.setEditorBounds({top:n.top,left:r.right,width:n.width-r.width,height:n.height})}}},e.prototype.hasUndo=function(){return!!this.editor&&(0!=this.editor.undoStack_.length||0==this.editor.undoStack_.length&&0==this.editor.redoStack_.length)},e.prototype.undo=function(){this.editor&&(this.editor.undo(!1),Blockly.hideChaff(),this.parent.forceUpdate())},e.prototype.hasRedo=function(){return!!this.editor&&0!=this.editor.redoStack_.length},e.prototype.redo=function(){this.editor&&(this.editor.undo(!0),Blockly.hideChaff(),this.parent.forceUpdate())},e.prototype.zoomIn=function(){this.editor&&this.editor.zoomCenter(.8)},e.prototype.zoomOut=function(){this.editor&&this.editor.zoomCenter(-.8)},e.prototype.setScale=function(e){this.editor&&e!=this.editor.scale&&this.editor.setScale(e)},e.prototype.closeFlyout=function(){this.editor&&(this.hideFlyout(),Blockly.hideChaff())},e.prototype.getId=function(){return"blocksArea"},e.prototype.display=function(){var e=this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories;return a.createElement("div",null,a.createElement("div",{id:"blocksEditor"}),a.createElement(p.ToolboxTrashIcon,{flyoutOnly:e}))},e.prototype.getBlocksAreaDiv=function(){return document.getElementById("blocksArea")},e.prototype.getBlocksEditorDiv=function(){return this.getBlocksAreaDiv()?document.getElementById("blocksEditor"):void 0},e.prototype.getBlocklyToolboxDiv=function(){var e=this.getBlocksAreaDiv();return e?e.getElementsByClassName("blocklyToolboxDiv")[0]:void 0},e.prototype.renderToolbox=function(e){if(!pxt.shell.isReadOnly()){var t=this.getBlocklyToolboxDiv(),n=a.createElement("div",{className:"blocklyToolbox"},a.createElement(p.Toolbox,{ref:this.handleToolboxRef,editorname:"blocks",parent:this}),a.createElement("div",{id:"debuggerToolbox"}));C.assert(!!t),s.render(n,t),e||this.toolbox.showLoading()}},e.prototype.updateToolbox=function(){var e=document.getElementById("debuggerToolbox");if(e){pxt.perf.measureStart("updateToolbox");var t=!!this.parent.state.debugging,n=t?a.createElement(y.DebuggerToolbox,{ref:this.handleDebuggerToolboxRef,parent:this.parent,apis:this.blockInfo.apis.byQName}):a.createElement("div",null);t?this.toolbox.hide():(this.debuggerToolbox=null,this.toolbox.show()),s.render(n,e),pxt.perf.measureEnd("updateToolbox")}},e.prototype.showPackageDialog=function(){pxt.tickEvent("blocks.addpackage"),this.editor.toolbox_&&this.editor.toolbox_.clearSelection(),this.parent.showPackageDialog()},e.prototype.showVariablesFlyout=function(){this.showFlyoutInternal_(Blockly.Variables.flyoutCategory(this.editor),"variables")},e.prototype.showFunctionsFlyout=function(){this.showFlyoutInternal_(Blockly.Functions.flyoutCategory(this.editor),"functions")},e.prototype.getViewState=function(){return{}},e.prototype.setViewState=function(e){},e.prototype.getCurrentSource=function(){return this.editor&&!this.delayLoadXml?this.saveBlockly():this.currSource},e.prototype.acceptsFile=function(e){return"blocks"==e.getExtension()},e.prototype.overrideFile=function(e){this.delayLoadXml?(this.delayLoadXml=e,this.currSource=e):this.loadBlockly(e)},e.prototype.insertBreakpoint=function(){if(this.editor){var e=this.editor.newBlock(pxtc.TS_DEBUGGER_TYPE),t=this.editor.getMetrics();e.moveBy(t.viewWidth/2,t.viewHeight/3),e.initSvg(),e.render()}},e.prototype.loadBlocklyAsync=function(){var r=this;return this._loadBlocklyPromise||(pxt.perf.measureStart("loadBlockly"),this._loadBlocklyPromise=pxt.BrowserUtils.loadBlocklyAsync().then(function(){Blockly.Functions.editFunctionExternalHandler=function(t,n){Promise.delay(10).then(function(){if(!r.functionsDialog){var e=document.body.appendChild(document.createElement("div"));r.functionsDialog=s.render(a.createElement(g.CreateFunctionDialog),e)}r.functionsDialog.show(t,n,r.editor)})},pxt.blocks.openHelpUrl=function(e){pxt.tickEvent("blocks.help",{url:e},{interactiveConsent:!0});var t=/^\/pkg\/([^#]+)#(.+)$/.exec(e);if(t){var n=l.mainPkg.deps[t[1]];if(n&&"github"==n.verProtocol())return e="/pkg/"+n.verArgument().replace(/#.*$/,"")+"#"+t[2],void window.open(e,t[1])}/^\//.test(e)?r.parent.setSideDoc(e):window.open(e,"docs")},r.prepareBlockly()}).then(function(){return pxt.editor.initEditorExtensionsAsync()}).then(function(){return pxt.perf.measureEnd("loadBlockly")})),this._loadBlocklyPromise},e.prototype.loadFileAsync=function(t){var n=this;return C.assert(!this.delayLoadXml),C.assert(!this.loadingXmlPromise),this.loadBlocklyAsync().then(function(){pxt.blocks.cleanBlocks(),n.toolbox&&n.toolbox.showLoading(),n.blockInfo=void 0,n.currSource=t.content,n.typeScriptSaveable=!1,n.setDiagnostics(t),n.delayLoadXml=t.content,pxt.blocks.clearWithoutEvents(n.editor),n.closeFlyout(),n.filterToolbox(),n.parent.state.editorState&&null!=n.parent.state.editorState.hasCategories?n.showCategories=n.parent.state.editorState.hasCategories:n.showCategories=!0,n.currFile=t;var e=document.getElementById("blocklySearchInputField");e&&e.value&&(e.value=""),n.extensions=l.allEditorPkgs().map(function(e){return e.getKsPkg()}).filter(function(e){return!!e&&e.config&&!!e.config.extension&&/^(file:|github:)/.test(e.installedVersion)})})},e.prototype.unloadFileAsync=function(){return this.delayLoadXml=void 0,this.toolbox&&this.toolbox.clearSearch(),Promise.resolve()},e.prototype.switchToTypeScript=function(){pxt.tickEvent("blocks.switchjavascript"),this.parent.closeFlyout(),this.parent.switchTypeScript()},e.prototype.setDiagnostics=function(e){var i=this;if(C.assert(null!=this.editor),this.compilationResult&&!this.delayLoadXml&&!this.loadingXml){this.editor.getAllBlocks().filter(function(e){return e.isEnabled()}).forEach(function(e){e.setWarningText(null),e.setHighlightWarning(!1)});var t=e.epkg.files[e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)];if(t&&t.diagnostics){var n=t.diagnostics.filter(function(e){return e.category==ts.pxtc.DiagnosticCategory.Error}),o=this.compilationResult.sourceMap;n.filter(function(e){return e.category==ts.pxtc.DiagnosticCategory.Error}).forEach(function(e){var t=pxt.blocks.findBlockId(o,{start:e.line,length:0});if(t){var n=i.editor.getBlockById(t);if(n){var r=ts.pxtc.flattenDiagnosticMessageText(e.messageText,"\n");n.setWarningText(r),n.setHighlightWarning(!0)}}}),this.compilationResult.diagnostics.forEach(function(e){if(e.blockId){var t=i.editor.getBlockById(e.blockId);t&&(t.setWarningText(e.message),t.setHighlightWarning(!0))}}),this.setBreakpointsFromBlocks()}}},e.prototype.highlightStatement=function(e,t){if(!this.compilationResult||this.delayLoadXml||this.loadingXml)return!1;if(this.updateDebuggerVariables(t),!e)return this.editor.highlightBlock(null),!1;var n=pxt.blocks.findBlockId(this.compilationResult.sourceMap,{start:e.line,length:e.endLine-e.line});if(n){if(this.editor.highlightBlock(n),t){var r=this.editor.getBlockById(n);r.setWarningText(t?t.exceptionMessage:void 0);var i=r.getRelativeToSurfaceXY(),o=r.getHeightWidth(),a=this.editor.scale,s=this.editor.getMetrics();(i.x*a<s.viewLeft+4||(i.x+o.width)*a>s.viewLeft+s.viewWidth-4||i.y*a<s.viewTop+4||(i.y+o.height)*a>s.viewTop+s.viewHeight-4)&&this.editor.centerOnBlock(n)}return!0}return!1},e.prototype.updateDebuggerVariables=function(e){if(this.parent.state.debugging&&this.debuggerToolbox){var t=Blockly.Variables.allUsedVarModels(this.editor).map(function(e){return e.name});this.debuggerToolbox.setBreakpoint(e,t)}},e.prototype.clearHighlightedStatements=function(){this.editor.highlightBlock(null),this.debuggerToolbox&&this.debuggerToolbox.setBreakpoint(null)},e.prototype.openTypeScript=function(){pxt.tickEvent("blocks.showjavascript"),this.parent.closeFlyout(),this.parent.openTypeScriptAsync().done()},e.prototype.openPython=function(){pxt.tickEvent("blocks.showpython"),this.parent.closeFlyout(),this.parent.openPythonAsync().done()},e.prototype.cleanUpShadowBlocks=function(){this.editor.getTopBlocks(!1).filter(function(e){return e.isShadow()}).forEach(function(e){return e.dispose(!1)})},e.prototype.getBlocklyOptions=function(e){var t=this.getDefaultOptions();C.jsonMergeFrom(t,pxt.appTarget.appTheme.blocklyOptions||{});var n=null!=e?e:null!=t.hasCategories?t.hasCategories:this.showCategories;(t.hasCategories=n)||(this.showCategories=!1);var r=n?document.getElementById("blocklyToolboxDefinitionCategory"):document.getElementById("blocklyToolboxDefinitionFlyout");return t.toolbox=null!=t.toolbox?t.toolbox:t.readOnly?void 0:r,t},e.prototype.getDefaultOptions=function(){if(this.blocklyOptionsCache)return this.blocklyOptionsCache;var e=pxt.shell.isReadOnly(),t={scrollbars:!0,media:pxt.webConfig.commitCdnUrl+"blockly/media/",sound:!0,trashcan:!1,collapse:!1,comments:!0,disable:!1,readOnly:e,toolboxOptions:{colour:pxt.appTarget.appTheme.coloredToolbox,inverted:pxt.appTarget.appTheme.invertedToolbox},move:{wheel:!0},zoom:{enabled:!1,controls:!1,maxScale:2.5,minScale:.2,scaleSpeed:1.5,startScale:pxt.BrowserUtils.isMobile()?.7:.9},rtl:C.isUserLanguageRtl()};return this.blocklyOptionsCache=t},e.prototype.refreshToolbox=function(){if(this.blockInfo&&(pxt.perf.measureStart("refreshToolbox"),!pxt.shell.isReadOnly()&&(null==this.parent.state.tutorialOptions||this.parent.state.tutorialOptions.tutorialReady))){this.clearCaches();var e=this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories,t=this.shouldShowCategories(!e);this.editor.toolbox_&&t||this.editor.flyout_&&!t?t?this.toolbox.setState({loading:!1,categories:this.getAllCategories(),showSearchBox:this.shouldShowSearch()}):this.showFlyoutOnlyToolbox():(t||s.unmountComponentAtNode(this.getBlocklyToolboxDiv()),this.delayLoadXml=this.getCurrentSource(),this.editor=void 0,this.loadingXml=!1,this.loadingXmlPromise&&(this.loadingXmlPromise.cancel(),this.loadingXmlPromise=null),this.prepareBlockly(t),this.domUpdate(),this.editor.scrollCenter(),t&&this.renderToolbox(!0)),pxt.perf.measureEnd("refreshToolbox")}},e.prototype.filterToolbox=function(e){this.showCategories=e,this.refreshToolbox()},e.prototype.openExtension=function(t){var a=this,s=this.extensions.filter(function(e){return e.config.name==t})[0],l=pxt.github.parseRepoId(s.installedVersion);pxt.packagesConfigAsync().then(function(e){var t=s.config,n=pxt.github.repoStatus(l,e),r=l.fullName.substr(l.fullName.indexOf("/")+1),i=pxt.BrowserUtils.isLocalHost()&&/^file:/.test(s.installedVersion)&&t.extension.localUrl,o=pxt.BrowserUtils.isLocalHost()&&/debugExtensions/i.test(window.location.href)?"http://localhost:3232/extension.html":i?t.extension.localUrl:"https://"+l.owner+".github.io/"+r+"/";a.parent.openExtension(t.name,o,0==n)})},e.prototype.partitionBlocks=function(){var r=this,i={};this.topBlocks=[];var n=this;function o(e,t){n.subcategoryMap[e]||(n.subcategoryMap[e]={}),n.subcategoryMap[e][t]=!0}return pxt.blocks.injectBlocks(this.blockInfo).forEach(function(e){var t=(e.attributes.blockNamespace||e.namespace).split(".")[0];i[t]||(i[t]=[]),i[t].push(e);var n=e.attributes.subcategory;e.attributes.advanced?o(t,lf("more")):n&&o(t,n),e.attributes.topblock&&r.topBlocks.push(e)}),i},e.prototype.hideFlyout=function(){this.editor.toolbox_&&this.editor.toolbox_.flyout_.hide(),this.toolbox&&this.toolbox.clear()},e.prototype.clearCaches=function(){i.prototype.clearCaches.call(this),this.clearFlyoutCaches(),E.clearBuiltinBlockCache()},e.prototype.clearFlyoutCaches=function(){this.flyoutBlockXmlCache={}},e.prototype.shouldShowSearch=function(){return!this.parent.state.editorState||null==this.parent.state.editorState.searchBar||this.parent.state.editorState.searchBar},e.prototype.shouldShowCategories=function(e){return this.parent.state.editorState&&null!=this.parent.state.editorState.hasCategories?this.parent.state.editorState.hasCategories:this.getBlocklyOptions(e).hasCategories},e.prototype.getBuiltinCategory=function(e){return E.getBuiltinCategory(e)},e.prototype.isBuiltIn=function(e){return E.isBuiltin(e)},e.prototype.getNamespaceAttrs=function(e){var t=E.getBuiltinCategory(e);return t?(t.attributes.color=pxt.toolbox.getNamespaceColor(t.nameid),t.attributes):this.blockInfo?i.prototype.getNamespaceAttrs.call(this,e):void 0},e.prototype.getNamespaces=function(){var t=this,e=Object.keys(this.nsMap).filter(function(e){return!E.isBuiltin(e)&&!!t.getNamespaceAttrs(e)});function n(e){return E.getBuiltinCategory(e).removed}var r=pxt.appTarget.runtime||{};return r.loopsBlocks&&!n("loops")&&e.push("loops"),r.logicBlocks&&!n("logic")&&e.push("logic"),r.variablesBlocks&&!n("variables")&&e.push("variables"),r.mathBlocks&&!n("Math")&&e.push("Math"),r.functionBlocks&&!n("functions")&&e.push("functions"),r.listsBlocks&&!n("arrays")&&e.push("arrays"),r.textBlocks&&!n("text")&&e.push("text"),pxt.appTarget.cloud&&pxt.appTarget.cloud.packages&&e.push("addpackage"),e.concat(i.prototype.getNamespaces.call(this))},e.prototype.getBlocksForCategory=function(e,t){return E.isBuiltin(e)?this.getBuiltInBlocks(e,t).concat(this.getExtraBlocks(e,t)):this.getNonBuiltInBlocks(e,t).concat(this.getExtraBlocks(e,t))},e.prototype.filterBlocks=function(t,e){return e.filter(function(e){return!(e.attributes.blockHidden||e.attributes.deprecated)&&(!t&&!e.attributes.subcategory&&!e.attributes.advanced||t&&(e.attributes.advanced&&t==lf("more")||e.attributes.subcategory&&t==e.attributes.subcategory))})},e.prototype.getBuiltInBlocks=function(e,t){var n=E.getBuiltinCategory(e),r=n.blocks||[];return!n.custom&&this.nsMap[e]&&(r=this.filterBlocks(t,r.concat(this.nsMap[e]))),r},e.prototype.getNonBuiltInBlocks=function(e,t){return this.filterBlocks(t,this.nsMap[e])||[]},e.prototype.getExtraBlocks=function(i,e){var o=this;if(e)return[];var a=[],t=pxt.appTarget.runtime.onStartNamespace||"loops";i==t&&a.push({name:ts.pxtc.ON_START_TYPE,attributes:{blockId:ts.pxtc.ON_START_TYPE,weight:pxt.appTarget.runtime.onStartWeight||10},blockXml:'<block type="pxt-on-start"></block>'});var n=E.getPauseUntil();return n&&i==n.attributes.blockNamespace&&a.push(n),e||this.extensions.forEach(function(e){var t=e.config,n=t.name,r=t.extension.namespace||n;i==r&&a.push({name:"EXT"+n+"_BUTTON",type:"button",attributes:{blockId:"EXT"+n+"_BUTTON",label:t.extension.label?C.rlf(t.extension.label):C.lf("Editor"),weight:101},callback:function(){o.openExtension(n)}})}),pxt.appTarget.appTheme.snippetBuilder&&v.initializeSnippetExtensions(i,a,this.editor,this.parent),a},e.prototype.showFlyout=function(e){var t=e.nameid,n=e.subns,r=this.parent.state.tutorialOptions&&!!this.parent.state.tutorialOptions.tutorial;if("search"!=t)if("topblocks"!=t){this.flyoutXmlList=[];var i=t+n+(r?"tutorialexpanded":"");if(this.flyoutBlockXmlCache[i])return pxt.debug("showing flyout with blocks from flyout blocks xml cache"),this.flyoutXmlList=this.flyoutBlockXmlCache[i],void this.showFlyoutInternal_(this.flyoutXmlList,i);this.abstractShowFlyout(e)&&(pxt.Util.isTranslationMode()||(this.flyoutBlockXmlCache[i]=this.flyoutXmlList),this.showFlyoutInternal_(this.flyoutXmlList,i))}else this.showTopBlocksFlyout();else this.showSearchFlyout()},e.prototype.showFlyoutHeadingLabel=function(e,t,n,r,i){var o=t||C.capitalize(n||e),a=("blocklyTreeIcon"+(r?e.toLowerCase():"Default")).replace(/\s/g,""),s=pxt.blocks.createFlyoutHeadingLabel(o,i,r,a);this.flyoutXmlList.push(s)},e.prototype.showFlyoutGroupLabel=function(e,t,n,r){var i=this,o=pxt.blocks.createFlyoutGroupLabel(pxt.Util.rlf("{id:group}"+e),t,n,r?"GROUP_HELP_"+e:void 0);r&&this.editor.registerButtonCallback("GROUP_HELP_"+e,function(){i.helpButtonCallback(e)}),this.flyoutXmlList.push(o)},e.prototype.helpButtonCallback=function(e){pxt.debug(e+" help icon clicked."),d.fireEvent({type:"ui",editor:"blocks",action:"groupHelpClicked",data:{group:e}})},e.prototype.showFlyoutBlocks=function(e,t,n){var r=this;this.parent.state.editorState&&this.parent.state.editorState.filters,n.sort(function(e,t){return(null!=t.attributes.weight?t.attributes.weight:50)-(null!=e.attributes.weight?e.attributes.weight:50)}).forEach(function(e){var t;(t="button"==e.type?r.getButtonXml(e):r.getBlockXml(e))&&(r.flyoutXmlList=r.flyoutXmlList.concat(t))})},e.prototype.showSearchFlyout=function(){var n=this;if(this.flyoutXmlList=[],this.toolbox.getSearchBlocks().forEach(function(e){var t=n.getBlockXml(e,!0);t&&(n.flyoutXmlList=n.flyoutXmlList.concat(t))}),0==this.flyoutXmlList.length){var e=Blockly.utils.xml.createElement("label");e.setAttribute("text",lf("No search results...")),this.flyoutXmlList.push(e)}this.showFlyoutInternal_(this.flyoutXmlList,"search")},e.prototype.showTopBlocksFlyout=function(){var n=this;this.flyoutXmlList=[];var e=this.getTopBlocks();if(0==e.length){var t=Blockly.utils.xml.createElement("label");t.setAttribute("text",lf("No basic blocks...")),this.flyoutXmlList.push(t)}else this.showFlyoutHeadingLabel("topblocks",lf("{id:category}Basic"),null,pxt.toolbox.getNamespaceIcon("topblocks"),pxt.toolbox.getNamespaceColor("topblocks")),e.forEach(function(e){var t=n.getBlockXml(e,!0);t&&(n.flyoutXmlList=n.flyoutXmlList.concat(t))});this.showFlyoutInternal_(this.flyoutXmlList)},e.prototype.blocksToString=function(e){var t=null;return e.map(function(e){return e?e.outerHTML?e.outerHTML:(t||(t=new XMLSerializer),t.serializeToString(e)):"\x3c!-- invalid block here! --\x3e"}).reduce(function(e,t){return e+t},"")},e.prototype.hashBlocks=function(e){return pxt.Util.codalHash16(this.blocksToString(e))},e.prototype.swapFlyout=function(e,t){e.setVisible(!1),(this.editor.toolbox_.flyout_=t).setVisible(!0);var n=t.workspace_,r=t.targetWorkspace_;n.scale!==r.scale&&t.reflow()},e.prototype.showFlyoutInternal_=function(e,t){var n,r;if(void 0===t&&(t="default"),this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories||!this.editor.toolbox_)this.editor.flyout_&&(this.editor.flyout_.show(e),this.editor.flyout_.scrollToStart());else{var i=this.editor.toolbox_.flyout_,o=t in this.flyouts,a=o?this.flyouts[t].blocksHash:0,s=this.hashBlocks(e),l=a===s&&!!a,c=void 0;o?c=this.flyouts[t].flyout:(n=this.editor.toolbox_.workspace_,r=i.svgGroup_,c=Blockly.Functions.createFlyout(n,r),this.flyouts[t]={flyout:c,blocksHash:0}),this.flyouts[t].blocksHash=s,this.swapFlyout(i,c),l||c.show(e),c.scrollToStart()}},e.prototype.showFlyoutOnlyToolbox=function(){var n=this,e=this.getAllCategories(),r=[];e.forEach(function(e){var t=e.blocks;r=r.concat(t),e.subcategories&&e.subcategories.forEach(function(e){var t=e.blocks;r=r.concat(t)})});var t=document.createElement("div");s.render(a.createElement(p.ToolboxStyle,{categories:e}),t),document.getElementById("editorcontent").appendChild(t);var i=[];r.forEach(function(e){var t=n.getBlockXml(e);t&&(i=i.concat(t))}),this.showFlyoutInternal_(i),this.parent.forceUpdate()},e.prototype.getBlockXml=function(e,o,n){var r,a=this,i=this;if(!e.attributes.blockBuiltin){if(e.builtinBlock){var t=E.allBuiltinBlocks()[e.attributes.blockId];if(t&&t.blockXml&&e.builtinField&&2==e.builtinField.length){var s=e.builtinField[0],l=e.builtinField[1],c=new RegExp('<field name="'+s+'">(.*)</field>',"i");t.blockXml=t.blockXml.replace(c,function(){return'<field name="'+s+'">'+l+"</field>"})}return t?this.getBlockXml(t,o):void 0}if(e.blockXml)r=Blockly.Xml.textToDom(e.blockXml);else{var u=pxt.blocks.blockSymbol(e.attributes.blockId);if(u){if(!function(e){if(e.attributes.debug&&!pxt.options.debug)return!1;if(!n&&(e.attributes.deprecated||e.attributes.blockHidden))return!1;var t=(e.attributes.blockNamespace||e.namespace).split(".")[0];return i.shouldShowBlock(e.attributes.blockId,t,n)}(u))return;var p=pxt.blocks.compileInfo(u);if(r=pxt.blocks.createToolboxBlock(this.blockInfo,u,p),u.attributes.optionalVariableArgs&&u.attributes.toolboxVariableArgs){var d=p.handlerArgs;u.attributes.toolboxVariableArgs.split(";").map(function(e){return parseInt(e)}).filter(function(e){return e<=d.length&&0<=e}).forEach(function(e){var t=document.createElement("mutation");t.setAttribute("numargs",e.toString());for(var n=0;n<e;n++)t.setAttribute("arg"+n,d[n].name);r.appendChild(t)})}else if(p.handlerArgs.length&&!u.attributes.optionalVariableArgs)p.handlerArgs.forEach(function(e){var t=Blockly.Xml.textToDom('\n    <value name="HANDLER_'+e.name+'">\n    <shadow type="variables_get_reporter">\n    <field name="VAR" variabletype="">'+e.name+"</field>\n    </shadow>\n    </value>");r.appendChild(t)});else{if(u.attributes.mutateDefaults){var f=[];return u.attributes.mutateDefaults.split(";").forEach(function(e){var t=r.cloneNode(!0);pxt.blocks.mutateToolboxBlock(t,u.attributes.mutate,e),f.push(t)}),f}if(null!=u.attributes.blockSetVariable&&u.retType&&!n){for(var h=u.attributes.blockSetVariable,m=void 0,g=m=!h||pxt.blocks.isReservedWord(h)?C.htmlEscape(u.retType.toLowerCase()):C.htmlEscape(h),v=2;_=g,x=k=void 0,(x=(k=(w=this.editor).getVariable(_))&&w.getVariableUsesById(k.getId()))&&x.some(function(e){return"variables_set"==e.type||"variables_change"==e.type});)g=m+v++;m=g;var y=Blockly.Xml.textToDom('\n<block type="variables_set" gap="'+C.htmlEscape((u.attributes.blockGap||8)+"")+'">\n<field name="VAR" variabletype="">'+m+"</field>\n</block>"),b=document.createElement("value");b.setAttribute("name","VALUE"),b.appendChild(r),b.appendChild(pxt.blocks.mkFieldBlock("math_number","NUM","0",!0)),y.appendChild(b),r=y}}}else pxt.log("Couldn't find block for: "+e.attributes.blockId),pxt.log(e)}var _,w,k,x;return r&&(o&&r.setAttribute("gap",""+(pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&pxt.appTarget.appTheme.defaultBlockGap.toString()||8)),pxt.Util.toArray(r.querySelectorAll("shadow")).filter(function(e){return!e.innerHTML}).forEach(function(e,t){var n=e.getAttribute("type"),r=E.allBuiltinBlocks()[n],i=a.getBlockXml(r||{name:n,attributes:{blockId:n}},o,!0);i&&0<i.length&&i[0]&&(e.innerHTML=i[0].innerHTML)})),[r]}pxt.log("ignoring built in block: "+e.attributes.blockId)},e.prototype.getButtonXml=function(t){return this.editor.registerButtonCallback(t.attributes.blockId,function(e){t.callback()}),[pxt.blocks.createFlyoutButton(t.attributes.blockId,t.attributes.label)]},e.prototype.updateBreakpoints=function(){if(this.editor){var t=!!this.parent.state.debugging;this.editor.getAllBlocks().forEach(function(e){e.nextConnection&&e.previousConnection&&e.enableBreakpoint(t)}),this.editor.setDebugModeOption(t)}},e}(i.ToolboxEditor);n.Editor=b},{"./blocklyFieldView":5,"./blocksSnippets":7,"./compiler":14,"./core":41,"./createFunction":43,"./debuggerToolbox":49,"./dialogs":51,"./package":81,"./simulator":92,"./snippetBuilder":93,"./toolbox":101,"./toolboxeditor":102,"./workspace":105,react:284,"react-dom":240}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i,o=null;function a(){return o||((o={}).loops={name:lf("{id:category}Loops"),nameid:"loops",blocks:[{name:"controls_repeat_ext",attributes:{blockId:"controls_repeat_ext",weight:49},blockXml:'<block type="controls_repeat_ext">\n                    <value name="TIMES">\n                        <shadow type="math_whole_number">\n                            <field name="NUM">4</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"device_while",attributes:{blockId:"device_while",weight:48},blockXml:'<block type="device_while">\n                    <value name="COND">\n                        <shadow type="logic_boolean"></shadow>\n                    </value>\n                </block>'},{name:"pxt_controls_for",attributes:{blockId:"pxt_controls_for",weight:47},blockXml:'<block type="pxt_controls_for">\n                    <value name="VAR">\n                        <shadow type="variables_get_reporter">\n                            <field name="VAR">'+lf("{id:var}index")+'</field>\n                        </shadow>\n                    </value>\n                    <value name="TO">\n                        <shadow type="math_whole_number">\n                            <field name="NUM">4</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"pxt_controls_for_of",attributes:{blockId:"pxt_controls_for_of",weight:46},blockXml:'<block type="pxt_controls_for_of">\n                    <value name="VAR">\n                        <shadow type="variables_get_reporter">\n                            <field name="VAR">'+lf("{id:var}value")+'</field>\n                        </shadow>\n                    </value>\n                    <value name="LIST">\n                        <shadow type="variables_get">\n                            <field name="VAR">list</field>\n                        </shadow>\n                    </value>\n                </block>'}],attributes:{callingConvention:0,icon:"loops",weight:50.09,paramDefl:{}}},pxt.appTarget.runtime&&pxt.appTarget.runtime.breakBlock&&o.loops.blocks.push({name:"pxt_break",attributes:{blockId:"break_keyword",weight:30},blockXml:'<block type="break_keyword"></block>'}),pxt.appTarget.runtime&&pxt.appTarget.runtime.continueBlock&&o.loops.blocks.push({name:"pxt_continue",attributes:{blockId:"continue_keyword",weight:29},blockXml:'<block type="continue_keyword"></block>'}),o.logic={name:lf("{id:category}Logic"),nameid:"logic",groups:[lf("Conditionals"),lf("Comparison"),lf("Boolean"),"other"],blocks:[{name:"controls_if",attributes:{blockId:"controls_if",group:lf("Conditionals"),weight:49},blockXml:'<block type="controls_if" gap="8">\n                    <value name="IF0">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">TRUE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"controls_if_else",attributes:{blockId:"controls_if",group:lf("Conditionals"),weight:48},blockXml:'<block type="controls_if" gap="8">\n                    <mutation else="1"></mutation>\n                    <value name="IF0">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">TRUE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_eq",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:47},blockXml:'<block type="logic_compare" gap="8">\n                    <value name="A">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_lt",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:46},blockXml:'<block type="logic_compare">\n                    <field name="OP">LT</field>\n                    <value name="A">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_strings",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:45},blockXml:'<block type="logic_compare" gap="8">\n                    <value name="A">\n                        <shadow type="text">\n                            <field name="TEXT"></field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="text">\n                            <field name="TEXT"></field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_operation_and",attributes:{blockId:"logic_operation",group:lf("Boolean"),weight:44},blockXml:'<block type="logic_operation" gap="8">\n                    <field name="OP">AND</field>\n                </block>'},{name:"logic_operation_or",attributes:{blockId:"logic_operation",group:lf("Boolean"),weight:43},blockXml:'<block type="logic_operation" gap="8">\n                    <field name="OP">OR</field>\n                </block>'},{name:"logic_negate",attributes:{blockId:"logic_negate",group:lf("Boolean"),weight:42},blockXml:'<block type="logic_negate"></block>'},{name:"logic_boolean_true",attributes:{blockId:"logic_boolean",group:lf("Boolean"),weight:41},blockXml:'<block type="logic_boolean" gap="8">\n                    <field name="BOOL">TRUE</field>\n                </block>'},{name:"logic_boolean_false",attributes:{blockId:"logic_boolean",group:lf("Boolean"),weight:40},blockXml:'<block type="logic_boolean">\n                    <field name="BOOL">FALSE</field>\n                </block>'}],attributes:{callingConvention:0,weight:50.08,icon:"logic",paramDefl:{}}},o.variables={name:lf("{id:category}Variables"),nameid:"variables",blocks:void 0,custom:!0,customClick:function(e){return e.showVariablesFlyout(),!1},attributes:{weight:50.07,icon:"variables",callingConvention:0,paramDefl:{}}},o.Math={name:lf("{id:category}Math"),nameid:"Math",blocks:[{name:"math_arithmetic_ADD",attributes:{blockId:"math_arithmetic",weight:90},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">ADD</field>\n                    </block>'},{name:"math_arithmetic_MINUS",attributes:{blockId:"math_arithmetic",weight:89},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">MINUS</field>\n                    </block>'},{name:"math_arithmetic_TIMES",attributes:{blockId:"math_arithmetic",weight:88},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">MULTIPLY</field>\n                    </block>'},{name:"math_arithmetic_DIVIDE",attributes:{blockId:"math_arithmetic",weight:87},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">DIVIDE</field>\n                    </block>'},{name:"math_number",attributes:{blockId:"math_number",weight:86},blockXml:'<block type="math_number" gap="8">\n                        <field name="NUM">0</field>\n                    </block>'},{name:"math_modulo",attributes:{blockId:"math_modulo",weight:85},blockXml:'<block type="math_modulo">\n                        <value name="DIVIDEND">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="DIVISOR">\n                            <shadow type="math_number">\n                                <field name="NUM">1</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_op2_min",attributes:{blockId:"math_op2",weight:84},blockXml:'<block type="math_op2" gap="8">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="y">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="op">min</field>\n                    </block>'},{name:"math_op2_max",attributes:{blockId:"math_op2",weight:83},blockXml:'<block type="math_op2" gap="8">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="y">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="op">max</field>\n                    </block>'},{name:"math_op3",attributes:{blockId:"math_op3",weight:82},blockXml:'<block type="math_op3">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_js_op",attributes:{blockId:"math_js_op",weight:81},blockXml:'<block type="math_js_op">\n                        <field name="OP">sqrt</field>\n                        <value name="ARG0">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_js_round",attributes:{blockId:"math_js_round",weight:80},blockXml:'<block type="math_js_round">\n                        <field name="OP">round</field>\n                        <value name="ARG0">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'}],attributes:{callingConvention:0,weight:50.06,icon:"math",paramDefl:{}}},o.functions={name:lf("{id:category}Functions"),nameid:"functions",blocks:[],custom:!0,customClick:function(e){return e.showFunctionsFlyout(),!1},attributes:{advanced:!0,weight:50.08,callingConvention:0,icon:"functions",paramDefl:{}}},o.arrays={name:lf("{id:category}Arrays"),nameid:"arrays",blocks:[{name:"lists_create_with",attributes:{blockId:"lists_create_with",weight:90},blockXml:'<block type="variables_set" gap="8">\n                        <field name="VAR" variabletype="">'+lf("{id:var}list")+'</field>\n                        <value name="VALUE">\n                            <block type="lists_create_with">\n                                <mutation items="2"></mutation>\n                                <value name="ADD0">\n                                    <shadow type="math_number">\n                                        <field name="NUM">1</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD1">\n                                    <shadow type="math_number">\n                                        <field name="NUM">2</field>\n                                    </shadow>\n                                </value>\n                            </block>\n                        </value>\n                    </block>'},{name:"lists_create_with",attributes:{blockId:"lists_create_with",weight:89},blockXml:'<block type="variables_set">\n                        <field name="VAR" variabletype="">'+lf("{id:var}text list")+'</field>\n                        <value name="VALUE">\n                            <block type="lists_create_with">\n                                <mutation items="3"></mutation>\n                                <value name="ADD0">\n                                    <shadow type="text">\n                                        <field name="TEXT">'+lf("a")+'</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD1">\n                                    <shadow type="text">\n                                        <field name="TEXT">'+lf("b")+'</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD2">\n                                    <shadow type="text">\n                                        <field name="TEXT">'+lf("c")+"</field>\n                                    </shadow>\n                                </value>\n                            </block>\n                        </value>\n                    </block>"},{name:"lists_create_with",attributes:{blockId:"lists_create_with",weight:5},blockXml:'<block type="lists_create_with">\n                        <mutation items="0"></mutation>\n                    </block>'},{name:"lists_index_get",attributes:{blockId:"lists_index_get",weight:87},blockXml:'<block type="lists_index_get">\n                        <value name="LIST">\n                            <block type="variables_get">\n                                <field name="VAR">'+lf("{id:var}list")+'</field>\n                            </block>\n                        </value>\n                        <value name="INDEX">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"lists_index_set",attributes:{blockId:"lists_index_set",weight:86},blockXml:'<block type="lists_index_set">\n                        <value name="INDEX">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="LIST">\n                            <block type="variables_get">\n                                <field name="VAR">'+lf("{id:var}list")+"</field>\n                            </block>\n                        </value>\n                    </block>"},{name:"lists_length",attributes:{blockId:"lists_length",weight:88},blockXml:'<block type="lists_length">\n                        <value name="VALUE">\n                            <block type="variables_get">\n                                <field name="VAR">'+lf("{id:var}list")+"</field>\n                            </block>\n                        </value>\n                    </block>"}],attributes:{advanced:!0,weight:50.07,icon:"arrays",callingConvention:0,paramDefl:{}}},o.text={name:lf("{id:category}Text"),nameid:"text",blocks:[{name:"text",attributes:{blockId:"text",weight:90},blockXml:'<block type="text"></block>'},{name:"text_length",attributes:{blockId:"text_length",weight:89},blockXml:'<block type="text_length">\n                        <value name="VALUE">\n                            <shadow type="text">\n                                <field name="TEXT">'+lf("Hello")+"</field>\n                            </shadow>\n                        </value>\n                    </block>"},{name:"text_join",attributes:{blockId:"text_join",weight:88},blockXml:'<block type="text_join">\n                        <mutation items="2"></mutation>\n                        <value name="ADD0">\n                            <shadow type="text">\n                                <field name="TEXT">'+lf("Hello")+'</field>\n                            </shadow>\n                        </value>\n                        <value name="ADD1">\n                            <shadow type="text">\n                                <field name="TEXT">'+lf("World")+"</field>\n                            </shadow>\n                        </value>\n                    </block>"}],attributes:{advanced:!0,weight:50.06,icon:"text",callingConvention:0,paramDefl:{}}},o.addpackage={name:pxt.toolbox.addPackageTitle(),nameid:"addpackage",blocks:[],custom:!0,customClick:function(e){return e.closeFlyout(),e.showPackageDialog(),!0},attributes:{advanced:!0,weight:-1,icon:"addpackage",callingConvention:0,paramDefl:{}}}),o}function s(){if(r)return r;var e=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;return e&&(r={name:pxtc.PAUSE_UNTIL_TYPE,attributes:{blockId:pxtc.PAUSE_UNTIL_TYPE,blockNamespace:e.category||"loops",weight:null==e.weight?0:e.weight},blockXml:Blockly.Xml.domToText(pxt.blocks.mkPredicateBlock(pxtc.PAUSE_UNTIL_TYPE))}),r}function l(e){return a()[e]}function c(e,t){var n=l(e);if(t&&n&&(0===Object.keys(t).length&&(n.removed=!0),t.name&&(n.name=t.name),t.icon&&(n.attributes.icon=t.icon),void 0!==t.weight&&(n.attributes.weight=t.weight),void 0!==t.advanced&&(n.attributes.advanced=t.advanced),null!=t.groups&&(n.groups=t.groups),t.blocks)){var i=100;n.blocks=t.blocks.map(function(e,t){return e.weight?i=e.weight:i--,r=i,{name:(n=e).name,snippet:n.snippet,snippetName:n.snippetName,snippetOnly:n.snippetOnly,pySnippet:n.pySnippet,pySnippetName:n.pySnippetName,attributes:{blockId:n.blockId,weight:r||n.weight,advanced:n.advanced,jsDoc:n.jsDoc,group:n.group},retType:n.retType,blockXml:n.blockXml};var n,r})}}function u(e){return{name:e.name,icon:e.attributes.icon,color:e.attributes.color,weight:e.attributes.weight,advanced:e.attributes.advanced,blocks:e.blocks?e.blocks.map(function(e){return{name:(t=e).name,snippet:t.snippet,snippetName:t.snippetName,pySnippet:t.pySnippet,pySnippetName:t.pySnippetName,snippetOnly:t.snippetOnly,retType:t.retType,weight:t.attributes.weight,advanced:t.attributes.advanced,jsDoc:t.attributes.jsDoc,group:t.attributes.group,blockXml:t.blockXml,blockId:t.attributes.blockId};var t}):[]}}n.getPauseUntil=s,n.getBuiltinCategory=l,n.isBuiltin=function(e){return!!a()[e]},n.allBuiltinBlocks=function(){i||(i={},[l("loops"),l("logic"),l("Math"),l("text"),l("arrays")].forEach(function(e){e.blocks.forEach(function(e){e.attributes.blockId&&!i[e.attributes.blockId]&&(i[e.attributes.blockId]=e)})})),i[ts.pxtc.ON_START_TYPE]={name:ts.pxtc.ON_START_TYPE,attributes:{blockId:ts.pxtc.ON_START_TYPE,weight:pxt.appTarget.runtime.onStartWeight||10},blockXml:'<block type="pxt-on-start"></block>'};var e=s();return e&&(i[pxtc.PAUSE_UNTIL_TYPE]=e),i},n.clearBuiltinBlockCache=function(){i=void 0},n.overrideCategory=c,n.overrideToolbox=function(e){c("loops",e.loops),c("logic",e.logic),c("variables",e.variables),c("Math",e.maths),c("text",e.text),c("arrays",e.arrays),c("functions",e.functions)},n.getToolboxDefinition=function(){return{loops:u(l("loops")),logic:u(l("logic")),variables:u(l("variables")),maths:u(l("Math")),text:u(l("text")),arrays:u(l("arrays")),functions:u(l("functions"))}}},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i,a=e("./db");function s(t){return i.getAsync(t.id).then(function(e){return{header:t,text:e.files,version:e._rev}})}function l(e,t,n){return c(r,i,e,t,n)}function c(e,t,n,r,i){var o="";return(i?t.setAsync({id:n.id,files:i,_rev:r}).then(function(e){o=e}):Promise.resolve()).then(function(){return e.setAsync(n)}).then(function(e){return n._rev=e,o})}n.copyProjectToLegacyEditor=function(e,t){var n=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[t],r=new a.Table(n?n+"-header":"header"),i=new a.Table(n?n+"-text":"text"),o=pxt.Util.clone(e);return delete o._id,delete o._rev,o.id=pxt.Util.guidGen(),s(e).then(function(e){return c(r,i,o,void 0,e.text)}).then(function(e){return o})},n.provider={getAsync:s,setAsync:l,deleteAsync:function(e,t){return r.deleteAsync(e).then(function(){return i.deleteAsync({id:e.id,_rev:e._rev})})},listAsync:function(){return(o=pxt.semver.parse(pxt.appTarget.versions.target).major,e=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[o],e?(r=new a.Table(e+"-header"),i=new a.Table(e+"-text"),r.getAllAsync().then(function(e){if(e.length)return Promise.resolve();var t=o-1,n=t<0?"":pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[t],r=new a.Table("header"),i=new a.Table("text");return n&&(r=new a.Table(n+"-header"),i=new a.Table(n+"-text")),r.getAllAsync().then(function(e){return Promise.map(e,function(e){return t=e,i.getAsync(t.id).then(function(e){return delete t._id,delete t._rev,l(t,void 0,e.files)});var t})}).then(function(){})})):(r=new a.Table("header"),i=new a.Table("text"),Promise.resolve())).then(function(){return r.getAllAsync()});var o,e},resetAsync:function(){return Promise.resolve()}}},{"./db":45}],9:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o,a,s=e("react"),l=e("./sui"),c=e("./data");(a=o||(o={}))[a.None=0]="None",a[a.X=1]="X",a[a.Y=2]="Y";var u=function(n){function e(e){var t=n.call(this,e)||this;return t.arrows=[],t.isDragging=!1,t.definitelyDragging=o.None,t.currentOffset=0,t.index=0,t.childrenElements=[],t.handleContainerRef=function(e){t.container=e},t.handleDragSurfaceRef=function(e){t.dragSurface=e},t.handleArrowRefs=function(e){t.arrows.push(e)},t.handleChildRefs=function(e){e&&t.childrenElements.push(e)},t.state={},t.childrenElements=[],t.arrows=[],t.onLeftArrowClick=t.onLeftArrowClick.bind(t),t.onRightArrowClick=t.onRightArrowClick.bind(t),t}return i(e,n),e.prototype.componentWillReceiveProps=function(e){null!=e.selectedIndex&&this.setIndex(e.selectedIndex)},e.prototype.renderCore=function(){var n=this,e=this.state,t=e.rightDisabled,r=e.leftDisabled,i=pxt.Util.isUserLanguageRtl();return s.createElement("div",{className:"ui carouselouter"},!r&&s.createElement("span",{role:"button",className:"carouselarrow left aligned",tabIndex:0,"aria-label":lf("See previous"),onClick:this.onLeftArrowClick,onKeyDown:l.fireClickOnEnter,ref:this.handleArrowRefs},s.createElement(l.Icon,{icon:"circle angle "+(i?"right":"left")})),s.createElement("div",{className:"carouselcontainer",ref:this.handleContainerRef},s.createElement("div",{className:"carouselbody",ref:this.handleDragSurfaceRef},s.Children.map(this.props.children,function(e,t){return e?s.createElement("div",{className:"carouselitem "+(n.props.selectedIndex==t?"selected":""),ref:n.handleChildRefs},s.cloneElement(e,{tabIndex:n.isVisible(t)?0:-1})):void 0}))),!t&&s.createElement("span",{role:"button",className:"carouselarrow right aligned",tabIndex:0,"aria-label":lf("See more"),onClick:this.onRightArrowClick,onKeyDown:l.fireClickOnEnter,ref:this.handleArrowRefs},s.createElement(l.Icon,{icon:"circle angle "+(pxt.Util.isUserLanguageRtl()?"left":"right")})))},e.prototype.onLeftArrowClick=function(){this.onArrowClick(!0)},e.prototype.onRightArrowClick=function(){this.onArrowClick(!1)},e.prototype.onArrowClick=function(e){var t=this.index,n=this.container.scrollLeft;if(this.setIndex(e?this.index-this.actualPageLength:this.index+this.actualPageLength),e){var r=this.index+this.actualPageLength<t?this.index+this.actualPageLength:t-1;this.childrenElements[r]&&this.childrenElements[r].firstChild.focus()}else{var i=this.index>t+this.actualPageLength?this.index:t+this.actualPageLength;this.childrenElements[i]&&this.childrenElements[i].firstChild.focus()}this.container.scrollLeft=n},e.prototype.componentDidMount=function(){var t=this;this.initDragSurface(),this.updateDimensions(),window.addEventListener("resize",function(e){t.updateDimensions()})},e.prototype.componentDidUpdate=function(){this.updateDimensions()},e.prototype.updateDimensions=function(){if(this.container){var e=!1;if(this.containerWidth=this.container.getBoundingClientRect().width,this.getArrowWidth(),this.childrenElements.length){var t=this.childrenElements[0].getBoundingClientRect().width;t!==this.childWidth&&(this.childWidth=t,e=!0),this.actualPageLength=Math.floor(this.containerWidth/this.childWidth)}this.dragSurface.style.width=this.totalLength()+"px",this.updateArrows(),this.index>=this.maxIndex()&&(e=!0,this.index=this.maxIndex()),e&&this.setPosition(this.indexToOffset(this.index))}},e.prototype.initDragSurface=function(){var r=this,e=function(e){r.definitelyDragging=o.None,r.dragStart(d(e),f(e))},t=function(e){r.isDragging&&(r.dragEnd(),r.definitelyDragging&&(e.preventDefault(),e.stopPropagation()))},n=function(e){r.isDragging&&r.dragEnd()},i=function(e){if(r.isDragging){var t=d(e);if(!r.definitelyDragging){var n=f(e);5<Math.abs(t-r.dragStartX)?r.definitelyDragging=o.X:5<Math.abs(n-r.dragStartY)&&(r.definitelyDragging=o.Y)}r.definitelyDragging==o.X&&(e.stopPropagation(),e.preventDefault(),window.requestAnimationFrame(function(){r.dragMove(t)}))}};this.dragSurface.addEventListener("click",function(e){r.definitelyDragging&&(e.stopPropagation(),e.preventDefault())}),window.PointerEvent?(this.dragSurface.addEventListener("pointerdown",e),this.dragSurface.addEventListener("pointerup",t),this.dragSurface.addEventListener("pointerleave",n),this.dragSurface.addEventListener("pointermove",i)):(this.dragSurface.addEventListener("mousedown",e),this.dragSurface.addEventListener("mouseup",t),this.dragSurface.addEventListener("mouseleave",n),this.dragSurface.addEventListener("mousemove",i),pxt.BrowserUtils.isTouchEnabled()&&(this.dragSurface.addEventListener("touchstart",e),this.dragSurface.addEventListener("touchend",t),this.dragSurface.addEventListener("touchcancel",n),this.dragSurface.addEventListener("touchmove",i)))},e.prototype.dragStart=function(e,t){this.isDragging=!0,this.dragStartX=e,this.dragStartY=t,this.dragStartOffset=this.currentOffset,this.animationId&&(window.cancelAnimationFrame(this.animationId),this.animationId=0)},e.prototype.dragEnd=function(){this.isDragging=!1,this.calculateIndex()},e.prototype.dragMove=function(e){this.dragOffset=e-this.dragStartX;var t=pxt.Util.isUserLanguageRtl()?this.dragStartOffset+this.dragOffset:this.dragStartOffset-this.dragOffset;this.setPosition(t)},e.prototype.setPosition=function(e){this.dragSurface&&(e=Math.min(Math.max(e,-300),this.maxScrollOffset()),this.currentOffset=e,pxt.Util.isUserLanguageRtl()?this.dragSurface.style.marginRight=-e+"px":this.dragSurface.style.marginLeft=-e+"px")},e.prototype.calculateIndex=function(){if(this.dragSurface){var e,t=Math.round(Math.max(this.currentOffset,0)/this.childWidth);e=this.currentOffset>this.dragStartOffset?t:t-1,this.setIndex(e,200)}},e.prototype.setIndex=function(e,t){var n=Math.max(Math.min(e,this.maxIndex()),0);t||(t=100*Math.abs(n-this.index)),this.index=n,this.updateArrows(),this.animation=new p(this.currentOffset,this.indexToOffset(this.index),t),this.animationId||(this.animationId=window.requestAnimationFrame(this.easeTowardsIndex.bind(this)))},e.prototype.isVisible=function(e){return e>=this.index&&e<this.index+(this.actualPageLength||4)},e.prototype.easeTowardsIndex=function(e){this.dragSurface&&(this.setPosition(this.animation.getPosition(e)),this.animation.isComplete?(this.animation=void 0,this.animationId=0):this.animationId=window.requestAnimationFrame(this.easeTowardsIndex.bind(this)))},e.prototype.indexToOffset=function(e){return e<=0?0:e===this.maxIndex()?this.totalLength()-this.containerWidth-300+2*this.arrowWidth:e*this.childWidth-this.childWidth*this.props.bleedPercent/100},e.prototype.totalLength=function(){return s.Children.count(this.props.children)*this.childWidth+300},e.prototype.getArrowWidth=function(){var t=this;this.arrows.length&&(this.arrowWidth=0,this.arrows.forEach(function(e){e&&(t.arrowWidth=Math.max(e.getBoundingClientRect().width,t.arrowWidth))}))},e.prototype.maxScrollOffset=function(){return Math.max(this.totalLength()-this.actualPageLength*this.childWidth+300,0)},e.prototype.maxIndex=function(){return Math.max(this.childrenElements.length-this.actualPageLength,0)},e.prototype.updateArrows=function(){var e=this.state||{},t=e.rightDisabled,n=e.leftDisabled,r=this.index===this.maxIndex(),i=0===this.index;r===t&&i===n||this.setState({leftDisabled:i,rightDisabled:r})},e}(c.Component);n.Carousel=u;var p=function(){function e(e,t,n){this.start=e,this.end=t,this.millis=n,this.isComplete=!1,this.slope=(t-e)/n}return e.prototype.getPosition=function(e){if(this.isComplete)return this.end;if(void 0===this.startTime)return this.startTime=e,this.start;var t=e-this.startTime;return t>this.millis?(this.isComplete=!0,this.end):this.start+Math.floor(this.slope*t)},e}();function d(e){return"screenX"in e?e.screenX:e.changedTouches[0].screenX}function f(e){return"screenY"in e?e.screenX:e.changedTouches[0].screenY}},{"./data":44,"./sui":100,react:284}],10:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var s=e("react"),l=e("./data"),c=e("./sui"),u=e("./cloudsync"),p=e("./codecard"),d=function(n){function e(e){var t=n.call(this,e)||this;return t.state={visible:!1},t.close=t.close.bind(t),t.onLoggedIn=t.onLoggedIn.bind(t),t}return i(e,n),e.prototype.hide=function(){this.setState({visible:!1})},e.prototype.close=function(){this.setState({visible:!1})},e.prototype.show=function(){this.setState({visible:!0})},e.prototype.onLoggedIn=function(){var e=this.props.onComplete;this.hide(),e&&e()},e.prototype.renderCore=function(){var t=this,e=this.state.visible,n=u.providers();return s.createElement(c.Modal,{isOpen:e,className:"signindialog",size:"small",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Sign In"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},s.createElement("div",{className:"ui header"},lf("Please choose your cloud provider.")),s.createElement("div",{className:"ui grid padded"},s.createElement("div",{className:"ui cards"},n.map(function(e){return s.createElement(f,{key:e.name,provider:e,onLoggedIn:t.onLoggedIn})}))))},e}(l.Component);n.SignInDialog=d;var f=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.handleClick=t.handleClick.bind(t),t}return i(e,n),e.prototype.handleClick=function(){var e=this.props,t=e.provider,n=e.onLoggedIn;t.loginAsync().then(function(){n&&n()})},e.prototype.renderCore=function(){var e=this.props,t=e.provider,n=a(e,["provider"]);return s.createElement(p.CodeCardView,o({ariaLabel:lf("Sign in with {0}.",t.name),role:"button",key:"import",icon:t.icon+" large",name:t.friendlyName,onClick:this.handleClick},n))},e}(c.StatelessUIElement),h=function(n){function e(e){var t=n.call(this,e)||this;return t.logout=t.logout.bind(t),t.login=t.login.bind(t),t}return i(e,n),e.prototype.login=function(){pxt.tickEvent("github.usermenu.signin",void 0,{interactiveConsent:!0}),this.props.parent.cloudSignInDialog()},e.prototype.logout=function(){pxt.tickEvent("github.usermenu.signout",void 0,{interactiveConsent:!0}),this.props.parent.cloudSignOut()},e.prototype.renderCore=function(){var e=this.getUser(),t=e&&e.name?lf("{0}'s Account",e.name):lf("Sign in"),n=e&&e.profile,r=e&&e.photo,i=e&&e.initials,o=this.getData("sync:providericon")||"";return s.createElement(c.DropdownMenu,{role:"menuitem",avatarImage:r,avatarInitials:i,icon:o+" large",title:t,className:"item icon user-dropdown-menuitem",tabIndex:0},n?s.createElement("a",{className:"ui item",role:"menuitem",href:n,title:lf("Open user profile page"),target:"_blank",rel:"noopener noreferrer"},s.createElement("i",{className:"ui icon "+o}),lf("Signed in as {0}",e.userName||e.name)):void 0,e?s.createElement("div",{className:"ui divider"}):void 0,e?s.createElement(c.Item,{role:"menuitem",icon:"sign out",text:lf("Sign out"),onClick:this.logout}):void 0,e?void 0:s.createElement(c.Item,{role:"menuitem",icon:"sign in",text:lf("Sign in"),onClick:this.login}))},e}(l.Component);n.UserMenu=h},{"./cloudsync":11,"./codecard":13,"./data":44,"./sui":100,react:284}],11:[function(e,t,c){"use strict";var d=this&&this.__awaiter||function(o,a,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((l=l.apply(o,a||[])).next())})},f=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(c,"__esModule",{value:!0});var n,i,h=e("./core"),m=e("./package"),g=e("./workspace"),r=e("./data"),v=pxt.Util,y=v.lf,o="",b=".cloudheader.json";function a(e){var t=new Error(e);return t.isUserError=!0,t.isSyncError=!0,t}function s(e,t,n){var r=ts.pxtc.Util.guidGen();return pxt.storage.setLocal(c.OAUTH_TYPE,e),pxt.storage.setLocal(c.OAUTH_STATE,r),pxt.storage.setLocal(c.OAUTH_REDIRECT,t||window.location.hash),pxt.storage.setLocal(c.OAUTH_HASH,n),r}function u(){pxt.storage.removeLocal(c.OAUTH_TYPE),pxt.storage.removeLocal(c.OAUTH_STATE),pxt.storage.removeLocal(c.OAUTH_REDIRECT),pxt.storage.removeLocal(c.OAUTH_HASH)}c.OAUTH_TYPE="oauthType",c.OAUTH_STATE="oauthState",c.OAUTH_REDIRECT="oauthRedirect",c.OAUTH_HASH="oauthHash",c.setOauth=s;var l=function(){function e(e,t,n,r){this.name=e,this.friendlyName=t,this.icon=n,this.urlRoot=r}return e.prototype.hasSync=function(){return!0},e.prototype.syncError=function(e){throw a(e)},e.prototype.user=function(){return pxt.Util.jsonTryParse(pxt.storage.getLocal(this.name+"cloudUser"))},e.prototype.setUser=function(e){e?pxt.storage.setLocal(this.name+"cloudUser",JSON.stringify(e)):pxt.storage.removeLocal(this.name+"cloudUser"),r.invalidate("sync:user"),r.invalidate("github:user")},e.prototype.token=function(){if(!this.hasTokenExpired())return pxt.storage.getLocal(this.name+"token")},e.prototype.reqAsync=function(e){var t=this.token();if(!t)throw this.pleaseLogin();return e.headers||(e.headers={}),e.headers.Authorization="Bearer "+t,/^https:\/\//.test(e.url)||(e.url=this.urlRoot+e.url),e.allowHttpErrors=!0,v.requestAsync(e)},e.prototype.getJsonAsync=function(t){var n=this;return this.reqAsync({url:t}).then(function(e){if(e.statusCode<300)return e.json;throw n.syncError(y("Invalid {0} response {1} at {2}",n.friendlyName,e.statusCode,t))})},e.prototype.fileSuffix=function(){return".mkcd-"+pxt.appTarget.id},e.prototype.createFileNameWithSuffix=function(e){return e.replace(/[~"#%&*:<>?/\\{|}]+/g,"_")+this.fileSuffix()},e.prototype.parseTime=function(e){return Math.round(new Date(e).getTime()/1e3)},e.prototype.pleaseLogin=function(){var e=y("Please log in to {0}",this.friendlyName);h.infoNotification(e);var t=a(e);return t.isLoginError=!0,t},e.prototype.loginCheck=function(){var t=this;if(this.token())if(this.hasTokenExpired()){if(pxt.storage.getLocal(this.name+"AutoLogin"))return void this.pleaseLogin();pxt.storage.setLocal(this.name+"AutoLogin","yes"),this.loginAsync(void 0,!0).then(function(e){return e&&t.setNewToken(e.accessToken,e.expiresIn)}).done()}else C(this)},e.prototype.loginAsync=function(e,t){return v.userError("Not implemented"),Promise.resolve(void 0)},e.prototype.loginInner=function(){var e=this.name;h.showLoading(e+"login",y("Signing you in to {0}...",this.friendlyName));var t=s(e),n=pxt.appTarget.cloud&&pxt.appTarget.cloud.cloudProviders&&pxt.appTarget.cloud.cloudProviders[this.name],r=window.location.protocol+"//"+window.location.host+"/oauth-redirect",i={client_id:n.client_id,response_type:"token",state:t,redirect_uri:r,scope:"",expires_in:86400};return n.redirect&&(i.redirect=n.redirect),i},e.prototype.loginCompleteInner=function(){var e=this.name;h.hideLoading(e+"login")},e.prototype.loginCallback=function(e){var t=this.name;pxt.storage.removeLocal(t+"AutoLogin"),this.setNewToken(e.access_token,parseInt(e.expires_in)),this.setUser(void 0)},e.prototype.setNewToken=function(e,t){var n=this.name,r=n+"token",i=n+"tokenExp";if(e)if(pxt.storage.setLocal(r,e),t){var o=Math.round(Date.now()/1e3+.75*t);pxt.storage.setLocal(i,o+"")}else pxt.storage.removeLocal(i);else pxt.storage.removeLocal(r),pxt.storage.removeLocal(i);N()},e.prototype.hasTokenExpired=function(){var e=parseInt(pxt.storage.getLocal(this.name+"tokenExp")||"0");return!(!e||e<v.nowSeconds())},e.prototype.logout=function(){pxt.storage.removeLocal(this.name+"token"),pxt.storage.removeLocal(this.name+"tokenExp"),pxt.storage.removeLocal(this.name+"AutoLogin"),this.setUser(void 0),N()},e}();c.ProviderBase=l,c.reconstructMeta=function(e){var t=JSON.parse(e[pxt.CONFIG_NAME]),n={meta:{cloudId:pxt.CLOUD_ID+pxt.appTarget.id,editor:pxt.BLOCKS_PROJECT_NAME,name:t.name},source:JSON.stringify(e)},r=JSON.parse(e[b]||"{}");return r&&(r.editor&&(n.meta.editor=r.editor),r.target&&(n.meta.cloudId=pxt.CLOUD_ID+r.target),r.targetVersion&&(n.meta.targetVersions={target:r.targetVersion})),n};var p=e("./onedrive"),_=e("./googledrive"),w=e("./githubprovider");function k(){if(!n){n={};var t=pxt.appTarget.cloud;if(t&&t.cloudProviders&&[new p.Provider,new _.Provider].filter(function(e){return!!t.cloudProviders[e.name]}).forEach(function(e){return n[e.name]=e}),t&&t.githubPackages){var e=new w.GithubProvider;n[e.name]=e}}return pxt.Util.values(n)}function x(){return k().filter(function(e){return e.hasSync()}).map(function(e){return e})}function E(){return k().filter(function(e){return e.name==w.PROVIDER_NAME})[0]}function C(e){e!==i&&(i=e,N())}function S(a,s){return d(this,void 0,void 0,function(){var t,n,r,i,o;return f(this,function(e){switch(e.label){case 0:return t={},s.saveId=t,[4,g.getTextAsync(s.id)];case 1:n=e.sent(),(n=v.flatClone(n))[b]=JSON.stringify(s,null,4),r=null==s.blobId,e.label=2;case 2:return e.trys.push([2,4,,5]),[4,a.uploadAsync(s.blobId,s.blobVersion,n)];case 3:return i=e.sent(),[3,5];case 4:if(409==(o=e.sent()).statusCode)return h.warningNotification(y("Conflict saving {0}; please do a full cloud sync",s.name)),[2];throw o;case 5:return pxt.debug("synced up "+i.id),r?s.blobId=i.id:v.assert(s.blobId==i.id),s.blobVersion=i.version,s.saveId===t&&(s.blobCurrent=!0),[4,g.saveAsync(s,null,!0)];case 6:return e.sent(),[2]}})})}function T(r){return r?r.user()?Promise.resolve():r.getUserInfoAsync().then(function(e){if(!e)return Promise.resolve();if(r.hasSync()){var t=r.name+":"+e.id,n=pxt.storage.getLocal("cloudId");if(n&&n!=t)return h.confirmAsync({header:y("Sign in mismatch"),body:y("You have previously signed in with a different account. You can sign out now, which will locally clear all projects, or you can try to sign in again."),agreeClass:"red",agreeIcon:"sign out",agreeLbl:y("Sign out"),disagreeLbl:y("Sign in again"),disagreeIcon:"user circle"}).then(function(e){e?g.resetAsync().then(function(){location.hash="#reload",location.reload()}):console.log("Show the cloud sign in dialog")}),new Promise(function(){});pxt.storage.setLocal("cloudId",t)}return e.initials||(e.initials=function(e){if(!e)return"?";var t=e.match(/\b\w/g)||[];return((t.shift()||"")+(t.pop()||"")).toUpperCase()}(e.name)),r.setUser(e),null}):Promise.resolve()}function A(e){e!=o&&(o=e,r.invalidate("sync:status"))}function N(){r.invalidate("sync:status"),r.invalidate("sync:user"),r.invalidate("sync:loggedin"),r.invalidate("sync:hascloud"),r.invalidate("sync:hassync"),r.invalidate("sync:provider"),r.invalidate("sync:providericon"),r.invalidate("github:user")}c.providers=x,c.githubProvider=E,c.ensureGitHubTokenAsync=function(){return d(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,E().loginAsync()];case 1:return e.sent(),pxt.github.token||v.userError(y("Please sign in to GitHub to perform this operation.")),[2]}})})},c.setProvider=C,c.renameAsync=function(n,r){return d(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:t=i&&i.hasSync()&&i,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t.updateAsync(n.blobId,r)];case 2:case 3:return e.sent(),[3,4];case 4:return[2]}})})},c.resetAsync=function(){return i&&i.logout(),i=null,pxt.storage.removeLocal("cloudId"),u(),N(),Promise.resolve()},c.refreshToken=function(){i&&i.loginAsync(void 0,!0).done()},c.syncAsync=function(){return Promise.all([(e=E(),e?T(e):Promise.resolve()),function(){if(!i)return Promise.resolve(void 0);if(!i.hasSync())return T(i);var o=i,n=0,a=0,s={};function l(e){return pxt.debug("uninstall local "+e.blobId),e.isDeleted=!0,e.blobVersion="DELETED",e.blobCurrent=!1,g.saveAsync(e,null,!0)}function c(r,e){var i=r;i||(i={blobId:e.id}),a++,v.assert(i.blobId==e.id);var t=e.version;return pxt.debug("sync down "+i.blobId+" - "+t),o.downloadAsync(e.id).catch(h.handleNetworkError).then(function(e){v.assert(e.id==i.blobId);var t=e.content,n=JSON.parse(t[b]||"{}");return delete t[b],i.cloudSync=!0,i.blobCurrent=!0,i.blobVersion=e.version,i.name=n.name||i.name||"???",i.id=i.id||n.id||v.guidGen(),i.pubId=n.pubId,i.pubCurrent=n.pubCurrent,delete i.isDeleted,i.saveId=null,i.target=pxt.appTarget.id,i.recentUse=n.recentUse,i.modificationTime=n.modificationTime,i.modificationTime||(i.modificationTime=e.updatedAt||v.nowSeconds()),i.recentUse||(i.recentUse=i.modificationTime),s[i.blobId]=1,r?g.saveAsync(i,t,!0):g.importAsync(i,t,!0)}).then(function(){return u(--a)})}function r(e){h.infoNotification(e)}function u(e){var t="";0==a&&0==n?t=y("All synced"):(t=y("Syncing")+" (",a&&(t+=y("{0} down",a)),n&&(t+=(a?", ":"")+y("{0} up",n)),t+=")"),r(t)}function p(e){return n++,S(o,e).then(function(){return u(--n)})}return A("syncing"),T(o).then(function(){return o.listAsync()}).then(function(e){var t=g.getHeaders(!0),r=v.toDictionary(e,function(e){return e.id}),n=v.toDictionary(t.filter(function(e){return e.blobId}),function(e){return e.blobId}),i=t.filter(function(e){return e.cloudSync}).map(function(e){if(r.hasOwnProperty(e.blobId)){var t=r[e.blobId];return e.isDeleted?(console.log("deleted header: "+e.id),n=e,o.deleteAsync(n.blobId).then(function(){return l(n)})):t.version==e.blobVersion?e.blobCurrent?Promise.resolve():(console.log("might have synced up: ",e.name),p(e)):e.blobCurrent?(console.log("might have synced down: ",e.name),c(e,t)):(console.log("there's a conflict with these two: ",e,t),function(r,i){return d(this,void 0,void 0,function(){var t,n;return f(this,function(e){switch(e.label){case 0:return[4,g.getTextAsync(r.id)];case 1:return t=e.sent(),[4,g.duplicateAsync(r,t,!0)];case 2:return n=e.sent(),r.blobId=null,r.blobVersion=null,r.blobCurrent=!1,[4,g.saveAsync(r,t)];case 3:return e.sent(),[4,c(n,i)];case 4:return e.sent(),[2]}})})}(e,t))}return e.blobVersion?l(e):(console.log("might have synced up: ",e.name),p(e));var n});return i=i.concat(e.filter(function(e){return!n[e.id]}).map(function(e){return c(null,e)})),u(),Promise.all(i)}).then(function(){A(""),r(y("Syncing done"))}).then(function(){return m.notifySyncDone(s)}).catch(function(e){e.isSyncError?e.isLoginError||h.warningNotification(e.message):h.handleNetworkError(e)})}()]).then(function(){});var e},c.loginCheck=function(){var e=k();if(e.length){var t;if((t=h.parseQueryString(pxt.storage.getLocal(c.OAUTH_HASH)||"")).access_token){var n=pxt.storage.getLocal(c.OAUTH_TYPE);(l=e.filter(function(e){return e.name==n})[0])&&(pxt.storage.removeLocal(c.OAUTH_HASH),l.loginCallback(t)),u()}if((t=h.parseQueryString((location.hash||"#").slice(1).replace(/%23access_token/,"access_token"))).access_token){var r=pxt.storage.getLocal(c.OAUTH_STATE),i=pxt.storage.getLocal(c.OAUTH_TYPE);if(r&&r==t.state&&(pxt.storage.removeLocal(c.OAUTH_STATE),pxt.storage.removeLocal(c.OAUTH_TYPE),l=e.filter(function(e){return e.name==i})[0])){l.loginCallback(t);var o=pxt.storage.getLocal(c.OAUTH_REDIRECT)||"";location.hash=o}u()}for(var a=0,s=e;a<s.length;a++){var l;(l=s[a]).loginCheck()}}},c.saveToCloudAsync=function(e){return i&&i.hasSync()&&i?S(i,e):Promise.resolve()},r.mountVirtualApi("sync",{getSync:function(e){var t=i;switch(r.stripProtocol(e)){case"user":return t&&t.user();case"loggedin":return!!t;case"status":return o;case"hascloud":return 0<x().length;case"hassync":return t&&t.hasSync();case"provider":return t&&t.name;case"providericon":if(t)return t.icon;var n=x();return 1==n.length?n[0].icon:"user"}return null}}),r.mountVirtualApi("github",{getSync:function(e){var t=E();switch(r.stripProtocol(e)){case"user":return t&&t.user()}return null}})},{"./core":41,"./data":44,"./githubprovider":61,"./googledrive":63,"./onedrive":80,"./package":81,"./workspace":105}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./core"),r=e("./electron"),s=e("./package"),i=e("./hidbridge"),o=e("./webusb"),l=pxt.Cloud,c=!1;function u(e,t,n){return pxt.BrowserUtils.browserDownloadBinText(e,t,n,void 0,function(e){return a.errorNotification(lf("saving file failed..."))}),Promise.resolve()}function p(e){var t="",n=pxt.outputName().replace(/[^.]*/,""),r=e.outfiles[pxt.outputName()],i=s.genFileName(n),o=pxt.BrowserUtils.isBrowserDownloadWithinUserContext();return o?t=pxt.BrowserUtils.toDownloadDataUri(pxt.isOutputText()?ts.pxtc.encodeBase64(r):r,pxt.appTarget.compile.hexMimeType):pxt.isOutputText()?(pxt.debug("saving "+i),t=pxt.BrowserUtils.browserDownloadBinText(r,i,pxt.appTarget.compile.hexMimeType,e.userContextWindow,function(e){return a.errorNotification(lf("saving file failed..."))})):(pxt.debug("saving "+i),t=pxt.BrowserUtils.browserDownloadBase64(r,i,"application/x-uf2",e.userContextWindow,function(e){return a.errorNotification(lf("saving file failed..."))})),e.success?e.saveOnly&&o?pxt.commands.showUploadInstructionsAsync(i,t,a.confirmAsync):e.saveOnly||pxt.BrowserUtils.isBrowserDownloadInSameWindow()&&!o?Promise.resolve():pxt.commands.showUploadInstructionsAsync(i,t,a.confirmAsync):Promise.resolve()}function d(e,t,n){var r=pxt.appTarget.appTheme.boardName||lf("device"),i=pxt.appTarget.appTheme.driveDisplayName||pxt.appTarget.compile.driveName||"???",o=pxt.BrowserUtils.isBrowserDownloadWithinUserContext(),a=!pxt.BrowserUtils.isIE()&&!pxt.BrowserUtils.isEdge(),s=pxt.appTarget.appTheme.usbDocs,l=pxt.BrowserUtils.hasSaveAs(),c=pxt.appTarget.compile.useUF2?".uf2":".hex",u=o?lf("Click 'Download' to open the {0} app.",pxt.appTarget.appTheme.boardName):l?lf("Click 'Save As' and save the {0} file to the {1} drive to transfer the code into your {2}.",c,i,r):lf("Move the {0} file to the {1} drive to transfer the code into your {2}.",c,i,r),p=pxt.BrowserUtils.isBrowserDownloadWithinUserContext()?0:1e4;return n({header:o?lf("Download ready..."):lf("Download completed..."),body:u,hasCloseIcon:!0,hideCancel:!0,hideAgree:!0,buttons:[a?{label:o?lf("Download"):lf("Click to download again"),icon:"download",class:o?"primary":"lightgrey",url:t,fileName:e}:void 0,s?{label:lf("Help"),icon:"help",class:"lightgrey",url:s}:void 0],timeout:p}).then(function(){})}function f(){var t=window.webkit;if(t&&t.messageHandlers&&t.messageHandlers.host&&t.messageHandlers.host.postMessage)return function(e){return t.messageHandlers.host.postMessage(e)};var n=window.android;return n&&n.postMessage?function(e){return n.postMessage(JSON.stringify(e))}:void 0}function h(){return!!f()}function m(e){pxt.debug("native deploy"),a.infoNotification(lf("Flashing device..."));var t=e.outfiles[pxt.outputName()];return f()({name:e.downloadFileBaseName,download:t}),Promise.resolve()}function g(e){pxt.debug("native save"),a.infoNotification(lf("Saving file..."));var t=e.outfiles[pxt.outputName()];return f()({name:e.downloadFileBaseName,save:t}),Promise.resolve()}function v(n,r){if(pxt.tickEvent("hid.deploy"),!n.success)return p(n);a.infoNotification(lf("Downloading..."));var e=n.outfiles[pxtc.BINARY_UF2],t=pxtc.UF2.parseFile(pxt.Util.stringToUint8Array(atob(e)));return i.initAsync().then(function(e){return e.reflashAsync(t)}).catch(function(e){var t=pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.appFlashingTroubleshoot;return"repairbootloader"===e.type?a.confirmAsync({header:lf("Just one more time..."),body:lf("You need to pair the board again, now in bootloader mode. We know..."),agreeLbl:lf("Ok, pair!")}).then(function(e){return pxt.usb.pairAsync()}).then(function(){return v(n)}):"devicenotfound"===e.type&&r.reportDeviceNotFoundAsync&&t?(pxt.tickEvent("hid.flash.devicenotfound"),r.reportDeviceNotFoundAsync(t,n)):pxt.commands.saveOnlyAsync(n)})}function y(t,e){return v(t,e).timeout(2e4).catch(function(e){return i.disconnectWrapperAsync().catch(function(e){pxt.reportException(e)}).then(function(){return a.confirmAsync({header:lf("Something went wrong..."),body:lf("Flashing your {0} took too long. Please disconnect your {0} from your computer and try reconnecting it.",pxt.appTarget.appTheme.boardName||lf("device")),disagreeLbl:lf("Ok"),hideAgree:!0})}).then(function(){return pxt.commands.saveOnlyAsync(t)})})}function b(e){return pxt.debug("local deployment..."),a.infoNotification(lf("Uploading...")),pxt.Util.requestAsync({url:"/api/deploy",headers:{Authorization:l.localToken},method:"POST",data:e,allowHttpErrors:!0}).then(function(e){200!==e.statusCode?a.errorNotification(lf("There was a problem, please try again")):0===e.json.boardCount&&a.warningNotification(lf("Please connect your {0} to your computer and try again",pxt.appTarget.appTheme.boardName))})}function _(){pxt.onAppTargetChanged=function(){pxt.debug("app target changed"),_()},pxt.commands.browserDownloadAsync=u,pxt.commands.saveOnlyAsync=p,pxt.commands.showUploadInstructionsAsync=d;var e=/forceHexDownload/i.test(window.location.href);pxt.usb.isAvailable()&&pxt.appTarget.compile.webUSB?(pxt.debug("enabled webusb"),pxt.usb.setEnabled(!0),pxt.HF2.mkPacketIOAsync=pxt.usb.mkPacketIOAsync):(pxt.debug("disabled webusb"),pxt.usb.setEnabled(!1),pxt.HF2.mkPacketIOAsync=i.mkBridgeAsync);var t=pxt.usb.isEnabled&&pxt.appTarget.compile.useUF2;h()?(pxt.debug("deploy: webkit host"),pxt.commands.deployFallbackAsync=m,pxt.commands.saveOnlyAsync=g):t&&pxt.appTarget.appTheme.autoWebUSBDownload?(pxt.debug("deploy: webusb"),pxt.commands.deployFallbackAsync=o.webUsbDeployCoreAsync):pxt.winrt.isWinRT()?(pxt.appTarget.serial&&pxt.appTarget.serial.useHF2?(pxt.debug("deploy: winrt"),pxt.winrt.initWinrtHid(function(){return i.initAsync(!0).then(function(){})},function(){return i.disconnectWrapperAsync()}),pxt.HF2.mkPacketIOAsync=pxt.winrt.mkPacketIOAsync,pxt.commands.deployFallbackAsync=y):(pxt.debug("deploy: winrt + custom deploy"),pxt.winrt.initWinrtHid(null,null),pxt.appTarget.serial&&pxt.appTarget.serial.rawHID&&(pxt.HF2.mkPacketIOAsync=pxt.winrt.mkPacketIOAsync),pxt.commands.deployFallbackAsync=pxt.winrt.driveDeployCoreAsync),pxt.commands.browserDownloadAsync=pxt.winrt.browserDownloadAsync,pxt.commands.saveOnlyAsync=function(e){return pxt.winrt.saveOnlyAsync(e).then(function(e){e&&a.infoNotification(lf("file saved!"))}).catch(function(e){return a.errorNotification(lf("saving file failed..."))})}):pxt.BrowserUtils.isPxtElectron()?(pxt.debug("deploy: electron"),pxt.commands.deployCoreAsync=r.driveDeployAsync,pxt.commands.electronDeployAsync=r.driveDeployAsync):c&&t||!t&&i.shouldUse()&&!pxt.appTarget.serial.noDeploy&&!e?(pxt.debug("deploy: hid"),pxt.commands.deployFallbackAsync=v):pxt.BrowserUtils.isLocalHost()&&l.localToken&&!e?(pxt.debug("deploy: localhost"),pxt.commands.deployFallbackAsync=b):(pxt.debug("deploy: browser"),pxt.commands.deployFallbackAsync=t?k:p)}function w(e){c!==e&&(c=e,_())}function k(t){return pxt.usb.isPairedAsync().then(function(e){return e?(w(!0),v(t)):p(t)})}n.browserDownloadDeployCoreAsync=p,n.nativeHostPostMessageFunction=f,n.isNativeHost=h,n.hidDeployCoreAsync=v,n.init=_,n.setWebUSBPaired=w},{"./core":41,"./electron":55,"./hidbridge":65,"./package":81,"./webusb":104}],13:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var d=e("react"),f=e("./sui"),o=e("./data"),h=pxt.Util.repeatMap,a=function(n){function r(e){var t=n.call(this,e)||this;return t.state={},t}return i(r,n),r.setupIntersectionObserver=function(){var r=this;this.observer||(this.observer=new IntersectionObserver(function(e){e.forEach(function(e){var t,n;0<e.intersectionRatio&&(r.observer.unobserve(e.target),n=(t=e.target).getAttribute("data-src"),t.style.backgroundImage="url("+n+")")})},{rootMargin:"50px 0px",threshold:.01}))},r.prototype.componentDidMount=function(){var e=this.refs.lazyimage;if(e)if("IntersectionObserver"in window)r.setupIntersectionObserver(),r.observer.observe(e);else{var t=e.getAttribute("data-src");e.style.backgroundImage="url("+t+")"}},r.prototype.renderCore=function(){var n=this.props,e=n.color||"";e||(n.hardware&&!n.software?e="black":n.software&&!n.hardware&&(e="teal"));var t=n.url?/^[^:]+:\/\//.test(n.url)?n.url:"/"+n.url.replace(/^\.?\/?/,""):void 0,r=t&&/^\//.test(t)?"#doc:"+t:t,i=n.className,o=n.cardType,a=n.tutorialLength==n.tutorialStep+1,s=n.ariaLabel||n.title||n.shortName||n.name,l=n&&n.description&&n.description.split("\n"),c=n.onClick?function(e){e.target&&"A"==e.target.tagName||(pxt.analytics.enableCookies(),n.onClick(e))}:void 0,u=n.imageUrl||(n.youTubeId?"https://img.youtube.com/vi/"+n.youTubeId+"/0.jpg":void 0),p=d.createElement("div",{className:"ui card "+e+" "+(n.onClick?"link":"")+" "+(i||""),role:n.role,"aria-selected":"option"===n.role?"true":void 0,"aria-label":s,title:n.title,onClick:c,tabIndex:n.onClick?n.tabIndex||0:null,onKeyDown:n.onClick?f.fireClickOnEnter:null},n.header||n.blocks||n.javascript||n.hardware||n.software||n.any?d.createElement("div",{key:"header",className:"ui content "+(n.responsive?" tall desktop only":"")},d.createElement("div",{className:"right floated meta"},n.any?d.createElement(f.Icon,{key:"costany",icon:"ui grey circular label tiny"},0<n.any?n.any:null," "):null,h(n.blocks,function(e){return d.createElement(f.Icon,{key:"costblocks"+e,icon:"puzzle orange"})}),h(n.javascript,function(e){return d.createElement(f.Icon,{key:"costjs"+e,icon:"align left blue"})}),h(n.hardware,function(e){return d.createElement(f.Icon,{key:"costhardware"+e,icon:"certificate black"})}),h(n.software,function(e){return d.createElement(f.Icon,{key:"costsoftware"+e,icon:"square teal"})})),n.header):null,n.label||n.labelIcon||n.blocksXml||n.typeScript||u||"file"==o?d.createElement("div",{className:"ui image"},n.label||n.labelIcon?d.createElement("label",{role:n.onLabelClicked?"button":void 0,onClick:n.onLabelClicked,className:"ui "+(n.labelClass?n.labelClass:"orange right ribbon")+" label","aria-label":s+" "+(n.onLabelClicked?"button":"label")},n.labelIcon?d.createElement(f.Icon,{icon:n.labelIcon}):n.label):void 0,n.typeScript?d.createElement("pre",{key:"promots"},n.typeScript):void 0,"file"!=n.cardType&&u?d.createElement("div",{className:"ui imagewrapper","aria-hidden":!0,role:"presentation"},d.createElement("div",{className:"ui cardimage","data-src":u,ref:"lazyimage"})):void 0,"file"!=n.cardType||u?void 0:d.createElement("div",{className:"ui fileimage"}),"file"==n.cardType&&u?d.createElement("div",{className:"ui fileimage","data-src":u,ref:"lazyimage"}):void 0):void 0,n.icon||n.iconContent?d.createElement("div",{className:"ui imagewrapper","aria-hidden":!0,role:"presentation"},d.createElement("div",{className:"ui button massive fluid "+n.iconColor+" "+(n.iconContent?"iconcontent":"")},n.icon?d.createElement(f.Icon,{icon:"icon "+n.icon}):void 0,n.iconContent||void 0)):void 0,n.shortName||n.name||l?d.createElement("div",{className:"content"},n.shortName||n.name?d.createElement("div",{className:"header"},n.shortName||n.name):null,l&&l.map(function(e,t){return d.createElement("div",{key:"line"+t,className:"description tall "+(n.icon||n.iconContent||n.imageUrl?"":"long")},e.replace(/`/g,""))})):void 0,n.time?d.createElement("div",{className:"meta"},n.tutorialLength?d.createElement("span",{className:"ui tutorial-progress "+(a?"green":"orange")+" left floated label"},d.createElement("i",{className:(a?"trophy":"circle")+" icon"}),"",lf("{0}/{1}",(n.tutorialStep||0)+1,n.tutorialLength)):void 0,n.time?d.createElement("span",{key:"date",className:"date"},pxt.Util.timeSince(n.time)):null):void 0,n.extracontent||n.learnMoreUrl||n.buyUrl||n.feedbackUrl?d.createElement("div",{className:"ui extra content mobile hide"},n.extracontent,n.buyUrl?d.createElement("a",{className:"learnmore left floated",href:n.buyUrl,"aria-label":lf("Buy"),target:"_blank",rel:"noopener noreferrer"},lf("Buy")):void 0,n.learnMoreUrl?d.createElement("a",{className:"learnmore right floated",href:n.learnMoreUrl,"aria-label":lf("Learn more"),target:"_blank",rel:"noopener noreferrer"},lf("Learn more")):void 0,n.feedbackUrl?d.createElement("a",{className:"learnmore right floated",href:n.feedbackUrl,"aria-label":lf("Feedback"),target:"_blank",rel:"noopener noreferrer"},lf("Feedback")):void 0):void 0);return!n.onClick&&t?d.createElement("div",null,d.createElement("a",{href:t,target:"docs",className:"ui widedesktop hide"},p),d.createElement("a",{href:r,className:"ui widedesktop only"},p)):p},r}(o.Component);n.CodeCardView=a},{"./data":44,"./sui":100,react:284}],14:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((l=l.apply(o,a||[])).next())})},P=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var I=e("./package"),i=e("./core"),a=e("./workspace"),D=pxt.Util;function s(e){var r=I.mainEditorPkg();r.forEachFile(function(e){return e.diagnostics=[]});for(var i="",t=function(t){if(t.fileName){i+=(t.category==ts.pxtc.DiagnosticCategory.Error?lf("error"):t.category==ts.pxtc.DiagnosticCategory.Warning?lf("warning"):lf("message"))+": "+t.fileName+"("+(t.line+1)+","+(t.column+1)+"): ";var e=r.filterFiles(function(e){return e.getTypeScriptName()==t.fileName})[0];e&&e.diagnostics.push(t)}var n=ts.pxtc.DiagnosticCategory[t.category].toLowerCase();i+=n+" TS"+t.code+": "+ts.pxtc.flattenDiagnosticMessageText(t.messageText,"\n")+"\n"},n=0,o=e;n<o.length;n++)t(o[n]);i&&pxt.log(i),i||(i=D.lf("Everything seems fine!\n"));var a=r.outputPkg.setFile("output.txt",i),s=e.filter(function(e){return e.category==ts.pxtc.DiagnosticCategory.Error});a.numDiagnosticsOverride=s.length,function(e){if(e&&e.length){var t={};e.filter(function(e){return e.code}).forEach(function(e){return t[e.code]=(t[e.code]||0)+1});var n=JSON.stringify(e);n!==l&&(pxt.tickEvent("diagnostics",t),l=n)}else l=""}(s)}var l="";var o,c,u,p=new Promise(function(){});function d(t){return function(e){return e.isUserError?(i.errorNotification(e.message),I.mainEditorPkg().outputPkg.setFile("output.txt",e.message).numDiagnosticsOverride=1,t):Promise.reject(e)}}function f(e){return v("assemble",{fileContent:e})}function h(e){return v("compile",{options:e})}function m(e,t,n){return v("decompile",{options:e,fileName:t,generatedVarDeclarations:n})}function g(e,t){return v("pydecompile",{options:e,fileName:t})}function v(t,e){var n=Date.now();return pxt.debug("worker op: "+t),pxt.worker.getWorker(pxt.webConfig.workerjs).opAsync(t,e).then(function(e){return pxt.appTarget.compile.switches.time&&(pxt.log("Worker perf: "+t+" "+(Date.now()-n)+"ms"),e.times&&console.log(e.times)),pxt.debug("worker op done: "+t),e})}n.emptyProgram="(function (ectx) {\n'use strict';\nectx.runtime.setupPerfCounters([]);\nectx.setupDebugger(1)\nreturn function (s) {\n    // START\n    ectx.runtime.kill()\n    return ectx.leave(s, s.r0)\n}\n})\n",n.emptyCompileResult=function(){return{success:!0,diagnostics:[],times:{},breakpoints:[],outfiles:{"binary.js":n.emptyProgram.replace("// START",pxt.appTarget.simulator.emptyRunCode||"")}}},n.compileAsync=function(t){void 0===t&&(t={});var e=I.mainPkg.getTargetOptions();return e.isNative=t.native,I.mainPkg.getCompileOptionsAsync(e).then(function(e){return t.debug&&(e.breakpoints=!0,e.justMyCode=!t.debugExtensionCode,e.testMode=!0),t.trace&&(e.breakpoints=!0,e.justMyCode=!0,e.trace=!0),e.computeUsedSymbols=!0,t.forceEmit&&(e.forceEmit=!0),/test=1/i.test(window.location.href)&&(e.testMode=!0),e}).then(h).then(function(r){var e=I.mainEditorPkg().outputPkg.files[pxtc.BINARY_ASM];return e&&!r.outfiles[pxtc.BINARY_ASM]&&(r.outfiles[pxtc.BINARY_ASM]=e.content),I.mainEditorPkg().outputPkg.setFiles(r.outfiles),s(r.diagnostics),_().then(function(){if(!r.usedSymbols||!c)return r;for(var e=0,t=Object.keys(r.usedSymbols);e<t.length;e++){var n=t[e];r.usedSymbols[n]=D.lookup(c.byQName,n)}return r})}).catch(d(p))},n.assembleAsync=function(e){return f(".startaddr 536887040\n"+e).then(function(t){return f(".startaddr "+(536887296-4*(t.words.length+1))+"\n"+e).then(function(e){return D.assert(e.words.length==t.words.length),e})})},n.py2tsAsync=function(){var e=I.mainPkg.getTargetOptions();return b().then(function(){return I.mainPkg.getCompileOptionsAsync(e)}).then(function(e){return e.target.preferredEditor=pxt.PYTHON_PROJECT_NAME,v("py2ts",{options:e})})},n.completionsAsync=function(e,t,n){return v("getCompletions",{fileName:e,fileContent:n,position:t,runtime:pxt.appTarget.runtime})},n.syntaxInfoAsync=function(e,t,n,r){return v("syntaxInfo",{fileName:t,fileContent:r,position:n,infoType:e})},n.decompileAsync=function(t,n,r,i,o){var e=I.mainPkg.getTargetOptions();return I.mainPkg.getCompileOptionsAsync(e).then(function(e){return e.ast=!0,e.testMode=!0,e.alwaysDecompileOnStart=pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable,m(e,t,o)}).then(function(e){if(e.success&&n&&r&&i){var t=pxt.blocks.layout.patchBlocksFromOldWorkspace(n,r,e.outfiles[i]);e.outfiles[i]=t}return I.mainEditorPkg().outputPkg.setFiles(e.outfiles),s(e.diagnostics),e})},n.decompileBlocksSnippetAsync=function(t,e){var n=I.mainPkg.getTargetOptions();return I.mainPkg.getCompileOptionsAsync(n).then(function(e){return e.fileSystem["main.ts"]=t,e.fileSystem["main.blocks"]="",-1===e.sourceFiles.indexOf("main.ts")&&e.sourceFiles.push("main.ts"),-1===e.sourceFiles.indexOf("main.blocks")&&e.sourceFiles.push("main.blocks"),e.ast=!0,m(e,"main.ts")}).then(function(e){return e.outfiles["main.blocks"]})},n.pyDecompileAsync=function(t){var e=I.mainPkg.getTargetOptions();return I.mainPkg.getCompileOptionsAsync(e).then(function(e){return e.ast=!0,e.testMode=!0,e.alwaysDecompileOnStart=pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable,g(e,t)}).then(function(e){return I.mainEditorPkg().outputPkg.setFiles(e.outfiles),s(e.diagnostics),e})},n.decompilePythonSnippetAsync=function(t){var e=I.mainPkg.getTargetOptions();return I.mainPkg.getCompileOptionsAsync(e).then(function(e){return e.fileSystem["main.ts"]=t,e.fileSystem["main.py"]="",-1===e.sourceFiles.indexOf("main.ts")&&e.sourceFiles.push("main.ts"),-1===e.sourceFiles.indexOf("main.py")&&e.sourceFiles.push("main.py"),e.ast=!0,g(e,"main.ts")}).then(function(e){return e.outfiles["main.py"]})},n.workerOpAsync=v;var y=!1;function b(){return o||w()}function _(){return y||!c?v("apiInfo",{}).then(function(e){if(0!==Object.keys(e).length)return y=!1,ts.pxtc.localizeApisAsync(e,I.mainPkg)}).then(function(e){c=e}):Promise.resolve()}function w(){var e=I.mainPkg.getCompileOptionsAsync().then(function(e){return e.testMode=!0,v("setOptions",{options:e})}).then(function(){return v("allDiags",{})}).then(s).then(_).catch(d(null));return o||(o=e),e}function k(){return b().then(function(){return c})}function x(){if(!u){var t=I.mainPkg.resolveBannedCategories();return function(N,O){return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c,u,p,d,f,h,m,g,v,y,b,_,w,k,x,E,C,S,T,A;return P(this,function(e){switch(e.label){case 0:if(!O)return[2,null];if(!(t=O["libs/"+pxt.appTarget.corepkg]))return[2,null];if(n=N.getAllFiles(),Object.keys(n).some(function(e){return"main.ts"!=e&&-1===e.indexOf("/")&&pxt.Util.endsWith(e,".ts")}))return[2,null];for(r=pxt.appTarget.bundleddirs.map(function(e){var t=pxt.appTarget.bundledpkgs[e.substr(e.lastIndexOf("/")+1)];return t?{dirname:e,files:t,config:JSON.parse(t[pxt.CONFIG_NAME])}:null}).filter(function(e){return e&&e.config}),i=N.pkgAndDeps(),o=[],a=[t],s=0,l=i;s<l.length;s++)if("built"!==(g=l[s]).id&&!g.isTopLevel()){for(c=!1,u=0,p=r;u<p.length;u++)if((d=p[u]).config.name===g.getKsPkg().config.name){a.push(O[d.dirname]),c=!0;break}c||o.push(g)}return o.length?[4,R.createAsync()]:[3,5];case 1:f=e.sent(),h=0,m=o,e.label=2;case 2:return h<m.length?(g=m[h],[4,f.getAsync(g)]):[3,5];case 3:if(!(v=e.sent()))return pxt.debug("Could not find cached API info for "+g.getKsPkg().config.name+", waiting for full compile"),[2,null];pxt.debug("Fetched cached API info for "+g.getKsPkg().config.name),a.push(v),e.label=4;case 4:return h++,[3,2];case 5:for(y={byQName:{},jres:{}},b=0,_=a;b<_.length;b++)(w=_[b])&&(pxt.Util.jsonCopyFrom(y.byQName,w.apis.byQName),w.apis.jres&&pxt.Util.jsonCopyFrom(y.jres,w.apis.jres));for(k=I.mainPkg.getJRes(),x=0,E=Object.keys(y.byQName);x<E.length;x++)C=E[x],S=y.byQName[C],(T=S.attributes.jres)&&("true"==T&&(T=C),(A=D.lookup(k||{},T))&&A.icon&&!S.attributes.iconURL&&(S.attributes.iconURL=A.icon),A&&A.data&&!S.attributes.jresURL&&(S.attributes.jresURL="data:"+A.mimeType+";base64,"+A.data));return[2,y]}})})}(I.mainEditorPkg(),pxt.getBundledApiInfo()).then(function(e){return e?ts.pxtc.localizeApisAsync(e,I.mainPkg).then(function(e){return u=pxtc.getBlocksInfo(e,t)}):k().then(function(e){var t=I.mainPkg.resolveBannedCategories();return u=pxtc.getBlocksInfo(e,t),function(f,h){return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c,u,p,d;return P(this,function(e){switch(e.label){case 0:return t=pxt.Package.corePackages().map(function(e){return e.name}),(n=f.pkgAndDeps().filter(function(e){return"built"!==e.id&&!e.isTopLevel()&&-1===t.indexOf(e.getKsPkg().config.name)})).length?(r=Object.keys(h.byQName),[4,R.createAsync()]):[3,5];case 1:i=e.sent(),o=0,a=n,e.label=2;case 2:if(!(o<a.length))return[3,5];for(s=a[o],l={sha:null,apis:{byQName:{}}},c=s.getKsPkg().config.name,u=0,p=r;u<p.length;u++)d=p[u],h.byQName[d].pkg===c&&(l.apis.byQName[d]=h.byQName[d]);return[4,i.setAsync(s,l)];case 3:e.sent(),pxt.debug("Stored API info for "+s),e.label=4;case 4:return o++,[3,2];case 5:return[2]}})})}(I.mainEditorPkg(),e)}).then(function(){return u})})}return Promise.resolve(u)}function E(){var r,e=I.mainPkg,t=I.getEditorPkg(e),i=t.header.targetVersion,o=t.files["main.blocks"]?t.files["main.blocks"].content:'<block type="'+ts.pxtc.ON_START_TYPE+'"></block>',a={};return pxt.debug("Applying upgrades to blocks"),pxt.BrowserUtils.loadBlocklyAsync().then(function(){return x()}).then(function(e){r=new Blockly.Workspace;var t=pxt.blocks.importXml(i,o,e,!0),n=Blockly.Xml.textToDom(t);return pxt.blocks.domToWorkspaceNoEvents(n,r),a["main.blocks"]=t,pxt.blocks.compileAsync(r,e)}).then(function(e){return a["main.ts"]=e.source,S(a)}).then(function(){return{success:!0,editor:pxt.BLOCKS_PROJECT_NAME,patchedFiles:a}}).catch(function(){return pxt.debug("Block upgrade failed, falling back to TS"),C()})}function C(){var e=I.mainPkg,t=I.getEditorPkg(e),n=t.header.targetVersion,r={};return pxt.Util.values(t.files).filter(T).forEach(function(e){var t=pxt.patching.patchJavaScript(n,e.content);t!=e.content&&(r[e.name]=t)}),pxt.debug("Applying upgrades to TypeScript"),S(r).then(function(){return{success:!0,editor:pxt.JAVASCRIPT_PROJECT_NAME,patchedFiles:r}}).catch(function(e){return{success:!1,errorCodes:e.errorCodes}})}function S(n){return I.mainPkg.getCompileOptionsAsync().then(function(t){return n&&Object.keys(t.fileSystem).forEach(function(e){n[e]&&(t.fileSystem[e]=n[e])}),h(t)}).then(function(e){if(!e.success){var n={};e.diagnostics&&e.diagnostics.forEach(function(e){var t="TS"+e.code;n[t]=(n[t]||0)+1});var t=new Error("Compile failed on updated package");return t.errorCodes=n,Promise.reject(t)}return Promise.resolve()})}function T(e){return pxt.Util.endsWith(e.getName(),".ts")}function A(){return N(),v("reset",{})}function N(){u=c=o=null}function O(e){var t=JSON.stringify(e.getAllFiles())+pxt.appTarget.versions.pxt+"_"+pxt.appTarget.versions.target;return pxtc.U.sha256(t)}function L(e){return e.getKsPkg().config.name}n.apiSearchAsync=function(e){return _().then(function(){return e.localizedApis=c,e.localizedStrings=pxt.Util.getLocalizedStrings(),v("apiSearch",{search:e,blocks:function(){var e=I.mainPkg.resolveBannedCategories();if(e)return{bannedCategories:e}}()})})},n.projectSearchAsync=function(e){return _().then(function(){return v("projectSearch",{projectSearch:e})})},n.projectSearchClear=function(){return _().then(function(){return v("projectSearchClear",{})})},n.formatAsync=function(e,t){return v("format",{format:{input:e,pos:t}})},n.snippetAsync=function(e,t){return v("snippet",{snippet:{qName:e,python:t},runtime:pxt.appTarget.runtime}).then(function(e){return e})},n.typecheckAsync=w,n.getApisInfoAsync=k,n.getBlocksAsync=x,n.applyUpgradesAsync=function(){var e=I.mainPkg,i=I.getEditorPkg(e),t=pxt.semver.parse(i.header.targetVersion||"0.0.0"),n=pxt.semver.parse(pxt.appTarget.versions.target);if(t.major===n.major&&t.minor===n.minor)return pxt.debug("Skipping project upgrade"),Promise.resolve({success:!0});var r=i.header.editor!==pxt.BLOCKS_PROJECT_NAME?C:E,o=!1;return S().catch(function(){return o=!0}).then(r).then(function(e){return e.success?(pxt.tickEvent("upgrade.success",{projectEditor:i.header.editor,upgradedEditor:e.editor,preUpgradeVersion:i.header.targetVersion||"unknown",projectNeverCompiled:""+o}),pxt.debug("Upgrade successful!"),(t=i,n=e.patchedFiles,r=e.editor,Object.keys(n).forEach(function(e){return t.setFile(e,n[e])}),t.header.targetVersion=pxt.appTarget.versions.target,t.header.editor=r,t.saveFilesAsync()).then(function(){return e})):(pxt.tickEvent("upgrade.failed",{projectEditor:i.header.editor,preUpgradeVersion:i.header.targetVersion||"unknown",errors:JSON.stringify(e.errorCodes),projectNeverCompiled:""+o}),pxt.debug("Upgrade failed; bailing out and leaving project as-is"),Promise.resolve(e));var t,n,r})},n.updatePackagesAsync=function(t,n){var r,i=I.mainEditorPkg(),o=0;return n&&n.startOperation(),a.getTextAsync(i.header.id).then(function(e){return a.makeBackupAsync(i.header,e)}).then(function(e){return r=e,i.header.backupRef=r.id,a.saveAsync(i.header)}).then(function(){return Promise.each(t,function(e){return n&&n.throwIfCancelled(),i.updateDepAsync(e.getPkgId()).then(function(){++o,n&&!n.isCancelled()&&n.reportProgress(o,t.length)})})}).then(function(){return I.loadPkgAsync(i.header.id)}).then(function(){return A()}).then(function(){return S()}).then(function(){return n&&n.throwIfCancelled(),delete i.header.backupRef,a.saveAsync(i.header)}).then(function(){return!0}).catch(function(){return a.restoreFromBackupAsync(i.header).then(function(){return!1})}).finally(function(){var e=Promise.resolve();return r&&(r.isDeleted=!0,e=a.saveAsync(r)),e.finally(function(){n&&n.resolveCancel()})})},n.newProjectAsync=A,n.clearCaches=N,n.getPackagesWithErrors=function(){var t={},e=I.mainEditorPkg();if(e){var n=pxt.Package.corePackages().map(function(e){return e.name});e.forEachFile(function(e){e.diagnostics&&e.diagnostics.length&&e.epkg&&-1===n.indexOf(e.epkg.getPkgId())&&!e.epkg.isTopLevel()&&e.diagnostics.some(function(e){return e.category===ts.pxtc.DiagnosticCategory.Error})&&(t[e.epkg.getPkgId()]=e.epkg)})}return pxt.Util.values(t)};var R=function(){function r(e){this.db=e}return r.dbName=function(){return"__pxt_apis_"+(pxt.appTarget.id||"")},r.createAsync=function(){function t(){var e=new pxt.BrowserUtils.IDBWrapper(r.dbName(),2,function(e,t){t.result.createObjectStore(r.TABLE,{keyPath:r.KEYPATH})},function(){pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(r.dbName())});return e.openAsync().then(function(){return new r(e)})}return t().catch(function(e){return console.log("db: failed to open api database, try delete entire store..."),pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(r.dbName()).then(function(){return t()})})},r.prototype.getAsync=function(e){var t=L(e),n=O(e);return this.db.getAsync(r.TABLE,t).then(function(e){if(e&&e.hash===n)return e.apis})},r.prototype.setAsync=function(e,t){pxt.perf.measureStart("compiler db setAsync");var n={id:L(e),hash:O(e),apis:t};return this.db.setAsync(r.TABLE,n).then(function(){pxt.perf.measureEnd("compiler db setAsync")})},r.TABLE="files",r.KEYPATH="id",r}()},{"./core":41,"./package":81,"./workspace":105}],15:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var h=e("react"),o=e("react-redux"),a=e("./actions/dispatch"),m=e("./Button"),s=function(t){function e(e){var s=t.call(this,e)||this;return s.handleWidthChange=function(e){var t=e.target.value,n=parseInt(t),r=s.props,i=r.aspectRatioLocked,o=r.imageDimensions;!isNaN(n)&&i?s.setState({width:n+"",height:Math.floor(n*(o[1]/o[0]))+""}):s.setState({width:t})},s.handleHeightChange=function(e){var t=e.target.value,n=parseInt(t),r=s.props,i=r.aspectRatioLocked,o=r.imageDimensions;!isNaN(n)&&i?s.setState({height:n+"",width:Math.floor(n*(o[0]/o[1]))+""}):s.setState({height:t})},s.handleDimensionalBlur=function(){var e=s.props,t=e.imageDimensions,n=e.dispatchChangeImageDimensions,r=parseInt(s.state.width),i=parseInt(s.state.height),o=isNaN(r)?t[0]:Math.min(Math.max(r,1),999),a=isNaN(i)?t[1]:Math.min(Math.max(i,1),999);o===t[0]&&a===t[1]||n([o,a]),s.setState({width:null,height:null})},s.zoomIn=function(){s.props.dispatchChangeZoom(1)},s.zoomOut=function(){s.props.dispatchChangeZoom(-1)},s.state={},s}return i(e,t),e.prototype.render=function(){var e=this.props,t=e.imageDimensions,n=e.cursorLocation,r=e.hasUndo,i=e.hasRedo,o=e.dispatchUndoImageEdit,a=e.dispatchRedoImageEdit,s=e.aspectRatioLocked,l=e.onionSkinEnabled,c=e.dispatchToggleAspectRatioLocked,u=e.dispatchToggleOnionSkinEnabled,p=(e.dispatchChangeZoom,e.singleFrame),d=null==this.state.width?t[0]:this.state.width,f=null==this.state.height?t[1]:this.state.height;return h.createElement("div",{className:"image-editor-bottombar"},h.createElement("div",{className:"image-editor-resize"},h.createElement("input",{className:"image-editor-input",title:lf("Image Width"),value:d,onChange:this.handleWidthChange,onBlur:this.handleDimensionalBlur}),h.createElement(m.IconButton,{onClick:c,iconClass:s?"ms-Icon ms-Icon--Lock":"ms-Icon ms-Icon--Unlock",title:s?lf("Unlock Aspect Ratio"):lf("Lock Aspect Ratio"),toggle:!s}),h.createElement("input",{className:"image-editor-input",title:lf("Image Height"),value:f,onChange:this.handleHeightChange,onBlur:this.handleDimensionalBlur})),!p&&h.createElement("div",{className:"image-editor-seperator"}),!p&&h.createElement("div",null,h.createElement(m.IconButton,{onClick:u,iconClass:"ms-Icon ms-Icon--MapLayers",title:l?lf("Hide Previous Frame"):lf("Show Previous Frame"),toggle:!l})),n&&h.createElement("div",{className:"image-editor-seperator"}),h.createElement("div",{className:"image-editor-coordinate-preview"},n&&n[0]+", "+n[1]),h.createElement("div",{className:"image-editor-undo-redo"},h.createElement(m.IconButton,{title:lf("Undo"),iconClass:"ms-Icon ms-Icon--Undo",onClick:r?o:null,disabled:!r}),h.createElement(m.IconButton,{title:lf("Redo"),iconClass:"ms-Icon ms-Icon--Redo",onClick:i?a:null,disabled:!i})),h.createElement("div",{className:"image-editor-seperator"}),h.createElement("div",{className:"image-editor-zoom-controls"},h.createElement(m.IconButton,{onClick:this.zoomOut,iconClass:"ms-Icon ms-Icon--ZoomOut",title:lf("Zoom Out"),toggle:!0}),h.createElement(m.IconButton,{onClick:this.zoomIn,iconClass:"ms-Icon ms-Icon--ZoomIn",title:lf("Zoom In"),toggle:!0})))},e}(h.Component);n.BottomBarImpl=s;var l={dispatchChangeImageDimensions:a.dispatchChangeImageDimensions,dispatchUndoImageEdit:a.dispatchUndoImageEdit,dispatchRedoImageEdit:a.dispatchRedoImageEdit,dispatchToggleAspectRatioLocked:a.dispatchToggleAspectRatioLocked,dispatchToggleOnionSkinEnabled:a.dispatchToggleOnionSkinEnabled,dispatchChangeZoom:a.dispatchChangeZoom};n.BottomBar=o.connect(function(e,t){var n=e.store,r=n.present,i=n.past,o=n.future,a=e.editor;if(!r)return{};var s=a.isTilemap?r.tilemap.bitmap:r.frames[r.currentFrame].bitmap;return{imageDimensions:[s.width,s.height],aspectRatioLocked:r.aspectRatioLocked,onionSkinEnabled:a.onionSkinEnabled,cursorLocation:a.cursorLocation,hasUndo:!!i.length,hasRedo:!!o.length}},l)(s)},{"./Button":16,"./actions/dispatch":27,react:284,"react-redux":263}],16:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("react"),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.title,n=e.iconClass,r=e.onClick,i=e.toggle,o=e.disabled;return a.createElement("div",{role:"button",className:"image-editor-button "+(i?"toggle":"")+" "+(o?"disabled":""),title:t,onClick:r},a.createElement("span",{className:n}))},t}(a.Component);n.IconButton=o},{react:284}],17:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./actions/dispatch"),s=e("react-redux"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handlers=[],e}return i(e,t),e.prototype.render=function(){var e=this.props.selected;return o.createElement("div",{className:"cursor-buttons"},o.createElement("div",{className:"cursor-button-outer "+(1===e?"selected":""),title:lf("Small Cursor (1px)"),role:"button",onClick:this.clickHandler(1)},o.createElement("div",{className:"cursor-button small"})),o.createElement("div",{className:"cursor-button-outer "+(3===e?"selected":""),title:lf("Medium Cursor (3px)"),role:"button",onClick:this.clickHandler(3)},o.createElement("div",{className:"cursor-button medium"})),o.createElement("div",{className:"cursor-button-outer "+(5===e?"selected":""),title:lf("Large Cursor (5px)"),role:"button",onClick:this.clickHandler(5)},o.createElement("div",{className:"cursor-button large"})))},e.prototype.clickHandler=function(e){var t=this;return this.handlers[e]||(this.handlers[e]=function(){(0,t.props.dispatchChangeCursorSize)(e)}),this.handlers[e]},e}(o.Component);var c={dispatchChangeCursorSize:a.dispatchChangeCursorSize};n.CursorSizes=s.connect(function(e,t){var n=e.editor;return n?{selected:n.cursorSize}:{}},c)(l)},{"./actions/dispatch":27,react:284,"react-redux":263}],18:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("react"),o=function(n){function e(e){var t=n.call(this,e)||this;return t.handlers=[],t.handleDropdownClick=function(){t.setState({open:!t.state.open})},t.state={open:!1},t}return i(e,n),e.prototype.componentDidUpdate=function(){this.handlers=[]},e.prototype.componentWillUnmount=function(){this.handlers=null},e.prototype.render=function(){var n=this,e=this.props,t=e.options,r=e.selected,i=this.state.open,o=t[r];return a.createElement("div",{className:"image-editor-dropdown-outer"},a.createElement("button",{className:"image-editor-dropdown","aria-haspopup":"listbox",onClick:this.handleDropdownClick},o.text,a.createElement("span",{className:"image-editor-dropdown-chevron ms-Icon ms-Icon--ChevronDown"})),a.createElement("ul",{tabIndex:-1,role:"listbox","aria-activedescendant":o.id,className:i?"":"hidden"},t.map(function(e,t){return a.createElement("li",{key:e.id,role:"option","aria-selected":t===r,className:t===r?"selected":"",onClick:n.clickHandler(t)},e.text)})))},e.prototype.clickHandler=function(e){var t=this;if(!this.handlers[e]){var n=this.props,r=n.onChange,i=n.options;this.handlers[e]=function(){t.setState({open:!1}),r(i[e],e)}}return this.handlers[e]},e}(a.Component);n.Dropdown=o},{react:284}],19:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("react-redux"),v=e("./store/imageReducer"),s=e("./actions/dispatch"),l=e("./util"),y=e("./toolDefinitions"),c=pxt.BrowserUtils.isEdge()?25:1,u=[v.TileDrawingMode.Wall],p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cursor=y.ToolCursor.Crosshair,t.zoom=2.5,t.panX=0,t.panY=0,t.tileCache=[],t.onKeyDown=function(e){if(!e.repeat){switch(t.lastTool=t.props.tool,e.keyCode){case 18:t.props.dispatchChangeImageTool(v.ImageEditorTool.ColorSelect),e.preventDefault();break;case 32:t.props.dispatchChangeImageTool(v.ImageEditorTool.Pan);break;default:t.lastTool=null}t.updateCursor(!1,!1)}},t.onKeyUp=function(e){null!=t.lastTool&&(t.props.dispatchChangeImageTool(t.lastTool),t.lastTool=null,t.updateCursor(!1,!1))},t.preventContextMenu=function(e){return e.preventDefault()},t}return i(t,e),t.prototype.render=function(){var n=this,e=this.getImageState(),t=!e||e.bitmap.height>e.bitmap.width;return o.createElement("div",{ref:"canvas-bounds",className:"image-editor-canvas "+(t?"portrait":"landscape"),onContextMenu:this.preventContextMenu},o.createElement("div",{className:"paint-container"},o.createElement("canvas",{ref:"paint-surface-bg",className:"paint-surface"}),o.createElement("canvas",{ref:"paint-surface",className:"paint-surface"}),u.map(function(e,t){return o.createElement("canvas",{ref:"paint-surface-"+e.toString(),className:"paint-surface overlay "+(n.props.overlayEnabled?"":"hide"),key:t})}),o.createElement("div",{ref:"floating-layer-border",className:"image-editor-floating-layer"})))},t.prototype.componentDidMount=function(){var t=this;this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:c,this.canvas=this.refs["paint-surface"],this.background=this.refs["paint-surface-bg"],this.floatingLayer=this.refs["floating-layer-border"],this.canvasLayers=u.map(function(e){return t.refs["paint-surface-"+e.toString()]}),l.bindGestureEvents(this.refs["canvas-bounds"],this);var e=this.refs["canvas-bounds"];e.addEventListener("wheel",function(e){t.updateZoom(e.deltaY/30,e.clientX,e.clientY),e.preventDefault()}),e.addEventListener("mousemove",function(e){t.edit||t.updateCursorLocation(e)}),e.addEventListener("mouseout",function(e){t.edit||t.updateCursorLocation(null)}),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp);var n=this.getImageState();this.editState=y.getEditState(n,this.props.isTilemap,this.props.drawingMode),this.redraw(),this.updateBackground()},t.prototype.componentDidUpdate=function(){if(!this.edit||!this.editState){var e=this.getImageState();this.editState=y.getEditState(e,this.props.isTilemap,this.props.drawingMode)}if(this.cellWidth=this.props.isTilemap?c*this.props.tilemapState.tileset.tileWidth:c,this.props.zoomDelta||0===this.props.zoomDelta)return 0===this.props.zoomDelta?this.zoomToCanvas():this.updateZoom(this.props.zoomDelta),void this.props.dispatchChangeZoom(null);this.redraw(),this.updateBackground()},t.prototype.componentWillUnmount=function(){this.tileCache=[],document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)},t.prototype.onClick=function(e,t){this.isPanning()||(this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.inBounds(this.cursorLocation[0],this.cursorLocation[1])&&(this.startEdit(!!t),this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit())))},t.prototype.onDragStart=function(e,t){this.isPanning()?(this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1)):this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.startEdit(!!t))},t.prototype.onDragMove=function(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1);else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1])}},t.prototype.onDragEnd=function(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=void 0,this.lastPanY=void 0,this.updateCursor(!1,!1);else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()}},t.prototype.updateCursorLocation=function(e){if(!e)return this.cursorLocation&&(this.cursorLocation=null,this.props.dispatchChangeCursorLocation(null),this.edit||this.redraw()),!1;if(this.canvas){var t=this.canvas.getBoundingClientRect(),n=Math.floor((e.clientX-t.left)/t.width*this.imageWidth),r=Math.floor((e.clientY-t.top)/t.height*this.imageHeight);return!(this.cursorLocation&&n===this.cursorLocation[0]&&r===this.cursorLocation[1]||(this.cursorLocation=[n,r],this.props.dispatchChangeCursorLocation(n<0||r<0||n>=this.imageWidth||r>=this.imageHeight?null:this.cursorLocation),this.edit||this.redraw(),this.updateCursor(!!this.edit,this.editState.inFloatingLayer(n,r)),0))}return!(this.cursorLocation=[0,0])},t.prototype.updateCursor=function(e,t){var n=this.props.tool,r=y.tools.find(function(e){return e.tool===n});r?t?e?this.updateCursorCore(r.downLayerCursor||r.hoverLayerCursor||r.downCursor||r.hoverCursor):this.updateCursorCore(r.hoverLayerCursor||r.hoverCursor):e?this.updateCursorCore(r.downCursor||r.hoverCursor):this.updateCursorCore(r.hoverCursor):this.updateCursorCore(y.ToolCursor.Default)},t.prototype.updateCursorCore=function(e){this.cursor=e||y.ToolCursor.Default,this.updateBackground()},t.prototype.startEdit=function(e){var t=this.props,n=t.tool,r=t.toolWidth,i=t.selectedColor,o=t.backgroundColor,a=t.drawingMode,s=this.cursorLocation,l=s[0],c=s[1];if(this.inBounds(l,c)){var u=a==v.TileDrawingMode.Wall?2:e?o:i;this.edit=y.getEdit(n,this.editState,u,r),this.edit.start(this.cursorLocation[0],this.cursorLocation[1],this.editState)}},t.prototype.updateEdit=function(e,t){this.edit&&this.edit.inBounds(e,t)&&(this.edit.update(e,t),this.redraw())},t.prototype.commitEdit=function(){var e=this.props.dispatchImageEdit,t=this.getImageState();this.edit&&(this.editState=y.getEditState(t,this.props.isTilemap,this.props.drawingMode),this.edit.doEdit(this.editState),this.edit=void 0,e({bitmap:this.editState.image.data(),layerOffsetX:this.editState.layerOffsetX,layerOffsetY:this.editState.layerOffsetY,floating:this.editState.floating&&{bitmap:this.editState.floating.image?this.editState.floating.image.data():void 0,overlayLayers:this.editState.floating.overlayLayers?this.editState.floating.overlayLayers.map(function(e){return e.data()}):void 0},overlayLayers:this.editState.overlayLayers?this.editState.overlayLayers.map(function(e){return e.data()}):void 0}))},t.prototype.redraw=function(){var t=this,e=this.props,n=e.prevFrame,r=e.onionSkinEnabled,i=e.selectedColor,o=e.toolWidth,a=e.drawingMode,s=this.getImageState(),l=a==v.TileDrawingMode.Wall?2:i;if(this.canvas){if(this.imageWidth=s.bitmap.width,this.imageHeight=s.bitmap.height,this.canvas.width=s.bitmap.width*this.cellWidth,this.canvas.height=s.bitmap.height*this.cellWidth,this.canvasLayers.forEach(function(e){e.width=t.canvas.width,e.height=t.canvas.height}),r&&n){var c=y.getEditState(n,this.props.isTilemap,a),u=this.canvas.getContext("2d");u.globalAlpha=.5,this.drawImage(c.image),c.floating&&c.floating.image&&this.drawImage(c.floating.image,c.layerOffsetX,c.layerOffsetY,!0),u.globalAlpha=1}if(this.edit){var p=this.editState.copy();p.setActiveLayer(a),this.edit.doEdit(p),this.drawImage(p.image),this.drawOverlayLayers(p.overlayLayers),this.redrawFloatingLayer(p)}else this.drawImage(this.editState.image),this.drawOverlayLayers(this.editState.overlayLayers),this.redrawFloatingLayer(this.editState),this.cursorLocation&&this.shouldDrawCursor()&&this.drawCursor(this.cursorLocation[0]-(o>>1),this.cursorLocation[1]-(o>>1),o,l);if(this.background.width!=this.canvas.width<<1||this.background.height!=this.canvas.height<<1){this.background.width=this.canvas.width<<1,this.background.height=this.canvas.height<<1;var d=this.background.getContext("2d");d.imageSmoothingEnabled=!1,d.fillStyle="#aeaeae",d.fillRect(0,0,this.background.width,this.background.height),d.fillStyle="#dedede";for(var f=this.imageHeight<<1,h=this.imageWidth<<1,m=0;m<h;m++)for(var g=0;g<f;g++)m+g&1&&d.fillRect(m*this.cellWidth,g*this.cellWidth,this.cellWidth,this.cellWidth)}}},t.prototype.drawImage=function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=!0),this.props.isTilemap?this.drawTilemap(e,t,n,r):this.drawBitmap(e,t,n,r)},t.prototype.redrawFloatingLayer=function(e,t){void 0===t&&(t=!1);var n=this.refs["floating-layer-border"];if(e.floating&&e.floating.image){t||(this.drawImage(e.floating.image,e.layerOffsetX,e.layerOffsetY,!0),e.floating.overlayLayers&&this.drawOverlayLayers(e.floating.overlayLayers,e.layerOffsetX,e.layerOffsetY));var r=this.canvas.getBoundingClientRect(),i=Math.max(e.layerOffsetX,0),o=Math.max(e.layerOffsetY,0),a=Math.min(e.layerOffsetX+e.floating.image.width,e.width),s=Math.min(e.layerOffsetY+e.floating.image.height,e.height),l=r.width/e.width,c=r.height/e.height;n.style.display="",(a-i<1||s-o<1)&&(n.style.display="none"),n.style.left=-this.panX+l*i+"px",n.style.top=-this.panY+c*o+"px",n.style.width=l*(a-i)+"px",n.style.height=c*(s-o)+"px",n.style.borderLeft=0<=i?"":"none",n.style.borderTop=0<=o?"":"none",n.style.borderRight=a<e.width?"":"none",n.style.borderBottom=s<e.height?"":"none"}else n.style.display="none"},t.prototype.drawOverlayLayers=function(e,n,r,i){var o=this;void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=!0),e&&e.forEach(function(e,t){o.drawBitmap(e,n,r,i,o.cellWidth,o.canvasLayers[t])})},t.prototype.drawBitmap=function(e,t,n,r,i,o){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=!0),void 0===i&&(i=this.cellWidth),void 0===o&&(o=this.canvas);var a=this.props.colors,s=o.getContext("2d");s.imageSmoothingEnabled=!1;for(var l=0;l<e.width;l++)for(var c=0;c<e.height;c++){var u=e.get(l,c);u?(s.fillStyle=a[u],s.fillRect((l+t)*i,(c+n)*i,i,i)):r||s.clearRect((l+t)*i,(c+n)*i,i,i)}},t.prototype.generateTile=function(e,t){var n=document.createElement("canvas");return n.width=t.tileWidth,n.height=t.tileWidth,this.drawBitmap(pxt.sprite.Bitmap.fromData(t.tiles[e].data),0,0,!0,1,n),this.tileCache[e]=n},t.prototype.drawTilemap=function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=!0),void 0===i&&(i=this.canvas);var o,a,s=this.props.tilemapState.tileset,l=i.getContext("2d");this.tileCache=[],l.imageSmoothingEnabled=!1;for(var c=0;c<e.width;c++)for(var u=0;u<e.height;u++)(o=e.get(c,u))&&o<s.tiles.length?((a=this.tileCache[o])||(a=this.generateTile(o,s)),l.drawImage(a,(c+t)*this.cellWidth,(u+n)*this.cellWidth)):r||l.clearRect((c+t)*this.cellWidth,(u+n)*this.cellWidth,this.cellWidth,this.cellWidth)},t.prototype.drawCursor=function(e,t,n,r){var i=this.canvas.getContext("2d");if(i.imageSmoothingEnabled=!1,r)if(this.props.isTilemap&&this.props.drawingMode!=v.TileDrawingMode.Wall){if(r>=this.props.tilemapState.tileset.tiles.length)return;var o=this.tileCache[r];o||(o=this.generateTile(r,this.props.tilemapState.tileset)),i.drawImage(o,e*this.cellWidth,t*this.cellWidth)}else i.fillStyle=this.props.colors[r],i.fillRect(e*this.cellWidth,t*this.cellWidth,n*this.cellWidth,n*this.cellWidth);else i.clearRect(e*this.cellWidth,t*this.cellWidth,n*this.cellWidth,n*this.cellWidth)},t.prototype.updateBackground=function(){this.refs["canvas-bounds"].style.cursor=this.cursor,this.canvas.style.cursor=this.cursor,this.updateZoom(0)},t.prototype.updateZoom=function(e,t,n){var r=this.refs["canvas-bounds"];if(this.canvas&&r){var i=r.getBoundingClientRect();t=void 0===t?i.left+(i.width>>1):t,n=void 0===n?i.top+(i.height>>1):n;var o=this.clientToCanvas(t,n,i),a=o.canvasX,s=o.canvasY;this.zoom=Math.max(this.zoom+e,2.5);var l=this.getCanvasUnit(i),c=this.clientToCanvas(t,n,i),u=c.canvasX,p=c.canvasY;if(isNaN(u)||isNaN(p)||isNaN(a)||isNaN(s))return;this.panX+=(a-u)*l,this.panY+=(s-p)*l,this.applyZoom()}},t.prototype.zoomToCanvas=function(){this.zoom=10;var e=this.refs["canvas-bounds"];if(this.applyZoom(),this.canvas&&e){var t=e.getBoundingClientRect(),n=this.canvas.getBoundingClientRect();n.width<t.width&&(this.panX=-((t.width>>1)-(n.width>>1))),n.height<t.height&&(this.panY=-((t.height>>1)-(n.height>>1)))}this.applyZoom()},t.prototype.applyZoom=function(e){var t=this,n=this.refs["canvas-bounds"];if(this.canvas&&n){e=e||n.getBoundingClientRect();var r=this.getCanvasUnit(e),i=r*this.imageWidth,o=r*this.imageHeight,a=1<this.imageWidth&&1<this.imageHeight?2*r:r>>1;this.panX=Math.max(Math.min(this.panX,i-a),-(e.width-a)),this.panY=Math.max(Math.min(this.panY,o-a),-(e.height-a)),this.canvas.style.position="fixed",this.canvas.style.width=i+"px",this.canvas.style.height=o+"px",this.canvas.style.left=-this.panX+"px",this.canvas.style.top=-this.panY+"px",this.canvas.style.clipPath="polygon("+this.panX+"px "+this.panY+"px, "+(this.panX+e.width)+"px "+this.panY+"px, "+(this.panX+e.width)+"px "+(this.panY+e.height)+"px, "+this.panX+"px "+(this.panY+e.height)+"px)",this.cloneCanvasStyle(this.canvas,this.background),this.canvasLayers.forEach(function(e){return t.cloneCanvasStyle(t.canvas,e)}),this.redrawFloatingLayer(this.editState,!0)}},t.prototype.selectCanvasColor=function(e,t){var n=this.refs["canvas-bounds"].getBoundingClientRect(),r=this.clientToCanvas(e.clientX,e.clientY,n),i=r.canvasX,o=r.canvasY,a=this.editState.image.get(Math.floor(i),Math.floor(o));t?this.props.dispatchChangeBackgroundColor(a):this.props.dispatchChangeSelectedColor(a)},t.prototype.cloneCanvasStyle=function(e,t){t.style.position=e.style.position,t.style.width=e.style.width,t.style.height=e.style.height,t.style.left=e.style.left,t.style.top=e.style.top,t.style.clipPath=e.style.clipPath},t.prototype.clientToCanvas=function(e,t,n){var r=this.getCanvasUnit(n);return{canvasX:(e-n.left+this.panX)/r,canvasY:(t-n.top+this.panY)/r}},t.prototype.getCanvasUnit=function(e){var t=e.width/e.height,n=this.imageWidth/this.imageHeight,r=Math.pow(this.zoom/10,2);return n<t?r*(e.height/this.imageHeight):r*(e.width/this.imageWidth)},t.prototype.inBounds=function(e,t){return 0<=e&&e<this.imageWidth&&0<=t&&t<this.imageHeight},t.prototype.isPanning=function(){return this.props.tool===v.ImageEditorTool.Pan},t.prototype.isColorSelect=function(){return this.props.tool===v.ImageEditorTool.ColorSelect},t.prototype.shouldDrawCursor=function(){switch(this.props.tool){case v.ImageEditorTool.Fill:case v.ImageEditorTool.Marquee:case v.ImageEditorTool.Pan:case v.ImageEditorTool.ColorSelect:return!1;default:return!0}},t.prototype.getImageState=function(){return this.props.isTilemap?this.props.tilemapState.tilemap:this.props.imageState},t}(o.Component);var d={dispatchImageEdit:s.dispatchImageEdit,dispatchChangeCursorLocation:s.dispatchChangeCursorLocation,dispatchChangeZoom:s.dispatchChangeZoom,dispatchChangeImageTool:s.dispatchChangeImageTool,dispatchChangeSelectedColor:s.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:s.dispatchChangeBackgroundColor};n.ImageCanvas=a.connect(function(e,t){var n=e.store.present,r=e.editor;if(r.isTilemap){var i=n;return i?{selectedColor:r.selectedColor,tilemapState:i,tool:r.tool,toolWidth:r.cursorSize,zoomDelta:r.zoomDelta,onionSkinEnabled:!1,overlayEnabled:r.overlayEnabled,backgroundColor:r.backgroundColor,colors:i.colors,isTilemap:r.isTilemap,drawingMode:r.drawingMode}:{}}var o=n;return o?{selectedColor:r.selectedColor,colors:o.colors,imageState:o.frames[o.currentFrame],tool:r.tool,toolWidth:r.cursorSize,zoomDelta:r.zoomDelta,onionSkinEnabled:r.onionSkinEnabled,backgroundColor:r.backgroundColor,prevFrame:o.frames[o.currentFrame-1],isTilemap:r.isTilemap}:{}},d)(p)},{"./actions/dispatch":27,"./store/imageReducer":31,"./toolDefinitions":35,"./util":36,react:284,"react-redux":263}],20:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("react"),s=e("react-redux"),l=e("./store/imageStore"),c=e("./SideBar"),u=e("./BottomBar"),p=e("./TopBar"),d=e("./ImageCanvas"),f=e("./Timeline"),h=e("./keyboardShortcuts"),m=e("./actions/dispatch"),g=e("./util"),o=function(t){function o(e){var i=t.call(this,e)||this;return i.onStoreChange=function(){i.props.onChange&&i.props.onChange(i.props.singleFrame?pxt.sprite.bitmapToImageLiteral(i.getCurrentFrame(),"typescript"):"");var e=i.getStore().getState();if(!!e.editor.editingTile!=!!i.state.editingTile)if(e.editor.editingTile){var t=e.editor.editingTile.tilesetIndex;if(t){var n=e.store.present.tileset.tiles[t];i.setState({editingTile:!0,editTileValue:pxt.sprite.bitmapToImageLiteral(pxt.sprite.Bitmap.fromData(n.data),"typescript")})}else{var r=e.store.present.tileset.tileWidth;i.setState({editingTile:!0,editTileValue:pxt.sprite.bitmapToImageLiteral(new pxt.sprite.Bitmap(r,r),"typescript")})}}else i.setState({editingTile:!1})},i.onDoneClick=function(){if(i.props.onDoneClicked){var e;e=i.getStore().getState().editor.isTilemap?pxt.sprite.encodeTilemap(i.getTilemap(),"typescript"):i.props.singleFrame?pxt.sprite.bitmapToImageLiteral(i.getCurrentFrame(),"typescript"):i.getAnimation()+"",i.props.onDoneClicked(e)}},i.onTileEditorFinished=function(e){var t=pxt.sprite.imageLiteralToBitmap(e),n=i.getStore(),r=n.getState().editor.editingTile;n.dispatch(m.dispatchCloseTileEditor(t.data(),r.tilesetIndex))},i.state={editingTile:!1},i}return i(o,t),o.prototype.componentDidMount=function(){h.addKeyListener(),this.props.initialValue&&this.initSingleFrame(pxt.sprite.imageLiteralToBitmap(this.props.initialValue)),this.unsubscribeChangeListener=this.getStore().subscribe(this.onStoreChange),this.onResize()},o.prototype.componentWillUnmount=function(){h.removeKeyListener(),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()},o.prototype.render=function(){var e=this.props.singleFrame,t=this.getStore(),n=this.state,r=n.editTileValue,i=n.editingTile;return a.createElement("div",{className:"image-editor-outer"},a.createElement(s.Provider,{store:t},a.createElement("div",{className:"image-editor"},a.createElement(p.TopBar,{singleFrame:e}),a.createElement("div",{className:"image-editor-content"},a.createElement(c.SideBar,null),a.createElement(d.ImageCanvas,null),e?void 0:a.createElement(f.Timeline,null)),a.createElement(u.BottomBar,{singleFrame:e}))),i&&a.createElement(o,{store:l.tileEditorStore,onDoneClicked:this.onTileEditorFinished,initialValue:r,singleFrame:!0}),!i&&this.props.onDoneClicked&&a.createElement("button",{className:"image-editor-confirm ui small button",title:lf("Done"),onClick:this.onDoneClick},lf("Done")))},o.prototype.initSingleFrame=function(e){this.getStore().dispatch(m.dispatchSetInitialFrames([{bitmap:e.data()}],100))},o.prototype.initAnimation=function(e,t){this.getStore().dispatch(m.dispatchSetInitialFrames(e.map(function(e){return{bitmap:e.data()}}),t))},o.prototype.initTilemap=function(e,t){this.getStore().dispatch(m.dispatchSetInitialTilemap(e.tilemap.data(),e.tileset,t,[e.layers],e.nextId))},o.prototype.onResize=function(){this.getStore().dispatch(m.dispatchChangeZoom(0))},o.prototype.getCurrentFrame=function(){var e=this.getStore().getState().store.present,t=e.frames[e.currentFrame];return g.imageStateToBitmap(t)},o.prototype.getAnimation=function(){var e=this.getStore().getState().store.present;return{interval:e.interval,frames:e.frames.map(function(e){return g.imageStateToBitmap(e).data()})}},o.prototype.getTilemap=function(){var e=this.getStore().getState().store.present,t=e.tilemap,n=t.floating,r=t.overlayLayers,i=t.layerOffsetX,o=t.layerOffsetY,a=g.applyBitmapData(r[0],n&&n.overlayLayers&&n.overlayLayers[0],i,o);return new pxt.sprite.TilemapData(g.imageStateToTilemap(e.tilemap),e.tileset,a)},o.prototype.getPersistentData=function(){var e=this.getStore().getState();return{editor:e.editor,past:e.store.past}},o.prototype.restorePersistentData=function(e){e&&this.getStore().dispatch(m.dispatchSetInitialState(e.editor,e.past))},o.prototype.setCurrentFrame=function(e){this.getStore().dispatch(m.dispatchImageEdit({bitmap:e.data()}))},o.prototype.getStore=function(){return this.props.store||l.mainStore},o}(a.Component);n.ImageEditor=o},{"./BottomBar":15,"./ImageCanvas":19,"./SideBar":22,"./Timeline":23,"./TopBar":26,"./actions/dispatch":27,"./keyboardShortcuts":29,"./store/imageStore":32,"./util":36,react:284,"react-redux":263}],21:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=function(n){function e(e){var t=n.call(this,e)||this;return t.handlers=[],t.state={open:!1},t}return i(e,n),e.prototype.componentWillUnmount=function(){this.handlers=null},e.prototype.render=function(){var n=this,e=this.props,t=e.options,r=t[e.selected];return o.createElement("div",{className:"image-editor-pivot-outer"},t.map(function(e,t){return o.createElement("div",{role:"tab",key:e.id,className:"image-editor-pivot-option "+(e===r?"selected":""),onClick:n.clickHandler(t)},e.text)}))},e.prototype.clickHandler=function(e){var t=this;if(!this.handlers[e]){var n=this.props,r=n.onChange,i=n.options;this.handlers[e]=function(){t.setState({open:!1}),r(i[e],e)}}return this.handlers[e]},e}(o.Component);n.Pivot=a},{react:284}],22:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("react-redux"),s=e("./toolDefinitions"),l=e("./Button"),c=e("./actions/dispatch"),u=e("./sprite/Palette"),p=e("./tilemap/TilePalette"),d=e("./tilemap/Minimap"),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handlers=[],e}return i(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.selectedTool,r=e.isTilemap;return o.createElement("div",{className:"image-editor-sidebar "+(r?"tilemap":"")},r&&o.createElement("div",{className:"image-editor-tilemap-minimap"},o.createElement(d.Minimap,null)),o.createElement("div",{className:"image-editor-tool-buttons"},s.tools.filter(function(e){return!e.hiddenTool}).map(function(e){return o.createElement(l.IconButton,{key:e.tool,iconClass:e.iconClass,toggle:n!=e.tool,title:e.title,onClick:t.clickHandler(e.tool)})})),o.createElement("div",{className:"image-editor-palette"},r?o.createElement(p.TilePalette,null):o.createElement(u.Palette,null)))},e.prototype.clickHandler=function(e){var t=this;return this.handlers[e]||(this.handlers[e]=function(){return t.props.dispatchChangeImageTool(e)}),this.handlers[e]},e}(o.Component);n.SideBarImpl=f;var h={dispatchChangeImageTool:c.dispatchChangeImageTool};n.SideBar=a.connect(function(e,t){var n=e.editor;return n?{isTilemap:n.isTilemap,selectedTool:n.tool}:{}},h)(f)},{"./Button":16,"./actions/dispatch":27,"./sprite/Palette":30,"./tilemap/Minimap":33,"./tilemap/TilePalette":34,"./toolDefinitions":35,react:284,"react-redux":263}],23:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var d=e("react"),o=e("react-redux"),a=e("./actions/dispatch"),f=e("./TimelineFrame"),l=e("./util"),s=function(t){function e(e){var n=t.call(this,e)||this;return n.handlers=[],n.scrollOffset=0,n.dragEnd=!1,n.duplicateFrame=function(){var e=n.props,t=e.currentFrame;(0,e.dispatchDuplicateFrame)(t)},n.deleteFrame=function(){var e=n.props,t=e.currentFrame;(0,e.dispatchDeleteFrame)(t)},n.newFrame=function(){var e=n.props.dispatchNewFrame;n.dragEnd?n.dragEnd=!1:e()},n.state={},n}return i(e,t),e.prototype.render=function(){var e,r=this,t=this.props,n=t.frames,i=t.colors,o=t.currentFrame,a=t.interval,s=t.previewAnimating,l=this.state,c=l.isMovingFrame,u=l.dropPreviewIndex,p=n.slice();return c&&(e=n[o],p.splice(o,1),p.splice(u,0,null)),d.createElement("div",{className:"image-editor-timeline"},d.createElement("div",{className:"image-editor-timeline-preview"},d.createElement(f.TimelineFrame,{frames:s?n:[n[o]],colors:i,interval:a,animating:!0})),d.createElement("div",{className:"image-editor-timeline-frames-outer"},d.createElement("div",{className:"image-editor-timeline-frames",ref:"frame-scroller-ref"},p.map(function(e,t){var n=!c&&t===o;return e?d.createElement("div",{className:"image-editor-timeline-frame "+(n?"active":""),key:t,role:"button",onClick:r.clickHandler(t)},d.createElement(f.TimelineFrame,{frames:[e],colors:i,showActions:n,duplicateFrame:r.duplicateFrame,deleteFrame:r.deleteFrame})):d.createElement("div",{className:"image-editor-timeline-frame drop-marker",key:t})}),e&&d.createElement("div",{ref:"floating-frame",className:"image-editor-timeline-frame dragging"},d.createElement(f.TimelineFrame,{frames:[e],colors:i,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})),d.createElement("div",{className:"image-editor-timeline-frame collapsed",role:"button",onClick:this.newFrame},d.createElement("span",{className:"ms-Icon ms-Icon--Add"})))))},e.prototype.componentDidMount=function(){var o,a=this;this.canvas=this.refs["preview-canvas"],this.frameScroller=this.refs["frame-scroller-ref"],this.redraw();var s=!1;l.bindGestureEvents(this.frameScroller,{onClick:function(e){a.dragEnd=!1},onDragStart:function(e){o=e.clientY,pxt.BrowserUtils.addClass(a.frameScroller,"scrolling");var t=a.frameScroller.getBoundingClientRect(),n=e.clientY-t.top,r=a.frameScroller.firstElementChild.getBoundingClientRect().height,i=Math.floor(n/r);s=i!==a.props.currentFrame},onDragMove:function(e){if(s){a.scrollOffset-=o-e.clientY,o=e.clientY;try{var t=a.frameScroller.getBoundingClientRect(),n=a.frameScroller.parentElement.getBoundingClientRect();t.height>n.height?a.scrollOffset=Math.max(Math.min(a.scrollOffset,0),n.height-t.height-15):a.scrollOffset=0,a.frameScroller.parentElement.scrollTop=-a.scrollOffset}catch(e){}}else a.updateDragDrop(e)},onDragEnd:function(){if(o=null,pxt.BrowserUtils.removeClass(a.frameScroller,"scrolling"),a.dragEnd=!0,a.state.isMovingFrame){var e=a.props;(0,e.dispatchMoveFrame)(e.currentFrame,a.state.dropPreviewIndex),a.setState({isMovingFrame:!1})}}}),this.frameScroller.addEventListener("wheel",function(e){a.scrollOffset-=e.deltaY;try{var t=a.frameScroller.getBoundingClientRect(),n=a.frameScroller.parentElement.getBoundingClientRect();t.height>n.height?a.scrollOffset=Math.max(Math.min(a.scrollOffset,0),n.height-t.height-15):a.scrollOffset=0,a.frameScroller.parentElement.scrollTop=-a.scrollOffset}catch(e){}})},e.prototype.componentDidUpdate=function(){this.redraw()},e.prototype.clickHandler=function(r){var i=this;return this.handlers[r]||(this.handlers[r]=function(){var e=i.props,t=e.currentFrame,n=e.dispatchChangeCurrentFrame;i.dragEnd?i.dragEnd=!1:r!=t&&n(r)}),this.handlers[r]},e.prototype.redraw=function(){if(this.canvas){var e=this.props,t=e.frames[e.currentFrame];this.canvas.height=t.bitmap.height,this.canvas.width=t.bitmap.width;var n=pxt.sprite.Bitmap.fromData(t.bitmap);if(this.drawBitmap(n),t.floating&&t.floating.bitmap){var r=pxt.sprite.Bitmap.fromData(t.floating.bitmap);this.drawBitmap(r,t.layerOffsetX,t.layerOffsetY,!0)}}},e.prototype.drawBitmap=function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=!1);var i=this.props.colors,o=this.canvas.getContext("2d");o.imageSmoothingEnabled=!1;for(var a=0;a<e.width;a++)for(var s=0;s<e.height;s++){var l=e.get(a,s);l?(o.fillStyle=i[l],o.fillRect(a+t,s+n,1,1)):r||o.clearRect(a+t,s+n,1,1)}},e.prototype.updateDragDrop=function(e){var t=this.frameScroller.getBoundingClientRect(),n=e.clientY-t.top,r=this.frameScroller.firstElementChild.getBoundingClientRect().height,i=Math.floor(n/r);this.state.isMovingFrame?this.refs["floating-frame"]&&(this.refs["floating-frame"].style.top=n+"px",this.setState({dropPreviewIndex:i})):this.setState({isMovingFrame:!0,dropPreviewIndex:this.props.currentFrame})},e}(d.Component);n.TimelineImpl=s;var c={dispatchDuplicateFrame:a.dispatchDuplicateFrame,dispatchDeleteFrame:a.dispatchDeleteFrame,dispatchChangeCurrentFrame:a.dispatchChangeCurrentFrame,dispatchNewFrame:a.dispatchNewFrame,dispatchMoveFrame:a.dispatchMoveFrame};n.Timeline=o.connect(function(e,t){var n=e.store.present,r=e.editor,i=n;return i?{frames:i.frames,currentFrame:i.currentFrame,colors:i.colors,interval:i.interval,previewAnimating:r.previewAnimating}:{}},c)(s)},{"./TimelineFrame":24,"./actions/dispatch":27,"./util":36,react:284,"react-redux":263}],24:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var l=e("react"),c=e("./Button"),u=pxt.BrowserUtils.isEdge()?25:1,o=function(n){function e(e){var t=n.call(this,e)||this;return t.state={index:0},t}return i(e,n),e.prototype.render=function(){var e=this.props,t=e.frames,n=e.animating,r=e.showActions,i=e.duplicateFrame,o=e.deleteFrame,a=t[n?Math.min(Math.max(0,this.state.index),t.length-1):0],s=a.bitmap.height>a.bitmap.width;return l.createElement("div",{className:"timeline-frame-outer "+(s?"portrait":"landscape")},l.createElement("div",{className:"timeline-frame-spacer"}),l.createElement("canvas",{ref:"preview-canvas"}),l.createElement("div",{className:"timeline-frame-spacer"}),r&&l.createElement("div",{className:"timeline-frame-actions"},l.createElement(c.IconButton,{iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate Current Frame"),onClick:i}),l.createElement(c.IconButton,{iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete Current Frame"),onClick:o})))},e.prototype.componentDidMount=function(){this.canvas=this.refs["preview-canvas"],this.redraw(),this.updateAnimation()},e.prototype.componentDidUpdate=function(){this.redraw(),this.updateAnimation()},e.prototype.componentWillUnmount=function(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=void 0},e.prototype.redraw=function(){if(this.canvas){var e=this.props,t=e.animating,n=e.frames,r=n[t?Math.min(Math.max(0,this.state.index),n.length-1):0];this.canvas.height=r.bitmap.height*u,this.canvas.width=r.bitmap.width*u;var i=pxt.sprite.Bitmap.fromData(r.bitmap);if(this.drawBitmap(i),r.floating&&r.floating.bitmap){var o=pxt.sprite.Bitmap.fromData(r.floating.bitmap);this.drawBitmap(o,r.layerOffsetX,r.layerOffsetY,!0)}}},e.prototype.updateAnimation=function(){var e=this,t=this.props,n=t.animating,r=t.interval,i=t.frames,o=n&&5<r&&1<i.length;o&&r!==this.intervalcurrent?(this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(function(){return e.setState({index:(e.state.index+1)%e.props.frames.length})},r),this.intervalcurrent=r):!o&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0,this.intervalcurrent=void 0)},e.prototype.drawBitmap=function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=!1);for(var i=this.props.colors,o=this.canvas.getContext("2d"),a=0;a<e.width;a++)for(var s=0;s<e.height;s++){var l=e.get(a,s);l?(o.fillStyle=i[l],o.fillRect((a+t)*u,(s+n)*u,u,u)):r||o.clearRect((a+t)*u,(s+n)*u,u,u)}},e}(l.Component);n.TimelineFrame=o},{"./Button":16,react:284}],25:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=function(n){function e(e){var t=n.call(this,e)||this;return t.checked=!1,t.handleToggleClick=function(e){t.checked=!t.checked,t.props.onChange&&t.props.onChange(e.target.checked)},t.checked=e.initialValue,t}return i(e,n),e.prototype.render=function(){var e=this.props,t=e.initialValue,n=e.label;return o.createElement("div",{className:"image-editor-toggle-container"},n&&o.createElement("span",null,n),o.createElement("label",{className:"image-editor-toggle"},o.createElement("input",{type:"checkbox",onClick:this.handleToggleClick,defaultChecked:t,"aria-checked":this.checked}),o.createElement("span",{className:"image-editor-toggle-switch"})))},e}(o.Component);n.Toggle=a},{react:284}],26:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("react"),o=e("react-redux"),a=e("./actions/dispatch"),l=e("./Button"),c=e("./CursorSizes"),u=e("./Toggle"),p=function(t){function e(e){var n=t.call(this,e)||this;return n.togglePreviewAnimating=function(){return n.props.dispatchChangePreviewAnimating(!n.props.previewAnimating)},n.handleIntervalChange=function(e){n.setState({interval:e.target.value})},n.handleIntervalBlur=function(){var e=n.props.dispatchChangeInterval,t=parseInt(n.state.interval);isNaN(t)||e(Math.min(Math.max(t,50),1e6)),n.setState({interval:null})},n.state={},n}return i(e,t),e.prototype.render=function(){var e=this.props,t=e.interval,n=e.previewAnimating,r=e.singleFrame,i=e.isTilemap,o=e.dispatchChangeOverlayEnabled,a=null==this.state.interval?t:this.state.interval;return s.createElement("div",{className:"image-editor-topbar"},s.createElement("div",{className:"cursor-group"},s.createElement(c.CursorSizes,null)),s.createElement("div",{className:"spacer"}),!r&&s.createElement("div",{className:"image-editor-seperator"}),!r&&s.createElement("div",{className:"timeline-controls"},s.createElement(l.IconButton,{onClick:this.togglePreviewAnimating,iconClass:n?"ms-Icon ms-Icon--Stop":"ms-Icon ms-Icon--Play",title:n?lf("Stop Animation Preview"):lf("Play Animation Preview"),toggle:!0}),s.createElement("div",{className:"image-editor-interval-label image-editor-label"},s.createElement("span",{className:"ms-Icon ms-Icon--Clock"})),s.createElement("div",{className:"image-editor-interval"},s.createElement("input",{className:"image-editor-input",title:lf("Interval Between Frames (ms)"),value:a,onChange:this.handleIntervalChange,onBlur:this.handleIntervalBlur}))),i&&s.createElement(u.Toggle,{initialValue:!0,label:lf("Show walls"),onChange:o}))},e}(s.Component);n.TopBarImpl=p;var d={dispatchChangeInterval:a.dispatchChangeInterval,dispatchChangePreviewAnimating:a.dispatchChangePreviewAnimating,dispatchChangeOverlayEnabled:a.dispatchChangeOverlayEnabled};n.TopBar=o.connect(function(e,t){var n=e.store.present,r=e.editor;return n?{interval:n.interval,previewAnimating:r.previewAnimating,isTilemap:r.isTilemap}:{}},d)(p)},{"./Button":16,"./CursorSizes":17,"./Toggle":25,"./actions/dispatch":27,react:284,"react-redux":263}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./types");n.dispatchChangeImageTool=function(e){return{type:o.CHANGE_IMAGE_TOOL,tool:e}},n.dispatchChangeCursorSize=function(e){return{type:o.CHANGE_CURSOR_SIZE,cursorSize:e}},n.dispatchChangeSelectedColor=function(e){return{type:o.CHANGE_SELECTED_COLOR,selectedColor:e}},n.dispatchChangeImageDimensions=function(e){return{type:o.CHANGE_IMAGE_DIMENSIONS,imageDimensions:e}},n.dispatchChangeKeyModifiers=function(e){return{type:o.CHANGE_KEY_MODIFIERS,keyModifiers:e}},n.dispatchChangeCursorLocation=function(e){return{type:o.CHANGE_CURSOR_LOCATION,cursorLocation:e}},n.dispatchImageEdit=function(e){return{type:o.IMAGE_EDIT,newState:e}},n.dispatchUndoImageEdit=function(){return{type:o.UNDO_IMAGE_EDIT}},n.dispatchRedoImageEdit=function(){return{type:o.REDO_IMAGE_EDIT}},n.dispatchToggleAspectRatioLocked=function(){return{type:o.TOGGLE_ASPECT_RATIO}},n.dispatchNewFrame=function(e){return{type:o.NEW_FRAME,index:e}},n.dispatchDeleteFrame=function(e){return{type:o.DELETE_FRAME,index:e}},n.dispatchDuplicateFrame=function(e){return{type:o.DUPLICATE_FRAME,index:e}},n.dispatchChangeCurrentFrame=function(e){return{type:o.CHANGE_CURRENT_FRAME,index:e}},n.dispatchMoveFrame=function(e,t){return{type:o.MOVE_FRAME,oldIndex:e,newIndex:t}},n.dispatchChangeInterval=function(e){return{type:o.CHANGE_INTERVAL,newInterval:e}},n.dispatchChangePreviewAnimating=function(e){return{type:o.CHANGE_PREVIEW_ANIMATING,animating:e}},n.dispatchToggleOnionSkinEnabled=function(){return{type:o.TOGGLE_ONION_SKIN_ENABLED}},n.dispatchChangeOverlayEnabled=function(e){return{type:o.CHANGE_OVERLAY_ENABLED,enabled:e}},n.dispatchChangeZoom=function(e){return{type:o.CHANGE_CANVAS_ZOOM,zoom:e}},n.dispatchSwapBackgroundForeground=function(){return{type:o.SWAP_FOREGROUND_BACKGROUND}},n.dispatchChangeBackgroundColor=function(e){return{type:o.CHANGE_BACKGROUND_COLOR,backgroundColor:e}},n.dispatchSetInitialFrames=function(e,t){return{type:o.SET_INITIAL_FRAMES,frames:e,interval:t}},n.dispatchSetInitialState=function(e,t){return{type:o.SET_INITIAL_STATE,state:e,past:t}},n.dispatchSetInitialTilemap=function(e,t,n,r,i){return{type:o.SET_INITIAL_TILEMAP,tilemap:e,tileset:t,layers:r,gallery:n,nextId:i}},n.dispatchChangeTilePaletteCategory=function(e){return{type:o.CHANGE_TILE_PALETTE_CATEGORY,category:e}},n.dispatchChangeTilePalettePage=function(e){return{type:o.CHANGE_TILE_PALETTE_PAGE,page:e}},n.dispatchChangeDrawingMode=function(e){return{type:o.CHANGE_DRAWING_MODE,drawingMode:e}},n.dispatchCreateNewTile=function(e,t,n,r){return{type:o.CREATE_NEW_TILE,bitmap:e,foreground:t,background:n,qualifiedName:r}},n.dispatchSetGalleryOpen=function(e){return{type:o.SET_GALLERY_OPEN,open:e}},n.dispatchOpenTileEditor=function(e){return{type:o.OPEN_TILE_EDITOR,index:e}},n.dispatchCloseTileEditor=function(e,t){return{type:o.CLOSE_TILE_EDITOR,result:e,index:t}},n.dispatchDeleteTile=function(e){return{type:o.DELETE_TILE,index:e}}},{"./types":28}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SET_INITIAL_STATE="SET_INITIAL_STATE",n.SET_INITIAL_FRAMES="SET_INITIAL_FRAMES",n.SET_INITIAL_TILEMAP="SET_INITIAL_TILEMAP",n.CHANGE_IMAGE_TOOL="CHANGE_IMAGE_TOOL",n.CHANGE_CURSOR_SIZE="CHANGE_CURSOR_SIZE",n.CHANGE_SELECTED_COLOR="CHANGE_SELECTED_COLOR",n.CHANGE_IMAGE_DIMENSIONS="CHANGE_IMAGE_DIMENSIONS",n.CHANGE_KEY_MODIFIERS="CHANGE_KEY_MODIFIERS",n.CHANGE_CURSOR_LOCATION="CHANGE_CURSOR_LOCATION",n.IMAGE_EDIT="IMAGE_EDIT",n.UNDO_IMAGE_EDIT="UNDO_IMAGE_EDIT",n.REDO_IMAGE_EDIT="REDO_IMAGE_EDIT",n.TOGGLE_ASPECT_RATIO="TOGGLE_ASPECT_RATIO",n.SET_GALLERY_OPEN="SET_GALLERY_OPEN",n.NEW_FRAME="NEW_FRAME",n.DELETE_FRAME="DELETE_FRAME",n.DUPLICATE_FRAME="DUPLICATE_FRAME",n.MOVE_FRAME="MOVE_FRAME",n.CHANGE_CURRENT_FRAME="CHANGE_CURRENT_FRAME",n.CHANGE_INTERVAL="CHANGE_INTERVAL",n.CHANGE_PREVIEW_ANIMATING="CHANGE_PREVIEW_ANIMATING",n.TOGGLE_ONION_SKIN_ENABLED="TOGGLE_ONION_SKIN_ENABLED",n.CHANGE_OVERLAY_ENABLED="CHANGE_OVERLAY_ENABLED",n.CHANGE_CANVAS_ZOOM="CHANGE_CANVAS_ZOOM",n.SWAP_FOREGROUND_BACKGROUND="SWAP_FOREGROUND_BACKGROUND",n.CHANGE_BACKGROUND_COLOR="CHANGE_BACKGROUND_COLOR",n.CHANGE_TILE_PALETTE_PAGE="CHANGE_TILE_PALETTE_PAGE",n.CHANGE_TILE_PALETTE_CATEGORY="CHANGE_TILE_PALETTE_CATEGORY",n.CHANGE_DRAWING_MODE="CHANGE_DRAWING_MODE",n.CREATE_NEW_TILE="CREATE_NEW_TILE",n.OPEN_TILE_EDITOR="OPEN_TILE_EDITOR",n.CLOSE_TILE_EDITOR="CLOSE_TILE_EDITOR",n.DELETE_TILE="DELETE_TILE"},{}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./store/imageReducer"),i=e("./actions/dispatch"),o=e("./store/imageStore");function a(e){var t=e.ctrlKey||e.metaKey;"Undo"===e.key||t&&"z"===e.key?(u(i.dispatchUndoImageEdit()),e.preventDefault(),e.stopPropagation()):("Redo"===e.key||t&&"y"===e.key)&&(u(i.dispatchRedoImageEdit()),e.preventDefault(),e.stopPropagation())}function s(e){switch(e.key){case"e":l(r.ImageEditorTool.Erase);break;case"h":l(r.ImageEditorTool.Pan);break;case"b":case"p":l(r.ImageEditorTool.Paint);break;case"g":l(r.ImageEditorTool.Fill);break;case"m":l(r.ImageEditorTool.Marquee);break;case"u":l(r.ImageEditorTool.Rect);break;case"-":case"_":c(-1);break;case"=":case"+":c(1);break;case"x":u(i.dispatchSwapBackgroundForeground())}}function l(e){u(i.dispatchChangeImageTool(e))}function c(e){u(i.dispatchChangeZoom(e))}function u(e){o.default.dispatch(e)}n.addKeyListener=function(){document.addEventListener("keydown",s),document.addEventListener("keydown",a,!0)},n.removeKeyListener=function(){document.removeEventListener("keydown",s),document.removeEventListener("keydown",a,!0)}},{"./actions/dispatch":27,"./store/imageReducer":31,"./store/imageStore":32}],30:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("react"),o=e("react-redux"),s=e("../actions/dispatch"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handlers=[],e.preventContextMenu=function(e){return e.preventDefault()},e}return i(e,t),e.prototype.render=function(){var n=this,e=this.props,t=e.colors,r=e.selected,i=e.backgroundColor,o=e.dispatchSwapBackgroundForeground;return a.createElement("div",null,a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 23 15",onClick:o},a.createElement("defs",null,a.createElement("pattern",{id:"alpha-background",width:"6",height:"6",patternUnits:"userSpaceOnUse"},a.createElement("rect",{x:"0",y:"0",width:"6px",height:"6px",fill:"#aeaeae"}),a.createElement("rect",{x:"0",y:"0",width:"3px",height:"3px",fill:"#dedede"}),a.createElement("rect",{x:"3",y:"3",width:"3px",height:"3px",fill:"#dedede"}))),a.createElement("g",null,a.createElement("rect",{fill:i?t[i]:"url(#alpha-background)",x:6,y:4,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"}),a.createElement("rect",{fill:r?t[r]:"url(#alpha-background)",x:2,y:1,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"}))),a.createElement("div",{className:"image-editor-color-buttons",onContextMenu:this.preventContextMenu},this.props.colors.map(function(e,t){return a.createElement("div",{key:t,className:"image-editor-button "+(0===t?"checkerboard":""),role:"button",title:lf("Color {0}",t),onMouseDown:n.clickHandler(t),style:0===t?null:{backgroundColor:e}})})))},e.prototype.clickHandler=function(t){var n=this;return this.handlers[t]||(this.handlers[t]=function(e){0===e.button?n.props.dispatchChangeSelectedColor(t):(n.props.dispatchChangeBackgroundColor(t),e.preventDefault(),e.stopPropagation())}),this.handlers[t]},e}(a.Component);var c={dispatchChangeSelectedColor:s.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:s.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:s.dispatchSwapBackgroundForeground};n.Palette=o.connect(function(e,t){var n=e.store.present,r=e.editor,i=n;return i?{selected:r.selectedColor,backgroundColor:r.backgroundColor,colors:i.colors}:{}},c)(l)},{"../actions/dispatch":27,react:284,"react-redux":263}],31:[function(e,t,n){"use strict";var h=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var r,i,o,a,s,l,c,u,m=e("../actions/types");(u=r=n.ImageEditorTool||(n.ImageEditorTool={}))[u.Paint=0]="Paint",u[u.Fill=1]="Fill",u[u.Line=2]="Line",u[u.Erase=3]="Erase",u[u.Circle=4]="Circle",u[u.Rect=5]="Rect",u[u.ColorSelect=6]="ColorSelect",u[u.Marquee=7]="Marquee",u[u.Pan=8]="Pan",(c=n.CursorSize||(n.CursorSize={}))[c.One=1]="One",c[c.Three=3]="Three",c[c.Five=5]="Five",(l=n.KeyModifiers||(n.KeyModifiers={}))[l.Alt=1]="Alt",l[l.Shift=2]="Shift",(s=i=n.TileCategory||(n.TileCategory={}))[s.Forest=0]="Forest",s[s.Aquatic=1]="Aquatic",s[s.Dungeon=2]="Dungeon",s[s.Misc=3]="Misc",(a=o=n.TileDrawingMode||(n.TileDrawingMode={})).Default="default";var p,d={store:{present:{visible:!0,colors:["#000000","#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"],aspectRatioLocked:!(a.Wall="wall"),currentFrame:0,frames:[b(16,16)],interval:200},past:[],future:[]},editor:{selectedColor:3,tool:r.Paint,cursorSize:1,backgroundColor:1,previewAnimating:!1,onionSkinEnabled:!1,overlayEnabled:!0,isTilemap:!1}},f=function(n,r){switch(r.type){case m.TOGGLE_ASPECT_RATIO:return _("toggle-aspect-ratio-lock"),h({},n,{aspectRatioLocked:!n.aspectRatioLocked});case m.CHANGE_CURRENT_FRAME:return _("change-frame"),h({},n,{currentFrame:r.index});case m.CHANGE_INTERVAL:return _("change-interval"),h({},n,{interval:r.newInterval});case m.CHANGE_IMAGE_DIMENSIONS:_("change-dimensions");var e=r.imageDimensions,i=e[0],o=e[1];return h({},n,{frames:n.frames.map(function(e,t){return h({},e,{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).resize(i,o).data()})})});case m.IMAGE_EDIT:return _("image-edit"),h({},n,{frames:n.frames.map(function(e,t){return t===n.currentFrame?r.newState:e})});case m.DELETE_FRAME:if(1===n.frames.length)return n;_("delete-frame");var t=n.frames.slice();t.splice(r.index,1);var a=n.currentFrame;return n.currentFrame>=r.index&&0<n.currentFrame&&a--,h({},n,{currentFrame:a,frames:t});case m.DUPLICATE_FRAME:_("duplicate-frame");var s=n.frames.slice();return s.splice(r.index,0,((u=n.frames[r.index]).floating&&(u.floating.bitmap&&(d=pxt.sprite.Bitmap.fromData(u.floating.bitmap).copy().data()),u.floating.overlayLayers&&(f=u.floating.overlayLayers.map(function(e){return pxt.sprite.Bitmap.fromData(e).copy().data()})),p={bitmap:d,overlayLayers:f}),h({},u,{bitmap:pxt.sprite.Bitmap.fromData(u.bitmap).copy().data(),overlayLayers:u.overlayLayers&&u.overlayLayers.map(function(e){return pxt.sprite.Bitmap.fromData(e).copy().data()}),floating:p}))),h({},n,{frames:s,currentFrame:r.index+1});case m.NEW_FRAME:return _("new-frame"),h({},n,{frames:n.frames.concat([b(n.frames[0].bitmap.width,n.frames[0].bitmap.height)]),currentFrame:n.frames.length});case m.MOVE_FRAME:if(r.newIndex<0||r.newIndex>=n.frames.length||r.newIndex<0||r.newIndex>=n.frames.length)return n;_("move-frame");var l=n.frames.slice(),c=l.splice(r.oldIndex,1)[0];return l.splice(r.newIndex,0,c),h({},n,{frames:l,currentFrame:r.oldIndex===n.currentFrame?r.newIndex:n.currentFrame});default:return n}var u,p,d,f},g=function(e,t){switch(t.type){case m.CHANGE_PREVIEW_ANIMATING:return _("preview-animate-"+(t.animating?"on":"off")),h({},e,{previewAnimating:t.animating});case m.CHANGE_CANVAS_ZOOM:return(0<t.zoom||t.zoom<0)&&_("zoom-"+(0<t.zoom?"in":"out")),h({},e,{zoomDelta:t.zoom});case m.CHANGE_IMAGE_TOOL:return _("change-tool-"+r[t.tool]),h({},e,{tool:t.tool});case m.CHANGE_CURSOR_SIZE:return _("change-cursor-size-"+t.cursorSize),h({},e,{cursorSize:t.cursorSize});case m.CHANGE_SELECTED_COLOR:return _("foreground-color-"+t.selectedColor),h({},e,{selectedColor:t.selectedColor,tool:e.tool===r.Erase?r.Paint:e.tool});case m.CHANGE_CURSOR_LOCATION:return h({},e,{cursorLocation:t.cursorLocation});case m.CHANGE_BACKGROUND_COLOR:return _("background-color-"+t.backgroundColor),h({},e,{backgroundColor:t.backgroundColor});case m.SWAP_FOREGROUND_BACKGROUND:return _("swap-foreground-background"),h({},e,{backgroundColor:e.selectedColor,selectedColor:e.backgroundColor});case m.TOGGLE_ONION_SKIN_ENABLED:return _("toggle-onion-skin"),h({},e,{onionSkinEnabled:!e.onionSkinEnabled});case m.CHANGE_TILE_PALETTE_CATEGORY:return _("change-tile-category-"+i[t.category]),h({},e,{tilemapPalette:h({},e.tilemapPalette,{category:t.category,page:0})});case m.CHANGE_TILE_PALETTE_PAGE:return _("change-tile-page"),h({},e,{tilemapPalette:h({},e.tilemapPalette,{page:t.page})});case m.CHANGE_DRAWING_MODE:return _("change-drawing-mode"),h({},e,{drawingMode:t.drawingMode||o.Default});case m.CHANGE_OVERLAY_ENABLED:return _("change-overlay-enabled"),h({},e,{overlayEnabled:t.enabled});case m.CREATE_NEW_TILE:return h({},e,{selectedColor:t.foreground,backgroundColor:t.background});case m.SET_GALLERY_OPEN:return _("set-gallery-open-"+t.open),h({},e,{tileGalleryOpen:t.open,tilemapPalette:h({},e.tilemapPalette,{page:0})});case m.DELETE_TILE:return h({},e,{selectedColor:t.index===e.selectedColor?0:e.selectedColor,backgroundColor:t.index===e.backgroundColor?0:e.backgroundColor});case m.OPEN_TILE_EDITOR:var n=t.index?"edit":"new";return _("open-tile-editor-"+n),h({},e,{editingTile:{type:n,tilesetIndex:t.index}});case m.CLOSE_TILE_EDITOR:return h({},e,{editingTile:void 0})}return e},v=function(e,t){switch(t.type){case m.TOGGLE_ASPECT_RATIO:return _("toggle-aspect-ratio-lock"),h({},e,{aspectRatioLocked:!e.aspectRatioLocked});case m.CHANGE_IMAGE_DIMENSIONS:_("change-dimensions");var n=t.imageDimensions,r=n[0],i=n[1];return h({},e,{tilemap:h({},e.tilemap,{bitmap:pxt.sprite.Tilemap.fromData(e.tilemap.bitmap).resize(r,i).data()})});case m.CREATE_NEW_TILE:var o=!t.qualifiedName;return _(o?"new-tile":"used-tile-"+t.qualifiedName),h({},e,{tileset:y(e.tileset,t.bitmap,o?e.nextId:void 0,t.qualifiedName),nextId:o?e.nextId+1:e.nextId});case m.CLOSE_TILE_EDITOR:return _("close-tile-editor"),t.result?t.index?h({},e,{tileset:(s=e.tileset,l=t.index,c=t.result,h({},s,{tiles:s.tiles.map(function(e,t){return t===l?h({},e,{data:c}):e})}))}):h({},e,{tileset:y(e.tileset,t.result,e.nextId),nextId:e.nextId+1}):e;case m.DELETE_TILE:_("delete-tile");var a=e.tileset.tiles.slice();return a.splice(t.index,1),h({},e,{tilemap:h({},e.tilemap,{bitmap:function(e,t){for(var n=t.copy(),r=0;r<n.width;r++)for(var i=0;i<n.height;i++){var o=n.get(r,i);o===e?n.set(r,i,0):e<o&&n.set(r,i,o-1)}return n}(t.index,pxt.sprite.Tilemap.fromData(e.tilemap.bitmap)).data()}),tileset:h({},e.tileset,{tiles:a})});case m.IMAGE_EDIT:return _("image-edit"),h({},e,{tilemap:t.newState});default:return e}var s,l,c};function y(e,t,n,r){var i=e.tiles.slice();return 0===i.length&&i.push({data:new pxt.sprite.Bitmap(e.tileWidth,e.tileWidth).data(),projectId:0}),n?i.push({data:t,projectId:n}):r?i.push({data:t,qualifiedName:r}):i.push({data:t}),h({},e,{tiles:i})}function b(e,t){return{bitmap:new pxt.sprite.Bitmap(e,t).data()}}function _(e){p&&p(e)}n.setTelemetryFunction=function(e){p=e},n.default=function(e,t){switch(void 0===e&&(e=d),t.type){case m.OPEN_TILE_EDITOR:case m.CHANGE_PREVIEW_ANIMATING:case m.CHANGE_CANVAS_ZOOM:case m.CHANGE_IMAGE_TOOL:case m.CHANGE_CURSOR_SIZE:case m.CHANGE_SELECTED_COLOR:case m.CHANGE_CURSOR_LOCATION:case m.CHANGE_BACKGROUND_COLOR:case m.SWAP_FOREGROUND_BACKGROUND:case m.TOGGLE_ONION_SKIN_ENABLED:case m.CHANGE_OVERLAY_ENABLED:case m.CHANGE_TILE_PALETTE_PAGE:case m.CHANGE_TILE_PALETTE_CATEGORY:case m.CHANGE_DRAWING_MODE:case m.SET_GALLERY_OPEN:return h({},e,{editor:g(e.editor,t)});case m.SET_INITIAL_STATE:var n=t.state;return h({},e,{editor:h({},d.editor,{selectedColor:n.selectedColor,backgroundColor:n.backgroundColor,tilemapPalette:n.tilemapPalette,tileGalleryOpen:n.tileGalleryOpen,tileGallery:n.tileGallery,isTilemap:n.isTilemap}),store:h({},e.store,{past:t.past||e.store.past,future:t.past?[]:e.store.future})});case m.UNDO_IMAGE_EDIT:return e.store.past.length?(_("undo"),h({},e,{store:h({},e.store,{past:e.store.past.slice(0,e.store.past.length-1),present:e.store.past[e.store.past.length-1],future:e.store.future.concat([e.store.present])})})):e;case m.REDO_IMAGE_EDIT:return e.store.future.length?(_("redo"),h({},e,{store:h({},e.store,{past:e.store.past.concat([e.store.present]),present:e.store.future[e.store.future.length-1],future:e.store.future.slice(0,e.store.future.length-1)})})):e;case m.SET_INITIAL_FRAMES:return h({},e,{editor:h({},d.editor,{isTilemap:!1}),store:h({},e.store,{past:[],present:{visible:!0,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:!1,currentFrame:0,frames:t.frames,interval:t.interval},future:[]})});case m.SET_INITIAL_TILEMAP:return h({},e,{editor:h({},e.editor,{isTilemap:!0,tilemapPalette:{category:i.Forest,page:0},drawingMode:o.Default,overlayEnabled:!0,tileGallery:t.gallery}),store:h({},e.store,{past:[],present:{colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:!1,tilemap:{bitmap:t.tilemap,overlayLayers:t.layers},tileset:function(e,t){for(var n=0,r=e.tiles;n<r.length;n++){var i=r[n];if(!i.data&&i.qualifiedName)for(var o=0,a=t;o<a.length;o++){var s=a[o];if(s.qualifiedName===i.qualifiedName){i.data=s.bitmap;break}}}return e}(t.tileset,t.gallery),nextId:t.nextId},future:[]})});default:return h({},e,{editor:g(e.editor,t),store:h({},e.store,{past:e.store.past.concat([e.store.present]),present:e.editor.isTilemap?v(e.store.present,t):f(e.store.present,t),future:[]})})}}},{"../actions/types":28}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("redux"),i=e("./imageReducer"),o=r.createStore(i.default);n.default=o,n.tileEditorStore=r.createStore(i.default),n.mainStore=o},{"./imageReducer":31,redux:305}],33:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("react-redux"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tileColors=[],e}return i(e,t),e.prototype.componentDidMount=function(){this.canvas=this.refs["minimap-canvas"],this.redrawCanvas()},e.prototype.componentDidUpdate=function(){this.redrawCanvas()},e.prototype.render=function(){return o.createElement("div",{className:"minimap-outer"},o.createElement("canvas",{ref:"minimap-canvas",className:"paint-surface"}))},e.prototype.redrawCanvas=function(){var e=this.props.tilemap,t=e.bitmap,n=e.floating,r=e.layerOffsetX,i=e.layerOffsetY,o=this.canvas.getContext("2d"),a=pxt.sprite.Tilemap.fromData(t),s=n&&n.bitmap?pxt.sprite.Tilemap.fromData(n.bitmap):null;this.canvas.width=a.width,this.canvas.height=a.height,this.tileColors=[];for(var l=0;l<a.width;l++)for(var c=0;c<a.height;c++){var u=s?s.get(l-r,c-i):null,p=a.get(l,c);u?(o.fillStyle=this.getColor(u),o.fillRect(l,c,1,1)):p?(o.fillStyle=this.getColor(p),o.fillRect(l,c,1,1)):o.clearRect(l,c,1,1)}},e.prototype.getColor=function(e){if(!this.tileColors[e]){var t=this.props,n=t.tileset,r=t.colors;if(e>=n.tiles.length)return"#ffffff";var i=pxt.sprite.Bitmap.fromData(n.tiles[e].data);this.tileColors[e]=pxt.sprite.computeAverageColor(i,r)}return this.tileColors[e]},e}(o.Component);n.Minimap=a.connect(function(e,t){var n=e.store.present,r=(e.editor,n);return r?{tilemap:r.tilemap,tileset:r.tileset,colors:r.colors}:{}},{})(s)},{react:284,"react-redux":263}],34:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var h=e("react"),o=e("react-redux"),m=e("../store/imageReducer"),a=e("../actions/dispatch"),g=e("../TimelineFrame"),v=e("../Dropdown"),y=e("../Pivot"),b=e("../Button"),p=pxt.BrowserUtils.isEdge()?25:1,_=[{id:"forest",text:"Forest"},{id:"aquatic",text:"Aquatic"},{id:"dungeon",text:"Dungeon"},{id:"misc",text:"Miscellaneous"}],w=[{id:"custom",text:"My Tiles"},{id:"gallery",text:"Gallery"}],k=new pxt.sprite.Bitmap(16,16),s=function(e){function t(){var d=null!==e&&e.apply(this,arguments)||this;return d.dropdownHandler=function(e,t){d.props.dispatchChangeTilePaletteCategory(t)},d.pivotHandler=function(e,t){d.props.dispatchSetGalleryOpen(1===t)},d.pageHandler=function(e){d.props.dispatchChangeTilePalettePage(e)},d.tileCreateHandler=function(){d.props.dispatchOpenTileEditor()},d.tileEditHandler=function(){var e=d.props,t=e.tileset,n=e.selected,r=e.dispatchOpenTileEditor;t.tiles[n]&&!t.tiles[n].qualifiedName&&0!==n&&r(n)},d.tileDuplicateHandler=function(){var e=d.props,t=e.tileset,n=e.selected,r=e.backgroundColor,i=e.dispatchCreateNewTile;t.tiles[n]&&!t.tiles[n].qualifiedName&&0!==n&&i(t.tiles[n].data,t.tiles.length,r)},d.tileDeleteHandler=function(){var e=d.props,t=e.tileset,n=e.selected,r=e.dispatchDeleteTile;t.tiles[n]&&!t.tiles[n].qualifiedName&&0!==n&&r(n)},d.canvasClickHandler=function(e){var t=d.canvas.getBoundingClientRect(),n=(e.clientX-t.left)/(t.width/4)|0,r=(e.clientY-t.top)/(t.height/4)|0,i=d.renderedTiles[4*r+n];if(i){var o=void 0,a=void 0;x(i)?(o=d.getTileIndex(i),a=i.qualifiedName):o=i.index;var s=0<e.button;if(0<=o)s?d.props.dispatchChangeBackgroundColor(o):d.props.dispatchChangeSelectedColor(o),d.props.dispatchChangeDrawingMode(m.TileDrawingMode.Default);else{var l=d.props,c=l.selected,u=l.backgroundColor,p=l.tileset.tiles.length;d.props.dispatchCreateNewTile(i.bitmap,s?c:p,s?p:u,a)}}},d.foregroundBackgroundClickHandler=function(){d.props.drawingMode!=m.TileDrawingMode.Default?d.props.dispatchChangeDrawingMode(m.TileDrawingMode.Default):d.props.dispatchSwapBackgroundForeground()},d.wallClickHandler=function(){d.props.dispatchChangeDrawingMode(m.TileDrawingMode.Wall)},d.preventContextMenu=function(e){return e.preventDefault()},d}return i(t,e),t.prototype.componentDidMount=function(){this.canvas=this.refs["tile-canvas-surface"],this.updateGalleryTiles(),this.redrawCanvas()},t.prototype.componentDidUpdate=function(){this.updateGalleryTiles(),this.redrawCanvas()},t.prototype.render=function(){var e=this.props,t=e.colors,n=e.selected,r=e.backgroundColor,i=e.tileset,o=e.category,a=e.page,s=e.drawingMode,l=e.galleryOpen,c=i.tiles[n]?i.tiles[n].data:k.data(),u=i.tiles[r]?i.tiles[r].data:k.data();k.data(),this.updateGalleryTiles();var p=Math.ceil(this.categoryTiles.length/16);l||this.categoryTiles.length%16!=0||p++;var d=!l&&(1===p||a===p-1),f=l||!this.renderedTiles.some(function(e){return!x(e)&&e.index===n});return h.createElement("div",{className:"tile-palette"},h.createElement("div",{className:"tile-palette-fg-bg"},h.createElement("div",{className:"tile-palette-swatch fg "+(s==m.TileDrawingMode.Default?"selected":""),onClick:this.foregroundBackgroundClickHandler,role:"button"},h.createElement(g.TimelineFrame,{frames:[{bitmap:c}],colors:t})),h.createElement("div",{className:"tile-palette-swatch bg",onClick:this.foregroundBackgroundClickHandler,role:"button"},h.createElement(g.TimelineFrame,{frames:[{bitmap:u}],colors:t}),h.createElement(b.IconButton,{iconClass:"ms-Icon ms-Icon--ReturnKey",title:lf("Swap the background and foreground colors."),toggle:!0})),h.createElement("div",{className:"tile-palette-swatch wall "+(s==m.TileDrawingMode.Wall?"selected":""),onClick:this.wallClickHandler,role:"button"},h.createElement("span",{className:"xicon wall"}))),h.createElement(y.Pivot,{options:w,selected:l?1:0,onChange:this.pivotHandler}),h.createElement("div",{className:"tile-palette-controls-outer"},l&&h.createElement(v.Dropdown,{onChange:this.dropdownHandler,options:_,selected:o}),!l&&h.createElement("div",{className:"tile-palette-controls"},h.createElement(b.IconButton,{onClick:this.tileEditHandler,iconClass:"ms-Icon ms-Icon--SingleColumnEdit",title:lf("Edit the selected tile"),disabled:f,toggle:!f}),h.createElement(b.IconButton,{onClick:this.tileDuplicateHandler,iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate the selected tile"),disabled:f,toggle:!f}),h.createElement(b.IconButton,{onClick:this.tileDeleteHandler,iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete the selected tile"),disabled:f,toggle:!f}))),h.createElement("div",{className:"tile-canvas-outer",onContextMenu:this.preventContextMenu},h.createElement("div",{className:"tile-canvas"},h.createElement("canvas",{ref:"tile-canvas-surface",className:"paint-surface",onMouseDown:this.canvasClickHandler,role:"complementary"}),d&&h.createElement("div",{ref:"create-tile-ref"},h.createElement(b.IconButton,{onClick:this.tileCreateHandler,iconClass:"ms-Icon ms-Icon--Add",title:lf("Create a new tile"),toggle:!0}))),h.createElement("div",{className:"tile-canvas-controls"},function(e,t,n){for(var r=16+5*(e-1),i=[],o=0;o<e;o++)i[o]=o===t;return h.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 "+r+" 10",className:"tile-palette-pages"},h.createElement("polygon",{className:"tile-palette-page-arrow",points:"1,5 4,3 4,7",onClick:t?function(){return n(t-1)}:void 0}),i.map(function(e,t){return h.createElement("circle",{className:"tile-palette-page-dot",key:t,cx:8+5*t,cy:"5",r:e?2:1,onClick:e?void 0:function(){return n(t)}})}),h.createElement("polygon",{className:"tile-palette-page-arrow",points:r-1+",5 "+(r-4)+",3 "+(r-4)+",7",onClick:t<e-1?function(){return n(t+1)}:void 0}))}(p,a,this.pageHandler))))},t.prototype.updateGalleryTiles=function(){var e=this.props,t=e.tileset,n=e.page,r=e.gallery,i=e.category,o=e.galleryOpen;this.categoryTiles=o?r.filter(function(e){return-1!==e.tags.indexOf(_[i].id)&&e.tileWidth===t.tileWidth}):t.tiles.map(function(e,t){return[e,t]}).filter(function(e){var t=e[0];return null!=t.projectId&&t.data}).sort(function(e,t){var n=e[0],r=t[0];return n.projectId-r.projectId}).map(function(e){var t=e[0];return{index:e[1],bitmap:t.data}});var a=16*n;this.renderedTiles=this.categoryTiles.slice(a,a+16)},t.prototype.redrawCanvas=function(){var e=this.props,t=e.tileset,n=e.page,r=e.selected,i=4*n*4,o=t.tileWidth+1;this.canvas.width=(4*o+1)*p,this.canvas.height=(4*o+1)*p;for(var a=this.canvas.getContext("2d"),s=0;s<4;s++)for(var l=0;l<4;l++){var c=this.categoryTiles[i+4*s+l];c&&(x(c)||c.index!==r||(a.fillStyle="#ff0000",a.fillRect(l*o,s*o,o+1,o+1)),a.fillStyle="#333333",a.fillRect(l*o+1,s*o+1,o-1,o-1),this.drawBitmap(pxt.sprite.Bitmap.fromData(c.bitmap),1+l*o,1+s*o))}this.positionCreateTileButton()},t.prototype.drawBitmap=function(e,t,n,r,i,o){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=!0),void 0===i&&(i=p),void 0===o&&(o=this.canvas);var a=this.props.colors,s=o.getContext("2d");s.imageSmoothingEnabled=!1;for(var l=0;l<e.width;l++)for(var c=0;c<e.height;c++){var u=e.get(l,c);u?(s.fillStyle=a[u],s.fillRect((l+t)*i,(c+n)*i,i,i)):r||s.clearRect((l+t)*i,(c+n)*i,i,i)}},t.prototype.positionCreateTileButton=function(){var e=this.refs["create-tile-ref"];if(e){var t=this.categoryTiles.length%4,n=Math.floor(this.categoryTiles.length/4);e.style.position="absolute",e.style.left=25*t+"%",e.style.top=25*n+"%"}},t.prototype.getTileIndex=function(e){for(var t=this.props.tileset,n=0;n<t.tiles.length;n++)if(t.tiles[n].qualifiedName===e.qualifiedName)return n;return-1},t}(h.Component);function x(e){return!!e.qualifiedName}var l={dispatchChangeSelectedColor:a.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:a.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:a.dispatchSwapBackgroundForeground,dispatchChangeTilePalettePage:a.dispatchChangeTilePalettePage,dispatchChangeTilePaletteCategory:a.dispatchChangeTilePaletteCategory,dispatchChangeDrawingMode:a.dispatchChangeDrawingMode,dispatchCreateNewTile:a.dispatchCreateNewTile,dispatchSetGalleryOpen:a.dispatchSetGalleryOpen,dispatchOpenTileEditor:a.dispatchOpenTileEditor,dispatchDeleteTile:a.dispatchDeleteTile};n.TilePalette=o.connect(function(e,t){var n=e.store.present,r=e.editor,i=n;return i?{selected:r.selectedColor,tileset:i.tileset,backgroundColor:r.backgroundColor,category:r.tilemapPalette.category,page:r.tilemapPalette.page,colors:i.colors,drawingMode:r.drawingMode,gallery:r.tileGallery,galleryOpen:r.tileGalleryOpen}:{}},l)(s)},{"../Button":16,"../Dropdown":18,"../Pivot":21,"../TimelineFrame":24,"../actions/dispatch":27,"../store/imageReducer":31,react:284,"react-redux":263}],35:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o,a,s=e("./store/imageReducer");(a=o=n.ToolCursor||(n.ToolCursor={})).None="none",a.Default="default",a.Pointer="pointer",a.Crosshair="crosshair",a.Grab="grab",a.Grabbing="grabbing",a.EyeDropper="var(--eyedropper)",n.tools=[{tool:s.ImageEditorTool.Paint,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Paint Tool"),hoverCursor:o.Crosshair},{tool:s.ImageEditorTool.Erase,iconClass:"ms-Icon ms-Icon--EraseTool",title:lf("Erase Tool"),hoverCursor:o.Crosshair},{tool:s.ImageEditorTool.Rect,iconClass:"ms-Icon ms-Icon--RectangleShape",title:lf("Rectangle Tool"),hoverCursor:o.Crosshair},{tool:s.ImageEditorTool.Fill,iconClass:"ms-Icon ms-Icon--BucketColor",title:lf("Fill Tool"),hoverCursor:o.Crosshair},{tool:s.ImageEditorTool.Circle,iconClass:"ms-Icon ms-Icon--CircleRing",title:lf("Circle Tool"),hoverCursor:o.Crosshair},{tool:s.ImageEditorTool.Line,iconClass:"ms-Icon ms-Icon--Line",title:lf("Line Tool"),hoverCursor:o.Crosshair},{tool:s.ImageEditorTool.Marquee,iconClass:"ms-Icon ms-Icon--SelectAll",title:lf("Marquee Tool"),hoverCursor:o.Crosshair,hoverLayerCursor:o.Grab,downLayerCursor:o.Grabbing},{tool:s.ImageEditorTool.Pan,iconClass:"ms-Icon ms-Icon--HandsFree",title:lf("Canvas Pan Tool"),hoverCursor:o.Grab,downCursor:o.Grabbing},{tool:s.ImageEditorTool.ColorSelect,hiddenTool:!0,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Color Select Tool"),hoverCursor:o.EyeDropper}],n.getEdit=function(e,t,n,r){switch(e){case s.ImageEditorTool.Paint:return new p(t.width,t.height,n,r);case s.ImageEditorTool.Rect:return new f(t.width,t.height,n,r);case s.ImageEditorTool.Fill:return new g(t.width,t.height,n,r);case s.ImageEditorTool.Line:return new h(t.width,t.height,n,r);case s.ImageEditorTool.Marquee:return new v(t.width,t.height,n,r);case s.ImageEditorTool.Circle:return new m(t.width,t.height,n,r);case s.ImageEditorTool.Erase:return new p(t.width,t.height,0,r);case s.ImageEditorTool.ColorSelect:default:return}},n.getEditState=function(e,t,n){void 0===n&&(n=s.TileDrawingMode.Default);var r,i,o,a=new l(t?pxt.sprite.Tilemap.fromData(e.bitmap).copy():pxt.sprite.Bitmap.fromData(e.bitmap).copy());return e.overlayLayers&&(a.overlayLayers=e.overlayLayers.map(function(e){return pxt.sprite.Bitmap.fromData(e).copy()})),a.layerOffsetX=e.layerOffsetX,a.layerOffsetY=e.layerOffsetY,e.floating&&(e.floating.bitmap&&(i=t?pxt.sprite.Tilemap.fromData(e.floating.bitmap).copy():pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy()),e.floating.overlayLayers&&(o=e.floating.overlayLayers.map(function(e){return pxt.sprite.Bitmap.fromData(e).copy()})),r={image:i,overlayLayers:o}),a.floating=r,a.setActiveLayer(n),a};var l=function(){function r(e){this.activeLayerIndex=-1,this.image=e,this.layerOffsetX=0,this.layerOffsetY=0}return Object.defineProperty(r.prototype,"width",{get:function(){return this.image.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.image.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"activeLayer",{get:function(){return this.activeLayerIndex<0?this.image:this.overlayLayers[this.activeLayerIndex]},enumerable:!0,configurable:!0}),r.prototype.setActiveLayer=function(e){switch(e){case s.TileDrawingMode.Wall:this.activeLayerIndex=0;break;default:this.activeLayerIndex=-1}},r.prototype.copy=function(){var e=new r;if(e.image=this.image.copy(),e.overlayLayers=this.overlayLayers&&this.overlayLayers.map(function(e){return e.copy()}),this.floating){var t=void 0,n=void 0;this.floating.image&&(t=this.floating.image.copy()),this.floating.overlayLayers&&(n=this.floating.overlayLayers.map(function(e){return e.copy()})),e.floating={image:t,overlayLayers:n}}return e.layerOffsetX=this.layerOffsetX,e.layerOffsetY=this.layerOffsetY,e},r.prototype.equals=function(e){return!(!this.image.equals(e.image)||this.floating&&!e.floating||!this.floating&&e.floating)&&(!this.floating||!this.floating.image||this.floating.image.equals(e.floating.image)&&this.layerOffsetX===e.layerOffsetX&&this.layerOffsetY===e.layerOffsetY)},r.prototype.mergeFloatingLayer=function(){var n=this;this.floating&&(this.floating.image||this.floating.overlayLayers)&&(this.floating.image&&(this.floating.image.x0=this.layerOffsetX,this.floating.image.y0=this.layerOffsetY,this.image.apply(this.floating.image,!0),this.floating.image=void 0),this.floating.overlayLayers&&(this.floating.overlayLayers.forEach(function(e,t){e.x0=n.layerOffsetX,e.y0=n.layerOffsetY,n.overlayLayers[t].apply(e,!0)}),this.floating.overlayLayers=void 0))},r.prototype.copyToLayer=function(r,i,t,o,e){if(void 0===e&&(e=!1),0!==t&&0!==o){t<0&&(r+=t,t=-t),o<0&&(i+=o,o=-o);var n,a=this.image.copy(r,i,t,o);if(this.layerOffsetX=a.x0,this.layerOffsetY=a.y0,a.x0=void 0,a.y0=void 0,this.overlayLayers&&(n=this.overlayLayers.map(function(e){return e.copy(r,i,t,o)})),e)for(var s=function(n){for(var e=function(t){l.image.set(r+n,i+t,0),l.overlayLayers&&l.overlayLayers.forEach(function(e){return e.set(r+n,i+t,0)})},t=0;t<o;t++)e(t)},l=this,c=0;c<t;c++)s(c);this.floating={image:a,overlayLayers:n}}},r.prototype.inFloatingLayer=function(e,t){return!(!this.floating||!this.floating.image)&&(e-=this.layerOffsetX,t-=this.layerOffsetY,0<=e&&e<this.floating.image.width&&0<=t&&t<this.floating.image.height)},r}();n.EditState=l;var c=function(){function e(e,t,n,r){this.canvasWidth=e,this.canvasHeight=t,this.color=n,this.toolWidth=r}return e.prototype.doEdit=function(e){this.isStarted&&this.doEditCore(e)},e.prototype.inBounds=function(e,t){return 0<=e&&e<this.canvasWidth&&0<=t&&t<this.canvasHeight},e.prototype.start=function(e,t,n){this.isStarted=!0,this.startCol=e,this.startRow=t},e.prototype.drawCursor=function(e,t,n){n(e,t)},e}(),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.update=function(e,t){this.endCol=e,this.endRow=t,this.isDragged||e==this.startCol&&t==this.startRow||(this.isDragged=!0)},t.prototype.topLeft=function(){return{x:Math.min(this.startCol,this.endCol),y:Math.min(this.startRow,this.endRow)}},t.prototype.bottomRight=function(){return{x:Math.max(this.startCol,this.endCol),y:Math.max(this.startRow,this.endRow)}},t}(n.Edit=c);n.SelectionEdit=u;var p=function(o){function e(e,t,n,r){var i=o.call(this,e,t,n,r)||this;return i.showPreview=!0,i.mask=new pxt.sprite.Bitmask(e,t),i}return i(e,o),e.prototype.update=function(e,t){this.interpolate(this.startCol,this.startRow,e,t),this.startCol=e,this.startRow=t},e.prototype.interpolate=function(e,t,n,r){var i=this,o=n-e,a=r-t,s=function(e,t){return i.mask.set(e,t)};if(0!==o)for(var l=0<o?1:-1,c=0<a?1:-1,u=Math.abs(a/o),p=0,d=t,f=e;0<l?f<=n:n<=f;f+=l)for(this.drawCore(f,d,s),p+=u;.5<=p;)(0<c?d<=r:r<=d)&&this.drawCore(f,d,s),d+=c,p-=1;else for(var h=0<=a?r:t,m=0<=a?t:r;m<=h;m++)this.drawCore(e,m,s)},e.prototype.doEditCore=function(e){e.mergeFloatingLayer();for(var t=0;t<e.width;t++)for(var n=0;n<e.height;n++)this.mask.get(t,n)&&e.activeLayer.set(t,n,this.color)},e.prototype.drawCursor=function(e,t,n){this.drawCore(e,t,n)},e.prototype.drawCore=function(e,t,n){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(var r=0;r<this.toolWidth;r++)for(var i=0;i<this.toolWidth;i++){var o=e+r,a=t+i;0<=o&&o<this.canvasWidth&&0<=a&&a<this.canvasHeight&&n(e+r,t+i)}},e}(c);n.PaintEdit=p;var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.showPreview=!0,e}return i(e,t),e.prototype.doEditCore=function(e){e.mergeFloatingLayer();for(var t=this.topLeft(),n=this.bottomRight(),r=t.x;r<=n.x;r++)for(var i=t.y;i<=n.y;i++)e.activeLayer.set(r,i,this.color)},e}(u);n.RectangleEdit=d;var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.showPreview=!0,e}return i(e,t),e.prototype.doEditCore=function(e){e.mergeFloatingLayer();var t=this.topLeft();t.x-=this.toolWidth>>1,t.y-=this.toolWidth>>1;var n=this.bottomRight();n.x+=this.toolWidth>>1,n.y+=this.toolWidth>>1;for(var r=0;r<this.toolWidth;r++)this.drawRectangle(e,{x:t.x+r,y:t.y+r},{x:n.x-r,y:n.y-r})},e.prototype.drawRectangle=function(e,t,n){if(!(t.x>n.x||t.y>n.y)){for(var r=t.x;r<=n.x;r++)e.activeLayer.set(r,t.y,this.color),e.activeLayer.set(r,n.y,this.color);for(var i=t.y;i<=n.y;i++)e.activeLayer.set(t.x,i,this.color),e.activeLayer.set(n.x,i,this.color)}},e.prototype.drawCursor=function(e,t,n){this.drawCore(e,t,n)},e.prototype.drawCore=function(e,t,n){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(var r=0;r<this.toolWidth;r++)for(var i=0;i<this.toolWidth;i++){var o=e+r,a=t+i;0<=o&&o<this.canvasWidth&&0<=a&&a<this.canvasHeight&&n(e+r,t+i)}},e}(u);n.OutlineEdit=f;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.showPreview=!0,e}return i(e,t),e.prototype.doEditCore=function(e){e.mergeFloatingLayer(),this.bresenham(this.startCol,this.startRow,this.endCol,this.endRow,e)},e.prototype.bresenham=function(e,t,n,r,i){var o=this,a=n-e,s=r-t,l=function(e,t){return i.activeLayer.set(e,t,o.color)};if(0!==a)for(var c=0<a?1:-1,u=0<s?1:-1,p=Math.abs(s/a),d=0,f=t,h=e;0<c?h<=n:n<=h;h+=c)for(this.drawCore(h,f,l),d+=p;.5<=d;)(0<u?f<=r:r<=f)&&this.drawCore(h,f,l),f+=u,d-=1;else for(var m=0<=s?r:t,g=0<=s?t:r;g<=m;g++)this.drawCore(e,g,l)},e.prototype.drawCursor=function(e,t,n){this.drawCore(e,t,n)},e.prototype.drawCore=function(e,t,n){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(var r=0;r<this.toolWidth;r++)for(var i=0;i<this.toolWidth;i++)n(e+r,t+i)},e}(u);n.LineEdit=h;var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.showPreview=!0,e}return i(e,t),e.prototype.doEditCore=function(e){e.mergeFloatingLayer();var t=this.topLeft(),n=this.bottomRight(),r=n.x-t.x,i=n.y-t.y,o=Math.floor(Math.hypot(r,i)),a=this.startCol,s=this.startRow;this.midpoint(a,s,o,e)},e.prototype.midpoint=function(e,t,n,r){for(var i=n-1,o=0,a=1,s=1,l=a-2*n;o<=i;)r.activeLayer.set(e+i,t+o,this.color),r.activeLayer.set(e+i,t-o,this.color),r.activeLayer.set(e+o,t+i,this.color),r.activeLayer.set(e+o,t-i,this.color),r.activeLayer.set(e-o,t+i,this.color),r.activeLayer.set(e-o,t-i,this.color),r.activeLayer.set(e-i,t+o,this.color),r.activeLayer.set(e-i,t-o,this.color),l<=0&&(o++,l+=s,s+=2),0<l&&(i--,l+=(a+=2)-2*n)},e}(u);n.CircleEdit=m;var g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.showPreview=!0,e}return i(e,t),e.prototype.start=function(e,t,n){this.isStarted=!0,this.col=e,this.row=t},e.prototype.update=function(e,t){this.col=e,this.row=t},e.prototype.doEditCore=function(e){var t=e.activeLayer.get(this.col,this.row);if(t!==this.color){e.mergeFloatingLayer();var n=new pxt.sprite.Bitmask(e.width,e.height);n.set(this.col,this.row);for(var r=[{x:this.col,y:this.row}];r.length;){var i=r.pop();e.activeLayer.get(i.x,i.y)===t&&(e.activeLayer.set(i.x,i.y,this.color),o(i.x+1,i.y),o(i.x-1,i.y),o(i.x,i.y+1),o(i.x,i.y-1))}}function o(e,t){0<=e&&e<n.width&&0<=t&&t<n.height&&!n.get(e,t)&&(n.set(e,t),r.push({x:e,y:t}))}},e}(c);n.FillEdit=g;var v=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.isMove=!1,e.showPreview=!1,e}return i(e,n),e.prototype.start=function(e,t,n){this.isStarted=!0,this.startCol=e,this.startRow=t,n.floating&&n.floating.image&&n.inFloatingLayer(e,t)&&(this.isMove=!0,this.startOffsetX=n.layerOffsetX,this.startOffsetY=n.layerOffsetY)},e.prototype.inBounds=function(e,t){return this.isMove||n.prototype.inBounds.call(this,e,t)},e.prototype.doEditCore=function(e){var t=this.topLeft(),n=this.bottomRight();this.isDragged?this.isMove?(e.layerOffsetX=this.startOffsetX+this.endCol-this.startCol,e.layerOffsetY=this.startOffsetY+this.endRow-this.startRow):(e.mergeFloatingLayer(),e.copyToLayer(t.x,t.y,n.x-t.x+1,n.y-t.y+1,!0)):this.isMove||e.mergeFloatingLayer()},e}(u);n.MarqueeEdit=v},{"./store/imageReducer":31}],36:[function(e,t,n){"use strict";function d(){return"undefined"!=typeof window&&!!window.PointerEvent}function f(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}var r;Object.defineProperty(n,"__esModule",{value:!0}),n.DRAG_RADIUS=3,n.hasPointerEvents=d,n.isTouchEnabled=f,n.isBitmapSupported=function(){return!!window.createImageBitmap},(r=n.MapTools||(n.MapTools={}))[r.Pan=0]="Pan",r[r.Stamp=1]="Stamp",r[r.Object=2]="Object",r[r.Erase=3]="Erase";var i=function(){function e(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}return e.prototype.set=function(e,t){var n=e+this.width*t,r=n>>3,i=7&n;this.mask[r]|=1<<i},e.prototype.get=function(e,t){var n=e+this.width*t,r=n>>3,i=7&n;return this.mask[r]>>i&1},e}();function h(e){if(e.touches){var t=e;return t.touches.length?t.touches[0]:t.changedTouches[0]}return e}n.Bitmask=i,n.pointerEvents=d()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:f()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},n.clientCoord=h;var m=function(){function e(e,t,n){this.target=e,this.isRightClick=n,this.startX=t.clientX,this.startY=t.clientY,this.currentX=t.clientX,this.currentY=t.clientY}return e.prototype.update=function(e){this.currentX=e.clientX,this.currentY=e.clientY,!this.isDrag&&this.distance()>n.DRAG_RADIUS?(this.isDrag=!0,this.target.onDragStart(e,this.isRightClick)):this.isDrag&&this.target.onDragMove(e)},e.prototype.end=function(e){e&&this.update(e),e=e||{clientX:this.currentX,clientY:this.currentY},this.isDrag?this.target.onDragEnd(e):this.target.onClick(e,this.isRightClick)},e.prototype.distance=function(){return Math.sqrt(Math.pow(this.currentX-this.startX,2)+Math.pow(this.currentY-this.startY,2))},e}();function g(e,t){for(var n=0;n<e.changedTouches.length;n++)if(e.changedTouches[n].identifier===t)return e.changedTouches[n]}function v(e){return 0<e.button}n.GestureState=m,n.bindGestureEvents=function(e,t){var n,r,i,o,a,s,l,c,u,p;d()?(u=t,(c=e).addEventListener("pointerup",function(e){p&&(p.end(h(e)),e.preventDefault()),p=void 0}),c.addEventListener("pointerdown",function(e){p&&p.end(),p=new m(u,h(e),v(e)),e.preventDefault()}),c.addEventListener("pointermove",function(e){p&&(p.update(h(e)),e.preventDefault())}),c.addEventListener("pointerleave",function(e){p&&(p.end(h(e)),e.preventDefault()),p=void 0})):f()?(a=t,(o=e).addEventListener("touchend",function(e){if(s&&l){var t=g(e,l);t&&(s.end(t),s=void 0,e.preventDefault())}}),o.addEventListener("touchstart",function(e){s&&s.end(),l=e.changedTouches[0].identifier,s=new m(a,e.changedTouches[0],v(e))}),o.addEventListener("touchmove",function(e){if(s&&l){var t=g(e,l);t&&(s.update(t),e.preventDefault())}}),o.addEventListener("touchcancel",function(e){if(s&&l){var t=g(e,l);t&&(s.end(t),s=void 0,e.preventDefault())}})):(r=t,(n=e).addEventListener("mouseup",function(e){i&&i.end(h(e)),i=void 0}),n.addEventListener("mousedown",function(e){i&&i.end(),i=new m(r,h(e),v(e))}),n.addEventListener("mousemove",function(e){i&&i.update(h(e))}),n.addEventListener("mouseleave",function(e){i&&i.end(h(e)),i=void 0}))},n.imageStateToBitmap=function(e){var t=pxt.sprite.Bitmap.fromData(e.bitmap);if(e.floating&&e.floating.bitmap){var n=pxt.sprite.Bitmap.fromData(e.floating.bitmap);n.x0=e.layerOffsetX||0,n.y0=e.layerOffsetY||0,t.apply(n,!0)}return t},n.imageStateToTilemap=function(e){var t=pxt.sprite.Tilemap.fromData(e.bitmap);if(e.floating&&e.floating.bitmap){var n=pxt.sprite.Tilemap.fromData(e.floating.bitmap);n.x0=e.layerOffsetX||0,n.y0=e.layerOffsetY||0,t.apply(n,!0)}return t},n.applyBitmapData=function(e,t,n,r){if(void 0===n&&(n=0),void 0===r&&(r=0),!e||!t)return e;var i=pxt.sprite.Bitmap.fromData(e),o=pxt.sprite.Bitmap.fromData(t);return o.x0=n,o.y0=r,i.apply(o,!0),i.data()}},{}],37:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./ImageEditor/ImageEditor"),s=e("./ImageEditor/store/imageReducer"),l=function(n){function e(e){var t=n.call(this,e)||this;return t.toggleGallery=function(){t.state.galleryVisible?u("gallery-hide"):u("gallery-show"),t.setState({galleryVisible:!t.state.galleryVisible})},t.onGalleryItemSelect=function(e){t.ref&&t.ref.setCurrentFrame(pxt.sprite.getBitmap(t.blocksInfo,e.qName)),u("gallery-selection"),t.setState({galleryVisible:!1})},t.onDoneClick=function(){t.closeEditor&&t.closeEditor()},t.state={galleryVisible:!1},s.setTelemetryFunction(u),t}return i(e,n),e.prototype.render=function(){return o.createElement("div",{className:"image-editor-wrapper"},o.createElement("div",{className:"gallery-editor-header"},o.createElement("div",{className:"gallery-editor-toggle "+(this.state.galleryVisible?"right":"left")+" "+(pxt.BrowserUtils.isEdge()?"edge":""),onClick:this.toggleGallery,role:"button","aria-pressed":this.state.galleryVisible},o.createElement("div",{className:"gallery-editor-toggle-label gallery-editor-toggle-left"},lf("Editor")),o.createElement("div",{className:"gallery-editor-toggle-label gallery-editor-toggle-right"},lf("Gallery")),o.createElement("div",{className:"gallery-editor-toggle-handle"}))),o.createElement("div",{className:"image-editor-gallery-content"},o.createElement(a.ImageEditor,{ref:"image-editor",singleFrame:this.props.singleFrame,onDoneClicked:this.onDoneClick}),o.createElement(c,{items:this.blocksInfo&&pxt.sprite.getGalleryItems(this.blocksInfo,"Image"),hidden:!this.state.galleryVisible,filterString:this.state.galleryFilter,onItemSelected:this.onGalleryItemSelect})))},e.prototype.componentDidMount=function(){this.ref=this.refs["image-editor"],u("image-editor-shown")},e.prototype.componentWillUnmount=function(){u("image-editor-hidden")},e.prototype.init=function(e,t,n){this.closeEditor=t,this.props.singleFrame?this.initSingleFrame(e,n):this.initAnimation(e,n),n&&(this.blocksInfo=n.blocksInfo,n.filter&&this.setState({galleryFilter:n.filter}))},e.prototype.getValue=function(){return this.ref?this.props.singleFrame?this.ref.getCurrentFrame():this.ref.getAnimation():null},e.prototype.getPersistentData=function(){return this.ref?this.ref.getPersistentData():null},e.prototype.restorePersistentData=function(e){this.ref&&this.ref.restorePersistentData(e)},e.prototype.onResize=function(){this.ref&&this.ref.onResize()},e.prototype.initSingleFrame=function(e,t){this.ref.initSingleFrame(e)},e.prototype.initAnimation=function(e,t){e||(e={frames:[new pxt.sprite.Bitmap(16,16).data()],interval:100}),this.ref.initAnimation(e.frames.map(function(e){return pxt.sprite.Bitmap.fromData(e)}),e.interval)},e}(o.Component);n.ImageFieldEditor=l;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handlers=[],e}return i(e,t),e.prototype.render=function(){var n=this,e=this.props,t=e.items,r=e.hidden,i=e.filterString;return i&&(t=pxt.sprite.filterItems(t,i.split(" "))),o.createElement("div",{className:"image-editor-gallery "+(t&&!r?"visible":"")},t&&t.map(function(e,t){return o.createElement("button",{key:t,id:":"+t,role:"menuitem",className:"sprite-gallery-button sprite-editor-card",title:e.alt,"data-value":e.qName,onClick:n.clickHandler(t)},o.createElement("img",{src:e.src,"data-value":e.qName,alt:e.alt}))}))},e.prototype.clickHandler=function(o){var a=this;return this.handlers[o]||(this.handlers[o]=function(){var e=a.props,t=e.items,n=e.onItemSelected,r=e.filterString,i=e.hidden;r&&(t=pxt.sprite.filterItems(t,r.split(" "))),!i&&t&&t[o]&&n(t[o])}),this.handlers[o]},e}(o.Component);function u(e){pxt.tickEvent("image.editor",{action:e})}},{"./ImageEditor/ImageEditor":20,"./ImageEditor/store/imageReducer":31,react:284}],38:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./ImageEditor/ImageEditor"),s=e("./ImageEditor/store/imageReducer"),l=function(n){function e(e){var t=n.call(this,e)||this;return t.onDoneClick=function(){t.closeEditor&&t.closeEditor()},t.state={galleryVisible:!1},s.setTelemetryFunction(c),t}return i(e,n),e.prototype.render=function(){return o.createElement("div",{className:"image-editor-wrapper"},o.createElement("div",{className:"image-editor-gallery-content"},o.createElement(a.ImageEditor,{ref:"image-editor",singleFrame:!0,onDoneClicked:this.onDoneClick})))},e.prototype.componentDidMount=function(){this.ref=this.refs["image-editor"],c("image-editor-shown")},e.prototype.componentWillUnmount=function(){c("image-editor-hidden")},e.prototype.init=function(e,t,n){this.closeEditor=t,this.initTilemap(e,n)},e.prototype.getValue=function(){return this.ref?this.ref.getTilemap():null},e.prototype.getPersistentData=function(){return this.ref?this.ref.getPersistentData():null},e.prototype.restorePersistentData=function(e){this.ref&&this.ref.restorePersistentData(e)},e.prototype.onResize=function(){this.ref&&this.ref.onResize()},e.prototype.initTilemap=function(e,t){var n,r=this;0!==e.tilemap.width&&0!==e.tilemap.height||(e.tilemap=new pxt.sprite.Tilemap(t.initWidth||16,t.initHeight||16)),e.layers||(e.layers=new pxt.sprite.Bitmap(e.tilemap.width,e.tilemap.height).data()),t&&(this.blocksInfo=t.blocksInfo,n=pxt.sprite.filterItems(pxt.sprite.getGalleryItems(this.blocksInfo,"Image"),["tile"]).map(function(e){return{bitmap:pxt.sprite.getBitmap(r.blocksInfo,e.qName).data(),tags:e.tags,qualifiedName:e.qName,tileWidth:16}})),this.ref.initTilemap(e,n)},e}(o.Component);function c(e){pxt.tickEvent("image.editor",{action:e})}n.TilemapFieldEditor=l},{"./ImageEditor/ImageEditor":20,"./ImageEditor/store/imageReducer":31,react:284}],39:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},p=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var d=e("react"),o=function(t){function e(e){var r=t.call(this,e)||this;return r.updateInputValue=function(e){var t=r.props.searchOnChange,n=e.target.value;r.setState({inputValue:n}),t&&r.handleSearch(n)},r.state={inputValue:""},r.handleSearchKeyUpdate=r.handleSearchKeyUpdate.bind(r),r.handleClick=r.handleClick.bind(r),r}return i(e,t),e.prototype.handleSearchKeyUpdate=function(e){13==e.keyCode&&this.handleSearch(this.state.inputValue)},e.prototype.handleSearch=function(e){(0,this.props.searchHandler)(e)},e.prototype.handleClick=function(){this.handleSearch(this.state.inputValue)},e.prototype.render=function(){var e=this.props,t=e.ariaMessage,n=e.disabled,r=e.loading,i=e.placeholder,o=e.autoFocus,a=e.className,s=e.inputClassName,l=(e.searchOnChange,e.searchHandler,p(e,["ariaMessage","disabled","loading","placeholder","autoFocus","className","inputClassName","searchOnChange","searchHandler"])),c=this.state.inputValue;return d.createElement("div",u({className:"ui search "+(a||"")},l),d.createElement("div",{className:"ui icon input "+(s||"")},d.createElement("div",{"aria-live":"polite",className:"accessible-hidden",id:"searchInputBoxLabel"},t),d.createElement("input",{role:"search",autoFocus:o,ref:"searchInput","aria-labelledby":"searchInputBoxLabel",className:"prompt",type:"text",placeholder:i,onChange:this.updateInputValue,value:c,onKeyUp:this.handleSearchKeyUpdate,disabled:n,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),d.createElement("i",{role:"button",onClick:this.handleClick,title:lf("Search"),style:{cursor:"pointer"},className:"search link icon "+(n?"disabled":"")+" "+(r?"loading":"")})))},e}(d.Component);n.SearchInput=o},{react:284}],40:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var C=e("react"),s=e("./data"),S=e("./sui"),T=e("./tutorial"),A=e("./container"),l=e("./core"),N=e("./cloud"),c=e("./cloudsync");function u(e,t){pxt.tickEvent("docs",{path:t},{interactiveConsent:!0}),e.startTutorial(t)}function y(e,t){pxt.tickEvent("docs",{path:t},{interactiveConsent:!0}),e.setSideDoc(t)}var p=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.lookUpByPath=function(e){var t=this;return this.docMenuCache||(this.docMenuCache={},pxt.appTarget.appTheme.docMenu.forEach(function(e){t.docMenuCache[e.path]=e})),this.docMenuCache[e]},e.prototype.doDocEntryAction=function(e,t){return t.tutorial?function(){u(e,t.path)}:/^\//.test(t.path)||t.popout?t.popout?function(){window.open(""+pxt.appTarget.appTheme.homeUrl+t.path,"docs")}:function(){y(e,t.path)}:function(){window.open(t.path,"docs")}},e.prototype.renderCore=function(){var t,n,r=this,i=this.props.parent;return pxt.appTarget.appTheme.docMenu.map(function(e){return{key:"docsmenu"+e.path,content:pxt.Util.rlf(e.name),role:"menuitem","aria-label":pxt.Util.rlf(e.name),onClick:r.doDocEntryAction(i,e),value:e.path,onKeyDown:function(){console.log("Key DOWN")}}}),C.createElement(S.DropdownMenu,{role:"menuitem",icon:"help circle large",className:"item mobile hide help-dropdown-menuitem",textClass:"landscape only",title:lf("Help")},(t=this.props.parent,n="",pxt.appTarget.appTheme.docMenu.map(function(e){return e.tutorial?C.createElement(b,{key:"docsmenututorial"+e.path,role:"menuitem",ariaLabel:pxt.Util.rlf(e.name),text:pxt.Util.rlf(e.name),className:"ui "+n,parent:t,path:e.path,onItemClick:u}):/^\//.test(e.path)?C.createElement(b,{key:"docsmenu"+e.path,role:"menuitem",ariaLabel:pxt.Util.rlf(e.name),text:pxt.Util.rlf(e.name),className:"ui "+n,parent:t,path:e.path,onItemClick:y}):C.createElement("a",{key:"docsmenulink"+e.path,role:"menuitem","aria-label":e.name,title:e.name,className:"ui item link "+n,href:e.path,target:"docs"},pxt.Util.rlf(e.name))})))},e}(s.PureComponent);n.DocsMenu=p;var b=function(n){function e(e){var t=n.call(this,e)||this;return t.handleClick=t.handleClick.bind(t),t}return i(e,n),e.prototype.handleClick=function(){var e=this.props;(0,e.onItemClick)(e.parent,e.path)},e.prototype.renderCore=function(){var e=this.props,t=(e.onClick,e.onItemClick,e.parent,e.path,a(e,["onClick","onItemClick","parent","path"]));return C.createElement(S.Item,o({},t,{onClick:this.handleClick}))},e}(S.StatelessUIElement),d=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.openSettings=t.openSettings.bind(t),t.showPackageDialog=t.showPackageDialog.bind(t),t.showBoardDialog=t.showBoardDialog.bind(t),t.removeProject=t.removeProject.bind(t),t.saveProject=t.saveProject.bind(t),t.toggleCollapse=t.toggleCollapse.bind(t),t.showReportAbuse=t.showReportAbuse.bind(t),t.showLanguagePicker=t.showLanguagePicker.bind(t),t.toggleHighContrast=t.toggleHighContrast.bind(t),t.toggleGreenScreen=t.toggleGreenScreen.bind(t),t.showResetDialog=t.showResetDialog.bind(t),t.showShareDialog=t.showShareDialog.bind(t),t.pair=t.pair.bind(t),t.pairBluetooth=t.pairBluetooth.bind(t),t.showAboutDialog=t.showAboutDialog.bind(t),t.print=t.print.bind(t),t.signOutGithub=t.signOutGithub.bind(t),t}return i(e,n),e.prototype.showShareDialog=function(){pxt.tickEvent("menu.share",void 0,{interactiveConsent:!0}),this.props.parent.showShareDialog()},e.prototype.openSettings=function(){pxt.tickEvent("menu.settings",void 0,{interactiveConsent:!0}),this.props.parent.openSettings()},e.prototype.showPackageDialog=function(){pxt.tickEvent("menu.addpackage",void 0,{interactiveConsent:!0}),this.props.parent.showPackageDialog()},e.prototype.showBoardDialog=function(){pxt.tickEvent("menu.changeboard",void 0,{interactiveConsent:!0}),pxt.hasHwVariants()?this.props.parent.showChooseHwDialog():this.props.parent.showBoardDialogAsync(void 0,!0).done()},e.prototype.saveProject=function(){pxt.tickEvent("menu.saveproject",void 0,{interactiveConsent:!0}),this.props.parent.saveAndCompile()},e.prototype.removeProject=function(){pxt.tickEvent("menu.removeproject",void 0,{interactiveConsent:!0}),this.props.parent.removeProject()},e.prototype.toggleCollapse=function(){pxt.tickEvent("menu.toggleSim",void 0,{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()},e.prototype.showReportAbuse=function(){pxt.tickEvent("menu.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()},e.prototype.showLanguagePicker=function(){pxt.tickEvent("menu.langpicker",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()},e.prototype.toggleHighContrast=function(){pxt.tickEvent("menu.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()},e.prototype.toggleGreenScreen=function(){pxt.tickEvent("menu.togglegreenscreen",void 0,{interactiveConsent:!0}),this.props.parent.toggleGreenScreen()},e.prototype.showResetDialog=function(){pxt.tickEvent("menu.reset",void 0,{interactiveConsent:!0}),pxt.tickEvent("reset"),this.props.parent.showResetDialog()},e.prototype.pair=function(){pxt.tickEvent("menu.pair"),this.props.parent.pair()},e.prototype.pairBluetooth=function(){pxt.tickEvent("menu.pair.bluetooth"),l.showLoading("webblepair",lf("Pairing Bluetooth device...")),pxt.webBluetooth.pairAsync().then(function(){return l.hideLoading("webblepair")})},e.prototype.showAboutDialog=function(){pxt.tickEvent("menu.about"),this.props.parent.showAboutDialog()},e.prototype.print=function(){pxt.tickEvent("menu.print"),this.props.parent.printCode()},e.prototype.signOutGithub=function(){pxt.tickEvent("menu.github.signout");var e=c.githubProvider();e&&(e.logout(),this.props.parent.forceUpdate(),l.infoNotification(lf("Signed out from GitHub...")))},e.prototype.componentWillReceiveProps=function(e){var t={};null!=e.highContrast&&(t.highContrast=e.highContrast),void 0!==e.greenScreen&&(t.greenScreen=e.greenScreen),0<Object.keys(t).length&&this.setState(t)},e.prototype.shouldComponentUpdate=function(e,t,n){return this.state.highContrast!=t.highContrast||this.state.greenScreen!=t.greenScreen},e.prototype.renderCore=function(){var e=this.state,t=e.highContrast,n=e.greenScreen,r=pxt.appTarget.appTheme,i=pxt.appTarget.cloud&&!!pxt.appTarget.cloud.packages,o=pxt.appTarget.simulator&&!!pxt.appTarget.simulator.dynamicBoardDefinition,a=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,s=pxt.shell.isReadOnly(),l=pxt.shell.isControllerMode(),c=r.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),u=!(s||l||!r.saveInMenu||c),p=!s&&!l&&!!r.simCollapseInMenu,d=r.greenScreen||/greenscreen=1/i.test(window.location.href),f=r.print&&!pxt.BrowserUtils.isIE(),h=r.showProjectSettings,m=r.docMenu&&r.docMenu.filter(function(e){return!e.tutorial})[0],g=!s&&!l&&this.getData("github:user"),v=pxt.usb.isEnabled&&!pxt.BrowserUtils.isElectron();return C.createElement(S.DropdownMenu,{role:"menuitem",icon:"setting large",title:lf("More..."),className:"item icon more-dropdown-menuitem"},h?C.createElement(S.Item,{role:"menuitem",icon:"options",text:lf("Project Settings"),onClick:this.openSettings}):void 0,i?C.createElement(S.Item,{role:"menuitem",icon:"disk outline",text:lf("Extensions"),onClick:this.showPackageDialog}):void 0,o?C.createElement(S.Item,{role:"menuitem",icon:"microchip",text:lf("Change Board"),onClick:this.showBoardDialog}):void 0,f?C.createElement(S.Item,{role:"menuitem",icon:"print",text:lf("Print..."),onClick:this.print}):void 0,u?C.createElement(S.Item,{role:"menuitem",icon:"save",text:lf("Save Project"),onClick:this.saveProject}):void 0,l?void 0:C.createElement(S.Item,{role:"menuitem",icon:"trash",text:lf("Delete Project"),onClick:this.removeProject}),p?C.createElement(S.Item,{role:"menuitem",icon:"toggle right",text:lf("Toggle the simulator"),onClick:this.toggleCollapse}):void 0,a?C.createElement(S.Item,{role:"menuitem",icon:"warning circle",text:lf("Report Abuse..."),onClick:this.showReportAbuse}):void 0,C.createElement("div",{className:"ui divider"}),r.selectLanguage?C.createElement(S.Item,{icon:"xicon globe",role:"menuitem",text:lf("Language"),onClick:this.showLanguagePicker}):void 0,r.highContrast?C.createElement(S.Item,{role:"menuitem",text:t?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,d?C.createElement(S.Item,{role:"menuitem",text:n?lf("Green Screen Off"):lf("Green Screen On"),onClick:this.toggleGreenScreen}):void 0,v?C.createElement(S.Item,{role:"menuitem",icon:"usb",text:lf("Pair device"),onClick:this.pair}):void 0,pxt.webBluetooth.isAvailable()?C.createElement(S.Item,{role:"menuitem",icon:"bluetooth",text:lf("Pair Bluetooth"),onClick:this.pairBluetooth}):void 0,m?C.createElement(b,{key:"mobiledocsmenudocs",role:"menuitem",ariaLabel:pxt.Util.rlf(m.name),text:pxt.Util.rlf(m.name),className:"ui mobile only",parent:this.props.parent,path:m.path,onItemClick:y}):void 0,g?C.createElement("div",{className:"ui divider"}):void 0,g?C.createElement("div",{className:"ui item",title:lf("Sign out {0} from GitHub",g.name),role:"menuitem",onClick:this.signOutGithub},C.createElement("div",{className:"avatar",role:"presentation"},C.createElement("img",{className:"ui circular image",src:g.photo,alt:lf("User picture")})),lf("Sign out")):void 0,C.createElement("div",{className:"ui divider"}),C.createElement(S.Item,{role:"menuitem",text:lf("About..."),onClick:this.showAboutDialog}),r.feedbackUrl?C.createElement("a",{className:"ui item",href:r.feedbackUrl,role:"menuitem",title:lf("Give Feedback"),target:"_blank",rel:"noopener noreferrer"},lf("Give Feedback")):void 0,l?void 0:C.createElement(S.Item,{role:"menuitem",icon:"sign out",text:lf("Reset"),onClick:this.showResetDialog}))},e}(s.Component);n.SettingsMenu=d;var f=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.renderCore=function(){var e=this.props.isActive();return C.createElement(S.Item,{className:this.props.className+" "+(e?"selected":""),role:"menuitem",textClass:"landscape only",text:this.props.text,icon:this.props.icon,active:e,onClick:this.props.onClick,title:this.props.title})},e}(s.Component),h=function(n){function e(e){var t=n.call(this,e)||this;return t.onClick=function(){pxt.tickEvent("menu.javascript",void 0,{interactiveConsent:!0}),t.props.parent.openJavaScript()},t.isActive=function(){return t.props.parent.isJavaScriptActive()},t}return i(e,n),e.prototype.renderCore=function(){return C.createElement(f,{className:"javascript-menuitem",icon:"xicon js",text:"JavaScript",title:lf("Convert code to JavaScript"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})},e}(s.Component),m=function(n){function e(e){var t=n.call(this,e)||this;return t.onClick=function(){pxt.tickEvent("menu.python",void 0,{interactiveConsent:!0}),t.props.parent.openPython()},t.isActive=function(){return t.props.parent.isPythonActive()},t}return i(e,n),e.prototype.renderCore=function(){return C.createElement(f,{className:"python-menuitem",icon:"xicon python",text:"Python",title:lf("Convert code to Python"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})},e}(s.Component),g=function(n){function e(e){var t=n.call(this,e)||this;return t.onClick=function(){pxt.tickEvent("menu.blocks",void 0,{interactiveConsent:!0}),t.props.parent.openBlocks()},t.isActive=function(){return t.props.parent.isBlocksActive()},t}return i(e,n),e.prototype.renderCore=function(){return C.createElement(f,{className:"blocks-menuitem",icon:"xicon blocks",text:lf("Blocks"),title:lf("Convert code to Blocks"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})},e}(s.Component),v=function(n){function e(e){var t=n.call(this,e)||this;return t.onClick=function(){pxt.tickEvent("menu.simView",void 0,{interactiveConsent:!0}),t.props.parent.openSimView()},t.isActive=function(){return t.props.parent.isEmbedSimActive()},t}return i(e,n),e.prototype.renderCore=function(){var e=this.isActive(),t=this.props.parent.state.simState==pxt.editor.SimState.Running,n=t?lf("Stop the simulator"):lf("Start the simulator");return C.createElement(f,{className:"sim-menuitem",icon:e&&t?"stop":"play",text:lf("Simulator"),title:e?n:lf("Show Simulator"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})},e}(s.Component),_=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.renderCore=function(){var e=this.props.python,t=e&&(this.props.parent.isJavaScriptActive()||this.props.parent.isPythonActive());return C.createElement("div",null,C.createElement("div",{id:"editortoggle",className:"ui grid padded"},this.props.sandbox&&C.createElement(v,{parent:this.props.parent}),C.createElement(g,{parent:this.props.parent}),pxt.Util.isPyLangPref()&&e?C.createElement(m,{parent:this.props.parent}):C.createElement(h,{parent:this.props.parent}),e&&C.createElement(S.DropdownMenu,{id:"editordropdown",role:"menuitem",icon:"chevron down",rightIcon:!0,title:lf("Select code editor language"),className:"item button attached right "+(t?"active":"")},C.createElement(h,{parent:this.props.parent}),C.createElement(m,{parent:this.props.parent})),C.createElement("div",{className:"ui item toggle "+(e?"hasdropdown":"")})))},e}(s.Component);n.EditorSelector=_;var w=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.brandIconClick=t.brandIconClick.bind(t),t.orgIconClick=t.orgIconClick.bind(t),t.goHome=t.goHome.bind(t),t.showShareDialog=t.showShareDialog.bind(t),t.launchFullEditor=t.launchFullEditor.bind(t),t.exitTutorial=t.exitTutorial.bind(t),t.showReportAbuse=t.showReportAbuse.bind(t),t.toggleDebug=t.toggleDebug.bind(t),t}return i(e,n),e.prototype.brandIconClick=function(){!pxt.shell.isControllerMode()&&(pxt.tickEvent("menu.brand",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog())},e.prototype.orgIconClick=function(){pxt.tickEvent("menu.org",void 0,{interactiveConsent:!0})},e.prototype.goHome=function(){pxt.tickEvent("menu.home",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog()},e.prototype.showShareDialog=function(){pxt.tickEvent("menu.share",void 0,{interactiveConsent:!0}),this.props.parent.showShareDialog()},e.prototype.launchFullEditor=function(){pxt.tickEvent("sandbox.openfulleditor",void 0,{interactiveConsent:!0}),this.props.parent.launchFullEditor()},e.prototype.exitTutorial=function(){pxt.tickEvent("menu.exitTutorial",void 0,{interactiveConsent:!0}),this.props.parent.state.tutorialOptions&&this.props.parent.state.tutorialOptions.tutorialRecipe?this.props.parent.completeTutorialAsync().done():this.props.parent.exitTutorial()},e.prototype.showReportAbuse=function(){pxt.tickEvent("tutorial.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()},e.prototype.toggleDebug=function(){pxt.tickEvent("simulator.debug",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()},e.prototype.renderCore=function(){var e=this.props.parent.state,t=e.debugging,n=e.home,r=e.header,i=e.highContrast,o=e.greenScreen,a=(e.simState,e.tutorialOptions);if(n)return C.createElement("div",null);var s=pxt.appTarget.appTheme,l=!!s.lockedEditor,c=pxt.shell.isControllerMode(),u=!l&&!c,p=pxt.shell.isSandboxMode(),d=!!a&&!!a.tutorial,f=a&&a.tutorialActivityInfo?a.tutorialActivityInfo[a.tutorialStepInfo[a.tutorialStep].activity].name:null,h=a&&a.metadata&&a.metadata.hideIteration,m=a&&a.tutorialReportId,g=s.docMenu&&s.docMenu.length&&!p&&!d&&!t,v=!!this.props.parent.state.highContrast,y=!d&&r&&pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&!c&&!t,b=(v?s.highContrastLogo:void 0)||s.logo,_=(v?s.highContrastPortraitLogo:void 0)||s.portraitLogo,w=p?s.portraitLogo:s.rightLogo,k=s.logoWide?"small":"mini",x=this.hasCloud()?this.getUser():void 0,E=!(p||d||t||!x);return C.createElement("div",{id:"mainmenu",className:"ui borderless fixed "+(s.invertedMenu?"inverted":"")+" menu",role:"menubar","aria-label":lf("Main menu")},p?C.createElement("div",{className:"left menu"},C.createElement("span",{id:"logo",className:"ui item logo"},C.createElement("img",{className:"ui mini image",src:w,tabIndex:0,onClick:this.launchFullEditor,onKeyDown:S.fireClickOnEnter,alt:s.boardName+" Logo"}))):C.createElement("div",{className:"left menu"},!s.hideMenubarLogo&&C.createElement("a",{href:!l&&c?s.logoUrl:void 0,"aria-label":lf("{0} Logo",s.boardName),role:"menuitem",target:"blank",rel:"noopener",className:"ui item logo brand",tabIndex:0,onClick:l?void 0:this.brandIconClick,onKeyDown:S.fireClickOnEnter},b||_?C.createElement("img",{className:"ui logo "+(b?" portrait hide":""),src:b||_,alt:lf("{0} Logo",s.boardName)}):C.createElement("span",{className:"name"},s.boardName),_?C.createElement("img",{className:"ui "+k+" image portrait only",src:_,alt:lf("{0} Logo",s.boardName)}):null),!l&&s.betaUrl&&C.createElement("a",{href:""+s.betaUrl,className:"ui red mini corner top left attached label betalabel",role:"menuitem"},lf("Beta")),!d&&u?C.createElement(S.Item,{className:"icon openproject",role:"menuitem",textClass:"landscape only",icon:"home large",ariaLabel:lf("Home screen"),text:lf("Home"),onClick:this.goHome}):null,y?C.createElement(S.Item,{className:"icon shareproject",role:"menuitem",textClass:"widedesktop only",ariaLabel:lf("Share Project"),text:lf("Share"),icon:"share alternate large",onClick:this.showShareDialog}):null,d&&C.createElement(S.Item,{className:"tutorialname",tabIndex:-1,textClass:"landscape only",text:a.tutorialName})),!d&&!s.blocksOnly&&!t&&C.createElement("div",{className:"ui item link editor-menuitem"},C.createElement(A.EditorSelector,{parent:this.props.parent,sandbox:p,python:s.python})),d&&f&&C.createElement("div",{className:"ui item"},f),d&&!h&&C.createElement(T.TutorialMenu,{parent:this.props.parent}),t&&!d?C.createElement(S.MenuItem,{className:"debugger-menu-item centered",icon:"large bug",name:"Debug Mode"}):void 0,C.createElement("div",{className:"right menu"},t?C.createElement(S.ButtonMenuItem,{className:"exit-debugmode-btn",role:"menuitem",icon:"external",text:lf("Exit Debug Mode"),textClass:"landscape only",onClick:this.toggleDebug}):void 0,g?C.createElement(A.DocsMenu,{parent:this.props.parent}):void 0,p||d||t?void 0:C.createElement(A.SettingsMenu,{parent:this.props.parent,highContrast:i,greenScreen:o}),E?C.createElement(N.UserMenu,{parent:this.props.parent}):void 0,p&&!s.hideEmbedEdit?C.createElement(S.Item,{role:"menuitem",icon:"external",textClass:"mobile hide",text:lf("Edit"),onClick:this.launchFullEditor}):void 0,d&&m?C.createElement(S.ButtonMenuItem,{className:"report-tutorial-btn",role:"menuitem",icon:"warning circle",text:lf("Report Abuse"),textClass:"landscape only",onClick:this.showReportAbuse}):void 0,d&&!l&&!h&&C.createElement(S.ButtonMenuItem,{className:"exit-tutorial-btn",role:"menuitem",icon:"external",text:lf("Exit tutorial"),textClass:"landscape only",onClick:this.exitTutorial}),p?void 0:C.createElement("a",{href:l?void 0:s.organizationUrl,"aria-label":lf("{0} Logo",s.organization),role:"menuitem",target:"blank",rel:"noopener",className:"ui item logo organization",onClick:l?void 0:this.orgIconClick},s.organizationWideLogo||s.organizationLogo?C.createElement("img",{className:"ui logo "+(s.organizationWideLogo?" portrait hide":""),src:s.organizationWideLogo||s.organizationLogo,alt:lf("{0} Logo",s.organization)}):C.createElement("span",{className:"name"},s.organization),s.organizationLogo?C.createElement("img",{className:"ui mini image portrait only",src:s.organizationLogo,alt:lf("{0} Logo",s.organization)}):null)))},e}(s.Component);n.MainMenu=w;var k=function(n){function e(e){var t=n.call(this,e)||this;return t.openingSideDoc=!1,t.state={},t.toggleVisibility=t.toggleVisibility.bind(t),t.popOut=t.popOut.bind(t),t}return i(e,n),e.notify=function(e){var t=document.getElementById("sidedocsframe");t&&t.contentWindow&&t.contentWindow.postMessage(e,"*")},e.prototype.setPath=function(e,t){this.openingSideDoc=!0;var n=(pxt.webConfig.docsUrl||"/--docs")+"#doc:"+e+":"+(t?"blocks":"js")+":"+pxt.Util.localeInfo();this.setUrl(n)},e.prototype.setMarkdown=function(e){var t=(pxt.webConfig.docsUrl||"/--docs")+"#md:"+encodeURIComponent(e)+":blocks:"+pxt.Util.localeInfo();this.setUrl(t),this.collapse()},e.prototype.setUrl=function(e){this.props.parent.setState({sideDocsLoadUrl:e,sideDocsCollapsed:!1})},e.prototype.collapse=function(){this.props.parent.setState({sideDocsCollapsed:!0})},e.prototype.popOut=function(){e.notify({type:"popout"})},e.prototype.toggleVisibility=function(){var e=this.props.parent.state;this.props.parent.setState({sideDocsCollapsed:!e.sideDocsCollapsed}),document.getElementById("sidedocstoggle").focus()},e.prototype.componentDidUpdate=function(){this.props.parent.editor.resize();var e=document.getElementById("sidedocstoggle");this.openingSideDoc&&e&&(e.focus(),this.openingSideDoc=!1)},e.prototype.componentWillReceiveProps=function(e){var t={};null!=e.sideDocsCollapsed&&(t.sideDocsCollapsed=e.sideDocsCollapsed),null!=e.docsUrl&&(t.docsUrl=e.docsUrl),0<Object.keys(t).length&&this.setState(t)},e.prototype.shouldComponentUpdate=function(e,t,n){return this.state.sideDocsCollapsed!=t.sideDocsCollapsed||this.state.docsUrl!=t.docsUrl},e.prototype.renderCore=function(){var e=this.state,t=e.sideDocsCollapsed,n=e.docsUrl,r=pxt.Util.isUserLanguageRtl(),i=(t||r)&&!(t&&r),o=!!pxt.appTarget.appTheme.lockedEditor;return n?C.createElement("div",null,C.createElement("button",{id:"sidedocstoggle",role:"button","aria-label":t?lf("Expand the side documentation"):lf("Collapse the side documentation"),className:"ui icon button large",onClick:this.toggleVisibility},C.createElement(S.Icon,{icon:"icon inverted chevron "+(i?"left":"right")})),C.createElement("div",{id:"sidedocs"},C.createElement("div",{id:"sidedocsframe-wrapper"},C.createElement("iframe",{id:"sidedocsframe",src:n,title:lf("Documentation"),"aria-atomic":"true","aria-live":"assertive",sandbox:"allow-scripts allow-same-origin allow-forms "+(o?"":"allow-popups")})),!o&&C.createElement("div",{className:"ui app hide",id:"sidedocsbar"},C.createElement("a",{className:"ui icon link",role:"button",tabIndex:0,"data-content":lf("Open documentation in new tab"),"aria-label":lf("Open documentation in new tab"),onClick:this.popOut,onKeyDown:S.fireClickOnEnter},C.createElement(S.Icon,{icon:"external"}))))):null},e}(s.Component);n.SideDocs=k;var x=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.compile=t.compile.bind(t),t}return i(e,n),e.prototype.compile=function(){pxt.tickEvent("sandboxfooter.compile",void 0,{interactiveConsent:!0}),this.props.parent.compile()},e.prototype.renderCore=function(){var e=pxt.appTarget.appTheme,t=lf("Download your code to the {0}",e.boardName);return C.createElement("div",{className:"ui horizontal small divided link list sandboxfooter"},e.organizationUrl&&e.organization?C.createElement("a",{className:"item",target:"_blank",rel:"noopener noreferrer",href:e.organizationUrl},e.organization):void 0,C.createElement("a",{target:"_blank",className:"item",href:e.termsOfUseUrl,rel:"noopener noreferrer"},lf("Terms of Use")),C.createElement("a",{target:"_blank",className:"item",href:e.privacyUrl,rel:"noopener noreferrer"},lf("Privacy")),C.createElement("span",{className:"item"},C.createElement("a",{role:"button",className:"ui thin portrait only",title:t,onClick:this.compile},C.createElement(S.Icon,{icon:"icon "+(pxt.appTarget.appTheme.downloadIcon||"download")}),pxt.appTarget.appTheme.useUploadMessage?lf("Upload"):lf("Download"))))},e}(s.PureComponent);n.SandboxFooter=x},{"./cloud":10,"./cloudsync":11,"./container":40,"./core":41,"./data":44,"./sui":100,"./tutorial":103,react:284}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("react"),o=e("react-dom"),a=e("./coretsx"),s=pxt.Cloud,l=!1,c=[],u={};function p(e){if(pxt.debug("hideloading: "+e),pxt.perf.recordMilestone("loading done #"+e),null!=u[e]){var t=c.indexOf(e);-1<t&&c.splice(t,1),delete u[e]}else pxt.debug("Loading not in queue, disregard: "+e);0<c.length?f():l&&r&&r.hide()}function d(e,t){pxt.debug("showloading: "+e),u[e]||(pxt.perf.recordMilestone("loading started #"+e),function(){if(!l){var e=document.getElementById("content").appendChild(document.createElement("div"));r=o.render(i.createElement(a.LoadingDimmer,{}),e),l=!0}}(),r.show(lf("Please wait")),c.push(e),u[e]=t,f())}function f(){if(c.length){var e=c[c.length-1],t=u[e];r.show(t)}}n.isLoading=function(){return r&&r.isVisible()},n.hideLoading=p,n.killLoadingQueue=function(){c=[],u={},l&&r&&r.hide()},n.showLoading=d;var h={};function m(e){clearTimeout(h[e]),p(e)}function g(e,t){a.pushNotificationMessage({kind:e,text:t,hc:n.highContrast})}function v(e){pxt.log("warning: "+e),g("warn",e)}function y(e){return e.type||(e.type="dialog"),e.hideCancel||(e.buttons||(e.buttons=[]),e.buttons.push({label:e.disagreeLbl||lf("Cancel"),className:e.disagreeClass||"cancel",icon:e.disagreeIcon||"cancel"})),e.helpUrl&&e.buttons.push({label:lf("Help"),className:"help",icon:"help",url:e.helpUrl}),a.renderConfirmDialogAsync(e)}function b(e){e.type="confirm",e.buttons||(e.buttons=[]);var t=0;return e.hideAgree||e.buttons.push({label:e.agreeLbl||lf("Go ahead!"),className:e.agreeClass,icon:e.agreeIcon||"checkmark",approveButton:!0,onclick:function(){t=1}}),e.deleteLbl&&e.buttons.push({label:e.deleteLbl,className:"delete red",icon:"trash",onclick:function(){t=2}}),y(e).then(function(){return t})}n.showLoadingAsync=function(e,t,n,r){return void 0===r&&(r=700),clearTimeout(h[e]),h[e]=setTimeout(function(){d(e,t)},r),n.finally(function(){m(e)})},n.cancelAsyncLoading=m,n.errorNotification=function(e){pxt.tickEvent("notification.error",{message:e}),g("err",e)},n.warningNotification=v,n.infoNotification=function(e){pxt.debug(e),g("info",e)},n.dialogAsync=y,n.hideDialog=function(){a.hideDialog()},n.forceUpdate=function(){a.forceUpdate()},n.confirmAsync=b,n.confirmDelete=function(e,t,n){b({header:n?lf("Would you like to delete {0} projects?",e):lf("Would you like to delete '{0}'?",e),body:lf("It will be deleted for good. No undo."),agreeLbl:lf("Delete"),agreeClass:"red",agreeIcon:"trash"}).then(function(e){e&&t().done()}).done()},n.promptAsync=function(e){e.type="prompt",e.buttons||(e.buttons=[]);var t=e.initialValue||"",n=!1;return e.hasCloseIcon&&(e.hideCancel=!0),e.onInputChanged=function(e){t=e},e.hideAgree||e.buttons.push({label:e.agreeLbl||lf("Go ahead!"),className:e.agreeClass,icon:e.agreeIcon||"checkmark",approveButton:!0,onclick:function(){n=!0}}),y(e).then(function(){return n?t:null})},n.TAB_KEY=9,n.ESC_KEY=27,n.ENTER_KEY=13,n.SPACE_KEY=32,n.setHighContrast=function(e){n.highContrast=e},n.resetFocus=function(){var e=document.getElementById("content");e.tabIndex=0,e.focus(),e.blur(),e.tabIndex=-1},n.keyCodeFromEvent=function(e){return"number"==typeof e.which?e.which:e.keyCode},n.navigateInWindow=function(e){window.location.href=e},n.findChild=function(e,t){var n=o.findDOMNode(e);return t?pxt.Util.toArray(n.querySelectorAll(t)):[n]},n.parseQueryString=function(e){var r={};return e.replace(/\+/g," ").replace(/([^#?&=]+)=([^#?&=]*)/g,function(e,t,n){return r[decodeURIComponent(t)]=decodeURIComponent(n),""}),r},n.stringifyQueryString=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];0<=e.indexOf("?")?e+="&":e+="?",e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i])}return e},n.handleNetworkError=function(e,t){var n=parseInt(e.statusCode);if(e.isOffline||0===n)v(lf("Network request failed; you appear to be offline"));else if(!isNaN(n)&&200!==n){if(t&&-1!==t.indexOf(n))return e;v(lf("Network request failed"))}throw e},n.apiAsync=function(t,e){return(e?s.privatePostAsync(t,e):s.privateGetAsync(t)).then(function(e){return console.log("*"),console.log("*******",t,"---\x3e"),console.log("*"),console.log(e),console.log("*"),e},function(e){console.log(e.message)})}},{"./coretsx":42,react:284,"react-dom":240}],42:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o,l=e("react"),a=e("react-dom"),c=e("./sui"),s=e("./core"),u=function(n){function e(e){var t=n.call(this,e)||this;return t.state={inputValue:e.initialValue,inputError:void 0},t.hide=t.hide.bind(t),t.modalDidOpen=t.modalDidOpen.bind(t),t.handleInputChange=t.handleInputChange.bind(t),t}return i(e,n),e.prototype.hide=function(){this.close()},e.prototype.close=function(e){this.setState({visible:!1}),this.resolve(e)},e.prototype.componentDidMount=function(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t});var e=this.refs.copybtn;e&&a.findDOMNode(e).addEventListener("click",function(){try{var e=n.refs.linkinput;e.focus(),e.setSelectionRange(0,e.value.length),document.execCommand("copy")}catch(e){}})},e.prototype.modalDidOpen=function(e){var t=this.props,n=this.refs.promptInput;if(n){n.setSelectionRange(0,9999);var r=this;n.onkeydown=function(e){s.keyCodeFromEvent(e)===s.ENTER_KEY&&r.okButton&&n.value&&(r.okButton.onclick(),e.preventDefault())}}t.onLoaded&&t.onLoaded(e)},e.prototype.handleInputChange=function(e){var t,n=this.props;n.onInputChanged&&n.onInputChanged(e.target.value),n.onInputValidation&&(t=n.onInputValidation(e.target.value)),this.setState({inputValue:e.target.value,inputError:t})},e.prototype.render=function(){var n=this,e=this.props,t=this.state,r=t.inputValue,i=t.inputError,o=void 0===e.size?"small":e.size,a=e.buttons?e.buttons.filter(function(e){return!!e}):[];a.forEach(function(e){var t=e.onclick;e.onclick=function(){n.close(t?t():0)},e.className||(e.className="approve positive"),e.approveButton&&(n.okButton=e)}),"prompt"==e.type&&this.okButton&&(this.okButton.disabled=!r||!!i);var s=c.cx(["coredialog",e.className]);return l.createElement(c.Modal,{isOpen:!0,ref:"modal",className:s,onClose:this.hide,size:o,defaultOpen:!0,buttons:a,dimmer:!0,closeIcon:e.hasCloseIcon,header:e.header,closeOnDimmerClick:!e.hideCancel,closeOnDocumentClick:!e.hideCancel,closeOnEscape:!e.hideCancel,modalDidOpen:this.modalDidOpen},"prompt"==e.type?l.createElement("div",{className:"ui fluid icon input"},l.createElement("input",{autoFocus:!0,className:"ui input "+(i?"error":""),type:"text",ref:"promptInput",onChange:this.handleInputChange,value:r,placeholder:e.placeholder,"aria-label":e.placeholder})):void 0,i?l.createElement("div",{className:"ui error message"},i):void 0,e.jsx,e.jsxd?e.jsxd():void 0,e.body?l.createElement("p",null,e.body):void 0,e.copyable?l.createElement("div",{className:"ui fluid action input"},l.createElement("input",{ref:"linkinput",className:"linkinput",readOnly:!0,spellCheck:!1,type:"text",value:""+e.copyable}),l.createElement(c.Button,{ref:"copybtn",labelPosition:"right",color:"teal",className:"copybtn","data-content":lf("Copied!")})):void 0)},e}(l.Component);n.CoreDialog=u,n.dialogIsShowing=function(){return!!o},n.forceUpdate=function(){o&&o.forceUpdate()},n.renderConfirmDialogAsync=function(n){return Promise.resolve().delay(10).then(function(){var e=document.body.appendChild(document.createElement("div")),t=a.render(l.createElement(u,n),e);return(o=t).promise.finally(function(){return a.unmountComponentAtNode(e),void setTimeout(function(){e.parentElement.removeChild(e),t===o&&(o=void 0)})})})},n.hideDialog=function(){o&&(o.hide(),o=void 0)};var p=function(n){function e(e){var t=n.call(this,e)||this;return t.state={visible:!0},t}return i(e,n),e.prototype.hide=function(){this.setState({visible:!1,content:void 0})},e.prototype.show=function(e){this.setState({visible:!0,content:e})},e.prototype.isVisible=function(){return this.state.visible},e.prototype.render=function(){var e=this.state,t=e.visible,n=e.content;return t?l.createElement(c.Dimmer,{isOpen:!0,active:t,closable:!1},l.createElement(c.Loader,{className:"large main msg no-select","aria-live":"assertive"},n)):l.createElement("div",null)},e}(l.Component);n.LoadingDimmer=p;var d=function(n){function e(e){var t=n.call(this,e)||this;return t.state={notifications:{}},t}return i(e,n),e.prototype.push=function(t){var n=this,r=this.state.notifications,e=ts.pxtc.Util.guidGen();Object.keys(r).filter(function(e){return r[e].kind==t.kind}).forEach(function(e){return n.remove(e)}),r[e]=t;var i=this;setTimeout(function(){i.remove(e)},3e3),this.setState({notifications:r})},e.prototype.remove=function(e){var t=this.state.notifications;t[e]&&(delete t[e],this.setState({notifications:t}))},e.prototype.render=function(){var t=this.state.notifications;return l.createElement("div",{id:"msg","aria-live":"polite"},Object.keys(t).map(function(e){return function(e,t){var n=t.kind,r=t.text,i=t.hc,o="ignored info message";switch(n){case"err":o="red inverted segment";break;case"warn":o="orange inverted segment";break;case"info":o="teal inverted segment";break;case"compile":o="ignored info message"}return l.createElement("div",{key:""+e,id:n+"msg",className:"ui "+i+" "+o},r)}(e,t[e])}))},e}(l.Component);n.NotificationMessages=d;var f,h=!1;n.pushNotificationMessage=function(e){if(h)f&&f.push(e);else{h=!0;var t=document.body.appendChild(document.createElement("div"));(f=a.render(l.createElement(d,e),t)).push(e)}}},{"./core":41,"./sui":100,react:284,"react-dom":240}],43:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./data"),s=e("./sui"),l=function(n){function e(e){var t=n.call(this,e)||this;return t.state={visible:!1,functionEditorWorkspace:null,functionCallback:null,initialMutation:null,functionBeingEdited:null},t.hide=t.hide.bind(t),t.modalDidOpen=t.modalDidOpen.bind(t),t.cancel=t.cancel.bind(t),t.confirm=t.confirm.bind(t),t}return i(e,n),e.prototype.hide=function(){pxt.BrowserUtils.removeClass(Blockly.WidgetDiv.DIV,"functioneditor");var e=this.state,t=e.functionEditorWorkspace,n=e.mainWorkspace;t.clear(),t.dispose(),n.refreshToolboxSelection(),this.setState({visible:!1,functionEditorWorkspace:null,functionCallback:null,initialMutation:null,functionBeingEdited:null})},e.prototype.show=function(e,t,n){pxt.tickEvent("createfunction.show",null,{interactiveConsent:!1}),this.setState({visible:!0,functionCallback:t,initialMutation:e,mainWorkspace:n})},e.prototype.modalDidOpen=function(e){var t=this,n=document.getElementById("functionEditorWorkspace"),r=this.state,i=r.functionEditorWorkspace,o=r.initialMutation;if(n){pxt.BrowserUtils.addClass(Blockly.WidgetDiv.DIV,"functioneditor"),(i=Blockly.inject(n,{trashcan:!1,scrollbars:!0})).showContextMenu_=function(){},i.clear();var a=i.newBlock("function_declaration");a.domToMutation(o),a.initSvg(),a.render(!1),i.centerOnBlock(a.id),i.addChangeListener(function(){var e=t.state.functionBeingEdited;e&&e.updateFunctionSignature()}),this.setState({functionEditorWorkspace:i,functionBeingEdited:a}),Blockly.svgResize(i)}},e.prototype.cancel=function(){pxt.tickEvent("createfunction.cancel",void 0,{interactiveConsent:!0}),this.hide()},e.prototype.confirm=function(){Blockly.hideChaff();var e=this.state,t=e.functionBeingEdited,n=e.mainWorkspace,r=e.functionCallback,i=t.mutationToDom();Blockly.Functions.validateFunctionExternal(i,n)&&(r(i),this.hide())},e.prototype.addArgumentFactory=function(e){var t=this;return function(){return t.addArgument(e)}},e.prototype.addArgument=function(e){var t=this.state.functionBeingEdited;switch(e){case"boolean":t.addBooleanExternal();break;case"string":t.addStringExternal();break;case"number":t.addNumberExternal();break;default:t.addCustomExternal(e)}},e.prototype.renderCore=function(){var t=this,e=this.state.visible,n=[{label:lf("Cancel"),onclick:this.hide,icon:"cancel",className:"cancel lightgrey"},{label:lf("Done"),onclick:this.confirm,icon:"check",className:"approve positive"}],r=this.getArgumentTypes().slice();return o.createElement(s.Modal,{isOpen:e,className:"createfunction",size:"large",closeOnEscape:!1,closeIcon:!1,closeOnDimmerClick:!1,closeOnDocumentClick:!1,dimmer:!0,buttons:n,header:lf("Edit Function"),modalDidOpen:this.modalDidOpen},o.createElement("div",null,o.createElement("span",{className:"ui text mobile only paramlabel"},lf("Add a parameter")),o.createElement("div",{className:"horizontal list"},o.createElement("span",{className:"ui text mobile hide paramlabel"},lf("Add a parameter")),r.map(function(e){return o.createElement(s.Button,{key:e.typeName,role:"button",className:"icon",icon:e.icon,textClass:"mobile hide",text:e.label||e.typeName,ariaLabel:lf("Add {0} parameter",e.label||e.typeName),onClick:t.addArgumentFactory(e.typeName)})})),o.createElement("div",{id:"functionEditorWorkspace"})))},e.prototype.getArgumentTypes=function(){if(!e.cachedFunctionTypes){var t=[{label:lf("Text"),typeName:"string",icon:pxt.blocks.defaultIconForArgType("string")},{label:lf("Boolean"),typeName:"boolean",icon:pxt.blocks.defaultIconForArgType("boolean")},{label:lf("Number"),typeName:"number",icon:pxt.blocks.defaultIconForArgType("number")}];pxt.appTarget.runtime&&pxt.appTarget.runtime.functionsOptions&&pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes&&Array.isArray(pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes)&&pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes.forEach(function(e){t.push(e)}),t.forEach(function(e){e.icon||(e.icon=pxt.blocks.defaultIconForArgType())}),e.cachedFunctionTypes=t}return e.cachedFunctionTypes},e.cachedFunctionTypes=null,e}(a.Component);n.CreateFunctionDialog=l},{"./data":44,"./sui":100,react:284}],44:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s,o,a=e("react"),l=e("./core"),c=pxt.Cloud,u=pxt.Util;(o=s=n.FetchStatus||(n.FetchStatus={}))[o.Pending=0]="Pending",o[o.Complete=1]="Complete",o[o.Error=2]="Error",o[o.Offline=3]="Offline";var p={};w("cloud",{getAsync:function(e){return c.privateGetAsync(k(e)).catch(l.handleNetworkError)},expirationTime:function(e){return 6e4},isOffline:function(){return!c.isOnline()}}),w("cloud-search",{getAsync:function(e){return c.privateGetAsync(k(e)).catch(function(e){return l.handleNetworkError(e,[404]),{statusCode:404,headers:{},json:{}}})},expirationTime:function(e){return 6e4},isOffline:function(){return!c.isOnline()}}),w("gallery",{getAsync:function(e){return pxt.gallery.loadGalleryAsync(k(decodeURIComponent(e))).catch(function(e){return Promise.resolve(e)})},expirationTime:function(e){return 36e5}}),w("td-cloud",{getAsync:function(e){return u.httpGetJsonAsync("https://www.touchdevelop.com/api/"+k(e)).catch(l.handleNetworkError)},expirationTime:function(e){return 6e4}}),w("gh-search",{getAsync:function(t){return pxt.targetConfigAsync().then(function(e){return pxt.github.searchAsync(k(t),e?e.packages:void 0)}).catch(l.handleNetworkError)},expirationTime:function(e){return 6e4},isOffline:function(){return!c.isOnline()}}),w("gh-pkgcfg",{getAsync:function(e){return pxt.github.pkgConfigAsync(k(e)).catch(l.handleNetworkError)},expirationTime:function(e){return 6e4},isOffline:function(){return!c.isOnline()}});var d=void 0;w("target-config",{getAsync:function(e){d||(d=pxt.targetConfigAsync().then(function(e){return e&&(pxt.storage.setLocal("targetconfig",JSON.stringify(e)),x("target-config"),x("gh-search"),x("gh-pkgcfg")),e}).catch(l.handleNetworkError));var t=JSON.parse(pxt.storage.getLocal("targetconfig")||"null");return t?Promise.resolve(t):d},expirationTime:function(e){return 864e5},isOffline:function(){return!c.isOnline()}});var f={};function h(n){var e=n.subscriptions;0!=e.length&&(n.subscriptions=[],e.forEach(function(e){var t=e.components.indexOf(n);0<=t&&e.components.splice(t,1)}))}function m(e){return e.api.expirationTime?null==e.data||Date.now()-e.lastRefresh>e.api.expirationTime(e.path):!e.lastRefresh}function g(e){return!(!e.data||e.data instanceof Error)&&/^cloud:(me\/settings|ptr-pkg-)/.test(e.path)}function v(){var e=u.values(f).filter(function(e){return g(e)}).map(function(e){return{path:e.path,data:e.data}});pxt.storage.setLocal("apiCache2",JSON.stringify(e))}function y(t){if(!(t.queued||t.api.isOffline&&t.api.isOffline())){t.queued=!0;var e=function(e){t.data=e,t.lastRefresh=pxt.Util.now(),t.queued=!1,function(e){g(e)&&v();var t=e.callbackOnce;0<t.length&&(e.callbackOnce=[],u.nextTick(function(){return t.forEach(function(e){return e()})})),0<e.components.length&&e.components.forEach(function(e){return u.nextTick(function(){return e.forceUpdate()})})}(t)};t.api.isSync?e(t.api.getSync(t.path)):t.api.getAsync(t.path).done(e)}}function b(e){return f.hasOwnProperty(e)||(f[e]={path:e,data:null,lastRefresh:0,queued:!1,callbackOnce:[],components:[],api:(t=e,n=/^([\w\-]+):/.exec(t),n&&p[n[1]]||u.oops("bad data protocol: "+t),p[n[1]])}),f[e];var t,n}function _(e,t){var n,r,i;n=e,r=b(t),(i=r.components).indexOf(n)<0&&(i.push(n),n.subscriptions.push(r));var o=b(t);if(o.api.isSync)return{data:o.api.getSync(o.path),status:s.Complete};var a={data:o.data,status:s.Complete};return(m(o)||o.data instanceof Error)&&(a.status=o.data instanceof Error?s.Error:s.Pending,o.api.isOffline&&o.api.isOffline()?a.status=s.Offline:y(o)),a}function w(e,t){u.assert(!p[e]),u.assert(!!t.getSync||!!t.getAsync),u.assert(!!t.getSync!=!!t.getAsync),t.isSync=!!t.getSync,p[e]=t}function k(e){var t=/^([\w\-]+):(.*)/.exec(e);return t?t[2]:(u.oops("protocol missing in: "+e),e)}function x(n){u.values(f).forEach(function(e){var t;t=n,e.path.slice(0,t.length)==t&&((e.lastRefresh=0)<e.components.length&&y(b(e.path)),e.api.onInvalidated&&e.api.onInvalidated())})}n.clearCache=function(){f={},v()},n.mountVirtualApi=w,n.stripProtocol=k,n.invalidate=x,n.getAsync=function(e){var n=b(e);return n.api.isSync?Promise.resolve(n.api.getSync(n.path)):c.isOnline()&&m(n)?new Promise(function(e,t){n.callbackOnce.push(function(){e(n.data)}),y(n)}):Promise.resolve(n.data)};var E=function(n){function e(e){var t=n.call(this,e)||this;return t.subscriptions=[],t.renderCoreOk=!1,t.state={},t}return i(e,n),e.prototype.getData=function(e){return this.getDataWithStatus(e).data},e.prototype.getDataWithStatus=function(e){return this.renderCoreOk||u.oops("Override renderCore() not render()"),_(this,e)},e.prototype.hasCloud=function(){return!!this.getData("sync:hascloud")},e.prototype.hasSync=function(){return!!this.getData("sync:hassync")},e.prototype.getUser=function(){return this.getData("sync:user")},e.prototype.componentWillUnmount=function(){h(this)},e.prototype.child=function(e){return l.findChild(this,e)},e.prototype.renderCore=function(){return null},e.prototype.render=function(){return h(this),this.renderCoreOk=!0,this.renderCore()},e.prototype.setStateAsync=function(n){var r=this;return new Promise(function(e,t){r.setState(n,function(){e()})})},e}(a.Component);n.Component=E;var C=function(n){function e(e){var t=n.call(this,e)||this;return t.renderCoreOk=!1,t.state={},t}return i(e,n),e.prototype.child=function(e){return l.findChild(this,e)},e.prototype.renderCore=function(){return null},e.prototype.render=function(){return this.renderCoreOk=!0,this.renderCore()},e}(a.PureComponent);n.PureComponent=C,JSON.parse(pxt.storage.getLocal("apiCache2")||"[]").forEach(function(e){b(e.path).data=e.data})},{"./core":41,react:284}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("bluebird");window.Promise=r;var i=e("pouchdb");e("pouchdb/extras/memory"),r.config({warnings:{wForgottenReturn:!1}});var o=void 0;function a(){return pxt.debug("db: in memory..."),!0,o=new i("pxt-"+pxt.storage.storageId(),{adapter:"memory"}),r.resolve(o)}function s(){if(o)return r.resolve(o);if(pxt.shell.isSandboxMode()||pxt.shell.isReadOnly())return a();var t=new i("pxt-"+pxt.storage.storageId(),{revs_limit:2});return t.get("pouchdbsupportabletest").catch(function(e){return e&&e.error&&"indexed_db_went_bad"==e.name?a():(o=t,r.resolve(o))}).finally(function(){pxt.log("PouchDB adapter: "+o.adapter)})}n.getDbAsync=s,n.destroyAsync=function(){return o?o.destroy():r.resolve()};var l=function(){function e(e){this.name=e}return e.prototype.getAsync=function(t){var n=this;return s().then(function(e){return e.get(n.name+"--"+t)}).then(function(e){return e.id=t,e})},e.prototype.getAllAsync=function(){var t=this;return s().then(function(e){return e.allDocs({include_docs:!0,startkey:t.name+"--",endkey:t.name+"--"})}).then(function(e){return e.rows.map(function(e){return e.doc})})},e.prototype.deleteAsync=function(t){return s().then(function(e){return e.remove(t)})},e.prototype.forceSetAsync=function(t){var n=this;return this.getAsync(t.id).then(function(e){return t._rev=e._rev,n.setAsync(t)},function(e){return n.setAsync(t)})},e.prototype.setAsync=function(t){var n=this;return this.setAsyncNoRetry(t).then(function(e){return pxt.BrowserUtils.scheduleStorageCleanup(),e}).catch(function(e){if(409!=e.status)return pxt.reportException(e),pxt.log("table: set failed, cleaning translation db"),pxt.BrowserUtils.clearTranslationDbAsync().then(function(){return n.setAsyncNoRetry(t)}).catch(function(e){pxt.reportException(e),pxt.log("table: we are out of space...")});pxt.debug("table: set conflict (409)")})},e.prototype.setAsyncNoRetry=function(t){return t.id&&!t._id&&(t._id=this.name+"--"+t.id),s().then(function(e){return e.put(t)}).then(function(e){return e.rev})},e}();n.Table=l;var c=function(){function e(){this.mem=new pxt.github.MemoryGithubDb,this.table=new l("github")}return e.prototype.loadConfigAsync=function(t,n){var r=this;if("master"==n)return this.mem.loadConfigAsync(t,n);var i="config-"+t+"-"+n;return this.table.getAsync(i).then(function(e){return pxt.debug("github offline cache hit "+i),e.config},function(e){return pxt.debug("github offline cache miss "+i),r.mem.loadConfigAsync(t,n).then(function(t){return r.table.forceSetAsync({id:i,config:t}).then(function(){return t},function(e){return t})})})},e.prototype.loadPackageAsync=function(t,n){var r=this;if("master"==n)return this.mem.loadPackageAsync(t,n);var i="pkg-"+t+"-"+n;return this.table.getAsync(i).then(function(e){return pxt.debug("github offline cache hit "+i),e.package},function(e){return pxt.debug("github offline cache miss "+i),r.mem.loadPackageAsync(t,n).then(function(t){return r.table.forceSetAsync({id:i,package:t}).then(function(){return t},function(e){return t})})})},e}();pxt.github.db=new c},{bluebird:115,pouchdb:220,"pouchdb/extras/memory":218}],46:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./debuggerTable"),s=function(t){function e(e){var a=t.call(this,e)||this;return a.handleRowClick=function(e,t){if(a.props.openLocation){var n=t.props.refID.split("_").map(function(e){return parseInt(e)}),r=n[0],i=n[1],o=a.props.stackframes[i];o&&o.breakpointId===r&&a.props.openLocation(o.breakpointId,i)}},a}return i(e,t),e.prototype.render=function(){var i=this;return o.createElement(a.DebuggerTable,{header:lf("Call Stack")},this.props.stackframes.map(function(e,t){if(!e.breakpointId)return null;var n=e.breakpointId+"_"+t,r=e.funcInfo.fileName;return 0===r.indexOf("pxt_modules/")&&(r=r.slice(12)),o.createElement(a.DebuggerTableRow,{key:n,refID:n,onClick:i.handleRowClick,leftText:e.funcInfo.functionName,rightText:r+":"+e.funcInfo.line,icon:t===i.props.activeFrame?"arrow right":void 0,rowClass:"callstack-row"})}))},e}(o.Component);n.DebuggerCallStack=s},{"./debuggerTable":47,react:284}],47:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return o.createElement("div",{className:"ui varExplorer"},o.createElement("div",{className:"ui variableTableHeader"},this.props.header),o.createElement("div",{className:"ui segment debugvariables "+(this.props.frozen?"frozen":"")+" ui collapsing basic striped table"},this.props.children))},t}(o.Component);n.DebuggerTable=a;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clickHandler=function(e){t.props.onClick&&t.props.onClick(e,t)},t}return i(t,e),t.prototype.render=function(){return o.createElement("div",{role:"listitem",className:"item "+(this.props.rowClass||""),onClick:this.props.onClick?this.clickHandler:void 0},o.createElement("div",{className:"variableAndValue"},o.createElement("div",{className:"variable varname "+(this.props.leftClass||""),title:this.props.leftTitle,style:this.props.depth?{marginLeft:.75*this.props.depth+"em"}:void 0},o.createElement("i",{className:"ui icon small "+(this.props.icon||"invisible")}),o.createElement("span",null,this.props.leftText)),o.createElement("div",{className:"variable detail",style:{padding:.2},title:this.props.rightTitle},o.createElement("span",{className:"varval "+(this.props.rightClass||"")},this.props.rightText))))},t}(o.Component);n.DebuggerTableRow=s},{react:284}],48:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var h=e("react"),o=e("react-dom"),m=e("./sui"),a=e("./data"),g=e("./simulator"),s=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.restartSimulator=t.restartSimulator.bind(t),t.dbgPauseResume=t.dbgPauseResume.bind(t),t.dbgStepOver=t.dbgStepOver.bind(t),t.dbgStepInto=t.dbgStepInto.bind(t),t.dbgStepOut=t.dbgStepOut.bind(t),t.exitDebugging=t.exitDebugging.bind(t),t}return i(e,n),e.prototype.restartSimulator=function(){pxt.tickEvent("debugger.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()},e.prototype.exitDebugging=function(){pxt.tickEvent("debugger.exit",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()},e.prototype.dbgPauseResume=function(){pxt.tickEvent("debugger.pauseresume",void 0,{interactiveConsent:!0}),this.props.parent.dbgPauseResume()},e.prototype.dbgStepOver=function(){pxt.tickEvent("debugger.stepover",void 0,{interactiveConsent:!0}),this.props.parent.dbgStepOver()},e.prototype.dbgStepInto=function(){pxt.tickEvent("debugger.stepinto",void 0,{interactiveConsent:!0}),this.props.parent.dbgStepInto()},e.prototype.dbgStepOut=function(){pxt.tickEvent("debugger.stepout",void 0,{interactiveConsent:!0}),g.dbgStepOut()},e.prototype.getMenuDom=function(){var e=o.findDOMNode(this);return e&&e.firstElementChild},e.prototype.renderCore=function(){var e=this.props.parent.state,t=e.simState,n=t==pxt.editor.SimState.Running,r=t==pxt.editor.SimState.Starting,i=e.debugging;if(!i)return h.createElement("div",null);var o=g.driver&&g.driver.state==pxsim.SimulatorState.Running,a=!this.props.parent.isBlocksActive();if(!(a||this.props.parent.isBlocksActive()||pxt.appTarget.appTheme.debugExtensionCode))return h.createElement("div",null);var s=o||r,l=s?"disabled":"",c=lf("Restart debugging"),u=n?lf("Pause execution"):lf("Continue execution"),p=lf("Step into"),d=lf("Step over"),f=lf("Step out");return i?a?h.createElement("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")},i?h.createElement("div",{className:"ui compact borderless menu icon"},h.createElement(m.Item,{key:"dbgpauseresume",className:"dbg-btn dbg-pause-resume "+l+" "+(o?"pause":"play"),icon:o?"pause blue":"play green",title:u,onClick:this.dbgPauseResume}),h.createElement(m.Item,{key:"dbgstepover",className:"dbg-btn dbg-step-over "+l,icon:"xicon stepover "+(o?"disabled":"blue"),title:d,onClick:this.dbgStepOver}),h.createElement(m.Item,{key:"dbgstepinto",className:"dbg-btn dbg-step-into "+l,icon:"xicon stepinto "+(o?"disabled":""),title:p,onClick:this.dbgStepInto}),h.createElement(m.Item,{key:"dbgstepout",className:"dbg-btn dbg-step-out "+l,icon:"xicon stepout "+(o?"disabled":""),title:f,onClick:this.dbgStepOut}),h.createElement(m.Item,{key:"dbgrestart",className:"dbg-btn dbg-restart right",icon:"refresh green",title:c,onClick:this.restartSimulator})):void 0):h.createElement("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")},h.createElement("div",{className:"ui compact borderless menu icon"},h.createElement(m.Item,{key:"dbgstep",className:"dbg-btn dbg-step separator-after "+l,icon:"arrow right "+(s?"disabled":"blue"),title:p,onClick:this.dbgStepInto,text:"Step"}),h.createElement(m.Item,{key:"dbgpauseresume",className:"dbg-btn dbg-pause-resume "+(o?"pause":"play"),icon:o?"pause blue":"play green",title:u,onClick:this.dbgPauseResume}),h.createElement(m.Item,{key:"dbgrestart",className:"dbg-btn dbg-restart",icon:"refresh green",title:c,onClick:this.restartSimulator}))):h.createElement("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")})},e}(a.Component);n.DebuggerToolbar=s},{"./data":44,"./simulator":92,"./sui":100,react:284,"react-dom":240}],49:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./debuggerCallStack"),s=e("./debuggerVariables"),l=e("./debuggerToolbar"),c=function(n){function e(e){var t=n.call(this,e)||this;return t.state={sequence:0,currentFrame:0},t}return i(e,n),e.prototype.setBreakpoint=function(e,t){this.setState({lastBreakpoint:e,currentFrame:0,sequence:this.state.sequence+1,varFilters:t||this.state.varFilters})},e.prototype.render=function(){return o.createElement("div",null,o.createElement(l.DebuggerToolbar,{parent:this.props.parent}),o.createElement(s.DebuggerVariables,{apis:this.props.apis,breakpoint:this.state.lastBreakpoint,filters:this.state.varFilters,activeFrame:this.state.currentFrame,sequence:this.state.sequence}),this.props.showCallStack&&o.createElement(a.DebuggerCallStack,{openLocation:this.props.openLocation,activeFrame:this.state.currentFrame,stackframes:this.state.lastBreakpoint?this.state.lastBreakpoint.stackframes:[]}))},e}(o.Component);n.DebuggerToolbox=c},{"./debuggerCallStack":46,"./debuggerToolbar":48,"./debuggerVariables":50,react:284}],50:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var c=e("react"),o=e("./data"),s=e("./simulator"),u=e("./debuggerTable"),p=20,l=function(t){function e(e){var a=t.call(this,e)||this;return a.handleComponentClick=function(e,t){if(!a.state.frozen)for(var n=t.props.refID,r=0,i=a.getFullVariableList();r<i.length;r++){var o=i[r];if(o.id===n)return void a.toggle(o)}},a.state={globalFrame:{title:lf("Globals"),variables:[]},stackFrames:[],nextID:0},a}return i(e,t),e.prototype.clear=function(){this.setState({globalFrame:{title:this.state.globalFrame.title,variables:[]},stackFrames:[]})},e.prototype.update=function(e){void 0===e&&(e=!1),this.setState({frozen:e})},e.prototype.componentDidUpdate=function(e){this.props.breakpoint?this.props.sequence!=this.state.renderedSequence&&this.updateVariables(this.props.breakpoint.globals,this.props.breakpoint.stackframes,this.props.filters):this.state.frozen||this.setState({frozen:!0})},e.prototype.renderCore=function(){var e=this.state,t=e.globalFrame,n=e.stackFrames,r=e.frozen,i=lf("Variables"),o=t.variables;return n&&n.length&&void 0!==this.props.activeFrame&&(o=n[this.props.activeFrame].variables.concat(o)),c.createElement(u.DebuggerTable,{header:i,frozen:r},this.renderVars(o))},e.prototype.renderVars=function(e,a,s){var l=this;return void 0===a&&(a=0),void 0===s&&(s=[]),e.forEach(function(e){var t,n,r,i=function(e){var t="";switch(typeof e){case"undefined":t="undefined";break;case"number":case"boolean":t=e+"";break;case"string":t=JSON.stringify(e);break;case"object":if(null==e)t="null";else if(e.text)t=e.text;else{if(e.id&&e.preview)return e.preview;t=void 0!==e.id?"(object)":"(unknown)"}}return t}(e.value),o=function(e){var t=e.value;if(null==t)return"undefined";var n=typeof t;switch(n){case"string":case"number":case"boolean":return n;case"object":return t.type?t.type:t.preview?t.preview:t.text?t.text:"object";default:return"unknown"}}(e);s.push(c.createElement(u.DebuggerTableRow,{key:e.id,refID:e.id,icon:e.value&&e.value.hasFields?e.children?"down triangle":"right triangle":void 0,leftText:e.name+":",leftTitle:e.name,leftClass:void 0!==e.prevValue?"changed":void 0,rightText:(t=i,n=p-3,r=!1,0==t.indexOf('"')&&(n-=2,r=!0,t=t.substring(1,t.length-1)),t.length>n&&(t=t.substring(0,n)+"..."),r&&(t='"'+t+'"'),t),rightTitle:function(e){switch(e){case"string":case"number":case"boolean":case"array":return!0;default:return!1}}(o)?i:void 0,rightClass:o,onClick:l.handleComponentClick,depth:a})),e.children&&l.renderVars(e.children,a+1,s)}),s},e.prototype.updateVariables=function(e,t,n){if(e){var r,i=0,o=d(this.state.globalFrame,e);if(n&&(o.variables=o.variables.filter(function(e){return-1!==n.indexOf(e.name)})),l(o.variables),t){var a=this.state.stackFrames;(r=t.map(function(e,t){for(var n=e.breakpointId+"_"+t,r=0,i=a;r<i.length;r++){var o=i[r];if(o.key===n)return d(o,e.locals,s(e.arguments))}return d({key:n,title:e.funcInfo.functionName,variables:[]},e.locals,s(e.arguments))})).forEach(function(e){return l(e.variables)})}this.setState({globalFrame:o,stackFrames:r||[],nextID:i,renderedSequence:this.props.sequence,frozen:!1})}else this.update(!0);function s(e){return e?null!=e.thisParam?[{name:"this",value:e.thisParam}].concat(e.params):e.params:[]}function l(e){e.forEach(function(e){e.id=i++,e.children&&l(e.children)})}},e.prototype.getFullVariableList=function(){var t=[];return n(this.state.globalFrame.variables),this.state.stackFrames&&this.state.stackFrames.forEach(function(e){return n(e.variables)}),t;function n(e){e.forEach(function(e){t.push(e),e.children&&n(e.children)})}},e.prototype.toggle=function(e){var r=this;if(e.children)delete e.children,this.setState({globalFrame:this.state.globalFrame});else{if(!e.value||!e.value.id)return;var n=this.props.apis,t=new RegExp("^((.+.)?"+e.value.type+")."),i=[];Object.keys(n).filter(function(e){return t.test(e)}).forEach(function(e){var t=n[e];!e.endsWith("@set")&&t&&t.attributes.callInDebugger&&i.push(e)}),s.driver.variablesAsync(e.value.id,i).then(function(t){if(t&&t.variables){var n=r.state.nextID;e.children=Object.keys(t.variables).map(function(e){return{name:e,value:t.variables[e],id:n++}}),r.setState({globalFrame:r.state.globalFrame,nextID:n})}})}},e}(o.Component);function d(e,n,t){var r,i,o=Object.keys(n).map(function(e){return{name:(t=e,t.replace(/___\d+$/,"")),value:n[e]};var t});return t&&(o=t.concat(o)),a({},e,{variables:(r=e.variables,i=o,i.map(function(e){var t=function(e,t){for(var n=0;n<e.length;n++)if(e[n].name===t.name)return e[n]}(r,e);return t&&t.value&&!t.value.id&&t.value!==e.value?a({},e,{prevValue:t.value}):e}))})}n.DebuggerVariables=l},{"./data":44,"./debuggerTable":47,"./simulator":92,react:284}],51:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var f=e("react"),l=e("./sui"),h=e("./core"),c=e("./coretsx"),o=pxt.Cloud,a=pxt.Util;function m(e,t,n){return f.createElement("p",null,lf("{0} version:",e)," ",f.createElement("a",{href:encodeURI(n),title:""+lf("{0} version: {1}",e,t),target:"_blank",rel:"noopener noreferrer"},t))}n.showAboutDialogAsync=function(e){var s=pxt.appTarget.compileService,l=pxt.appTarget.appTheme.githubUrl,c=pxt.appTarget.appTheme,u=pxt.appTarget.versions,p=s&&s.githubCorePackage&&s.gittag&&s.serviceId,d=[];c.experiments&&d.push({label:lf("Experiments"),className:"secondary",onclick:function(){h.hideDialog(),pxt.tickEvent("about.experiments",void 0,{interactiveConsent:!0}),e.showExperimentsDialog()}}),pxt.targetConfigAsync().then(function(e){var t,n,r,i,o=pxt.BrowserUtils.isPxtElectron(),a=e&&e.electronManifest;return h.confirmAsync({header:lf("About"),hideCancel:!0,agreeLbl:lf("Ok"),agreeClass:"positive",buttons:d,jsx:f.createElement("div",null,o?pxt.Cloud.isOnline()&&a?pxt.semver.strcmp(pxt.appTarget.versions.target,a.latest)<0?f.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"/offline-app"},lf("An update {0} for {1} is available",a.latest,pxt.appTarget.title)):f.createElement("p",null,lf("{0} is up to date",pxt.appTarget.title)):f.createElement("p",null,lf("Please connect to internet to check for updates")):void 0,l&&u?m(pxt.appTarget.name,u.target,l+"/releases/tag/v"+u.target):void 0,u?m("Microsoft MakeCode",u.pxt,"https://github.com/Microsoft/pxt/releases/tag/v"+u.pxt):void 0,p?(t=s,"object"==typeof t.codalTarget&&"string"==typeof t.codalTarget.url?(n=t.codalTarget.branch?pxt.BrowserUtils.joinURLs(t.codalTarget.url,"releases/tag",t.codalTarget.branch):t.codalTarget.url,r=t.codalTarget.branch||"master",i=t.codalTarget.name||t.serviceId):(n="https://github.com/"+t.githubCorePackage+"/releases/tag/"+t.gittag,r=t.gittag,i=t.serviceId),m(lf("{0} runtime",i),r,n)):void 0,f.createElement("p",null,f.createElement("br",null)),f.createElement("p",null,c.termsOfUseUrl?f.createElement("a",{target:"_blank",className:"item",href:c.termsOfUseUrl,rel:"noopener noreferrer"},lf("Terms of Use")):void 0," ",c.privacyUrl?f.createElement("a",{target:"_blank",className:"item",href:c.privacyUrl,rel:"noopener noreferrer"},lf("Privacy")):void 0),c.copyrightText?f.createElement("p",null," ",c.copyrightText," "):void 0)})}).done()},n.showPackageErrorDialogAsync=function(e,t,n){var r=!1,i=new a.CancellationToken;return pxt.tickEvent("update.extensionErrorsShown"),h.dialogAsync({header:lf("Extension Errors"),hasCloseIcon:!0,hideCancel:!0,jsx:f.createElement("div",{className:"wizard-wrapper"},f.createElement(s,{openLegacyEditor:n,affectedPackages:e,updatePackages:t,onProjectOpen:function(){return r=!0},token:i}))}).then(function(){return r?Promise.resolve():(h.showLoading("package-update-cancel",lf("Stopping update...")),i.cancelAsync())}).then(function(){return h.hideLoading("package-update-cancel"),r})};var s=function(n){function e(e){var t=n.call(this,e)||this;return t.state={updating:!1,showProgressBar:!1,updateComplete:!1,packagesUpdated:0},t.startUpdate=t.startUpdate.bind(t),t.openProject=t.openProject.bind(t),t.openLegacyEditor=t.openLegacyEditor.bind(t),t}return i(e,n),e.prototype.startUpdate=function(){var t=this;if(!this.state.updating){pxt.tickEvent("update.startExtensionUpdate");var n=Date.now();this.setState({updating:!0}),setTimeout(function(){t.props.token.isCancelled()||t.state.updating&&1<t.props.affectedPackages.length&&t.setState({showProgressBar:!0})},3e3);var e=this.props.affectedPackages;this.props.token.onProgress(function(e){t.setState({packagesUpdated:e})}),this.props.updatePackages(e,this.props.token).then(function(e){t.props.token.isCancelled()||(pxt.tickEvent("update.endExtensionUpdate",{success:""+e,duration:Date.now()-n}),e?(t.setState({updating:!1,updateComplete:!0}),setTimeout(function(){t.props.token.isCancelled()||t.openProject(!0)},1500)):t.setState({updateError:!0,updating:!1}))})}},e.prototype.openProject=function(e){void 0===e&&(e=!1),e||pxt.tickEvent("update.ignoredExtensionErrors"),this.props.onProjectOpen(),c.hideDialog()},e.prototype.openLegacyEditor=function(){this.props.onProjectOpen(),this.props.openLegacyEditor()},e.prototype.buildActionList=function(){var e=[];return this.state.updateError||e.push({text:lf("Try to fix"),title:lf("Update all extensions in the project to their latest versions"),callback:this.startUpdate}),e.push({text:lf("Ignore errors and open"),title:lf("Ignore errors and open"),callback:this.openProject}),this.props.openLegacyEditor&&e.push({text:lf("Go to the old editor"),title:lf("Open this project in the editor where it was created"),callback:this.openLegacyEditor}),e},e.prototype.render=function(){var e=this.props.affectedPackages,t=this.state,n=t.updating,r=t.updateComplete,i=t.packagesUpdated,o=t.updateError,a=t.showProgressBar;if(n){var s=i===e.length?lf("Finishing up..."):lf("Updating extension {0} of {1}...",i+1,e.length);return f.createElement("div",null,a?f.createElement(u,{percentage:i/e.length*100,label:s}):f.createElement("div",{className:"ui centered inline inverted text loader"},s))}if(r)return f.createElement("div",null,f.createElement("h2",{className:"ui center aligned icon header"},f.createElement("i",{className:"green check circle outline icon"}),lf("Update complete")));var l=o?lf("Looks like updating didn't fix the issue. How would you like to proceed?"):lf("Looks like there are some errors in the extensions added to this project. How would you like to proceed?");return f.createElement("div",null,f.createElement("p",null,l),f.createElement(p,{actions:this.buildActionList()}))},e}(f.Component),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.percentage,n=e.label,r=e.cornerRadius;return r=null==r?3:Math.max(r,0),t=Math.max(Math.min(t,100),2),f.createElement("div",null,f.createElement("div",{className:"progress-bar-container"},f.createElement("svg",{className:"progress-bar",width:"100%",height:"100%"},f.createElement("rect",{className:"progress-bar-bg",width:"100%",height:"100%",rx:r,ry:r}),f.createElement("rect",{className:"progress-bar-content",width:t.toString()+"%",height:"100%",rx:r,ry:r}))),n?f.createElement("p",{className:"progress-bar-label"},n):void 0)},t}(f.Component),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){return f.createElement("div",{className:"ui relaxed list",role:"menu"},this.props.actions.map(function(e,t){var n=e.text,r=e.title,i=e.callback;return f.createElement("div",{className:"item wizard-action","aria-label":r,title:r,onClick:i,role:"menuitem",key:t},f.createElement("span",{className:"left floated"},f.createElement("i",{className:"medium arrow right icon"})),f.createElement(l.Link,null,n))}))},t}(l.StatelessUIElement);function d(e){return 401==e.statusCode?(h.errorNotification(lf("GitHub didn't accept token")),!0):404==e.statusCode&&(h.errorNotification(lf("Token has neither '{0}' nor '{1}' scope","repo","public_repo")),!0)}n.showCommitDialogAsync=function(e){var t,n=lf("Updates."),r=!1;return h.confirmAsync({header:lf("Commit to {0}",e),agreeLbl:lf("Commit"),onLoaded:function(e){t=e.querySelectorAll("input")[0]},jsx:f.createElement("div",{className:"ui form"},f.createElement("div",{className:"ui field"},f.createElement("label",{id:"selectUrlToOpenLabel"},lf("Describe your changes.")),f.createElement("input",{type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:n,className:"ui blue fluid"})),f.createElement("div",{className:"ui field"},f.createElement(l.PlainCheckbox,{label:lf("Publish to users (bump)"),onChange:function(e){r=!!e}})))}).then(function(e){if(e)return pxt.tickEvent("app.commit.ok"),{msg:t.value||n,bump:r}})},n.showPRDialogAsync=function t(n,r){return h.confirmAsync({header:lf("Commit conflict in {0}",n),agreeLbl:lf("Resolve conflict"),disagreeLbl:lf("I'm done!"),body:lf("The latest online version of {0} contains edits conflicting with yours. We have created a pull request (PR) that you can use to resolve the conflicts. Once you're done, sync to get all merged changes. In the meantime we have taken you to the latest online version of {0}.",n)}).then(function(e){return e?(pxt.tickEvent("app.commit.pr"),window.open(r,"_blank"),t(n,r)):Promise.resolve()})},n.showImportUrlDialogAsync=function(){var r,e=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";return h.confirmAsync({header:lf("Open project URL"),onLoaded:function(e){r=e.querySelectorAll("input")[0]},jsx:f.createElement("div",{className:"ui form"},f.createElement("div",{className:"ui icon violet message"},f.createElement("i",{className:"user icon","aria-hidden":!0}),f.createElement("div",{className:"content"},f.createElement("h3",{className:"header"},lf("User-provided content")),f.createElement("p",null,lf("The content below is provided by a user, and is not endorsed by Microsoft."),f.createElement("br",null),lf("If you think it's not appropriate, please report abuse through Settings -> Report Abuse.")))),f.createElement("div",{className:"ui field"},f.createElement("label",{id:"selectUrlToOpenLabel"},lf("Copy the URL of the project.")),f.createElement("input",{type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:lf("{0} or {1}...",e,"https://github.com/..."),className:"ui blue fluid"})))}).then(function(e){if(e){pxt.tickEvent("app.open.url");var t,n=r.value;return(t=/^(github:|https:\/\/github\.com\/)/.test(n)?pxt.github.normalizeRepoId(n):pxt.Cloud.parseScriptId(n))?Promise.resolve(t):Promise.reject(new Error(lf("Sorry, the project url looks invalid.")))}return Promise.resolve(void 0)})},n.showGithubTokenError=d,n.showCreateGithubRepoDialogAsync=function(e){pxt.tickEvent("github.create.dialog"),e&&(e=(e=e.toLocaleLowerCase().replace(/\s+/g,"-")).replace(/[^\w\-]/g,""),/^pxt-/.test(e)||(e="pxt-"+e));var t=e||"",n="",r=!0;function i(){return t=="pxt-"+lf("Untitled").toLocaleLowerCase()||"pxt-untitled"==t?lf("Please pick a different name."):/^[\w\-]{1,64}$/.test(t)?void 0:lf("Repository names must be less than 64 characters and cannot include spaces or special characters.")}function o(e){e=e.trim(),t!=e&&(t=e,c.forceUpdate())}function a(e){n!=e&&(n=e,c.forceUpdate())}function s(e){var t=0==e.currentTarget.selectedIndex;r!=t&&(r=t,c.forceUpdate())}return h.confirmAsync({hideCancel:!0,hasCloseIcon:!0,header:lf("Create GitHub repository"),jsxd:function(){var e=i();return f.createElement("div",{className:"ui form"},f.createElement("p",null,lf("Host your code on GitHub and work together with friends."),l.helpIconLink("/github",lf("Learn more about GitHub"))),f.createElement("div",{className:"ui field"},f.createElement(l.Input,{type:"url",value:t,onChange:o,label:lf("Repository name"),placeholder:"pxt-my-gadget...",class:"fluid",error:e})),f.createElement("div",{className:"ui field"},f.createElement(l.Input,{type:"text",value:n,onChange:a,label:lf("Repository description"),placeholder:lf("MakeCode extension for my gadget"),class:"fluid"})),f.createElement("div",{className:"ui field"},f.createElement("select",{className:"ui dropdown",onChange:s},f.createElement("option",{"aria-selected":!r,value:"false"},lf("Private repository, your code is only visible to you.")),f.createElement("option",{"aria-selected":r,value:"true"},lf("Public repository, anyone can look at your code.")))))}}).then(function(e){if(e){if(!i())return h.showLoading("creategithub",lf("creating {0} repository...",t)),pxt.github.createRepoAsync(t,n.trim(),!r).finally(function(){return h.hideLoading("creategithub")}).then(function(e){return pxt.tickEvent("github.create.ok"),pxt.github.normalizeRepoId("https://github.com/"+e.fullName)},function(e){return d(e)||(422==e.statusCode?h.errorNotification(lf("Repository '{0}' already exists.",t)):h.errorNotification(e.message),pxt.tickEvent("github.create.error",{statusCode:e.statusCode})),""});h.errorNotification(lf("Invalid repository name.")),pxt.tickEvent("github.create.invalidname")}else pxt.tickEvent("github.create.cancel");return""})},n.showImportGithubDialogAsync=function(){var n="",t=function(){n="NEW",h.hideDialog()};return h.showLoading("githublist",lf("Getting repo list...")),pxt.github.listUserReposAsync().finally(function(){return h.hideLoading("githublist")}).then(function(e){var t=function(e){return/pxt|makecode/.test(e.name)};return e.filter(t).concat(e.filter(function(e){return!t(e)})).map(function(e){return{name:e.fullName,description:e.description,updatedAt:e.updatedAt,onClick:function(){n=pxt.github.normalizeRepoId("https://github.com/"+e.fullName),h.hideDialog()}}})}).then(function(e){return h.confirmAsync({header:lf("Clone or create your own GitHub repo"),hideAgree:!0,jsx:f.createElement("div",{className:"ui form"},f.createElement("div",{className:"ui relaxed divided list",role:"menu"},f.createElement("div",{key:"create new",className:"item"},f.createElement("i",{className:"large plus circle middle aligned icon"}),f.createElement("div",{className:"content"},f.createElement("a",{onClick:t,role:"menuitem",className:"header",title:lf("Create new GitHub repository")},f.createElement("b",null,lf("Create new..."))),f.createElement("div",{className:"description"},lf("Create a new GitHub repo in your account.")))),e.map(function(e){return f.createElement("div",{key:e.name,className:"item"},f.createElement("i",{className:"large github middle aligned icon"}),f.createElement("div",{className:"content"},f.createElement("a",{onClick:e.onClick,role:"menuitem",className:"header"},e.name),f.createElement("div",{className:"description"},pxt.Util.timeSince(e.updatedAt),". ",e.description)))})),f.createElement("div",{className:"ui icon green message"},f.createElement("i",{className:"info circle icon"}),f.createElement("div",{className:"content"},f.createElement("h3",{className:"header"},lf("Not finding what you're looking for?")),f.createElement("p",null,lf("Use the 'Import URL' option in the previous dialog to import repo by exact URL.")))))})}).then(function(){return n})},n.showImportFileDialogAsync=function(e){var t,n=[pxt.appTarget.compile.saveAsPNG?".png":".mkcd"];return pxt.appTarget.compile.hasHex&&n.push(".hex"),pxt.appTarget.compile.useUF2&&n.push(".uf2"),h.confirmAsync({header:lf("Open {0} file",n.join(lf(" or "))),onLoaded:function(e){t=e.querySelectorAll("input")[0]},jsx:f.createElement("div",{className:"ui form"},f.createElement("div",{className:"ui field"},f.createElement("label",{id:"selectFileToOpenLabel"},lf("Select a {0} file to open.",n.join(lf(" or ")))),f.createElement("input",{type:"file",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectFileToOpenLabel",className:"ui blue fluid"})),f.createElement("div",{className:"ui secondary segment"},lf("You can import files by dragging and dropping them anywhere in the editor!")))}).then(function(e){if(e)return t.files[0]})},n.showReportAbuseAsync=function(t){var n,r;if(/^https:\/\/github\.com\//i.test(t)&&pxt.github.parseRepoUrl(t))return pxt.tickEvent("reportabuse.github"),void window.open("https://github.com/contact/report-content","_blank");var i=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";h.confirmAsync({header:lf("Report Abuse"),onLoaded:function(e){n=e.querySelectorAll("input")[0],r=e.querySelectorAll("textarea")[0],t&&(n.value=i+t)},agreeLbl:lf("Submit"),jsx:f.createElement("div",{className:"ui form"},f.createElement("div",{className:"ui field"},f.createElement("label",{id:"abuseUrlLabel"},lf("What is the URL of the offensive project?")),f.createElement("input",{type:"url","aria-labelledby":"abuseUrlLabel",tabIndex:0,autoFocus:!0,placeholder:"Enter project URL here..."})),f.createElement("div",{className:"ui field"},f.createElement("label",{id:"abuseDescriptionLabel"},lf("Why do you find it offensive?")),f.createElement("textarea",{"aria-labelledby":"abuseDescriptionLabel"})))}).done(function(e){if(e){pxt.tickEvent("app.reportabuse.send");var t=pxt.Cloud.parseScriptId(n.value);t?(h.infoNotification(lf("Sending abuse report...")),o.privatePostAsync(t+"/abusereports",{text:r.value}).then(function(e){h.infoNotification(lf("Report sent. Thank you!"))}).catch(function(e){404==e.statusCode?h.warningNotification(lf("Oops, we could not find this script.")):h.handleNetworkError(e)})):h.errorNotification(lf("Sorry, the project url looks invalid."))}})},n.showResetDialogAsync=function(){return h.confirmAsync({header:lf("Reset"),body:lf("You are about to clear all projects. Are you sure? This operation cannot be undone."),agreeLbl:lf("Reset"),agreeClass:"red",agreeIcon:"sign out",disagreeLbl:lf("Cancel")})},n.promptTranslateBlock=function(e,t){h.confirmAsync({header:lf("Translate this block"),hideCancel:!0,hideAgree:!0,hasCloseIcon:!0,helpUrl:"/translate",jsx:f.createElement("div",null,f.createElement("div",null,lf("Update the block translation below."),lf("Do not translate variable names (%name, $name)."),lf("Once validated in Crowdin, translations may take 24h to be active.")),t.map(function(e){return f.createElement("div",{key:"ictr"+e,className:"ui basic segment"},e)}))}).done()}},{"./core":41,"./coretsx":42,"./sui":100,react:284}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.extractSharedIdFromPostUrl=function(e){return pxt.Util.httpGetJsonAsync(e+".json").then(function(e){return e.post_stream&&e.post_stream.posts&&e.post_stream.posts[0]&&e.post_stream.posts[0].link_counts.map(function(e){return pxt.Cloud.parseScriptId(e.url)}).filter(function(e){return!!e})[0]})}},{}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setupDragAndDrop=function(e,r,i,o){e.addEventListener("paste",function(e){if(e.clipboardData){var t=pxt.Util.toArray(e.clipboardData.files).filter(r);if(0<t.length)e.stopPropagation(),e.preventDefault(),i(t);else if(e.clipboardData.items&&0<e.clipboardData.items.length){var n=e.clipboardData.items[0].getAsFile();n&&(e.stopPropagation(),e.preventDefault(),i([n]))}}}),e.addEventListener("dragover",function(e){for(var t=e.dataTransfer.types,n=!1,r=0;r<t.length;++r)"Files"!=t[r]&&"text/uri-list"!=t[r]||(n=!0);return!(n&&(e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy"))},!1),e.addEventListener("drop",function(e){var t=pxt.Util.toArray(e.dataTransfer.files);if(0<t.length)e.stopPropagation(),e.preventDefault(),i(t);else if(-1<e.dataTransfer.types.indexOf("text/uri-list")){var n=e.dataTransfer.getData("text/uri-list");n&&(e.stopPropagation(),e.preventDefault(),o(n))}return!1},!1),e.addEventListener("dragend",function(e){return!1},!1)}},{}],54:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var s,l,F=e("react"),c=e("./data"),u=e("./sui"),U=e("./githubbutton");(l=s||(s={}))[l.Computer=0]="Computer",l[l.Tablet=1]="Tablet",l[l.Mobile=2]="Mobile";var p=function(n){function e(e){var t=n.call(this,e)||this;return t.saveProjectName=t.saveProjectName.bind(t),t.compile=t.compile.bind(t),t.saveFile=t.saveFile.bind(t),t.undo=t.undo.bind(t),t.redo=t.redo.bind(t),t.zoomIn=t.zoomIn.bind(t),t.zoomOut=t.zoomOut.bind(t),t.startStopSimulator=t.startStopSimulator.bind(t),t.toggleTrace=t.toggleTrace.bind(t),t.toggleDebugging=t.toggleDebugging.bind(t),t}return i(e,n),e.prototype.saveProjectName=function(e,t){pxt.tickEvent("editortools.projectrename",{view:t},{interactiveConsent:!0}),this.props.parent.updateHeaderName(e)},e.prototype.compile=function(e){pxt.tickEvent("editortools.download",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.compile()},e.prototype.saveFile=function(e){pxt.tickEvent("editortools.save",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.saveAndCompile()},e.prototype.undo=function(e){pxt.tickEvent("editortools.undo",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.undo()},e.prototype.redo=function(e){pxt.tickEvent("editortools.redo",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.redo()},e.prototype.zoomIn=function(e){pxt.tickEvent("editortools.zoomIn",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.zoomIn(),this.props.parent.forceUpdate()},e.prototype.zoomOut=function(e){pxt.tickEvent("editortools.zoomOut",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.zoomOut(),this.props.parent.forceUpdate()},e.prototype.startStopSimulator=function(e){pxt.tickEvent("editortools.startStopSimulator",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})},e.prototype.toggleTrace=function(e){pxt.tickEvent("editortools.trace",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.toggleTrace()},e.prototype.toggleDebugging=function(e){pxt.tickEvent("editortools.debug",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.toggleDebugging()},e.prototype.getViewString=function(e){return e.toString().toLowerCase()},e.prototype.getCollapsedState=function(){return""+this.props.parent.state.collapseEditorTools},e.prototype.getHeadlessState=function(){return pxt.appTarget.simulator.headless?"true":"false"},e.prototype.getUndoRedo=function(e){var t=this.props.parent.editor.hasUndo(),n=this.props.parent.editor.hasRedo();return[F.createElement(q,{icon:"xicon undo",className:"editortools-btn undo-editortools-btn "+(t?"":"disabled"),title:lf("Undo"),ariaLabel:lf("{0}, {1}",lf("Undo"),t?"":lf("Disabled")),onButtonClick:this.undo,view:this.getViewString(e),key:"undo"}),F.createElement(q,{icon:"xicon redo",className:"editortools-btn redo-editortools-btn "+(n?"":"disabled"),title:lf("Redo"),ariaLabel:lf("{0}, {1}",lf("Redo"),n?"":lf("Disabled")),onButtonClick:this.redo,view:this.getViewString(e),key:"redo"})]},e.prototype.getZoomControl=function(e){return[F.createElement(q,{icon:"minus circle",className:"editortools-btn zoomout-editortools-btn",title:lf("Zoom Out"),onButtonClick:this.zoomOut,view:this.getViewString(e),key:"minus"}),F.createElement(q,{icon:"plus circle",className:"editortools-btn zoomin-editortools-btn",title:lf("Zoom In"),onButtonClick:this.zoomIn,view:this.getViewString(e),key:"plus"})]},e.prototype.getSaveInput=function(e,t,n,r){var i="";this.props.parent.state.isSaving?i="loading disabled":this.props.parent.state.compiling&&(i="disabled");var o=[];if(2!=e&&(o.push(F.createElement("label",{htmlFor:n,className:"accessible-hidden",key:"label"},lf("Type a name for your project"))),o.push(F.createElement(d,{id:n,view:this.getViewString(e),key:"input",type:"text","aria-labelledby":n,placeholder:lf("Pick a name..."),value:r||"",onChangeValue:this.saveProjectName}))),t){var a=0==e?"small":"large";o.push(F.createElement(q,{icon:"save",className:a+" right attached editortools-btn save-editortools-btn "+i,title:lf("Save"),ariaLabel:lf("Save the project"),onButtonClick:this.saveFile,view:this.getViewString(e),key:"save"+e}))}return pxt.appTarget.cloud&&pxt.appTarget.cloud.githubPackages&&o.push(F.createElement(U.GithubButton,{parent:this.props.parent,key:"githubbtn"+e})),o},e.prototype.renderCore=function(){var e=this.props.parent.state,t=e.home,n=e.tutorialOptions,r=e.hideEditorFloats,i=e.collapseEditorTools,o=e.projectName,a=e.compiling,s=e.isSaving,l=e.simState,c=e.debugging;if(t)return F.createElement("div",null);var u=pxt.appTarget.appTheme,p=pxt.shell.isControllerMode(),d=pxt.shell.isReadOnly(),f=!!n&&n.tutorial,h=n&&n.metadata&&n.metadata.hideIteration,m=pxt.appTarget.simulator.headless,g=(r||i)&&(!f||m);if(!this.props.parent.isBlocksEditor()&&!this.props.parent.isTextEditor())return F.createElement("div",null);var v=u.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),y=!(d||p||u.saveInMenu||f||c||v),b=pxt.appTarget.compile,_=b.hasHex||b.saveAsPNG||b.useUF2,w=lf("Download your code to the {0}",u.boardName),k=!!a,x=l==pxt.editor.SimState.Running,E=l==pxt.editor.SimState.Starting,C=this.props.parent.editor.hasUndo(),S=!(f||d||p||u.hideProjectRename||c),T=!d&&!c,A=!!pxt.appTarget.cloud&&!!pxt.appTarget.cloud.githubPackages,N=!!u.enableTrace,O=this.props.parent.state.tracing,P=O?lf("Disable Slow-Mo"):lf("Slow-Mo"),I=!!u.debugger&&!d,D=c?lf("Disable Debugging"):lf("Debugging"),L=pxt.appTarget.appTheme.downloadIcon||"download",R=pxt.appTarget.appTheme.useUploadMessage?lf("Upload"):lf("Download"),j=[lf("Stop"),lf("Starting"),lf("Run Code in Game")][l||0],B="",M="";return s?(B="disabled",M="loading disabled"):k&&(B="loading disabled",M="disabled"),F.createElement("div",{className:"ui equal width grid right aligned padded"},F.createElement("div",{className:"column mobile only"},g?F.createElement("div",{className:"ui grid"},!u.bigRunButton&&F.createElement("div",{className:"left aligned column four wide"},F.createElement("div",{className:"ui icon small buttons"},_&&F.createElement(q,{className:"primary download-button download-button-full "+B,icon:L,title:w,ariaLabel:lf("Download your code"),onButtonClick:this.compile,view:"mobile"}))),F.createElement("div",{id:"editorToolbarArea",className:"column right aligned "+(u.bigRunButton?"sixteen":"twelve")+" wide"},!d&&F.createElement("div",{className:"ui icon small buttons"},this.getSaveInput(2,y),T&&F.createElement(q,{icon:"xicon undo",className:"editortools-btn undo-editortools-btn} "+(C?"":"disabled"),ariaLabel:lf("{0}, {1}",lf("Undo"),C?"":lf("Disabled")),title:lf("Undo"),onButtonClick:this.undo,view:"mobile"})),F.createElement("div",{className:"ui icon small buttons"},this.getZoomControl(2)),u.bigRunButton&&F.createElement("div",{className:"big-play-button-wrapper"},F.createElement(q,{role:"menuitem",className:"big-play-button play-button "+(x?"stop":"play"),key:"runmenubtn",disabled:E,icon:x?"stop":"play",title:j,onButtonClick:this.startStopSimulator,view:"mobile"})))):F.createElement("div",{className:"ui equal width grid"},F.createElement("div",{className:"left aligned five wide column"}),F.createElement("div",{className:"column"},F.createElement("div",{className:"ui grid"},d||!T?void 0:F.createElement("div",{className:"row"},F.createElement("div",{className:"column"},F.createElement("div",{className:"ui icon large buttons"},F.createElement(q,{icon:"xicon undo",className:"editortools-btn undo-editortools-btn "+(C?"":"disabled"),ariaLabel:lf("{0}, {1}",lf("Undo"),C?"":lf("Disabled")),title:lf("Undo"),onButtonClick:this.undo,view:"mobile"})))),F.createElement("div",{className:"row",style:d||!T?void 0:{paddingTop:0}},F.createElement("div",{className:"column"},F.createElement("div",{className:"ui icon large buttons"},N&&F.createElement(q,{key:"tracebtn",className:"trace-button "+(O?"orange":""),icon:"xicon turtle",title:P,onButtonClick:this.toggleTrace,view:"mobile"}),I&&F.createElement(q,{key:"debugbtn",className:"debug-button "+(c?"orange":""),icon:"icon bug",title:D,onButtonClick:this.toggleDebugging,view:"mobile"}),_&&F.createElement(q,{className:"primary download-button download-button-full "+B,icon:L,title:w,onButtonClick:this.compile,view:"mobile"})))))))),F.createElement("div",{className:"column tablet only"},g?F.createElement("div",{className:"ui grid seven column"},F.createElement("div",{className:"left aligned six wide column"},F.createElement("div",{className:"ui icon buttons"},_&&F.createElement(q,{className:"primary download-button download-button-full "+B,icon:L,text:R,title:w,onButtonClick:this.compile,view:"tablet"}))),y&&F.createElement("div",{className:"column four wide"},F.createElement(q,{icon:"save",className:"small editortools-btn save-editortools-btn "+M,title:lf("Save"),ariaLabel:lf("Save the project"),onButtonClick:this.saveFile,view:"tablet"}),A&&F.createElement(U.GithubButton,{parent:this.props.parent,key:"githubbtntablet",className:"small"})),F.createElement("div",{className:"column "+(y?"six":"ten")+" wide right aligned"},T&&F.createElement("div",{className:"ui icon small buttons"},this.getUndoRedo(1)),F.createElement("div",{className:"ui icon small buttons"},this.getZoomControl(1)),u.bigRunButton&&F.createElement("div",{className:"big-play-button-wrapper"},F.createElement(q,{role:"menuitem",className:"big-play-button play-button "+(x?"stop":"play"),key:"runmenubtn",disabled:E,icon:x?"stop":"play",title:j,onButtonClick:this.startStopSimulator,view:"tablet"})))):F.createElement("div",{className:"ui grid"},F.createElement("div",{className:"left aligned five wide column"}),F.createElement("div",{className:"five wide column"},F.createElement("div",{className:"ui grid right aligned"},_&&F.createElement("div",{className:"row"},F.createElement("div",{className:"column"},F.createElement(q,{role:"menuitem",className:"primary large fluid download-button download-button-full "+B,icon:L,text:R,title:w,onButtonClick:this.compile,view:"tablet"}))),S&&F.createElement("div",{className:"row",style:_?{paddingTop:0}:{}},F.createElement("div",{className:"column"},F.createElement("div",{className:"ui item large right "+(y?"labeled":"")+" fluid input projectname-input projectname-tablet",title:lf("Pick a name for your project")},this.getSaveInput(1,y,"fileNameInput1",o)))))),F.createElement("div",{id:"editor",className:"six wide column right aligned"},F.createElement("div",{className:"ui grid right aligned"},F.createElement("div",{className:"row"},F.createElement("div",{className:"column"},T&&F.createElement("div",{className:"ui icon large buttons"},this.getUndoRedo(1)),F.createElement("div",{className:"ui icon large buttons"},this.getZoomControl(1)),u.bigRunButton&&!h&&F.createElement("div",{className:"big-play-button-wrapper"},F.createElement(q,{role:"menuitem",className:"big-play-button play-button "+(x?"stop":"play"),key:"runmenubtn",disabled:E,icon:x?"stop":"play",title:j,onButtonClick:this.startStopSimulator,view:"tablet"})))),F.createElement("div",{className:"row",style:{paddingTop:0}},F.createElement("div",{className:"column"},N&&F.createElement(q,{key:"tracebtn",className:"large trace-button "+(O?"orange":""),icon:"xicon turtle",title:P,onButtonClick:this.toggleTrace,view:"tablet"}),I&&F.createElement(q,{key:"debugbtn",className:"large debug-button "+(c?"orange":""),icon:"icon bug",title:D,onButtonClick:this.toggleDebugging,view:"tablet"}))))))),F.createElement("div",{className:"column computer only"},F.createElement("div",{className:"ui grid equal width"},F.createElement("div",{id:"downloadArea",className:"ui column items"},m?F.createElement("div",{className:"ui item"},F.createElement("div",{className:"ui icon large buttons"},_&&F.createElement(q,{icon:L,className:"primary large download-button "+B,title:w,onButtonClick:this.compile,view:"computer"}))):F.createElement("div",{className:"ui item"},_&&F.createElement(q,{icon:L,className:"primary huge fluid download-button "+B,text:R,title:w,onButtonClick:this.compile,view:"computer"}))),S&&F.createElement("div",{id:"projectNameArea",className:"column left aligned"},F.createElement("div",{className:"ui right "+(y?"labeled":"")+" input projectname-input projectname-computer",title:lf("Pick a name for your project")},this.getSaveInput(0,y,"fileNameInput2",o))),F.createElement("div",{id:"editorToolbarArea",className:"column right aligned"},T&&F.createElement("div",{className:"ui icon small buttons"},this.getUndoRedo(0)),F.createElement("div",{className:"ui icon small buttons"},this.getZoomControl(0)),u.bigRunButton&&F.createElement("div",{className:"big-play-button-wrapper"},F.createElement(q,{role:"menuitem",className:"big-play-button play-button "+(x?"stop":"play"),key:"runmenubtn",disabled:E,icon:x?"stop":"play",title:j,onButtonClick:this.startStopSimulator,view:"computer"}))))))},e}(c.Component);n.EditorToolbar=p;var q=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.handleClick=t.handleClick.bind(t),t}return i(e,n),e.prototype.handleClick=function(){var e=this.props;(0,e.onButtonClick)(e.view)},e.prototype.renderCore=function(){var e=this.props,t=(e.onClick,e.onButtonClick,a(e,["onClick","onButtonClick"]));return F.createElement(u.Button,o({},t,{onClick:this.handleClick}))},e}(u.StatelessUIElement),d=function(n){function e(e){var t=n.call(this,e)||this;return t.handleChange=t.handleChange.bind(t),t}return i(e,n),e.prototype.handleChange=function(e){var t=this.props,n=t.onChangeValue,r=t.view;n(e.target.value,r)},e.prototype.renderCore=function(){var e=this.props,t=(e.onChange,e.onChangeValue,e.view,a(e,["onChange","onChangeValue","view"]));return F.createElement("input",o({onChange:this.handleChange,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1},t))},e}(u.StatelessUIElement)},{"./data":44,"./githubbutton":60,"./sui":100,react:284}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./cmds"),i=e("./core"),o=window.pxtElectron;n.initElectron=function(t){if(pxt.BrowserUtils.isPxtElectron()){o.onTelemetry(function(e){pxt.tickEvent(e.event,e.data)}),o.onUpdateInstalled(function(){i.infoNotification(lf("An update will take effect after the app restarts"))}),o.onDriveDeployResult(function(e){if(a)if(e)pxt.tickEvent("electron.drivedeploy.success"),a.resolve();else{pxt.tickEvent("electron.drivedeploy.failure");var t=new Error("electron drive deploy failed");a.reject(t)}else pxt.tickEvent("electron.drivedeploy.unknowndeployoperation")});var n=new Promise(function(e){o.onCriticalUpdateFailed(function(){pxt.tickEvent("electron.criticalupdate.failed"),e()})});o.onUpdateStatus(function(e){switch(pxt.debug("Electron app update status: "+e),pxt.tickEvent("electron.updatestatus."+e),"updating-critical"!==e&&"banned-without-update"!==e||t.stopSimulator(),e){case"ok":return;case"updating-critical":i.confirmAsync({header:lf("Critical update required"),body:lf("A critical update is installing. Please do not quit the app. It will automatically restart when the update has completed."),hideAgree:!0,disagreeLbl:lf("Ok"),disagreeClass:"green",size:"medium"}).then(function(){i.showLoading("pxt-electron-update",lf("Installing update..."))}),n.then(function(){i.hideLoading("pxt-electron-update"),i.hideDialog(),i.confirmAsync({header:lf("Critical update failed"),body:lf("There was an error installing the critical update. Please ensure you are connected to the Internet and try again later."),hideAgree:!0,disagreeLbl:lf("Quit"),disagreeClass:"red",size:"medium"}).then(function(e){o.sendQuit()})});break;case"banned-without-update":i.confirmAsync({header:lf("Critical update required"),body:lf("We have disabled this app for security reasons. Please ensure you are connected to the Internet and try again later. An update will be automatically installed as soon as it is available."),hideAgree:!0,disagreeLbl:lf("Quit"),disagreeClass:"red",size:"medium"}).then(function(e){o.sendQuit()});default:return}}),o.sendUpdateStatusCheck()}};var a=null;n.driveDeployAsync=function(t){return pxt.BrowserUtils.isPxtElectron()?(a||(a=Promise.defer(),o.sendDriveDeploy(t)),a.promise.catch(function(e){return pxt.tickEvent("electron.drivedeploy.browserdownloadinstead"),r.browserDownloadDeployCoreAsync(t)}).finally(function(){a=null})):r.browserDownloadDeployCoreAsync(t)},n.openDevTools=function(){o&&o.sendOpenDevTools()}},{"./cmds":12,"./core":41}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var d,o,r,i,a=pxt.editor,f=e("./package");(i=d=n.Permissions||(n.Permissions={}))[i.Console=0]="Console",i[i.ReadUserCode=1]="ReadUserCode",(r=o=n.PermissionStatus||(n.PermissionStatus={}))[r.Granted=0]="Granted",r[r.Denied=1]="Denied",r[r.NotAvailable=2]="NotAvailable",r[r.NotYetPrompted=3]="NotYetPrompted";var s=function(){function e(e){this.host=e,this.statuses={},this.nameToExtId={},this.extIdToName={},this.consent={},this.pendingRequests=[],this.queueLock=!1,this.streams={}}return e.prototype.streamingExtensions=function(){return Object.keys(this.streams)},e.prototype.handleExtensionMessage=function(e){this.handleRequestAsync(e).catch(function(e){})},e.prototype.sendEvent=function(e,t){var n;this.host.send(e,(n=t,{target:pxt.appTarget.id,type:"pxtpkgext",event:n}))},e.prototype.setConsent=function(e,t){this.consent[e]=t},e.prototype.hasConsent=function(e){return this.consent[e]},e.prototype.getExtId=function(e){return this.nameToExtId[e]||(this.nameToExtId[e]=ts.pxtc.Util.guidGen(),this.extIdToName[this.nameToExtId[e]]=e),this.nameToExtId[e]},e.prototype.sendResponse=function(e){this.host.send(this.extIdToName[e.extId],e)},e.prototype.handleRequestAsync=function(e){var t,n,r,i,o,a,s,l=this,c=(void 0===n&&(n=!0),{type:"pxtpkgext",id:(t=e).id,extId:t.extId,success:n});if(!this.hasConsent(e.extId))return c.success=!1,c.error="",this.sendResponse(c),Promise.reject("No consent");switch(e.action){case"extinit":c.target=pxt.appTarget,this.sendResponse(c);break;case"extdatastream":return this.permissionOperation(e.extId,d.Console,c,function(e,t){return l.handleDataStreamRequest(e,t)});case"extquerypermission":var u=this.getPermissions(e.extId),p=c;p.resp=m(u),this.sendResponse(p);break;case"extrequestpermission":return this.requestPermissionsAsync(e.extId,c,e.body);case"extusercode":return this.permissionOperation(e.extId,d.ReadUserCode,c,h);case"extreadcode":r=this.extIdToName[e.extId],i=c,o=f.mainEditorPkg(),a=ts.pxtc.escapeIdentifier(r),s=o.getAllFiles(),i.resp={json:s[a+".json"],code:s[a+".ts"],jres:s[a+".jres"],asm:s[a+".asm"]},this.sendResponse(c);break;case"extwritecode":(function(e,t,n){var r=f.mainEditorPkg(),i=ts.pxtc.escapeIdentifier(e);function o(e,t){return void 0!==e&&(!r.files[i+t]||r.files[i+t].content!=e)}var a=!1;return o(n.json,".json")&&(a=!0,r.setFile(i+".json",n.json)),o(n.code,".ts")&&(a=!0,r.setFile(i+".ts",n.code)),o(n.jres,".jres")&&(a=!0,r.setFile(i+".jres",n.jres)),o(n.asm,".asm")&&(a=!0,r.setFile(i+".asm",n.asm)),a?r.updateConfigAsync(function(e){return void 0!==n.json&&e.files.indexOf(i+".json")<0&&e.files.push(i+".json"),void 0!==n.code&&e.files.indexOf(i+".ts")<0&&e.files.push(i+".ts"),void 0!==n.jres&&e.files.indexOf(i+".jres")<0&&e.files.push(i+".jres"),void 0!==n.asm&&e.files.indexOf(i+".asm")<0&&e.files.push(i+".asm"),r.savePkgAsync()}):Promise.resolve()})(this.extIdToName[e.extId],0,e.body).done(function(){return l.sendResponse(c)})}return Promise.resolve()},e.prototype.permissionOperation=function(t,e,n,r){var i=this;return this.checkPermissionAsync(t,e).then(function(e){e?r(i.extIdToName[t],n):(n.success=!1,n.error="permission denied"),i.sendResponse(n)}).catch(function(e){n.success=!1,n.error=e,i.sendResponse(n)})},e.prototype.getPermissions=function(e){return this.statuses[e]||(this.statuses[e]={console:o.NotYetPrompted,readUserCode:o.NotYetPrompted}),this.statuses[e]},e.prototype.queuePermissionRequest=function(r,i){var o=this;return new Promise(function(e,t){var n={extId:r,permissions:[i],resolver:e};o.pendingRequests.push(n),o.queueLock||1!==o.pendingRequests.length||(o.queueLock=!0,o.nextPermissionRequest())})},e.prototype.nextPermissionRequest=function(){var t=this;if(this.pendingRequests.length){var n=this.pendingRequests.shift();n.permissions=n.permissions.filter(function(e){return t.hasNotBeenPrompted(n.extId,e)}),n.permissions.length?this.host.promptForPermissionAsync(this.extIdToName[n.extId],n.permissions).done(function(e){n.resolver(e),t.nextPermissionRequest()}):this.nextPermissionRequest()}else this.queueLock=!1},e.prototype.checkPermissionAsync=function(n,r){var e,i=this,t=this.getPermissions(n);switch(r){case d.Console:e=t.console;break;case d.ReadUserCode:e=t.readUserCode}return e===o.NotYetPrompted?this.queuePermissionRequest(n,r).then(function(e){var t=e?o.Granted:o.Denied;switch(r){case d.Console:i.statuses[n].console=t;break;case d.ReadUserCode:i.statuses[n].readUserCode=t}return e}):Promise.resolve(e===o.Granted)},e.prototype.requestPermissionsAsync=function(e,t,n){var r=this,i=[];return n.readUserCode&&i.push(this.checkPermissionAsync(e,d.ReadUserCode)),n.console&&i.push(this.checkPermissionAsync(e,d.Console)),Promise.all(i).then(function(){return m(r.getPermissions(e))}).then(function(e){t.resp=e})},e.prototype.hasNotBeenPrompted=function(e,t){var n,r=this.getPermissions(e);switch(t){case d.Console:n=r.console;break;case d.ReadUserCode:n=r.readUserCode}return n===o.NotYetPrompted},e.prototype.handleDataStreamRequest=function(e,t){this.streams[e]=!0},e}();function h(e,t){var n=f.mainEditorPkg();t.resp=n.getAllFiles()}function m(e){return{readUserCode:l(e.readUserCode),console:l(e.console)}}function l(e){switch(e){case o.NotYetPrompted:case o.Denied:return a.PermissionResponses.Denied;case o.Granted:return a.PermissionResponses.Granted;case o.NotAvailable:default:return a.PermissionResponses.NotAvailable}}n.ExtensionManager=s},{"./package":81}],57:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var p=e("react"),o=e("./data"),a=e("./core"),d=e("./sui"),s=e("./extensionManager"),l=function(n){function u(e){var t=n.call(this,e)||this;return t.handleExtensionWrapperRef=function(e){t.extensionWrapper=e},t.state={visible:!1,consent:!1},t.manager=new s.ExtensionManager(t),window.addEventListener("message",t.processMessage.bind(t),!1),t.hide=t.hide.bind(t),t.updateDimensions=t.updateDimensions.bind(t),t.onApprovedDecision=t.onApprovedDecision.bind(t),t.onDeniedDecision=t.onDeniedDecision.bind(t),t}return i(u,n),u.prototype.processMessage=function(e){var t=this,n=e.data;if("serial"===n.type){var r=n,i=this.manager.streamingExtensions();if(i&&i.length){var o=r.data||"",a=r.id||"?";i.forEach(function(e){t.send(e,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extconsole",body:{source:a,sim:r.sim,data:o}})})}}},u.prototype.hide=function(){var e=this;this.setState({visible:!1}),u.getFrame(this.state.extension,!0).style.display="none",a.showLoading("reloadproject",lf("loading...")),this.props.parent.reloadHeaderAsync().done(function(){e.send(e.state.extension,{target:pxt.appTarget.id,type:"pxtpkgext",event:"exthidden"}),a.hideLoading("reloadproject")})},u.prototype.showExtension=function(e,t,n){var r=this,i=!n||this.manager.hasConsent(this.manager.getExtId(e));this.setState({visible:!0,extension:e,url:t,consent:i},function(){r.send(e,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extshown"})})},u.prototype.submitConsent=function(){this.manager.setConsent(this.manager.getExtId(this.state.extension),!0),this.setState({consent:!0})},u.prototype.initializeFrame=function(){var e=this;this.manager.setConsent(this.manager.getExtId(this.state.extension),!0);var t=u.getFrame(this.state.extension,!0);t.style.display="block",t.src||(t.src=this.state.url+"#"+this.manager.getExtId(this.state.extension),t.onload=function(){e.send(e.state.extension,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extloaded"})})},u.prototype.shouldComponentUpdate=function(e,t,n){return this.state.visible!=t.visible||this.state.extension!=t.extension||this.state.permissionRequest!=t.permissionRequest||this.state.consent!=t.consent},u.prototype.updateDimensions=function(){if(this.extensionWrapper){var e=this.extensionWrapper.getAttribute("data-frame");if(e){var t=u.getFrame(e,!1),n=document.getElementsByClassName("extensiondialog")[0];n&&t&&(n.getBoundingClientRect(),t.width=window.innerWidth+"px",t.height=window.innerHeight-60+"px",t.style.top="60px",t.style.left="0px")}}},u.prototype.componentDidMount=function(){window.addEventListener("resize",this.updateDimensions)},u.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateDimensions)},u.prototype.componentDidUpdate=function(){var e=this;setTimeout(function(){e.updateDimensions()},0)},u.prototype.componentWillUpdate=function(e,t){t.extension&&t.visible&&u.getFrame(t.extension,!0)},u.prototype.handleExtensionRequest=function(e){this.manager.handleExtensionMessage(e)},u.prototype.send=function(e,t){var n=u.getFrame(e,!1);n?n.contentWindow.postMessage(t,"*"):console.warn("Attempting to post message to unloaded extesnion "+e)},u.prototype.promptForPermissionAsync=function(n,r){var i=this;return new Promise(function(e,t){i.permissionCb=e,i.setState({permissionRequest:r,permissionExtName:n})})},u.prototype.onApprovedDecision=function(){this.onPermissionDecision(!0)},u.prototype.onDeniedDecision=function(){this.onPermissionDecision(!1)},u.prototype.onPermissionDecision=function(e){this.permissionCb(e),this.permissionCb=void 0,this.setState({permissionRequest:null,permissionExtName:null})},u.getCustomContent=function(){return document.getElementById("custom-content")},u.getFrame=function(e,t){var n=this.getCustomContent().getElementsByClassName("extension-frame-"+e)[0];return!n&&t&&(n=this.createFrame(e)),n},u.createFrame=function(e){var t=this.getCustomContent(),n=document.createElement("iframe");return n.className="extension-frame extension-frame-"+e,n.allowFullscreen=!0,n.setAttribute("sandbox","allow-same-origin allow-scripts"),n.frameBorder="0",n.style.display="none",t.appendChild(n),n},u.hideAllFrames=function(){var e=this.getCustomContent();e&&pxt.Util.toArray(e.getElementsByClassName("extension-frame")).forEach(function(e){e.style.zIndex="10"})},u.showAllFrames=function(){var e=this.getCustomContent();e&&pxt.Util.toArray(e.getElementsByClassName("extension-frame")).forEach(function(e){e.style.zIndex=""})},u.prototype.getIconForPermission=function(e){switch(e){case s.Permissions.Console:return"terminal";case s.Permissions.ReadUserCode:return"code"}return""},u.prototype.getDisplayNameForPermission=function(e){switch(e){case s.Permissions.Console:return lf("Console output");case s.Permissions.ReadUserCode:return lf("Read your code")}return""},u.prototype.getDescriptionForPermission=function(e){switch(e){case s.Permissions.Console:return lf("The extension will be able to read any console output (including device data) streamed to the editor");case s.Permissions.ReadUserCode:return lf("The extension will be able to read the code in the current project")}return""},u.prototype.renderCore=function(){var t=this,e=this.state,n=e.visible,r=e.extension,i=e.consent,o=e.permissionRequest,a=e.permissionExtName,s=!i;o?u.hideAllFrames():u.showAllFrames();var l=s?lf("Agree"):void 0,c=l?[{label:l,onclick:function(){t.submitConsent()}}]:void 0;return!s&&n&&this.initializeFrame(),p.createElement(d.Modal,{isOpen:n,className:s?"extensionconsentdialog":"extensiondialog",size:s?"small":"fullscreen",closeIcon:!0,onClose:this.hide,dimmer:!0,buttons:c,modalDidOpen:this.updateDimensions,shouldFocusAfterRender:!1,onPositionChanged:this.updateDimensions,closeOnDimmerClick:!0},i?p.createElement("div",{id:"extensionWrapper","data-frame":r,ref:this.handleExtensionWrapperRef},o?p.createElement(d.Modal,{isOpen:!0,className:"extensionpermissiondialog basic",closeIcon:!1,dimmer:!0,dimmerClassName:"permissiondimmer"},p.createElement("div",{className:"permissiondialoginner"},p.createElement("div",{className:"permissiondialogheader"},lf("Permission Request")),p.createElement("div",{className:"permissiondialogbody"},lf("Extension {0} is requesting the following permission(s):",a)),p.createElement("div",{className:"ui inverted list"},o.map(function(e){return p.createElement("div",{key:e.toString(),className:"item"},p.createElement(d.Icon,{icon:t.getIconForPermission(e)+" icon"}),p.createElement("div",{className:"content"},p.createElement("div",{className:"header"},t.getDisplayNameForPermission(e)),p.createElement("div",{className:"description"},t.getDescriptionForPermission(e))))}))),p.createElement("div",{className:"actions"},p.createElement(d.Button,{text:lf("Deny"),className:"deny inverted",onClick:this.onDeniedDecision}),p.createElement(d.Button,{text:lf("Approve"),className:"approve inverted green",onClick:this.onApprovedDecision}))):void 0):p.createElement("div",null,p.createElement("div",{className:"ui form"},p.createElement("div",{className:"ui icon violet message"},p.createElement(d.Icon,{icon:"user"}),p.createElement("div",{className:"content"},p.createElement("h3",{className:"header"},lf("User-provided content")),p.createElement("p",null,lf("This content is provided by a user, and is not endorsed by Microsoft."),p.createElement("br",null),lf("If you think it's not appropriate, please report abuse through Settings -> Report Abuse.")))))))},u}(o.Component);n.Extensions=l},{"./core":41,"./data":44,"./extensionManager":56,"./sui":100,react:284}],58:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},l=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var c=e("react"),o=e("./data"),u=e("./sui"),a=e("./package"),p=e("./core"),d=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.toggleVisibility=t.toggleVisibility.bind(t),t.handleCustomBlocksClick=t.handleCustomBlocksClick.bind(t),t.handleButtonKeydown=t.handleButtonKeydown.bind(t),t.setFile=t.setFile.bind(t),t.removeFile=t.removeFile.bind(t),t.removePkg=t.removePkg.bind(t),t.updatePkg=t.updatePkg.bind(t),t.togglePkg=t.togglePkg.bind(t),t.navigateToError=t.navigateToError.bind(t),t}return i(e,n),e.prototype.componentWillReceiveProps=function(e){var t=this,n=e.parent.state.currFile;if(this.state.currentFile!=n){var r=void 0;a.allEditorPkgs().forEach(function(e){t.packageContainsFile(e,n)&&(r=e.getPkgId())}),this.setState({expandedPkg:r,currentFile:n})}},e.prototype.removePkg=function(t){var n=this;p.confirmAsync({header:lf("Remove {0} extension",t.getPkgId()),body:lf("You are about to remove an extension from your project. Are you sure?"),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Remove it")}).done(function(e){e&&a.mainEditorPkg().removeDepAsync(t.getPkgId()).then(function(){return n.props.parent.reloadHeaderAsync()}).done()})},e.prototype.setFile=function(e){this.props.parent.setSideFile(e)},e.prototype.removeFile=function(e){this.props.parent.removeFile(e)},e.prototype.updatePkg=function(e){var t=this;a.mainEditorPkg().updateDepAsync(e.getPkgId()).then(function(){return t.props.parent.reloadHeaderAsync()}).done()},e.prototype.navigateToError=function(e){var t=e&&e.diagnostics&&e.diagnostics[0];t&&this.props.parent.navigateToError(t)},e.prototype.filesOf=function(n){var r=this,i=this.state.currentFile,o="this"==n.getPkgId();return n.sortedFiles().map(function(e){var t=r.getData("open-meta:"+e.getName());return c.createElement(f,{key:e.getName(),file:e,meta:t,onItemClick:r.setFile,onItemRemove:r.removeFile,onErrorClick:r.navigateToError,isActive:i==e,hasDelete:o&&!/^(main\.ts|pxt\.json)$/.test(e.name),className:(i==e?"active ":"")+(n.isTopLevel()?"":"nested ")+"item"},e.name,"",t.isGitModified?" ":"",t.isReadonly?c.createElement(u.Icon,{icon:"lock"}):null)})},e.prototype.packageOf=function(e){var t=this.state.expandedPkg,n=e.getPkgId()!=pxt.appTarget.id&&"built"!=e.getPkgId()&&"assets"!=e.getPkgId()&&e.getPkgId()!=pxt.appTarget.corepkg&&e.getKsPkg().config&&!e.getKsPkg().config.core&&e.getKsPkg().level<=1,r=e.getKsPkg()&&"github"==e.getKsPkg().verProtocol(),i=this.getData("open-pkg-meta:"+e.getPkgId()),o=r?e.getKsPkg().verArgument().split("#")[1]:void 0;return o&&20<o.length&&(o=o.substring(0,7)),[c.createElement(h,{key:"hd-"+e.getPkgId(),pkg:e,isActive:t==e.getPkgId(),onItemClick:this.togglePkg,hasDelete:n,onItemRemove:this.removePkg,version:o,hasRefresh:r,onItemRefresh:this.updatePkg},i.numErrors?c.createElement("span",{className:"ui label red"},i.numErrors):null,e.getPkgId(),t==e.getPkgId()?c.createElement("div",{role:"group",className:"menu"},this.filesOf(e)):void 0)]},e.prototype.packageContainsFile=function(e,t){return 0<e.sortedFiles().filter(function(e){return e==t}).length},e.prototype.togglePkg=function(e){this.setState({expandedPkg:this.state.expandedPkg==e.getPkgId()?void 0:e.getPkgId()})},e.prototype.filesWithHeader=function(e){return e.isTopLevel()?this.filesOf(e):this.packageOf(e)},e.prototype.toggleVisibility=function(){this.props.parent.setState({showFiles:!this.props.parent.state.showFiles})},e.prototype.handleCustomBlocksClick=function(e){this.addCustomBlocksFile(),e.stopPropagation()},e.prototype.handleButtonKeydown=function(e){e.stopPropagation()},e.prototype.addTypeScriptFile=function(){var r=this,i=/^[\w][\/\w\-\.]*$/;p.promptAsync({header:lf("Add new file?"),hasCloseIcon:!0,onInputValidation:function(e){return e?(e=e.trim(),i.test(e)?void 0:lf("Don't use spaces or special characters.")):lf("filename is empty.")},body:lf("Please provide a name for your new file.")}).then(function(t){t=(t=(t=(t=t||"").trim()).replace(/\.[tj]s$/,"")).trim();var e="ts",n="//";return pxt.U.endsWith(t,".py")&&(t=t.slice(0,t.length-3),e="py",n="#"),pxt.U.endsWith(t,".md")&&(t=t.slice(0,t.length-3),e="md",n=">"),t?i.test(t)?(t+="."+e,a.mainEditorPkg().sortedFiles().some(function(e){return e.name==t})?(p.warningNotification(lf("File already exists")),Promise.resolve()):r.props.parent.updateFileAsync(t,n+" "+pxt.U.lf("Add your code here")+"\n",!0)):(p.warningNotification(lf("Invalid file name")),Promise.resolve()):Promise.resolve()}).done()},e.prototype.addCustomBlocksFile=function(){var t=this;this.props.parent.state.header.githubId||pxt.appTarget.appTheme.addNewTypeScriptFile?this.addTypeScriptFile():p.confirmAsync({header:lf("Add custom blocks?"),body:lf("A new JavaScript file, custom.ts, will be added to your project. You can define custom functions and blocks in that file.")}).then(function(e){if(e)return t.props.parent.updateFileAsync("custom.ts","\n/**\n * "+lf("Use this file to define custom functions and blocks.")+"\n * "+lf("Read more at {0}",pxt.appTarget.appTheme.homeUrl+"blocks/custom")+'\n */\n\nenum MyEnum {\n    //% block="one"\n    One,\n    //% block="two"\n    Two\n}\n\n/**\n * '+lf("Custom blocks")+'\n */\n//% weight=100 color=#0fbc11 icon=""\nnamespace custom {\n    /**\n     * TODO: '+lf("describe your function here")+"\n     * @param n "+lf("describe parameter here")+", eg: 5\n     * @param s "+lf("describe parameter here")+', eg: "Hello"\n     * @param e '+lf("describe parameter here")+"\n     */\n    //% block\n    export function foo(n: number, s: string, e: MyEnum): void {\n        // Add code here\n    }\n\n    /**\n     * TODO: "+lf("describe your function here")+"\n     * @param value "+lf("describe value here")+", eg: 5\n     */\n    //% block\n    export function fib(value: number): number {\n        return value <= 1 ? value : fib(value -1) + fib(value - 2);\n    }\n}\n",!0)})},e.prototype.renderCore=function(){var t=this,e=!!this.props.parent.state.showFiles,n=pxt.appTarget.appTheme,r=a.mainEditorPkg(),i=e&&!r.files["custom.ts"],o=this.getData("open-pkg-meta:"+r.getPkgId());return c.createElement("div",{role:"tree",className:"ui tiny vertical "+(n.invertedMenu?"inverted":"")+" menu filemenu landscape only hidefullscreen"},c.createElement("div",{role:"treeitem","aria-selected":e,"aria-expanded":e,"aria-label":lf("File explorer toolbar"),key:"projectheader",className:"link item",onClick:this.toggleVisibility,tabIndex:0,onKeyDown:u.fireClickOnEnter},lf("Explorer"),c.createElement(u.Icon,{icon:"chevron "+(e?"down":"right")+" icon"}),i?c.createElement(u.Button,{className:"primary label",icon:"plus",title:lf("Add custom blocks?"),onClick:this.handleCustomBlocksClick,onKeyDown:this.handleButtonKeydown}):void 0,o.numErrors?c.createElement("span",{className:"ui label red"},o.numErrors):null),e?pxt.Util.concat(a.allEditorPkgs().map(function(e){return t.filesWithHeader(e)})):void 0)},e}(o.Component);n.FileList=d;var f=function(n){function e(e){var t=n.call(this,e)||this;return t.handleClick=t.handleClick.bind(t),t.handleRemove=t.handleRemove.bind(t),t.handleButtonKeydown=t.handleButtonKeydown.bind(t),t}return i(e,n),e.prototype.handleClick=function(e){this.props.onErrorClick&&this.props.meta&&this.props.meta.numErrors&&this.props.meta.diagnostics&&this.props.meta.diagnostics[0]?this.props.onErrorClick(this.props.meta):this.props.onItemClick(this.props.file),e.stopPropagation()},e.prototype.handleRemove=function(e){this.props.onItemRemove(this.props.file),e.stopPropagation()},e.prototype.handleButtonKeydown=function(e){e.stopPropagation()},e.prototype.renderCore=function(){var e=this.props,t=(e.onClick,e.onItemClick,e.onItemRemove,e.onErrorClick,e.isActive),n=e.hasDelete,r=e.file,i=e.meta,o=l(e,["onClick","onItemClick","onItemRemove","onErrorClick","isActive","hasDelete","file","meta"]);return c.createElement("a",s({onClick:this.handleClick,tabIndex:0,role:"treeitem","aria-selected":t,"aria-label":t?lf("{0}, it is the current opened file in the JavaScript editor",r.name):r.name,onKeyDown:u.fireClickOnEnter},o),this.props.children,n?c.createElement(u.Button,{className:"primary label",icon:"trash",title:lf("Delete file {0}",r.name),onClick:this.handleRemove,onKeyDown:this.handleButtonKeydown}):"",i&&i.numErrors?c.createElement("span",{className:"ui label red button",role:"button",title:lf("Go to error")},i.numErrors):void 0)},e}(u.StatelessUIElement),h=function(n){function e(e){var t=n.call(this,e)||this;return t.handleClick=t.handleClick.bind(t),t.handleRemove=t.handleRemove.bind(t),t.handleRefresh=t.handleRefresh.bind(t),t.handleButtonKeydown=t.handleButtonKeydown.bind(t),t}return i(e,n),e.prototype.handleClick=function(){this.props.onItemClick(this.props.pkg)},e.prototype.handleRefresh=function(e){this.props.onItemRefresh(this.props.pkg),e.stopPropagation()},e.prototype.handleRemove=function(e){this.props.onItemRemove(this.props.pkg),e.stopPropagation()},e.prototype.handleButtonKeydown=function(e){e.stopPropagation()},e.prototype.renderCore=function(){var e=this.props,t=(e.onItemClick,e.onItemRemove,e.onItemRefresh,e.version),n=e.isActive,r=e.hasRefresh,i=e.hasDelete,o=e.pkg,a=l(e,["onItemClick","onItemRemove","onItemRefresh","version","isActive","hasRefresh","hasDelete","pkg"]);return c.createElement("div",s({className:"header link item",role:"treeitem","aria-selected":n,"aria-expanded":n,"aria-label":lf("{0}, {1}",o.getPkgId(),n?lf("expanded"):lf("collapsed")),onClick:this.handleClick,tabIndex:0,onKeyDown:u.fireClickOnEnter},a),c.createElement(u.Icon,{icon:"chevron "+(n?"down":"right")+" icon"}),r?c.createElement(u.Button,{className:"primary label",icon:"refresh",title:lf("Refresh extension {0}",o.getPkgId()),onClick:this.handleRefresh,onKeyDown:this.handleButtonKeydown,text:t||""}):void 0,i?c.createElement(u.Button,{className:"primary label",icon:"trash",title:lf("Delete extension {0}",o.getPkgId()),onClick:this.handleRemove,onKeyDown:this.handleButtonKeydown}):void 0,this.props.children)},e}(u.StatelessUIElement)},{"./core":41,"./data":44,"./package":81,"./sui":100,react:284}],59:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((l=l.apply(o,a||[])).next())})},s=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./core"),u=pxt.Util,o=pxt.Cloud,p=function(e,t){return u.requestAsync({url:"/api/"+e,headers:{Authorization:o.localToken},method:t?"POST":"GET",data:t||void 0}).then(function(e){return e.json}).catch(i.handleNetworkError)};function l(e,t,n){var r={files:[],config:null,header:e,path:e.path,isDeleted:e.isDeleted};if(n){t||(t={});for(var i=0,o=Object.keys(n);i<o.length;i++)n[l=o[i]]!==t[l]&&r.files.push({name:l,mtime:null,content:n[l],prevContent:t[l]});for(var a=0,s=Object.keys(t);a<s.length;a++){var l;void 0===n[l=s[a]]&&r.files.push({name:l,mtime:null,content:null,prevContent:t[l]})}}var c=u.flatClone(n||{});return p("pkg/"+e.path,r).then(function(e){return c})}n.setApiAsync=function(e){p=e},n.provider={getAsync:function(o){return p("pkg/"+o.path).then(function(e){for(var t={header:o,text:{},version:null},n=0,r=e.files;n<r.length;n++){var i=r[n];t.text[i.name]=i.content,o.modificationTime=Math.max(o.modificationTime,i.mtime/1e3|0)}return o.recentUse=Math.max(o.recentUse,o.modificationTime),t.version=u.flatClone(t.text),t})},setAsync:l,listAsync:function(){return r(this,void 0,void 0,function(){var t,n,r,i,o,a;return s(this,function(e){switch(e.label){case 0:return[4,p("list")];case 1:t=e.sent(),n=0,r=t.pkgs,e.label=2;case 2:return n<r.length?(i=r[n]).header?[3,4]:((o=i.files.map(function(e){return e.mtime})).sort(function(e,t){return t-e}),a=Math.round(o[0]/1e3)||u.nowSeconds(),i.header=pxt.workspace.freshHeader(i.config.name,a),i.config.preferredEditor&&(i.header.editor=i.config.preferredEditor),i.header.path=i.path,[4,l(i.header,null)]):[3,6];case 3:return e.sent(),[3,5];case 4:i.header.path=i.path,e.label=5;case 5:return n++,[3,2];case 6:return[2,t.pkgs.map(function(e){return e.header})]}})})},resetAsync:function(){return pxt.BrowserUtils.isPxtElectron()?p("resetworkspace",{}).then(function(){}):Promise.resolve()},deleteAsync:function(e,t){return e.isDeleted=!0,l(e,t,{})},saveScreenshotAsync:function(e,t,n){return p("screenshot/"+e.path,{screenshot:t,icon:n})},saveAssetAsync:function(e,t,n){return p("pkgasset/"+e,{encoding:"base64",name:t,data:btoa(ts.pxtc.Util.uint8ArrayToString(n))}).then(function(e){})},listAssetsAsync:function(e){return p("pkgasset/"+e).then(function(e){return e.files})}}},{"./core":41}],60:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var l=e("react"),c=e("./sui"),o=e("./package"),a=e("./cloudsync"),s=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.handleClick=t.handleClick.bind(t),t.handleButtonKeydown=t.handleButtonKeydown.bind(t),t.createRepository=t.createRepository.bind(t),t}return i(e,n),e.prototype.handleButtonKeydown=function(e){e.stopPropagation()},e.prototype.createRepository=function(e){var t=this;pxt.tickEvent("github.button.create",void 0,{interactiveConsent:!0});var n=this.props.parent.state,r=n.projectName,i=n.header;a.githubProvider().createRepositoryAsync(r,i).done(function(e){return e&&t.props.parent.reloadHeaderAsync()})},e.prototype.handleClick=function(e){e.stopPropagation();var t=this.props.parent.state.header;if(t&&t.githubId){pxt.tickEvent("github.button.nav");var n=o.mainEditorPkg().lookupFile("this/"+pxt.github.GIT_JSON);n&&this.props.parent.setSideFile(n)}},e.prototype.renderCore=function(){var e=this.props.parent.state.header;if(!e)return l.createElement("div",null);var t=e.githubId,n=pxt.github.parseRepoId(t),r="ui icon button editortools-btn editortools-github-btn";if(!n)return l.createElement(c.Button,{key:"githubcreatebtn",className:r+" "+(this.props.className||""),icon:"github",title:lf("create GitHub repository"),ariaLabel:lf("create GitHub repository"),onClick:this.createRepository});var i=this.getData("pkg-git-status:"+e.id),o=i&&!!i.modified,a=n.project&&n.tag?n.project+("master"==n.tag?"":"#"+n.tag):n.fullName,s=lf("Review and commit changes for {0}",a);return l.createElement("div",{key:"githubeditorbtn",role:"button",className:r+" "+(this.props.className||""),title:s,onClick:this.handleClick},l.createElement("i",{className:"github icon"}),l.createElement("i",{className:"ui long "+(o?"arrow alternate up":"check")+" icon mobile hide"}))},e}(c.UIElement);n.GithubButton=s},{"./cloudsync":11,"./package":81,"./sui":100,react:284}],61:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(o,a,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((l=l.apply(o,a||[])).next())})},a=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("react"),l=e("./sui"),c=e("./core"),u=e("./cloudsync"),p=e("./dialogs"),d=e("./workspace");n.PROVIDER_NAME="github";var f=function(t){function e(){return t.call(this,n.PROVIDER_NAME,lf("GitHub"),"icon github","https://api.github.com")||this}return i(e,t),e.prototype.logout=function(){pxt.github.token=void 0,t.prototype.logout.call(this)},e.prototype.hasSync=function(){return!1},e.prototype.loginCheck=function(){t.prototype.loginCheck.call(this);var e=this.token();pxt.github.token=e},e.prototype.loginAsync=function(e,t){return this.routedLoginAsync(void 0,void 0)},e.prototype.routedLoginAsync=function(e,t){var n=this;this.loginCheck();var r=Promise.resolve();return this.token()||(r=r.then(function(){return n.showLoginAsync(e,t)})),r.then(function(){return{accessToken:n.token()}})},e.prototype.showLoginAsync=function(n,r){var i=this;pxt.tickEvent("github.login.dialog");var o,a=!(pxt.appTarget&&pxt.appTarget.cloud&&pxt.appTarget.cloud.cloudProviders&&pxt.appTarget.cloud.cloudProviders[this.name]);return c.confirmAsync({header:lf("Sign in with GitHub"),hideCancel:!0,hasCloseIcon:!0,helpUrl:"/github",agreeLbl:lf("Sign in"),onLoaded:function(e){o=e},jsxd:function(){return s.createElement("div",{className:"ui form"},s.createElement("p",null,lf("You need to sign in with GitHub to use this feature.")),s.createElement("p",null,lf("You can host your code on GitHub and collaborate with friends on projects.")),!a&&s.createElement("p",{className:"ui small"},lf("Looking to use a Developer token instead?"),s.createElement(l.Link,{className:"link",text:lf("Click here"),onClick:e})),a&&s.createElement("ol",null,s.createElement("li",null,lf("Navigate to: "),s.createElement("a",{href:"https://github.com/settings/tokens/new",target:"_blank",rel:"noopener noreferrer"},lf("GitHub token generation page"))),s.createElement("li",null,lf("Put something like 'MakeCode {0}' in description",pxt.appTarget.name)),s.createElement("li",null,lf("Select either '{0}' or '{1}' scope, depending which repos you want to edit from here","repo","public_repo")),s.createElement("li",null,lf("Click generate token, copy it, and paste it below."))),a&&s.createElement("div",{className:"ui field"},s.createElement("label",{id:"selectUrlToOpenLabel"},lf("Paste GitHub token here:")),s.createElement("input",{type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:"0123abcd...",className:"ui blue fluid"})))}}).then(function(e){if(e){if(a){var t=o.querySelectorAll("input")[0].value.trim();return i.saveAndValidateTokenAsync(t)}return i.oauthRedirectAsync(n,r)}return pxt.tickEvent("github.login.cancel"),Promise.resolve()});function e(){a=!0,c.forceUpdate()}},e.prototype.oauthRedirectAsync=function(e,t){c.showLoading("ghlogin",lf("Signing you in to GitHub..."));var n=u.setOauth(this.name,e&&t?"#github:"+e.id+":"+t:void 0),r=window.location.href.replace(/#.*/,""),i=pxt.Cloud.getServiceUrl()+"/oauth/login?state="+n+"&response_type=token&client_id=gh-token&redirect_uri="+encodeURIComponent(r);return window.location.href=i,Promise.delay(1e3)},e.prototype.getUserInfoAsync=function(){var t=this;return this.token()?pxt.github.authenticatedUserAsync().then(function(e){return{id:e.login,userName:e.login,name:e.name,photo:e.avatar_url,profile:"https://github.com/"+e.login}}).catch(function(e){throw 401==e.statusCode&&t.setNewToken(void 0),e}):Promise.resolve(void 0)},e.prototype.setNewToken=function(e){t.prototype.setNewToken.call(this,e),pxt.github.token=e},e.prototype.saveAndValidateTokenAsync=function(t){var n=this;return c.showLoading("githubtokensave",lf("validating GitHub token...")),Promise.resolve().then(function(){return 40==t.length&&/^[a-f0-9]+$/.test(t)?(pxt.github.token=t,pxt.github.createRepoAsync(void 0,"").then(function(e){pxt.reportError("github","Succeeded creating undefined repo!"),c.infoNotification(lf("Something went wrong with validation; token stored")),n.setNewToken(t),pxt.tickEvent("github.token.wrong")},function(e){pxt.github.token="",p.showGithubTokenError(e)||(422==e.statusCode?c.infoNotification(lf("Token validated and stored")):c.infoNotification(lf("Token stored but not validated")),n.setNewToken(t),pxt.tickEvent("github.token.ok"))}).then(function(){return u.syncAsync()})):(pxt.tickEvent("github.token.invalid"),c.errorNotification(lf("Invalid token format")),Promise.resolve())}).finally(function(){return c.hideLoading("githubtokensave")})},e.prototype.createRepositoryAsync=function(r,i){return o(this,void 0,void 0,function(){var t,n;return a(this,function(e){switch(e.label){case 0:return pxt.tickEvent("github.filelist.create.start"),[4,this.routedLoginAsync(i,"create-repository")];case 1:return e.sent(),this.token()?[4,p.showCreateGithubRepoDialogAsync(r)]:(pxt.tickEvent("github.filelist.create.notoken"),[2,!1]);case 2:if(!(t=e.sent()))return[2,!1];pxt.tickEvent("github.filelist.create.export"),n=pxt.github.parseRepoId(t),c.showLoading("creategithub",lf("preparing {0} repository...",n.project||n.fullName)),e.label=3;case 3:return e.trys.push([3,,5,6]),[4,d.exportToGithubAsync(i,t)];case 4:return e.sent(),[2,!0];case 5:return c.hideLoading("creategithub"),[7];case 6:return[2]}})})},e}(u.ProviderBase);n.GithubProvider=f},{"./cloudsync":11,"./core":41,"./dialogs":51,"./sui":100,"./workspace":105,react:284}],62:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(o,a,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((l=l.apply(o,a||[])).next())})},d=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var x=e("react"),h=e("./package"),f=e("./core"),a=e("./srceditor"),E=e("./sui"),p=e("./workspace"),s=e("./dialogs"),m=e("./coretsx"),l=e("./data"),c=e("./marked"),u=e("./compiler"),g=e("./cloudsync"),v=function(n){function e(e){var t=n.call(this,e)||this;return t.diffCache={},t.goBack=t.goBack.bind(t),t.handlePullClick=t.handlePullClick.bind(t),t.handleBranchClick=t.handleBranchClick.bind(t),t.handleGithubError=t.handleGithubError.bind(t),t}return i(e,n),e.prototype.clearCache=function(){this.diffCache={}},e.prototype.saveGitJsonAsync=function(t){return o(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,h.mainEditorPkg().files[pxt.github.GIT_JSON].setContentAsync(JSON.stringify(t,null,4))];case 1:return e.sent(),[2]}})})},e.prototype.switchToBranchAsync=function(i){return o(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return t=this.props.parent.state.header,n=this.getGitJson(),r=this.parsedRepoId(),t.githubId=r.fullName+"#"+i,n.repo=t.githubId,n.prUrl=null,[4,this.saveGitJsonAsync(n)];case 1:return e.sent(),[2]}})})},e.prototype.newBranchAsync=function(){return o(this,void 0,void 0,function(){var t,n,r,i,o;return d(this,function(e){switch(e.label){case 0:return[4,g.ensureGitHubTokenAsync()];case 1:return e.sent(),t=this.parsedRepoId(),[4,pxt.github.getNewBranchNameAsync(t.fullName,"patch-")];case 2:return n=e.sent(),[4,f.promptAsync({header:lf("New branch name"),body:lf("Name cannot have spaces or special characters. Examples: {0}","my_feature, add-colors, fix_something"),agreeLbl:lf("Create"),initialValue:n,hasCloseIcon:!0,onInputValidation:function(e){if(/[^\w\-]/.test(e))return lf("Don't use spaces or special characters.")}})];case 3:if(!(r=e.sent()))return[2];this.showLoading("github.branch",!0,lf("creating branch...")),e.label=4;case 4:return e.trys.push([4,7,8,9]),i=this.getGitJson(),[4,pxt.github.createNewBranchAsync(t.fullName,r,i.commit.sha)];case 5:return e.sent(),[4,this.switchToBranchAsync(r)];case 6:return e.sent(),this.forceUpdate(),[3,9];case 7:return o=e.sent(),this.handleGithubError(o),[3,9];case 8:return this.hideLoading(),[7];case 9:return[2]}})})},e.prototype.switchBranchAsync=function(){return o(this,void 0,void 0,function(){var t,r,n,i=this;return d(this,function(e){switch(e.label){case 0:return t=this.parsedRepoId(),[4,pxt.github.listRefsExtAsync(t.fullName,"heads")];case 1:return r=e.sent(),(n=Object.keys(r.refs).map(function(n){return{name:n,description:r.refs[n],onClick:function(){return o(i,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return f.hideDialog(),[4,this.setStateAsync({needsCommitMessage:!1})];case 1:e.sent(),t=this.parsedRepoId().tag,e.label=2;case 2:return e.trys.push([2,,5,8]),[4,this.switchToBranchAsync(n)];case 3:return e.sent(),[4,this.pullAsync()];case 4:return e.sent(),[3,8];case 5:return this.state.needsCommitMessage?[4,this.switchToBranchAsync(t)]:[3,7];case 6:e.sent(),e.label=7;case 7:return[7];case 8:return[2]}})})}}})).unshift({name:lf("Create new branch"),description:lf("Based on {0}",t.tag),onClick:function(){return f.hideDialog(),i.newBranchAsync()}}),[4,f.confirmAsync({header:lf("Switch to a different branch"),hasCloseIcon:!0,hideAgree:!0,hideCancel:!0,jsx:x.createElement("div",{className:"ui form"},x.createElement("div",{className:"ui relaxed divided list",role:"menu"},n.map(function(e){return x.createElement("div",{key:e.name,className:"item link"},x.createElement("i",{className:"large github middle aligned icon"}),x.createElement("div",{className:"content"},x.createElement("a",{onClick:e.onClick,role:"menuitem",className:"header"},e.name),x.createElement("div",{className:"description"},e.description)))})))})];case 2:return e.sent(),[2]}})})},e.prototype.handleBranchClick=function(e){pxt.tickEvent("github.branch"),e.stopPropagation(),this.switchBranchAsync().done()},e.prototype.goBack=function(){pxt.tickEvent("github.backButton",void 0,{interactiveConsent:!0}),this.props.parent.openPreviousEditor()},e.prototype.handlePullClick=function(e){pxt.tickEvent("github.pull"),this.pullAsync().done()},e.prototype.forkAsync=function(s){return o(this,void 0,void 0,function(){var t,n,r,i,o,a;return d(this,function(e){switch(e.label){case 0:return t=this.parsedRepoId(),n=s?lf("You don't seem to have write permission to {0}.\n",t.fullName):"",[4,f.confirmAsync({header:lf("Do you want to fork {0}?",t.fullName),hideCancel:!0,hasCloseIcon:!0,helpUrl:"/github/fork",body:n+lf("Forking creates a copy of {0} under your account. You can include your changes via a pull request.",t.fullName),agreeLbl:"Fork",agreeIcon:"copy outline"})];case 1:if(!e.sent())return[2];this.showLoading("github.fork",!0,lf("forking repository (this may take a minute or two)...")),e.label=2;case 2:return e.trys.push([2,5,6,7]),r=this.getGitJson(),[4,pxt.github.forkRepoAsync(t.fullName,r.commit.sha)];case 3:return i=e.sent(),(o=this.props.parent.state.header).githubId=i,r.repo=o.githubId,[4,this.saveGitJsonAsync(r)];case 4:return e.sent(),[3,7];case 5:return a=e.sent(),this.handleGithubError(a),[3,7];case 6:return this.hideLoading(),[7];case 7:return[2]}})})},e.prototype.handleGithubError=function(e){var t=parseInt(e.statusCode);e.isOffline||0===t?f.warningNotification(lf("Please connect to internet and try again.")):e.needsWritePermission?this.state.triedFork?f.warningNotification(lf("You don't have write permission.")):(f.hideDialog(),this.forkAsync(!0).done()):e.isMergeConflictMarkerError?(pxt.tickEvent("github.commitwithconflicts"),f.warningNotification(lf("Please merge all conflicts before commiting changes."))):401==t?f.warningNotification(lf("GitHub access token looks invalid; sign out and try again.")):404==t?f.warningNotification(lf("GitHub resource not found; please check that it still exists.")):(pxt.reportException(e),f.warningNotification(lf("Oops, something went wrong. Please try again.")))},e.prototype.bumpAsync=function(){return o(this,void 0,void 0,function(){function t(e){a=e.currentTarget.name,m.forceUpdate()}var n,r,i,o,a,s,l,c,u;return d(this,function(e){switch(e.label){case 0:try{p.prepareConfigForGithub(h.mainPkg.readFile(pxt.CONFIG_NAME),!0)}catch(e){return f.warningNotification(e.message),[2]}return n=pxt.semver.parse(h.mainPkg.config.version||"0.0.0"),(r=pxt.semver.parse(pxt.semver.stringify(n))).major++,r.minor=0,r.patch=0,(i=pxt.semver.parse(pxt.semver.stringify(n))).minor++,i.patch=0,(o=pxt.semver.parse(pxt.semver.stringify(n))).patch++,a="patch",[4,f.confirmAsync({header:lf("Pick a release version"),agreeLbl:lf("Create release"),disagreeLbl:lf("Cancel"),jsxd:function(){return x.createElement("div",{className:"grouped fields"},x.createElement("label",null,lf("Choose a release version that describes the changes you made to the code."),E.helpIconLink("/github/release#versioning",lf("Learn about version numbers."))),x.createElement("div",{className:"field"},x.createElement("div",{className:"ui radio checkbox"},x.createElement("input",{type:"radio",name:"patch",checked:"patch"==a,"aria-checked":"patch"==a,onChange:t}),x.createElement("label",null,lf("{0}: patch (bug fixes or other non-user visible changes)",pxt.semver.stringify(o))))),x.createElement("div",{className:"field"},x.createElement("div",{className:"ui radio checkbox"},x.createElement("input",{type:"radio",name:"minor",checked:"minor"==a,"aria-checked":"minor"==a,onChange:t}),x.createElement("label",null,lf("{0}: minor change (added function or optional parameters)",pxt.semver.stringify(i))))),x.createElement("div",{className:"field"},x.createElement("div",{className:"ui radio checkbox"},x.createElement("input",{type:"radio",name:"major",checked:"major"==a,"aria-checked":"major"==a,onChange:t}),x.createElement("label",null,lf("{0}: major change (renamed functions, deleted parameters or functions)",pxt.semver.stringify(r))))))}})];case 1:if(!e.sent())return[2];s=o,"major"==a?s=r:"minor"==a&&(s=i),l=pxt.semver.stringify(s),this.showLoading("github.release.new",!0,lf("creating release...")),e.label=2;case 2:return e.trys.push([2,5,6,7]),c=this.props.parent.state.header,[4,p.bumpAsync(c,l)];case 3:return e.sent(),h.mainPkg.config.version=l,[4,this.maybeReloadAsync()];case 4:return e.sent(),this.hideLoading(),f.infoNotification(lf("GitHub release created.")),[3,7];case 5:return u=e.sent(),this.handleGithubError(u),[3,7];case 6:return this.hideLoading(),[7];case 7:return[2]}})})},e.prototype.showLoading=function(t,n,r){return o(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return n?[4,g.ensureGitHubTokenAsync()]:[3,2];case 1:e.sent(),e.label=2;case 2:return pxt.tickEvent(t),[4,this.setStateAsync({loadingMessage:r})];case 3:return e.sent(),f.showLoading("githubjson",r),[2]}})})},e.prototype.hideLoading=function(){this.state.loadingMessage&&(f.hideLoading("githubjson"),this.setState({loadingMessage:void 0}))},e.prototype.pkgConfigKey=function(e){var t=JSON.parse(e);return delete t.version,JSON.stringify(t)},e.prototype.maybeReloadAsync=function(){return o(this,void 0,void 0,function(){var t,n,r;return d(this,function(e){switch(e.label){case 0:return t=this.props.parent.state.header,[4,p.getTextAsync(t.id)];case 1:return n=e.sent(),h.mainEditorPkg().setFiles(n),(r=this.pkgConfigKey(n[pxt.CONFIG_NAME]))!=this.state.previousCfgKey?[3,3]:[4,this.refreshPullAsync()];case 2:return e.sent(),[3,6];case 3:return[4,this.setStateAsync({needsPull:void 0,previousCfgKey:r})];case 4:return e.sent(),[4,this.props.parent.reloadHeaderAsync()];case 5:e.sent(),e.label=6;case 6:return[2]}})})},e.prototype.pullAsync=function(){return o(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:this.showLoading("github.pull",!1,lf("pulling changes from GitHub...")),e.label=1;case 1:return e.trys.push([1,9,10,11]),this.setState({needsPull:void 0}),[4,p.pullAsync(this.props.parent.state.header).catch(this.handleGithubError)];case 2:switch(e.sent()){case p.PullStatus.NoSourceControl:case p.PullStatus.UpToDate:return[3,3];case p.PullStatus.NeedsCommit:return[3,4];case p.PullStatus.GotChanges:return[3,6]}return[3,8];case 3:return this.setState({needsPull:!1}),[3,8];case 4:return this.setState({needsCommitMessage:!0}),[4,this.refreshPullAsync()];case 5:return e.sent(),[3,8];case 6:return[4,this.maybeReloadAsync()];case 7:return e.sent(),[3,8];case 8:return[3,11];case 9:return t=e.sent(),this.handleGithubError(t),[3,11];case 10:return this.hideLoading(),[7];case 11:return[2]}})})},e.prototype.getGitJson=function(){return h.mainPkg.readGitJson()},e.prototype.parsedRepoId=function(){var e=this.props.parent.state.header;return pxt.github.parseRepoId(e.githubId)},e.prototype.commitCoreAsync=function(){return o(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return d(this,function(e){switch(e.label){case 0:return t=this.props.parent,n=t.state.header,r=n.githubId,[4,p.pullAsync(n)];case 1:return e.sent(),[4,p.hasMergeConflictMarkers(n)];case 2:return e.sent()?[4,this.maybeReloadAsync()]:[3,4];case 3:return e.sent(),f.warningNotification(lf("Merge conflicts found. Resolve them before commiting.")),[2];case 4:return[4,p.commitAsync(n,{message:this.state.description,blocksScreenshotAsync:function(){return a.props.parent.blocksScreenshotAsync(1)},blocksDiffScreenshotAsync:function(){var e=h.mainEditorPkg().sortedFiles().find(function(e){return"main.blocks"==e.name}),t=pxt.blocks.diffXml(e.baseGitContent,e.content);return t&&t.ws?pxt.blocks.layout.toPngAsync(t.ws,1):Promise.resolve(void 0)}})];case 5:return(i=e.sent())?[4,p.prAsync(n,i,this.state.description||lf("Commit conflict"))]:[3,9];case 6:return o=e.sent(),[4,s.showPRDialogAsync(r,o)];case 7:return e.sent(),[4,p.pullAsync(n)];case 8:return e.sent(),[3,11];case 9:return[4,this.maybeReloadAsync()];case 10:e.sent(),e.label=11;case 11:return this.setState({description:""}),[2]}})})},e.prototype.commitAsync=function(){return o(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:this.setState({needsCommitMessage:!1}),this.showLoading("github.commit",!0,lf("commit & push changes to GitHub...")),e.label=1;case 1:return e.trys.push([1,4,5,6]),[4,this.commitCoreAsync()];case 2:return e.sent(),[4,this.maybeReloadAsync()];case 3:return e.sent(),[3,6];case 4:return t=e.sent(),this.handleGithubError(t),[3,6];case 5:return this.hideLoading(),[7];case 6:return[2]}})})},e.prototype.lineDiff=function(e,t){var n=pxt.github.diff(e.split("").join("\n"),t.split("").join("\n"),{context:1/0});if(!n)return{a:x.createElement("div",{className:"inline-diff"},x.createElement("code",null,e)),b:x.createElement("div",{className:"inline-diff"},x.createElement("code",null,t))};for(var r=[],i=[],o=0;o<n.length;){for(var a=o,s=n[o][0];n[a]&&n[a][0]==s;)a++;var l=n.slice(o,a).map(function(e){return e.slice(2)}).join("");" "==s?(r.push(x.createElement("code",{key:o,className:"ch-common"},l)),i.push(x.createElement("code",{key:o,className:"ch-common"},l))):"-"==s?r.push(x.createElement("code",{key:o,className:"ch-removed"},l)):"+"==s?i.push(x.createElement("code",{key:o,className:"ch-added"},l)):pxt.Util.oops(),o=a}return{a:x.createElement("div",{className:"inline-diff"},r),b:x.createElement("div",{className:"inline-diff"},i)}},e.prototype.showDiff=function(t,n){var r=this,i=this.diffCache[n.name];if(i&&i.file.file===n.file||(i={file:n},this.diffCache[n.name]=i),i.diff&&i.file.gitFile==n.gitFile&&i.file.editorFile==n.editorFile)return i.diff;var o=/\.blocks$/.test(n.name),a=function(){i.whitespace||(i.whitespace=!0,i.diff=e(),r.forceUpdate())},e=function(){var e;return e=o?r.createBlocksDiffJSX(n):r.createTextDiffJSX(n,!i.whitespace),x.createElement("div",{key:"difffile"+n.name,className:"ui segments filediff"},x.createElement("div",{className:"ui segment diffheader"},t&&"main.blocks"==n.name?void 0:x.createElement("span",null,n.name),x.createElement(E.Button,{className:"small",icon:"undo",text:lf("Revert"),ariaLabel:lf("Revert file"),title:lf("Revert file"),textClass:"landscape only",onClick:i.revert}),e.legendJSX,e.conflicts?x.createElement("p",null,lf("Merge conflicts found. Resolve them before commiting.")):void 0,0==s.length?void 0:x.createElement("p",null,lf("Reverting this file will also restore: {0}",s.join(", "))),0==l.length?void 0:x.createElement("p",null,lf("Reverting this file will also remove: {0}",l.join(", "))),f&&!t?x.createElement("p",null,lf("Reverting this file will also revert: {0}",f.name)):void 0),e.diffJSX?x.createElement("div",{className:"ui segment diff"},e.diffJSX):x.createElement("div",{className:"ui segment"},x.createElement("p",null,lf("Whitespace changes only."),x.createElement(E.Link,{className:"link",text:lf("Show"),onClick:a}))))},s=[],l=[];if(n.name==pxt.CONFIG_NAME){var c=pxt.Package.parseAndValidConfig(n.gitFile),u=pxt.Package.parseAndValidConfig(n.editorFile);if(c&&u){var p=pxt.allPkgFiles(c),d=pxt.allPkgFiles(u);s=p.filter(function(e){return-1==d.indexOf(e)}),l=d.filter(function(e){return-1==p.indexOf(e)})}}var f=t&&h.mainEditorPkg().files[n.file.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)];return f==n.file&&(f=void 0),i.file=n,i.revert=function(){return r.revertFileAsync(n,s,l,f)},i.diff=e(),i.diff},e.prototype.createBlocksDiffJSX=function(e){var t,n=e.gitFile||"",r=e.editorFile;if(r){var i="\n```diffblocksxml\n"+n+"\n---------------------\n"+r+"\n```\n";t=x.createElement(c.MarkedContent,{key:"diffblocksxxml"+e.name,parent:this.props.parent,markdown:i})}else t=x.createElement("div",{className:"ui basic segment"},lf("Your blocks were updated. Go back to the editor to view the changes."));return{diffJSX:t,legendJSX:x.createElement("p",{className:"legend"},x.createElement("span",null,x.createElement("span",{className:"added icon"}),lf("added, changed or moved")),x.createElement("span",null,x.createElement("span",{className:"deleted icon"}),lf("deleted")),x.createElement("span",null,x.createElement("span",{className:"notchanged icon"}),lf("not changed")),E.helpIconLink("/github/diff#blocks",lf("Learn about reading differences in blocks code."))),conflicts:0}},e.prototype.createTextDiffJSX=function(d,e){var f=this,t=d.gitFile||"",n=d.editorFile,h={"@":"diff-marker"," ":"diff-unchanged","+":"diff-added","-":"diff-removed"},m=pxt.github.diff(t,n,{ignoreWhitespace:!!e});if(!m)return pxt.tickEvent("github.diff.toobig"),{diffJSX:x.createElement("div",null,lf("Too many differences to render diff.")),conflicts:0};var g=0,v="",y=0,b=0,_="",w=null,k=[];return m.forEach(function(e,t){var n=/^@@ -(\d+),\d+ \+(\d+),\d+/.exec(e);n?(y=parseInt(n[1])-1,b=parseInt(n[2])-1):("+"!=e[0]&&y++,"-"!=e[0]&&b++);var r=m[t+1]?m[t+1][0]:"",i=m[t+2]?m[t+2][0]:"",o=e.slice(2),a=x.createElement("code",null,o);if(w)a=w,w=null;else if(!("-"!=e[0]||" "!=_&&"@"!=_||"+"!=r||" "!=i&&"@"!=i&&""!=i)){var s=f.lineDiff(e.slice(2),m[t+1].slice(2));a=s.a,w=s.b}var l=_=e[0];if("+"==_&&/^<<<<<<<[^<]/.test(o)){g++,v="local",l="@",k.push(x.createElement("tr",{key:"conflictheader"+y+b,className:"conflict ui small header"},x.createElement("td",{colSpan:4,className:"ui small header"},lf("Merge conflict")))),k.push(x.createElement("tr",{key:"conflictdescr"+y+b,className:"conflict ui description"},x.createElement("td",{colSpan:4,className:"ui small description"},lf("Changes from GitHub are conflicting with local changes."),E.helpIconLink("/github/merge-conflict",lf("Learn about merge conflicts and resolution.")))));var c=Math.min(y,b);k.push(x.createElement("tr",{key:"merge"+y+b,className:"conflict ui mergebtn"},x.createElement("td",{colSpan:4,className:"ui"},x.createElement(E.Button,{className:"compact",text:lf("Keep local"),title:lf("Ignore the changes from GitHub."),onClick:function(){return f.handleMergeConflictResolution(d,c,!0,!1)}}),x.createElement(E.Button,{className:"compact",text:lf("Keep remote"),title:lf("Override local changes with changes from GitHub."),onClick:function(){return f.handleMergeConflictResolution(d,c,!1,!0)}}),x.createElement(E.Button,{className:"compact",text:lf("Keep both"),title:lf("Keep both local and remote changes."),onClick:function(){return f.handleMergeConflictResolution(d,c,!0,!0)}}))))}else"+"==_&&/^>>>>>>>[^>]/.test(o)?(v="footer",l="@"):"+"==_&&/^=======$/.test(o)&&(l="@",v="remote");var u="@"==l,p=(v?"conflict":"")+" "+v+" "+h[l];k.push(x.createElement("tr",{key:y+b,className:p},x.createElement("td",{className:"line-a","data-content":y}),x.createElement("td",{className:"line-b","data-content":b}),u?x.createElement("td",{colSpan:2,className:"change"},x.createElement("code",null,e)):x.createElement("td",{className:"marker","data-content":l}),u?void 0:x.createElement("td",{className:"change"},a))),"footer"==v&&(v="")}),{diffJSX:k.length?x.createElement("table",{className:"diffview"},x.createElement("tbody",null,k)):void 0,legendJSX:void 0,conflicts:g}},e.prototype.handleMergeConflictResolution=function(e,t,n,r){var i=this;pxt.tickEvent("github.conflict.resolve",{local:n?1:0,remote:r?1:0},{interactiveConsent:!0});var o=pxt.github.resolveMergeConflictMarker(e.file.content,t,n,r);e.file.setContentAsync(o).then(function(){return delete i.diffCache[e.name]}).done(function(){return i.props.parent.forceUpdate()})},e.prototype.revertFileAsync=function(l,c,u,p){return o(this,void 0,void 0,function(){var t,n,r,i,o,a,s;return d(this,function(e){switch(e.label){case 0:return pxt.tickEvent("github.revert",{start:1},{interactiveConsent:!0}),[4,f.confirmAsync({header:lf("Would you like to revert changes to {0}?",l.name),body:lf("Changes will be lost for good. No undo."),agreeLbl:lf("Revert"),agreeClass:"red",agreeIcon:"trash"})];case 1:return e.sent()?(pxt.tickEvent("github.revert",{ok:1}),this.setState({needsCommitMessage:!1}),null!=l.gitFile?[3,4]:[4,h.mainEditorPkg().removeFileAsync(l.name)]):[2];case 2:return e.sent(),[4,this.props.parent.reloadHeaderAsync()];case 3:return e.sent(),[3,11];case 4:if(l.name!=pxt.CONFIG_NAME)return[3,7];for(t=this.getGitJson(),n=0,r=c;n<r.length;n++)s=r[n],i=pxt.github.lookupFile(t.commit,s),h.mainEditorPkg().setFile(s,i&&i.blobContent||"// Cannot restore.");for(o=0,a=u;o<a.length;o++)s=a[o],delete h.mainEditorPkg().files[s];return[4,l.file.setContentAsync(l.gitFile)];case 5:return e.sent(),[4,this.props.parent.reloadHeaderAsync()];case 6:return e.sent(),[3,11];case 7:return[4,l.file.setContentAsync(l.gitFile)];case 8:return e.sent(),p?[4,p.setContentAsync(p.baseGitContent)]:[3,10];case 9:e.sent(),e.label=10;case 10:this.forceUpdate(),e.label=11;case 11:return[2]}})})},e.prototype.refreshPullAsync=function(){var n=this;return this.setStateAsync({needsPull:void 0}).then(function(){return p.hasPullAsync(n.props.parent.state.header)}).then(function(e){return n.setStateAsync({needsPull:e})}).catch(function(e){var t=parseInt(e.statusCode);e.isOffline||0===t?n.setState({needsPull:void 0}):n.handleGithubError(e)})},e.prototype.setVisible=function(e){e!==this.state.isVisible&&(e?(this.setState({previousCfgKey:this.pkgConfigKey(h.mainEditorPkg().files[pxt.CONFIG_NAME].content)}),this.refreshPullAsync().done()):(this.clearCache(),this.setState({needsCommitMessage:!1,needsPull:void 0})))},e.prototype.renderCore=function(){var t=this,e=this.getGitJson();if(!e)return x.createElement("div",null);var n=h.mainPkg.getPreferredEditor()==pxt.BLOCKS_PROJECT_NAME,r=h.mainEditorPkg().sortedFiles().map(function(e){var t=e.publishedContent();return e.baseGitContent==t?void 0:{file:e,name:e.name,gitFile:e.baseGitContent,editorFile:t}}).filter(function(e){return!!e}),i=0<r.length,o=n&&!pxt.options.debug?r.filter(function(e){return/\.blocks$/.test(e.name)}):r,a=this.state.needsPull,s=this.parsedRepoId(),l="master"==s.tag,c=this.getData("github:user"),u="https://github.com/"+s.fullName+(l?"":"/tree/"+s.tag),p=!pxt.github.token,d=!e.isFork&&l?null:"https://github.com/"+s.fullName+"/compare/"+s.tag+"?expand=1";return x.createElement("div",{id:"githubArea"},x.createElement("div",{id:"serialHeader",className:"ui serialHeader"},x.createElement("div",{className:"leftHeaderWrapper"},x.createElement("div",{className:"leftHeader"},x.createElement(E.Button,{title:lf("Go back"),icon:"arrow left",text:lf("Go back"),textClass:"landscape only",tabIndex:0,onClick:this.goBack,onKeyDown:E.fireClickOnEnter}))),x.createElement("div",{className:"rightHeader"},x.createElement(E.Button,{icon:!0===a?"long arrow alternate down":!1===a?"check":"",className:!0===a?"positive":"",text:lf("Pull changes"),textClass:"landscape only",title:lf("Pull changes from GitHub to get your code up-to-date."),onClick:this.handlePullClick,onKeyDown:E.fireClickOnEnter}),p?void 0:x.createElement(E.Link,{className:"ui button",icon:"user plus",href:"https://github.com/"+s.fullName+"/settings/collaboration",target:"_blank",title:lf("Invite collaborators."),onKeyDown:E.fireClickOnEnter}),x.createElement(E.Link,{className:"ui button",icon:"external alternate",href:u,title:lf("Open repository in GitHub."),target:"_blank",onKeyDown:E.fireClickOnEnter}))),x.createElement(y,{parent:this,needsToken:p,githubId:s,master:l,gs:e,isBlocks:n,needsCommit:i,user:c}),x.createElement("div",{className:"ui form"},d?x.createElement("a",{href:d,role:"button",className:"ui link create-pr",target:"_blank",rel:"noopener noreferrer"},lf("Pull request")):void 0,x.createElement("h3",{className:"header"},x.createElement("i",{className:"large github icon"}),x.createElement("span",{className:"repo-name"},s.fullName),x.createElement("span",{onClick:this.handleBranchClick,role:"button",className:"repo-branch"},"#"+s.tag,x.createElement("i",{className:"dropdown icon"}))),i?x.createElement(b,{parent:this,needsToken:p,githubId:s,master:l,gs:e,isBlocks:n,needsCommit:i,user:c}):x.createElement("div",{className:"ui segment"},lf("No local changes found.")," ",lf("Your project is saved in GitHub.")),o.length?x.createElement("div",{className:"ui"},o.map(function(e){return t.showDiff(n,e)})):void 0,n?void 0:x.createElement(_,{parent:this,needsToken:p,githubId:s,master:l,gs:e,isBlocks:n,needsCommit:i,user:c})))},e}(l.Component),y=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.renderCore=function(){return this.props.parent.state.needsCommitMessage?x.createElement("div",{className:"ui warning message"},x.createElement("div",{className:"content"},lf("You need to commit your changes before you can pull from GitHub."))):x.createElement("div",null)},e}(E.StatelessUIElement),b=function(n){function e(e){var t=n.call(this,e)||this;return t.handleDescriptionChange=t.handleDescriptionChange.bind(t),t.handleCommitClick=t.handleCommitClick.bind(t),t}return i(e,n),e.prototype.handleDescriptionChange=function(e){this.props.parent.setState({description:e})},e.prototype.handleCommitClick=function(t){return o(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return pxt.tickEvent("github.commit"),t.stopPropagation(),[4,g.githubProvider().loginAsync()];case 1:return e.sent(),pxt.github.token?[4,this.props.parent.commitAsync()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.renderCore=function(){var e=this.props.parent.state.description,t=e&&70<e.length?lf("Your description is getting long..."):void 0;return x.createElement("div",null,x.createElement("div",{className:"ui field"},x.createElement(E.Input,{type:"text",placeholder:lf("Describe your changes."),value:this.props.parent.state.description,onChange:this.handleDescriptionChange,error:t})),x.createElement("div",{className:"ui field"},x.createElement(E.Button,{className:"primary",text:lf("Commit & push changes"),icon:"long arrow alternate up",onClick:this.handleCommitClick,onKeyDown:E.fireClickOnEnter}),x.createElement("span",{className:"inline-help"},lf("Save your changes in GitHub."),E.helpIconLink("/github/commit",lf("Learn about commiting and pushing code into GitHub.")))))},e}(E.StatelessUIElement),_=function(n){function e(e){var t=n.call(this,e)||this;return t.handleBumpClick=t.handleBumpClick.bind(t),t.handleForkClick=t.handleForkClick.bind(t),t}return i(e,n),e.prototype.handleForkClick=function(e){pxt.tickEvent("github.extensionzone.fork",void 0,{interactiveConsent:!0}),e.stopPropagation(),this.props.parent.forkAsync(!1).done()},e.prototype.handleBumpClick=function(e){var t=this;pxt.tickEvent("github.extensionzone.bump",void 0,{interactiveConsent:!0}),e.stopPropagation();var n=this.props,r=n.needsCommit,i=n.master;r?f.confirmAsync({header:lf("Commit your changes..."),body:lf("You need to commit your local changes to create a release."),agreeLbl:lf("Ok"),hideAgree:!0}):i?g.githubProvider().loginAsync().then(function(){return pxt.github.token&&t.props.parent.bumpAsync()}):f.confirmAsync({header:lf("Checkout the master branch..."),body:lf("You need to checkout the master branch to create a release."),agreeLbl:lf("Ok"),hideAgree:!0})},e.prototype.renderCore=function(){var e=this.props,t=e.needsToken,n=e.githubId,r=e.gs,i=e.user,o=this.props.parent.props.parent.state.header,a=!t&&r.commit&&!r.commit.tree.tree.some(function(e){return/^LICENSE/.test(e.path.toUpperCase())||/^COPYING/.test(e.path.toUpperCase())}),s=o&&window.location.href.replace(/#.*$/,"")+"#testproject:"+o.id,l=i&&i.id!=n.owner;return x.createElement("div",{className:"ui transparent segment"},x.createElement("div",{className:"ui header"},lf("Extension zone")),x.createElement("div",{className:"ui field"},x.createElement("a",{href:s,role:"button",className:"ui button",target:pxt.appTarget.id+"testproject",rel:"noopener noreferrer"},lf("Test Extension")),x.createElement("span",{className:"inline-help"},lf("Open a test project that uses this extension."),E.helpIconLink("/github/test-extension",lf("Learn about testing extensions.")))),l&&x.createElement("div",{className:"ui field"},x.createElement(E.Button,{text:lf("Fork repository"),onClick:this.handleForkClick,onKeyDown:E.fireClickOnEnter}),x.createElement("span",{className:"inline-help"},lf("Fork your own copy of {0} to your account.",n.fullName),E.helpIconLink("/github/fork",lf("Learn more about forking repositories.")))),r.commit&&r.commit.tag?x.createElement("div",{className:"ui field"},x.createElement("p",{className:"inline-help"},lf("Current release: {0}",r.commit.tag),E.helpIconLink("/github/release",lf("Learn about releases.")))):x.createElement("div",{className:"ui field"},x.createElement(E.Button,{text:lf("Create release"),onClick:this.handleBumpClick,onKeyDown:E.fireClickOnEnter}),x.createElement("span",{className:"inline-help"},lf("Bump up the version number and create a release on GitHub."),E.helpIconLink("/github/release",lf("Learn more about extension releases.")))),a?x.createElement("div",{className:"ui field"},x.createElement("a",{href:"https://github.com/"+n.fullName+"/community/license/new?branch="+n.tag+"&template=mit",role:"button",className:"ui button",target:"_blank",rel:"noopener noreferrer"},lf("Add license")),x.createElement("span",{className:"inline-help"},lf("Your project doesn't seem to have a license."),E.helpIconLink("/github/license",lf("Learn more about licenses.")))):void 0)},e}(E.StatelessUIElement),w=function(r){function e(e){var t=r.call(this,e)||this;return t.parent=e,t.handleViewRef=function(e){t.view=e,t.view&&t.view.setVisible(t.isVisible)},t.handleViewRef=t.handleViewRef.bind(t),t}return i(e,r),e.prototype.getId=function(){return"githubEditor"},e.prototype.getCurrentSource=function(){return h.mainEditorPkg().files[pxt.github.GIT_JSON].content},e.prototype.hasHistory=function(){return!0},e.prototype.hasEditorToolbar=function(){return!1},e.prototype.setVisible=function(e){this.isVisible=e,this.view&&this.view.setVisible(e)},e.prototype.setHighContrast=function(e){},e.prototype.acceptsFile=function(e){return e.name===pxt.github.GIT_JSON},e.prototype.loadFileAsync=function(e,t){var n=this;return r.prototype.loadFileAsync.call(this,e,t).then(function(){return u.getBlocksAsync()}).then(function(){return n.parent.forceUpdate()})},e.prototype.display=function(){if(this.isVisible){var e=this.parent.state.header;if(e&&e.githubId)return x.createElement(v,{ref:this.handleViewRef,parent:this.parent})}},e}(a.Editor);n.Editor=w},{"./cloudsync":11,"./compiler":14,"./core":41,"./coretsx":42,"./data":44,"./dialogs":51,"./marked":71,"./package":81,"./srceditor":99,"./sui":100,"./workspace":105,react:284}],63:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(o,a,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((l=l.apply(o,a||[])).next())})},s=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./core"),l=e("./cloudsync"),c=pxt.U,u=function(t){function e(){var e=t.call(this,"googledrive",lf("Google Drive"),"xicon googledrive","https://www.googleapis.com")||this;return e.entryCache={},e}return i(e,t),e.prototype.login=function(){var e=this.loginInner();e.scope="https://www.googleapis.com/auth/drive.appfolder https://www.googleapis.com/auth/userinfo.profile";var t=o.stringifyQueryString("https://accounts.google.com/o/oauth2/v2/auth",e);if(e.redirect)window.location.href=t;else{var n=this;n.oauthWindow_=pxt.BrowserUtils.popupWindow(t,lf("Login with Google"),483,600),n.oauthInterval_=window.setInterval(function(){n.oauthWindow_.closed&&(window.clearInterval(n.oauthInterval_),pxt.BrowserUtils.changeHash("",!0),window.location.reload())},1e3)}},e.prototype.getUserInfoAsync=function(){var t=this;return this.getJsonAsync("/oauth2/v1/userinfo").then(function(e){return{name:e.name||lf("{0} User",t.friendlyName),id:e.id,photo:e.picture}})},e.prototype.listAsync=function(){var o=this;return this.getJsonAsync("/drive/v3/files?pageSize=1000&fields=files(id,name,version,modifiedTime)&spaces=appDataFolder").then(function(e){for(var t=[],n=0,r=e.files||[];n<r.length;n++){var i=r[n];o.entryCache[i.id]=i,t.push({id:i.id,name:i.name,version:i.version,updatedAt:o.parseTime(i.modifiedTime)})}return t})},e.prototype.downloadAsync=function(r){return a(this,void 0,void 0,function(){var t,n;return s(this,function(e){switch(e.label){case 0:return t=this.entryCache[r],[4,this.reqAsync({url:"/drive/v3/files/"+t.id+"?alt=media"})];case 1:return n=e.sent(),[2,{id:t.id,version:t.version,name:t.name,updatedAt:this.parseTime(t.modifiedTime),content:JSON.parse(n.text)}]}})})},e.prototype.uploadAsync=function(i,e,o){return a(this,void 0,void 0,function(){var t,n,r;return s(this,function(e){switch(e.label){case 0:return i?[3,2]:[4,this.reqAsync({url:"/drive/v3/files",method:"POST",data:{name:pxtc.U.guidGen(),mimeType:"application/json",parents:["appDataFolder"]}})];case 1:300<=(t=e.sent()).statusCode&&this.syncError(lf("Can't create file in {0}",this.friendlyName)),i=t.json.id,e.label=2;case 2:return[4,this.reqAsync({url:"/upload/drive/v3/files/"+i+"?uploadType=media&fields=id,name,version,modifiedTime",method:"PATCH",data:JSON.stringify(o,null,1)})];case 3:return 300<=(n=e.sent()).statusCode&&this.syncError(lf("Can't upload file to {0}",this.friendlyName)),r=n.json,[2,{id:(this.entryCache[r.id]=r).id,version:r.version,updatedAt:c.nowSeconds(),name:r.name}]}})})},e.prototype.updateAsync=function(e,t){return a(this,void 0,void 0,function(){return s(this,function(e){return[2]})})},e.prototype.deleteAsync=function(t){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.reqAsync({url:"/drive/v3/files/"+t,method:"DELETE"})];case 1:return 204!=e.sent().statusCode&&this.syncError(lf("Can't delete {0} file",this.friendlyName)),[2]}})})},e}(l.ProviderBase);n.Provider=u},{"./cloudsync":11,"./core":41}],64:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./data"),s=e("./sui");var l=function(n){function e(e){var t=n.call(this,e)||this;return t.handleVideoRef=function(e){t.video=e},t.state={hasPrompt:!0},t.handleDeviceClick=t.handleDeviceClick.bind(t),t.handleClose=t.handleClose.bind(t),t}return i(e,n),e.prototype.handleDeviceClick=function(e){var r=this;this.setState({hasPrompt:!1}),this.deviceId=e,this.deviceId&&navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e}},audio:!1}).then(function(e){try{r.stream=e,r.video.srcObject=r.stream,r.video.play();var t=r.stream.getVideoTracks()[0];if(t){var n="environment"!==t.getSettings().facingMode;r.setState({userFacing:n})}}catch(e){pxt.debug("greenscreen: play failed, "+e),r.stop()}},function(e){r.stop()})},e.prototype.handleClose=function(){this.deviceId||this.props.close()},e.prototype.componentDidMount=function(){var t=this;void 0!==typeof navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.getUserMedia&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isUwpEdge()&&navigator.mediaDevices.enumerateDevices().then(function(e){t.setState({devices:e.filter(function(e){return"videoinput"==e.kind})})})},e.prototype.componentWillUnmount=function(){this.stop()},e.prototype.stop=function(){if(this.deviceId=void 0,this.stream){try{this.stream.stop&&this.stream.stop()}catch(e){}try{var e=this.stream.getTracks();e&&e.forEach(function(e){return e.stop()})}catch(e){}this.stream=void 0}if(this.video)try{this.video.srcObject=void 0}catch(e){}},e.prototype.render=function(){var n=this,e=this.state,t=e.hasPrompt,r=e.devices,i=e.userFacing;return o.createElement("div",{className:"videoContainer"},o.createElement("video",{className:i?"flipx":"",autoPlay:!0,playsInline:!0,ref:this.handleVideoRef}),t?o.createElement(s.Modal,{isOpen:t,onClose:this.handleClose,closeIcon:!0,dimmer:!0,header:lf("Choose a camera")},o.createElement("div",{className:"ui cards "+(r?"":"loading")},o.createElement(c,{key:"devicegreenscreen",icon:"green tint",onClick:this.handleDeviceClick,deviceId:"",header:lf("Green background")}),r&&r.map(function(e,t){return o.createElement(c,{key:"device"+t,icon:"video camera",onClick:n.handleDeviceClick,deviceId:e.deviceId,header:e.label||lf("camera {0}",t)})}))):void 0)},e}(a.Component);n.WebCam=l;var c=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.handleClick=t.handleClick.bind(t),t}return i(e,n),e.prototype.handleClick=function(){var e=this.props,t=e.deviceId;(0,e.onClick)(t)},e.prototype.renderCore=function(){var e=this.props,t=e.header,n=e.icon;return o.createElement("div",{role:"button",className:"ui card link",tabIndex:0,onClick:this.handleClick,onKeyDown:s.fireClickOnEnter},o.createElement("div",{className:"imageicon"},o.createElement(s.Icon,{icon:n+" massive"})),o.createElement("div",{className:"content"},o.createElement("span",{className:"header"},t)))},e}(a.Component)},{"./data":44,"./sui":100,react:284}],65:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o,a=pxt.Cloud,s=pxt.Util,l=function(n){function e(e){var t=n.call(this,e)||this;return t.message=e,t}return i(e,n),e}(Error);n.HIDError=l;var c={};function u(e){var t=s.lookup(c,e.result.path);t?t.onOOB(e):console.error("Dropping data for "+e.result.path)}function p(){!function(){if(!o){if(!pxt.BrowserUtils.isLocalHost()||!a.localToken)return;pxt.debug("initializing hid pipe"),o=pxt.worker.makeWebSocket("ws://localhost:"+pxt.options.wsPort+"/"+a.localToken+"/hid",u)}}();var e=!1;pxt.appTarget.serial&&pxt.appTarget.serial.rawHID&&(e=!0);var t=new m(e);return t.initAsync().then(function(){return t})}n.shouldUse=function(){var e=pxt.appTarget.serial;return e&&e.useHF2&&(pxt.BrowserUtils.isLocalHost()&&!!a.localToken||pxt.winrt.isWinRT())},n.mkBridgeAsync=p,pxt.HF2.mkPacketIOAsync=p;var d,f,h,m=function(){function e(e){void 0===e&&(e=!1);var t=this;this.rawMode=e,this.onData=function(e){},this.onEvent=function(e){},this.onError=function(e){},this.onSerial=function(e,t){},e&&(this.onEvent=function(e){return t.onData(e)})}return e.prototype.onOOB=function(e){"serial"==e.op?this.onSerial(s.fromHex(e.result.data),e.result.isError):"event"==e.op&&this.onEvent(s.fromHex(e.result.data))},e.prototype.talksAsync=function(e){return o.opAsync("talk",{path:this.dev.path,cmds:e.map(function(e){return{cmd:e.cmd,data:e.data?s.toHex(e.data):""}})}).then(function(e){return e.map(function(e){return s.fromHex(e.data)})})},e.prototype.error=function(e){throw new l(s.lf("USB/HID error on device {0} ({1})",this.dev.product,e))},e.prototype.reconnectAsync=function(){return this.initAsync()},e.prototype.disconnectAsync=function(){return o.opAsync("disconnect",{path:this.dev.path})},e.prototype.sendPacketAsync=function(e){if(this.rawMode)return o.opAsync("send",{path:this.dev.path,data:s.toHex(e),raw:!0});throw new Error("should use talksAsync()!")},e.prototype.sendSerialAsync=function(e,t){return o.opAsync("sendserial",{path:this.dev.path,data:s.toHex(e),isError:t})},e.prototype.initAsync=function(){var r=this;return o.opAsync("list",{}).then(function(e){var t=e.devices,n=t.filter(function(e){return 16896==(65280&e.release)})[0];if(pxt.appTarget.serial&&pxt.appTarget.serial.rawHID&&(n=t[0]),!n)throw new Error("No device connected");r.dev&&delete c[r.dev.path],r.dev=n,c[r.dev.path]=r}).then(function(){return o.opAsync("init",{path:r.dev.path,raw:r.rawMode})})},e}();n.configureHidSerial=function(e){h=e,d&&(d.onSerial=h)},n.disconnectWrapperAsync=function(){return d?d.disconnectAsync():Promise.resolve()},n.initAsync=function(t){var n;return void 0===t&&(t=!1),f||(f=pxt.HF2.mkPacketIOAsync().then(function(e){return d=new pxt.HF2.Wrapper(e),h&&(d.onSerial=h),d.reconnectAsync(!0).then(function(){return d})}).catch(function(e){return f=null,Promise.reject(e)})),f.then(function(e){return n=e,t?n.reconnectAsync():Promise.resolve()}).then(function(){return n})}},{}],66:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.componentWillReceiveProps=function(e){e.pokeUser!=this.state.show&&this.setState({show:e.pokeUser})},e.prototype.renderCore=function(){return o.createElement("div",{className:"tooltip "+(this.state.show?"show":""),role:"tooltip",onClick:this.props.onClick},this.props.text)},e}(e("./data").Component);n.HintTooltip=a;var s=function(){function e(){this.defaultDuration=15e3,this.defaultDisplayCount=3,this.hints={}}return e.prototype.addHint=function(e,t,n){var r=this;this.hints[e]=pxt.Util.debounce(function(){t(),r.stopPokeUserActivity()},n||this.defaultDuration)},e.prototype.pokeUserActivity=function(e,t){(null==t||t<this.defaultDisplayCount)&&(this.stopPokeUserActivity(),this.timer=this.hints[e]())},e.prototype.stopPokeUserActivity=function(){clearTimeout(this.timer),this.timer=null},e}();n.HintManager=s},{"./data":44,react:284}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("./browserworkspace"),o="texts",a="headers",s="id";function l(){return r?Promise.resolve(r):(r=new pxt.BrowserUtils.IDBWrapper("__pxt_idb_workspace",1,function(e,t){var n=t.result;n.createObjectStore(o,{keyPath:s}),n.createObjectStore(a,{keyPath:s})})).openAsync().catch(function(e){return pxt.reportException(e),Promise.reject(e)}).then(function(){return r})}function c(n,r,i){return l().then(function(e){var t={id:n.id,files:i,_rev:r};return(i?e.setAsync(o,t):Promise.resolve()).then(function(){return e.setAsync(a,n)})})}n.provider={getAsync:function(t){return l().then(function(e){return e.getAsync(o,t.id)}).then(function(e){return Promise.resolve({header:t,text:e.files,version:e._rev})})},setAsync:c,deleteAsync:function(t,e){return l().then(function(e){return e.deleteAsync(o,t.id).then(function(){return e.deleteAsync(a,t.id)})})},listAsync:function(){return l().then(function(e){return e.getAllAsync(a)}).then(function(e){return e.length?Promise.resolve():i.provider.listAsync().then(function(e){return Promise.map(e,function(e){return t=e,i.provider.getAsync(t).then(function(e){return delete t._id,delete t._rev,c(t,void 0,e.text)});var t})}).then(function(){})}).then(function(){return l()}).then(function(e){return e.getAllAsync(a)})},resetAsync:function(){return l().then(function(e){return e.deleteAllAsync(o).then(function(){return e.deleteAllAsync(a)})})}}},{"./browserworkspace":8}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("./memoryworkspace");n.provider={getAsync:function(e){return i.provider.getAsync(e)},setAsync:function(t,e,n){return i.provider.setAsync(t,e,n).then(function(){var e=n||i.projects[t.id]&&i.projects[t.id].text;return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacesave",project:{header:t,text:e},response:!1})}).then(function(){})},listAsync:function(){return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacesync",response:!0}).then(function(e){return(e.projects||[]).forEach(i.merge),r=e.editor,pxt.tickEvent("pxt.controller",{controllerId:e.controllerId}),i.provider.listAsync()})},resetAsync:function(){return i.provider.resetAsync().then(function(){return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacereset",response:!0})}).then(function(){})},loadedAsync:function(){return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspaceloaded",response:!0}).then(function(){})},getSyncState:function(){return r},fireEvent:function(e){pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspaceevent",response:!1,event:e})}}},{"./memoryworkspace":72}],69:[function(e,t,r){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(r,"__esModule",{value:!0});var a=e("react"),s=e("./codecard"),l=e("./sui"),n=e("./data"),c=["en"];r.setInitialLang=function(e){r.initialLang=pxt.Util.normalizeLanguageCode(e)[0]};var u=function(n){function e(e){var t=n.call(this,e)||this;return t.state={visible:!1},t.hide=t.hide.bind(t),t.changeLanguage=t.changeLanguage.bind(t),t.translateEditor=t.translateEditor.bind(t),t}return o(e,n),e.prototype.languageList=function(){return pxt.appTarget.appTheme.selectLanguage&&pxt.appTarget.appTheme.availableLocales&&pxt.appTarget.appTheme.availableLocales.length?pxt.appTarget.appTheme.availableLocales:c},e.prototype.translateEditor=function(){pxt.tickEvent("translate.editor.incontext");var e=window.location.href.indexOf("?")<0?"?":"&";window.location.href=window.location.pathname+(window.location.search||"")+e+"translate=1"+(window.location.hash||"")},e.prototype.changeLanguage=function(e){var t=this;pxt.Util.allLanguages[e]&&(pxt.BrowserUtils.setCookieLang(e),e!==r.initialLang?(pxt.tickEvent("menu.lang.changelang",{lang:e}),pxt.winrt.releaseAllDevicesAsync().then(function(){t.props.parent.reloadEditor()}).done()):(pxt.tickEvent("menu.lang.samelang",{lang:e}),this.hide()))},e.prototype.hide=function(){this.setState({visible:!1})},e.prototype.show=function(){this.setState({visible:!0})},e.prototype.renderCore=function(){var n=this;if(!this.state.visible)return a.createElement("div",null);var e=pxt.appTarget.appTheme,t=this.languageList(),r=4<t.length?"large":"small";return a.createElement(l.Modal,{isOpen:this.state.visible,size:r,onClose:this.hide,dimmer:!0,header:lf("Select Language"),closeIcon:!0,allowResetFocus:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},a.createElement("div",{id:"langmodal"},a.createElement("div",{id:"availablelocales",className:"ui cards centered",role:"listbox"},t.map(function(e){var t=pxt.Util.allLanguages[e];return a.createElement(p,{key:e,langId:e,name:t.localizedName,ariaLabel:t.englishName,description:t.englishName,onClick:n.changeLanguage})})),e.crowdinProject?a.createElement("div",{className:"ui",id:"langmodalfooter"},a.createElement(l.Link,{"aria-label":lf("How do I add a new language?"),href:"/translate",text:lf("How do I add a new language?"),target:"_blank"}),!pxt.BrowserUtils.isIE()&&a.createElement(l.Button,{"aria-label":lf("Translate the editor"),onClick:this.translateEditor,text:lf("Translate the editor")})):void 0))},e}(n.Component);r.LanguagePicker=u;var p=function(n){function e(e){var t=n.call(this,e)||this;return t.handleClick=t.handleClick.bind(t),t}return o(e,n),e.prototype.handleClick=function(){this.props.onClick(this.props.langId)},e.prototype.renderCore=function(){var e=this.props,t=e.name,n=e.ariaLabel,r=e.description;return a.createElement(s.CodeCardView,{className:"card-selected langoption",name:t,ariaLabel:n,role:"link",description:r,onClick:this.handleClick})},e}(l.StatelessUIElement)},{"./codecard":13,"./data":44,"./sui":100,react:284}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("react"),f=e("./package"),i=e("./core"),o=e("./compiler"),a="instructions";function s(d){return(t=d,new Promise(function(r,e){window.addEventListener("message",function e(t){var n=t.data;"ready"==n.type&&n.frameid==a&&(window.removeEventListener("message",e),r())}),t.src=pxt.webConfig.partsUrl+"#"+a})).then(function(){return o.compileAsync({native:!0})}).then(function(e){for(var t=f.mainEditorPkg().header.name||lf("Untitled"),n=pxt.appTarget.simulator.boardDefinition,r=ts.pxtc.computeUsedParts(e).sort(),i=f.mainPkg.computePartDefinitions(r),o=e.usedArguments,a={},s={},l=0,c=e.configData||[];l<c.length;l++){var u=c[l];a[u.key+""]=u.value,s[u.name]=u.key}var p={cfg:a,cfgKey:s};return d.contentWindow.postMessage({type:"instructions",options:{name:t,boardDef:n,parts:r,partDefinitions:i,fnArgs:o,configData:p,print:!0}},"*"),d});var t}n.makeAsync=function(){return i.dialogAsync({header:lf("Make"),size:"large",hideCancel:!0,hasCloseIcon:!0,jsx:r.createElement("div",{className:"ui container"},r.createElement("div",{id:"makecontainer",style:{position:"relative",height:0,paddingBottom:"40%",overflow:"hidden"}},r.createElement("iframe",{id:"makeiframe",frameBorder:"0",sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}}))),onLoaded:function(e){s(e.querySelectorAll("#makeiframe")[0]).done()}}).then(function(e){})}},{"./compiler":14,"./core":41,"./package":81,react:284}],71:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./data"),s=e("marked"),l=function(e){function u(){return null!==e&&e.apply(this,arguments)||this}return i(u,e),u.clearBlockSnippetCache=function(){this.blockSnippetCache={}},u.prototype.getBuiltinMacros=function(){var e={},t=pxt.appTarget.appTheme;return t.boardName&&(e.boardname=pxt.Util.htmlEscape(t.boardName)),t.boardNickname&&(e.boardnickname=pxt.Util.htmlEscape(t.boardNickname)),t.driveDisplayName&&(e.drivename=pxt.Util.htmlEscape(t.driveDisplayName)),t.homeUrl&&(e.homeurl=pxt.Util.htmlEscape(t.homeUrl)),e.targetid=t.id||"???",e.targetname=t.name||"Microsoft MakeCode",e.targetlogo=t.docsLogo?'<img aria-hidden="true" role="presentation" class="ui mini image" src="'+t.docsLogo+'" />':"",e},u.prototype.startRenderLangSnippet=function(e){var t=e.parentElement,n=t.parentElement,r=document.createElement("div");return r.className="ui segment raised loading",n.insertBefore(r,t),n.removeChild(t),r},u.prototype.finishRenderLangSnippet=function(e,t){var n=document.createElement("pre");n.textContent=t,pxt.tutorial.highlight(n),e.appendChild(n),pxsim.U.removeClass(e,"loading")},u.prototype.renderSnippets=function(e){var r=this,i=this.props.parent;pxt.Util.toArray(e.querySelectorAll("code.lang-typescript")).forEach(function(e){var t=e.textContent,n=r.startRenderLangSnippet(e);r.finishRenderLangSnippet(n,t)}),pxt.Util.toArray(e.querySelectorAll("code.lang-spy")).forEach(function(e){var t=e.textContent,n=r.startRenderLangSnippet(e);u.blockSnippetCache[t]?r.finishRenderLangSnippet(n,u.blockSnippetCache[t]):i.renderPythonAsync({type:"pxteditor",action:"renderpython",ts:t}).done(function(e){u.blockSnippetCache[t]=e.python,r.finishRenderLangSnippet(n,u.blockSnippetCache[t])})}),pxt.Util.toArray(e.querySelectorAll("code.lang-blocks")).forEach(function(e){var a=e.textContent,s=document.createElement("div");if(pxsim.U.clear(e),e.appendChild(s),s.className="ui segment raised loading",u.blockSnippetCache[a]){var t=Blockly.utils.xml.textToDomDocument(pxt.blocks.layout.serializeSvgString(u.blockSnippetCache[a]));s.appendChild(t.documentElement),pxsim.U.removeClass(s,"loading")}else i.renderBlocksAsync({type:"pxteditor",action:"renderblocks",ts:a}).done(function(e){var t=e.svg;if(t){var n=t.getAttribute("viewBox").split(" ").map(parseFloat),r=n[2],i=n[3];(480<r||128<i)&&(i=.8*i|0),t.setAttribute("height",i+"px"),pxt.BrowserUtils.isIE()||(u.blockSnippetCache[a]=Blockly.Xml.domToText(t)),s.appendChild(t),pxsim.U.removeClass(s,"loading")}else{var o=document.createElement("span");o.textContent=lf("Oops, something went wrong trying to render this block snippet."),s.appendChild(o),pxsim.U.removeClass(s,"loading")}})}),pxt.Util.toArray(e.querySelectorAll("code.lang-diffblocksxml")).forEach(function(e){var a=e.textContent,t=e.textContent.split(/-{10,}/),s=t[0],l=t[1],c=document.createElement("div");pxsim.U.clear(e),e.appendChild(c),pxt.BrowserUtils.loadBlocklyAsync().then(function(){var e=pxt.blocks.diffXml(s,l),t=e.svg;if(t){if("SVG"==t.tagName){var n=t.getAttribute("viewBox").split(" ").map(parseFloat),r=n[2],i=n[3];(480<r||128<i)&&(i=.8*i|0),t.setAttribute("height",i+"px")}pxt.BrowserUtils.isIE()||(u.blockSnippetCache[a]=Blockly.Xml.domToText(t)),c.appendChild(t),pxsim.U.removeClass(c,"loading")}else{var o=document.createElement("div");o.className="ui basic segment",o.textContent=e.message||lf("No changes."),c.appendChild(o),pxsim.U.removeClass(c,"loading")}})})},u.prototype.renderInlineBlocks=function(e){pxt.Util.toArray(e.querySelectorAll(":not(pre) > code")).forEach(function(e){var t=e.innerText,n=/^(\|+)([^\|]+)\|+$/.exec(t);if(n){var r=/^(([^\:\.]*?)[\:\.])?(.*)$/.exec(n[2]),i=r[2]?r[2].trim().toLowerCase():"",o=r[3].trim(),a=1==n[1].length?"docs inlinebutton ui button "+pxt.Util.htmlEscape(o.toLowerCase())+"-button":"docs inlineblock "+pxt.Util.htmlEscape(i),s=document.createElement("span");pxsim.U.clear(e),e.appendChild(s),s.className=a,s.textContent=pxt.U.rlf(o)}})},u.prototype.renderOthers=function(e){pxt.Util.toArray(e.querySelectorAll(".lang-package,.lang-config")).forEach(function(e){e.parentNode.removeChild(e)})},u.prototype.renderMarkdown=function(e){var t=this.refs["marked-content"],n=this.getBuiltinMacros();e=e.replace(/@([a-z]+)@/gi,function(e,t){return n[t]||"unknown macro"});var r=new s.Renderer;pxt.docs.setupRenderer(r),s.setOptions({renderer:r,sanitize:!0}),t.innerHTML=s(e),this.renderInlineBlocks(t),this.renderSnippets(t),this.renderOthers(t)},u.prototype.componentDidMount=function(){var e=this.props.markdown;this.renderMarkdown(e)},u.prototype.componentWillReceiveProps=function(e){var t=e.markdown;this.props.markdown!=e.markdown&&this.renderMarkdown(t)},u.prototype.renderCore=function(){var e=this.props.className;return o.createElement("div",{ref:"marked-content",className:e||""})},u.blockSnippetCache={},u}(a.Component);n.MarkedContent=l},{"./data":44,marked:207,react:284}],72:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=pxt.Util;r.projects={},r.merge=function(e){var t=e.header;t||(e.header=t=pxt.workspace.freshHeader(lf("Untitled"),n.nowSeconds()),e.text&&e.text["main.blocks"]&&(e.header.editor=pxt.BLOCKS_PROJECT_NAME)),r.projects[e.header.id]=e},r.provider={getAsync:function(e){var t=r.projects[e.id];return Promise.resolve({header:e,text:t?t.text:{},version:null})},setAsync:function(e,t,n){return n&&(r.projects[e.id]={header:e,text:n}),Promise.resolve()},deleteAsync:function(e,t){return delete r.projects[e.id],Promise.resolve()},listAsync:function(){return Promise.resolve(n.values(r.projects).map(function(e){return e.header}))},resetAsync:function(){return r.projects={},Promise.resolve()}}},{}],73:[function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("react"),s=e("react-dom"),p=e("./package"),d=e("./core"),i=e("./toolboxeditor"),_=e("./compiler"),l=e("./sui"),f=e("./monacoSnippets"),c=e("./monacopyhelper"),u=e("./simulator"),h=e("./toolbox"),w=e("./workspace"),m=e("./blocklyFieldView"),g=e("./monacoFieldEditorHost"),v=pxt.Util,y=e("./monacoDebugger"),b=e("./debuggerToolbox"),k=e("./monacoEditAmendments"),x=function(){function e(e,t){this.editor=e,this.python=t,this.triggerCharacters=["."],this.kindMap={}}return e.prototype.tsKindToMonacoKind=function(e){switch(e){case 1:return monaco.languages.CompletionItemKind.Method;case 2:return monaco.languages.CompletionItemKind.Property;case 3:return monaco.languages.CompletionItemKind.Function;case 4:return monaco.languages.CompletionItemKind.Variable;case 5:return monaco.languages.CompletionItemKind.Module;case 6:return monaco.languages.CompletionItemKind.Class;case 7:return monaco.languages.CompletionItemKind.Enum;case 8:return monaco.languages.CompletionItemKind.Class;case 9:return monaco.languages.CompletionItemKind.Interface;default:return monaco.languages.CompletionItemKind.Text}},e.prototype.provideCompletionItems=function(e,t,n){var p=this,r=e.getOffsetAt(t),i=e.getValue(),o=this.editor.currFile.name;return _.completionsAsync(o,r,i).then(function(u){return(u.entries||[]).map(function(e,t){var n,r=p.python?e.pySnippet:e.snippet,i=p.python?e.pyQName:e.qName,o=p.python?e.pyName:e.name,a=r&&0<=r.indexOf("\n");p.python&&r&&a?n=k.amendmentToInsertSnippet(k.createLineReplacementPyAmendment(r)):(n=r,u.isMemberCompletion&&n.startsWith(i)&&(n=n.replace(i,o)));var s=u.isMemberCompletion?o:i,l=pxt.Util.rlf(e.attributes.jsDoc),c=pxt.Util.rlf(e.attributes.block);return{label:s,kind:p.tsKindToMonacoKind(e.kind),documentation:l,detail:r,sortText:("000"+t).slice(-4)+" "+r,filterText:s+" "+l+" "+c,insertText:n}})})},e.prototype.resolveCompletionItem=function(e,t){return e},e}(),E=function(){function e(e,t){this.editor=e,this.python=t,this.signatureHelpTriggerCharacters=["(",","],this.isPython=!1,this.isPython=t}return e.prototype.provideSignatureHelp=function(e,t,n){var i=this,r=e.getOffsetAt(t),o=e.getValue(),a=this.editor.currFile.name;return _.syntaxInfoAsync("signature",a,r,o).then(function(e){var t=e.symbols?e.symbols[0]:null;if(!t||!t.parameters)return null;var n=pxt.Util.rlf(t.attributes.jsDoc),r=t.parameters.map(function(e){return{label:e.name+": "+(i.isPython?e.pyTypeString:e.type),documentation:pxt.Util.rlf(e.description)}});return{signatures:[{label:(i.isPython&&t.pyName?t.pyName:t.name)+"("+r.map(function(e){return e.label}).join(", ")+")",documentation:n,parameters:r}],activeSignature:0,activeParameter:e.auxResult}})},e}(),C=function(){function e(e,t){this.editor=e,this.python=t}return e.prototype.provideHover=function(r,e,t){var n=r.getOffsetAt(e),i=r.getValue(),o=this.editor.currFile.name;return _.syntaxInfoAsync("symbol",o,n,i).then(function(e){var t=e.symbols?e.symbols[0]:null;if(!t)return null;var n=pxt.Util.rlf(t.attributes.jsDoc);return{contents:["**"+t.pyQName+"**",n],range:monaco.Range.fromPositions(r.getPositionAt(e.beginPos),r.getPositionAt(e.endPos))}})},e}(),S={comments:{lineComment:"#",blockComment:['"""','"""']},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:'r"',close:'"',notIn:["string","comment"]},{open:'R"',close:'"',notIn:["string","comment"]},{open:'u"',close:'"',notIn:["string","comment"]},{open:'U"',close:'"',notIn:["string","comment"]},{open:'f"',close:'"',notIn:["string","comment"]},{open:'F"',close:'"',notIn:["string","comment"]},{open:'b"',close:'"',notIn:["string","comment"]},{open:'B"',close:'"',notIn:["string","comment"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"r'",close:"'",notIn:["string","comment"]},{open:"R'",close:"'",notIn:["string","comment"]},{open:"u'",close:"'",notIn:["string","comment"]},{open:"U'",close:"'",notIn:["string","comment"]},{open:"f'",close:"'",notIn:["string","comment"]},{open:"F'",close:"'",notIn:["string","comment"]},{open:"b'",close:"'",notIn:["string","comment"]},{open:"B'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string"]}],onEnterRules:[{beforeText:/^\s*(?:def|class|for|if|elif|else|while|try|with|finally|except|async).*?:\s*$/,action:{indentAction:1}}]},T=function(){function e(e,t){this.editor=e,this.python=t,this.isPython=!1,this.isPython=t}return e.prototype.provideDocumentRangeFormattingEdits=function(t,n,r,i){var o=this;return Promise.resolve().then(function(e){return o.isPython?c.provideDocumentRangeFormattingEdits(t,n,r,i):null})},e}(),A={cpp:"cpp",h:"cpp",json:"json",md:"markdown",py:"python",ts:"typescript",js:"javascript",svg:"xml",blocks:"xml",asm:"asm"},N=function(i){function e(){var o=null!==i&&i.apply(this,arguments)||this;return o.fileType="text",o.giveFocusOnLoading=!1,o.foldFieldEditorRanges=!0,o.hasFieldEditors=!(!pxt.appTarget.appTheme.monacoFieldEditors||!pxt.appTarget.appTheme.monacoFieldEditors.length),o.highlightDecorations=[],o.handleFlyoutScroll=function(e){return e.stopPropagation()},o.dragCurrentPos={x:0,y:0},o.onDragBlockThrottled=v.throttle(function(){var e=o.dragCurrentPos,t=e.x,n=e.y,r=o.editor.getTargetAtClientPoint(t,n);r&&r.position&&o.editor.getPosition()!=r.position&&o.editor.setPosition(r.position),o.editor.focus()},200),o.updateFieldEditors=pxt.Util.debounce(function(){if(o.hasFieldEditors&&o.editor&&!pxt.shell.isReadOnly()&&!o.isDebugging()){var i=o.editor.getModel();o.fieldEditors.clearRanges(o.editor),o.fieldEditors.allFieldEditors().forEach(function(n){var e=n.matcher,r=[];i.findMatches(e.searchString,!0,e.isRegex,e.matchCase,e.matchWholeWord?o.editor.getConfiguration().wordSeparators:null,!1).forEach(function(e){var t=e.range.startLineNumber;r.push({range:new monaco.Range(t,i.getLineMinColumn(t),t,i.getLineMaxColumn(t)),options:{glyphMarginClassName:n.glyphCssClass}}),o.fieldEditors.trackRange(n.id,t,e.range)}),o.fieldEditors.setDecorations(n.id,o.editor.deltaDecorations([],r))}),o.foldFieldEditorRanges&&o.foldFieldEditorRangesAsync()}},200),o.revealBreakpointLocation=function(e,t){if(o.breakpoints){var n=o.breakpoints.getLocationOfBreakpoint(e);n&&(o.highlightedBreakpoint=e,o.currFile.getTypeScriptName()!==n.fileName?(p.mainEditorPkg(),I(n.fileName)&&o.parent.setFile(I(n.fileName))):o.highilightStatementCore(n,!0),o.debuggerToolbox&&o.debuggerToolbox.setState({currentFrame:t}))}},o.uniqueBlockId=0,o.handleToolboxRef=function(e){o.toolbox=e},o.handleDebugToolboxRef=function(e){e&&(o.debuggerToolbox=e,o.isDebugging()&&o.updateToolbox())},o}return o(e,i),e.prototype.hasBlocks=function(){if(!this.currFile)return!0;var e=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME);return e&&null!=p.mainEditorPkg().files[e]},e.prototype.openBlocks=function(){var u=this;pxt.tickEvent("typescript.showBlocks");var e=Promise.resolve();if(!this.currFile){var t=p.mainEditorPkg();if(!t||!t.files["main.ts"])return;e=this.loadFileAsync(t.files["main.ts"])}var n=e.then(function(){var e="python"==u.fileType,r=e?"python":"typescript";pxt.tickEvent(r+".convertBlocks");var i=p.mainEditorPkg();if(u.hasBlocks()||i||i.files["main.blocks"]){u.feWidget&&(u.feWidget.close(),u.activeRangeID=null);var o=u.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),n=e?u.currFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME):u.currFile.name;if(!u.hasBlocks()){if(!i||!i.files["main.blocks"])return void(i&&u.parent.setFile(i.files["main.ts"]));u.currFile=i.files["main.ts"],o=u.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),n="main.ts"}var a,s,l,c=function(e,t){return void 0===t&&(t=!1),d.cancelAsyncLoading("switchtoblocks"),u.forceDiagnosticsUpdate(),u.showBlockConversionFailedDialog(e,t)};return u.saveToTypeScriptAsync().then(function(){return u.parent.saveFileAsync()}).then(function(){return u.parent.loadBlocklyAsync()}).then(function(){return _.getBlocksAsync()}).then(function(e){s=e,pxt.blocks.initializeAndInject(s);var n=pxt.blocks.loadWorkspaceXml(i.files[o].content);return n?pxt.blocks.compileAsync(n,s).then(function(e){l=e.generatedVarDeclarations;var t=e.source;return _.formatAsync(t,0).then(function(t){return _.formatAsync(u.editor.getValue(),0).then(function(e){return t.formatted==e.formatted?(pxt.debug(r+" not changed, skipping decompile"),pxt.tickEvent(r+".noChanges"),u.parent.setFile(i.files[o]),[n,!1]):[n,!0]})})}):[n,!0]}).then(function(e){if(!e)return Promise.resolve();var t=e[0];return e[1]?_.compileAsync().then(function(e){return e.success?_.decompileAsync(n,s,t,o,l).then(function(e){if(!e.success){u.currFile.diagnostics=e.diagnostics;var t=!1;return e.diagnostics.forEach(function(e){return t=t||9266===e.code}),c(o,t)}return a=e.outfiles[o],v.assert(!!a),i.setContentAsync(o,a).then(function(){return u.parent.setFile(i.files[o])})}):c(o,!1)}):Promise.resolve()}).catch(function(e){pxt.reportException(e),d.errorNotification(lf("Oops, something went wrong trying to convert your code."))})}pxt.debug("cancelling convertion to blocks, but main.blocks is missing")});d.showLoadingAsync("switchtoblocks",lf("switching to blocks..."),n).done()},e.prototype.showBlockConversionFailedDialog=function(e,t){var n,r,i=this,o="python"==this.fileType,a=o?"python":"typescript",s=p.mainEditorPkg().files[e];return t&&pxt.tickEvent(a+".programTooLarge"),o?(n=t?lf("Your program is too large to convert into blocks. You can keep working in Python or discard your changes and go back to the previous Blocks version."):lf("We are unable to convert your Python code back to blocks. You can keep working in Python or discard your changes and go back to the previous Blocks version."),r=lf("Stay in Python")):(n=t?lf("Your program is too large to convert into blocks. You can keep working in JavaScript or discard your changes and go back to the previous Blocks version."):lf("We are unable to convert your JavaScript code back to blocks. You can keep working in JavaScript or discard your changes and go back to the previous Blocks version."),r=lf("Stay in JavaScript")),d.confirmAsync({header:t?lf("Program too large"):lf("Oops, there is a problem converting your code."),body:n,agreeLbl:lf("Discard and go to Blocks"),agreeClass:"cancel",agreeIcon:"cancel",disagreeLbl:r,disagreeClass:"positive",disagreeIcon:"checkmark",hideCancel:!s}).then(function(e){e?(pxt.tickEvent(a+".discardText",void 0,{interactiveConsent:!0}),i.parent.saveBlocksToTypeScriptAsync().then(function(e){i.overrideFile(e),i.parent.setFile(s)})):pxt.tickEvent(a+".keepText",void 0,{interactiveConsent:!0})})},e.prototype.decompileAsync=function(e){return _.decompileAsync(e)},e.prototype.display=function(){return a.createElement("div",{id:"monacoEditorArea",className:"full-abs",style:{direction:"ltr"}},this.isVisible&&a.createElement("div",{className:"monacoToolboxDiv "+(!this.toolbox||this.toolbox.state.visible||this.isDebugging()?"":"invisible")},a.createElement(h.Toolbox,{ref:this.handleToolboxRef,editorname:"monaco",parent:this}),a.createElement("div",{id:"monacoDebuggerToolbox"})),a.createElement("div",{id:"monacoEditorInner",style:{float:"right"}}))},e.prototype.showPackageDialog=function(){pxt.tickEvent("monaco.addpackage",void 0,{interactiveConsent:!0}),this.hideFlyout(),this.parent.showPackageDialog()},e.prototype.defineEditorTheme=function(e,t){var i=this,n=pxt.appTarget.appTheme.invertedMonaco,r=.6,o=[];if(!e&&t){var a={};this.getNamespaces().forEach(function(e){var t=i.getNamespaceAttrs(e),n=f.isBuiltin(e)?f.getBuiltinCategory(e).blocks.concat(i.nsMap[e]||[]):i.nsMap[e];if(t.color&&n){var r=p(t.color);n.forEach(function(e){o.push({token:"identifier.ts "+e.name,foreground:r})}),o.push({token:"identifier.ts "+e,foreground:r}),a[e]=t.color}}),o.push({token:"identifier.ts if",foreground:"5B80A5"}),o.push({token:"identifier.ts else",foreground:"5B80A5"}),o.push({token:"identifier.ts while",foreground:"5BA55B"}),o.push({token:"identifier.ts for",foreground:"5BA55B"});var s=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;if(s){var l=s.callName||"pauseUntil",c=s.color||a[s.category];c&&o.push({token:"identifier.ts "+l,foreground:p(c)})}}var u=pxt.appTarget.appTheme.monacoColors||{};function p(e){return e=pxt.toolbox.convertColor(e),(n?pxt.toolbox.fadeColor(e,r,!0):e).replace("#","")}monaco.editor.defineTheme("pxtTheme",{base:e?"hc-black":n?"vs-dark":"vs",inherit:!0,rules:o,colors:e?{}:u}),monaco.editor.setTheme("pxtTheme")},e.prototype.saveToTypeScriptAsync=function(){return"python"==this.fileType?this.convertPythonToTypeScriptAsync():Promise.resolve(void 0)},e.prototype.convertPythonToTypeScriptAsync=function(){if(!this.currFile)return Promise.resolve(void 0);var t=this.currFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME);return _.py2tsAsync().then(function(e){if(!e.diagnostics||!e.diagnostics.length)return e.outfiles[t]?e.outfiles[t]:""})},e.prototype.setHighContrast=function(e){this.loadMonacoPromise&&this.defineEditorTheme(e,!0)},e.prototype.beforeCompile=function(){},e.prototype.isIncomplete=function(){return!(!this.editor||!this.editor._view)&&this.editor._view.contentWidgets._widgets["editor.widget.suggestWidget"].isVisible},e.prototype.resize=function(e){var t=document.getElementById("monacoEditorArea");if(t){var n=t.getElementsByClassName("monacoToolboxDiv")[0];if(t&&this.editor){var r=n&&n.offsetWidth||0,i=this.editor._themeService._theme.colors["editor.background"].rgba,o=this.parent.isJavaScriptActive()?this.parent.updateEditorLogo(r,"rgba("+i.r+","+i.g+","+i.b+","+i.a+")"):0;this.editor.layout({width:t.offsetWidth-r,height:t.offsetHeight-o});var a=this.editor.getDomNode().getBoundingClientRect();m.setEditorBounds({top:a.top,left:a.left,width:t.offsetWidth-r,height:a.height}),n&&(n.style.height="100%")}}},e.prototype.prepare=function(){this.isReady=!0},e.prototype.loadMonacoAsync=function(){return this.loadMonacoPromise||(this.loadMonacoPromise=this.createLoadMonacoPromise()),this.loadMonacoPromise},e.prototype.createLoadMonacoPromise=function(){var i=this;this.extraLibs=Object.create(null);var r=document.getElementById("monacoEditorArea"),e=document.getElementById("monacoEditorInner");return pxt.vs.initMonacoAsync(e).then(function(t){if(i.editor=t,i.editor.updateOptions({fontSize:i.parent.settings.editorFontSize}),i.editor.addAction({id:"save",label:lf("Save"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_S],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.2,run:function(){return Promise.resolve(i.parent.typecheckNow())}}),i.editor.addAction({id:"runSimulator",label:lf("Run Simulator"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.21,run:function(){return Promise.resolve(i.parent.runSimulator())}}),pxt.appTarget.compile&&pxt.appTarget.compile.hasHex&&i.editor.addAction({id:"compileHex",label:lf("Download"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.Enter],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.22,run:function(){return Promise.resolve(i.parent.compile())}}),i.editor.addAction({id:"zoomIn",label:lf("Zoom In"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.NUMPAD_ADD,monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_EQUAL],run:function(){return Promise.resolve(i.zoomIn())}}),i.editor.addAction({id:"zoomOut",label:lf("Zoom Out"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.NUMPAD_SUBTRACT,monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_MINUS],run:function(){return Promise.resolve(i.zoomOut())}}),pxt.appTarget.appTheme.hasReferenceDocs){var n=i.editor.createContextKey("editorHasReference",!1);i.editor.addAction({id:"reference",label:lf("Help"),keybindingContext:"!editorReadonly && editorHasReference",precondition:"!editorReadonly && editorHasReference",contextMenuGroupId:"navigation",contextMenuOrder:.1,run:function(){return Promise.resolve(i.loadReference())}}),i.editor.onDidChangeCursorPosition(function(e){var t=i.editor.getModel().getWordUntilPosition(e.position);t&&""!=t.word?n.set(!0):n.reset()})}i.editor.addAction({id:"jumptoolbox",label:lf("Jump to Toolbox"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KEY_T],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",run:function(){return Promise.resolve(i.moveFocusToToolbox())}}),i.editor.onDidLayoutChange(function(e){var t=i.editor.getConfiguration().fontInfo.fontSize;i.parent.settings.editorFontSize!=t&&(i.parent.settings.editorFontSize=t,i.forceDiagnosticsUpdate());var n=document.getElementById("monacoToolboxDiv");n&&(n.style.height=i.editor.getLayoutInfo().contentHeight+"px");var r=document.getElementById("monacoFlyoutWidget");r&&(r.style.height=i.editor.getLayoutInfo().contentHeight+"px")});var e=document.getElementById("monacoEditorInner");e.ondragenter=function(e){e.preventDefault(),e.stopPropagation()},e.ondragover=function(e){e.preventDefault(),e.stopPropagation(),i.dragCurrentPos={x:e.clientX,y:e.clientY},i.onDragBlockThrottled(e)},e.ondrop=function(n){var e=n.dataTransfer.getData("text");e&&(n.preventDefault(),n.stopPropagation(),(e.startsWith("qName:")?_.snippetAsync(e.substring("qName:".length),"python"==i.fileType):Promise.resolve(e)).done(function(e){var t=i.editor.getTargetAtClientPoint(n.clientX,n.clientY).position;i.insertSnippet(t,e)}))},i.editor.onDidFocusEditorText(function(){i.hideFlyout()}),monaco.languages.registerCompletionItemProvider("python",new x(i,!0)),monaco.languages.registerSignatureHelpProvider("python",new E(i,!0)),monaco.languages.registerHoverProvider("python",new C(i,!0)),monaco.languages.registerDocumentRangeFormattingEditProvider("python",new T(i,!0)),monaco.languages.setLanguageConfiguration("python",S),i.editorViewZones=[],i.setupToolbox(r),i.setupFieldEditors(),t.onDidChangeModelContent(function(e){i.fieldEditors&&i.fieldEditors.clearRanges(t)})})},e.prototype.insertSnippet=function(e,t){var n=this.editor.getPosition(),r=this.editor.getModel();e||(e=n),t+="\n",e.lineNumber++,e.column=1,e.lineNumber<r.getLineCount()&&r.getLineContent(e.lineNumber)&&(t="\n"+t),this.editor.pushUndoStop(),this.editor.executeEdits("",[{identifier:{major:0,minor:0},range:new monaco.Range(e.lineNumber,e.column,e.lineNumber,e.column),text:t||"",forceMoveMarkers:!0,isAutoWhitespaceEdit:!0}]),this.beforeCompile(),this.editor.pushUndoStop(),this.editor.focus()},e.prototype.undo=function(){this.editor&&this.editor.trigger("keyboard","undo",null)},e.prototype.redo=function(){this.editor&&this.editor.trigger("keyboard","redo",null)},e.prototype.zoomIn=function(){if(this.editor&&!(40<=this.parent.settings.editorFontSize)){var e=this.editor.getConfiguration().fontInfo.fontSize;this.parent.settings.editorFontSize=e+1,this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.forceDiagnosticsUpdate()}},e.prototype.zoomOut=function(){if(this.editor&&!(this.parent.settings.editorFontSize<=10)){var e=this.editor.getConfiguration().fontInfo.fontSize;this.parent.settings.editorFontSize=e-1,this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.forceDiagnosticsUpdate()}},e.prototype.loadReference=function(){v.assert(null!=this.editor);var e=this.editor.getPosition(),t=this.editor.getModel().getWordAtPosition(e);if(t){var n=this.editor.getModel().getWordUntilPosition(new monaco.Position(e.lineNumber,t.startColumn-1));if(n&&t){var r=n.word.replace(/([A-Z]+)/g,"-$1"),i=t.word.replace(/([A-Z]+)/g,"-$1");this.parent.setSideDoc("/reference/"+r+"/"+i,!1)}else t&&(i=t.word.replace(/([A-Z]+)/g,"-$1"),this.parent.setSideDoc("/reference/"+i,!1))}},e.prototype.setupToolbox=function(e){var t={domNode:null,getId:function(){return"pxt.flyout.widget"},getDomNode:function(){return this.domNode||(this.domNode=document.createElement("div"),this.domNode.id="monacoFlyoutWidget",this.domNode.style.top="0",this.domNode.className="monacoFlyout",this.domNode.style.display="none",this.domNode.textContent="Flyout"),this.domNode},getPosition:function(){return null}};this.editor.addOverlayWidget(t)},e.prototype.setupFieldEditors=function(){var n=this;this.hasFieldEditors&&!pxt.shell.isReadOnly()&&(this.fieldEditors||(this.fieldEditors=new g.FieldEditorManager),pxt.appTarget.appTheme.monacoFieldEditors.forEach(function(e){var t=pxt.editor.getMonacoFieldEditor(e);t?n.fieldEditors.addFieldEditor(t):pxt.debug("Skipping unknown monaco field editor '"+e+"'")}),this.editor.onMouseDown(function(e){e.target.type===monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN&&n.handleGutterClick(e)}))},e.prototype.closeFlyout=function(){this.editor&&this.hideFlyout()},e.prototype.hideFlyout=function(){var e=document.getElementById("monacoFlyoutWidget");e&&(pxsim.U.clear(e),e.style.display="none",e.removeEventListener("wheel",this.handleFlyoutScroll,!0)),this.toolbox&&this.toolbox.clearSelection(),this.parent.setState({hideEditorFloats:!1})},e.prototype.updateToolbox=function(){pxt.appTarget.appTheme.monacoToolbox&&!pxt.shell.isReadOnly()&&this.editor&&(this.editor.layout(),this.toolbox&&(this.toolbox.setState({loading:!1,categories:this.getAllCategories(),showSearchBox:this.shouldShowSearch()}),this.shouldShowToolbox()?this.toolbox.show():this.toolbox.hide()),this.updateDebuggerToolbox())},e.prototype.updateDebuggerToolbox=function(){var e=document.getElementById("monacoDebuggerToolbox");if(e&&this.blockInfo){var t=this.isDebugging()?a.createElement(b.DebuggerToolbox,{ref:this.handleDebugToolboxRef,parent:this.parent,apis:this.blockInfo.apis.byQName,openLocation:this.revealBreakpointLocation,showCallStack:!0}):null;s.render(t,e)}},e.prototype.getFoldingController=function(){return this.editor.getContribution("editor.contrib.folding")},e.prototype.getId=function(){return"monacoEditor"},e.prototype.getViewState=function(){return this.editor?this.editor.getPosition():{}},e.prototype.getCurrentSource=function(){return this.editor?this.editor.getValue():this.currSource},e.prototype.acceptsFile=function(e){return!0},e.prototype.setValue=function(e){this.editor.setValue(e)},e.prototype.overrideFile=function(e){v.assert(null!=this.editor),this.editor.setValue(e)},e.prototype.shouldShowToolbox=function(){var e=!this.currFile||this.currFile.isReadonly()||pxt.shell.isReadOnly()||this.isDebugging();return pxt.appTarget.appTheme.monacoToolbox&&!e&&("typescript"==this.fileType&&"main.ts"==this.currFile.name||pxt.appTarget.appTheme.pythonToolbox&&"python"==this.fileType&&"main.py"==this.currFile.name)},e.prototype.loadFileAsync=function(o,a){var s=this,l="text";this.currSource=o.content;var e=document.createElement("div");e.className="ui inverted loading dimmer active";var t=document.getElementById("monacoEditorArea"),n=document.getElementById("monacoEditorInner");return t.insertBefore(e,n),this.loadMonacoAsync().then(function(){if(s.editor){s.foldFieldEditorRanges=!0,s.updateFieldEditors();var e=o.getExtension();A.hasOwnProperty(e)&&(l=A[e]),s.fileType=l;var t=o.isReadonly()||pxt.shell.isReadOnly()||s.isDebugging();s.editor.updateOptions({readOnly:t});var n="pkg:"+o.getName(),r=monaco.editor.getModels().filter(function(e){return e.uri.toString()==n})[0];if(r||(r=monaco.editor.createModel(p.mainPkg.readFile(o.getName()),l,monaco.Uri.parse(n))),r&&s.editor.setModel(r),s.defineEditorTheme(a),s.currFile=o,s.shouldShowToolbox()?s.beginLoadToolbox(o,a):s.toolbox&&s.toolbox.hide(),s.setValue(o.content),s.setDiagnostics(o,s.snapshotState()),s.breakpoints){s.breakpoints.loadBreakpointsForFile(o,s.editor);var i=s.breakpoints.getLocationOfBreakpoint(s.highlightedBreakpoint);i&&i.fileName===o.getTypeScriptName()&&s.highilightStatementCore(i,!0)}"markdown"==s.fileType&&s.parent.setSideMarkdown(o.content),s.currFile.setForceChangeCallback(function(e,t){e!=t&&(pxt.debug("File changed (from "+e+", to "+t+"). Reloading editor"),s.loadFileAsync(s.currFile))}),o.isReadonly()||r.onDidChangeContent(function(e){s.clearHighlightedStatements();var n=s.editorViewZones||[];s.editor.changeViewZones(function(t){n.forEach(function(e){t.removeZone(e)})}),s.editorViewZones=[],e.isRedoing||e.isUndoing||s.editor.getValue()||s.editor.setValue(" "),s.updateDiagnostics(),s.changeCallback(),s.updateFieldEditors()}),s.resize(),s.hideFlyout(),s.extensions=p.allEditorPkgs().map(function(e){return e.getKsPkg()}).filter(function(e){return!!e&&e.config&&!!e.config.extension&&/^(file:|github:)/.test(e.installedVersion)}),s.giveFocusOnLoading&&s.editor.focus(),"python"===s.fileType&&(s.editAmendmentsListener=k.listenForEditAmendments(s.editor))}}).finally(function(){t.removeChild(e)})},e.prototype.unloadFileAsync=function(){return this.toolbox&&this.toolbox.clearSearch(),this.currFile&&this.currFile.getName()=="this/"+pxt.CONFIG_NAME?this.parent.reloadHeaderAsync():(this.editAmendmentsListener&&(this.editAmendmentsListener.dispose(),this.editAmendmentsListener=void 0),Promise.resolve())},e.prototype.beginLoadToolbox=function(t,n){var r=this;this.toolbox&&this.toolbox.showLoading(),_.getBlocksAsync().then(function(e){r.blockInfo=e,r.nsMap=r.partitionBlocks(),r.updateToolbox(),pxt.vs.syncModels(p.mainPkg,r.extraLibs,t.getName(),t.isReadonly()),r.defineEditorTheme(n,!0)})},e.prototype.snapshotState=function(){return this.editor&&this.editor.getModel()?this.editor.getModel().getLinesContent():null},e.prototype.setViewState=function(e){this.editor&&e&&0!==Object.keys(e).length&&(this.editor.setPosition(e),this.editor.setScrollPosition({scrollTop:this.editor.getTopForLineNumber(e.lineNumber)}))},e.prototype.setBreakpointsMap=function(e){this.isDebugging()?(this.breakpoints||(this.breakpoints=new y.BreakpointCollection(e),this.breakpoints.loadBreakpointsForFile(this.currFile,this.editor)),this.fieldEditors&&this.fieldEditors.clearRanges(this.editor),this.feWidget&&this.feWidget.close(),this.editor&&this.editor.updateOptions({readOnly:!0})):(this.editor&&this.editor.updateOptions({readOnly:pxt.shell.isReadOnly()||this.currFile&&this.currFile.isReadonly()}),this.breakpoints&&(this.breakpoints.dispose(),this.breakpoints=void 0),this.updateFieldEditors())},e.prototype.setDiagnostics=function(e,t){v.assert(null!=this.editor),v.assert(this.currFile==e),this.diagSnapshot=t,this.forceDiagnosticsUpdate()},e.prototype.updateDiagnostics=function(){this.needsDiagUpdate()&&this.forceDiagnosticsUpdate()},e.prototype.getBreakpoints=function(){return this.breakpoints?this.breakpoints.getActiveBreakpoints():[]},e.prototype.sendBreakpoints=function(){this.breakpoints&&u.driver.setBreakpoints(this.getBreakpoints())},e.prototype.needsDiagUpdate=function(){if(!this.annotationLines)return!1;for(var e=this.editor.getModel().getLinesContent(),t=0,n=this.annotationLines;t<n.length;t++){var r=n[t];if(this.diagSnapshot[r]!==e[r])return!0}return!1},e.prototype.forceDiagnosticsUpdate=function(){if("typescript"==this.fileType||"python"==this.fileType){var e=this.currFile,i=[];if(e&&e.diagnostics){for(var o=monaco.editor.getModel(monaco.Uri.parse("pkg:"+e.getName())),t=function(t){var e=function(e){i.push({severity:monaco.Severity.Error,message:e,startLineNumber:t.line+1,startColumn:t.column+1,endLineNumber:null==t.endLine?n.lineNumber:t.endLine+1,endColumn:null==t.endColumn?n.column:t.endColumn})},n=o.getPositionAt(t.start+t.length);if("string"==typeof t.messageText)e(t.messageText);else for(var r=t.messageText;null!=r.next;)e(r.messageText),r=r.next},n=0,r=e.diagnostics;n<r.length;n++)t(r[n]);monaco.editor.setModelMarkers(o,"typescript",i)}}},e.prototype.showFieldEditor=function(e,t,n){var r=this;this.feWidget&&this.feWidget.close(),this.feWidget=new g.ModalEditorHost(t,e,this.editor.getModel()),this.feWidget.showAsync(this.fileType,this.editor).then(function(e){r.activeRangeID=null,e&&r.editModelAsync(e.range,e.replacement).then(function(e){return r.indentRangeAsync(e)})})},e.prototype.foldFieldEditorRangesAsync=function(){var n=this;if(this.foldFieldEditorRanges){this.foldFieldEditorRanges=!1;var r,e=this.editor.getSelection();return Promise.mapSeries(this.fieldEditors.allRanges(),function(e){return n.indentRangeAsync(e.range)}).then(function(e){if(e&&e.length){r=e.map(O),n.editor.setSelections(r);var t=n.getFoldingController();t.onModelChanged(),t.foldUnfoldRecursively(!0)}}).then(function(){return n.editor.setSelection(e)})}return Promise.resolve()},e.prototype.highlightStatement=function(e,t){if(!e)return this.clearHighlightedStatements(),this.debuggerToolbox&&this.debuggerToolbox.setBreakpoint(null),!1;if(!this.editor)return!1;if(this.currFile.getTypeScriptName()!==e.fileName&&this.isDebugging()&&I(e.fileName))this.parent.setFile(I(e.fileName));else if(!this.highilightStatementCore(e,!!t))return!1;return this.highlightedBreakpoint=t.breakpointId,t&&this.isDebugging()&&this.debuggerToolbox&&(this.debuggerToolbox.setBreakpoint(t),this.resize()),!0},e.prototype.highilightStatementCore=function(e,t){void 0===t&&(t=!1);var n=this.editor.getModel().getPositionAt(e.start),r=this.editor.getModel().getPositionAt(e.start+e.length);return!(!n||!r||(this.highlightDecorations=this.editor.deltaDecorations(this.highlightDecorations,[{range:new monaco.Range(n.lineNumber,n.column,r.lineNumber,r.column),options:{inlineClassName:"highlight-statement"}}]),t&&this.editor.revealPositionInCenter(n),0))},e.prototype.clearHighlightedStatements=function(){this.editor&&this.highlightDecorations&&this.editor.deltaDecorations(this.highlightDecorations,[])},e.prototype.partitionBlocks=function(){var r=this,i={};this.topBlocks=[];var o=f.allBuiltinBlocksByName(),n=this;function a(e,t){n.subcategoryMap[e]||(n.subcategoryMap[e]={}),n.subcategoryMap[e][t]=!0}if(this.blockInfo.blocks.forEach(function(e){var t=(e.attributes.blockNamespace||e.namespace).split(".")[0];if(!o[e.qName]){i[t]||(i[t]=[]),i[t].push(e);var n=e.attributes.subcategory;e.attributes.advanced?a(t,"more"):n&&a(t,n),e.attributes.topblock&&r.topBlocks.push(e)}}),f.getPauseUntil()){var e=pxt.appTarget.runtime.pauseUntilBlock.category;i[e]&&i[e].push(f.getPauseUntil())}return i},e.prototype.clearCaches=function(){i.prototype.clearCaches.call(this),f.clearBuiltinBlockCache()},e.prototype.shouldShowSearch=function(){return!this.parent.state.editorState||null==this.parent.state.editorState.searchBar||this.parent.state.editorState.searchBar},e.prototype.getBuiltinCategory=function(e){return f.getBuiltinCategory(e)},e.prototype.isBuiltIn=function(e){return f.isBuiltin(e)},e.prototype.getNamespaceAttrs=function(e){var t=f.getBuiltinCategory(e);return t?(t.attributes.color=pxt.toolbox.getNamespaceColor(t.nameid),t.attributes):this.blockInfo?i.prototype.getNamespaceAttrs.call(this,e):void 0},e.prototype.getNamespaces=function(){var t=this,e=Object.keys(this.nsMap).filter(function(e){return!f.isBuiltin(e)&&!!t.getNamespaceAttrs(e)});function n(e){return f.getBuiltinCategory(e).removed}var r=pxt.appTarget.runtime||{};return r.loopsBlocks&&!n("loops")&&e.push("loops"),r.logicBlocks&&!n("logic")&&e.push("logic"),r.variablesBlocks&&!n("variables")&&e.push("variables"),r.mathBlocks&&!n("Math")&&e.push("Math"),r.functionBlocks&&!n("functions")&&e.push("functions"),r.listsBlocks&&!n("arrays")&&e.push("arrays"),r.textBlocks&&!n("text")&&e.push("text"),pxt.appTarget.cloud&&pxt.appTarget.cloud.packages&&e.push("addpackage"),e.concat(i.prototype.getNamespaces.call(this))},e.prototype.moveFocusToToolbox=function(){this.toolbox&&this.toolbox.focus()},e.prototype.moveFocusToFlyout=function(){var e=document.getElementById("monacoFlyoutWidget").getElementsByClassName("monacoDraggableBlock")[0];e&&e.focus()},e.prototype.getBlocksForCategory=function(e,t){return f.isBuiltin(e)?this.getBuiltinBlocks(e,t):this.filterBlocks(t,this.nsMap[e])},e.prototype.filterBlocks=function(t,e){return e.filter(function(e){return!(e.attributes.blockHidden||e.attributes.deprecated)&&0!=e.name.indexOf("_")&&(!t&&!e.attributes.subcategory&&!e.attributes.advanced||t&&(e.attributes.advanced&&"more"==t||e.attributes.subcategory&&t==e.attributes.subcategory))})},e.prototype.getBuiltinBlocks=function(e,t){var n=f.getBuiltinCategory(e),r=n.blocks||[];return!n.custom&&this.nsMap[e]&&(r=r.concat(this.nsMap[e].filter(function(e){return!(e.attributes.blockHidden||e.attributes.deprecated)}))),this.filterBlocks(t,r)},e.prototype.showFlyout=function(e){if(this.editor){var t=e.nameid,n=this.createMonacoFlyout();if("search"!=t)"topblocks"!=t?this.abstractShowFlyout(e)||e.subcategories&&0<e.subcategories.length?this.parent.setState({hideEditorFloats:!0}):this.closeFlyout():this.showTopBlocksFlyout();else try{this.showSearchFlyout()}catch(e){pxt.reportException(e),pxsim.U.clear(n),this.addNoSearchResultsLabel()}}},e.prototype.showFlyoutHeadingLabel=function(e,t,n,r,i){var o=t||v.capitalize(n||e),a=("blocklyTreeIcon"+(r?(e||r).toLowerCase():"Default")).replace(/\s/g,"");this.getMonacoLabel(o,"monacoFlyoutLabel monacoFlyoutHeading",!0,r,a,i)},e.prototype.showFlyoutGroupLabel=function(e,t,n,r){this.getMonacoLabel(pxt.Util.rlf("{id:group}"+e),"monacoFlyoutLabel blocklyFlyoutGroup",!1,void 0,void 0,void 0,!0,n,r)},e.prototype.showFlyoutBlocks=function(e,t,n){var r=this.getMonacoFlyout(),i=this.parent.state.editorState?this.parent.state.editorState.filters:void 0,o=i?i.namespaces&&null!=i.namespaces[e]?i.namespaces[e]:i.defaultState:void 0;this.createMonacoBlocks(this,r,e,n,t,i,o)},e.prototype.handleGutterClick=function(e){var t=e.target.position.lineNumber;if(this.isDebugging())this.breakpoints&&(this.breakpoints.toggleBreakpointAt(t),this.sendBreakpoints());else if(this.fieldEditors){var n=this.editor.getModel();if(n.getDecorationsInRange(new monaco.Range(t,n.getLineMinColumn(t),t,n.getLineMaxColumn(t))).length){var r=this.fieldEditors.getInfoForLine(t);if(r){if(this.feWidget&&null!=this.activeRangeID&&r.id===this.activeRangeID)return this.feWidget.close(),void(this.activeRangeID=null);this.activeRangeID=r.id;var i=this.fieldEditors.getFieldEditorById(r.owner);i&&this.showFieldEditor(r.range,new i.proto,i.heightInPixels||500)}}}},e.prototype.showSearchFlyout=function(){var l=this,c=[],u=this;function p(e){var t=u.blockInfo.apis.byQName[e];return(t?t.attributes.color:void 0)||pxt.toolbox.getNamespaceColor(e)||"255"}this.toolbox.getSearchBlocks().forEach(function(e){if(e.name){var t=l.blockInfo.apis.byQName[e.name];if(t){if(0==t.name.indexOf("_"))return;a=(t.attributes.blockNamespace||t.namespace).split(".")[0],r=t.attributes.color||p(a),c.push(l.getMonacoBlock(t,a,r))}else pxt.log("couldn't find non builtin search by qName: "+e.name)}else if(e.attributes.blockId==pxtc.PAUSE_UNTIL_TYPE){var n=f.getPauseUntil();if(n){var r=p(a=n.attributes.blockNamespace);c.push(l.getMonacoBlock(n,a,r))}}else{var i=f.allBuiltinBlocks()[e.attributes.blockId];if(i){var o=i[0],a=i[1],s=u.getNamespaceAttrs(a);c.push(l.getMonacoBlock(o,a,s.color))}else pxt.log("couldn't find buildin search qName for block: "+e.attributes.blockId)}}),this.attachMonacoBlockAccessibility(c),0==c.length&&this.addNoSearchResultsLabel()},e.prototype.showTopBlocksFlyout=function(){var r=this,i=[],e=this.getTopBlocks(),o=(this.getMonacoFlyout(),this);0==e.length?this.getMonacoLabel(lf("No basic results..."),"monacoFlyoutLabel"):(this.showFlyoutHeadingLabel("topblocks",lf("{id:category}Basic"),null,pxt.toolbox.getNamespaceIcon("topblocks"),pxt.toolbox.getNamespaceColor("topblocks")),e.forEach(function(e){var t,n;i.push(r.getMonacoBlock(e,"topblocks",(t=e.attributes.blockNamespace||e.namespace,((n=o.blockInfo.apis.byQName[t])?n.attributes.color:void 0)||pxt.toolbox.getNamespaceColor(t)||"255"),!1))})),this.attachMonacoBlockAccessibility(i)},e.prototype.addNoSearchResultsLabel=function(){this.getMonacoLabel(lf("No search results..."),"monacoFlyoutLabel")},e.prototype.getMonacoFlyout=function(){return document.getElementById("monacoFlyoutWidget")},e.prototype.createMonacoFlyout=function(){var e=this.getMonacoFlyout();return e.style.left=this.editor.getLayoutInfo().lineNumbersLeft+"px",e.style.height=this.editor.getLayoutInfo().contentHeight+"px",e.style.display="block",e.className="monacoFlyout",e.style.transform="none",e.addEventListener("wheel",this.handleFlyoutScroll,!0),pxsim.U.clear(e),e},e.prototype.createMonacoBlocks=function(r,e,i,t,o,a,s){var n=t.sort(function(e,t){return(t.attributes.weight||50)+(t.attributes.advanced?0:1e3)>(e.attributes.weight||50)+(e.attributes.advanced?0:1e3)?1:-1}).map(function(e){var t=a?a.defaultState:pxt.editor.FilterState.Visible;if(a&&a.fns&&void 0!==a.fns[e.name]?t=a.fns[e.name]:a&&a.blocks&&e.attributes.blockId&&void 0!==a.blocks[e.attributes.blockId]?t=a.blocks[e.attributes.blockId]:void 0!==s&&(t=s),t!=pxt.editor.FilterState.Hidden){var n=t==pxt.editor.FilterState.Disabled;return r.getMonacoBlock(e,i,o,n)}});r.attachMonacoBlockAccessibility(n)},e.prototype.attachMonacoBlockAccessibility=function(i){var o=this,a=this;i.forEach(function(e,n){if(e){var r=v.isUserLanguageRtl();e.onkeydown=function(e){var t=d.keyCodeFromEvent(e);40==t?n<i.length-1&&i[n+1].focus():38==t?0<n&&i[n-1].focus():37==t&&!r||38==t&&r?a.moveFocusToToolbox():27==t?(a.hideFlyout(),a.moveFocusToToolbox()):l.fireClickOnEnter.call(o,e)}}})},e.prototype.getMonacoLabel=function(e,t,n,r,i,o,a,s,l){var c=this,u=this.getMonacoFlyout(),p=this.parent.settings.editorFontSize,d=document.createElement("div");d.className=t;var f=document.createElement("div");if(f.className="monacoFlyoutLabelText",f.style.display="inline-block",f.style.fontSize=p+(n?5:0)+"px",f.style.lineHeight=p+5+"px",f.textContent=e,n){var h=document.createElement("span");h.className="monacoFlyoutHeadingIcon blocklyTreeIcon "+i,h.setAttribute("role","presentation"),h.style.display="inline-block",h.style.color=""+pxt.toolbox.convertColor(o),r&&1===r.length&&(h.textContent=r),d.appendChild(h)}if(d.appendChild(f),l&&pxt.editor.HELP_IMAGE_URI){var m=document.createElement("span");m.style.display="inline-block",m.style.cursor="pointer",m.draggable=!1;var g=document.createElement("img");g.setAttribute("src",pxt.editor.HELP_IMAGE_URI),g.style.height=p+5+"px",g.style.width=p+5+"px",g.style.verticalAlign="middle",g.style.marginLeft="10px",m.appendChild(g),d.appendChild(m),g.addEventListener("click",function(){c.helpButtonCallback(e)})}if(u.appendChild(d),a){var v=document.createElement("hr");v.className="monacoFlyoutLabelLine",v.align="left",v.style.width=Math.min(s?parseInt(s):f.offsetWidth,350)+"px",d.appendChild(v)}return d},e.prototype.helpButtonCallback=function(e){pxt.debug(e+" help icon clicked."),w.fireEvent({type:"ui",editor:"ts",action:"groupHelpClicked",data:{group:e}})},e.prototype.getMonacoBlock=function(n,e,t,r){var i=this;if(n.attributes.blockBuiltin)pxt.log("ignoring built in block: "+n.attributes.blockId);else{var o=this,a=this.getMonacoFlyout(),s="python"==this.fileType;if(void 0!==n.snippet){var l=n.qName,c=(s?n.pySnippetName||n.pyName:void 0)||n.snippetName||n.name,u=s?n.pySnippet:n.snippet,p=document.createElement("div");p.className="monacoBlock "+(r?"monacoDisabledBlock":""),a.appendChild(p);var d=document.createElement("div");d.className="monacoDraggableBlock",d.tabIndex=0,p.appendChild(d);var f=n.attributes.jsDoc;d.title=f,t=pxt.toolbox.convertColor(t);var h=document.createElement("span");if(h.textContent=n.snippetOnly?u:c,d.appendChild(h),!r){d.draggable=!0,d.onclick=function(e){pxt.tickEvent("monaco.toolbox.itemclick",void 0,{interactiveConsent:!0}),o.hideFlyout(),(u?Promise.resolve(u):_.snippetAsync(l,s)).done(function(e){var t=o.editor.getPosition();i.insertSnippet(t,e),w.fireEvent({type:"create",editor:"ts",blockId:n.attributes.blockId})})},d.ondragstart=function(e){pxt.tickEvent("monaco.toolbox.itemdrag",void 0,{interactiveConsent:!0}),setTimeout(function(){a.style.transform="translateX(-9999px)"}),u?e.dataTransfer.setData("text",u):e.dataTransfer.setData("text","qName:"+l),w.fireEvent({type:"create",editor:"ts",blockId:n.attributes.blockId})},d.ondragend=function(e){a.style.transform="none",o.hideFlyout()};var m=function(){d.style.backgroundColor=r?""+pxt.toolbox.fadeColor(t||"#ddd",.8,!1):""+pxt.toolbox.fadeColor(t||"#ddd",.1,!1)},g=function(){d.style.backgroundColor=r?""+pxt.toolbox.fadeColor(t||"#ddd",.8,!1):""+t};d.onmouseenter=function(e){m()},d.onmouseleave=function(e){g()},d.onfocus=function(e){m()},d.onblur=function(e){g()}}if(d.style.fontSize=o.parent.settings.editorFontSize+"px",d.style.lineHeight=o.parent.settings.editorFontSize+1+"px",d.style.backgroundColor=r?""+pxt.toolbox.fadeColor(t||"#ddd",.8,!1):""+t,d.style.borderColor=""+pxt.toolbox.fadeColor(t||"#ddd",.2,!1),n.retType&&"boolean"==n.retType){d.style.borderRadius="0px";var v=d.offsetHeight-2,y=o.uniqueBlockId++;d.id="monacoHexBlock"+y,d.className+=" monacoHexBlock";var b=document.createElement("style");b.appendChild(document.createTextNode("\n                    #monacoHexBlock"+y+":before,\n                    #monacoHexBlock"+y+":after {\n                        border-top: "+v/2+"px solid transparent;\n                        border-bottom: "+v/2+"px solid transparent;\n                    }\n                    #monacoHexBlock"+y+":before {\n                        border-right: 17px solid "+t+";\n                    }\n                    #monacoHexBlock"+y+":after {\n                        border-left: 17px solid "+t+";\n                    }\n                ")),p.insertBefore(b,d)}else n.retType&&"void"!=n.retType?d.style.borderRadius="40px":d.style.borderRadius="3px";return d}}},e.prototype.indentRangeAsync=function(e){var t=this.editor.getModel(),n=t.getLineFirstNonWhitespaceColumn(e.startLineNumber)-1,r=P(t.getOneIndent().length+n),i=t.getValueInRange(e).split(/\n/),o=i.map(function(e,t){return 0===t?e.trim():t===i.length-1?P(n)+e.trim():r+e.trim()}).join(t.getEOL());return this.editModelAsync(e,o)},e.prototype.editModelAsync=function(o,a){var s=this;return new Promise(function(t){var e=s.editor.getModel(),n=a.split("\n"),r=new monaco.Range(o.startLineNumber,o.startColumn,o.startLineNumber+n.length-1,n[n.length-1].length),i=s.editor.onDidChangeModelContent(function(e){i&&(i.dispose(),i=void 0),s.editor.setSelection(r),s.fieldEditors&&s.fieldEditors.clearRanges(s.editor),t(r)});e.pushEditOperations(s.editor.getSelections(),[{identifier:{major:0,minor:0},range:e.validateRange(o),text:a,forceMoveMarkers:!0,isAutoWhitespaceEdit:!0}],function(e){return[O(e[0].range)]})})},e.prototype.isDebugging=function(){return this.parent.state.debugging},e}(i.ToolboxEditor);function O(e){return new monaco.Selection(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn)}function P(e){for(var t="",n=0;n<e;n++)t+=" ";return t}function I(e){var t=p.mainEditorPkg();return t.files[e]?t.files[e]:t.lookupFile(e)||void 0}n.Editor=N,n.rangeToSelection=O},{"./blocklyFieldView":5,"./compiler":14,"./core":41,"./debuggerToolbox":49,"./monacoDebugger":74,"./monacoEditAmendments":75,"./monacoFieldEditorHost":76,"./monacoSnippets":77,"./monacopyhelper":78,"./package":81,"./simulator":92,"./sui":100,"./toolbox":101,"./toolboxeditor":102,"./workspace":105,react:284,"react-dom":240}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){this.source=e,this.editor=t,this.active=!1;var n=this.editor.getModel(),r=n.getPositionAt(this.source.start),i=n.getPositionAt(this.source.start+this.source.length);i.lineNumber===r.lineNumber?this.range=new monaco.Range(r.lineNumber,r.column,i.lineNumber,i.column):this.range=new monaco.Range(r.lineNumber,r.column,r.lineNumber,n.getLineMaxColumn(r.lineNumber)),this.updateDecoration()}return e.prototype.simulatorID=function(){return this.source.id},e.prototype.isActive=function(){return this.active},e.prototype.setActive=function(e){this.active!==e&&(this.active=e,this.updateDecoration())},e.prototype.toggle=function(){this.setActive(!this.active)},e.prototype.distanceFromLine=function(e){return Math.abs(this.range.startLineNumber-e)},e.prototype.dispose=function(){this.decoration&&(this.editor.deltaDecorations([this.decoration],[]),this.decoration=void 0)},e.prototype.updateDecoration=function(){var e=this.active?"monaco-breakpoint active":"monaco-breakpoint",t=this.active?pxt.U.lf("Remove breakpoint"):pxt.U.lf("Add breakpoint"),n=this.editor.deltaDecorations(this.decoration?[this.decoration]:[],[{range:this.range,options:{glyphMarginClassName:e,glyphMarginHoverMessage:t}}]);this.decoration=n[0]},e}();n.MonacoBreakpoint=i;var r=function(){function e(e){this.fileToBreakpoint={},this.activeBreakpoints=[];for(var t=0,n=e;t<n.length;t++){var r=n[t];this.fileToBreakpoint[r.fileName]||(this.fileToBreakpoint[r.fileName]=[]),this.fileToBreakpoint[r.fileName].push(r)}}return e.prototype.loadBreakpointsForFile=function(e,n){var r=this;if(this.loadedBreakpoints&&this.loadedBreakpoints.forEach(function(e){return e.dispose()}),e){var t=this.fileToBreakpoint[e.getTypeScriptName()];t&&(this.loadedBreakpoints=t.map(function(e){var t=new i(e,n);return-1!=r.activeBreakpoints.indexOf(e.id)&&t.setActive(!0),t}))}},e.prototype.toggleBreakpointAt=function(e){var t=this.getBreakpointForLine(e);t&&(t.toggle(),t.isActive()?this.activeBreakpoints.push(t.source.id):this.activeBreakpoints=this.activeBreakpoints.filter(function(e){return e!=t.source.id}))},e.prototype.refreshDecorations=function(){this.loadedBreakpoints&&this.loadedBreakpoints.forEach(function(e){return e.updateDecoration()})},e.prototype.clearDecorations=function(){this.loadedBreakpoints&&this.loadedBreakpoints.forEach(function(e){return e.dispose()})},e.prototype.getActiveBreakpoints=function(){return this.activeBreakpoints},e.prototype.dispose=function(){this.loadedBreakpoints&&(this.loadedBreakpoints.forEach(function(e){return e.dispose()}),this.loadedBreakpoints=void 0),this.activeBreakpoints=void 0,this.fileToBreakpoint=void 0},e.prototype.getLocationOfBreakpoint=function(e){for(var t=0,n=Object.keys(this.fileToBreakpoint);t<n.length;t++)for(var r=n[t],i=0,o=this.fileToBreakpoint[r];i<o.length;i++){var a=o[i];if(a.id===e)return a}},e.prototype.getBreakpointForLine=function(e){if(this.loadedBreakpoints&&this.loadedBreakpoints.length){for(var t,n,r=0,i=this.loadedBreakpoints;r<i.length;r++){var o=i[r],a=o.distanceFromLine(e);(void 0===n||a<n)&&(t=o,n=a)}return n<5?t:void 0}},e}();n.BreakpointCollection=r},{}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var d=e("./monaco"),o="#AMENDMENT:";n.createLineReplacementPyAmendment=function(e,t){return void 0===t&&(t="pass"),{behavior:"replaceLine",insertText:e||"",selectText:t}},n.amendmentToInsertSnippet=function(e){return""+o+JSON.stringify(e)},n.listenForEditAmendments=function(n){return n.onDidChangeModelContent(function(e){var u,p,t=function(e){if(1!=e.changes.length)return null;var t=e.changes[0];if(!(0<=t.text.indexOf(o)))return null;var n=t.text.split(o);if(2!=n.length)return null;n[0];var r=n[1],i=pxt.U.jsonTryParse(r);return i?Object.assign({range:t.range},i):null}(e);t&&(u=t,p=n,setTimeout(function(){var n=Object.assign({},u.range);"replaceLine"===u.behavior?(n.endColumn=99999,n.startColumn=1):u.behavior;var r=null;if(u.selectText){var e=u.insertText.split(u.selectText);if(2<=e.length){var t=e[0].split("\n"),i=t[t.length-1],o=n.startLineNumber+t.length-1,a=i.length+1;r=new monaco.Range(o,a,o,a+u.selectText.length)}}var s=p.getModel(),l=Object.assign({},u.range);l.endColumn=99999;var c=[{identifier:{major:0,minor:0},range:s.validateRange(l),text:"",forceMoveMarkers:!1,isAutoWhitespaceEdit:!1}];s.applyEdits(c),setTimeout(function(){var t=p.onDidChangeModelContent(function(e){t.dispose(),r&&p.setSelection(r)}),e=[{identifier:{major:0,minor:0},range:s.validateRange(n),text:u.insertText,forceMoveMarkers:!0,isAutoWhitespaceEdit:!0}];s.pushEditOperations(p.getSelections(),e,function(e){return[d.rangeToSelection(e[0].range)]})},0)},0))})}},{"./monaco":73}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./compiler"),i=function(){function e(e,t,n){this.fe=e,this.range=t,this.model=n,this.heightInPx=520,this.suppressMouseDown=!1,this.afterLineNumber=t.endLineNumber;var r=document.createElement("div");r.setAttribute("class","pxt-view-zone");var i=document.createElement("div");i.setAttribute("class","monaco-field-editor-frame"),r.appendChild(i),this.domNode=r,this.wrapper=i}return e.prototype.getId=function(){return"pxt-monaco-field-editor"},e.prototype.contentDiv=function(){return this.content||(this.content=document.createElement("div"),this.wrapper.appendChild(this.content)),this.content},e.prototype.showAsync=function(e,t){var n=this;return this.fileType=e,this.editor=t,r.getBlocksAsync().then(function(e){return n.blocks=e,n.showViewZoneAsync()}).then(function(){return n.editor.setScrollPosition({scrollTop:n.editor.getTopForLineNumber(n.afterLineNumber)}),n.fe.showEditorAsync(n.fileType,n.range,n)}).finally(function(){n.close()})},e.prototype.onComputedHeight=function(e){this.contentDiv().style.height=e+"px"},e.prototype.onDomNodeTop=function(e){this._deferredShow&&(this._deferredShow(),this._deferredShow=void 0)},e.prototype.showViewZoneAsync=function(){var t=this;return this._deferredShow?Promise.resolve():new Promise(function(e){t._deferredShow=e,t.editor.changeViewZones(function(e){t.id=e.addZone(t)})})},e.prototype.resizeViewZoneAsync=function(){var t=this;return this.id?new Promise(function(e){t.editor.changeViewZones(function(e){e.layoutZone(t.id)})}):Promise.resolve()},e.prototype.getText=function(e){return this.model.getValueInRange(e)},e.prototype.blocksInfo=function(){return this.blocks},e.prototype.close=function(){var t=this;this.fe.onClosed(),this.fe.dispose(),this.editor.changeViewZones(function(e){e.removeZone(t.id)})},e}();n.ViewZoneEditorHost=i;var o=function(){function e(e,t,n){this.fe=e,this.range=t,this.model=n}return e.prototype.contentDiv=function(){return null},e.prototype.getText=function(e){return this.model.getValueInRange(e)},e.prototype.blocksInfo=function(){return this.blocks},e.prototype.showAsync=function(t,e){var n=this;return r.getBlocksAsync().then(function(e){return n.blocks=e,n.fe.showEditorAsync(t,n.range,n)})},e.prototype.close=function(){this.fe.onClosed(),this.fe.dispose()},e}();n.ModalEditorHost=o;var a=function(){function e(){this.fieldEditors=[],this.decorations={},this.liveRanges=[],this.rangeID=0}return e.prototype.addFieldEditor=function(e){for(var t=0,n=this.fieldEditors;t<n.length;t++)if(n[t].id===e.id)return;this.fieldEditors.push(e)},e.prototype.getDecorations=function(e){return this.decorations[e]||[]},e.prototype.allDecorations=function(){var t=this,n=[];return Object.keys(this.decorations).forEach(function(e){return n.push.apply(n,t.getDecorations(e))}),n},e.prototype.setDecorations=function(e,t){this.decorations[e]=t},e.prototype.clearRanges=function(t){var n=this;t&&Object.keys(this.decorations).forEach(function(e){t.deltaDecorations(n.decorations[e],[])}),this.decorations={},this.liveRanges=[],this.rangeID=0},e.prototype.trackRange=function(e,t,n){return!this.getInfoForLine(t)&&(this.liveRanges.push({line:t,owner:e,range:n,id:this.rangeID++}),!0)},e.prototype.getFieldEditorById=function(e){for(var t=0,n=this.fieldEditors;t<n.length;t++){var r=n[t];if(r.id===e)return r}},e.prototype.getInfoForLine=function(e){for(var t=0,n=this.liveRanges;t<n.length;t++){var r=n[t];if(r.line===e)return r}},e.prototype.allRanges=function(){return this.liveRanges},e.prototype.allFieldEditors=function(){return this.fieldEditors},e}();n.FieldEditorManager=a},{"./compiler":14}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i,o,a=null;function s(){return a||((a={}).loops={name:lf("{id:category}Loops"),nameid:"loops",blocks:[{name:"loops_while",snippetName:"while",snippet:"while(true) {\n\n}",pySnippet:"while True:\n  pass",attributes:{blockId:"device_while",weight:48,jsDoc:lf("Repeat code while condition is true")}},{name:"loops_for",snippetName:"for",snippet:"for(let i = 0; i < 5; i++) {\n\n}",pySnippet:"for i in range(0, 4):\n  pass",attributes:{blockId:"pxt_controls_for",weight:47,jsDoc:lf("Repeat code a number of times in a loop")}}],attributes:{callingConvention:0,icon:"loops",weight:50.09,paramDefl:{}}},a.logic={name:lf("{id:category}Logic"),nameid:"logic",blocks:[{name:"logic_if",snippetName:"if",snippet:"if (true) {\n\n}",pySnippet:"if True:\n  pass",attributes:{blockId:"controls_if",weight:49,jsDoc:lf("Runs code if the condition is true")}},{name:"logic_if_else",snippetName:"if else",snippet:"if (true) {\n\n} else {\n\n}",pySnippet:"if True:\n  pass\nelse:\n  pass",attributes:{blockId:"controls_if",weight:48,jsDoc:lf("Runs code if the condition is true; else run other code")}},{name:"logic_and",snippetName:"and",snippet:"true && true",pySnippet:"True and True",attributes:{blockId:"logic_compare",weight:47,jsDoc:lf("Runs code if both specified conditions are true")}},{name:"logic_or",snippetName:"or",snippet:"true || false",pySnippet:"True or False",attributes:{blockId:"logic_compare",weight:46,jsDoc:lf("Runs code if either of two specified conditions is true")}}],attributes:{callingConvention:0,weight:50.08,icon:"logic",paramDefl:{}}},a.variables={name:lf("{id:category}Variables"),nameid:"variables",blocks:[{name:"var_let",snippetName:"let",snippet:"let item: number",pySnippet:"item = 0",snippetOnly:!0,attributes:{blockId:"variables_set",jsDoc:lf("Declares a variable named 'item'")}},{name:"var_equals",snippetName:"equals",snippet:"item = 0",pySnippet:"item = 0",snippetOnly:!0,attributes:{blockId:"variables_get",jsDoc:lf("Assigns a value to a variable")}},{name:"var_change",snippetName:"change",snippet:"item += 1",pySnippet:"item += 1",snippetOnly:!0,attributes:{blockId:"variables_change",jsDoc:lf("Changes the value of item by 1")}}],attributes:{callingConvention:0,weight:50.07,icon:"variables",paramDefl:{}}},a.Math={name:lf("{id:category}Math"),nameid:"Math",blocks:[{name:"Math.plus",snippetName:"plus",snippet:"1 + 1",pySnippet:"1 + 1",snippetOnly:!0,attributes:{weight:90,blockId:"math_arithmetic",jsDoc:lf("Adds two numbers together")},retType:"number"},{name:"Math.minus",snippetName:"minus",snippet:"1 - 1",pySnippet:"1 - 1",snippetOnly:!0,attributes:{weight:89,blockId:"math_arithmetic",jsDoc:lf("Subtracts the value of one number from another")},retType:"number"},{name:"Math.multiply",snippetName:"multiply",snippet:"1 * 1",pySnippet:"1 * 1",snippetOnly:!0,attributes:{weight:88,blockId:"math_arithmetic",jsDoc:lf("Multiplies two numbers together")},retType:"number"},{name:"Math.divide",snippetName:"divide",snippet:"1 / 1",pySnippet:"1 / 1",snippetOnly:!0,attributes:{weight:87,blockId:"math_arithmetic",jsDoc:lf("Returns the quotient of one number divided by another")},retType:"number"},{name:"Math.remainder",snippetName:"remainder",snippet:"1 % 2",pySnippet:"1 % 2",snippetOnly:!0,attributes:{weight:80,blockId:"math_modulo",jsDoc:lf("Returns the remainder of one number divided by another")},retType:"number"},{name:"Math.max",snippetName:"max",snippet:"Math.max(1, 2)",pySnippet:"max(1, 2)",attributes:{weight:75,blockId:"math_op2",jsDoc:lf("Returns the largest of two numbers")},retType:"number"},{name:"Math.min",snippetName:"min",snippet:"Math.min(1, 2)",pySnippet:"min(1, 2)",attributes:{weight:74,blockId:"math_op2",jsDoc:lf("Returns the smallest of two numbers")},retType:"number"},{name:"Math.abs",snippetName:"abs",snippet:"Math.abs(-1)",pySnippet:"abs(-1)",attributes:{weight:70,blockId:"math_op3",jsDoc:lf("Returns the absolute value of a number")},retType:"number"},{name:"Math.randomRange",snippetName:"randomRange",snippet:"Math.randomRange(0, 10)",pySnippetName:"randint",pySnippet:"randint(0, 10)",attributes:{weight:65,jsDoc:lf("Returns a random number between min and max")},retType:"number"}],attributes:{callingConvention:0,weight:50.06,icon:"math",paramDefl:{}}},a.functions={name:lf("{id:category}Functions"),nameid:"functions",blocks:[{name:"functionDef",snippetName:"function doSomething",snippet:"function doSomething() {\n\n}",pySnippetName:"def do_something",pySnippet:"def do_something():\n  pass",attributes:{blockId:"procedures_defnoreturn",jsDoc:lf("Define a function")}},{name:"functionCall",snippetName:"doSomething",snippet:"doSomething()",pySnippetName:"do_something",pySnippet:"do_something()",attributes:{blockId:"procedures_callnoreturn",jsDoc:lf("Call a function")}}],attributes:{advanced:!0,weight:50.08,callingConvention:0,icon:"functions",paramDefl:{}}},a.arrays={name:lf("{id:category}Arrays"),nameid:"arrays",custom:!0,blocks:[{name:"array_create",snippetName:"create",snippet:"let "+lf("{id:snippets}list")+" = [1, 2, 3];",pySnippet:lf("{id:snippets}list")+" = [1, 2, 3]",snippetOnly:!0,attributes:{weight:100,blockId:"lists_create_with",jsDoc:lf("Creates a new Array")},retType:"array"},{name:"array_length",snippetName:"length",snippet:lf("{id:snippets}list")+".length",pySnippetName:"len",pySnippet:"len("+lf("{id:snippets}list")+")",snippetOnly:!0,attributes:{weight:99,blockId:"lists_length",jsDoc:lf("Returns the number of values in an Array")},retType:"number"},{name:"array_get",snippetName:"get",snippet:lf("{id:snippets}list")+"[0]",pySnippet:lf("{id:snippets}list")+"[0]",snippetOnly:!0,attributes:{weight:98,blockId:"lists_index_get",jsDoc:lf("Returns the value in the Array at the given index")}},{name:"array_set",snippetName:"set",snippet:lf("{id:snippets}list")+"[0] = 1",pySnippet:lf("{id:snippets}list")+"[0] = 1",snippetOnly:!0,attributes:{weight:97,blockId:"lists_index_set",jsDoc:lf("Overwrites the value in an Array at the given index")}},{name:"array_push",snippetName:"push",snippet:lf("{id:snippets}list")+".push(1)",pySnippetName:"append",pySnippet:lf("{id:snippets}list")+".append(1)",attributes:{weight:96,blockId:"array_push",jsDoc:lf("Adds a value to the end of an Array")}},{name:"arary_pop",snippetName:"pop",snippet:lf("{id:snippets}list")+".pop()",pySnippetName:"pop",pySnippet:lf("{id:snippets}list")+".pop()",attributes:{weight:95,blockId:"array_pop",jsDoc:lf("Removes and returns the value at the end of an Array")},retType:"object"},{name:"array_insertAt",snippetName:"insertAt",snippet:lf("{id:snippets}list")+".insertAt(0, 0)",pySnippetName:"insert",pySnippet:lf("{id:snippets}list")+".insert(0, 0)",attributes:{weight:50,blockId:"array_insertAt",jsDoc:lf("Inserts a value into the Array at the given index"),advanced:!0}},{name:"array_removeAt",snippetName:"removeAt",snippet:lf("{id:snippets}list")+".removeAt(0)",attributes:{weight:49,blockId:"array_removeat",jsDoc:lf("Removes a value from the Array at the given index and returns it"),advanced:!0},retType:"object"},{name:"array_shift",snippetName:"shift",snippet:lf("{id:snippets}list")+".shift()",attributes:{weight:48,blockId:"array_shift",jsDoc:lf("Removes and returns the value at the front of an Array"),advanced:!0}},{name:"array_unshift",snippetName:"unshift",snippet:lf("{id:snippets}list")+".unshift(0)",pySnippetName:"append",pySnippet:lf("{id:snippets}list")+".append(0)",attributes:{weight:47,blockId:"array_unshift",jsDoc:lf("Inserts a value at the beginning of an Array"),advanced:!0}},{name:"array_indexOf",snippetName:"indexOf",snippet:"[0, 1, 2].indexOf(1)",pySnippetName:"index",pySnippet:"[0, 1, 2].index(1)",attributes:{weight:46,jsDoc:lf("Returns the first index in the Array that contains the given value or -1 if it does not exist in the Array"),advanced:!0},retType:"number"},{name:"array_reverse",snippetName:"reverse",snippet:lf("{id:snippets}list")+".reverse()",pySnippet:lf("{id:snippets}list")+".reverse()",attributes:{weight:45,jsDoc:lf("Reverses the contents of an Array"),advanced:!0}}],attributes:{advanced:!0,weight:50.07,icon:"arrays",callingConvention:0,paramDefl:{}}},a.text={name:lf("{id:category}Text"),nameid:"text",custom:!0,blocks:[{name:"text_length",snippetName:"length",snippet:'"".length',pySnippetName:"len",pySnippet:'len("")',snippetOnly:!0,attributes:{blockId:"text_length",jsDoc:lf("Returns the number of characters in a string")},retType:"number"},{name:"text_concat",snippetName:"concat",snippet:'"" + 5',pySnippet:'"" + 5',snippetOnly:!0,attributes:{blockId:"text_join",jsDoc:lf("Combines a string with a number, boolean, string, or other object into one string")},retType:"string"},{name:"text_compare",snippetName:"compare",snippet:'"".compare("")',attributes:{blockId:"string_compare",jsDoc:lf("Compares one string against another alphabetically and returns a number")},retType:"number"},{name:"text_parseInt",snippetName:"parseInt",snippet:'parseInt("5")',pySnippetName:"int",pySnippet:'int("5")',attributes:{blockId:"string_parseint",jsDoc:lf("Converts a number written as text into a number")},retType:"number"},{name:"text_substr",snippetName:"substr",snippet:'"".substr(0, 0)',pySnippet:'""[0:1]',attributes:{blockId:"string_substr",jsDoc:lf("Returns the part of a string starting at a given index with the given length")},retType:"string"},{name:"text_charAt",snippetName:"charAt",snippet:'"".charAt(0)',pySnippetName:"str[0]",pySnippet:'""[0]',attributes:{blockId:"string_get",jsDoc:lf("Returns the character at the given index")},retType:"string"}],attributes:{advanced:!0,weight:50.06,icon:"text",callingConvention:0,paramDefl:{}}},a.addpackage={name:pxt.toolbox.addPackageTitle(),nameid:"addpackage",blocks:[],custom:!0,customClick:function(e){return e.closeFlyout(),e.showPackageDialog(),!0},attributes:{advanced:!0,weight:-1,icon:"addpackage",callingConvention:0,paramDefl:{}}}),a}function l(){if(r)return r;var e=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;if(e){var t=e.callName||"pauseUntil",n=t+"(() => true)";e.namespace&&(n=e.namespace+"."+n),r={name:"pause_until",snippetName:t,snippet:n,attributes:{blockNamespace:e.category||"loops",weight:null==e.weight?0:e.weight,jsDoc:lf("Pause execution of code until the given boolean expression is true"),advanced:!1}}}return r}function c(e){return s()[e]}function u(){i||(i={},o={},[c("loops"),c("logic"),c("Math"),c("text"),c("arrays"),c("variables"),c("functions")].forEach(function(t){t.blocks.forEach(function(e){e.type||e.snippet&&(e.attributes.blockId&&!i[e.attributes.blockId]&&(i[e.attributes.blockId]=[e,t.nameid]),o[e.name]||(o[e.name]=[e,t.nameid]))})}))}function p(e,t){var n=c(e);if(t&&n&&(0===Object.keys(t).length&&(n.removed=!0),t.name&&(n.name=t.name),t.icon&&(n.attributes.icon=t.icon),void 0!==t.weight&&(n.attributes.weight=t.weight),void 0!==t.advanced&&(n.attributes.advanced=t.advanced),null!=t.groups&&(n.groups=t.groups),t.blocks)){var i=100;n.blocks=t.blocks.map(function(e,t){return e.weight?i=e.weight:i--,r=i,{name:(n=e).name,snippet:n.snippet,pySnippet:n.pySnippet,snippetName:n.snippetName,pySnippetName:n.pySnippetName,snippetOnly:n.snippetOnly,attributes:{blockId:n.blockId,weight:r||n.weight,advanced:n.advanced,jsDoc:n.jsDoc,group:n.group},retType:n.retType,blockXml:n.blockXml};var n,r})}}function d(e){return{name:e.name,icon:e.attributes.icon,color:e.attributes.color,weight:e.attributes.weight,advanced:e.attributes.advanced,blocks:e.blocks?e.blocks.map(function(e){return{name:(t=e).name,snippet:t.snippet,pySnippet:t.pySnippet,snippetName:t.snippetName,pySnippetName:t.pySnippetName,snippetOnly:t.snippetOnly,retType:t.retType,weight:t.attributes.weight,advanced:t.attributes.advanced,jsDoc:t.attributes.jsDoc,group:t.attributes.group,blockXml:t.blockXml,blockId:t.attributes.blockId};var t}):[]}}n.getPauseUntil=l,n.getBuiltinCategory=c,n.isBuiltin=function(e){return!!s()[e]},n.allBuiltinBlocks=function(){u();var e=l();return e&&(i[pxtc.PAUSE_UNTIL_TYPE]=[e,"pause_until"]),i},n.allBuiltinBlocksByName=function(){u();var e=l();return e&&(o[pxtc.PAUSE_UNTIL_TYPE]=[e,"pause_until"]),o},n.clearBuiltinBlockCache=function(){o=i=void 0},n.overrideCategory=p,n.overrideToolbox=function(e){p("loops",e.loops),p("logic",e.logic),p("variables",e.variables),p("Math",e.maths),p("text",e.text),p("arrays",e.arrays),p("functions",e.functions)},n.getToolboxDefinition=function(){return{loops:d(c("loops")),logic:d(c("logic")),variables:d(c("variables")),maths:d(c("Math")),text:d(c("text")),arrays:d(c("arrays")),functions:d(c("functions"))}}},{}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var w=4;function k(e){return e&&e.match(/^\s*/)[0].length||0}function x(e,t){return new Array(e+1).join(" ")+t.trim()}function E(e){return":"==(e=e.trim())[e.length-1]}n.provideDocumentRangeFormattingEdits=function(e,t,n,r){var i,o,a,s,l=e.getValue(),c=0!=t.startLineNumber,u=e.getOffsetAt({lineNumber:t.startLineNumber,column:t.startColumn}),p=e.getOffsetAt({lineNumber:t.endLineNumber,column:t.endColumn}),d=l.slice(u,p).split("\n"),f=d.map(function(e,t){return e?t:-1}).filter(function(e){return 0<=e});c&&(o=l,a=e,s=t.startLineNumber-1,i=o.slice(a.getOffsetAt({lineNumber:s,column:0}),a.getOffsetAt({lineNumber:s+1,column:0})));for(var h=0;h<f.length;h++){var m=f[h],g=d[m],v=d[f[h+1]];if(i){var y=k(i),b=k(v);if(E(i)){var _=y+w;d[m]=x(_,g)}else v&&y==b&&y!=k(g)&&!E(g)&&(d[m]=x(y,g))}i=d[m]}return[{text:d.join("\n"),range:t}]}},{}],79:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var p=e("react"),o=e("./data"),d=e("./sui"),f=pxt.Cloud,h=function(n){function e(e){var t=n.call(this,e)||this;return t.delayTime=t.props.delayTime||0,t.doneSleeping=t.sleepDone(),t.bannerType=t.props.bannerType||"default",t.handleClick=t.handleClick.bind(t),t}return i(e,n),e.prototype.componentDidMount=function(){var e=this;this.doneSleeping&&(this.timer=setTimeout(function(){return e.show()},this.delayTime))},e.prototype.componentWillUnmount=function(){clearTimeout(this.timer)},e.prototype.sleepDone=function(){if(!this.props.sleepTime)return!0;var e=parseInt(pxt.storage.getLocal("lastBannerClosedTime")||"0");return pxt.Util.nowSeconds()-e>this.props.sleepTime},e.prototype.show=function(){var e=this;pxt.tickEvent("notificationBanner."+this.props.id+".show"),this.props.displayTime&&(this.timer=setTimeout(function(){return e.hide("automatic")},this.delayTime+this.props.displayTime)),this.props.parent.setBannerVisible(!0),this.render()},e.prototype.hide=function(e){pxt.tickEvent("notificationBanner."+this.props.id+"."+e+"Close"),pxt.storage.setLocal("lastBannerClosedTime",pxt.Util.nowSeconds().toString()),this.props.parent.setBannerVisible(!1),this.render()},e.prototype.handleClick=function(){this.hide("manual"),clearTimeout(this.timer)},e.prototype.renderCore=function(){return this.props.parent.state.bannerVisible&&this.doneSleeping?p.createElement("div",{id:"notificationBanner",className:"ui attached "+this.bannerType+" message"},p.createElement("div",{className:"bannerLeft"},p.createElement("div",{className:"content"},this.props.children)),p.createElement("div",{className:"bannerRight"},p.createElement(d.Icon,{icon:"close",tabIndex:0,onClick:this.handleClick}))):p.createElement("div",null)},e}(o.Component);n.GenericBanner=h;var a=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.handleBannerClick=t.handleBannerClick.bind(t),t.clearExperiments=t.clearExperiments.bind(t),t}return i(e,n),e.prototype.handleBannerClick=function(){pxt.tickEvent("banner.linkClicked",void 0,{interactiveConsent:!0})},e.prototype.clearExperiments=function(){pxt.tickEvent("banner.experiments",void 0,{interactiveConsent:!0}),pxt.editor.experiments.clear(),this.props.parent.reloadEditor()},e.prototype.renderCore=function(){if(pxt.analytics.isCookieBannerVisible())return p.createElement("div",null);var e=pxt.appTarget.appTheme,t=pxt.winrt.isWinRT()||pxt.BrowserUtils.isElectron(),n="localhost"===location.hostname,r="/"!==location.pathname&&-1===(e.appPathNames||[]).indexOf(location.pathname),i=!n&&t&&r,o=pxt.BrowserUtils.isWindows10(),a=this.getData("target-config:"),s=pxt.editor.experiments.someEnabled(),l=o&&f.isOnline()&&a&&a.windowsStoreLink&&!t&&!pxt.shell.isSandboxMode();if(s){var c=2e4;return p.createElement(h,{id:"experimentsbanner",parent:this.props.parent,bannerType:"negative",displayTime:c},p.createElement(d.Icon,{icon:"information circle"}),p.createElement("div",{className:"header"},lf("Experiments enabled.")),p.createElement(d.Link,{className:"link",ariaLabel:lf("Clear"),onClick:this.clearExperiments},lf("Clear")))}if(i){var u=pxt.appTarget.appTheme.homeUrl+location.search+location.hash;return p.createElement(h,{id:"experimental",parent:this.props.parent,bannerType:"negative"},p.createElement(d.Icon,{icon:"warning circle"}),p.createElement("div",{className:"header"},lf("You are viewing an experimental version of the editor")),p.createElement(d.Link,{className:"link",ariaLabel:lf("Go back to live editor"),href:u},lf("Take me back")))}return l?(c=2e4,p.createElement(h,{id:"uwp",parent:this.props.parent,delayTime:3e5,displayTime:c,sleepTime:604800},p.createElement(d.Link,{className:"link",target:"_blank",ariaLabel:lf("View app in the Windows store"),href:a.windowsStoreLink,onClick:this.handleBannerClick},p.createElement("img",{className:"bannerIcon",src:pxt.Util.pathJoin(pxt.webConfig.commitCdnUrl,"images/windowsstorebag.png"),alt:lf("Windows store logo")})),p.createElement(d.Link,{className:"link",target:"_blank",ariaLabel:lf("View app in the Windows store"),href:a.windowsStoreLink,onClick:this.handleBannerClick},lf("Want a faster download? Get the app!")))):p.createElement("div",null)},e}(o.Component);n.NotificationBanner=a},{"./data":44,"./sui":100,react:284}],80:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),c=this&&this.__awaiter||function(o,a,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((l=l.apply(o,a||[])).next())})},u=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var p=e("./core"),d=e("./cloudsync"),f="/me/drive/special/approot",h=pxt.U,o=function(t){function l(){var e=t.call(this,"onedrive",lf("Microsoft OneDrive"),"xicon onedrive","https://graph.microsoft.com/v1.0")||this;return e.entryCache={},e.loadFrameTimeout=6e3,window.activeRenewals={},window.callBackMappedToRenewStates={},e}return i(l,t),l.prototype.loginAsync=function(o,a){var s=this;return new Promise(function(e,t){var n=s.loginInner();if(n.scope=l.ONEDRIVE_SCOPE,a){n.prompt="none";var r=pxt.storage.getLocal("cloudUser");r&&(n.login_hint=JSON.parse(r).loginHint)}var i=p.stringifyQueryString("https://login.microsoftonline.com/common/oauth2/v2.0/authorize",n);a?s.silentLoginHelper(i,e,t):pxt.BrowserUtils.isIFrame()||pxt.BrowserUtils.isIE()||n.redirect||o?window.location.href=i:s.popupLoginHelper(i,e,t)}).then(function(e){return s.setNewToken(e.accessToken,e.expiresIn),e}).finally(function(){s.loginCompleteInner()})},l.prototype.silentLoginHelper=function(e,c,t){var n=this,r=this.addAdalFrame("onedriveLogin"),i=function(){r&&r.parentNode&&r.parentNode.removeChild(r),n.loginAsync().then(function(e){return c(e)}).catch(function(e){return t(e)})},u=function(e){pxt.debug("Error silently logging in: "+e),i()};r||i(),r.src=e,r.addEventListener("load",function(e){!function(e){var t="";try{t=e.currentTarget.contentWindow.location.hash}catch(r){return u(r)}var n=p.parseQueryString(t),r=n.error;if(r){var i=n.error_description;u(i?decodeURIComponent(i):r)}else{var o=n.access_token,a=n.expires_in;if(o){var s=pxt.storage.getLocal(d.OAUTH_STATE);if(s)if(s==n.state){pxt.storage.removeLocal(d.OAUTH_STATE),pxt.storage.setLocal(d.OAUTH_HASH,t);var l=e.currentTarget;l.parentNode.removeChild(l),c({accessToken:o,expiresIn:a})}else u("OAuth state mismatch");else u("OAuth not started")}else u("access_token not in #")}}(e)})},l.prototype.popupLoginHelper=function(e,r,i){var o=pxt.BrowserUtils.popupWindow(e,lf("Login with Microsoft"),483,600);if(o)var a=window.setInterval(function(){var e,t,n;o.closed&&(window.clearInterval(a),t=(e=p.parseQueryString(pxt.storage.getLocal(d.OAUTH_HASH)||"")).access_token,n=parseInt(e.expires_in),t&&n?r({accessToken:t,expiresIn:n}):i(new Error("Failed to login, most likely the user closed the popup")))},1e3);else this.loginAsync(!0).then(function(e){return r(e)}).catch(function(e){return i(e)})},l.prototype.login=function(e){var t=this,n=this.loginInner();n.scope="Files.ReadWrite User.Read",e&&(n.prompt="none");var r=p.stringifyQueryString("https://login.microsoftonline.com/common/oauth2/v2.0/authorize",n),i=!1;if(e){var o=this.addAdalFrame("onedriveLogin"),a=function(){o&&o.parentNode&&o.parentNode.removeChild(o),t.login()};o||a(),o.src="about:blank",o.addEventListener("load",function(e){!function(e){var t="";try{t=e.currentTarget.contentWindow.location.hash}catch(e){return a()}var n=p.parseQueryString(t),r=n.access_token;if(n.expires_in,!r)return pxt.debug("access_token not in #"),a();var i=pxt.storage.getLocal(d.OAUTH_STATE);if(!i)return pxt.debug("OAuth not started"),a();if(i!=n.state)return pxt.debug("OAuth state mismatch"),a();pxt.storage.removeLocal(d.OAUTH_STATE),pxt.storage.setLocal(d.OAUTH_HASH,t);var o=e.currentTarget;o.parentNode.removeChild(o)}(e)}),o&&(i=!0)}if(!(pxt.BrowserUtils.isIFrame()||pxt.BrowserUtils.isIE()||n.redirect||e)){var s=this;s.oauthWindow_=pxt.BrowserUtils.popupWindow(r,lf("Login with Microsoft"),483,600),s.oauthInterval_=window.setInterval(function(){s.oauthWindow_.closed&&(window.clearInterval(s.oauthInterval_),pxt.BrowserUtils.changeHash("",!0),window.location.reload())},1e3),i=!!s.oauthWindow_}i||(window.location.href=r)},l.prototype.registerCallback=function(o,a,e,t){window.activeRenewals[a]=o,window.callBacksMappedToRenewStates[o]||(window.callBacksMappedToRenewStates[o]=[]),window.callBacksMappedToRenewStates[o].push({resolve:e,reject:t}),window.callBackMappedToRenewStates[o]||(window.callBackMappedToRenewStates[o]=function(e,t,n,r){window.activeRenewals[a]=null;for(var i=0;i<window.callBacksMappedToRenewStates[o].length;++i)try{e||n?window.callBacksMappedToRenewStates[o][i].reject(e+"|"+n):t&&window.callBacksMappedToRenewStates[o][i].resolve(t)}catch(e){}window.callBacksMappedToRenewStates[o]=null,window.callBackMappedToRenewStates[o]=null})},l.prototype.loadIframeTimeout=function(e,t,n){var r=this,i=window.activeRenewals[n];pxt.debug("Set loading state to pending for: "+n+":"+i),pxt.storage.setLocal("renewStatus"+i,"In Progress"),this.loadFrame(e,t),setTimeout(function(){"In Progress"===pxt.storage.getLocal("renewStatus"+i)&&(pxt.debug("Loading frame has timed out after: "+r.loadFrameTimeout/1e3+" seconds for scope "+n+":"+i),i&&window.callBackMappedToRenewStates[i]&&window.callBackMappedToRenewStates[i]("Token renewal operation failed due to timeout",null,"Token Renewal Failed","access_token"),pxt.storage.setLocal("renewStatus"+i,"Canceled"))},this.loadFrameTimeout)},l.prototype.loadFrame=function(t,e){var n=this;pxt.debug("LoadFrame: "+e);var r=e;setTimeout(function(){var e=n.addAdalFrame(r);""!==e.src&&"about:blank"!==e.src||(e.src=t)},500)},l.prototype.addAdalFrame=function(e){if(void 0===e)return null;var t=document.getElementById(e);if(!t){if(document.createElement&&document.documentElement&&-1===window.navigator.userAgent.indexOf("MSIE 5.0")){var n=document.createElement("iframe");n.setAttribute("id",e),n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",t=document.getElementsByTagName("body")[0].appendChild(n)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeend",'<iframe name="'+e+'" id="'+e+'" style="display:none"></iframe>');window.frames&&window.frames[e]&&(t=window.frames[e])}return t},l.prototype.getUserInfoAsync=function(){var t=this;return this.getJsonAsync("/me").then(function(e){return{name:e.displayName||lf("{0} User",t.friendlyName),loginHint:e.userPrincipalName,id:e.id}})},l.prototype.listAsync=function(){var a=this;return this.getJsonAsync(f+"/children?select=@microsoft.graph.downloadUrl,lastModifiedDateTime,cTag,id,name").then(function(e){for(var t=a.fileSuffix(),n=[],r=0,i=e.value||[];r<i.length;r++){var o=i[r];h.endsWith(o.name.toLowerCase(),t)&&(a.entryCache[o.id]=o,n.push({id:o.id,name:o.name,version:o.cTag,updatedAt:a.parseTime(o.lastModifiedDateTime)}))}return console.log("resp",e),n})},l.prototype.downloadAsync=function(o){return c(this,void 0,void 0,function(){var t,n,r,i;return u(this,function(e){switch(e.label){case 0:return t=this.entryCache[o],n=!1,t&&t["@microsoft.graph.downloadUrl"]?[3,2]:[4,this.getJsonAsync("/me/drive/items/"+o)];case 1:t=e.sent(),this.entryCache[o]=t,n=!0,e.label=2;case 2:return e.trys.push([2,4,,5]),[4,h.requestAsync({url:t["@microsoft.graph.downloadUrl"]})];case 3:return r=e.sent(),[2,{id:o,version:t.cTag,name:t.name||"?",updatedAt:this.parseTime(r.headers["last-modified"]),content:JSON.parse(r.text)}];case 4:if(i=e.sent(),!n)return delete t["@microsoft.graph.downloadUrl"],[2,this.downloadAsync(o)];throw i;case 5:return[2]}})})},l.prototype.uploadAsync=function(o,a,s){return c(this,void 0,void 0,function(){var t,n,r,i;return u(this,function(e){switch(e.label){case 0:return console.log("1drive uploadAsync",o,a),(t=this.entryCache[o||"???"])&&delete t["@microsoft.graph.downloadUrl"],n="/me/drive/items/"+o+"/content",o||(r=JSON.parse(s[pxt.CONFIG_NAME]),n=f+":/"+encodeURIComponent(this.createFileNameWithSuffix(r.name))+":/content?@microsoft.graph.conflictBehavior=rename"),[4,this.reqAsync({url:n,method:"PUT",data:JSON.stringify(s,null,1),headers:a?{"if-match":a}:{}})];case 1:return 412==(i=e.sent()).statusCode?[2,void 0]:(300<=i.statusCode&&this.syncError(lf("Can't upload file to {0}",this.friendlyName)),t=i.json,[2,{id:(this.entryCache[t.id]=t).id,version:t.cTag,updatedAt:h.nowSeconds(),name:t.name}])}})})},l.prototype.updateAsync=function(n,r){return c(this,void 0,void 0,function(){var t;return u(this,function(e){switch(e.label){case 0:return t={name:this.createFileNameWithSuffix(r)},[4,this.reqAsync({url:"/me/drive/items/"+n,method:"PATCH",data:JSON.stringify(t),headers:{"Content-type":"application/json"}})];case 1:return 400<=e.sent().statusCode&&this.syncError(lf("Can't rename {0} file",this.friendlyName)),[2]}})})},l.prototype.deleteAsync=function(t){return c(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return[4,this.reqAsync({url:"/me/drive/items/"+t,method:"DELETE"})];case 1:return 204!=e.sent().statusCode&&this.syncError(lf("Can't delete {0} file",this.friendlyName)),delete this.entryCache[t],[2]}})})},l.ONEDRIVE_SCOPE="Files.ReadWrite User.Read",l}(d.ProviderBase);n.Provider=o},{"./cloudsync":11,"./core":41}],81:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var l=e("./workspace"),a=e("./data"),i=e("./core"),n=e("./db"),v=pxt.Util,r=new n.Table("hostcache"),o={ts:10,blocks:20,json:30,md:40};s.setupAppTarget=function(e){pxt.setAppTarget(e)};var y=function(){function e(e,t,n){this.epkg=e,this.name=t,this.content=n,this.inSyncWithEditor=!0,this.inSyncWithDisk=!0}return e.prototype.isReadonly=function(){return!this.epkg.header},e.prototype.getName=function(){return this.epkg.getPkgId()+"/"+this.name},e.prototype.getTypeScriptName=function(){return this.epkg.isTopLevel()?this.name:"pxt_modules/"+this.epkg.getPkgId()+"/"+this.name},e.prototype.getExtension=function(){var e=/\.([^\.]+)$/.exec(this.name);return e?e[1]:""},e.prototype.getVirtualFileName=function(e){var t=this.name.replace(/.*\./,""),n=t?this.name.slice(0,-t.length-1):this.name;if(/^blocks|py|ts$/.test(t))switch(e){case pxt.BLOCKS_PROJECT_NAME:return n+".blocks";case pxt.JAVASCRIPT_PROJECT_NAME:return n+".ts";case pxt.PYTHON_PROJECT_NAME:return n+".py";default:return void pxt.U.oops()}},e.prototype.weight=function(){return/^main\./.test(this.name)?5:o.hasOwnProperty(this.getExtension())?o[this.getExtension()]:60},e.prototype.markDirty=function(){this.inSyncWithEditor=!1,this.updateStatus()},e.prototype.updateStatus=function(){a.invalidate("open-meta:"+this.getName())},e.prototype.setBaseGitContent=function(e){e!=this.baseGitContent&&(this.baseGitContent=e,this.updateStatus())},e.prototype.setContentAsync=function(e,t){var n=this;if(v.assert(void 0!==e),this.inSyncWithEditor=!0,e!=this.content){var r=this.content;return this.inSyncWithDisk=!1,this.content=e,this.updateStatus(),this.epkg.saveFilesAsync().then(function(){n.content==e&&(n.inSyncWithDisk=!0,n.updateStatus()),t&&n.forceChangeCallback&&n.forceChangeCallback(r,e),n.name==pxt.github.GIT_JSON&&n.epkg.updateGitJsonCache()})}return this.updateStatus(),Promise.resolve()},e.prototype.setForceChangeCallback=function(e){this.forceChangeCallback=e},e.prototype.publishedContent=function(){var e=this.content;return this.name==pxt.CONFIG_NAME&&(e=l.prepareConfigForGithub(e)),e},e}();s.File=y;var c=function(){function e(e,t){this.ksPkg=e,this.topPkg=t,this.files={},this.onupdate=function(){},this.saveScheduled=!1,this.savingNow=0,this.simStateSaveScheduled=!1,e&&"workspace"==e.verProtocol()&&(this.header=l.getHeader(e.verArgument()))}return e.prototype.getSimState=function(){if(!this.simState){this.files[pxt.SIMSTATE_JSON]||this.setFile(pxt.SIMSTATE_JSON,"{}");var e=this.files[pxt.SIMSTATE_JSON];try{this.simState=JSON.parse(e.content)}catch(e){this.simState={}}}return this.simState},e.prototype.setSimState=function(e,t){var n=this,r=this.getSimState();r[e]!=t&&(null==t?delete r[e]:r[e]=t,this.simStateSaveScheduled||(this.simStateSaveScheduled=!0,setTimeout(function(){if(n.simStateSaveScheduled=!1,n.simState){var e=n.files[pxt.SIMSTATE_JSON];e&&e.setContentAsync(JSON.stringify(n.simState)).done()}},2e3)))},e.prototype.getTopHeader=function(){return this.topPkg.header},e.prototype.afterMainLoadAsync=function(){return this.assetsPkg?this.assetsPkg.loadAssetsAsync():Promise.resolve()},e.prototype.saveAssetAsync=function(e,t){var n=this;return l.saveAssetAsync(this.header.id,e,t).then(function(){return n.assetsPkg.loadAssetsAsync()})},e.prototype.loadAssetsAsync=function(){var g=this;return"assets"!=this.id?Promise.resolve():l.listAssetsAsync(this.topPkg.header.id).then(function(r){for(var e=v.flatClone(g.files),t=0,n=r;t<n.length;t++){var i=n[t],o=i.name,a=v.lookup(g.files,o);a?delete e[o]:(a=new y(g,o,"File size: "+i.size+"; URL: "+i.url),g.files[o]=a)}for(var s=0,l=Object.keys(e);s<l.length;s++){var c=l[s];delete g.files[c]}for(var u="",p=function(t){var e=r.filter(function(e){return e.name==t.name})[0],n=t.name.replace(/\..*/,"").replace(/[^a-zA-Z0-9_]/g,"_");u+="    export const "+n+' = "'+e.url+'";\n'},d=0,f=g.sortedFiles();d<f.length;d++)p(f[d]);var h=g.topPkg.lookupFile("assets.ts");if(h||u){u="namespace assets {\n"+u+"}\n";var m=g.topPkg.ksPkg.config;if(m.files.indexOf("assets.ts")<0&&(m.files.push("assets.ts"),g.topPkg.ksPkg.saveConfig()),h)return h.setContentAsync(u);g.topPkg.setFile("assets.ts",u)}return Promise.resolve()})},e.prototype.makeTopLevel=function(){(this.topPkg=this).outputPkg=new e(null,this),this.outputPkg.id="built",pxt.appTarget.runtime&&pxt.appTarget.runtime.assetExtensions&&(this.assetsPkg=new e(null,this),this.assetsPkg.id="assets")},e.prototype.updateConfigAsync=function(e){var t=this,n=this.files[pxt.CONFIG_NAME];if(n)try{var r=JSON.parse(n.content);return e(r),n.setContentAsync(pxt.Package.stringifyConfig(r)).then(function(){return t.ksPkg.loadConfig()})}catch(e){}return null},e.prototype.updateDepAsync=function(e){var t=this,n=this.ksPkg.resolveDep(e);if(!n||"github"!=n.verProtocol())return Promise.resolve();var r=pxt.github.parseRepoId(n.verArgument());return pxt.targetConfigAsync().then(function(e){return pxt.github.latestVersionAsync(r.fullName,e.packages)}).then(function(e){r.tag=e}).then(function(){return pxt.github.pkgConfigAsync(r.fullName,r.tag)}).catch(i.handleNetworkError).then(function(e){return t.addDepAsync(e.name,pxt.github.stringifyRepo(r))})},e.prototype.removeDepAsync=function(t){var e=this;return this.updateConfigAsync(function(e){return delete e.dependencies[t]}).then(function(){return e.saveFilesAsync(!0)})},e.prototype.addDepAsync=function(t,n){var e=this;return this.updateConfigAsync(function(e){return e.dependencies[t]=n}).then(function(){return e.saveFilesAsync(!0)})},e.prototype.getKsPkg=function(){return this.ksPkg},e.prototype.getPkgId=function(){return this.ksPkg?this.ksPkg.id:this.id},e.prototype.isTopLevel=function(){return this.ksPkg&&0==this.ksPkg.level},e.prototype.setFile=function(e,t,n){var r=new y(this,e,t);return n&&(r.virtual=!0),this.files[e]=r,a.invalidate("open-meta:"),r},e.prototype.removeFileAsync=function(t){return delete this.files[t],a.invalidate("open-meta:"),this.updateConfigAsync(function(e){e.files=e.files.filter(function(e){return e!=t}),e.testFiles&&(e.testFiles=e.testFiles.filter(function(e){return e!=t}))})},e.prototype.setContentAsync=function(t,e){var n=this,r=this.files[t],i=Promise.resolve();return r||(r=this.setFile(t,e),(i=i.then(function(){return n.updateConfigAsync(function(e){return e.files.indexOf(t)<0?e.files.push(t):0})})).then(function(){return n.savePkgAsync()})),i.then(function(){return r.setContentAsync(e)})},e.prototype.updateGitJsonCache=function(){var e=this.files[pxt.github.GIT_JSON];if(e){var t=JSON.parse(e.content);if(t.commit)for(var n=0,r=t.commit.tree.tree;n<r.length;n++){var i=r[n],o=this.files[i.path];o&&null!=i.blobContent&&o.setBaseGitContent(i.blobContent)}}},e.prototype.setFiles=function(e){var n=this;this.files=v.mapMap(e,function(e,t){return new y(n,e,t)}),a.invalidate("open-meta:"),this.updateGitJsonCache()},e.prototype.updateStatus=function(){a.invalidate("pkg-status:"+this.header.id)},e.prototype.savePkgAsync=function(){var e=this;return this.header.blobCurrent?Promise.resolve():(this.savingNow++,this.updateStatus(),l.saveToCloudAsync(this.header).then(function(){e.savingNow--,e.updateStatus(),e.header.blobCurrent||e.scheduleSave()}))},e.prototype.scheduleSave=function(){var e=this;this.saveScheduled||(this.saveScheduled=!0,setTimeout(function(){e.saveScheduled=!1,e.savePkgAsync().done()},5e3))},e.prototype.getAllFiles=function(){var e=v.mapMap(this.files,function(e,t){return t.content});return delete e[pxt.SERIAL_EDITOR_FILE],e},e.prototype.saveFilesAsync=function(e){var t=this;if(!this.header)return Promise.resolve();var n=this.files[pxt.CONFIG_NAME];if(n)try{var r=JSON.parse(n.content);this.header.name=r.name}catch(e){}return l.saveAsync(this.header,this.getAllFiles()).then(function(){return e?t.savePkgAsync():t.scheduleSave()})},e.prototype.sortedFiles=function(){var e=v.values(this.files);return pxt.options.debug||(e=e.filter(function(e){return e.name!=pxt.github.GIT_JSON&&e.name!=pxt.SIMSTATE_JSON&&e.name!=pxt.SERIAL_EDITOR_FILE})),e.sort(function(e,t){return e.weight()-t.weight()||v.strcmp(e.name,t.name)}),e},e.prototype.forEachFile=function(t){this.pkgAndDeps().forEach(function(e){v.values(e.files).forEach(t)})},e.prototype.getMainFile=function(){return this.sortedFiles()[0]},e.prototype.pkgAndDeps=function(){if(this.topPkg!=this)return this.topPkg.pkgAndDeps();for(var e=this.ksPkg.deps,t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];/---/.test(i)||e[i].cppOnly||t.push(p(e[i]))}return this.assetsPkg&&t.push(this.assetsPkg),t.push(this.outputPkg),t},e.prototype.filterFiles=function(t){return v.concat(this.pkgAndDeps().map(function(e){return v.values(e.files).filter(t)}))},e.prototype.lookupFile=function(t){return 0===t.indexOf("pxt_modules/")&&(t=t.slice(12)),this.filterFiles(function(e){return e.getName()==t})[0]},e}();s.EditorPackage=c;var u=new(function(){function e(){}return e.prototype.readFile=function(e,t){var n=p(e).files[t];return n?n.content:null},e.prototype.writeFile=function(e,t,n,r){if(t!=pxt.CONFIG_NAME&&!r)throw v.oops("trying to write "+e+" / "+t);p(e).files[t].setContentAsync(n,r).done()},e.prototype.getHexInfoAsync=function(e){return pxt.hex.getHexInfoAsync(this,e).catch(i.handleNetworkError)},e.prototype.cacheStoreAsync=function(t,e){return r.forceSetAsync({id:t,val:e}).then(function(){},function(e){pxt.tickEvent("cache.store.failed",{error:e.name}),pxt.log("cache store failed for "+t+": "+e.name)})},e.prototype.cacheGetAsync=function(e){return r.getAsync(e).then(function(e){return e.val},function(e){return null})},e.prototype.downloadPackageAsync=function(n){var e=n.verProtocol(),r=p(n),t=function(t){return l.getTextAsync(t).then(function(e){return r.isTopLevel()||e?e?r.isTopLevel()&&r.header?l.recomputeHeaderFlagsAsync(r.header,e).then(function(){return r.setFiles(e)}):(r.setFiles(e),Promise.resolve()):Promise.reject(new Error("Cannot find text for package '"+t+"' in the workspace.")):(n.configureAsInvalidPackage("cannot find '"+t+"' in the workspace."),Promise.resolve())})};if("pub"==e)return l.getPublishedScriptAsync(n.verArgument()).then(function(e){return r.setFiles(e)});if("github"==e)return l.getPublishedScriptAsync(n.version()).then(function(e){return r.setFiles(e)});if("workspace"==e)return t(n.verArgument());if("file"==e){var i=n.verArgument();return"."==i[0]&&(i=(n.parent.verArgument()+"/"+i).replace(/\/+/g,"/").replace(/[^\/]+\/\.\.\//g,"").replace(/\/\.\//g,"/")),t(i)}if("embed"==e)return r.setFiles(pxt.getEmbeddedScript(n.verArgument())),Promise.resolve();if("pkg"==e){var o=s.mainPkg.readFile(n.verArgument().replace(/^\.\//,"")),a=ts.pxtc.Util.jsonTryParse(o);return a?r.setFiles(a):pxt.log("failed to resolve "+n.version()),Promise.resolve()}return"invalid"==e?(pxt.log("skipping invalid pkg "+n.id),Promise.resolve()):Promise.reject("Cannot download "+n.version()+"; unknown protocol")},e}());function p(e){var t=e._editorPkg;if(t)return t;var n=null;e!=s.mainPkg&&(n=p(s.mainPkg));var r=new c(e,n);return e==s.mainPkg&&r.makeTopLevel(),e._editorPkg=r}function d(){return p(s.mainPkg)}function f(){return p(s.mainPkg).pkgAndDeps()}s.mainPkg=new pxt.MainPackage(u),s.getEditorPkg=p,s.mainEditorPkg=d,s.genFileName=function(e){var t=d().header.name.replace(/[()\\\/.,?*^:<>!;'#$%^&|"@+={}\[\]~`\x00-\x1F]/g,"");if(t=t.trim().replace(/\s+/g,"-"),pxt.appTarget.appTheme&&pxt.appTarget.appTheme.fileNameExclusiveFilter){var n=new RegExp(pxt.appTarget.appTheme.fileNameExclusiveFilter,"g");t=t.replace(n,"")}return t||(t="Untitled"),(pxt.appTarget.nickname||pxt.appTarget.id)+"-"+t+e},s.allEditorPkgs=f,s.notifySyncDone=function(t){0<v.values(s.mainPkg.deps).filter(function(e){return"workspace"==e.verProtocol()&&t.hasOwnProperty(e.verArgument())}).length&&p(s.mainPkg).onupdate()},s.loadPkgAsync=function(e,t){return s.mainPkg=new pxt.MainPackage(u),s.mainPkg._verspec="workspace:"+e,u.downloadPackageAsync(s.mainPkg).catch(i.handleNetworkError).then(function(){return ts.pxtc.Util.jsonTryParse(u.readFile(s.mainPkg,pxt.CONFIG_NAME))}).then(function(e){return e?s.mainPkg.installAllAsync(t).then(function(){return d().afterMainLoadAsync()}):(s.mainPkg.configureAsInvalidPackage(lf("invalid pxt.json file")),d().afterMainLoadAsync())})},a.mountVirtualApi("open-meta",{getSync:function(e){e=a.stripProtocol(e);var t=d(),n=t.lookupFile(e);if(!n)return{};var r=!(!t.header||!t.header.githubId||n.epkg!=t),i={isReadonly:n.isReadonly(),isSaved:n.inSyncWithEditor&&n.inSyncWithDisk,numErrors:n.numDiagnosticsOverride,isGitModified:r&&n.baseGitContent!=n.publishedContent()};return null==i.numErrors&&(i.numErrors=n.diagnostics?n.diagnostics.length:0,i.diagnostics=n.diagnostics),i}}),a.mountVirtualApi("open-pkg-meta",{getSync:function(t){t=a.stripProtocol(t);var e=f().filter(function(e){return e.getPkgId()==t})[0];if(!e||"built"==e.getPkgId())return{};var n=e.sortedFiles(),r=n.reduce(function(e,t){return e+(t.numDiagnosticsOverride||(t.diagnostics?t.diagnostics.length:0)||0)},0),i=e.getKsPkg();i&&i.invalid()&&r++;var o={numErrors:r};return r&&(o.diagnostics=[],n.filter(function(e){return!!e.diagnostics}).forEach(function(e){return o.diagnostics.concat(e.diagnostics)})),o}}),a.mountVirtualApi("pkg-git-status",{getSync:function(t){t=a.stripProtocol(t);var e=f().find(function(e){return e.header&&e.header.id==t}),n={};if(e&&(n.id="this"==e.getPkgId()&&e.header&&e.header.githubId,n.id)){var r=e.sortedFiles();n.modified=!!r.find(function(e){return e.baseGitContent!=e.publishedContent()})}return n}}),a.mountVirtualApi("pkg-status",{getSync:function(t){t=a.stripProtocol(t);var e=f().find(function(e){return e.header&&e.header.id==t});return e&&e.savingNow?"saving":""}})},{"./core":41,"./data":44,"./db":45,"./workspace":105}],82:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o=this&&this.__awaiter||function(o,a,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((l=l.apply(o,a||[])).next())})},a=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},l=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var g=e("react"),c=e("react-dom"),u=e("./data"),v=e("./sui"),p=e("./core"),d=e("./cloud"),f=e("./cloudsync"),h=e("./discourse"),m=e("./codecard"),y=e("./carousel"),b=e("./dialogs"),_=function(n){function e(e){var t=n.call(this,e)||this;return t.state={visible:!1},t.showLanguagePicker=t.showLanguagePicker.bind(t),t.showAboutDialog=t.showAboutDialog.bind(t),t.chgHeader=t.chgHeader.bind(t),t.chgGallery=t.chgGallery.bind(t),t.chgCode=t.chgCode.bind(t),t.importProject=t.importProject.bind(t),t.showScriptManager=t.showScriptManager.bind(t),t.cloudSignIn=t.cloudSignIn.bind(t),t.setSelected=t.setSelected.bind(t),t}return i(e,n),e.prototype.shouldComponentUpdate=function(e,t,n){return this.state.visible!=t.visible||this.state.searchFor!=t.searchFor||this.state.selectedCategory!=t.selectedCategory||this.state.selectedIndex!=t.selectedIndex},e.prototype.setSelected=function(e,t){null==t||this.state.selectedCategory==e&&this.state.selectedIndex==t?this.setState({selectedCategory:void 0,selectedIndex:void 0}):this.setState({selectedCategory:e,selectedIndex:t})},e.prototype.componentDidUpdate=function(e,t){this.state.selectedCategory!==t.selectedCategory&&this.ensureSelectedItemVisible()},e.prototype.ensureSelectedItemVisible=function(){var e=this.refs.activeCarousel;if(e){var t=e.getCarouselDOM();this.scrollElementIntoViewIfNeeded(t)}},e.prototype.scrollElementIntoViewIfNeeded=function(e){var t=c.findDOMNode(this.refs.homeContainer),n=e.getBoundingClientRect().top;t.parentElement.scrollTop=t.parentElement.scrollTop+n-30},e.prototype.showLanguagePicker=function(){pxt.tickEvent("projects.langpicker"),this.props.parent.showLanguagePicker()},e.prototype.showAboutDialog=function(){b.showAboutDialogAsync(this.props.parent)},e.prototype.chgHeader=function(e){pxt.tickEvent("projects.header"),p.showLoading("changeheader",lf("loading...")),this.props.parent.loadHeaderAsync(e).done(function(){p.hideLoading("changeheader")})},e.prototype.chgGallery=function(e){switch(pxt.tickEvent("projects.gallery",{name:e.name}),e.cardType){case"template":var t=pxt.Util.clone(pxt.appTarget.blocksprj);t.config.dependencies={},this.chgCode(e,!0,t);break;case"example":this.chgCode(e,!0);break;case"codeExample":this.chgCode(e,!1);break;case"side":this.props.parent.newEmptyProject(e.name,e.url);break;case"tutorial":this.props.parent.startTutorial(e.url,e.name);break;default:var n=/^\/#tutorial:([a-z0A-Z0-9\-\/]+)$/.exec(e.url);if(n)this.props.parent.startTutorial(n[1]);else{if(e.youTubeId&&!e.url)return;if(/^https:\/\//i.test(e.url))return;if(e.url){if(/^\//i.test(e.url))return;p.errorNotification(lf("Sorry, the project url looks invalid."))}else this.props.parent.newEmptyProject(e.name.toLowerCase())}}},e.prototype.chgCode=function(e,t,n){return this.props.parent.importExampleAsync({name:e.name,path:e.url,loadBlocks:t,prj:n})},e.prototype.importProject=function(){pxt.tickEvent("projects.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.importProjectDialog()},e.prototype.showScriptManager=function(){pxt.tickEvent("projects.showall.header",void 0,{interactiveConsent:!0}),this.props.parent.showScriptManager()},e.prototype.cloudSignIn=function(){pxt.tickEvent("projects.signin",void 0,{interactiveConsent:!0}),this.props.parent.cloudSignInDialog()},e.prototype.renderCore=function(){var t=this,e=this.state,n=e.selectedCategory,r=e.selectedIndex,i=pxt.appTarget.appTheme,o=this.getData("target-config:"),a=pxt.Util.userLanguage(),s={};o&&o.localizedGalleries&&o.localizedGalleries[a]&&pxt.Util.jsonCopyFrom(s,o.localizedGalleries[a]),o&&o.galleries&&pxt.Util.jsonCopyFrom(s,o.galleries);var l=!!i.homeScreenHero,c=v.cx(["ui segment bottom attached tab active tabsegment"]);return g.createElement("div",{ref:"homeContainer",className:c,role:"main"},l?g.createElement("div",{className:"ui segment getting-started-segment",style:{backgroundImage:"url("+encodeURI(i.homeScreenHero)+")"}}):void 0,g.createElement("div",{key:"mystuff_gallerysegment",className:"ui segment gallerysegment mystuff-segment",role:"region","aria-label":lf("My Projects")},g.createElement("div",{className:"ui grid equal width padded heading"},g.createElement("div",{className:"column",style:{zIndex:1}},i.scriptManager?g.createElement("h2",{role:"button",className:"ui header myproject-header",title:lf("See all projects"),tabIndex:0,onClick:this.showScriptManager,onKeyDown:v.fireClickOnEnter},lf("My Projects"),g.createElement("span",{className:"ui grid-dialog-btn"},g.createElement(v.Icon,{icon:"angle right"}))):g.createElement("h2",{className:"ui header"},lf("My Projects"))),g.createElement("div",{className:"column right aligned",style:{zIndex:1}},pxt.appTarget.compile||pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing?g.createElement(v.Button,{key:"import",icon:"upload",className:"import-dialog-btn",textClass:"landscape only",text:lf("Import"),title:lf("Import a project"),onClick:this.importProject}):void 0)),g.createElement("div",{className:"content"},g.createElement(x,{key:"mystuff_carousel",parent:this.props.parent,name:"recent",onClick:this.chgHeader}))),Object.keys(s).map(function(e){return g.createElement("div",{key:e+"_gallerysegment",className:"ui segment gallerysegment",role:"region","aria-label":pxt.Util.rlf(e)},g.createElement("h2",{className:"ui header heading"},pxt.Util.rlf(e)," "),g.createElement("div",{className:"content"},g.createElement(x,{ref:n==e?"activeCarousel":"",key:e+"_carousel",parent:t.props.parent,name:e,path:s[e],onClick:t.chgGallery,setSelected:t.setSelected,selectedIndex:n==e?r:void 0})))}),i.organizationUrl||i.organizationUrl||i.privacyUrl||i.copyrightText?g.createElement("div",{className:"ui horizontal small divided link list homefooter"},i.organizationUrl&&i.organization?g.createElement("a",{className:"item",target:"_blank",rel:"noopener noreferrer",href:i.organizationUrl},i.organization):void 0,i.selectLanguage?g.createElement(v.Link,{className:"item",icon:"xicon globe",text:lf("Language"),onClick:this.showLanguagePicker,onKeyDown:v.fireClickOnEnter}):void 0,i.termsOfUseUrl?g.createElement("a",{target:"_blank",className:"item",href:i.termsOfUseUrl,rel:"noopener noreferrer"},lf("Terms of Use")):void 0,i.privacyUrl?g.createElement("a",{target:"_blank",className:"item",href:i.privacyUrl,rel:"noopener noreferrer"},lf("Privacy")):void 0,pxt.appTarget.versions?g.createElement(v.Link,{className:"item",text:"v"+pxt.appTarget.versions.target,onClick:this.showAboutDialog,onKeyDown:v.fireClickOnEnter}):void 0,i.copyrightText?g.createElement("div",{className:"ui item copyright"},i.copyrightText):void 0):void 0)},e}(u.Component);n.Projects=_;var w=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.showLanguagePicker=t.showLanguagePicker.bind(t),t.toggleHighContrast=t.toggleHighContrast.bind(t),t.showResetDialog=t.showResetDialog.bind(t),t.showAboutDialog=t.showAboutDialog.bind(t),t.signOutGithub=t.signOutGithub.bind(t),t}return i(e,n),e.prototype.showLanguagePicker=function(){pxt.tickEvent("home.langpicker",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()},e.prototype.toggleHighContrast=function(){pxt.tickEvent("home.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()},e.prototype.toggleGreenScreen=function(){pxt.tickEvent("home.togglegreenscreen",void 0,{interactiveConsent:!0}),this.props.parent.toggleGreenScreen()},e.prototype.showResetDialog=function(){pxt.tickEvent("home.reset",void 0,{interactiveConsent:!0}),this.props.parent.showResetDialog()},e.prototype.showAboutDialog=function(){pxt.tickEvent("home.about"),this.props.parent.showAboutDialog()},e.prototype.signOutGithub=function(){pxt.tickEvent("home.github.signout");var e=f.githubProvider();e&&(e.logout(),this.props.parent.forceUpdate(),p.infoNotification(lf("Signed out from GitHub")))},e.prototype.renderCore=function(){var e=this.state.highContrast,t=pxt.appTarget.appTheme,n=this.getData("github:user");return g.createElement(v.DropdownMenu,{role:"menuitem",icon:"setting large",title:lf("More..."),className:"item icon more-dropdown-menuitem"},t.selectLanguage?g.createElement(v.Item,{icon:"xicon globe",role:"menuitem",text:lf("Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?g.createElement(v.Item,{role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,n?g.createElement("div",{className:"ui divider"}):void 0,n?g.createElement("div",{className:"ui item",title:lf("Sign out {0} from GitHub",n.name),role:"menuitem",onClick:this.signOutGithub},g.createElement("div",{className:"avatar",role:"presentation"},g.createElement("img",{className:"ui circular image",src:n.photo,alt:lf("User picture")})),lf("Sign out")):void 0,g.createElement("div",{className:"ui divider"}),g.createElement(v.Item,{role:"menuitem",text:lf("About..."),onClick:this.showAboutDialog}),g.createElement(v.Item,{role:"menuitem",icon:"sign out",text:lf("Reset"),onClick:this.showResetDialog}),t.feedbackUrl?g.createElement("a",{className:"ui item",href:t.feedbackUrl,role:"menuitem",title:lf("Give Feedback"),target:"_blank",rel:"noopener noreferrer"},lf("Give Feedback")):void 0)},e}(u.Component);n.ProjectSettingsMenu=w;var k=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.brandIconClick=t.brandIconClick.bind(t),t.orgIconClick=t.orgIconClick.bind(t),t}return i(e,n),e.prototype.brandIconClick=function(){pxt.tickEvent("projects.brand",void 0,{interactiveConsent:!0})},e.prototype.orgIconClick=function(){pxt.tickEvent("projects.org",void 0,{interactiveConsent:!0})},e.prototype.shouldComponentUpdate=function(e,t,n){return!1},e.prototype.renderCore=function(){var e=pxt.appTarget.appTheme,t=this.hasCloud();return g.createElement("div",{id:"homemenu",className:"ui borderless fixed "+(e.invertedMenu?"inverted":"")+" menu",role:"menubar"},g.createElement("div",{className:"left menu"},g.createElement("a",{href:e.logoUrl,"aria-label":lf("{0} Logo",e.boardName),role:"menuitem",target:"blank",rel:"noopener",className:"ui item logo brand",onClick:this.brandIconClick},e.logo||e.portraitLogo?g.createElement("img",{className:"ui "+(e.logoWide?"small":"")+" logo "+(e.logo?" portrait hide":""),src:e.logo||e.portraitLogo,alt:lf("{0} Logo",e.boardName)}):g.createElement("span",{className:"name"},e.boardName),e.portraitLogo?g.createElement("img",{className:"ui "+(e.logoWide?"small":"mini")+" image portrait only",src:e.portraitLogo,alt:lf("{0} Logo",e.boardName)}):null)),g.createElement("div",{className:"ui item home mobile hide"},g.createElement(v.Icon,{icon:"icon home large"})," ",g.createElement("span",null,lf("Home"))),g.createElement("div",{className:"right menu"},t?g.createElement(d.UserMenu,{parent:this.props.parent}):void 0,g.createElement(w,{parent:this.props.parent,highContrast:this.props.parent.state.highContrast}),g.createElement("a",{href:e.organizationUrl,target:"blank",rel:"noopener",className:"ui item logo organization",onClick:this.orgIconClick},e.organizationWideLogo||e.organizationLogo?g.createElement("img",{className:"ui logo "+(e.organizationWideLogo?" portrait hide":""),src:e.organizationWideLogo||e.organizationLogo,alt:lf("{0} Logo",e.organization)}):g.createElement("span",{className:"name"},e.organization),e.organizationLogo?g.createElement("img",{className:"ui mini image portrait only",src:e.organizationLogo,alt:lf("{0} Logo",e.organization)}):null)),e.betaUrl?g.createElement("a",{href:""+e.betaUrl,className:"ui red mini corner top left attached label betalabel",role:"menuitem"},lf("Beta")):void 0)},e}(u.Component);n.ProjectsMenu=k;var x=function(n){function u(e){var t=n.call(this,e)||this;return t.prevGalleries=[],t.hasFetchErrors=!1,t.state={},t.closeDetail=t.closeDetail.bind(t),t.closeDetailOnEscape=t.closeDetailOnEscape.bind(t),t.reload=t.reload.bind(t),t.newProject=t.newProject.bind(t),t.showScriptManager=t.showScriptManager.bind(t),t.handleCardClick=t.handleCardClick.bind(t),t}return i(u,n),u.prototype.componentDidMount=function(){this.props.parent.state.header&&this.latestProject&&this.latestProject.element&&this.latestProject.element.focus()},u.prototype.fetchGallery=function(e){var t=this.getData("gallery:"+encodeURIComponent(e));return t&&(t instanceof Error?this.hasFetchErrors=!0:this.prevGalleries=pxt.Util.concat(t.map(function(e){return e.cards}))),this.prevGalleries||[]},u.prototype.fetchLocalData=function(){return this.getData("header:*")},u.prototype.newProject=function(){var t=this;pxt.tickEvent("projects.new",void 0,{interactiveConsent:!0}),pxt.appTarget.appTheme.nameProjectFirst?this.props.parent.askForProjectNameAsync().then(function(e){t.props.parent.newProject({name:e})}):this.props.parent.newProject({name:name})},u.prototype.showScriptManager=function(){pxt.tickEvent("projects.showscriptmanager",void 0,{interactiveConsent:!0}),this.props.parent.showScriptManager()},u.prototype.closeDetail=function(){var e=this.props.name;pxt.tickEvent("projects.detail.close"),this.props.setSelected(e,void 0)},u.prototype.getCarouselDOM=function(){return c.findDOMNode(this.refs.carousel)},u.prototype.getDetailDOM=function(){return c.findDOMNode(this.refs.detailView)},u.prototype.closeDetailOnEscape=function(e){p.keyCodeFromEvent(e)==p.ESC_KEY&&(this.closeDetail(),document.removeEventListener("keydown",this.closeDetailOnEscape),e.preventDefault())},u.prototype.componentWillReceiveProps=function(e){null!=e.selectedIndex&&document.addEventListener("keydown",this.closeDetailOnEscape)},u.prototype.reload=function(){this.setState({})},u.prototype.handleCardClick=function(e,t,n){var r=this.props.name;this.props.setSelected?(pxt.tickEvent("projects.detail.open"),this.props.setSelected(r,n)):this.props.onClick(t)},u.prototype.renderCore=function(){var i=this,e=this.props,n=(e.name,e.path),t=e.selectedIndex,r=pxt.appTarget.appTheme;if(n){this.hasFetchErrors=!1;var o=this.fetchGallery(n);if(this.hasFetchErrors)return g.createElement("div",{className:"ui carouselouter"},g.createElement("div",{role:"button",className:"carouselcontainer",tabIndex:0,onClick:this.reload},g.createElement("p",{className:"ui grey inverted segment"},lf("Oops, please connect to the Internet and try again."))));var a=o[t];return g.createElement("div",null,g.createElement(y.Carousel,{ref:"carousel",bleedPercent:20,selectedIndex:t},o.map(function(e,t){return g.createElement(E,{className:"example",key:n+(e.name||e.url),name:e.name,url:e.url,imageUrl:e.imageUrl,youTubeId:e.youTubeId,buttonLabel:e.buttonLabel,label:e.label,labelClass:e.labelClass,tags:e.tags,scr:e,index:t,onCardClick:i.handleCardClick,cardType:e.cardType,tutorialStep:e.tutorialStep,tutorialLength:e.tutorialLength})})),a&&g.createElement("div",{ref:"detailView",className:"detailview"},g.createElement(v.CloseButton,{onClick:this.closeDetail}),g.createElement(C,{parent:this.props.parent,name:a.name,key:"detail"+a.name,description:a.description,url:a.url,imageUrl:a.imageUrl,largeImageUrl:a.largeImageUrl,videoUrl:a.videoUrl,youTubeId:a.youTubeId,buttonLabel:a.buttonLabel,scr:a,onClick:this.props.onClick,cardType:a.cardType,tags:a.tags})))}var s=this.fetchLocalData(),l=pxt.appTarget.appTheme&&!pxt.appTarget.appTheme.hideNewProjectButton,c=r.scriptManager&&s.length>u.NUM_PROJECTS_HOMESCREEN;return g.createElement(y.Carousel,{bleedPercent:20},l?g.createElement("div",{role:"button",className:"ui card link buttoncard newprojectcard",title:lf("Creates a new empty project"),onClick:this.newProject,onKeyDown:v.fireClickOnEnter},g.createElement("div",{className:"content"},g.createElement(v.Icon,{icon:"huge add circle"}),g.createElement("span",{className:"header"},lf("New Project")))):void 0,s.slice(0,u.NUM_PROJECTS_HOMESCREEN).map(function(e,t){var n=e.tutorial?e.tutorial.tutorialStep:e.tutorialCompleted?e.tutorialCompleted.steps-1:void 0,r=e.tutorial?e.tutorial.tutorialStepInfo.length:e.tutorialCompleted?e.tutorialCompleted.steps:void 0;return g.createElement(E,{key:"local"+e.id+e.recentUse,cardType:"file",name:e.name,time:e.recentUse,url:e.pubId&&e.pubCurrent?"/"+e.pubId:"",scr:e,index:t,onCardClick:i.handleCardClick,tutorialStep:n,tutorialLength:r})}),c?g.createElement("div",{role:"button",className:"ui card link buttoncard scriptmanagercard",title:lf("See all projects"),onClick:this.showScriptManager,onKeyDown:v.fireClickOnEnter},g.createElement("div",{className:"content"},g.createElement(v.Icon,{icon:"huge right angle"}),g.createElement("span",{className:"header"},lf("See all projects")))):void 0)},u.NUM_PROJECTS_HOMESCREEN=8,u}(u.Component);n.ProjectsCarousel=x;var E=function(n){function e(e){var t=n.call(this,e)||this;return t.handleClick=t.handleClick.bind(t),t.handleLabelClick=t.handleLabelClick.bind(t),t}return i(e,n),e.prototype.handleClick=function(e){this.props.onCardClick(e,this.props.scr,this.props.index)},e.prototype.handleLabelClick=function(e){this.props.onLabelClick(e,this.props.scr,this.props.index)},e.prototype.renderCore=function(){var e=this.props,t=e.scr,n=(e.onCardClick,e.onLabelClick),r=(e.onClick,e.cardType),i=e.imageUrl,o=e.className,a=l(e,["scr","onCardClick","onLabelClick","onClick","cardType","imageUrl","className"]);return o=o||"",t&&"file"==r&&(t.githubId?o="file github "+o:t.extensionUnderTest?o="file test "+o:t.board?(o="file board "+o,i=pxt.bundledSvg(t.board)):o="file "+o),g.createElement(m.CodeCardView,s({className:o,imageUrl:i,cardType:r},a,{onClick:this.handleClick,onLabelClicked:n?this.handleLabelClick:void 0}))},e}(v.StatelessUIElement);n.ProjectsCodeCard=E;var C=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.handleDetailClick=t.handleDetailClick.bind(t),t.handleOpenForumUrlInEditor=t.handleOpenForumUrlInEditor.bind(t),t.linkRef=g.createRef(),t}return i(e,n),e.prototype.isLink=function(){var e=this.props,t=e.cardType,n=e.url,r=e.youTubeId;return function(e){switch(t){case"file":case"example":case"codeExample":case"tutorial":case"side":case"template":case"package":case"hw":return!1;case"forumUrl":default:return!0}}()&&(r||n)},e.prototype.getUrl=function(){var e=this.props,t=e.url,n=e.youTubeId;return n&&!t?"https://youtu.be/"+n:/^https:\/\//i.test(t)||/^\//i.test(t)?t:""},e.prototype.handleDetailClick=function(){var e=this.props,t=e.scr;(0,e.onClick)(t)},e.prototype.handleOpenForumUrlInEditor=function(){var e=this.props.url;h.extractSharedIdFromPostUrl(e).then(function(e){e?window.location.hash="pub:"+e:p.warningNotification(lf("Oops, we could not find the program in the forum."))}).catch(p.handleNetworkError)},e.prototype.componentDidMount=function(){this.linkRef&&this.linkRef.current&&this.linkRef.current.focus()},e.prototype.renderCore=function(){var e=this.props,t=e.name,n=e.description,r=e.imageUrl,i=e.largeImageUrl,o=e.videoUrl,a=e.youTubeId,s=e.buttonLabel,l=e.cardType,c=e.tags,u=pxt.appTarget.appTheme.tagColors||{},p=n&&n.split("\n"),d=i||r||a&&"https://img.youtube.com/vi/"+a+"/0.jpg",f=!pxt.BrowserUtils.isElectron()&&o,h=lf("Show Instructions");s?h=ts.pxtc.Util.rlf(s):"tutorial"==l?h=lf("Start Tutorial"):"codeExample"==l||"example"==l?h=lf("Open Example"):"forumUrl"==l?h=lf("Open in Forum"):"template"==l?h=lf("New Project"):a&&(h=lf("Play Video"));var m=this.isLink()?g.createElement(v.Link,{href:this.getUrl(),refCallback:this.linkRef,target:"_blank",text:h,className:"ui button approve huge positive"}):g.createElement(v.Button,{text:h,className:"approve huge positive",onClick:this.handleDetailClick,onKeyDown:v.fireClickOnEnter,autoFocus:!0});return g.createElement("div",{className:"ui grid stackable padded"},(f||d)&&g.createElement("div",{className:"imagewrapper"},f?g.createElement("video",{className:"video",src:f,autoPlay:!0,controls:!1,loop:!0,playsInline:!0}):g.createElement("div",{className:"image",style:{backgroundImage:'url("'+d+'")'}})),g.createElement("div",{className:"column twelve wide"},g.createElement("div",{className:"segment"},g.createElement("div",{className:"header"}," ",t," "),c&&g.createElement("div",{className:"ui labels"},c.map(function(e){return g.createElement("div",{className:"ui "+(u[e]||"")+" label"},pxt.Util.rlf(e))})),p&&p.map(function(e,t){return g.createElement("p",{key:"line"+t,className:"detail"},e)}),g.createElement("div",{className:"actions"},m,"forumUrl"===l&&g.createElement(v.Button,{text:lf("Open in Editor"),className:"approve huge",onClick:this.handleOpenForumUrlInEditor,onKeyDown:v.fireClickOnEnter})))))},e}(u.Component);n.ProjectsDetail=C;var S=function(n){function e(e){var t=n.call(this,e)||this;return t.state={visible:!1},t.close=t.close.bind(t),t.importHex=t.importHex.bind(t),t.importUrl=t.importUrl.bind(t),t.cloneGithub=t.cloneGithub.bind(t),t}return i(e,n),e.prototype.hide=function(){this.setState({visible:!1})},e.prototype.close=function(){this.setState({visible:!1})},e.prototype.show=function(){this.setState({visible:!0})},e.prototype.importHex=function(){pxt.tickEvent("projects.import",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportFileDialog()},e.prototype.importUrl=function(){pxt.tickEvent("projects.importurl",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportUrlDialog()},e.prototype.cloneGithub=function(){return o(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return pxt.tickEvent("github.projects.clone",void 0,{interactiveConsent:!0}),this.hide(),[4,f.githubProvider().loginAsync()];case 1:return e.sent(),pxt.github.token&&this.props.parent.showImportGithubDialog(),[2]}})})},e.prototype.renderCore=function(){var e=this.state.visible,t=pxt.appTarget.appTheme.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac());return g.createElement(v.Modal,{isOpen:e,className:"importdialog",size:"small",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Import"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},g.createElement("div",{className:pxt.github.token?"ui three cards":"ui two cards"},pxt.appTarget.compile&&!t?g.createElement(m.CodeCardView,{ariaLabel:lf("Open files from your computer"),role:"button",key:"import",icon:"upload",iconColor:"secondary",name:lf("Import File..."),description:lf("Open files from your computer"),onClick:this.importHex}):void 0,pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing?g.createElement(m.CodeCardView,{ariaLabel:lf("Open a shared project URL or GitHub repo"),role:"button",key:"importurl",icon:"cloud download",iconColor:"secondary",name:lf("Import URL..."),description:lf("Open a shared project URL or GitHub repo"),onClick:this.importUrl}):void 0,pxt.appTarget.cloud&&pxt.appTarget.cloud.githubPackages?g.createElement(m.CodeCardView,{ariaLabel:lf("Clone or create your own GitHub repository"),role:"button",key:"importgithub",icon:"github",iconColor:"secondary",name:lf("Your GitHub Repo..."),description:lf("Clone or create your own GitHub repository"),onClick:this.cloneGithub}):void 0))},e}(u.Component);n.ImportDialog=S;var T=function(n){function e(e){var t=n.call(this,e)||this;return t.state={visible:!1,emoji:""},t.hide=t.hide.bind(t),t.modalDidOpen=t.modalDidOpen.bind(t),t.handleChange=t.handleChange.bind(t),t.save=t.save.bind(t),t.skip=t.skip.bind(t),t}return i(e,n),e.prototype.componentWillReceiveProps=function(e){this.handleChange(e.parent.state.projectName)},e.prototype.hide=function(){this.setState({visible:!1})},e.prototype.show=function(){pxt.tickEvent("exitandsave.show",void 0,{interactiveConsent:!1}),this.setState({visible:!0})},e.prototype.modalDidOpen=function(n){var e=document.getElementById("projectNameInput");e&&(pxt.BrowserUtils.isMobile()||e.setSelectionRange(0,9999),e.onkeydown=function(e){if(p.keyCodeFromEvent(e)===p.ENTER_KEY){e.preventDefault();var t=n.getElementsByClassName("approve positive").item(0);t&&t.click()}})},e.prototype.handleChange=function(n){this.setState({projectName:n});var r=lf("Untitled");if(!(n=n||"")||pxt.Util.toArray(r).some(function(e,t){return r.substr(0,t+1)==n}))this.setState({emoji:""});else{var e=["","","",""],t=e[Math.min(n.length,e.length)-1],i=n.length>>1;if(e.length<i)for(var o=0;o<Math.min(2,i-e.length);++o)t+=e[e.length-1];this.setState({emoji:t})}},e.prototype.skip=function(){pxt.tickEvent("exitandsave.skip",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.openHome()},e.prototype.save=function(){var e=this,t=this.state.projectName;this.hide();var n=Promise.resolve();t&&this.props.parent.state.projectName!=t&&(pxt.tickEvent("exitandsave.projectrename",{length:t&&t.length},{interactiveConsent:!0}),n=n.then(function(){return e.props.parent.updateHeaderNameAsync(t)})),n.done(function(){e.props.parent.openHome()})},e.prototype.headerText=function(){return lf("Project has no name {0}",this.state.emoji)},e.prototype.actions=function(){return[{label:lf("Save"),onclick:this.save,icon:"check",className:"approve positive"},{label:lf("Skip"),onclick:this.skip}]},e.prototype.renderCore=function(){var e=this.state,t=e.visible,n=e.projectName;return g.createElement(v.Modal,{isOpen:t,className:"exitandsave",size:"tiny",onClose:this.hide,dimmer:!0,buttons:this.actions(),closeIcon:!0,header:this.headerText(),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0,modalDidOpen:this.modalDidOpen},g.createElement("div",null,g.createElement("p",null,lf("Give your project a name.")),g.createElement("div",{className:"ui form"},g.createElement(v.Input,{ref:"filenameinput",autoFocus:!pxt.BrowserUtils.isMobile(),id:"projectNameInput",ariaLabel:lf("Type a name for your project"),autoComplete:!1,value:n||"",onChange:this.handleChange}))))},e}(u.Component),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.headerText=function(){return lf("Your project needs a name {0}",this.state.emoji)},t.prototype.actions=function(){return[{label:lf("Create"),onclick:this.save,icon:"check",className:"approve positive"}]},t.prototype.askNameAsync=function(){var t=this;return this.setState({projectName:"",emoji:""}),this.show(),new Promise(function(e){t.nameCb=e})},t.prototype.skip=function(){this.hide()},t.prototype.save=function(){var e=this.state.projectName;this.hide(),this.nameCb&&this.nameCb(e),this.nameCb=null},t}(n.ExitAndSaveDialog=T);n.NewProjectNameDialog=A;var N=function(n){function e(e){var t=n.call(this,e)||this;return t.prevGalleries=[],t.state={visible:!1},t.close=t.close.bind(t),t}return i(e,n),e.prototype.hide=function(){this.setState({visible:!1})},e.prototype.close=function(){this.setState({visible:!1})},e.prototype.show=function(){this.setState({visible:!0})},e.prototype.fetchGallery=function(){var e=this.getData("gallery:"+encodeURIComponent("/hardware"));return e&&(e instanceof Error||(this.prevGalleries=pxt.Util.concat(e.map(function(e){return e.cards})).filter(function(e){return!!e.variant}))),this.prevGalleries||[]},e.prototype.setHwVariant=function(e,t){pxt.tickEvent("projects.choosehwvariant",{hwid:e.name,card:t?t.name:e.name},{interactiveConsent:!0}),this.hide(),pxt.setHwVariant(e.name);var n=this.props.parent;n.reloadHeaderAsync().then(function(){return n.compile()}).done()},e.prototype.renderCore=function(){var r=this,e=this.state.visible;if(!e)return g.createElement("div",null);for(var i=pxt.getHwVariants(),t=function(e){e.card||(e.card={name:e.description});var t=e;e.card.onClick=function(){return r.setHwVariant(t,null)}},n=0,o=i;n<o.length;n++)t(o[n]);for(var a=this.fetchGallery(),s=function(t){var e=i.find(function(e){return e.name==t.variant}),n=t;e?t.onClick=function(){return r.setHwVariant(e,n)}:pxt.reportError("hw","invalid variant")},l=0,c=a;l<c.length;l++)s(c[l]);return a=a.filter(function(e){return!!e.onClick}),g.createElement(v.Modal,{isOpen:e,className:"hardwaredialog",size:"large",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Choose your hardware"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},g.createElement("div",{className:"group"},g.createElement("div",{className:"ui cards centered",role:"listbox"},a.map(function(e){return g.createElement(m.CodeCardView,{key:"card"+e.name,name:e.name,ariaLabel:e.name,description:e.description,imageUrl:e.imageUrl,learnMoreUrl:e.url,onClick:e.onClick})}),i.map(function(e){return g.createElement(m.CodeCardView,{key:"variant"+e.name,name:e.card.name,ariaLabel:e.card.name,description:e.card.description,imageUrl:e.card.imageUrl,learnMoreUrl:e.card.learnMoreUrl,onClick:e.card.onClick})}))),g.createElement("p",null,g.createElement("br",null),g.createElement("br",null),lf("No hardware? Or want to add some?")," ",g.createElement("a",{className:"small",href:"/hardware",target:"_blank",rel:"noopener noreferrer","aria-label":lf("Learn more about hardware")},lf("Learn more!"))))},e}(u.Component);n.ChooseHwDialog=N},{"./carousel":9,"./cloud":10,"./cloudsync":11,"./codecard":13,"./core":41,"./data":44,"./dialogs":51,"./discourse":52,"./sui":100,react:284,"react-dom":240}],83:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./package"),s=e("./srceditor"),l=e("./sui"),c=e("./core"),u=e("./data"),p=pxt.Util,d=function(n){function e(e){var t=n.call(this,e)||this;return t.parent=e,t.config={},t.changeMade=!1,t.handleNameInputRef=function(e){t.nameInput=e},t.editSettingsText=t.editSettingsText.bind(t),t.save=t.save.bind(t),t.setFileName=t.setFileName.bind(t),t.isUserConfigActive=t.isUserConfigActive.bind(t),t.applyUserConfig=t.applyUserConfig.bind(t),t.goBack=t.goBack.bind(t),t}return i(e,n),e.prototype.goBack=function(){pxt.tickEvent("pxtjson.backButton",void 0,{interactiveConsent:!0}),this.parent.openPreviousEditor()},e.prototype.prepare=function(){this.isReady=!0},e.prototype.getId=function(){return"pxtJsonEditor"},e.prototype.hasEditorToolbar=function(){return!1},e.prototype.save=function(){var e=this,t=this.config;if(this.isSaving=!0,!t.name)return c.errorNotification(lf("Please choose a project name. It can't be blank.")),void(this.isSaving=!1);a.mainEditorPkg().lookupFile("this/"+pxt.CONFIG_NAME).setContentAsync(pxt.Package.stringifyConfig(t)).then(function(){a.mainPkg.config.name=t.name,e.parent.setState({projectName:t.name}),e.parent.forceUpdate(),p.nextTick(e.changeCallback),e.isSaving=!1,e.changeMade=!0,e.parent.openPreviousEditor(),c.resetFocus()})},e.prototype.setFileName=function(e){this.config.name=e,this.parent.forceUpdate()},e.prototype.optionaldepConfig=function(){var t={};return a.mainPkg.sortedDeps().filter(function(e){return e.config&&e.config.yotta&&e.config.yotta.optionalConfig}).forEach(function(e){return p.jsonMergeFrom(t,e.config.yotta.optionalConfig)}),t},e.prototype.isUserConfigActive=function(e){var t=this.optionaldepConfig();this.config.yotta&&this.config.yotta.config&&p.jsonMergeFrom(t,this.config.yotta.config),t=p.jsonFlatten(t);var n=p.jsonFlatten(e.config);return!Object.keys(n).some(function(e){return null===n[e]?!!t[e]:t[e]!==n[e]})},e.prototype.applyUserConfig=function(e){p.jsonFlatten(this.optionaldepConfig());var t=p.jsonFlatten(this.config.yotta?this.config.yotta.config:{}),n=p.jsonFlatten(e.config);this.isUserConfigActive(e)?Object.keys(n).forEach(function(e){delete t[e]}):Object.keys(n).forEach(function(e){return t[e]=n[e]}),Object.keys(t).length?(this.config.yotta||(this.config.yotta={}),this.config.yotta.config=p.jsonUnFlatten(t)):this.config.yotta&&(delete this.config.yotta.config,Object.keys(this.config.yotta).length||delete this.config.yotta),this.save()},e.prototype.display=function(){var t=this;if(this.isVisible){var e=this.config,n=[];return a.allEditorPkgs().map(function(e){return e.getKsPkg()}).filter(function(e){return!!e&&e.isLoaded&&!!e.config&&!!e.config.yotta&&!!e.config.yotta.userConfigs}).forEach(function(e){return n=n.concat(e.config.yotta.userConfigs)}),o.createElement("div",{className:"ui content"},o.createElement("h3",{className:"ui small header"},o.createElement("div",{className:"content"},o.createElement(l.Button,{title:lf("Go back"),tabIndex:0,onClick:this.goBack,onKeyDown:l.fireClickOnEnter},o.createElement(l.Icon,{icon:"arrow left"}),o.createElement("span",{className:"ui text landscape only"},lf("Go back"))))),o.createElement("div",{className:"ui segment form text"},o.createElement(l.Input,{ref:this.handleNameInputRef,id:"fileNameInput",label:lf("Name"),ariaLabel:lf("Type a name for your project"),value:e.name||"",onChange:this.setFileName,autoComplete:!1}),n.map(function(e){return o.createElement(f,{key:"userconfig-"+e.description,uc:e,isUserConfigActive:t.isUserConfigActive,applyUserConfig:t.applyUserConfig})}),o.createElement(l.Field,null,o.createElement(l.Button,{text:lf("Save"),className:"green "+(this.isSaving?"disabled":""),onClick:this.save}),o.createElement(l.Button,{text:lf("Edit Settings As text"),onClick:this.editSettingsText}))))}},e.prototype.isIncomplete=function(){return!this.changeMade},e.prototype.editSettingsText=function(){this.changeMade=!1,this.parent.editText()},e.prototype.getCurrentSource=function(){return pxt.Package.stringifyConfig(this.config)},e.prototype.acceptsFile=function(e){if(e.name!=pxt.CONFIG_NAME)return!1;if(e.isReadonly())return!1;try{return JSON.parse(e.content),!0}catch(e){return!1}},e.prototype.loadFileAsync=function(e){return this.config=JSON.parse(e.content),this.nameInput&&this.nameInput.clearValue(),this.setDiagnostics(e,this.snapshotState()),this.changeMade=!1,Promise.resolve()},e.prototype.unloadFileAsync=function(){return this.changeMade?this.parent.reloadHeaderAsync():Promise.resolve()},e}(s.Editor);n.Editor=d;var f=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.isUserConfigActive=t.isUserConfigActive.bind(t),t.applyUserConfig=t.applyUserConfig.bind(t),t}return i(e,n),e.prototype.isUserConfigActive=function(){var e=this.props;return e.applyUserConfig,(0,e.isUserConfigActive)(e.uc)},e.prototype.applyUserConfig=function(){var e=this.props,t=e.applyUserConfig;e.isUserConfigActive,t(e.uc)},e.prototype.renderCore=function(){var e=this.props.uc,t=this.isUserConfigActive();return o.createElement(l.Checkbox,{key:"userconfig-"+e.description,inputLabel:pxt.Util.rlf(e.description),checked:t,onChange:this.applyUserConfig})},e}(u.Component)},{"./core":41,"./data":44,"./package":81,"./srceditor":99,"./sui":100,react:284}],84:[function(e,t,n){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.renderAsync=function(r){return(i||(i=pxt.BrowserUtils.loadScriptAsync("qrcode/qrcode.min.js").then(function(){return"undefined"!=typeof qrcode}).catch(function(e){return!1})),i).then(function(e){if(e){var t=qrcode(0,"L"),n=/^(https.*\/)([0-9-]+)$/.exec(r);return n?(t.addData(n[1].toUpperCase(),"Alphanumeric"),t.addData(n[2].replace(/-/g,""),"Numeric")):(n=/^(https.*\/)(_[a-zA-Z0-9]+)$/.exec(r))?(t.addData(n[1].toUpperCase(),"Alphanumeric"),t.addData(n[2],"Byte")):t.addData(r,"Byte"),t.make(),t.createDataURL(5,5)}}).catch(function(e){pxt.reportException(e)})}},{}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./workspace"),o=e("./data");function a(e,t){var n=0,r=0,i=0,o=0;t.height>t.width?(n=0,o=(i=t.width)/e.width*e.height,r=(t.height-o)/2):(r=0,i=(o=t.height)/e.height*e.width,n=(t.width-i)/2),e.getContext("2d").drawImage(t,n,r,i,o,0,0,e.width,e.height)}n.saveAsync=function(n,r){return pxt.BrowserUtils.loadImageAsync(r).then(function(e){var t=function(e){var t=null;if(e&&0<e.width&&0<e.height){var n=document.createElement("canvas");n.width=305,n.height=200,a(n,e),t=n.toDataURL("image/jpeg",85)}return t}(e);return i.saveScreenshotAsync(n,r,t).then(function(){o.invalidate("header:"+n.id),o.invalidate("header:*")})})};var v=1496611453,y=36;function r(){return pxt.BrowserUtils.loadImageAsync(pxt.appTarget.appTheme.logo).then(function(e){var t=document.createElement("canvas");t.width=160,t.height=120;var n=t.getContext("2d"),r=pxt.appTarget.appTheme.accentColor;return r&&(n.fillStyle=r,n.fillRect(0,0,t.width,t.height)),a(t,e),t}).catch(function(){return function(){var e=document.createElement("canvas");e.width=160,e.height=120;var t=e.getContext("2d");return t.fillStyle="#33b",t.fillRect(0,0,160,120),t.font="30px monospace",t.fillStyle="#fff",t.fillText(":(",60,70),Promise.resolve(e)}()})}n.decodeBlobAsync=function(e){return pxt.BrowserUtils.loadCanvasAsync(e).then(function(e){var s=e.getContext("2d").getImageData(0,0,e.width,e.height).data,t=1&s[0]|(1&s[1])<<1|(1&s[2])<<2;if(5<t)return Promise.reject(new Error(lf("Invalid encoded PNG format")));function n(e,t,n){for(var r=0,i=0,o=0,a=(1<<t)-1;i<n.length;)o|=(s[e++]&a)<<r,3==(3&e)&&e++,8<=(r+=t)&&(n[i++]=255&o,o>>=8,r-=8);return e}var r=new Uint8Array(y),i=n(4,t,r),o=pxt.HF2.decodeU32LE(r);if(o[0]!=v)return Promise.reject(new Error(lf("Invalid magic in encoded PNG")));var a=new Uint8Array(o[1]),l=o[2];if(0<l){var c=(e.height-l)*e.width,u=new Uint8Array((3*(c-1)*t>>3)-y);n(i,t,u),a.set(u);var p=new Uint8Array(a.length-u.length);n(4*c,8,p),a.set(p,u.length)}else n(i,t,a);return a})},n.encodeBlobAsync=function(t,e,g){return(e?pxt.BrowserUtils.loadCanvasAsync(e):r()).catch(function(){return r()}).then(function(e){return function(e,t){var n=e.width,r=e.height,i=document.createElement("canvas");i.width=n+16+16,i.height=r+16+16+32;var o=i.getContext("2d");o.imageSmoothingEnabled=!1,o.fillStyle="white",o.fillRect(0,0,i.width,i.height),o.drawImage(e,16,16);var a=pxt.appTarget.thumbnailName||pxt.appTarget.name;if(a){var s=12;o.fillStyle="black",o.font="10px monospace",o.fillText(a,16,s,n-16)}t&&(s=32+r+4,o.fillStyle="black",o.font="13px monospace",o.fillText(t,16,s,n-16)),s=32+r+4+16,o.fillStyle="#444",o.font="10px monospace";var l=pxt.appTarget.appTheme.homeUrl.replace(/^https:\/\//,"").replace(/\/$/,"");return o.fillText(l,16,s,n),i}(e,t)}).then(function(e){for(var t=y+g.length,n=3*(e.width*e.height-1),r=1;r<4&&!(8*t<=n*r);)r++;var i=n*r>>3,o=t-i,a=0,s=e.width*e.height*4;if(0<o){var l=3*e.width;a=Math.ceil(o/l);var c=document.createElement("canvas");c.width=e.width,c.height=e.height+a,c.getContext("2d").drawImage(e,0,0),e=c}var u=pxt.HF2.encodeU32LE([v,g.length,a,0,0,0,0,0,0]);function p(e,t,n,r){for(var i=0,o=0,a=r[o++],s=(1<<n)-1,l=!0;l;){var c=a>>i&s,u=8-i;if(u<=n){if(o>=r.length){if(0==u)break;l=!1}c|=(a=r[o++])<<u&s,i=n-u}else i+=n;e[t]=255&(e[t]&~s|c),3==(3&++t)&&(e[t++]=255)}return t}pxt.Util.assert(u.length==y);var d=e.getContext("2d"),f=d.getImageData(0,0,e.width,e.height);p(f.data,0,1,[r]);var h=4;if(h=p(f.data,h,r,u),pxt.Util.assert(0==(3&h)),0==a)h=p(f.data,h,r,g);else{var m=i-u.length;h=p(f.data,h,r,g.slice(0,m)),h=p(f.data,s,8,g.slice(m))}for(h|=3;h<f.data.length;)f.data[h]=255,h+=4;return d.putImageData(f,0,0),e.toDataURL("image/png")})};var s=function(){function e(e){this.options=e,this.cancellationToken=new pxt.Util.CancellationToken,this.options.maxFrames||(this.options.maxFrames=64)}return e.prototype.start=function(){pxt.debug("gif: start encoder"),this.gif=new GIF(this.options),this.time=-1,this.cancellationToken=new pxt.Util.CancellationToken,this.cancellationToken.startOperation(),this.renderPromise=void 0},e.prototype.cancel=function(){if(pxt.debug("gif: cancel"),!this.cancellationToken.isCancelled()){if(this.cancellationToken.cancel(),this.gif&&this.gif.running)try{this.gif.abort()}catch(e){}this.clean()}},e.prototype.clean=function(){this.gif&&this.gif.freeWorkers&&(this.gif.freeWorkers.forEach(function(e){return e.terminate()}),this.gif.freeWorkers=[]),this.gif=void 0,this.time=-1},e.prototype.addFrame=function(e,t){if(this.cancellationToken.isCancelled()||this.renderPromise)return!1;var n=pxt.Util.now();return this.time<0&&(this.time=n),void 0===t&&(t=n-this.time),pxt.debug("gif: frame "+t+"ms"),this.gif.addFrame(e,{delay:t}),this.time=n,this.gif.frames.length>this.options.maxFrames},e.prototype.renderAsync=function(){var n=this;if(this.cancellationToken.isCancelled())return Promise.resolve(void 0);var r=function(){return n.renderGifAsync().then(function(e){if(n.cancellationToken.throwIfCancelled(),n.options.maxLength&&e.length>n.options.maxLength){var t=Math.floor(n.gif.frames.length*n.options.maxLength/e.length)-1;return pxt.log("gif: size too large ("+(e.length/1e3|0)+"kb) reducing frames to "+t),t<=0?void pxt.log("gif: simulator image too large, cannot have a single frame"):(n.gif.frames=n.gif.frames.slice(0,t),r())}return pxt.log("gif: rendered "+n.gif.frames.length+" frames to "+(e.length/1e3|0)+"kb"),e})};return pxt.debug("gif: render "+this.gif.frames.length+" frames"),this.renderPromise||(this.renderPromise=r().finally(function(){return n.clean()}).catch(function(e){pxt.debug("rendering failed"),pxt.debug(e)})),this.renderPromise},e.prototype.renderGifAsync=function(){var n=this;return this.cancellationToken.throwIfCancelled(),new Promise(function(t,e){n.gif.on("finished",function(e){n.gif.running=!1,t(e)}),n.gif.on("abort",function(){pxt.debug("gif: abort"),t(void 0)}),n.gif.render()}).then(function(e){return ts.pxtc.Util.blobReadAsDataURL(e)})},e}();n.GifEncoder=s,n.loadGifEncoderAsync=function(){if(!pxt.webConfig.gifworkerjs)return Promise.resolve(void 0);var e={workers:1,dither:!1,workerScript:pxt.webConfig.gifworkerjs,quality:pxt.appTarget.appTheme.simGifQuality||16,transparent:pxt.appTarget.appTheme.simGifTransparent,maxFrames:pxt.appTarget.appTheme.simGifMaxFrames||64,maxLength:pxt.appTarget.appTheme.simScreenshotMaxUriLength||3e5};return pxt.BrowserUtils.loadScriptAsync("gifjs/gif.js").then(function(){return new s(e)})}},{"./data":44,"./workspace":105}],86:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var h=e("react"),s=e("./data"),m=e("./sui"),l=e("./core"),c=e("./workspace"),u=e("./compiler"),g=e("./components/searchInput"),v=e("./projects"),p=function(t){function e(e){var i=t.call(this,e)||this;return i.handleKeyDown=function(e){var t=l.keyCodeFromEvent(e);(pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey)&&65===t&&i.handleSelectAll(e)},i.handleAreaClick=function(){i.setState({selected:{}})},i.handleSelectAll=function(e){var n=i.state.selected,t=i.getSortedHeaders();0<t.length&&t.length==Object.keys(n).length?n={}:t.forEach(function(e,t){n[t]=1}),i.setState({selected:n}),e.stopPropagation(),e.preventDefault()},i.toggleSortName=function(e){var t=i.state,n=t.sortedBy,r=t.sortedAsc;r=!("name"==n&&!e&&r),i.setState({sortedBy:"name",sortedAsc:r,markedNew:{},selected:{}})},i.toggleSortTime=function(e){var t=i.state,n=t.sortedAsc;n="time"==t.sortedBy&&!e&&!n,i.setState({sortedBy:"time",sortedAsc:n,markedNew:{},selected:{}})},i.handleSortName=function(){i.toggleSortName(!0)},i.handleSortTime=function(){i.toggleSortTime(!0)},i.handleToggleSortName=function(){i.toggleSortName(!1)},i.handleToggleSortTime=function(){i.toggleSortTime(!1)},i.handleSwitchSortDirection=function(){var e=i.state.sortedAsc;i.setState({sortedAsc:!e,markedNew:{},selected:{}})},i.state={visible:!1,selected:{},markedNew:{},view:"grid",sortedBy:"time",sortedAsc:!1},i.close=i.close.bind(i),i.handleCardClick=i.handleCardClick.bind(i),i.handleDelete=i.handleDelete.bind(i),i.handleOpen=i.handleOpen.bind(i),i.handleDuplicate=i.handleDuplicate.bind(i),i.handleSwitchView=i.handleSwitchView.bind(i),i.handleSearch=i.handleSearch.bind(i),i.handleCheckboxClick=i.handleCheckboxClick.bind(i),i}return i(e,t),e.prototype.hide=function(){this.setState({visible:!1,searchFor:void 0})},e.prototype.close=function(){this.setState({visible:!1,searchFor:void 0}),this.props.onClose&&this.props.onClose()},e.prototype.show=function(){this.setState({visible:!0}),u.projectSearchClear()},e.prototype.fetchLocalData=function(){return this.getData("headers:"+(this.state.searchFor||""))},e.prototype.handleCardClick=function(e,t,n,r){var i=e.shiftKey,o=r&&!i||(pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey),a=this.state,s=a.selected,l=a.multiSelect,c=a.multiSelectStart;if(!i||!o){if(o)s[n]?delete s[n]:s[n]=1,s[n]&&(c=n);else if(i){s={};for(var u=Math.min(n,c);u<=Math.max(n,c);u++)s[u]=1;l=!0}else l&&(l=!(s={}));i||o||(1==Object.keys(s).length&&s[n]?delete s[n]:((s={})[n]=1,c=n)),this.setState({selected:s,multiSelect:l,multiSelectStart:c}),e.stopPropagation(),e.preventDefault()}},e.prototype.handleCheckboxClick=function(e,t,n){this.handleCardClick(e,t,n,!0),e.preventDefault(),e.stopPropagation()},e.prototype.handleDelete=function(){var e=this,r=this.state.selected,t=this.getSortedHeaders(),n=Object.keys(r).length;l.confirmDelete(1==n?t[parseInt(Object.keys(r)[0])].name:n.toString(),function(){var n=[];return t.forEach(function(e,t){r[t]&&(e.isDeleted=!0,n.push(c.saveAsync(e,{})))}),e.setState({selected:{}}),Promise.all(n).then(function(){s.clearCache()})},1<n)},e.prototype.handleOpen=function(){var e=this.getSelectedHeader();l.showLoading("changeheader",lf("loading...")),this.props.parent.loadHeaderAsync(e).done(function(){l.hideLoading("changeheader")})},e.prototype.handleDuplicate=function(){var i=this,t=this.getSelectedHeader(),e={header:lf("Choose a new name for your project"),agreeLbl:lf("Duplicate"),agreeClass:"green approve positive",agreeIcon:"clone",initialValue:c.createDuplicateName(t),placeholder:lf("Enter your project name here"),size:"tiny"};return l.promptAsync(e).then(function(n){return null===n?Promise.resolve(!1):c.getTextAsync(t.id).then(function(e){return r=e,c.duplicateAsync(t,e,!1)}).then(function(e){i.props.parent.cloudSync()&&(e.cloudSync=!0),e.name=n,delete e.blobId,delete e.blobVersion,delete e.blobCurrent;var t=JSON.parse(r[pxt.CONFIG_NAME]);return t.name=e.name,r[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(t),e}).then(function(e){return c.saveAsync(e,r)}).then(function(){return s.invalidate("headers:"),s.invalidate("headers:"+i.state.searchFor),i.setState({selected:{},markedNew:{0:1},sortedBy:"time",sortedAsc:!1}),setTimeout(function(){i.setState({markedNew:{}})},5e3),!0});var r})},e.prototype.handleSwitchView=function(){var e="grid"==this.state.view?"list":"grid";this.setState({view:e})},e.prototype.handleSearch=function(e){this.setState({searchFor:e,selected:{}})},e.prototype.getSelectedHeader=function(){var e=this.state.selected,t=Object.keys(e);if(1!==t.length)return null;var n=parseInt(t[0]);return this.getSortedHeaders()[n]},e.prototype.getSortedHeaders=function(){var e=this.state,t=e.sortedBy,n=e.sortedAsc;return(this.fetchLocalData()||[]).sort(this.getSortingFunction(t,n))},e.prototype.getSortingFunction=function(n,r){return function(e,t){return"time"===n?r?e.modificationTime-t.modificationTime:t.modificationTime-e.modificationTime:r?e.name.localeCompare(t.name):t.name.localeCompare(e.name)}},e.prototype.renderCore=function(){var l=this,e=this.state,t=e.visible,c=e.selected,u=e.markedNew,n=e.view,r=e.searchFor,i=e.sortedBy,o=e.sortedAsc;if(!t)return h.createElement("div",null);var p="dark"==pxt.appTarget.appTheme.baseTheme,a=this.getSortedHeaders()||[];a=a.filter(function(e){return!e.isDeleted});var s,d=!!r||0<a.length,f=0<a.length&&a.length==Object.keys(c).length;return d&&((s=[]).push(h.createElement(g.SearchInput,{key:"search",ariaMessage:lf("{0} result matching '{1}'",a.length,r),placeholder:lf("Search..."),className:"mobile hide",searchHandler:this.handleSearch,disabled:!1,style:{flexGrow:1},searchOnChange:!0})),0<Object.keys(c).length&&(1==Object.keys(c).length&&(s.push(h.createElement(m.Button,{key:"edit",icon:"edit outline",className:"icon",text:lf("Open"),textClass:"landscape only",title:lf("Open Project"),onClick:this.handleOpen})),s.push(h.createElement(m.Button,{key:"clone",icon:"clone outline",className:"icon",text:lf("Duplicate"),textClass:"landscape only",title:lf("Duplicate Project"),onClick:this.handleDuplicate}))),s.push(h.createElement(m.Button,{key:"delete",icon:"trash",className:"icon red",text:lf("Delete"),textClass:"landscape only",title:lf("Delete Project"),onClick:this.handleDelete})),s.push(h.createElement("div",{key:"divider",className:"divider"}))),s.push(h.createElement(m.Button,{key:"view",icon:"grid"==n?"th list":"grid layout",className:"icon",title:""+("grid"==n?lf("List view"):lf("Grid view")),onClick:this.handleSwitchView}))),h.createElement(m.Modal,{isOpen:t,className:"scriptmanager",size:"fullscreen",onClose:this.close,dimmer:!0,header:lf("My Projects"),closeIcon:!0,headerActions:s,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},d?void 0:h.createElement("div",{className:"empty-content"},h.createElement("h2",{className:"ui center aligned header "+(p?"inverted":"")},h.createElement("div",{className:"content"},lf("It's empty in here"),h.createElement("div",{className:"sub header"},lf("Go back to create a new project"))))),d&&"grid"==n?h.createElement("div",{role:"button",className:"ui container fluid",style:{height:"100%"},onClick:this.handleAreaClick,onKeyDown:this.handleKeyDown},h.createElement("div",{className:"sort-by"},h.createElement("div",{role:"menu",className:"ui menu compact buttons"},h.createElement(m.DropdownMenu,{role:"menuitem",text:"time"==i?lf("Last Modified"):lf("Name"),title:lf("Sort by dropdown"),className:"inline button "+(p?"inverted":"")},h.createElement(m.Item,{role:"menuitem",icon:"name"==i?"check":void 0,className:("name"!=i?"no-icon":"")+" "+(p?"inverted":""),text:lf("Name"),tabIndex:-1,onClick:this.handleSortName}),h.createElement(m.Item,{role:"menuitem",icon:"time"==i?"check":void 0,className:("time"!=i?"no-icon":"")+" "+(p?"inverted":""),text:lf("Last Modified"),tabIndex:-1,onClick:this.handleSortTime})),h.createElement(m.Button,{role:"menuitem",icon:"arrow "+(o?"up":"down"),className:p?"inverted":"",onClick:this.handleSwitchSortDirection,title:lf("Switch sort order to {0}",o?lf("descending"):lf("ascending"))}))),h.createElement("div",{className:"ui cards"},a.sort(this.getSortingFunction(i,o)).map(function(e,t){var n=!!u[t],r=!!c[t],i=n&&!r,o="circle outline "+(r?"check":"")+" "+(r?"green":"grey")+" "+(p?"inverted":"");i&&(o=void 0);var a=i?"orange right ribbon label":"right corner label large selected-label",s=i?lf("New"):void 0;return h.createElement(v.ProjectsCodeCard,{key:"local"+e.id+e.recentUse,cardType:"file",className:"file "+(n?"warning":r?"positive":""),name:e.name,time:e.recentUse,url:e.pubId&&e.pubCurrent?"/"+e.pubId:"",scr:e,index:t,labelIcon:o,labelClass:a,label:s,onCardClick:l.handleCardClick,onLabelClick:l.handleCheckboxClick})}))):void 0,d&&"list"==n?h.createElement("div",{role:"table",className:"ui container",style:{height:"100%"},onClick:this.handleAreaClick,onKeyDown:this.handleKeyDown},h.createElement("table",{className:"ui definition unstackable table "+(p?"inverted":"")},h.createElement("thead",{className:"full-width"},h.createElement("tr",null,h.createElement("th",{onClick:this.handleSelectAll,tabIndex:0,onKeyDown:m.fireClickOnEnter,title:f?lf("De-select all projects"):lf("Select all projects"),style:{cursor:"pointer"}},h.createElement(m.Icon,{icon:"circle outline large "+(f?"check":"")})),h.createElement("th",{onClick:this.handleToggleSortName,tabIndex:0,onKeyDown:m.fireClickOnEnter,title:lf("Sort by Name {0}",o?lf("ascending"):lf("descending")),style:{cursor:"pointer"}},lf("Name")," ","name"==i?h.createElement(m.Icon,{icon:"arrow "+(o?"up":"down")}):void 0),h.createElement("th",{onClick:this.handleToggleSortTime,tabIndex:0,onKeyDown:m.fireClickOnEnter,title:lf("Sort by Last Modified {0}",o?lf("ascending"):lf("descending")),style:{cursor:"pointer"}},lf("Last Modified")," ","time"==i?h.createElement(m.Icon,{icon:"arrow "+(o?"up":"down")}):void 0))),h.createElement("tbody",null,a.sort(this.getSortingFunction(i,o)).map(function(e,t){var n=!!u[t],r=!!c[t],i=n&&!r;return h.createElement(y,{key:"local"+e.id+e.recentUse,selected:r,onRowClicked:l.handleCardClick,index:t,scr:e,markedNew:i},h.createElement("td",null,e.name),h.createElement("td",null,pxt.Util.timeSince(e.recentUse)))})))):void 0)},e}(s.Component);n.ScriptManagerDialog=p;var y=function(n){function e(e){var t=n.call(this,e)||this;return t.handleClick=t.handleClick.bind(t),t.handleCheckboxClick=t.handleCheckboxClick.bind(t),t}return i(e,n),e.prototype.handleClick=function(e){this.props.onRowClicked(e,this.props.scr,this.props.index)},e.prototype.handleCheckboxClick=function(e){this.props.onRowClicked(e,this.props.scr,this.props.index,!0),e.preventDefault(),e.stopPropagation()},e.prototype.renderCore=function(){var e=this.props,t=(e.scr,e.onRowClicked,e.onClick,e.selected),n=e.markedNew,r=e.children,i=a(e,["scr","onRowClicked","onClick","selected","markedNew","children"]);return h.createElement("tr",o({tabIndex:0},i,{onKeyDown:m.fireClickOnEnter,onClick:this.handleClick,style:{cursor:"pointer"},className:n?"warning":t?"positive":""}),h.createElement("td",{className:"collapsing",onClick:this.handleCheckboxClick},h.createElement(m.Icon,{icon:"circle outline large "+(t?"check green":n?"black":"")})),r)},e}(m.StatelessUIElement)},{"./compiler":14,"./components/searchInput":39,"./core":41,"./data":44,"./projects":82,"./sui":100,"./workspace":105,react:284}],87:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(n,"__esModule",{value:!0});var b,s,_=e("react"),l=e("react-dom"),w=e("./data"),k=e("./sui"),c=e("./package"),u=e("./core"),x=e("./codecard"),p=e("./electron"),d=e("./workspace"),E=e("./components/searchInput");(s=b=n.ScriptSearchMode||(n.ScriptSearchMode={}))[s.Extensions=0]="Extensions",s[s.Boards=1]="Boards",s[s.Experiments=2]="Experiments";var f=function(n){function e(e){var t=n.call(this,e)||this;return t.state={searchFor:"",visible:!1,mode:b.Extensions,closeIcon:!0},t.hide=t.hide.bind(t),t.handleSearch=t.handleSearch.bind(t),t.addUrl=t.addUrl.bind(t),t.addBundle=t.addBundle.bind(t),t.installGh=t.installGh.bind(t),t.addLocal=t.addLocal.bind(t),t.toggleExperiment=t.toggleExperiment.bind(t),t.importExtensionFile=t.importExtensionFile.bind(t),t}return i(e,n),e.prototype.hide=function(){this.setState({visible:!1}),this.state.mode==b.Experiments&&this.state.experimentsState!==pxt.editor.experiments.state()&&this.props.parent.reloadEditor()},e.prototype.afterHide=function(){var e=this.state.resolve;e&&(this.setState({resolve:void 0}),e())},e.prototype.showExtensions=function(){this.setState({visible:!0,searchFor:"",mode:b.Extensions,closeIcon:!0,features:void 0,resolve:void 0})},e.prototype.showBoardsAsync=function(n,r){var i=this;return new Promise(function(e,t){i.setState({visible:!0,searchFor:"",mode:b.Boards,closeIcon:!!r,features:n,resolve:e})})},e.prototype.showExperiments=function(){this.setState({visible:!0,searchFor:"",mode:b.Experiments,closeIcon:!0,experimentsState:pxt.editor.experiments.state(),features:void 0,resolve:void 0})},e.prototype.fetchUrlData=function(){var e={data:[],status:w.FetchStatus.Complete};if(!this.state.searchFor||this.state.mode!=b.Extensions)return e;var t=pxt.Cloud.parseScriptId(this.state.searchFor);if(!t)return e;var n=this.getDataWithStatus("cloud-search:"+t);return(!n.data||n.data&&404===n.data.statusCode)&&(n.data=[]),Array.isArray(n.data)||(n.data=[n.data]),n},e.prototype.fetchGhData=function(){var e={data:[],status:w.FetchStatus.Complete};if(this.state.mode!=b.Extensions)return e;var t=pxt.appTarget.cloud||{};if(!t.packages)return e;var n=t.githubPackages?this.state.searchFor:void 0;if(!n){var r=this.getDataWithStatus("target-config:"),i=r.data;r.status===w.FetchStatus.Complete&&i&&i.packages&&i.packages.preferredRepos&&(n=i.packages.preferredRepos.join("|"))}if(!n)return e;var o=this.getDataWithStatus("gh-search:"+n);return o.data&&404!==o.data.statusCode||(o.data=[]),o},e.prototype.fetchLocal=function(){return this.state.mode!=b.Extensions?[]:d.getHeaders().filter(function(e){return!!e.githubId})},e.prototype.fetchBundled=function(){if(this.state.mode!=b.Boards&&this.state.mode!=b.Extensions)return[];var t=this.state.searchFor,n=pxt.appTarget.bundledpkgs,r=this.state.mode==b.Boards,e=this.state.features;return Object.keys(n).filter(function(e){return!/prj$/.test(e)}).map(function(e){return JSON.parse(n[e]["pxt.json"])}).filter(function(e){return!e.hidden}).filter(function(e){return!t||-1<e.name.toLowerCase().indexOf(t.toLowerCase())}).filter(function(e){return r||!c.mainPkg.deps[e.name]||c.mainPkg.deps[e.name].cppOnly}).filter(function(e){return!/---/.test(e.name)}).filter(function(e){return r==!!e.core}).filter(function(t){return!e||e.every(function(e){return t.features&&-1<t.features.indexOf(e)})})},e.prototype.fetchExperiments=function(){return this.state.mode!=b.Experiments?[]:pxt.editor.experiments.all()},e.prototype.shouldComponentUpdate=function(e,t,n){return this.state.visible!=t.visible||this.state.searchFor!=t.searchFor||this.state.mode!=t.mode},e.prototype.componentDidUpdate=function(){var e=l.findDOMNode(this.refs.searchInput);e&&e.focus()},e.prototype.handleSearch=function(e){var t=/^\/@(.*)$/.exec(e),n=t&&t[1];if(n)if("devtools"===n&&pxt.BrowserUtils.isPxtElectron())p.openDevTools(),this.hide(),this.afterHide();else{var r=pxt.appTarget.appTheme.homeUrl;/\/$/.test(r)||(r+="/"),n=n.replace(/^\//,""),pxt.winrt.releaseAllDevicesAsync().then(function(){window.location.href=r+n}).done()}else this.setState({searchFor:e})},e.prototype.addUrl=function(e){var t=this;return this.hide(),c.mainEditorPkg().addDepAsync(e.name,"pub:"+e.id).then(function(){return t.props.parent.reloadHeaderAsync()}).finally(function(){return t.afterHide()})},e.prototype.addBundle=function(e){var t=this;pxt.tickEvent("packages.bundled",{name:e.name}),this.hide(),this.addDepIfNoConflict(e,"*").finally(function(){return t.afterHide()})},e.prototype.addLocal=function(n){var r=this;pxt.tickEvent("packages.local"),this.hide(),d.getTextAsync(n.id).then(function(e){var t=JSON.parse(e[pxt.CONFIG_NAME]);return r.addDepIfNoConflict(t,"workspace:"+n.id)}).finally(function(){return r.afterHide()})},e.prototype.installGh=function(n){var r=this;pxt.tickEvent("packages.github",{name:n.fullName}),this.hide(),u.showLoading("downloadingpackage",lf("downloading extension...")),pxt.packagesConfigAsync().then(function(e){return pxt.github.latestVersionAsync(n.fullName,e)}).then(function(t){return pxt.github.pkgConfigAsync(n.fullName,t).then(function(e){return u.hideLoading("downloadingpackage"),e}).then(function(e){return r.addDepIfNoConflict(e,"github:"+n.fullName+"#"+t)})}).catch(u.handleNetworkError).finally(function(){r.afterHide(),u.hideLoading("downloadingpackage")})},e.prototype.addDepIfNoConflict=function(i,o){var a=this;return c.mainPkg.findConflictsAsync(i,o).then(function(n){var e=i.core?[]:n.filter(function(e){return c.mainPkg.isPackageInUse(e.pkg0.id)}),t=Promise.resolve(!0);if(e.length)t=t.then(function(){return u.confirmAsync({header:lf("Cannot add {0} extension",i.name),hideCancel:!0,agreeLbl:lf("Ok"),body:lf("Remove all the blocks from the {0} extension and try again.",e[0].pkg0.id)})}).then(function(){return!1});else if(n.length){var r=1===n.length?lf("Extension {0} is incompatible with {1}. Remove {0} and add {1}?",n[0].pkg0.id,i.name):lf("Extensions {0} and {1} are incompatible with {2}. Remove them and add {2}?",n.slice(0,-1).map(function(e){return e.pkg0.id}).join(", "),n.slice(-1)[0].pkg0.id,i.name);t=t.then(function(){return a.state.mode==b.Boards?Promise.resolve(1):u.confirmAsync({header:lf("Some extensions will be removed"),agreeLbl:lf("Remove extension(s) and add {0}",i.name),agreeClass:"pink",body:r})}).then(function(e){if(0!==e){var t=c.mainEditorPkg();return Promise.all(n.map(function(e){return t.removeDepAsync(e.pkg0.id)})).then(function(){return!0})}return Promise.resolve(!1)})}return t.then(function(e){return e?c.mainEditorPkg().addDepAsync(i.name,o).then(function(){return a.props.parent.reloadHeaderAsync()}):Promise.resolve()})})},e.prototype.toggleExperiment=function(e){pxt.editor.experiments.toggle(e),pxt.tickEvent("experiments.toggle",{experiment:e.id,enabled:pxt.editor.experiments.isEnabled(e)?1:0},{interactiveConsent:!0}),this.forceUpdate()},e.prototype.importExtensionFile=function(){pxt.tickEvent("extensions.import",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportFileDialog({extension:!0})},e.prototype.renderCore=function(){var t=this,e=this.state,n=e.mode,r=e.closeIcon,i=e.visible,o=e.searchFor,a=e.experimentsState;if(!i)return _.createElement("div",null);var s=this.fetchBundled(),l=this.fetchGhData(),c=this.fetchUrlData(),u=this.fetchLocal(),p=this.fetchExperiments(),d=o&&(l.status===w.FetchStatus.Pending||c.status===w.FetchStatus.Pending),f=pxt.appTarget.appTheme.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),h=n==b.Extensions&&pxt.appTarget.appTheme.importExtensionFiles&&!f&&!o;s.sort(function(e,t){if(e.core!=t.core)return e.core?-1:1;var n=pxt.isPkgBeta(e);if(n!=pxt.isPkgBeta(t))return n?1:-1;var r=void 0===e.weight?50:e.weight,i=void 0===t.weight?50:t.weight;return r!=i?-r+i:pxt.Util.strcmp(e.name,t.name)});var m=n==b.Boards?lf("Boards"):n==b.Experiments?lf("Experiments"):lf("Extensions"),g=n==b.Boards?lf("Change development board"):n==b.Experiments?lf("Turn on and off experimental features"):lf("Add an extension to the project"),v=n==b.Boards?"/boards":n==b.Experiments?"/experiments":"/extensions",y=n==b.Experiments&&a!=pxt.editor.experiments.state();return _.createElement(k.Modal,{isOpen:i,dimmer:!0,className:"searchdialog",size:"fullscreen",onClose:this.hide,closeIcon:r,header:m,helpUrl:v,closeOnDimmerClick:!0,closeOnEscape:!0,description:g},_.createElement("div",{className:"ui"},n==b.Experiments?_.createElement("div",{className:"ui message info"},_.createElement("div",{className:"header"},lf("WARNING: EXPERIMENTAL FEATURES AHEAD!")),lf("Try out these features and tell us what you think!")):void 0,n==b.Extensions?_.createElement(E.SearchInput,{key:"search",ariaMessage:lf("{0} result matching '{1}'",s.length+l.data.length+c.data.length,o),placeholder:lf("Search or enter project URL..."),searchHandler:this.handleSearch,inputClassName:"fluid",autoFocus:!0,disabled:d}):void 0,d?_.createElement("div",{className:"ui medium active centered inline loader"}):_.createElement("div",{className:"ui cards centered",role:"listbox"},c.data.map(function(e){return _.createElement(C,{key:"url"+e.id,name:e.name,description:e.description,url:"/"+e.id,scr:e,onCardClick:t.addUrl,role:"link"})}),u.map(function(e){return _.createElement(C,{key:"local"+e.id,name:e.name,description:lf("Local copy of {0} hosted on github.com",e.githubId),url:"https://github.com/"+e.githubId,imageUrl:e.icon,scr:e,onCardClick:t.addLocal,label:lf("Local"),title:lf("Local GitHub extension"),labelClass:"blue right ribbon",role:"link"})}),s.map(function(e){return _.createElement(C,{key:"bundled"+e.name,name:e.name,description:e.description,imageUrl:e.icon,scr:e,onCardClick:t.addBundle,label:pxt.isPkgBeta(e)?lf("Beta"):void 0,role:"link"})}),l.data.filter(function(e){return e.status==pxt.github.GitRepoStatus.Approved}).map(function(e){return _.createElement(C,{name:e.name.replace(/^pxt-/,""),description:e.description,key:"gha"+e.fullName,scr:e,onCardClick:t.installGh,url:"github:"+e.fullName,imageUrl:pxt.github.repoIconUrl(e),label:pxt.isPkgBeta(e)?lf("Beta"):void 0,role:"link",learnMoreUrl:"/pkg/"+e.fullName})}),l.data.filter(function(e){return e.status!=pxt.github.GitRepoStatus.Approved}).map(function(e){return _.createElement(C,{name:e.name.replace(/^pxt-/,""),description:e.description||"",extracontent:lf("User-provided extension, not endorsed by Microsoft."),key:"ghd"+e.fullName,scr:e,onCardClick:t.installGh,imageUrl:pxt.github.repoIconUrl(e),label:pxt.isPkgBeta(e)?lf("Beta"):void 0,url:"github:"+e.fullName,role:"link",learnMoreUrl:"/pkg/"+e.fullName})}),p.map(function(e){return _.createElement(C,{name:e.name,scr:e,imageUrl:"/static/experiments/"+e.id.toLowerCase()+".png",description:e.description,key:"exp"+e.id,role:"link",label:pxt.editor.experiments.isEnabled(e)?lf("Enabled"):lf("Disabled"),labelClass:pxt.editor.experiments.isEnabled(e)?"green right ribbon":"grey right ribbon",onCardClick:t.toggleExperiment,feedbackUrl:e.feedbackUrl})}),h?_.createElement(x.CodeCardView,{ariaLabel:lf("Open files from your computer"),role:"button",key:"import",icon:"upload ui cardimage",iconColor:"secondary",name:lf("Import File..."),description:lf("Open files from your computer"),onClick:this.importExtensionFile}):void 0),o&&!d&&s.length+l.data.length+c.data.length===0?_.createElement("div",{className:"ui items"},_.createElement("div",{className:"ui item"},lf("We couldn't find any extensions matching '{0}'",o))):void 0),y?_.createElement("div",{className:"ui warning message"},_.createElement("div",{className:"header"},lf("Experiments changed")),lf("The editor will reload when leaving this page.")):void 0)},e}(w.Component);n.ScriptSearch=f;var C=function(n){function e(e){var t=n.call(this,e)||this;return t.handleClick=t.handleClick.bind(t),t}return i(e,n),e.prototype.handleClick=function(){var e=this.props,t=e.scr;(0,e.onCardClick)(t)},e.prototype.renderCore=function(){var e=this.props,t=(e.onCardClick,e.onClick,e.scr,a(e,["onCardClick","onClick","scr"]));return _.createElement(x.CodeCardView,o({},t,{onClick:this.handleClick}))},e}(k.StatelessUIElement)},{"./codecard":13,"./components/searchInput":39,"./core":41,"./data":44,"./electron":55,"./package":81,"./sui":100,"./workspace":105,react:284,"react-dom":240}],88:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./core"),s=e("./srceditor"),l=e("./sui"),c=e("./data"),p=pxt.Util,u=function(r){function e(e){var t=r.call(this,e)||this;t.parent=e,t.savedMessageQueue=[],t.maxSavedMessages=1e3,t.charts=[],t.chartIdx=0,t.sourceMap={},t.serialInputDataBuffer="",t.maxSerialInputDataLength=255,t.isSim=!0,t.maxConsoleEntries=500,t.active=!0,t.rawDataBuffer="",t.maxBufferLength=1e4,t.csvHeaders=[],t.highContrast=!1,t.handleStartPauseRef=function(e){t.startPauseButton=e},t.handleChartRootRef=function(e){t.chartRoot=e},t.handleConsoleRootRef=function(e){t.consoleRoot=e},window.addEventListener("message",t.processEvent.bind(t),!1);var n=pxt.appTarget.serial&&pxt.appTarget.serial.editorTheme;return t.lineColors=n&&n.lineColors||["#e00","#00e","#0e0"],t.hcLineColors=["#000"],t.currentLineColors=t.lineColors,t.goBack=t.goBack.bind(t),t.toggleRecording=t.toggleRecording.bind(t),t.downloadRaw=t.downloadRaw.bind(t),t.downloadCSV=t.downloadCSV.bind(t),t}return i(e,r),e.prototype.getId=function(){return"serialEditor"},e.prototype.hasHistory=function(){return!1},e.prototype.hasEditorToolbar=function(){return!1},e.prototype.setVisible=function(e){this.parent.state.highContrast!==this.highContrast&&this.setHighContrast(this.parent.state.highContrast),this.isVisible=e,this.isVisible?(this.processQueuedMessages(),this.startRecording()):(this.pauseRecording(),this.clear())},e.prototype.setHighContrast=function(e){e!==this.highContrast&&(this.highContrast=e,this.currentLineColors=e?this.hcLineColors:this.lineColors,this.clear())},e.prototype.acceptsFile=function(e){return e.name===pxt.SERIAL_EDITOR_FILE},e.prototype.setSim=function(e){this.isSim!=e&&(this.isSim=e,this.clear())},e.prototype.loadSmoothieChartsAsync=function(){return this.loadSmoothieChartsPromise||(this.loadSmoothieChartsPromise=pxt.BrowserUtils.loadScriptAsync("smoothie/smoothie_compressed.js")),this.loadSmoothieChartsPromise},e.prototype.saveMessageForLater=function(e){this.savedMessageQueue.push(e),this.savedMessageQueue.length>this.maxSavedMessages&&this.savedMessageQueue.shift()},e.prototype.processQueuedMessages=function(){var t=this;this.savedMessageQueue.forEach(function(e){return t.processMessage(e)}),this.savedMessageQueue=[]},e.prototype.processEvent=function(e){var t=this,n=e.data;"serial"===n.type?this.processEventCore(n):"bulkserial"===n.type&&n.data.forEach(function(e){t.processEventCore({type:"serial",data:e.data,receivedTime:e.time,sim:n.sim,id:n.id})})},e.prototype.processEventCore=function(e){e.receivedTime=e.receivedTime||p.now(),this.active?this.processMessage(e):this.saveMessageForLater(e)},e.prototype.mapSource=function(e){if(!this.sourceMap[e]){var t=Object.keys(this.sourceMap).length+1;this.sourceMap[e]=lf("source")+t.toString()}return this.sourceMap[e]},e.prototype.processMessage=function(e){if(!!e.sim==this.isSim){var t=e.data||"",n=e.id||"?",r=e.receivedTime||p.now();this.appendRawData(t);for(var i=this.mapSource(n),o=0,a=this.chunkDataIntoLines(t);o<a.length;o++){var s=a[o];this.processMessageLine(s,i,r)}}},e.prototype.processMessageLine=function(e,r,i){var o=this;if(/^\s*\{[^}]+\}\s*$/.test(e))try{var t=JSON.parse(e),n=parseInt(t.t),a=this.mapSource(t.s),s=t.n||"",l=parseFloat(t.v);isNaN(n)||isNaN(l)||this.appendGraphEntry(a,s,l,i)}catch(e){}else if(/^\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?)(\s*,\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?))+\s*,?\s*$/.test(e))e.split(/\s*,\s*/).map(function(e){return parseFloat(e)}).filter(function(e){return!isNaN(e)}).forEach(function(e,t){var n="data."+(o.csvHeaders[t]||t);o.appendGraphEntry(r,n,e,i)});else if(/^\s*[\s\w]+(\s*,\s*[\w\s]+)+\s*,?\s*$/.test(e))this.csvHeaders=e.split(/\s*,\s*/).map(function(e){return e.trim()});else{var c=/^\s*(([^:]+):)?\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?)/i.exec(e);if(c){var u=c[2]||"",p=parseFloat(c[3]);isNaN(p)||this.appendGraphEntry(r,u,p,i)}}this.appendConsoleEntry(e)},e.prototype.appendRawData=function(e){this.rawDataBuffer+=e,this.rawDataBuffer.length>this.maxBufferLength&&this.rawDataBuffer.slice(this.rawDataBuffer.length/4)},e.prototype.appendGraphEntry=function(r,i,o,a){var s=this;this.loadSmoothieChartsAsync().then(function(){for(var e=void 0,t=0;t<s.charts.length;++t){var n=s.charts[t];if(n.shouldContain(r,i)){e=n;break}}e||(e=new f(r,i,s.chartIdx,s.currentLineColors),s.chartIdx++,s.charts.push(e),s.chartRoot.appendChild(e.getElement()),pxt.BrowserUtils.removeClass(s.chartRoot,"nochart"),s.consoleRoot&&pxt.BrowserUtils.removeClass(s.consoleRoot,"nochart")),e.addPoint(i,o,a)})},e.prototype.chunkDataIntoLines=function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];this.serialInputDataBuffer+=r,"\n"!==r&&this.serialInputDataBuffer.length<this.maxSerialInputDataLength||("\n"===r?(this.serialInputDataBuffer=this.serialInputDataBuffer.replace(/\s+$/,""),this.serialInputDataBuffer.length&&t.push(this.serialInputDataBuffer)):t.push(this.serialInputDataBuffer),this.serialInputDataBuffer="")}return t},e.prototype.appendConsoleEntry=function(e){if(e.length>=this.maxSerialInputDataLength)(n=document.createElement("span")).appendChild(document.createTextNode(e)),this.consoleRoot.appendChild(n);else{var t=this.consoleRoot.lastChild,n=document.createElement("div");if(t&&t.lastChild.textContent==e)if(2==t.childNodes.length){var r=parseInt(t.firstChild.textContent);t.firstChild.textContent=(r+1).toString()}else{var i=document.createElement("a");i.className="ui horizontal label",i.textContent="2",t.insertBefore(i,t.lastChild)}else n.appendChild(document.createTextNode(e)),this.consoleRoot.appendChild(n)}for(this.consoleRoot.scrollTop=this.consoleRoot.scrollHeight;this.consoleRoot.childElementCount>this.maxConsoleEntries;)this.consoleRoot.removeChild(this.consoleRoot.firstChild);this.consoleRoot&&0<this.consoleRoot.childElementCount&&(this.chartRoot&&pxt.BrowserUtils.removeClass(this.chartRoot,"noconsole"),this.consoleRoot&&pxt.BrowserUtils.removeClass(this.consoleRoot,"noconsole"))},e.prototype.pauseRecording=function(){this.active=!1,this.startPauseButton&&this.startPauseButton.setState({active:this.active}),this.charts.forEach(function(e){return e.stop()})},e.prototype.startRecording=function(){this.active=!0,this.startPauseButton&&this.startPauseButton.setState({active:this.active}),this.charts.forEach(function(e){return e.start()})},e.prototype.toggleRecording=function(){pxt.tickEvent("serial.toggleRecording",void 0,{interactiveConsent:!0}),this.active?this.pauseRecording():this.startRecording()},e.prototype.clearNode=function(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)},e.prototype.clear=function(){this.chartRoot&&(this.clearNode(this.chartRoot),pxt.BrowserUtils.addClass(this.chartRoot,"noconsole"),pxt.BrowserUtils.addClass(this.chartRoot,"nochart")),this.consoleRoot&&(this.clearNode(this.consoleRoot),pxt.BrowserUtils.addClass(this.consoleRoot,"noconsole"),pxt.BrowserUtils.addClass(this.consoleRoot,"nochart")),this.charts=[],this.serialInputDataBuffer="",this.rawDataBuffer="",this.savedMessageQueue=[],this.sourceMap={},this.csvHeaders=[]},e.prototype.isCSV=function(e,t){if(t.length<2)return!1;for(var n=0;n<t.length;++n)if(t[n].length!=e)return!1;for(var r=0;r<e;++r)for(var i=t[0][r][0],o=1;o<t.length;++o)if(t[o][r][0]!=i)return!1;return!0},e.prototype.downloadCSV=function(){var l=this,c=lf("{id:csvseparator}\t"),u=[];if(this.charts.length&&this.charts.some(function(e){return 0<Object.keys(e.datas).length})){this.charts.forEach(function(t){var n=[];Object.keys(t.datas).forEach(function(e){return n.push({name:e,line:t.datas[e]})});var r=n.map(function(e){return e.line}),e=0<r.length?r.map(function(e){return e.length}).reduce(function(e,t){return Math.max(e,t)}):0;if(l.isCSV(e,r)){var i="time ("+t.source+")"+c+n.map(function(e){return e.name}).join(c)+c;u[0]=u[0]?u[0]+c+i:i;for(var o=function(t){var e=(r[0][t][0]-r[0][0][0])/1e3+c+r.map(function(e){return e[t][1]}).join(c)+c;u[t+1]=u[t+1]?u[t+1]+c+e:e},a=0;a<e;++a)o(a)}else{i=n.map(function(e){return"time ("+t.source+")"+c+e.name}).join(c),u[0]=u[0]?u[0]+c+i:i;var s=function(t){var e=r.map(function(e){return t<e.length?""+(e[t][0]-e[0][0])/1e3+c+e[t][1]:c}).join(c);u[t+1]=u[t+1]?u[t+1]+c+e:e};for(a=0;a<e;++a)s(a)}}),u.unshift("sep="+c);var e=u.join("\r\n");a.infoNotification(lf("Exporting data...."));var t=new Date(Date.now()).toString().replace(/[^\d]+/g,"-").replace(/(^-|-$)/g,"");pxt.commands.browserDownloadAsync(p.toUTF8(e),pxt.appTarget.id+"-"+lf("{id:csvfilename}data")+"-"+t+".csv","text/csv")}else a.confirmAsync({header:lf("No data to export"),hideAgree:!0,disagreeLbl:lf("Ok"),body:lf("You must generate some serial data before you can export it.")})},e.prototype.downloadRaw=function(){a.infoNotification(lf("Exporting text...."));var e=new Date(Date.now()).toString().replace(/[^\d]+/g,"-").replace(/(^-|-$)/g,"");pxt.commands.browserDownloadAsync(p.toUTF8(this.rawDataBuffer),pxt.appTarget.id+"-"+lf("{id:csvfilename}console")+"-"+e+".txt","text/plain")},e.prototype.goBack=function(){pxt.tickEvent("serial.backButton",void 0,{interactiveConsent:!0}),this.parent.openPreviousEditor()},e.prototype.display=function(){return o.createElement("div",{id:"serialArea"},o.createElement("div",{id:"serialHeader",className:"ui serialHeader"},o.createElement("div",{className:"leftHeaderWrapper"},o.createElement("div",{className:"leftHeader"},o.createElement(l.Button,{title:lf("Go back"),tabIndex:0,onClick:this.goBack,onKeyDown:l.fireClickOnEnter},o.createElement(l.Icon,{icon:"arrow left"}),o.createElement("span",{className:"ui text landscape only"},lf("Go back"))))),o.createElement("div",{className:"rightHeader"},o.createElement(l.Button,{title:lf("Copy text"),className:"ui icon button editorExport",ariaLabel:lf("Copy text"),onClick:this.downloadRaw},o.createElement(l.Icon,{icon:"copy"})),o.createElement(l.Button,{title:lf("Export data"),className:"ui icon blue button editorExport",ariaLabel:lf("Export data"),onClick:this.downloadCSV},o.createElement(l.Icon,{icon:"download"})),o.createElement(d,{ref:this.handleStartPauseRef,active:this.active,toggle:this.toggleRecording}),o.createElement("span",{className:"ui small header"},this.isSim?lf("Simulator"):lf("Device")))),o.createElement("div",{id:"serialCharts",ref:this.handleChartRootRef}),o.createElement("div",{id:"serialConsole",ref:this.handleConsoleRootRef}))},e.prototype.domUpdate=function(){},e}(s.Editor);n.Editor=u;var d=function(n){function e(e){var t=n.call(this,e)||this;return t.state={active:t.props.active},t}return i(e,n),e.prototype.renderCore=function(){var e=this.props.toggle,t=this.state.active;return o.createElement(l.Button,{title:t?lf("Pause recording"):lf("Start recording"),className:"ui left floated icon button "+(t?"green":"red circular")+" toggleRecord",onClick:e},o.createElement(l.Icon,{icon:t?"pause icon":"circle icon"}))},e}(c.PureComponent);n.StartPauseButton=d;var f=function(){function e(e,t,n,r){var i=this;this.rootElement=document.createElement("div"),this.lines={},this.datas={};var o=pxt.appTarget.serial&&pxt.appTarget.serial.editorTheme,a={interpolation:"bezier",labels:{disabled:!1,fillStyle:"black",fontSize:14},responsive:!0,millisPerPixel:20,grid:{verticalSections:0,borderVisible:!1,millisPerLine:5e3,fillStyle:o&&o.gridFillStyle||"transparent",strokeStyle:o&&o.gridStrokeStyle||"#fff"},tooltip:!0,tooltipFormatter:function(e,t){return i.tooltip(e,t)}};this.lineColors=r,this.chartIdx=n,this.chart=new SmoothieChart(a),this.rootElement.className="ui segment",this.source=e,this.variable=t.replace(/\..*$/,""),this.rootElement.appendChild(this.makeLabel()),this.rootElement.appendChild(this.makeCanvas())}return e.prototype.tooltip=function(e,t){return t.map(function(e){var t=e.series.timeSeries.__name;return"<span>"+(t?t+": ":"")+e.value+"</span>"}).join("<br/>")},e.prototype.getLine=function(e){var t=this.lines[e];if(!t){var n=this.lineColors[this.chartIdx++%this.lineColors.length];this.lines[e]=t=new TimeSeries,t.__name=p.htmlEscape(e.substring(this.variable.length+1)),this.chart.addTimeSeries(t,{strokeStyle:n,lineWidth:3}),this.datas[e]=[]}return t},e.prototype.makeLabel=function(){return this.label=document.createElement("div"),this.label.className="ui orange bottom left attached no-select label seriallabel",this.label.innerText=this.variable||"...",this.label},e.prototype.makeCanvas=function(){var e=document.createElement("canvas");return this.chart.streamTo(e),this.canvas=e},e.prototype.getCanvas=function(){return this.canvas},e.prototype.getElement=function(){return this.rootElement},e.prototype.shouldContain=function(e,t){return this.source==e&&this.variable==t.replace(/\..*$/,"")},e.prototype.addPoint=function(e,t,n){if(this.getLine(e).append(n,t),1==Object.keys(this.lines).length){var r=pxsim.Math_.roundWithPrecision(t,2).toString();this.label.innerText=this.variable?this.variable+": "+r:r}else this.label.innerText=this.variable||"";var i=this.datas[e];i.push([n,t]),4e3<i.length&&i.splice(0,i.length/4)},e.prototype.start=function(){this.chart.start()},e.prototype.stop=function(){this.chart.stop()},e}(),h=function(){function e(){}return e.prototype.canImport=function(e){return"text/plain"==e.type},e.prototype.importAsync=function(e,o){return ts.pxtc.Util.fileReadAsTextAsync(o).then(function(e){if(e){var t=e.split(/\n/g).map(function(e){var t=/^\s*(\d+)>/.exec(e);return t&&(e=e.substr(t[0].length)),{type:"serial",data:e+"\n",id:o.name,receivedTime:t?parseFloat(t[1]):void 0}});if(t.length){var n=p.now(),r=t.filter(function(e){return!!e.receivedTime});if(r.length){var i=r[r.length-1].receivedTime||0;r.forEach(function(e){return e.receivedTime+=n-i})}t.forEach(function(e){return window.postMessage(e,"*")})}}else a.errorNotification(lf("Ooops, could not read file"))})},e}();n.ResourceImporter=h},{"./core":41,"./data":44,"./srceditor":99,"./sui":100,react:284}],89:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./sui"),s=function(n){function e(e){var t=n.call(this,e)||this;return t.state={active:!1},t}return i(e,n),e.prototype.componentDidMount=function(){window.addEventListener("message",this.setActive.bind(this))},e.prototype.componentWillUnmount=function(){window.addEventListener("message",this.setActive.bind(this))},e.prototype.setActive=function(e){var t=e.data;this.state.active||"serial"!==t.type&&"bulkserial"!==t.type||!!t.sim===this.props.isSim&&this.setState({active:!0})},e.prototype.clear=function(){this.setState({active:!1})},e.prototype.renderCore=function(){return this.state.active?o.createElement("div",{role:"button",title:lf("Open console"),className:"ui label circular",tabIndex:0,onClick:this.props.onClick,onKeyDown:a.fireClickOnEnter},o.createElement("div",{className:"detail"},o.createElement("img",{alt:lf("Animated bar chart"),className:"barcharticon",src:pxt.Util.pathJoin(pxt.webConfig.commitCdnUrl,"images/Bars_black.gif")})),o.createElement("span",null,lf("Show console")),o.createElement("div",{className:"detail"},this.props.isSim?lf("Simulator"):lf("Device"))):o.createElement("div",null)},e}(e("./data").Component);n.SerialIndicator=s},{"./data":44,"./sui":100,react:284}],90:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),K=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var X,Y,o,a,J=e("react"),s=e("./data"),$=e("./sui"),l=e("./simulator"),c=e("./screenshot"),Q=e("./qr");(a=X=n.ShareMode||(n.ShareMode={}))[a.Code=0]="Code",a[a.Url=1]="Url",a[a.Editor=2]="Editor",a[a.Simulator=3]="Simulator",(o=Y=n.ShareRecordingState||(n.ShareRecordingState={}))[o.None=0]="None",o[o.ScreenshotSnap=1]="ScreenshotSnap",o[o.GifLoading=2]="GifLoading",o[o.GifRecording=3]="GifRecording",o[o.GifRendering=4]="GifRendering";var u=function(t){function e(e){var i=t.call(this,e)||this;return i.handleKeyDown=function(e){var t=i.state.visible,n=pxt.appTarget.appTheme,r=e.key.toLocaleLowerCase();!t||document.activeElement&&"INPUT"===document.activeElement.tagName||(n.simScreenshotKey&&r===n.simScreenshotKey.toLocaleLowerCase()?i.handleScreenshotClick():n.simGifKey&&r===n.simGifKey.toLocaleLowerCase()&&i.handleRecordClick())},i.state={pubId:void 0,visible:!1,advancedMenu:!1,screenshotUri:void 0,recordingState:Y.None,recordError:void 0,title:void 0},i.hide=i.hide.bind(i),i.toggleAdvancedMenu=i.toggleAdvancedMenu.bind(i),i.setAdvancedMode=i.setAdvancedMode.bind(i),i.handleProjectNameChange=i.handleProjectNameChange.bind(i),i.restartSimulator=i.restartSimulator.bind(i),i.handleRecordClick=i.handleRecordClick.bind(i),i.handleScreenshotClick=i.handleScreenshotClick.bind(i),i.handleScreenshotMessage=i.handleScreenshotMessage.bind(i),i}return i(e,t),e.prototype.hide=function(){this._gifEncoder&&(this._gifEncoder.cancel(),this._gifEncoder=void 0),this.loanedSimulator&&(l.driver.unloanSimulator(),this.loanedSimulator=void 0,this.props.parent.popScreenshotHandler(),l.driver.stopRecording()),this.setState({visible:!1,screenshotUri:void 0,projectName:void 0,projectNameChanged:!1,recordingState:Y.None,recordError:void 0,qrCodeUri:void 0,title:void 0})},e.prototype.show=function(e,t){var n=this,r=pxt.appTarget.cloud&&pxt.appTarget.cloud.thumbnails&&(pxt.appTarget.appTheme.simScreenshot||pxt.appTarget.appTheme.simGif);r&&(this.loanedSimulator=l.driver.loanSimulator(),this.props.parent.pushScreenshotHandler(this.handleScreenshotMessage)),this.setState({thumbnails:r,visible:!0,mode:X.Code,pubId:void 0,sharingError:!1,screenshotUri:void 0,qrCodeUri:void 0,title:t},r?function(){return n.props.parent.startSimulator()}:void 0)},e.prototype.handleScreenshotMessage=function(e){var t=this.state.visible;if(e&&t)if("start"!==e.event)if("stop"!=e.event)this.state.recordingState==Y.GifRecording?this._gifEncoder.addFrame(e.data,e.delay)&&this.gifRender():this.state.recordingState==Y.ScreenshotSnap||this.state.recordingState===Y.None?this.setState({screenshotUri:pxt.BrowserUtils.imageDataToPNG(e.data),recordingState:Y.None,recordError:void 0}):l.driver.stopRecording();else switch(this.state.recordingState){case Y.GifRecording:this.gifRender()}else switch(this.state.recordingState){case Y.None:this.gifRecord()}},e.prototype.componentWillReceiveProps=function(e){var t={};this.state.projectNameChanged||e.parent.state.projectName==this.state.projectName||(t.projectName=e.parent.state.projectName),e.loading!=this.state.loading&&(t.loading=e.loading),0<Object.keys(t).length&&this.setState(t)},e.prototype.componentDidMount=function(){document.addEventListener("keydown",this.handleKeyDown)},e.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.handleKeyDown)},e.prototype.shouldComponentUpdate=function(e,t,n){return this.state.visible!=t.visible||this.state.advancedMenu!=t.advancedMenu||this.state.mode!=t.mode||this.state.pubId!=t.pubId||this.state.sharingError!=t.sharingError||this.state.projectName!=t.projectName||this.state.projectNameChanged!=t.projectNameChanged||this.state.loading!=t.loading||this.state.recordingState!=t.recordingState||this.state.screenshotUri!=t.screenshotUri||this.state.qrCodeUri!=t.qrCodeUri||this.state.title!=t.title},e.prototype.toggleAdvancedMenu=function(){var e=!!this.state.advancedMenu;this.setState({advancedMenu:!e})},e.prototype.setAdvancedMode=function(e){this.setState({mode:e})},e.prototype.handleProjectNameChange=function(e){this.setState({projectName:e,projectNameChanged:!0})},e.prototype.restartSimulator=function(){pxt.tickEvent("share.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()},e.prototype.handleScreenshotClick=function(){var n=this;pxt.tickEvent("share.takescreenshot",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.state.recordingState==Y.None&&this.setState({recordingState:Y.ScreenshotSnap,recordError:void 0},function(){n.props.parent.requestScreenshotAsync().then(function(e){var t={recordingState:Y.None,recordError:void 0};e?t.screenshotUri=e:t.recordError=lf("Oops, screenshot failed. Please try again."),n.setState(t)})})},e.prototype.handleRecordClick=function(){switch(this.state.recordingState){case Y.None:this.gifRecord();break;case Y.GifRecording:this.gifRender()}},e.prototype.loadEncoderAsync=function(){var t=this;return this._gifEncoder?Promise.resolve(this._gifEncoder):c.loadGifEncoderAsync().then(function(e){return t._gifEncoder=e})},e.prototype.gifRecord=function(){var n=this;pxt.tickEvent("share.gifrecord",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.state.recordingState==Y.None&&this.setState({recordingState:Y.GifLoading,screenshotUri:void 0},function(){return n.loadEncoderAsync().then(function(e){if(e){e.start();var t=pxt.appTarget.appTheme.simGifWidth||160;n.setState({recordingState:Y.GifRecording},function(){return l.driver.startRecording(t)})}else n.setState({recordingState:Y.None,recordError:lf("Oops, gif encoder could not load. Please try again.")})}).catch(function(e){pxt.reportException(e),n.setState({recordingState:Y.None,recordError:lf("Oops, gif recording failed. Please try again.")}),n._gifEncoder&&n._gifEncoder.cancel()})})},e.prototype.gifRender=function(){var r=this;pxt.debug("render gif"),l.driver.stopRecording(),this._gifEncoder&&this.setState({recordingState:Y.GifRendering,recordError:void 0},function(){r.props.parent.stopSimulator(),r._gifEncoder.renderAsync().then(function(e){pxt.log("gif: "+(e?e.length:0)+" chars");var t=pxt.appTarget.appTheme.simScreenshotMaxUriLength,n=void 0;e&&(t&&e.length>t?(pxt.tickEvent("gif.toobig",{size:e.length}),e=void 0,n=lf("Gif is too big, try recording a shorter time.")):pxt.tickEvent("gif.ok",{size:e.length})),r.setState({recordingState:Y.None,screenshotUri:e,recordError:n}),Promise.delay(1e3).then(function(){return r.props.parent.startSimulator()})})})},e.prototype.renderCore=function(){var n=this,e=this.state,t=e.visible,r=e.projectName,i=e.loading,o=e.recordingState,a=e.screenshotUri,s=e.thumbnails,l=e.recordError,c=e.pubId,u=e.qrCodeUri,p=e.title,d=pxt.appTarget.appTheme,f=this.props.parent.state.header,h=!!this.state.advancedMenu,m=!!d.hideShareEmbed,g=d.socialOptions,v=!!g&&!pxt.BrowserUtils.isUwpEdge(),y=!!c,b=this.state.mode,_="",w="",k=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";/\/$/.test(k)||(k+="/");var x=pxt.appTarget.appTheme.embedUrl;/\/$/.test(x)||(x+="/");var E=pxt.webConfig.verprefix||"";if(f&&y){_=""+k+c;var C=""+x+E+"#pub:"+c;switch(b){case X.Code:w=pxt.docs.codeEmbedUrl(""+x+E,c);break;case X.Editor:w=pxt.docs.embedUrl(""+x+E,"pub",c);break;case X.Simulator:var S="81.97%";pxt.appTarget.simulator&&(S=(100/pxt.appTarget.simulator.aspectRatio).toPrecision(4)+"%");var T=x+(pxt.webConfig.runUrl||E+"--run").replace(/^\//,"");w=pxt.docs.runUrl(T,S,c);break;case X.Url:w=C}}var A=[{mode:X.Code,label:lf("Code")},{mode:X.Editor,label:lf("Editor")},{mode:X.Simulator,label:lf("Simulator")}],N=y?void 0:lf("Publish project"),O=i&&!this.state.sharingError,P=[];N&&P.push({label:N,onclick:function(){pxt.tickEvent("menu.embed.publish",void 0,{interactiveConsent:!0}),n.setState({sharingError:!1,loading:!0});var e=Promise.resolve();r&&n.props.parent.state.projectName!=r&&(e=n.props.parent.updateHeaderNameAsync(r)),e.then(function(){return n.props.parent.anonymousPublishAsync(a)}).then(function(t){n.setState({pubId:t,qrCodeUri:void 0}),pxt.appTarget.appTheme.qrCode&&Q.renderAsync(""+k+t).then(function(e){n.state.pubId==t&&n.setState({qrCodeUri:e})}),n.forceUpdate()}).catch(function(e){n.setState({pubId:void 0,sharingError:!0,qrCodeUri:void 0})}),n.forceUpdate()},icon:"share alternate",loading:O,className:"primary",disabled:o!=Y.None});var I=!!pxt.options.light,D=lf("You need to publish your project to share it or embed it in other web pages.")+" "+lf("You acknowledge having consent to publish this project."),L=O||o!=Y.None,R=this.loanedSimulator&&d.simScreenshotKey?lf("Take Screenshot (shortcut: {0})",d.simScreenshotKey):lf("Take Screenshot"),j=!I&&d.simScreenshot,B=!I&&!!d.simGif,M=o==Y.GifRecording,F=o==Y.GifRendering,U=M?"stop":"circle",q=M?d.simGifKey?lf("Stop recording (shortcut: {0})",d.simGifKey):lf("Stop recording"):F?lf("Cancel rendering"):d.simGifKey?lf("Start recording (shortcut: {0})",d.simGifKey):lf("Start recording"),H=M?"glow":"",z=O,V=o==Y.GifLoading||F,W=l||(M?lf("Recording in progress..."):F?lf("Rendering gif..."):void 0),G=l?"warning":"";return J.createElement($.Modal,{isOpen:t,className:"sharedialog",size:s?"":"small",onClose:this.hide,dimmer:!0,header:p||lf("Share Project"),closeIcon:!0,buttons:P,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},J.createElement("div",{className:"ui form"},N&&!this.loanedSimulator?J.createElement("div",{className:"ui field"},J.createElement("div",null,J.createElement($.Input,{ref:"filenameinput",placeholder:lf("Name"),autoFocus:!pxt.BrowserUtils.isMobile(),id:"projectNameInput",ariaLabel:lf("Type a name for your project"),autoComplete:!1,value:r||"",onChange:this.handleProjectNameChange}))):void 0,N&&this.loanedSimulator?J.createElement("div",{className:"ui fields"},J.createElement("div",{id:"shareLoanedSimulator",className:"simulator ui six wide field landscape only "+H}),J.createElement("div",{className:"ui ten wide field"},J.createElement($.Input,{ref:"filenameinput",placeholder:lf("Name"),autoFocus:!pxt.BrowserUtils.isMobile(),id:"projectNameInput",ariaLabel:lf("Type a name for your project"),autoComplete:!1,value:r||"",onChange:this.handleProjectNameChange}),J.createElement("label",null),J.createElement("div",{className:"ui buttons landscape only"},J.createElement($.Button,{icon:"refresh",title:lf("Restart"),ariaLabel:lf("Restart"),onClick:this.restartSimulator,disabled:L}),j?J.createElement($.Button,{icon:"camera",title:R,ariaLabel:R,onClick:this.handleScreenshotClick,disabled:L}):void 0,B?J.createElement($.Button,{icon:U,title:q,loading:V,onClick:this.handleRecordClick,disabled:z}):void 0),a||W?J.createElement("div",{className:"ui "+G+" segment landscape only"},a&&!W?J.createElement("img",{className:"ui small centered image",src:a,alt:lf("Recorded gif")}):J.createElement("p",{className:"no-select"},W)):void 0,J.createElement("p",{className:"ui tiny message info"},D))):void 0,N&&!this.loanedSimulator?J.createElement("p",{className:"ui tiny message info"},D):void 0,this.state.sharingError?J.createElement("p",{className:"ui red inverted segment"},lf("Oops! There was an error. Please ensure you are connected to the Internet and try again.")):void 0,_&&y?J.createElement("div",null,J.createElement("p",null,lf("Your project is ready! Use the address below to share your projects.")),J.createElement($.Input,{id:"projectUri",class:"mini",readOnly:!0,lines:1,value:_,copy:!0,autoFocus:!pxt.BrowserUtils.isMobile(),selectOnClick:!0,"aria-describedby":"projectUriLabel",autoComplete:!1}),J.createElement("label",{htmlFor:"projectUri",id:"projectUriLabel",className:"accessible-hidden"},lf("This is the read-only internet address of your project.")),u?J.createElement("img",{className:"ui tiny image floated right",alt:lf("QR Code of the saved program"),src:u}):void 0,v?J.createElement("div",{className:"social-icons"},J.createElement(Z,{url:_,ariaLabel:"Facebook",type:"facebook",heading:lf("Share on Facebook")}),J.createElement(Z,{url:_,ariaLabel:"Twitter",type:"twitter",heading:lf("Share on Twitter")}),g.discourse?J.createElement(Z,{url:_,icon:"comments",ariaLabel:lf("Post to Forum"),type:"discourse",heading:lf("Share on Forum")}):void 0):void 0):void 0,y&&!m?J.createElement("div",null,J.createElement("div",{className:"ui divider"}),J.createElement($.Link,{icon:"no-select chevron "+(h?"down":"right"),text:lf("Embed"),ariaExpanded:h,onClick:this.toggleAdvancedMenu}),h?J.createElement($.Menu,{pointing:!0,secondary:!0},A.map(function(e){return J.createElement(ee,K({key:"tab"+e.label,onClick:n.setAdvancedMode,currentMode:b},e))})):void 0,h?J.createElement($.Field,null,J.createElement($.Input,{id:"embedCode",class:"mini",readOnly:!0,lines:4,value:w,copy:y,disabled:!y,selectOnClick:!0,autoComplete:!1}),J.createElement("label",{htmlFor:"embedCode",id:"embedCodeLabel",className:"accessible-hidden"},lf("This is the read-only code for the selected tab."))):null):void 0))},e.prototype.componentDidUpdate=function(){var e=document.getElementById("shareLoanedSimulator");e&&this.loanedSimulator&&!this.loanedSimulator.parentNode&&e.appendChild(this.loanedSimulator)},e}(s.Component);n.ShareEditor=u;var Z=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.handleClick=t.handleClick.bind(t),t}return i(e,n),e.prototype.handleClick=function(e){var t=this.props,n=t.type,r=t.url,i=t.heading,o=pxt.appTarget.appTheme.socialOptions;pxt.tickEvent("share."+n,void 0,{interactiveConsent:!0});var a="";switch(n){case"facebook":a="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(r);break;case"twitter":var s=lf("Check out what I made!");o.twitterHandle&&o.orgTwitterHandle?s=lf("Check out what I made with @{0} and @{1}!",o.twitterHandle,o.orgTwitterHandle):o.twitterHandle?s=lf("Check out what I made with @{0}!",o.twitterHandle):o.orgTwitterHandle&&(s=lf("Check out what I made with @{0}!",o.orgTwitterHandle)),a="https://twitter.com/intent/tweet?url="+encodeURIComponent(r)+"&text="+encodeURIComponent(s)+(o.hashtags?"&hashtags="+encodeURIComponent(o.hashtags):"")+(o.related?"&related="+encodeURIComponent(o.related):"");break;case"discourse":a=(o.discourse||"https://forum.makecode.com/")+"new-topic?title="+encodeURIComponent(r),o.discourseCategory&&(a+="&category="+encodeURIComponent(o.discourseCategory))}pxt.BrowserUtils.popupWindow(a,i,600,600),e.preventDefault()},e.prototype.renderCore=function(){var e=this.props,t=e.type,n=e.label,r=e.ariaLabel,i=e.icon;return J.createElement("a",{role:"button",className:"ui button large "+(n?"labeled":"")+" icon "+t,tabIndex:0,"aria-label":r,onClick:this.handleClick},J.createElement($.Icon,{icon:i||t}),n)},e}(s.Component),ee=function(n){function e(e){var t=n.call(this,e)||this;return t.handleClick=t.handleClick.bind(t),t}return i(e,n),e.prototype.handleClick=function(){this.props.onClick(this.props.mode)},e.prototype.renderCore=function(){var e=this.props,t=e.label,n=e.mode,r=e.currentMode;return J.createElement($.MenuItem,{id:"tab"+n,active:r==n,tabIndex:0,name:t,onClick:this.handleClick})},e}($.StatelessUIElement)},{"./data":44,"./qr":84,"./screenshot":85,"./simulator":92,"./sui":100,react:284}],91:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var P=e("react"),o=e("./data"),I=e("./sui"),a=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},pxt.BrowserUtils.isIOS()&&t.props.parent.setMute(!0),t.toggleTrace=t.toggleTrace.bind(t),t.toggleMute=t.toggleMute.bind(t),t.restartSimulator=t.restartSimulator.bind(t),t.openInstructions=t.openInstructions.bind(t),t.startStopSimulator=t.startStopSimulator.bind(t),t.toggleSimulatorFullscreen=t.toggleSimulatorFullscreen.bind(t),t.takeScreenshot=t.takeScreenshot.bind(t),t.toggleDebug=t.toggleDebug.bind(t),t}return i(e,n),e.prototype.openInstructions=function(){pxt.tickEvent("simulator.make",void 0,{interactiveConsent:!0}),this.props.parent.openInstructions()},e.prototype.startStopSimulator=function(){pxt.tickEvent("simulator.startstop",void 0,{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})},e.prototype.restartSimulator=function(){pxt.tickEvent("simulator.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()},e.prototype.toggleTrace=function(){pxt.tickEvent("simulator.trace",void 0,{interactiveConsent:!0}),this.props.parent.toggleTrace()},e.prototype.toggleDebug=function(){pxt.tickEvent("simulator.debug",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()},e.prototype.toggleMute=function(){pxt.tickEvent("simulator.mute",{view:"computer",muteTo:""+!this.props.parent.state.mute},{interactiveConsent:!0}),this.props.parent.toggleMute()},e.prototype.toggleSimulatorFullscreen=function(){pxt.tickEvent("simulator.fullscreen",{view:"computer",fullScreenTo:""+!this.props.parent.state.fullscreen},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen()},e.prototype.takeScreenshot=function(){pxt.tickEvent("simulator.takescreenshot",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.props.parent.downloadScreenshotAsync().done()},e.prototype.renderCore=function(){var e=this.props.parent.state;if(!e.currFile||e.home)return P.createElement("div",null);var t=pxt.appTarget.appTheme,n=pxt.appTarget.simulator,r=pxt.shell.isSandboxMode(),i=!r&&e.showParts&&t.instructions,o=e.simState,a=o==pxt.editor.SimState.Running,s=o==pxt.editor.SimState.Starting,l=o==pxt.editor.SimState.Pending,c=e.fullscreen,u=e.mute,p=!!e.tutorialOptions&&!!e.tutorialOptions.tutorial,d=!n.hideRestart,f=!!t.enableTrace,h=t.debugger&&!p&&!pxt.BrowserUtils.isIE(),m=this.props.parent.state.tracing,g=m?lf("Disable Slow-Mo"):lf("Slow-Mo"),v=e.debugging,y=!n.hideFullscreen&&!r,b=t.hasAudio,_=n.headless,w=!!t.simScreenshot,k=e.screenshoting?"loading":"",x=!s&&!l,E=!v&&!s&&!l,C=lf("Open assembly instructions"),S=lf("Restart the simulator"),T=lf("Toggle debug mode"),A=c?lf("Exit fullscreen mode"):lf("Launch in fullscreen"),N=u?lf("Unmute audio"):lf("Mute audio"),O=t.simScreenshotKey?lf("Take Screenshot (shortcut {0})",t.simScreenshotKey):lf("Take Screenshot");return P.createElement("aside",{className:"ui item grid centered simtoolbar"+(r?"":" portrait "),role:"complementary","aria-label":lf("Simulator toolbar")},P.createElement("div",{className:"ui icon tiny buttons",style:{padding:"0"}},i&&P.createElement(I.Button,{disabled:v,icon:"configure",className:"secondary",title:C,onClick:this.openInstructions}),!t.bigRunButton&&P.createElement(D,{parent:this.props.parent,simState:e.simState,debugging:e.debugging}),d&&P.createElement(I.Button,{disabled:!E,key:"restartbtn",className:"restart-button",icon:"refresh",title:S,onClick:this.restartSimulator}),h&&P.createElement(I.Button,{disabled:!x,key:"debugbtn",className:"debug-button "+(v?"orange":""),icon:"icon bug",title:T,onClick:this.toggleDebug}),f&&P.createElement(I.Button,{key:"trace",className:"trace-button "+(m?"orange":""),icon:"xicon turtle",title:g,onClick:this.toggleTrace})),!_&&P.createElement("div",{className:"ui icon tiny buttons computer only",style:{padding:"0"}},b&&P.createElement(I.Button,{key:"mutebtn",className:"mute-button "+(u?"red":""),icon:u?"volume off":"volume up",title:N,onClick:this.toggleMute})),!_&&P.createElement("div",{className:"ui icon tiny buttons computer only",style:{padding:"0"}},w&&P.createElement(I.Button,{disabled:!a,key:"screenshotbtn",className:"screenshot-button "+k,icon:"icon camera left",title:O,onClick:this.takeScreenshot}),y&&P.createElement(I.Button,{key:"fullscreenbtn",className:"fullscreen-button",icon:"xicon "+(c?"fullscreencollapse":"fullscreen"),title:A,onClick:this.toggleSimulatorFullscreen})))},e}(o.Component);n.SimulatorToolbar=a;var D=function(n){function e(e){var t=n.call(this,e)||this;return t.startStopSimulator=function(){pxt.tickEvent("simulator.startstop",void 0,{interactiveConsent:!0}),t.props.parent.startStopSimulator({clickTrigger:!0})},t}return i(e,n),e.prototype.renderCore=function(){var e=this.props.simState,t=e==pxt.editor.SimState.Running,n=e==pxt.editor.SimState.Starting,r=e==pxt.editor.SimState.Pending,i=!this.props.debugging&&!n&&!r,o=function(){switch(e){case pxt.editor.SimState.Stopped:return lf("Start the simulator");case pxt.editor.SimState.Pending:case pxt.editor.SimState.Starting:return lf("Starting the simulator");case pxt.editor.SimState.Running:return lf("Stop the simulator")}}();return P.createElement(I.Button,{disabled:!i,key:"runbtn",className:"play-button "+(this.props.className||"")+" "+(t?"stop":"play"),icon:t?"stop":"play green",title:o,onClick:this.startStopSimulator})},e}(I.StatelessUIElement);n.PlayButton=D},{"./data":44,"./sui":100,react:284}],92:[function(e,t,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var a,g,o=e("./core"),s=e("./coretsx"),l=pxt.U;m.FAST_TRACE_INTERVAL=100,m.SLOW_TRACE_INTERVAL=500;var c={};function v(e,t){pxt.appTarget.appTheme.allowParentController&&pxt.BrowserUtils.isIFrame()&&pxt.editor.postHostMessageAsync({type:"pxthost",action:"simevent",subtype:e,exception:t})}m.setTranslations=function(e){m.simTranslations!==e&&(m.simTranslations=e,n())};m.init=function(e,i){if(e){pxsim.U.clear(e);var t=document.createElement("div");t.id="simulators",t.className="simulator",e.appendChild(t);var n=document.createElement("div");n.id="debugger",n.className="ui item landscape only",e.appendChild(n);var r={restart:function(){return i.restartSimulator()},revealElement:function(e){if(!pxt.options.light&&!m.driver.isLoanedSimulator(e)){var t=pxt.appTarget.appTheme.simAnimationEnter||"fly right in";e.style.animationDuration="500ms";var n=t+" visible transition animating";pxsim.U.addClass(e,n),Promise.resolve().delay(500).then(function(){pxsim.U.removeClass(e,n),e.style.animationDuration="",pxt.BrowserUtils.isEdge()&&s.dialogIsShowing()&&(document.body.style.display="none",requestAnimationFrame(function(){document.body.style.display="block"}))})}},removeElement:function(e,t){if(pxt.appTarget.simulator.headless)pxsim.U.addClass(e,"simHeadless"),t&&t();else{if(pxt.options.light)return t&&t(),void pxsim.U.remove(e);var n=pxt.appTarget.appTheme.simAnimationExit||"fly right out";e.style.animationDuration="500ms";var r=n+" visible transition animating";pxsim.U.addClass(e,r),Promise.resolve().delay(500).then(function(){pxsim.U.removeClass(e,"animating"),e.style.animationDuration="",t&&t(),pxsim.U.remove(e)})}},unhideElement:function(e){pxsim.U.removeClass(e,"simHeadless")},onDebuggerBreakpoint:function(e){var t=!1;if(a)for(var n=0,r=e.breakpointId;!t;){if(r){var i=g.breakpoints[r];t=a.highlightStatement(i,e)}if(!t){n++;var o=e.stackframes?e.stackframes[n]:void 0;if(!o)break;r=o.breakpointId}}e.exceptionMessage||!a||t?(!t&&e.exceptionMessage&&(pxt.debug("runtime error: "+e.exceptionMessage),pxt.debug(e.exceptionStack),a&&a.orphanException(e)),v("stopped",e.exceptionMessage)):m.driver.resume(pxsim.SimulatorDebuggerCommand.StepInto)},onTraceMessage:function(e){var t=g.breakpoints[e.breakpointId];a&&a.highlightStatement(t)},onDebuggerWarning:function(e){for(var t=0,n=e.breakpointIds;t<n.length;t++){var r=n[t],i=g.breakpoints[r];if(i&&!l.startsWith("pxt_modules/",i.fileName)){a&&a.highlightStatement(i);break}}},onDebuggerResume:function(){v("resumed"),a&&a.highlightStatement(null)},onStateChanged:function(e){e===pxsim.SimulatorState.Stopped?v("stopped"):e===pxsim.SimulatorState.Running&&this.onDebuggerResume(),i.onStateChanged(e)},onSimulatorReady:function(){pxt.perf.recordMilestone("simulator ready"),pxt.perf.perfReportLogged||pxt.perf.report()},onSimulatorCommand:function(t){switch(t.command){case"setstate":i.setState(t.stateKey,t.stateValue);break;case"restart":i.restartSimulator();break;case"reload":u(!0),i.restartSimulator();break;case"modal":if(u(),!(pxt.shell.isSandboxMode()||t.displayOnceId&&c[t.displayOnceId])){var e={header:t.header,body:t.body,size:"large",copyable:t.copyable,disagreeLbl:lf("Close"),modalContext:t.modalContext},n=pxt.appTarget.simulator.trustedUrls,r=t.linkButtonHref&&n&&-1!==n.indexOf(t.linkButtonHref);r?e.agreeLbl=t.linkButtonLabel:e.hideAgree=!0,c[t.displayOnceId]=!0,o.confirmAsync(e).then(function(e){r&&1==e&&window.open(t.linkButtonHref,"_blank")}).done()}}},onTopLevelCodeEnd:function(){v("toplevelfinished")},stoppedClass:pxt.appTarget.simulator&&pxt.appTarget.simulator.stoppedClass,invalidatedClass:pxt.appTarget.simulator&&pxt.appTarget.simulator.invalidatedClass};m.driver=new pxsim.SimulatorDriver(document.getElementById("simulators"),r),a=i}};function n(){m.driver&&m.driver.setDirty()}function u(e,t){m.driver&&(m.driver.stopSound(),m.driver.stop(e,t))}m.setState=function(e,t){a&&a.editor!=e&&(a.editor=e,a.highlightStatement(null)),t},m.setDirty=n,m.setPending=function(){m.driver&&m.driver.setPending()},m.run=function(e,t,n,r){var i=n.outfiles[pxtc.BINARY_JS],o=pxt.appTarget.simulator.boardDefinition,a=pxtc.computeUsedParts(n,!0),s=n.usedArguments;g=n;var l=r.mute,c=r.highContrast,u=r.light,p=r.clickTrigger,d=r.storedState,f=r.autoRun,h={boardDefinition:o,mute:l,parts:a,debug:t,fnArgs:s,highContrast:c,light:u,aspectRatio:a.length?pxt.appTarget.simulator.partsAspectRatio:pxt.appTarget.simulator.aspectRatio,partDefinitions:e.computePartDefinitions(a),cdnUrl:pxt.webConfig.commitCdnUrl,localizedStrings:m.simTranslations,refCountingDebug:pxt.options.debug,version:e.version(),clickTrigger:p,breakOnStart:t,storedState:d,autoRun:f};v("started"),m.driver.run(i,h)},m.mute=function(e){m.driver&&m.driver.mute(e)},m.stop=u,m.suspend=function(){m.driver&&m.driver.suspend()},m.hide=function(e){m.driver&&m.driver.hide(e)},m.unhide=function(){m.driver&&m.driver.unhide()},m.setTraceInterval=function(e){m.driver&&m.driver.setTraceInterval(e)},m.proxy=function(e){m.driver&&m.driver.postMessage(e)},m.dbgPauseResume=function(){m.driver.state==pxsim.SimulatorState.Paused?m.driver.resume(pxsim.SimulatorDebuggerCommand.Resume):m.driver.state==pxsim.SimulatorState.Running&&m.driver.resume(pxsim.SimulatorDebuggerCommand.Pause)},m.dbgStepOver=function(){m.driver.state==pxsim.SimulatorState.Paused&&m.driver.resume(pxsim.SimulatorDebuggerCommand.StepOver)},m.dbgStepInto=function(){m.driver.state==pxsim.SimulatorState.Paused&&m.driver.resume(pxsim.SimulatorDebuggerCommand.StepInto)},m.dbgStepOut=function(){m.driver.state==pxsim.SimulatorState.Paused&&m.driver.resume(pxsim.SimulatorDebuggerCommand.StepOut)}},{"./core":41,"./coretsx":42}],93:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("react"),o=e("./data"),p=e("./sui"),d=e("./marked"),a=e("./compiler"),c=e("react-dom"),f=e("./package"),h=e("./core"),m=e("./snippetBuilderInputHandler"),g=function(t){function e(e){var a=t.call(this,e)||this;return a.generateOutputMarkdown=pxt.Util.debounce(function(){var e=a.state,t=e.config,n=e.tsOutput,r="```"+t.outputType+"\n";r+=a.replaceTokens(a.highlightEditedBlocks(n)),r+="\n```",a.setState({mdOutput:r})},300,!1),a.onChange=function(o){return function(r){var i=a.getCurrentQuestion();a.setState(function(e){var t,n=s({},e.answers,((t={})[o]=r,t));return{answers:n,tsOutput:a.updateOutput(i,n,e.tsOutput)}},a.generateOutputMarkdown)}},a.state={visible:!1,answers:{},history:[0],defaults:{},config:e.config,tsOutput:[e.config.initialOutput]},a.cleanup=a.cleanup.bind(a),a.hide=a.hide.bind(a),a.cancel=a.cancel.bind(a),a.confirm=a.confirm.bind(a),a.backPage=a.backPage.bind(a),a.nextPage=a.nextPage.bind(a),a.handleModalKeyDown=a.handleModalKeyDown.bind(a),a}return i(e,t),e.prototype.buildDefaults=function(){for(var e={},t=0,n=this.state.config.questions;t<n.length;t++)for(var r=0,i=n[t].inputs;r<i.length;r++){var o=i[r];if(v(o)){var a=o.defaultAnswer;e[o.answerToken]=a}else for(var s=o.defaultAnswers,l=o.answerTokens,c=0;c<l.length;c++){var u=l[c];a=s[c],e[u]=a}}this.setState({answers:e,defaults:e},this.generateOutputMarkdown)},e.prototype.toggleActionButton=function(){var e;e=this.isLastQuestion()?{label:lf("Done"),onclick:this.confirm,icon:"check",className:"approve positive"}:{label:lf("Next"),onclick:this.nextPage,icon:"arrow right",className:"arrow right"},this.state.actions[1]!==e&&this.setState({actions:[this.state.actions[0],e]})},e.prototype.initializeActionButtons=function(){var e=[{label:lf("Back"),onclick:this.backPage,icon:"arrow left",className:"arrow left",labelPosition:"left"},{label:lf("Next"),onclick:this.nextPage,icon:"arrow right",className:"arrow right"}];this.setState({actions:e})},e.prototype.componentDidMount=function(){this.buildDefaults()},e.prototype.replaceTokens=function(e){for(var t=this.state,n=t.answers,r=t.defaults,i=e.join("\n"),o=0,a=Object.keys(r);o<a.length;o++){var s=a[o],l=n[s]||r[s];i=i.split("$"+s).join(l)}return i},e.prototype.highlightEditedBlocks=function(e){var o=this.getCurrentQuestion().inputs.reduce(function(e,t){return v(t)?pxt.Util.concat([e,[t.answerToken]]):pxt.Util.concat([e,t.answerTokens])},[]);return e.reduce(function(e,t){for(var n=0,r=o;n<r.length;n++){var i=r[n];if(-1!==t.indexOf(i))return pxt.Util.concat([e,["// @highlight",t]])}return pxt.Util.concat([e,[t]])},[])},e.prototype.hide=function(){this.setState({visible:!1})},e.prototype.show=function(){pxt.tickEvent("snippet.builder.show",null,{interactiveConsent:!0}),this.initializeActionButtons(),this.setState({visible:!0})},e.prototype.cleanup=function(){this.setState({answers:{},history:[0],tsOutput:[this.props.config.initialOutput]}),Blockly.hideChaff()},e.prototype.cancel=function(){var e=this.state.config.name;pxt.tickEvent("snippet.builder.cancel",{snippet:e,page:this.getCurrentPage()},{interactiveConsent:!0}),this.hide(),this.cleanup()},e.prototype.injectBlocksToWorkspace=function(){var t=this,n=this.state.tsOutput,s=this.props.mainWorkspace,l=this.state.config.outputBehavior;a.getBlocksAsync().then(function(e){return a.decompileBlocksSnippetAsync(t.replaceTokens(n),e)}).then(function(e){var t=Blockly.Xml.textToDom(e),n=pxt.blocks.findRootBlocks(t),r=s.getTopBlocks(!0);"replace"===l&&(r.forEach(function(e){e.dispose(!1)}),r=[]);var i=n.map(function(t){var e=r.filter(function(e){return t.getAttribute("type")===e.type});return e.length?{newB:t,exB:e[0]}:{newB:t,exB:null}}),o=i.filter(function(e){return!!e.exB}),a=i.filter(function(e){return!e.exB});o.forEach(function(e){var t=e.newB,n=e.exB,r=pxt.blocks.findRootBlock(t),i=Blockly.Xml.domToBlock(r,s);n.getInput("HANDLER").connection.connect(i.previousConnection)}),a.forEach(function(e){var t=e.newB;Blockly.Xml.domToBlock(t,s)}),r.length<=1&&pxt.blocks.layout.flow(s,{useViewWidth:!0})}).catch(function(e){throw h.errorNotification(e),new Error("Failed to decompile snippet output")})},e.prototype.confirm=function(){var e=this.state.config.name;pxt.tickEvent("snippet.builder.back.page",{snippet:e,page:this.getCurrentPage()},{interactiveConsent:!0}),this.injectBlocksToWorkspace(),Blockly.hideChaff(),this.hide()},e.prototype.getCurrentPage=function(){var e=this.state.history;return e[e.length-1]},e.prototype.getCurrentQuestion=function(){return this.state.config.questions[this.getCurrentPage()]},e.prototype.getNextQuestionNumber=function(){var e=this.state,t=e.answers,n=e.defaults,r=this.getCurrentQuestion();if(r.goto){var i=r.goto.parameters;if(i)for(var o=0,a=i;o<a.length;o++){var s=a[o],l=s.answer,c=s.token;if(l&&c&&(l===t[c]||!t[c]&&l===n[c]))return s.question}return r.goto.question}return null},e.prototype.getNextQuestion=function(){var e=this.state.config,t=this.getNextQuestionNumber();return t?e.questions[t]:null},e.prototype.isLastQuestion=function(){return!this.getCurrentQuestion().goto},e.prototype.nextPage=function(){var e=this.state,t=e.config,n=e.history,r=this.getCurrentQuestion().goto;if(this.isLastQuestion())this.confirm();else if(r){var i=this.getNextQuestion(),o=this.updateOutput(i,this.state.answers,this.state.tsOutput),a=this.getNextQuestionNumber();this.setState({history:n.concat([a]),tsOutput:o},this.toggleActionButton),pxt.tickEvent("snippet.builder.next.page",{snippet:t.name,page:a},{interactiveConsent:!0}),this.generateOutputMarkdown()}},e.prototype.backPage=function(){var e=this,t=this.state,n=t.history,r=t.config;1<n.length&&this.setState({history:n.slice(0,n.length-1)},function(){e.toggleActionButton(),pxt.tickEvent("snippet.builder.back.page",{snippet:r.name,page:e.getCurrentPage()},{interactiveConsent:!0}),e.generateOutputMarkdown()})},e.prototype.handleModalKeyDown=function(e){13!==e.keyCode&&39!==e.keyCode||this.nextPage(),37===e.keyCode&&this.backPage()},e.prototype.updateOutput=function(t,n,e){var r=!1;if(t.outputConditionalOnAnswer){var i=t.outputConditionalOnAnswer;t.inputs.map(function(e){return v(e)?[e.answerToken]:e.answerTokens}).reduce(function(e,t){return e.concat(t)},[]).every(function(e){return n[e]!=i})&&(r=!0)}var o=!!t.output,a=o&&-1!==e.indexOf(t.output),s=e;return r||a||!o?r&&a&&(s=e.filter(function(e){return e!==t.output})):s=pxt.Util.concat([e,[t.output]]),s},e.prototype.renderCore=function(){var n=this,e=this.state,t=e.visible,r=e.answers,i=e.config,o=e.mdOutput,a=e.actions,s=(e.defaults,this.props.parent),l=this.getCurrentQuestion(),c=0===this.getCurrentPage();return u.createElement(p.Modal,{isOpen:t,className:"snippet-builder full-screen-no-bg "+(c?"no-back-btn":""),overlayClassName:"snippet-builder-modal-overlay",closeOnEscape:!0,closeIcon:!0,closeOnDimmerClick:!1,closeOnDocumentClick:!1,dimmer:!0,buttons:a,header:i.name,onClose:this.cancel,onKeyDown:this.handleModalKeyDown},u.createElement("div",{className:"snippet-builder-inner"},l&&u.createElement("div",{className:"snippet-question"},u.createElement("div",{className:"ui segment raised"},u.createElement("h3",null,pxt.Util.rlf(l.title)),u.createElement("div",{className:"ui equal width grid"},l.inputs.map(function(e,t){return u.createElement("span",{className:"column",key:"span-"+t},u.createElement(m.InputHandler,{onChange:v(e)?n.onChange(e.answerToken):n.onChange,input:e,value:v(e)?r[e.answerToken]:r[e.answerTokens[0]],onEnter:n.nextPage,key:v(e)?e.answerToken:e.answerTokens[0]}))})),l.errorMessage&&u.createElement("p",{className:"snippet-error"},l.errorMessage)),l.hint&&u.createElement("div",{className:"snippet hint ui segment"},pxt.Util.rlf(l.hint).split("\n").reduce(function(e,t){return e.concat([e.length?u.createElement("br",null):"",t])},[]))),u.createElement("div",{className:"snippet output-section"},o&&u.createElement(d.MarkedContent,{className:"snippet-markdown-content",markdown:o,parent:s}))))},e}(o.Component);function v(e){return void 0!==e.answerToken}n.SnippetBuilder=g,n.initializeSnippetExtensions=function(t,e,s,l){var n,r,i;(n=pxt.Util.concat(f.allEditorPkgs().map(function(e){return e.sortedFiles()})),r=n.filter(function(e){return"pxtsnippets.json"===e.name}).map(function(e){return pxt.Util.jsonTryParse(e.content)}),i=n.filter(function(e){return e.name.endsWith(".snippetts")}),r=r.map(function(e){return e.map(function(e){if(e.initialOutput.startsWith("file:")){var t=e.initialOutput.slice("file:".length,e.initialOutput.length);if(1!=i.filter(function(e){return e.name===t}).length)return pxt.reportError("snippetbuilder","invalid external .ts file path: "+t),null}return e}).filter(function(e){return!!e})}),pxt.Util.concat(r)).filter(function(e){return e.namespace==t}).forEach(function(a){e.push({name:"SNIPPET"+name+"_BUTTON",type:"button",attributes:{blockId:"SNIPPET"+name+"_BUTTON",label:a.label?pxt.Util.rlf(a.label):pxt.Util.lf("Editor"),weight:101,group:a.group&&a.group},callback:function(){var e,t,n,r,i,o;e=a,t=s,n=l,r=document.createElement("div"),i=document.body.appendChild(r),o={parent:n,mainWorkspace:t,config:e},c.render(u.createElement(g,o),i).show()}})})},n.isSnippetInputAnswerSingular=v,n.isSnippetInputAnswerTypeOther=function(e){return"number"!==e.type},n.isSnippetInputAnswerTypeNumber=function(e){return void 0!==e.max},n.isSnippetInputAnswerTypeYesNo=function(e){return"yesno"===e.type},n.isSnippetInputAnswerTypeDropdown=function(e){return void 0!==e.options}},{"./compiler":14,"./core":41,"./data":44,"./marked":71,"./package":81,"./snippetBuilderInputHandler":94,"./sui":100,react:284,"react-dom":240}],94:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),a=e("./data"),s=e("./components/ImageEditor/ImageEditor"),l=e("./sui"),c=e("./snippetBuilderPositionPicker"),u=e("./snippetBuilder"),p=function(n){function e(e){var t=n.call(this,e)||this;return t.textOnChange=function(e){return t.props.onChange(e)},t.variableNameOnChange=function(e){return t.props.onChange(ts.pxtc.escapeIdentifier(e))},t.state={isFocused:!1},t}return i(e,n),e.prototype.renderInput=function(){var e=this.props,t=e.value,n=e.input,r=e.onChange;switch(n.type){case"dropdown":return o.createElement(d,{input:n,value:t,onChange:r});case"yesno":return o.createElement(h,{input:n,onChange:r});case"spriteEditor":if(u.isSnippetInputAnswerTypeOther(n))return o.createElement(s.ImageEditor,{singleFrame:!0,initialValue:t,onChange:r});case"number":return o.createElement(f,{input:n,value:t,onChange:r,autoFocus:!0});case"positionPicker":if(!u.isSnippetInputAnswerSingular(n))return o.createElement(c.PositionPicker,{defaultX:parseInt(n.defaultAnswers[0]),defaultY:parseInt(n.defaultAnswers[1]),input:n,onChange:r});case"text":case"variableName":default:if(u.isSnippetInputAnswerTypeOther(n))return o.createElement(l.Input,{label:n.label&&n.label,value:t||"",onChange:"variableName"==n.type?this.variableNameOnChange:this.textOnChange,autoFocus:!0,selectOnMount:!0})}return null},e.prototype.renderCore=function(){return this.renderInput()},e}(a.Component);n.InputHandler=p;var d=function(n){function e(e){var t=n.call(this,e)||this;return t.onChange=function(e){return function(){(0,t.props.onChange)(e)}},t.onChange=t.onChange.bind(t),t}return i(e,n),e.prototype.renderCore=function(){var t=this,e=this.props,n=e.value,r=e.input;return u.isSnippetInputAnswerTypeDropdown(r)?o.createElement(l.DropdownMenu,{className:"inline button",role:"menuitem",text:n.length?pxt.Util.rlf(r.options[n]):pxt.Util.rlf(r.options[Object.keys(r.options)[0]]),icon:"dropdown"},Object.keys(r.options).map(function(e){return o.createElement(l.Item,{role:"menuitem",value:e,key:r.options[e],text:pxt.Util.rlf(r.options[e]),onClick:t.onChange(e)})})):null},e}(a.Component),f=function(n){function e(e){var t=n.call(this,e)||this;return t.onChange=t.onChange.bind(t),t}return i(e,n),e.prototype.onChange=function(e){(0,this.props.onChange)(e.target.value)},e.prototype.renderCore=function(){var e=this.props,t=e.input,n=e.value,r=e.autoFocus;return u.isSnippetInputAnswerTypeNumber(t)?o.createElement("div",{className:"slider-outer"},o.createElement("span",null,t.label&&t.label),o.createElement("div",null,o.createElement("input",{type:"range",autoFocus:r,className:"slider blocklyMockSlider",role:"slider",max:t.max,min:t.min,value:n,onChange:this.onChange,"aria-valuemin":t.min,"aria-valuemax":t.max,"aria-valuenow":+n,style:{marginLeft:0}}),o.createElement(l.Input,{value:n,onChange:this.props.onChange,class:"snippet slider-input"}))):null},e}(a.Component),h=function(n){function e(e){var t=n.call(this,e)||this;return t.onChange=t.onChange.bind(t),t}return i(e,n),e.prototype.onChange=function(e){var t=this.props.onChange;return function(){return t(e)}},e.prototype.renderCore=function(){var e=this.props.input;return u.isSnippetInputAnswerTypeYesNo(e)?o.createElement("div",null,o.createElement(l.Button,{text:"Yes",title:"Yes",onClick:this.onChange("true")}),o.createElement(l.Button,{text:"No",title:"No",onClick:this.onChange("false")})):null},e}(a.Component)},{"./components/ImageEditor/ImageEditor":20,"./data":44,"./snippetBuilder":93,"./snippetBuilderPositionPicker":95,"./sui":100,react:284}],95:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("react"),o=e("./data"),l=e("./snippetBuilder"),s=e("./sui"),c=e("./snippetBuilderSimulatorDisplay"),u=function(t){function e(e){var s=t.call(this,e)||this;return s.onChange=function(a){return function(e){var t=s.props,n=t.input,r=t.onChange;if(!l.isSnippetInputAnswerSingular(n)){var i=s.state,o=parseInt(e);if(isNaN(o)||o<0)return;s.setState({x:a?s.unScalePointX(o):i.x,y:a?i.y:s.unScalePointY(o)},function(){var e=s.getScaledPoints();a&&r(n.answerTokens[0])(e.x.toString()),a||r(n.answerTokens[1])(e.y.toString()),s.setState({dotVisible:!0})})}}},s.state={x:s.unScalePointX(s.props.defaultX||80),y:s.unScalePointY(s.props.defaultY||60),dotVisible:!1},s.setDot=s.setDot.bind(s),s.onChange=s.onChange.bind(s),s.setScale=s.setScale.bind(s),s}return i(e,t),e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.setScale)},e.prototype.componentDidMount=function(){this.setScale(),window.addEventListener("resize",this.setScale)},e.prototype.setScale=function(){var e=window.innerHeight,t=window.innerWidth,n=t<e?t/2100:e/1003;n<.71?n=.71:1.01<n&&(n=1.01),this.setState({scale:n})},e.prototype.getScale=function(e,t){return t*this.state.scale/e},e.prototype.getXScale=function(){return this.getScale(160,309)},e.prototype.getYScale=function(){return this.getScale(120,227)},e.prototype.scalePoint=function(e,t){return isNaN(e)?0:Math.round(e/t)},e.prototype.scalePointX=function(e){return this.scalePoint(e,this.getXScale())},e.prototype.scalePointY=function(e){return this.scalePoint(e,this.getYScale())},e.prototype.unScalePoint=function(e,t){return isNaN(e)?0:Math.round(e*t)},e.prototype.unScalePointX=function(e){return this.unScalePoint(e,this.getXScale())},e.prototype.unScalePointY=function(e){return this.unScalePoint(e,this.getYScale())},e.prototype.getScaledPoints=function(){var e=this.state,t=e.x,n=e.y;return{x:this.scalePointX(t),y:this.scalePointY(n)}},e.prototype.scalePixel=function(e){return e*this.state.scale+"px"},e.prototype.setDot=function(e){var t=this,n=this.props,r=n.input,i=n.onChange,o=e.nativeEvent.offsetX,a=e.nativeEvent.offsetY;this.setState({dotVisible:!0,x:Math.round(o),y:Math.round(a)},function(){if(!l.isSnippetInputAnswerSingular(r)){var e=t.getScaledPoints();i(r.answerTokens[0])(e.x.toString()),i(r.answerTokens[1])(e.y.toString())}})},e.prototype.renderCore=function(){var e=this.state,t=e.dotVisible,n=e.x,r=e.y,i=e.scale,o=this.getScaledPoints();return a.createElement("div",null,a.createElement("div",{className:"ui grid"},a.createElement("div",{className:"column"},a.createElement(s.Input,{class:"position-picker preview-input",value:o.x.toString(),onChange:this.onChange(!0)})),a.createElement("div",{className:"column"},a.createElement(s.Input,{class:"position-picker preview-input",value:o.y.toString(),onChange:this.onChange(!1)}))),a.createElement(c.SimulatorDisplay,{scale:i},a.createElement("div",{ref:"positionPickerContainer",className:"position-picker container",onClick:this.setDot,style:{left:this.scalePixel(28),top:this.scalePixel(28),width:this.scalePixel(309),height:this.scalePixel(227),margin:"8px",maxWidth:this.scalePixel(309),maxHeight:this.scalePixel(227)},role:"grid"},t&&a.createElement("div",{className:"position-picker dot",style:{top:r+"px",left:n+"px"}}))))},e}(o.Component);n.PositionPicker=u},{"./data":44,"./snippetBuilder":93,"./snippetBuilderSimulatorDisplay":96,"./sui":100,react:284}],96:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("react"),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.scalePixel=function(e,t){return""+e*this.props.scale+(!t&&"px")},t.prototype.renderCore=function(){var e=this.props,t=e.children,n=e.scale,r=s.createElement("svg",{height:"127.2",width:"127.2",style:{transform:"scale("+n+")",transformOrigin:"0 0",position:"absolute",left:"0px",top:this.scalePixel(297.85)},visibility:"visible"},s.createElement("g",{transform:"translate(18.80933368822642 18.80933368822642) scale(3.7618667376452843)"},s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 23.813 24.362",width:"23.813",height:"24.362"},s.createElement("path",{fill:"#f290c1",d:"M11.906 0c-2.431 0-3.304.092-3.59.378-.29.29-.378 1.21-.378 3.969v3.591h-3.59c-2.76 0-3.68.087-3.97.378C.092 8.602 0 9.474 0 11.9c0 3.051.032 3.237.65 3.855.62.62.797.65 3.968.65h3.32v3.583c0 2.49.1 3.697.33 3.958.48.544 6.688.56 7.23.018.29-.29.377-1.21.377-3.968v-3.591h3.32c3.171 0 3.348-.03 3.969-.65.618-.618.649-.804.649-3.855 0-2.426-.092-3.298-.378-3.584-.288-.288-1.174-.378-3.704-.378h-3.327V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.98-.65-1.172-3.969-1.172z"}),s.createElement("path",{fill:"#f291bd",d:"M11.906 0c-2.431 0-3.304.092-3.59.378-.29.29-.378 1.21-.378 3.969v3.591h-3.59c-2.76 0-3.68.087-3.97.378C.092 8.602 0 9.474 0 11.9c0 3.051.032 3.237.65 3.855.62.62.797.65 3.968.65h3.32v3.583c0 2.49.1 3.697.33 3.958.48.544 6.688.56 7.23.018.29-.29.377-1.21.377-3.968v-3.591h3.241c3.027-.001 3.29-.042 3.97-.627.719-.619.727-.66.727-3.855 0-2.446-.092-3.321-.378-3.607-.288-.288-1.174-.378-3.704-.378h-3.327V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.98-.65-1.172-3.969-1.172zm1.799.534c.188-.002.635.288.992.645.626.626.649.781.649 4.234 0 2.368-.096 3.583-.283 3.583-.19 0-.263-1.135-.222-3.438.058-3.3.035-3.46-.552-3.969-.336-.292-.504-.532-.372-.534.131-.002.06-.12-.159-.26-.283-.184-.298-.258-.053-.261zm-4.488.525c.12 0 .22.178.22.397 0 .45-.019.466-.264.22-.247-.246-.22-.617.044-.617zm-.561 6.398c.044-.018.099.08.19.283.114.254.138.641.054.86-.169.44-.962.549-.962.132 0-.146.11-.265.246-.265s.293-.268.35-.595c.046-.261.078-.396.122-.415zM22.4 8.997c.24 0 .883.755.883 1.039 0 .387-.45.357-.704-.048-.25-.399-.356-.992-.18-.992zM.936 9.63c.027-.006.051 0 .071.02.082.081 0 .295-.18.474-.261.26-.292.23-.148-.148.074-.196.176-.327.257-.346zm21.876 2.83c.038-.01.107.097.234.315.151.26.234.595.185.745-.142.424-.477-.054-.468-.666.003-.254.01-.383.049-.394zm-22.071.88a.16.16 0 0 1 .053.02c.145.09.264.336.264.546 0 .21-.119.381-.264.381-.146 0-.265-.245-.265-.545 0-.262.091-.426.212-.403zm3.214 1.5c1.97-.026 4.558.11 4.762.355.137.166.27 1.781.296 3.59.03 2.222-.05 3.319-.25 3.385-.208.07-.296-.931-.296-3.363v-3.462H5.012c-2.294 0-3.4-.09-3.288-.271.089-.144 1.049-.218 2.231-.234zm5.258 7.66c.128.001.393.127.725.378.387.292.416.387.116.386-.218 0-.55-.176-.738-.388-.22-.25-.23-.375-.103-.375z"}),s.createElement("path",{fill:"#a3809c",d:"M12.012 0C7.81 0 7.938-.139 7.938 4.407v3.531H4.453c-4.58 0-4.453-.113-4.452 3.943 0 2.844.045 3.122.625 3.796.622.723.65.728 3.97.728h3.342v3.609c0 3.126.062 3.655.463 3.96.318.241 1.374.354 3.38.36 4.184.012 4.094.108 4.094-4.372v-3.557h3.271c3.182 0 3.29-.02 3.969-.698.675-.675.697-.798.69-3.77-.006-2.135-.116-3.214-.36-3.536-.302-.398-.821-.463-3.696-.463h-3.345V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416C15.875.199 15.22 0 12.012 0zm-.106.53c1.92 0 2.208.067 2.79.65.621.62.65.797.65 3.968v3.32h3.32c3.171 0 3.348.028 3.968.649.575.574.65.879.65 2.646 0 1.154-.112 1.996-.265 1.996-.15 0-.265-.75-.265-1.718 0-1.386-.111-1.846-.576-2.381-.56-.644-.678-.664-3.97-.664h-3.391V5.677c0-3.171-.029-3.348-.65-3.969-.547-.547-.902-.65-2.26-.65-1.359 0-1.714.103-2.261.65-.62.62-.65.798-.65 3.97v3.318h-3.32c-3.17 0-3.347.03-3.968.65-.568.568-.65.886-.65 2.532 0 1.28.122 2.005.379 2.261.29.29 1.21.378 3.969.378h3.59v3.394c0 3.205.034 3.425.612 3.968.45.422.944.576 1.852.576.682 0 1.24.119 1.24.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.579-.578-.65-.874-.65-2.711.001-1.787.084-2.16.627-2.79.62-.723.65-.728 3.968-.728h3.343V5.148c0-3.171.029-3.348.65-3.969.582-.582.87-.65 2.79-.65zM9.782 11.668c.154.024.358.267.56.723.182.412.668.898 1.08 1.08.412.183.749.441.749.575 0 .133-.281.242-.625.242-.807 0-2.02-1.214-2.02-2.02 0-.426.102-.623.256-.6z"}),s.createElement("path",{fill:"#a8769a",d:"M12.06 0C7.84 0 7.939-.105 7.939 4.425v3.513H4.5c-4.598 0-4.5-.086-4.5 3.991 0 2.976.023 3.104.697 3.778.678.678.787.698 3.969.698h3.27v3.485c0 2.87.078 3.57.439 3.968.374.413.865.484 3.356.484 2.633 0 2.978-.057 3.53-.576.58-.543.613-.763.613-3.968v-3.394l3.241-.008c4.438-.011 4.697-.266 4.697-4.618 0-3.822-.02-3.84-4.234-3.84h-3.175V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.97-.657-1.172-3.814-1.172zm-.154.53c1.92 0 2.208.067 2.79.65.621.62.65.797.65 3.968v3.32h3.32c3.171 0 3.348.028 3.968.649.575.574.65.879.65 2.646 0 1.737-.062 1.996-.471 1.996-.26 0-.643.238-.852.529-.348.482-.685.53-3.763.53h-3.381l-.034 1.653c-.018.91-.04 2.424-.047 3.366-.011 1.42-.117 1.817-.616 2.316-.33.33-.786.602-1.01.602-.225 0-.41.119-.41.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.582-.582.87-.65 2.79-.65zm0 2.116c-.617 0-.793.117-.793.529 0 .291-.12.53-.265.53-.145 0-.265.237-.265.528 0 .291-.119.53-.264.53-.146 0-.265.238-.265.529 0 .29-.119.529-.264.529-.146 0-.28.208-.3.463-.019.254-.127.046-.24-.463l-.206-.926.042.926.042.926 2.646.147c1.455.081 2.735.17 2.844.199.251.064.26-1.072.013-1.714-.167-.433-.202-.419-.331.13-.128.541-.232.448-.877-.794-.402-.774-.73-1.557-.727-1.738.002-.192-.329-.331-.79-.331zm9.525 6.35c-.013.013.067.12.231.33.346.441.563.582.563.364 0-.055-.208-.264-.463-.463-.21-.165-.317-.245-.33-.231zm-14.874.021c-.772-.016-.951.065-.831.377.111.29-.285.596-1.455 1.125-1.343.607-1.608.834-1.609 1.387-.001.56.264.78 1.722 1.432 1.728.772 1.875 1.067.643 1.288-.364.065.35.115 1.588.11 1.237-.005 1.802-.055 1.257-.112l-.993-.104v-2.608c0-1.838.098-2.647.331-2.741.182-.073-.112-.143-.653-.154zm5.365.464c-.676.022-1.35.282-1.77.772-.651.756-.817 1.389-.364 1.389.144 0 .41-.238.592-.53.426-.68 1.271-.673 2.152.02.85.668.931 1.812.168 2.362-.29.21-.529.474-.529.587 0 .383.718.21 1.42-.342.93-.732.996-2.67.121-3.602-.434-.462-1.113-.678-1.79-.656zm5.23.044c-.229 0-.313 4.58-.089 4.804.071.071 1.017-.296 2.1-.816 1.73-.83 1.973-1.034 1.987-1.673.01-.4-.1-.728-.244-.728-.143 0-.997-.357-1.898-.793-.901-.437-1.737-.794-1.856-.794zm-15.98 3.386c-.034.018-.058.178-.062.45-.005.437.05.648.122.469.073-.18.077-.537.01-.794-.025-.097-.05-.136-.07-.125zm1.704 1.673a2.998 2.998 0 0 0-.558.046c-.329.063-.122.117.46.12.582.003.852-.049.599-.115a2.182 2.182 0 0 0-.501-.05zm10.134 2.282c-.297.002-.625.008-.97.02-1.538.051-2.515.193-2.515.364 0 .154.387 1.092.86 2.084.721 1.513.967 1.804 1.521 1.81.568.004.793-.279 1.588-2.005.51-1.105.956-2.083.993-2.174.028-.067-.585-.104-1.477-.099zm-3.946 4.427a.043.043 0 0 0-.03.012c-.062.063.037.296.221.517.472.57.6.501.216-.114-.155-.249-.325-.419-.407-.415z"}),s.createElement("path",{fill:"#2f99a1",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.796-.649-3.98-.649H15.85l.053-3.579c.067-4.471.184-4.338-3.811-4.35zm-.114.52c2.033 0 2.26.055 2.79.664.527.606.577.952.577 3.969v3.305h3.32c3.171 0 3.348.03 3.968.65.575.574.65.879.65 2.646 0 1.737-.062 1.996-.471 1.996-.26 0-.643.238-.852.529-.348.482-.685.53-3.763.53h-3.381v3.318c0 3.172-.029 3.349-.65 3.97-.356.356-.833.649-1.058.649-.224 0-.409.119-.409.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.862-.65zm-.044 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.01.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.058-2.38.128s.444 1.026.987 2.124c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),s.createElement("path",{fill:"#96266c",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.796-.649-3.98-.649H15.85l.053-3.579c.067-4.471.184-4.338-3.811-4.35zm-.114.52c2.033 0 2.26.055 2.79.664.527.606.577.952.577 3.969v3.305h3.32c3.171 0 3.348.03 3.968.65.583.582.65.87.65 2.79s-.067 2.207-.65 2.79c-.62.62-.797.65-3.968.65h-3.32v3.318c0 3.172-.029 3.349-.65 3.97-.588.588-.854.647-2.843.633-1.965-.015-2.258-.083-2.79-.652-.553-.59-.596-.878-.596-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.862-.65zm-.044 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.01.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.058-2.38.128s.444 1.026.987 2.124c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),s.createElement("path",{fill:"#5b3b6a",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.797-.649-3.968-.649h-3.32v-3.61c0-3.126-.062-3.655-.463-3.96-.317-.24-1.364-.353-3.319-.36zm-.112.52c1.973 0 2.277.067 2.79.613.528.562.575.887.575 3.969v3.356h3.394c3.205 0 3.425.034 3.968.612.495.527.575.919.575 2.79 0 1.96-.064 2.243-.649 2.828-.62.62-.797.65-3.968.65h-3.32v3.318c0 3.172-.029 3.349-.65 3.97-.585.585-.865.649-2.863.649-1.974 0-2.278-.067-2.79-.613-.529-.562-.576-.886-.576-3.968v-3.357H5.074c-3.205 0-3.426-.034-3.969-.612-.498-.53-.576-.917-.576-2.863 0-2.072.053-2.296.664-2.827.605-.527.951-.577 3.969-.577h3.305V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.864-.65zm-.046 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.009.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.057-2.38.127s.444 1.027.987 2.125c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),s.createElement("path",{d:"M9.763 0c-.295.002-.765.24-1.176.65-.357.357-.65.714-.65.794 0 .323.437.111.794-.385.21-.291.594-.53.853-.53.258 0 .47-.118.47-.264 0-.182-.114-.265-.29-.265zm4.286 0c-.177 0-.29.083-.29.265 0 .146.187.265.415.265 1.002 0 1.172.63 1.172 4.346 0 2.218.101 3.591.265 3.591.163 0 .264-1.37.264-3.584 0-3.452-.023-3.607-.649-4.233-.41-.41-.882-.648-1.177-.65zM4.883 7.938c-3.452 0-3.608.024-4.233.65C.293 8.945 0 9.42 0 9.646c0 .225.12.409.265.409.145 0 .264-.188.264-.416 0-1.002.632-1.172 4.347-1.172 2.218 0 3.59-.101 3.59-.264 0-.164-1.37-.265-3.583-.265zm18.04.612a.168.168 0 0 0-.115.054c-.102.11-.037.253.145.318s.33.347.33.626.12.507.265.507c.146 0 .265-.188.265-.416 0-.459-.579-1.112-.89-1.089zM.265 13.76c-.485 0-.273.81.385 1.467.62.62.797.65 3.968.65h3.32v3.58c0 3.35.038 3.623.595 4.218.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.626-.626.65-.781.65-4.234v-3.584h3.391c3.291 0 3.41-.02 3.969-.663.603-.693.766-1.453.312-1.453-.145 0-.265.187-.265.416 0 1.001-.63 1.171-4.346 1.171h-3.591v3.591c0 3.716-.17 4.347-1.172 4.347-.228 0-.416.119-.416.264 0 .152-.793.265-1.852.265-1.058 0-1.852-.113-1.852-.265 0-.145-.186-.264-.415-.264-1.002 0-1.172-.631-1.172-4.347v-3.59h-3.59c-3.716 0-4.348-.17-4.348-1.172 0-.229-.119-.416-.264-.416z"})),s.createElement("rect",{className:"controller-button-overlay",x:"7.937666666666666",y:"0",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),s.createElement("rect",{className:"controller-button-overlay",x:"15.875333333333332",y:"7.937666666666666",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),s.createElement("rect",{className:"controller-button-overlay",x:"7.937666666666666",y:"15.875333333333332",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),s.createElement("rect",{className:"controller-button-overlay",x:"0",y:"7.937666666666666",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}))),i=s.createElement("svg",{height:"127.2",width:"127.2",style:{transform:"scale("+n+")",transformOrigin:"0 0",position:"absolute",left:this.scalePixel(240.8),top:this.scalePixel(297.85)},visibility:"visible"},s.createElement("g",{transform:"translate(17.15858198888469 17.15858198888469) scale(3.4317163977769383)"},s.createElement("g",{transform:"translate(13.533000000000001 2.2554999999999996)"},s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.533 13.246",width:"13.533",height:"13.246"},s.createElement("path",{fill:"#ff8135",stroke:"#5c406c",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:".861",d:"M13.099 6.602c.1 2.457-1.61 4.712-3.813 5.662a6.152 6.152 0 0 1-4.661.175C1.38 11.444-.431 7.43.85 4.317c.68-1.583 1.982-2.925 3.63-3.485 2.494-.914 5.612-.248 7.246 1.923a6.112 6.112 0 0 1 1.372 3.847z"}),s.createElement("path",{fill:"#e5cdc4",fillRule:"evenodd",stroke:"#e5cdc4",strokeWidth:".265",d:"M2.454 2.619C.284 4.916 1.146 7.611 1.146 7.611c.792-4.598 3.68-6.217 8.39-6.006 0 0-4.269-1.965-7.082 1.014z"}),s.createElement("path",{fill:"#af4282",d:"M8.745 9.825h1.423l-1.72-6.914H7.027L2.542 9.825h1.412c.444-.507.61-1.53 1.45-1.304H8.42l.326 1.304zm-.602-2.519H5.574c.621-.807 1.397-2.523 1.92-2.76l.649 2.76z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})),s.createElement("circle",{className:"controller-button-overlay",cx:"6.766500000000001",cy:"6.766500000000001",r:"6.766500000000001",fill:"black",fillOpacity:"0"})),s.createElement("g",{transform:"translate(0 13.533000000000001)"},s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.533 13.246",width:"13.533",height:"13.246"},s.createElement("path",{fill:"#ff91c4",stroke:"#5c406c",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:".861",d:"M13.099 6.602c.1 2.457-1.61 4.712-3.813 5.662a6.152 6.152 0 0 1-4.661.175C1.38 11.444-.431 7.43.85 4.317c.68-1.583 1.982-2.925 3.63-3.485 2.494-.914 5.612-.248 7.246 1.923a6.112 6.112 0 0 1 1.372 3.847z"}),s.createElement("path",{fill:"#e5cdc4",fillRule:"evenodd",stroke:"#e5cdc4",strokeWidth:".265",d:"M2.454 2.619C.284 4.916 1.051 7.563 1.051 7.563c.793-4.597 3.823-6.169 8.533-5.958 0 0-4.317-1.965-7.13 1.014z"}),s.createElement("path",{fill:"#af4282",d:"M5.337 7.226c.909.088 1.876-.201 2.736.21.288.113.37.493.32.773-.143.515-.716.742-1.197.817-.607-.047-1.91.169-2.181-.227-.058-.371.217-.697.222-1.073l.1-.5zM5.88 4.49c.81.122 1.664-.209 2.444.123.263.119.537.35.451.67-.591 1.227-2.213.797-3.21.797l.315-1.59zm2.233-1.186h-3.28L3.45 10.22c1.523-.054 3.064.132 4.572-.152 1.117-.305 1.976-1.536 1.666-2.692-.146-.282-.515-.448-.562-.79.088-.354.606-.278.717-.652.452-.693.41-1.769-.288-2.287-.42-.274-.95-.333-1.442-.342z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})),s.createElement("circle",{className:"controller-button-overlay",cx:"6.766500000000001",cy:"6.766500000000001",r:"6.766500000000001",fill:"black",fillOpacity:"0"})))),o=s.createElement("svg",{visibility:"visible",width:"70px",height:"26.25px",style:{transform:"scale("+n+")",transformOrigin:"0 0",position:"absolute",left:this.scalePixel(105.25),top:this.scalePixel(284)}},s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.937 6.35"},s.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .806-.072.806.073 0 .17 1.912.36 5.969.36s6.334 0 6.334-.169c0-.145.184-.264.41-.264.224 0 .7-.293 1.057-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472z",fill:"#f290c1"}),s.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .806.008.806.153 0 .17 1.418-.021 5.376-.021 3.85 0 6.693.297 6.795.132.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm13.915.983l.595.366c.385.237.595.623.595 1.096 0 .401-.06.73-.132.73-.135 0-.187-.708-.066-.898.036-.058-.172-.372-.463-.7zM.898 3.543c.097.003.164.108.164.278 0 .465-.158.533-.385.166-.084-.136-.031-.321.117-.413a.188.188 0 0 1 .104-.032zm.6.502c.039-.013.065.073.073.254.011.255.11.45.22.432.108-.017 2.103-.009 4.43.019 2.704.031 4.043.134 3.705.283-.291.128-2.22.227-4.288.22-3.826-.013-4.575-.204-4.225-1.077.033-.08.061-.123.085-.131z",fill:"#f291bd"}),s.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 1.076.04 1.076.185 0 .17 1.807.09 5.765.09 3.85 0 6.034.154 6.136-.011.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm1.1.53H15.11l.65.649c.639.64.9 1.996.384 1.996-.146 0-.265-.178-.265-.395 0-.217-.26-.693-.577-1.058l-.576-.664H8.873c-6.265 0-6.941.117-7.496 1.293-.44.931-.4 1.181.298 1.836.575.54.865.575 4.762.575 2.59 0 4.15.1 4.15.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.924-.986-.797-3.218.34-4.26z",fill:"#a3809c"}),s.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.826.65 1.043.65.216 0 .386.232.542.241.535.03.73.005 1.13-.049.4-.055 3.114.04 6.344-.023l5.872-.115.676-.677c.577-.577.676-.912.676-2.288 0-1.358-.101-1.713-.649-2.26l-.65-.65H8.472zm.766.53h13.04l.65.649c.742.742.92 2.157.239 1.895-.234-.09-.342-.045-.25.102.088.143-.139.558-.504.923-.591.591-.881.663-2.66.663-1.154 0-1.997.112-1.997.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.863-.92-.714-3.018.251-4.05zm12.487.528c-.013.014.067.121.231.331.2.255.408.463.463.463.218 0 .078-.217-.363-.563-.21-.164-.317-.244-.33-.23zM1.184 3.44c-.117 0 .066.297.408.661.341.364.714.661.827.661.113 0 .39.053.054-.311-.337-.364-1.171-1.011-1.289-1.011zM6.09 4.528c-.6 0-1.2.013-1.654.039-.91.051-.165.094 1.654.094s2.563-.043 1.653-.094a31.07 31.07 0 0 0-1.653-.04z",fill:"#a8769a"}),s.createElement("path",{d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.885.886.815 1.583-.269 2.666-.884.884-.703.965-2.624.965-1.153 0-2.28.064-2.28.217 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.845-.902-.819-2.572.054-3.444z",fill:"#2f99a1"}),s.createElement("path",{d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.016.103.855-.735c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.477.478.648.935.648 1.731 0 .797-.17 1.254-.649 1.732l-.65.65-6.692-.016-6.693-.017-.595-.635c-.845-.904-.755-2.749.118-3.62z",fill:"#5b3b6a"}),s.createElement("path",{d:"M16.673 1.587c-.12-.084-.265.542-.265 1.203 0 .924-.15 1.353-.649 1.852l-.65.65-13.228-.19-.698-.46c-.356-.357-.506-.943-.506-1.17 0-.224-.262-.297-.407-.297-.533 0-.005 1.371.833 2.25l.622.359 6.69.019 6.689.018.917-.917c.777-.777.917-1.101.917-2.117 0-.66-.034-1.037-.153-1.12z"}),s.createElement("text",{style:{lineHeight:"1.25"},x:"2.765",y:"2.203",fontWeight:"400",fontSize:"5.333",fontFamily:"sans-serif",letterSpacing:"0",wordSpacing:"0"}),s.createElement("g",{"aria-label":"reset",style:{lineHeight:1.25},fontWeight:"400",fontSize:"4.667",fontFamily:"Arial Rounded MT Bold",letterSpacing:"0",wordSpacing:"0",fill:"#5b3b6a"},s.createElement("path",{d:"M3.417 3.587v.52c0 .125-.03.22-.088.284a.298.298 0 0 1-.226.093.285.285 0 0 1-.221-.095c-.058-.064-.087-.158-.087-.283V2.374c0-.28.101-.419.303-.419.104 0 .178.033.224.098a.54.54 0 0 1 .075.29c.074-.128.15-.225.228-.29a.478.478 0 0 1 .314-.098c.13 0 .258.033.38.098.124.065.185.152.185.26a.249.249 0 0 1-.08.19.242.242 0 0 1-.168.072.815.815 0 0 1-.166-.041.74.74 0 0 0-.23-.043.335.335 0 0 0-.224.073c-.058.047-.055.165-.087.26-.032.093-.101.158-.113.289-.013.129-.019.287-.019.474zM6.464 3.372H5.247c.002.142.03.266.084.374.057.108.13.19.221.244a.59.59 0 0 0 .306.082c.074 0 .094-.04.155-.057.062-.018.138-.093.196-.13.058-.037.11-.046.16-.088.048-.043.143-.053.22-.126a.204.204 0 0 1 .137-.041c.064 0 .115.017.155.052.04.035.06.085.06.149a.41.41 0 0 1-.067.198.798.798 0 0 1-.2.216c-.089.069-.2.126-.335.171a1.432 1.432 0 0 1-.463.068c-.4 0-.758-.05-.98-.278-.221-.228-.285-.6-.285-.99 0-.185.028-.355.082-.511.055-.158.135-.293.24-.406.105-.112.234-.198.387-.257.153-.061.324-.091.51-.091.244 0 .452.051.625.155.175.101.305.234.392.396.086.163.13.328.13.497 0 .156-.045.258-.135.305a.85.85 0 0 1-.378.068zM5.247 3.02l1.049-.016c-.016-.212.006-.355-.094-.46a.51.51 0 0 0-.392-.16.5.5 0 0 0-.383.162c-.099.107-.159.265-.18.474zM9.506 3.671a.768.768 0 0 1-.125.442.776.776 0 0 1-.372.278c-.162.062-.36.093-.595.093-.223 0-.414-.034-.574-.102a.841.841 0 0 1-.353-.255.521.521 0 0 1-.114-.31.25.25 0 0 1 .257-.248c.066 0 .116.015.151.047a.524.524 0 0 1 .1.135c.064.11.076.146.165.2.266-.033.433.05.587.05.124 0 .067.053.146-.002.08-.056.12-.12.12-.191 0-.11-.041-.19-.125-.24a1.515 1.515 0 0 0-.407-.143 3.538 3.538 0 0 1-.524-.166.873.873 0 0 1-.322-.233.53.53 0 0 1-.12-.353c0-.125.037-.242.111-.353a.76.76 0 0 1 .328-.265c.146-.066.322-.1.527-.1.16 0 .305.017.433.05.129.034.236.079.32.135a.645.645 0 0 1 .197.187.361.361 0 0 1 .068.2.23.23 0 0 1-.073.176c-.047.045-.114.068-.203.068a.254.254 0 0 1-.164-.055 1.116 1.116 0 0 1-.152-.164.562.562 0 0 0-.167-.146.524.524 0 0 0-.26-.054.503.503 0 0 0-.28.073c-.074.047-.111.106-.111.177 0 .066.027.12.082.162.054.041.192.06.284.087.093.027.157.076.32.116.192.047.35.103.471.169a.767.767 0 0 1 .278.232c.064.088.096.19.096.303zM11.773 3.372l-1.121.064c.001.141-.066.202-.011.31.056.108.13.19.22.244a.59.59 0 0 0 .306.082.764.764 0 0 0 .203-.025.71.71 0 0 0 .18-.082c.058-.038.11-.078.16-.12l.189-.174a.204.204 0 0 1 .136-.041c.064 0 .116.017.155.052.04.035.06.085.06.149a.41.41 0 0 1-.067.198.797.797 0 0 1-.2.216c-.088.069-.2.126-.335.171a1.432 1.432 0 0 1-.463.068c-.4 0-.71-.113-.932-.341-.221-.228-.332-.537-.332-.928 0-.184.027-.354.082-.51.054-.158.134-.293.239-.406.105-.112.234-.198.387-.257.154-.061.324-.091.51-.091.244 0 .452.051.625.155.175.101.305.234.392.396.087.163.13.328.13.497 0 .156-.045.258-.135.305a.85.85 0 0 1-.378.068zm-1.217-.353h1.128c-.015-.212-.073-.371-.173-.476-.099-.106-.182-.064-.344-.064-.155 0-.267.006-.367.114-.099.106-.222.217-.244.426zM12.842 2.01h.068v-.374c0-.1.003-.178.007-.235a.362.362 0 0 1 .046-.148.272.272 0 0 1 .104-.102.307.307 0 0 1 .367.048c.043.04.07.088.08.145.012.057-.006.36.002.464l.016.202h.228c.088 0 .155.021.2.064.048.04.071.094.071.16 0 .083-.033.141-.1.175-.065.033-.208-.048-.283.05l-.108.143c-.082.381 0 .762 0 1.144 0 .097-.005.03.001.082a.245.245 0 0 0 .055.128c.03.032.08.048.146.048a.82.82 0 0 0 .148-.019.729.729 0 0 1 .146-.02c.05 0 .095.02.134.061.041.04.062.09.062.149 0 .1-.055.177-.164.23-.11.053-.267.08-.472.08-.194 0-.342-.033-.442-.099a.46.46 0 0 1-.198-.27c-.03-.116-.101-.27-.093-.463.015-.398-.12-.343.047-1.194h-.082c-.09 0-.158-.022-.205-.064a.209.209 0 0 1-.07-.162c0-.065.024-.118.072-.16a.326.326 0 0 1 .217-.063z"}))),s.createElement("rect",{className:"controller-button-overlay",width:"100%",height:"100%",fill:"black",fillOpacity:"0",rx:"10",ry:"10"})),a=s.createElement("svg",{visibility:"visible",width:"70px",height:"26.25px",style:{transform:"scale("+n+")",transformOrigin:"0 0",position:"absolute",left:this.scalePixel(192.75),top:this.scalePixel(284)}},s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.937 6.35"},s.createElement("path",{fill:"#f290c1",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.293.265 6.35.265 4.057 0 6.35-.096 6.35-.265 0-.145.184-.264.41-.264.224 0 .7-.293 1.057-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472z"}),s.createElement("path",{fill:"#f291bd",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.244.265 6.202.265 3.85 0 6.264-.1 6.366-.265.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm13.915.983l.595.366c.385.237.595.623.595 1.096 0 .401-.06.73-.132.73-.135 0-.187-.708-.066-.898.036-.058-.172-.372-.463-.7zM.898 3.543c.097.003.164.108.164.278 0 .465-.158.533-.385.166-.084-.136-.031-.321.117-.413a.188.188 0 0 1 .104-.032zm.6.502c.039-.013.065.073.073.254.011.255.11.45.22.432.108-.017 2.103-.009 4.43.019 2.704.031 4.043.134 3.705.283-.291.128-2.22.227-4.288.22-3.826-.013-4.575-.204-4.225-1.077.033-.08.061-.123.085-.131z"}),s.createElement("path",{fill:"#a3809c",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.244.265 6.202.265 3.85 0 6.264-.1 6.366-.265.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm1.1.53H15.11l.65.649c.639.64.9 1.996.384 1.996-.146 0-.265-.178-.265-.395 0-.217-.26-.693-.577-1.058l-.576-.664H8.873c-6.265 0-6.941.117-7.496 1.293-.44.931-.4 1.181.298 1.836.575.54.865.575 4.762.575 2.59 0 4.15.1 4.15.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.924-.986-.797-2.193.34-3.236z"}),s.createElement("path",{fill:"#a8769a",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.826.65 1.043.65.216 0 .46.108.542.241.082.133.476.196.876.142.4-.055 3.368-.151 6.598-.214l5.872-.115.676-.677c.577-.577.676-.912.676-2.288 0-1.358-.101-1.713-.649-2.26l-.65-.65H8.472zm.766.53h13.04l.65.649c.742.742.92 2.157.239 1.895-.234-.09-.342-.045-.25.102.088.143-.139.558-.504.923-.591.591-.881.663-2.66.663-1.154 0-1.997.112-1.997.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.863-.92-.793-2.239.172-3.272zm12.487.528c-.013.014.067.121.231.331.2.255.408.463.463.463.218 0 .078-.217-.363-.563-.21-.164-.317-.244-.33-.23zM1.184 3.44c-.117 0 .066.297.408.661.341.364.714.661.827.661.113 0-.07-.297-.407-.661-.337-.364-.71-.661-.828-.661zM6.09 4.528c-.6 0-1.2.013-1.654.039-.91.051-.165.094 1.654.094s2.563-.043 1.653-.094a31.07 31.07 0 0 0-1.653-.04z"}),s.createElement("path",{fill:"#2f99a1",d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.885.886.815 1.583-.269 2.666-.884.884-.989.917-2.91.917-1.153 0-1.994.112-1.994.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.845-.902-.819-2.572.054-3.444z"}),s.createElement("path",{fill:"#5b3b6a",d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.477.478.648.935.648 1.731 0 .797-.17 1.254-.649 1.732l-.65.65-6.692-.016-6.693-.017-.595-.635C.284 3.72.31 2.05 1.183 1.179z"}),s.createElement("path",{d:"M16.673 1.587c-.146 0-.265.542-.265 1.203 0 .924-.15 1.353-.649 1.852l-.65.65H1.833l-.65-.65C.827 4.285.534 3.81.534 3.584c0-.225-.119-.409-.264-.409-.533 0-.243.831.595 1.709l.86.9 6.69.019 6.689.018.917-.917c.777-.777.917-1.101.917-2.117 0-.66-.119-1.2-.264-1.2z"}),s.createElement("path",{fill:"#5b3b6a",d:"M3.773 1.723c-.1.007-.2.056-.304.175-.243.263-.34-.344-.645-.087-.219.159-.07.434-.108.658v1.597h.56c.051-.533-.12-1.11.123-1.61.36-.45 1.038.15.82.609.04.378-.212 1.192.456 1.001h.105c.056-.535-.13-1.11.133-1.612.335-.39.855.064.83.478.034.347-.282.99.169 1.135.545.15.278-.472.348-.78-.008-.428.044-.943-.287-1.27-.348-.327-.983-.361-1.302.025-.313.015-.599-.34-.898-.319zm4.12.001c-.599.022-1.183.496-1.174 1.125-.051.62.434 1.27 1.082 1.27.367.008.959.003 1.073-.427-.266-.54-.722.142-1.15-.112-.45-.06-.384-.634.083-.451.419.035.842-.01 1.263.007.127-.605-.26-1.348-.923-1.392a1.13 1.13 0 0 0-.255-.02zm1.927.028c-.04-.012-.09-.002-.154.047-.34.104-.115.567-.174.837v1.431h.555c.06-.543-.157-1.163.19-1.642.384-.399 1.11.097.933.6.106.316-.215.898.167 1.042h.393c-.056-.651.16-1.385-.237-1.963-.328-.396-1.002-.468-1.362-.076-.147.001-.19-.238-.311-.276zm2.315.054c.05.645-.141 1.359.213 1.944.299.387.96.513 1.314.132.25-.084.356.443.641.157.17-.234.03-.55.07-.826V1.806h-.555c-.06.543.156 1.163-.19 1.642-.385.398-1.11-.097-.933-.601-.106-.318.256-1.05-.27-1.041h-.29zm-4.228.424c.268-.015.542.11.618.389-.382.126-.79.025-1.183.054h-.028c.06-.275.324-.429.593-.443z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})),s.createElement("rect",{className:"controller-button-overlay",width:"100%",height:"100%",fill:"black",fillOpacity:"0",rx:"10",ry:"10"}));return s.createElement("div",{className:"simulator-display",id:"wrap",style:{transform:"scale("+n+")",transformOrigin:"0 0",width:this.scalePixel(368),height:this.scalePixel(432.938)}},s.createElement("div",{className:"debug-stats",id:"debug-stats"}),s.createElement("div",{className:"screen-back",id:"screen-back"}),s.createElement("div",{id:"screen"},s.createElement("div",{id:"paint-surface-container",style:{top:this.scalePixel(12),left:this.scalePixel(12)}},s.createElement("canvas",{id:"paint-surface",width:"160",height:"120",className:"borders",style:{transform:"scale("+n+")",transformOrigin:"0 0",height:229,width:312,left:this.scalePixel(28),top:this.scalePixel(20),clipPath:"polygon(0px 5.33333px, 5.33333px 0px, 338.667px/1.2) 0px, 344px 5.33333px, 344px 256.667px, 338.667px 262px, 5.33333px 262px, 0px 256.667px)"}})),s.createElement("div",{id:"controls",className:"no-focus"},r,i,o,a),t),s.createElement("div",{id:"instructions"}))},t}(e("./data").Component);n.SimulatorDisplay=o},{"./data":44,react:284}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=pxt.Cloud,o=pxt.Util,a={};function s(e){var t=o.lookup(a,e.result.socket);t?t.onOOB(e):console.error("Dropping data for "+e.result.socket)}n.tryInit=function(){pxt.BrowserUtils.isLocalHost()&&i.localToken&&(pxt.mkTCPSocket=function(e,t){return new l(e,t)})};var l=function(){function e(e,t){this.host=e,this.port=t,this.onData=function(e){},this.onError=function(e){}}return e.prototype.onOOB=function(e){if("data"==e.op){var t=o.stringToUint8Array(atob(e.result.data));this.onData(t)}else"close"==e.op&&(this.sockId=null,delete a[e.result.socket])},e.prototype.error=function(e){var t=new Error(o.lf("TCP error on socket {0}:{1} ({2})",this.host,this.port,e));throw this.onError(t),t},e.prototype.disconnectAsync=function(){var e=this;return this.sockId?r.opAsync("close",{socket:this.sockId}).then(function(){e.sockId=null}):Promise.resolve()},e.prototype.sendPacketAsync=function(e){return this.sockId||o.userError("Not connected"),r.opAsync("send",{socket:this.sockId,data:o.toHex(e),encoding:"hex"})},e.prototype.sendSerialAsync=function(e,t){return Promise.reject(new Error("No serial on socket"))},e.prototype.connectAsync=function(){var t=this;return r||(pxt.BrowserUtils.isLocalHost()&&i.localToken||o.userError(lf("TCP sockets not available here")),pxt.debug("initializing tcp pipe"),r=pxt.worker.makeWebSocket("ws://localhost:"+pxt.options.wsPort+"/"+i.localToken+"/tcp",s)),this.sockId?Promise.resolve():r.opAsync("open",{host:this.host,port:this.port}).then(function(e){e.socket||t.error(e.errorMessage),t.sockId=e.socket,a[t.sockId]=t})},e}()},{}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./audio"),o={},r=.2;function a(e){var t=(pxt.appTarget.appTheme.sounds||{})[e];if(pxt.options.light||!t)return Promise.resolve(void 0);var n=o[t];if(n)return Promise.resolve(n);var r=pxt.webConfig.commitCdnUrl+"sounds/"+t;return pxt.Util.requestAsync({url:r,headers:{Accept:"audio/"+t.slice(-3)},responseArrayBuffer:!0}).then(function(e){return i.loadAsync(e.buffer)}).then(function(e){return o[t]=e})}function s(e){pxt.options.light||a(e).done(function(e){return e?i.play(e,r):void 0})}n.tutorialStep=function(){s("tutorialStep")},n.tutorialNext=function(){s("tutorialNext")},n.click=function(){s("click")},n.initTutorial=function(){pxt.options.light||Promise.all([a("tutorialStep"),a("tutorialNext"),a("click")]).done()}},{"./audio":4}],99:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("react"),i=function(){function e(e){this.parent=e,this.isVisible=!1,this.changeCallback=function(){},this.isReady=!1}return e.prototype.setVisible=function(e){this.isVisible=e},e.prototype.acceptsFile=function(e){return!1},e.prototype.getViewState=function(){return{}},e.prototype.getCurrentSource=function(){return this.currSource},e.prototype.getStyle=function(e){var t={display:this.isVisible?"block":"none"};return Object.assign(t,e)},e.prototype.getId=function(){return"editor"},e.prototype.displayOuter=function(e){return r.createElement("div",{className:"full-abs",key:this.getId(),id:this.getId(),style:this.getStyle(e)},this.display())},e.prototype.display=function(){return null},e.prototype.beforeCompile=function(){},e.prototype.prepare=function(){this.isReady=!0},e.prototype.resize=function(e){},e.prototype.snapshotState=function(){return null},e.prototype.unloadFileAsync=function(){return Promise.resolve()},e.prototype.isIncomplete=function(){return!1},e.prototype.hasHistory=function(){return!0},e.prototype.hasUndo=function(){return!0},e.prototype.hasRedo=function(){return!0},e.prototype.undo=function(){},e.prototype.redo=function(){},e.prototype.zoomIn=function(){},e.prototype.zoomOut=function(){},e.prototype.setScale=function(e){},e.prototype.closeFlyout=function(){},e.prototype.loadFileAsync=function(e,t){return this.currSource=e.content,this.setDiagnostics(e,this.snapshotState()),Promise.resolve()},e.prototype.domUpdate=function(){},e.prototype.setDiagnostics=function(e,t){},e.prototype.setViewState=function(e){},e.prototype.saveToTypeScriptAsync=function(){return Promise.resolve(void 0)},e.prototype.highlightStatement=function(e,t){return!1},e.prototype.clearHighlightedStatements=function(){},e.prototype.setHighContrast=function(e){},e.prototype.hasEditorToolbar=function(){return!0},e.prototype.filterToolbox=function(e){},e.prototype.insertBreakpoint=function(){},e.prototype.updateBreakpoints=function(){},e.prototype.getBreakpoints=function(){return[]},e.prototype.updateToolbox=function(){},e}();n.Editor=i},{react:284}],100:[function(e,t,I){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),D=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},L=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n};Object.defineProperty(I,"__esModule",{value:!0});var R=e("react"),o=e("react-dom"),j=e("react-modal"),a=e("react-tooltip"),n=e("./data"),B=e("./core");function M(e){return e.filter(function(e){return!!e&&""!=e.trim()}).join(" ")}function s(e,t,n){return void 0===n&&(n=!1),e+" "+(n?"":t.icon&&t.text?"icon icon-and-text":t.icon?"icon":"")+" "+(t.className||"")}function m(e){var t=[e.icon?R.createElement(I.Icon,{key:"iconkey",icon:e.icon+(e.text?" icon-and-text ":"")+(e.iconClass?" "+e.iconClass:"")}):null,e.text?R.createElement("span",{key:"textkey",className:"ui text"+(e.textClass?" "+e.textClass:"")},e.text):null];return e.icon&&e.rightIcon&&(t=t.reverse()),t}function F(e){var t=B.keyCodeFromEvent(e);t!==B.ENTER_KEY&&t!==B.SPACE_KEY||(e.preventDefault(),e.currentTarget.click())}I.appElement=document.getElementById("content"),I.cx=M,I.fireClickOnEnter=F;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(n.Component);I.UIElement=l;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(n.PureComponent);I.StatelessUIElement=c;var u=function(e){function t(){var a=null!==e&&e.apply(this,arguments)||this;return a.navigateToNextElement=function(e,t,n){var r=a.refs.dropdown,i=B.keyCodeFromEvent(e),o=e.currentTarget;40===i?(e.preventDefault(),e.stopPropagation(),n&&a.focus(n)):38===i?(e.preventDefault(),e.stopPropagation(),t?a.focus(t):(r.focus(),a.setState({open:!1}))):i!==B.SPACE_KEY&&i!==B.ENTER_KEY||(e.preventDefault(),e.stopPropagation(),o.click())},a.closeOnEscape=function(e){B.keyCodeFromEvent(e)===B.ESC_KEY&&(e.preventDefault(),a.refs.dropdown.focus(),a.isMouseDown=!0,a.hide())},a.handleClick=function(e){a.toggle(),e.stopPropagation()},a.handleClose=function(){a.isMouseDown=!1;var e=document.activeElement===a.refs.dropdown;a.setState({focus:e})},a.handleMouseDown=function(e){a.isMouseDown=!0,document.addEventListener(pxsim.pointerEvents.up,a.handleDocumentMouseUp)},a.handleDocumentMouseUp=function(e){a.isMouseDown=!1,document.removeEventListener(pxsim.pointerEvents.up,a.handleDocumentMouseUp)},a.handleFocus=function(e){a.state.focus||a.setState({focus:!0})},a.handleBlur=function(e){a.isMouseDown||setTimeout(function(){var e=a.isChildFocused();a.setState({focus:e})},1)},a.handleKeyDown=function(e){var t=B.keyCodeFromEvent(e);40===t?(e.preventDefault(),a.focusFirst=!0,a.show()):t!==B.SPACE_KEY&&t!==B.ENTER_KEY||(e.preventDefault(),a.toggle())},a}return i(t,e),t.prototype.show=function(){this.setState({open:!0,focus:!0})},t.prototype.hide=function(){this.setState({open:!1})},t.prototype.toggle=function(){this.state.open?this.hide():this.show()},t.prototype.focus=function(e){this.setActive(e),e.focus()},t.prototype.blur=function(e){this.isActive(e)&&pxt.BrowserUtils.removeClass(e,"active")},t.prototype.setActive=function(e){this.isActive(e)||pxt.BrowserUtils.addClass(e,"active")},t.prototype.isActive=function(e){return e&&pxt.BrowserUtils.containsClass(e,"active")},t.prototype.getChildren=function(){for(var e=this.refs.menu,t=[],n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];pxt.BrowserUtils.containsClass(r,"divider")||pxt.BrowserUtils.containsClass(r,"mobile")&&!pxt.BrowserUtils.isMobile()||t.push(r)}return t},t.prototype.isChildFocused=function(){for(var e=this.getChildren(),t=0;t<e.length;t++)if(document.activeElement===e[t])return!0;return!1},t.prototype.componentDidMount=function(){for(var i=this,o=this.getChildren(),e=function(e){var t=0<e?o[e-1]:void 0,n=o[e],r=e<o.length?o[e+1]:void 0;n.addEventListener("keydown",function(e){i.navigateToNextElement(e,t,r)}),n.addEventListener("focus",function(e){i.setActive(n)}),n.addEventListener("blur",function(e){i.blur(n)}),e==o.length-1&&n.addEventListener("keydown",function(e){var t=B.keyCodeFromEvent(e);e.shiftKey||t!==B.TAB_KEY||i.hide()})},t=0;t<o.length;t++)e(t)},t.prototype.componentDidUpdate=function(e,t){for(var n=this.getChildren(),r=0;r<n.length;r++)n[r].tabIndex=this.state.open?0:-1;if(t.open!=this.state.open&&this.state.open){var i=this.refs.dropdown,o=this.refs.menu;i.offsetLeft+o.offsetWidth>window.innerWidth&&pxt.BrowserUtils.addClass(o,"left")}!t.focus&&this.state.focus||t.focus&&!this.state.focus&&(this.isMouseDown||this.hide()),!t.open&&this.state.open?document.addEventListener("keydown",this.closeOnEscape):t.open&&!this.state.open&&(document.removeEventListener("keydown",this.closeOnEscape),this.handleClose()),this.focusFirst&&0<n.length&&(this.focus(n[0]),this.focusFirst=!1)},t.prototype.renderCore=function(){var e=this.props,t=e.disabled,n=e.title,r=e.role,i=e.icon,o=e.className,a=e.avatarImage,s=e.avatarInitials,l=e.children,c=this.state.open,u={role:r||"combobox","aria-disabled":t,"aria-haspopup":!!t,"aria-expanded":c},p={role:"menu","aria-label":lf("Dropdown menu {0}",n),"aria-hidden":!!c},d=M(["ui",c?"active visible":"","dropdown",i?"icon":"",o||""]),f=M(["menu",c?"visible transition":""]),h=a||s?R.createElement("div",{className:"avatar"},a?R.createElement("img",{className:"ui circular image",src:a,alt:n}):R.createElement("div",{className:"initials"},s)):void 0;return R.createElement("div",D({role:"listbox",ref:"dropdown",title:n},u,{id:this.props.id,className:d,onMouseDown:this.handleMouseDown,onClick:this.handleClick,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus,onBlur:this.handleBlur,tabIndex:0}),h||m(this.props),R.createElement("div",D({ref:"menu"},p,{className:f,role:"menu"}),l))},t}(l);I.DropdownMenu=u;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.renderCore=function(){var e=this.props,t=e.text,n=e.title,r=e.ariaLabel;return R.createElement("div",{className:s("ui item link",this.props,!0)+" "+(this.props.active?"active":""),role:this.props.role,"aria-label":r||n||t,title:n||t,tabIndex:this.props.tabIndex||0,key:this.props.value,"data-value":this.props.value,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||F},m(this.props),this.props.children)},t}(n.Component);I.Item=p;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.renderCore=function(){return R.createElement("div",{className:s("ui item link",this.props,!0)+" "+(this.props.active?"active":""),role:this.props.role,title:this.props.title||this.props.text,tabIndex:this.props.tabIndex||0,key:this.props.value,"data-value":this.props.value,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||F},R.createElement("div",{className:s("ui button",this.props)},m(this.props),this.props.children))},t}(l);I.ButtonMenuItem=d;var U=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.renderCore=function(){var e=this.props,t=(e.labelPosition,e.color),n=e.size,r=e.disabled,i=e.loading,o=M([t,n,r||i?"disabled":"",i?"loading":"",s("ui button",this.props)]),a=R.createElement("button",{className:o,id:this.props.id,role:this.props.role,title:this.props.title,tabIndex:this.props.tabIndex||0,"aria-label":this.props.ariaLabel,"aria-expanded":this.props.ariaExpanded,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown,autoFocus:this.props.autoFocus},m(this.props),this.props.children);return this.props.tooltipId&&!pxt.BrowserUtils.isIOS()?R.createElement(k,{id:this.props.tooltipId,content:this.props.tooltip||this.props.title,place:this.props.tooltipPlace,delayShow:this.props.tooltipDelayShow},a):a},t}(c);I.Button=U;var q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.renderCore=function(){var e=this.props.onClick;return R.createElement("div",{role:"button",className:"closeIcon",tabIndex:0,onClick:e,onKeyDown:F,"aria-label":lf("Close")},R.createElement(I.Icon,{icon:"close remove circle"}))},t}(c);I.CloseButton=q;var H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.renderCore=function(){return R.createElement("a",{className:s("ui",this.props)+" "+(this.props.disabled?"disabled":""),id:this.props.id,href:this.props.href,target:this.props.target,rel:this.props.rel||(this.props.target?"noopener noreferrer":""),download:this.props.download,ref:this.props.refCallback,role:this.props.role,title:this.props.title,tabIndex:this.props.tabIndex||0,"aria-label":this.props.ariaLabel,"aria-expanded":this.props.ariaExpanded,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||F},m(this.props),this.props.children)},t}(c);I.Link=H,I.helpIconLink=function(e,t){return R.createElement(H,{className:"help-link",href:e,icon:"help circle",target:"_blank",role:"button",title:t})};var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.renderCore=function(){return R.createElement("div",{className:"field"},this.props.label?R.createElement("label",{htmlFor:this.props.ariaLabel?void 0:this.props.htmlFor},this.props.label):null,this.props.ariaLabel&&this.props.htmlFor?R.createElement("label",{htmlFor:this.props.htmlFor,className:"accessible-hidden"},this.props.ariaLabel):"",this.props.children)},t}(n.Component);I.Field=f;var h=function(n){function e(e){var t=n.call(this,e)||this;return t.state={value:e.value},t.copy=t.copy.bind(t),t.handleClick=t.handleClick.bind(t),t.handleChange=t.handleChange.bind(t),t}return i(e,n),e.prototype.componentDidMount=function(){var e=this.props,t=e.selectOnMount,n=e.autoFocus;t&&n&&this.refs.inputField.select()},e.prototype.componentWillReceiveProps=function(e){this.setState({value:e.value})},e.prototype.clearValue=function(){this.setState({value:void 0})},e.prototype.copy=function(){var e,t=this.props,n=o.findDOMNode(this);t.lines&&1!=t.lines?(e=n.getElementsByTagName("textarea")[0]).focus():(e=n.getElementsByTagName("input")[0]).focus(),e.setSelectionRange(0,9999);try{var r=document.execCommand("copy");pxt.debug("copy: "+r)}catch(e){}},e.prototype.handleClick=function(e){this.props.selectOnClick&&e.target.setSelectionRange(0,9999)},e.prototype.handleChange=function(e){var t=e.target.value;this.props.readOnly||this.state&&this.state.value===t||this.setState({value:t}),this.props.onChange&&this.props.onChange(t)},e.prototype.renderCore=function(){var e=this.props,t=e.copy&&document.queryCommandSupported("copy")?R.createElement(U,{className:"ui right labeled primary icon button",text:lf("Copy"),icon:"copy",onClick:this.copy}):null,n=this.props.error,r=this.state.value;return R.createElement(f,{ariaLabel:e.ariaLabel,htmlFor:e.id,label:e.label},R.createElement("div",{className:"ui input"+(e.inputLabel?" labelled":"")+(e.copy?" action fluid":"")+(e.disabled?" disabled":"")},e.inputLabel?R.createElement("div",{className:"ui label"},e.inputLabel):"",e.lines&&1!=e.lines?R.createElement("textarea",{id:e.id,className:"ui input "+(e.class||"")+(e.inputLabel?" labelled":""),rows:e.lines,placeholder:e.placeholder,value:r||"",readOnly:!!e.readOnly,onClick:this.handleClick,onChange:this.handleChange}):R.createElement("input",{ref:"inputField",autoFocus:e.autoFocus,id:e.id,className:e.class||"",type:e.type||"text",placeholder:e.placeholder,value:r||"",readOnly:!!e.readOnly,onClick:this.handleClick,onChange:this.handleChange,autoComplete:e.autoComplete?"":"off",autoCorrect:e.autoComplete?"":"off",autoCapitalize:e.autoComplete?"":"off",spellCheck:e.autoComplete}),t),n?R.createElement("div",{className:"ui yellow message"},n):void 0)},e}(n.Component);I.Input=h;var g=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.handleChange=t.handleChange.bind(t),t}return i(e,n),e.prototype.handleChange=function(e){this.props.onChange(e.currentTarget.checked)},e.prototype.renderCore=function(){var e=this.props;return R.createElement(f,{label:e.label},R.createElement("div",{className:"ui toggle checkbox"},R.createElement("input",{type:"checkbox",checked:e.checked,"aria-checked":e.checked,"aria-label":e.label||e.inputLabel,onChange:this.handleChange}),e.inputLabel?R.createElement("label",null,e.inputLabel):void 0))},e}(n.Component);I.Checkbox=g,I.Icon=function(e){var t=e.icon,n=e.className,r=e.onClick,i=e.onKeyDown,o=e.children,a=L(e,["icon","className","onClick","onKeyDown","children"]);return R.createElement("i",D({className:"icon "+t+" "+(n||""),onClick:r,onKeyDown:i||F,"aria-hidden":!0,role:"presentation"},a),o)};var v=function(t){function e(e){var n=t.call(this,e)||this;return n.handleClick=function(e){var t=n.props.onClick;t&&t(e,n.props)},n}return i(e,t),e.prototype.renderCore=function(){var e=this.props,t=e.active,n=e.children,r=e.className,i=e.color,o=e.content,a=e.fitted,s=e.header,l=e.icon,c=e.link,u=e.name,p=e.onClick,d=e.position,f=e.ariaControls,h=e.id,m=e.tabIndex,g=M([i,d,t?"active":"",!0===l||l&&!u&&!o?"icon":"",s?"header":"",c||p?"link":"",a?1==a?""+a:"fitted "+a:"","item",r]);return n?R.createElement("div",{role:"menuitem",className:g,onClick:this.handleClick},n):R.createElement("div",{id:h,tabIndex:null!=m?m:-1,className:g,onClick:this.handleClick,onKeyDown:F,role:"tab","aria-controls":f,"aria-selected":t,"aria-label":""+(o||u)},l?R.createElement(I.Icon,{icon:l}):void 0,o||u)},e}(n.Component);I.MenuItem=v;var y=function(t){function e(e){var l=t.call(this,e)||this;return l.handleKeyboardNavigation=function(e){var t=B.keyCodeFromEvent(e),n=37===t||38===t,r=39===t||40===t;if(n||r){for(var i,o=l.child(".item"),a=-1,s=0;-1===a&&s<o.length;)pxt.BrowserUtils.containsClass(o[s],"active")&&(a=s),s++;-1!==a&&(n&&!pxt.Util.isUserLanguageRtl()||r&&pxt.Util.isUserLanguageRtl()?i=0===a?o[o.length-1]:o[a-1]:(r&&!pxt.Util.isUserLanguageRtl()||n&&pxt.Util.isUserLanguageRtl())&&(i=a===o.length-1?o[0]:o[a+1]),void 0!==i&&(i.click(),i.focus()))}},l}return i(e,t),e.prototype.componentDidMount=function(){var n=this;this.child(".item").forEach(function(e,t){e.onkeydown=n.handleKeyboardNavigation})},e.prototype.renderCore=function(){var e=this.props,t=e.attached,n=e.borderless,r=e.children,i=e.className,o=e.color,a=e.compact,s=e.fixed,l=e.floated,c=e.fluid,u=e.icon,p=e.inverted,d=e.pagination,f=e.pointing,h=e.secondary,m=e.size,g=e.stackable,v=e.tabular,y=M(["ui",o,m,n?"borderless":"",a?"compact":"",c?"fluid":"",p?"inverted":"",d?"pagination":"",f?"pointing":"",h?"secondary":"",g?"stackable":"",e.text?"text":"",e.vertical?"vertical":"",t?1==t?"attached":t+" attached ":"",l?1==l?"floated":l+" floated":"",u?1==u?"icon":u+" icon":"",v?1==v?"tabular":v+" tabular":"",s?"tabular "+v:"",i,"menu"]);return R.createElement("div",{className:y,role:"tablist"},r)},e}(n.Component);I.Menu=y;var b=function(t){function e(e){var s=t.call(this,e)||this;return s.setPositionAndClassNames=function(){var e,t=s.props.dimmer;t&&(e="dimmable dimmed","blurring"===t&&(e+=" blurring"));var n={},r=s.getRef();if(r){var i=r.getBoundingClientRect().height,o=-Math.round(i/2),a=i>=window.innerHeight;s.state.marginTop!==o&&(n.marginTop=o),s.state.scrolling!==a&&(n.scrolling=a),a&&(e+=" scrolling")}s.state.mountClasses!==e&&(n.mountClasses=e),0<Object.keys(n).length&&(s.setState(n),s.props.onPositionChanged&&s.props.onPositionChanged(s.props)),s.animationRequestId=requestAnimationFrame(s.setPositionAndClassNames)},s.id=ts.pxtc.Util.guidGen(),s.state={},s.onRequestClose=s.onRequestClose.bind(s),s.afterOpen=s.afterOpen.bind(s),s}return i(e,t),e.prototype.afterOpen=function(){var e=this.props.modalDidOpen;this.setState({scrolling:!1}),this.setPositionAndClassNames(),e&&e(this.getRef())},e.prototype.onClose=function(){cancelAnimationFrame(this.animationRequestId)},e.prototype.getRef=function(){var e=this.refs.modal;return e&&e.node&&e.node.firstChild&&e.node.firstChild.firstChild},e.prototype.componentWillUnmount=function(){cancelAnimationFrame(this.animationRequestId)},e.prototype.onRequestClose=function(){var e=this.props.onClose;this.onClose(),e()},e.prototype.render=function(){var e=this.props,t=e.isOpen,n=e.size,r=e.longer,i=e.basic,o=e.className,a=e.onClose,s=e.closeIcon,l=e.children,c=(e.onKeyDown,e.header),u=e.headerClass,p=e.headerActions,d=e.helpUrl,f=e.description,h=e.closeOnDimmerClick,m=e.closeOnDocumentClick,g=e.closeOnEscape,v=e.shouldCloseOnEsc,y=e.shouldCloseOnOverlayClick,b=e.shouldFocusAfterRender,_=e.overlayClassName,w=L(e,["isOpen","size","longer","basic","className","onClose","closeIcon","children","onKeyDown","header","headerClass","headerActions","helpUrl","description","closeOnDimmerClick","closeOnDocumentClick","closeOnEscape","shouldCloseOnEsc","shouldCloseOnOverlayClick","shouldFocusAfterRender","overlayClassName"]),k=this.state,x=k.marginTop,E=k.scrolling,C=k.mountClasses,S="fullscreen"==n,T=S&&!!s,A=M(["ui",n,r?"longer":"",i?"basic":"",E?"scrolling":"",s?"closable":"","modal transition visible active",o]),N=M([B.highContrast?"hc":"",C]),O={labelledby:c?this.id+"title":void 0,describedby:!S&&f?this.id+"description":this.id+"desc",modal:"true"},P={content:{marginTop:x}};return R.createElement(j,D({isOpen:t,ref:"modal",appElement:I.appElement,onRequestClose:this.onRequestClose,onAfterOpen:this.afterOpen,shouldReturnFocusAfterClose:!0,shouldFocusAfterRender:b,shouldCloseOnEsc:v||g,shouldCloseOnOverlayClick:y||m||h,portalClassName:N,overlayClassName:"ui page modals dimmer transition "+_+" "+(t?"visible active":""),className:A,style:P,aria:O},w),c||T||d?R.createElement("div",{id:this.id+"title",className:"header "+(u||"")},R.createElement("span",{className:"header-title",style:{margin:"0 "+(d?"-20rem":"0")+" 0 "+(T?"-20rem":"0")}},c),T?R.createElement("div",{className:"header-close"},R.createElement(U,{className:"back-button large",title:lf("Go back"),onClick:a,tabIndex:0,onKeyDown:F},R.createElement(I.Icon,{icon:"arrow left"}),R.createElement("span",{className:"ui text landscape only"},lf("Go back")))):void 0,d?R.createElement("div",{className:"header-help"},R.createElement("a",{className:"ui icon help-button",href:d,target:"_docs",role:"button","aria-label":lf("Help on {0} dialog",c)},R.createElement(I.Icon,{icon:"help"}))):void 0):void 0,S&&p?R.createElement("div",{className:"header-actions"},p):void 0,!S&&f?R.createElement("label",{id:this.id+"description",className:"accessible-hidden"},f):void 0,R.createElement("div",{id:this.id+"desc",className:(r?"scrolling":"")+" "+(p?"has-actions":"")+" content"},l),!S&&this.props.buttons&&0<this.props.buttons.length?R.createElement("div",{className:"actions"},this.props.buttons.map(function(e){return e.url?R.createElement(H,{key:"action_"+e.label,icon:e.icon,text:e.label,className:"ui button approve "+(e.icon?"icon right labeled":"")+" "+(e.className||"")+" "+(e.loading?"loading disabled":"")+" "+(e.disabled?"disabled":""),href:e.url,target:e.fileName?void 0:"_blank",download:e.fileName?pxt.Util.htmlEscape(e.fileName):void 0}):R.createElement(z,D({key:"action_"+e.label},e,{labelPosition:e.labelPosition}))})):void 0,!S&&s&&R.createElement(q,{onClick:a}))},e}(R.Component);I.Modal=b;var z=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t.handleClick=t.handleClick.bind(t),t}return i(e,n),e.prototype.handleClick=function(){this.props.disabled||this.props.onclick()},e.prototype.renderCore=function(){var e=this.props;return R.createElement(U,{icon:e.icon,text:e.label,labelPosition:e.labelPosition,className:"approve "+(e.icon?"icon "+(e.labelPosition?e.labelPosition:"right")+" labeled":"")+" "+(e.className||"")+" "+(e.loading?"loading disabled":"")+" "+(e.disabled?"disabled":""),onClick:this.handleClick,onKeyDown:F})},e}(n.PureComponent),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.disabled,n=e.inverted,r=e.page,i=e.simple,o=e.closable,a=e.onClose,s=e.active,l=e.children,c=L(e,["disabled","inverted","page","simple","closable","onClose","active","children"]),u=M(["ui dimmer",s?"active transition visible":"",t?"disabled":"",n?"inverted":"",r?"page":"",i?"simple":""]);return R.createElement(j,D({appElement:I.appElement,style:{content:{background:"none",border:"0"}},shouldCloseOnOverlayClick:o,onRequestClose:a,overlayClassName:u},c),l)},t}(l);I.Dimmer=_;var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.active,n=e.children,r=e.disabled,i=e.inverted,o=M(["ui loader",e.size,t?"active":"",r?"disabled":"",i?"inverted":"",n?"text":"",e.className]);return R.createElement("div",{className:o},n)},t}(l);I.Loader=w;var k=function(n){function e(e){var t=n.call(this,e)||this;return t.state={},t}return i(e,n),e.prototype.render=function(){var e=this.props,t=e.id,n=e.content,r=e.className,i=L(e,["id","content","className"]);return R.createElement("div",null,R.createElement("div",{"data-tip":"tooltip","data-for":t},this.props.children),R.createElement(a,D({id:t,className:"pxt-tooltip "+(r||""),effect:"solid"},i),n))},e}(R.Component);I.Tooltip=k;var x=function(n){function e(e){var t=n.call(this,e)||this;return t.radius=100/(2*Math.PI),t.view=2*t.radius+t.props.stroke,t}return i(e,n),e.prototype.getPathStyle=function(){return{strokeWidth:this.props.stroke}},e.prototype.render=function(){var e=this.props,t=this.radius;return R.createElement("div",{className:"progresscircle"},R.createElement("svg",{viewBox:"0 0 "+this.view+" "+this.view,"aria-labelledby":"circletitle",role:"img"},R.createElement("title",{id:"circletitle"},"Currently on step ",e.progress," of ",e.steps),R.createElement("path",{style:this.getPathStyle(),strokeDasharray:Math.round(100*e.progress/e.steps)+", 100",d:"M"+this.view/2+" "+e.stroke/2+" a "+t+" "+t+" 0 0 1 0 "+2*t+" a "+t+" "+t+" 0 0 1 0 -"+2*t})))},e}(R.Component);I.ProgressCircle=x;var E=function(n){function e(e){var t=n.call(this,e)||this;return t.state={isChecked:!1},t.setCheckedBit=t.setCheckedBit.bind(t),t}return i(e,n),e.prototype.setCheckedBit=function(){var e=!this.state.isChecked;this.props.onChange(e),this.setState({isChecked:e})},e.prototype.renderCore=function(){return R.createElement(g,{inputLabel:this.props.label,checked:this.state.isChecked,onChange:this.setCheckedBit})},e}(n.Component);I.PlainCheckbox=E},{"./core":41,"./data":44,react:284,"react-dom":240,"react-modal":253,"react-tooltip":277}],101:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var a,S=e("react"),s=e("./data"),T=e("./sui"),l=e("./core"),_=pxt.Util;(a=n.CategoryNameID||(n.CategoryNameID={})).Loops="loops",a.Logic="logic",a.Variables="variables",a.Maths="Math",a.Functions="functions",a.Arrays="arrays",a.Text="text",a.Extensions="addpackage";var c=function(n){function e(e){var t=n.call(this,e)||this;return t.handleRootElementRef=function(e){t.rootElement=e},t.state={categories:[],visible:!1,loading:!1,showAdvanced:!1},t.setSelection=t.setSelection.bind(t),t.advancedClicked=t.advancedClicked.bind(t),t.recipesClicked=t.recipesClicked.bind(t),t.recoverToolbox=t.recoverToolbox.bind(t),t}return i(e,n),e.prototype.getElement=function(){return this.rootElement},e.prototype.hide=function(){this.setState({visible:!1})},e.prototype.showLoading=function(){this.setState({visible:!0,loading:!0})},e.prototype.show=function(){this.setState({visible:!0})},e.prototype.setSelectedItem=function(e){this.selectedItem=e},e.prototype.setPreviousItem=function(){if(0<this.selectedIndex){var e=--this.selectedIndex,t=this.items[e];this.setSelection(t,e)}else if(this.state.showSearchBox){var n=this.refs.searchbox;n&&n.focus()}},e.prototype.setNextItem=function(){if(this.items.length-1>this.selectedIndex){var e=++this.selectedIndex;this.setSelection(this.items[e],e)}},e.prototype.setSearch=function(){var e=this.refs.searchbox;e&&e.focus()},e.prototype.clear=function(){this.clearSelection(),this.selectedIndex=0,this.selectedTreeRow=void 0},e.prototype.clearSelection=function(){this.setState({selectedItem:void 0,expandedItem:void 0,focusSearch:!1})},e.prototype.clearSearch=function(){this.setState({hasSearch:!1,searchBlocks:void 0,focusSearch:!1})},e.prototype.setSelection=function(e,t,n){var r=this.props,i=r.editorname,o=r.parent,a=e.nameid,s=e.subns,l=e.customClick;pxt.tickEvent(i+".toolbox.click",void 0,{interactiveConsent:!0});var c=s?a+s:a;if(this.state.selectedItem!=c||n){var u=!1;if(l&&(u=l(o)))return;u||(this.setState({selectedItem:c,expandedItem:a,focusSearch:!1}),this.selectedIndex=t,(this.selectedTreeRow=e).advanced&&!this.state.showAdvanced&&this.showAdvanced(),l||this.showFlyout(e))}else this.clearSelection(),this.closeFlyout()},e.prototype.focus=function(){if(this.rootElement)if(this.selectedItem&&this.selectedItem.getTreeRow()){var e=this.selectedItem.props.treeRow,t=this.items.indexOf(e);this.setSelection(e,t,!0)}else this.selectFirstItem()},e.prototype.selectFirstItem=function(){this.items[0]&&this.setSelection(this.items[0],0,!0)},e.prototype.moveFocusToFlyout=function(){this.props.parent.moveFocusToFlyout()},e.prototype.componentDidUpdate=function(e,t){t.visible==this.state.visible&&t.loading==this.state.loading&&t.showAdvanced==this.state.showAdvanced&&this.state.expandedItem==t.expandedItem||this.props.parent.resize(),this.state.hasSearch&&this.state.searchBlocks!=t.searchBlocks?this.refreshSearchItem():t.hasSearch&&!this.state.hasSearch&&"search"==this.state.selectedItem&&this.closeFlyout()},e.prototype.componentDidCatch=function(e,t){var n=this.props.editorname;pxt.tickEvent(n+".toolbox.crashed",{error:e}),this.setState({hasError:!0})},e.prototype.recoverToolbox=function(){this.setState({hasError:!1})},e.prototype.advancedClicked=function(){var e=this.props.editorname;pxt.tickEvent(e+".advanced",void 0,{interactiveConsent:!0}),this.showAdvanced()},e.prototype.recipesClicked=function(){var e=this.props.editorname;pxt.tickEvent(e+".recipes"),this.props.parent.parent.showRecipesDialog()},e.prototype.showAdvanced=function(){this.props.parent,this.selectedItem&&this.selectedItem.props.treeRow&&this.selectedItem.props.treeRow.advanced&&(this.clear(),this.closeFlyout()),this.setState({showAdvanced:!this.state.showAdvanced})},e.prototype.getSearchBlocks=function(){return this.props.parent,this.state.searchBlocks.map(function(e){return{name:e.qName,attributes:{blockId:e.id},builtinBlock:e.builtinBlock,builtinField:e.field}})},e.prototype.refreshSelection=function(){var e=this.props.parent;this.state.selectedItem&&this.selectedTreeRow&&(this.selectedTreeRow.customClick?this.selectedTreeRow.customClick(e):this.showFlyout(this.selectedTreeRow))},e.prototype.refreshSearchItem=function(){var e=O.getSearchTreeRow();this.showFlyout(e)},e.prototype.showFlyout=function(e){this.props.parent.showFlyout(e)},e.prototype.closeFlyout=function(){this.props.parent.closeFlyout()},e.prototype.hasAdvancedCategories=function(){return this.state.categories.some(function(e){return e.advanced})},e.prototype.getNonAdvancedCategories=function(){return this.state.categories.filter(function(e){return!e.advanced})},e.prototype.getAdvancedCategories=function(){return this.state.categories.filter(function(e){return e.advanced})},e.prototype.getAllCategoriesList=function(t){var e=this.state,n=e.categories,r=e.hasSearch,i=e.expandedItem,o=[];return r&&o.push(O.getSearchTreeRow()),n.forEach(function(e){o.push(e),e.subcategories&&(!t||t&&e.nameid==i)&&e.subcategories.forEach(function(e){o.push(e)})}),o},e.prototype.shouldComponentUpdate=function(e,t){return this.state!=t},e.prototype.isRtl=function(){return"monaco"!=this.props.editorname&&_.isUserLanguageRtl()},e.prototype.renderCore=function(){var t=this,e=this.props,n=e.editorname,r=e.parent,i=this.state,o=i.showAdvanced,a=i.visible,s=i.loading,l=i.selectedItem,c=i.expandedItem,u=i.hasSearch,p=i.showSearchBox,d=i.hasError;if(!a)return S.createElement("div",{style:{display:"none"}});var f=pxt.appTarget.appTheme,h=r.parent.state.tutorialOptions,m=!!h&&!!h.tutorial,g=!!f.topBlocks&&!m;if(s||d)return S.createElement("div",null,S.createElement("div",{className:"blocklyTreeRoot"},S.createElement("div",{className:"blocklyTreeRow",style:{opacity:0}})),s?S.createElement("div",{className:"ui active dimmer"},S.createElement("div",{className:"ui loader indeterminate"})):void 0,d?S.createElement("div",{className:"ui"},lf("Toolbox crashed.."),S.createElement(T.Button,{icon:"refresh",onClick:this.recoverToolbox,text:lf("Reload"),className:"fluid"})):void 0);var v=this.hasAdvancedCategories(),y=this.getNonAdvancedCategories(),b=v?this.getAdvancedCategories():[];this.items=this.getAllCategoriesList();var _=!!f.recipes&&!m&&0<this.items.length,w=O.getSearchTreeRow(),k={nameid:"topblocks",name:lf("{id:category}Basic"),color:pxt.toolbox.getNamespaceColor("topblocks"),icon:pxt.toolbox.getNamespaceIcon("topblocks")},x=pxt.appTarget.appTheme,E=T.cx(["pxtToolbox",x.invertedToolbox?"invertedToolbox":"",x.coloredToolbox?"coloredToolbox":""]),C=0;return S.createElement("div",{ref:this.handleRootElementRef,className:E,id:n+"EditorToolbox"},S.createElement(P,{categories:this.items}),p?S.createElement(O,{ref:"searchbox",parent:r,toolbox:this,editorname:n}):void 0,S.createElement("div",{className:"blocklyTreeRoot"},S.createElement("div",{role:"tree"},u?S.createElement(A,{key:"search",toolbox:this,index:C++,selected:"search"==l,treeRow:w,onCategoryClick:this.setSelection}):void 0,g?S.createElement(A,{key:"topblocks",toolbox:this,selected:"topblocks"==l,treeRow:k,onCategoryClick:this.setSelection}):void 0,y.map(function(e){return S.createElement(A,{key:e.nameid,toolbox:t,index:C++,selected:l==e.nameid,childrenVisible:c==e.nameid,treeRow:e,onCategoryClick:t.setSelection},e.subcategories?e.subcategories.map(function(e){return S.createElement(A,{key:e.nameid+e.subns,index:C++,toolbox:t,selected:l==e.nameid+e.subns,treeRow:e,onCategoryClick:t.setSelection})}):void 0)}),v||_?S.createElement(N,{key:"advancedseparator"}):void 0,_?S.createElement(A,{toolbox:this,treeRow:{nameid:"",name:pxt.toolbox.recipesTitle(),color:pxt.toolbox.getNamespaceColor("recipes"),icon:pxt.toolbox.getNamespaceIcon("recipes")},onCategoryClick:this.recipesClicked}):void 0,v?S.createElement(A,{toolbox:this,treeRow:{nameid:"",name:pxt.toolbox.advancedTitle(),color:pxt.toolbox.getNamespaceColor("advanced"),icon:pxt.toolbox.getNamespaceIcon(o?"advancedexpanded":"advancedcollapsed")},onCategoryClick:this.advancedClicked}):void 0,o?b.map(function(e){return S.createElement(A,{key:e.nameid,toolbox:t,index:C++,selected:l==e.nameid,childrenVisible:c==e.nameid,treeRow:e,onCategoryClick:t.setSelection},e.subcategories?e.subcategories.map(function(e){return S.createElement(A,{key:e.nameid,toolbox:t,index:C++,selected:l==e.nameid+e.subns,treeRow:e,onCategoryClick:t.setSelection})}):void 0)}):void 0)))},e}(s.Component);n.Toolbox=c;var A=function(n){function e(e){var t=n.call(this,e)||this;return t.handleTreeRowRef=function(e){t.treeRowElement=e},t.state={selected:e.selected},t.handleClick=t.handleClick.bind(t),t.handleKeyDown=t.handleKeyDown.bind(t),t}return i(e,n),e.prototype.getTreeRow=function(){return this.treeRowElement},e.prototype.componentWillReceiveProps=function(e){var t={};null!=e.selected&&(t.selected=e.selected),0<Object.keys(t).length&&this.setState(t)},e.prototype.componentDidUpdate=function(e,t){var n=this.props.toolbox;this.state.selected&&(this.props.toolbox.setSelectedItem(this),n.state.focusSearch||this.focusElement())},e.prototype.focusElement=function(){this.treeRowElement.focus()},e.prototype.handleClick=function(e){var t=this.props,n=t.treeRow,r=t.onCategoryClick,i=t.index;r&&r(n,i),e.preventDefault(),e.stopPropagation()},e.prototype.handleKeyDown=function(e){var t=this.props,n=t.toolbox,r=(t.childrenVisible,_.isUserLanguageRtl()),i=l.keyCodeFromEvent(e);40==i?this.nextItem():38==i?this.previousItem():39==i&&!r||37==i&&r?n.moveFocusToFlyout():27==i?n.closeFlyout():i==l.ENTER_KEY||i==l.SPACE_KEY?T.fireClickOnEnter.call(this,e):i==l.TAB_KEY||37==i||39==i||17==i||16==i||91==i||n.setSearch()},e.prototype.previousItem=function(){var e=this.props,t=e.toolbox,n=(e.childrenVisible,t.props.editorname);pxt.tickEvent(n+'.toolbox.keyboard.prev"',void 0,{interactiveConsent:!0}),t.setPreviousItem()},e.prototype.nextItem=function(){var e=this.props,t=e.toolbox,n=(e.childrenVisible,t.props.editorname);pxt.tickEvent(n+'.toolbox.keyboard.next"',void 0,{interactiveConsent:!0}),t.setNextItem()},e.prototype.renderCore=function(){var e=this.props,t=e.toolbox,n=e.childrenVisible,r=this.state.selected;return S.createElement(p,null,S.createElement(u,o({ref:this.handleTreeRowRef,isRtl:t.isRtl()},this.props,{selected:r,onClick:this.handleClick,onKeyDown:this.handleKeyDown})),S.createElement(d,{visible:n},this.props.children))},e}(s.Component);n.CategoryItem=A;var u=function(n){function e(e){var t=n.call(this,e)||this;return t.handleTreeRowRef=function(e){t.treeRow=e},t.state={},t.onmouseenter=t.onmouseenter.bind(t),t.onmouseleave=t.onmouseleave.bind(t),t}return i(e,n),e.prototype.focus=function(){this.treeRow&&this.treeRow.focus()},e.prototype.getProperties=function(){return this.props.treeRow},e.prototype.onmouseenter=function(){var e=pxt.appTarget.appTheme,t=this.getMetaColor(),n=e.blocklyOptions&&e.blocklyOptions.toolboxOptions&&e.blocklyOptions.toolboxOptions.invertedMultiplier||.3;e.invertedToolbox&&(this.treeRow.style.backgroundColor=pxt.toolbox.fadeColor(t||"#ddd",n,!1))},e.prototype.onmouseleave=function(){var e=pxt.appTarget.appTheme,t=this.getMetaColor();e.invertedToolbox&&(this.treeRow.style.backgroundColor=t||"#ddd")},e.prototype.getMetaColor=function(){var e=this.props.treeRow.color;return pxt.toolbox.convertColor(e)||pxt.toolbox.getNamespaceColor("default")},e.prototype.renderCore=function(){var e=this.props,t=e.selected,n=e.onClick,r=e.onKeyDown,i=e.isRtl,o=this.props.treeRow,a=o.nameid,s=o.subns,l=o.name,c=o.icon,u=pxt.appTarget.appTheme,p=this.getMetaColor(),d=u.blocklyOptions&&u.blocklyOptions.toolboxOptions&&u.blocklyOptions.toolboxOptions.invertedMultiplier||.3,f={paddingLeft:"0px"},h="blocklyTreeRow";if(u.invertedToolbox)f.backgroundColor=p||"#ddd",f.color="#fff";else{u.coloredToolbox&&(f.color=""+p);var m="8px solid "+p;i?f.borderRight=m:f.borderLeft=m}t&&(h+=" blocklyTreeSelected",u.invertedToolbox?f.backgroundColor=""+pxt.toolbox.fadeColor(p,d,!1):f.backgroundColor=p||"#ddd",f.color="#fff");var g,v=("blocklyTreeIcon"+(s?"more":c?(a||c).toLowerCase():"Default")).replace(/\s/g,""),y=s?pxt.toolbox.getNamespaceIcon("more"):c||pxt.toolbox.getNamespaceIcon("default");1<y.length&&(g=S.createElement("style",null,".blocklyTreeIcon."+v+' {\n                    background-image: url("'+_.pathJoin(pxt.webConfig.commitCdnUrl,encodeURI(c))+'")!important;\n                    width: 30px;\n                    height: 100%;\n                    background-size: 20px !important;\n                    background-repeat: no-repeat !important;\n                    background-position: 50% 50% !important;\n                }'),y=void 0);var b=l||_.capitalize(s||a);return S.createElement("div",{role:"button",ref:this.handleTreeRowRef,className:h,style:f,tabIndex:0,"aria-label":lf("Toggle category {0}",b),"aria-expanded":t,onMouseEnter:this.onmouseenter,onMouseLeave:this.onmouseleave,onClick:n,onContextMenu:n,onKeyDown:r||T.fireClickOnEnter},S.createElement("span",{className:"blocklyTreeIcon",role:"presentation"}),g,S.createElement("span",{style:{display:"inline-block"},className:"blocklyTreeIcon "+v,role:"presentation"},y),S.createElement("span",{className:"blocklyTreeLabel"},b))},e}(s.Component);n.TreeRow=u;var N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.renderCore=function(){return S.createElement(p,null,S.createElement("div",{className:"blocklyTreeSeparator"},S.createElement("span",{style:{display:"inline-block"},role:"presentation"})))},t}(s.Component);n.TreeSeparator=N;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.renderCore=function(){var e=this.props.selected;return S.createElement("div",{role:"treeitem","aria-selected":e},this.props.children)},t}(s.Component);n.TreeItem=p;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.renderCore=function(){var e=this.props.visible;return S.createElement("div",{role:"group",style:{backgroundPosition:"0px 0px",display:e?"":"none"}},this.props.children)},t}(s.Component);n.TreeGroup=d;var O=function(n){function e(e){var t=n.call(this,e)||this;return t.search=_.debounce(function(){t.searchImmediate()},300,!1),t.state={},t.searchImmediate=t.searchImmediate.bind(t),t.handleKeyDown=t.handleKeyDown.bind(t),t.handleChange=t.handleChange.bind(t),t}return i(e,n),e.getSearchTreeRow=function(){return{nameid:"search",name:lf("{id:category}Search"),color:pxt.toolbox.getNamespaceColor("search"),icon:pxt.toolbox.getNamespaceIcon("search")}},e.prototype.handleChange=function(){this.search()},e.prototype.handleKeyDown=function(e){var t=this.props.toolbox;40===("number"==typeof e.which?e.which:e.keyCode)&&t.selectFirstItem()},e.prototype.focus=function(){this.refs.searchInput.focus()},e.prototype.searchImmediate=function(){var n=this,e=this.props,t=e.parent,r=e.toolbox,i=e.editorname,o=this.refs.searchInput.value,a="",s=!1;pxt.tickEvent(i+".search",void 0,{interactiveConsent:!0}),t.searchAsync(o).done(function(e){a=0==e.length?lf("No search results..."):lf("{0} result matching '{1}'",e.length,o.toLowerCase()),s=""!=o;var t={};t.hasSearch=s,t.searchBlocks=e,t.focusSearch=!0,s&&(t.selectedItem="search"),r.setState(t),n.setState({searchAccessibilityLabel:a})})},e.prototype.renderCore=function(){var e=this.state.searchAccessibilityLabel;return S.createElement("div",{id:"blocklySearchArea"},S.createElement("div",{id:"blocklySearchInput",className:"ui fluid icon input",role:"search"},S.createElement("input",{ref:"searchInput",type:"text",placeholder:lf("Search..."),onFocus:this.searchImmediate,onKeyDown:this.handleKeyDown,onChange:this.handleChange,id:"blocklySearchInputField",className:"blocklySearchInputField","aria-label":lf("Search"),autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),S.createElement("i",{className:"search icon",role:"presentation","aria-hidden":"true"}),S.createElement("div",{className:"accessible-hidden",id:"blocklySearchLabel","aria-live":"polite"}," ",e," ")))},e}(s.Component);n.ToolboxSearch=O;var f=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.getStyle=function(){var e={opacity:0,display:"none"};if(this.props.flyoutOnly){var t=document.querySelector(".blocklyFlyout");t&&(e.left=t.clientWidth/2,e.transform="translateX(-45%)")}return e},e.prototype.renderCore=function(){return S.createElement("div",{id:"blocklyTrashIcon",style:this.getStyle()},S.createElement("i",{className:"trash icon","aria-hidden":"true"}))},e}(s.Component);n.ToolboxTrashIcon=f;var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.renderCore=function(){var e=this.props.categories;return S.createElement("style",null,e.filter(function(e){return!!e.color}).map(function(e){return"span.docs.inlineblock."+e.nameid.toLowerCase()+" {\n                    background-color: "+e.color+";\n                    border-color: "+pxt.toolbox.fadeColor(e.color,.1,!1)+";\n                }"}))},t}(s.Component);n.ToolboxStyle=P},{"./core":41,"./data":44,"./sui":100,react:284}],102:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("./srceditor"),a=e("./compiler"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.extensionsMap={},e.subcategoryMap={},e.topBlocks=[],e}return i(e,t),e.prototype.shouldShowBlock=function(e,t,n){var r=this.parent.state.editorState&&this.parent.state.editorState.filters;if(r){var i=r.blocks&&r.blocks[e],o=r.namespaces&&r.namespaces[t];if(null!=i&&i==pxt.editor.FilterState.Hidden&&!n)return!1;if(null!=i)return!0;if(null!=o&&o==pxt.editor.FilterState.Hidden)return!1;if(null!=o)return!0;if(null!=r.defaultState&&r.defaultState==pxt.editor.FilterState.Hidden&&!n)return!1}return!0},e.prototype.shouldShowCustomCategory=function(e){var t=this.parent.state.editorState&&this.parent.state.editorState.filters;return!t||!("variables"!==e||t.blocks&&!t.blocks.variables_set&&!t.blocks.variables_get&&!t.blocks.variables_change||t.namespaces&&t.namespaces.variables===pxt.editor.FilterState.Disabled)||!("functions"!==e||t.blocks&&!t.blocks.function_definition&&!t.blocks.procedures_defnoreturn&&!t.blocks.procedures_callnoreturn||t.namespaces&&t.namespaces.functions===pxt.editor.FilterState.Disabled)},e.prototype.getSearchSubset=function(){var n=this;if(!this.searchSubset&&this.blockInfo){this.searchSubset={};var r=this.searchSubset,e=pxt.blocks.blockDefinitions();for(var t in e){var i=e[t];this.shouldShowBlock(t,i.category)&&(r[t]=!0)}this.blockInfo.blocks.forEach(function(e){var t=(e.attributes.blockNamespace||e.namespace).split(".")[0];e.attributes.debug&&!pxt.options.debug||e.attributes.deprecated||e.attributes.blockHidden||n.shouldShowBlock(e.attributes.blockId,t)&&(r[e.attributes.blockId]=!0)})}return this.searchSubset},e.prototype.searchAsync=function(t){var e={term:t,subset:this.getSearchSubset()};return a.apiSearchAsync(e).then(function(e){return e}).then(function(e){return pxt.debug("searching for: "+t),e})},e.prototype.clearCaches=function(){this.searchSubset=void 0},e.prototype.getAllCategories=function(){return this.getToolboxCategories(!1).concat(this.getToolboxCategories(!0))},e.prototype.getToolboxCategories=function(n){if(!this.blockInfo)return[];var e,f,t,h=this;return t=this.getNamespaces().map(function(e){return[e,h.getNamespaceAttrs(e)]}),e=t.filter(function(e){var t=e[1];return!t.deprecated&&(n?t.advanced:!t.advanced)}),f=n,e.sort(function(e,t){var n=e[1],r=t[1];return(r&&r.weight||50)>=(n&&n.weight||50)?1:-1}).map(function(e){var t,o,n,a,r=e[0],i=e[1],s=h.isBuiltIn(r),l=s?h.getBuiltinCategory(r):void 0,c=h.getBlocksForCategory(r).filter(function(e){return h.shouldShowBlock(e.attributes.blockId,r)}),u=h.extensionsMap[r],p=l&&l.customClick;if((i.subcategories&&i.subcategories.length||h.subcategoryMap[r])&&(o=[r,i],n=i.subcategories||Object.keys(h.subcategoryMap[r]),a=f,t=n.map(function(e){var t=o[0],n=o[1],r=h.getBlocksForCategory(t,e).filter(function(e){return h.shouldShowBlock(e.attributes.blockId,t)});if(r.length){var i=pxt.Util.rlf("{id:subcategory}"+e);return{nameid:t,name:i,subns:e,color:n.color,icon:n.icon,groups:n.groups,groupIcons:n.groupIcons,groupHelp:n.groupHelp,labelLineWidth:n.labelLineWidth,blocks:r,advanced:a}}}).filter(function(e){return!!e})),(c.length||u||p||t&&t.length)&&(!p||h.shouldShowCustomCategory(r))){var d={nameid:r,name:i.block?i.block:void 0,color:i.color,icon:i.icon,groups:i.groups,groupIcons:i.groupIcons,groupHelp:i.groupHelp,labelLineWidth:i.labelLineWidth,blocks:c,subcategories:t,advanced:f};return s&&(d.name=l.name,d.icon=i.icon?pxt.toolbox.getNamespaceIcon(i.icon)||i.icon:pxt.toolbox.getNamespaceIcon(r),d.groups=l.groups||i.groups,d.customClick=l.customClick),d}}).filter(function(e){return!!e})},e.prototype.moveFocusToFlyout=function(){},e.prototype.abstractShowFlyout=function(e){var t=this,n=e.nameid,r=e.name,i=e.subns,o=e.icon,a=e.color,s=e.groups,l=e.groupIcons,c=e.groupHelp,u=e.labelLineWidth,p=e.blocks,d=this.parent.state.tutorialOptions&&!!this.parent.state.tutorialOptions.tutorial,f=p;if(!f||!f.length)return!1;pxt.appTarget.appTheme.hideFlyoutHeadings||this.showFlyoutHeadingLabel(n,r,i,o,a);var h={},m=[];s&&(m=s);var g={};if(s&&l)for(var v=l,y=0;y<m.length;y++){var b=v[y];g[m[y]]=b||""}var _={};if(s&&c){var w=c;for(y=0;y<m.length;y++){var k=w[y];_[m[y]]=k||""}}for(var x=0;x<f.length;++x){var E=f[x],C=E.attributes.group||"other";h[C]||(h[C]=[]),h[C].push(E)}var S=Object.keys(h).length;if(1<S){Object.keys(h).sort().forEach(function(e){-1==m.indexOf(e)&&m.push(e)});for(var T=0;T<m.length;++T)C=m[T],h[C]&&h[C].length&&("other"==C||d||this.showFlyoutGroupLabel(C,g[C],u,_[C]),h[C]&&this.showFlyoutBlocks(n,a,h[C]))}else 1==S&&Object.keys(h).forEach(function(e){t.showFlyoutBlocks(n,a,h[e])});return!0},e.prototype.getNamespaceAttrs=function(e){var t=this.blockInfo.apis.byQName[e];if(t)return t.attributes;if(this.extensionsMap[e]){var n=this.extensionsMap[e];return{weight:0,blockId:n.name,color:n.extension.color||"#7f8c8d",advanced:n.extension.advanced||!1,callingConvention:0,paramDefl:{}}}},e.prototype.getNamespaces=function(){var i=this,o=[];return this.extensions.forEach(function(e){var t=e.config,n=t.name,r=t.extension.namespace||n;i.extensionsMap[r]||(i.extensionsMap[r]=t),o.filter(function(e){return e==r})||o.push(n)}),o},e.prototype.getTopBlocks=function(){return this.topBlocks.sort(function(e,t){var n=e.attributes.topblockWeight||e.attributes.weight||50;return(t.attributes.topblockWeight||t.attributes.weight||50)>=n?1:-1})},e}(o.Editor);n.ToolboxEditor=s},{"./compiler":14,"./srceditor":99}],103:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var _=e("react"),o=e("react-dom"),a=e("./data"),w=e("./sui"),s=e("./sounds"),l=e("./core"),k=e("./marked"),c=e("./compiler"),u=e("./codecard"),x=e("./hinttooltip");n.getUsedBlocksAsync=function(t){if(!t)return Promise.resolve({});var o={};return c.getBlocksAsync().then(function(e){return pxt.blocks.initializeAndInject(e),c.decompileBlocksSnippetAsync(t,e)}).then(function(e){if(e){var t=pxt.blocks.loadWorkspaceXml(e);if(!t)throw pxt.debug("used blocks xml failed to load\n"+e),new Error("blocksXml failed to load");for(var n=t.getAllBlocks(),r=0;r<n.length;++r){var i=n[r];i.isShadow_||(o[i.type]=1)}return o}throw new Error("Empty blocksXml, failed to decompile")}).catch(function(e){throw pxt.reportException(e),new Error("Failed to decompile tutorial")})};var p=function(r){function e(e){var t=r.call(this,e)||this,n=t.props.parent.state.tutorialOptions;return t.hasActivities=n&&n.tutorialActivityInfo&&1<n.tutorialActivityInfo.length,t}return i(e,r),e.prototype.renderCore=function(){var e=this.props.parent.state.tutorialOptions;return this.hasActivities?_.createElement(h,{parent:this.props.parent}):e.tutorialStepInfo.length<8?_.createElement(d,{parent:this.props.parent}):_.createElement("div",{className:"menu"},_.createElement(d,{parent:this.props.parent,className:"mobile hide"}),_.createElement(h,{parent:this.props.parent,className:"mobile only"}))},e}(a.Component);n.TutorialMenu=p;var d=function(n){function e(e){var t=n.call(this,e)||this;return t.openTutorialStep=t.openTutorialStep.bind(t),t}return i(e,n),e.prototype.openTutorialStep=function(e){var t=this.props.parent.state.tutorialOptions;pxt.tickEvent("tutorial.step",{tutorial:t.tutorial,step:e},{interactiveConsent:!0}),this.props.parent.setTutorialStep(e)},e.prototype.renderCore=function(){var r=this,e=this.props.parent.state.tutorialOptions,i=e.tutorialReady,o=e.tutorialStepInfo,a=e.tutorialStep;return i?_.createElement("div",{className:"ui item "+this.props.className},_.createElement("div",{className:"ui item tutorial-menuitem",role:"menubar"},o.map(function(e,t){return t==a?_.createElement("span",{className:"step-label",key:"tutorialStep"+t},_.createElement(f,{index:t,className:"ui circular label "+(a==t?"blue selected":"inverted")+" "+(i?"":"disabled"),ariaLabel:lf("Tutorial step {0}. This is the current step",t+1),onClick:r.openTutorialStep},t+1)):_.createElement("span",{className:"ui step-label "+(n=t,o.length<8||0==n||n==o.length-1||Math.abs(n-a)<2?"":"mobile hide"),key:"tutorialStep"+t,"data-tooltip":""+(t+1),"data-inverted":"","data-position":"bottom center"},_.createElement(f,{index:t,className:"ui empty circular label "+(i?"":"disabled")+" clear",ariaLabel:lf("Tutorial step {0}",t+1),onClick:r.openTutorialStep}));var n}))):_.createElement("div",null)},e}(a.Component);n.TutorialMenuItem=d;var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleClick=function(){e.props.onClick(e.props.index)},e}return i(e,t),e.prototype.renderCore=function(){var e=this.props,t=e.className,n=e.ariaLabel;return e.index,_.createElement("a",{className:t,role:"menuitem","aria-label":n,tabIndex:0,onClick:this.handleClick,onKeyDown:w.fireClickOnEnter},this.props.children)},e}(a.Component);n.TutorialMenuItemLink=f;var h=function(n){function e(e){var t=n.call(this,e)||this;return t.handleNextClick=function(){var e=t.props.parent.state.tutorialOptions;t.openTutorialStep(e.tutorialStep+1)},t.handlePrevClick=function(){var e=t.props.parent.state.tutorialOptions;t.openTutorialStep(e.tutorialStep-1)},t.openTutorialStep=t.openTutorialStep.bind(t),t}return i(e,n),e.prototype.openTutorialStep=function(e){var t=this.props.parent.state.tutorialOptions;pxt.tickEvent("tutorial.step",{tutorial:t.tutorial,step:e},{interactiveConsent:!0}),this.props.parent.setTutorialStep(e)},e.prototype.renderCore=function(){var e=this.props.parent.state.tutorialOptions,t=e.tutorialReady,n=e.tutorialStepInfo,r=e.tutorialStep,i=r,o=t&&0!=i,a=t&&i!=n.length-1;return t?_.createElement("div",{id:"tutorialsteps",className:"ui item "+this.props.className},_.createElement("div",{className:"ui item",role:"menubar"},_.createElement(w.Button,{role:"button",icon:"left chevron",disabled:!o,className:"prevbutton left "+(o?"":"disabled"),text:lf("Back"),textClass:"widedesktop only",ariaLabel:lf("Go to the previous step of the tutorial."),onClick:this.handlePrevClick,onKeyDown:w.fireClickOnEnter}),_.createElement("span",{className:"step-label",key:"tutorialStep"+i},_.createElement(w.ProgressCircle,{progress:i+1,steps:n.length,stroke:4.5}),_.createElement("span",{className:"ui circular label blue selected "+(t?"":"disabled"),"aria-label":lf("You are currently at tutorial step {0}.")},r+1)),_.createElement(w.Button,{role:"button",icon:"right chevron",disabled:!a,rightIcon:!0,className:"nextbutton right "+(a?"":"disabled"),text:lf("Next"),textClass:"widedesktop only",ariaLabel:lf("Go to the next step of the tutorial."),onClick:this.handleNextClick,onKeyDown:w.fireClickOnEnter}))):_.createElement("div",null)},e}(a.Component);n.TutorialStepCircle=h;var E=function(n){function e(e){var t=n.call(this,e)||this;return t.setRef=function(e){t.elementRef=e},t.next=t.next.bind(t),t.showHint=t.showHint.bind(t),t.closeHint=t.closeHint.bind(t),t}return i(e,n),e.prototype.next=function(){var e=this.props.parent.state.tutorialOptions,t=e.tutorialStep,n=e.tutorial;this.setState({visible:!1});var r=t+1;pxt.tickEvent("tutorial.hint.next",{tutorial:n,step:r}),this.props.parent.setTutorialStep(r)},e.prototype.showHint=function(e,t){this.setState({visible:e,showFullText:t})},e.prototype.closeHint=function(){this.showHint(!1,this.state.showFullText)},e.prototype.renderCore=function(){var e=this.state.visible,t=this.props.parent.state.tutorialOptions,n=t.tutorialReady,r=t.tutorialStepInfo,i=t.tutorialStep,o=t.tutorialName;if(!n)return _.createElement("div",null);var a=r[i],s=a.hintContentMd,l=a.contentMd;if(a.unplugged){var c=i<r.length-1?this.next:this.closeHint,u=[{label:lf("Ok"),onclick:c,icon:"check",className:"green"}];return _.createElement(w.Modal,{isOpen:e,className:"hintdialog",closeIcon:!1,header:o,buttons:u,onClose:c,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},_.createElement(k.MarkedContent,{markdown:l,parent:this.props.parent}))}return s?_.createElement("div",{className:"tutorialhint "+(e?"":"hidden"),ref:this.setRef},_.createElement(k.MarkedContent,{markdown:this.state.showFullText?l:s,parent:this.props.parent})):_.createElement("div",null)},e}(a.Component);n.TutorialHint=E;var m=function(r){function e(e){var t=r.call(this,e)||this;t.closeLightboxOnEscape=function(e){27===l.keyCodeFromEvent(e)&&t.closeLightbox()},t.lastStep=-1;var n=t.props.parent.state.tutorialOptions;return t.prevStep=n.tutorialStep,t.state={showSeeMore:!1,showHint:n.tutorialStepInfo[t.prevStep].fullscreen},t.toggleHint=t.toggleHint.bind(t),t.hintOnClick=t.hintOnClick.bind(t),t.closeLightbox=t.closeLightbox.bind(t),t.tutorialCardKeyDown=t.tutorialCardKeyDown.bind(t),t.okButtonKeyDown=t.okButtonKeyDown.bind(t),t.previousTutorialStep=t.previousTutorialStep.bind(t),t.nextTutorialStep=t.nextTutorialStep.bind(t),t.finishTutorial=t.finishTutorial.bind(t),t.toggleExpanded=t.toggleExpanded.bind(t),t}return i(e,r),e.prototype.previousTutorialStep=function(){this.showHint(!1);var e=this.props.parent.state.tutorialOptions,t=e.tutorialStep-1;e.tutorialStep=t,pxt.tickEvent("tutorial.previous",{tutorial:e.tutorial,step:t},{interactiveConsent:!0}),this.props.parent.setTutorialStep(t)},e.prototype.nextTutorialStep=function(){this.showHint(!1);var e=this.props.parent.state.tutorialOptions,t=e.tutorialStep+1;e.tutorialStep=t,pxt.tickEvent("tutorial.next",{tutorial:e.tutorial,step:t},{interactiveConsent:!0}),this.props.parent.setTutorialStep(t)},e.prototype.finishTutorial=function(){this.closeLightbox(),this.removeHintOnClick(),this.props.parent.completeTutorialAsync().done()},e.prototype.closeLightbox=function(){s.tutorialNext(),document.documentElement.removeEventListener("keydown",this.closeLightboxOnEscape),this.props.parent.hideLightbox()},e.prototype.componentWillUpdate=function(){document.documentElement.addEventListener("keydown",this.closeLightboxOnEscape)},e.prototype.tutorialCardKeyDown=function(e){if(l.keyCodeFromEvent(e)==l.TAB_KEY){e.preventDefault();var t=this.refs.tutorialok;o.findDOMNode(t).focus()}},e.prototype.okButtonKeyDown=function(e){l.keyCodeFromEvent(e)==l.TAB_KEY&&(e.preventDefault(),this.refs.tutorialmessage.focus())},e.prototype.componentDidUpdate=function(e,t){var n=this.props.parent.state.tutorialOptions,r=this.refs.tutorialmessage,i=this.props.parent.state.tutorialOptions.tutorialStep;if(i!=this.lastStep){var o="fade "+(i<this.lastStep?"right":"left")+" in visible transition animating";r.style.animationDuration="500ms",this.lastStep=i,pxsim.U.addClass(r,o),Promise.resolve().delay(500).then(function(){return pxsim.U.removeClass(r,o)})}this.prevStep!=i&&(this.setShowSeeMore(n.autoexpandStep),this.prevStep=i,this.setState({showHint:n.tutorialStepInfo[i].unplugged||n.tutorialStepInfo[i].fullscreen}))},e.prototype.componentDidMount=function(){this.setShowSeeMore(this.props.parent.state.tutorialOptions.autoexpandStep)},e.prototype.componentWillUnmount=function(){k.MarkedContent.clearBlockSnippetCache(),this.lastStep=-1,this.props.parent.stopPokeUserActivity(),this.removeHintOnClick()},e.prototype.removeHintOnClick=function(){document.removeEventListener("click",this.hintOnClick)},e.prototype.toggleExpanded=function(e){e.stopPropagation(),e.preventDefault();var t=this.props.parent.state.tutorialOptions.tutorialStepExpanded;return this.props.parent.setTutorialInstructionsExpanded(!t),!1},e.prototype.hasHint=function(){var e=this.props.parent.state.tutorialOptions,t=e.tutorialReady,n=e.tutorialStepInfo,r=e.tutorialStep;return!!t&&(n[r].hasHint||n[r].unplugged)},e.prototype.hintOnClick=function(e){var t=this.props.parent.state.tutorialOptions;if(t){e&&e.stopPropagation();var n=t.tutorialStepInfo,r=t.tutorialStep,i=n[r];r<n.length-1&&i&&i.unplugged||this.toggleHint()}else pxt.reportError("tutorial","leaking hintonclick")},e.prototype.expandedHintOnClick=function(e){e.stopPropagation()},e.prototype.setShowSeeMore=function(e){var t=this.refs.tutorialmessage,n=!1;t&&t.firstElementChild&&t.firstElementChild.firstElementChild&&(n=t.clientHeight<t.firstElementChild.firstElementChild.scrollHeight)&&(this.cardHeight=t.firstElementChild.firstElementChild.scrollHeight,e&&this.props.parent.setTutorialInstructionsExpanded(!0)),this.setState({showSeeMore:n})},e.prototype.getCardHeight=function(){return this.cardHeight},e.prototype.getExpandedCardStyle=function(e){return(t={})[e]="calc("+this.getCardHeight()+"px + 2rem)",t;var t},e.prototype.toggleHint=function(e){this.showHint(!this.state.showHint,e)},e.prototype.showHint=function(e,t){if(this.removeHintOnClick(),this.closeLightbox(),this.hasHint()){var n=this.refs.tutorialhint;if(n){if(e){n.elementRef&&n.elementRef.addEventListener("click",this.expandedHintOnClick),this.setState({showHint:!0}),this.props.parent.stopPokeUserActivity();var r=this.props.parent.state.tutorialOptions;r.tutorialStepInfo[r.tutorialStep].unplugged||document.addEventListener("click",this.hintOnClick),pxt.tickEvent("tutorial.showhint",{tutorial:r.tutorial,step:r.tutorialStep})}else n.elementRef&&n.elementRef.removeEventListener("click",this.expandedHintOnClick),this.setState({showHint:!1}),this.props.parent.pokeUserActivity();n.showHint(e,t)}}},e.prototype.renderCore=function(){var e=this.props.parent.state.tutorialOptions,t=e.tutorialReady,n=e.tutorialStepInfo,r=e.tutorialStep,i=e.tutorialStepExpanded,o=e.metadata;if(!t)return _.createElement("div",null);var a=n[r].headerContentMd,s=!!pxt.appTarget.appTheme.lockedEditor,l=r,c=n.length,u=o&&o.hideIteration,p=t&&0!=l&&!u,d=t&&l!=c-1&&!u,f=!s&&l==c-1&&!u,h=this.hasHint(),m=n[r].unplugged,g="",v="";h&&(g+=lf("Press Space or Enter to show a hint."),v+=lf("Click to show a hint!"));var y=this.hintOnClick;(pxt.BrowserUtils.isEdge()||pxt.BrowserUtils.isIE())&&this.state.showHint&&!m&&(y=null);var b=pxt.Util.isUserLanguageRtl();return _.createElement("div",{id:"tutorialcard",className:"ui "+(i?"tutorialExpanded":"")+" "+(t?"tutorialReady":"")+" "+(this.state.showSeeMore?"seemore":"")+"  "+(this.state.showHint?"":"showTooltip")+" "+(h?"hasHint":""),style:i?this.getExpandedCardStyle("height"):null},_.createElement("div",{className:"ui buttons"},p?_.createElement(w.Button,{icon:(b?"right":"left")+" chevron orange large",className:"prevbutton left attached "+(p?"":"disabled"),text:lf("Back"),textClass:"widedesktop only",ariaLabel:lf("Go to the previous step of the tutorial."),onClick:this.previousTutorialStep,onKeyDown:w.fireClickOnEnter}):void 0,_.createElement("div",{className:"ui segment attached tutorialsegment"},_.createElement("div",{className:"avatar-container"},_.createElement("div",{role:"button",className:"avatar-image "+(h&&this.props.pokeUser?"shake":""),onClick:y,onKeyDown:w.fireClickOnEnter}),h&&_.createElement(w.Button,{className:"ui circular small label blue hintbutton hidelightbox",icon:"lightbulb outline",tabIndex:-1,onClick:y,onKeyDown:w.fireClickOnEnter}),h&&_.createElement(x.HintTooltip,{ref:"hinttooltip",pokeUser:this.props.pokeUser,text:v,onClick:y}),h&&_.createElement(E,{ref:"tutorialhint",parent:this.props.parent})),_.createElement("div",{ref:"tutorialmessage",className:"tutorialmessage",role:"alert","aria-label":g,tabIndex:h?0:-1,onClick:h?y:void 0,onKeyDown:h?w.fireClickOnEnter:void 0},_.createElement("div",{className:"content"},!m&&_.createElement(k.MarkedContent,{className:"no-select",markdown:a,parent:this.props.parent}))),this.state.showSeeMore&&!i&&_.createElement(w.Button,{className:"fluid compact lightgrey",icon:"chevron down",tabIndex:0,text:lf("More..."),onClick:this.toggleExpanded,onKeyDown:w.fireClickOnEnter}),this.state.showSeeMore&&i&&_.createElement(w.Button,{className:"fluid compact lightgrey",icon:"chevron up",tabIndex:0,text:lf("Less..."),onClick:this.toggleExpanded,onKeyDown:w.fireClickOnEnter}),_.createElement(w.Button,{ref:"tutorialok",id:"tutorialOkButton",className:"large green okbutton showlightbox",text:lf("Ok"),onClick:this.closeLightbox,onKeyDown:w.fireClickOnEnter})),d?_.createElement(w.Button,{icon:(b?"left":"right")+" chevron orange large",className:"nextbutton right attached "+(d?"":"disabled"),text:lf("Next"),textClass:"widedesktop only",ariaLabel:lf("Go to the next step of the tutorial."),onClick:this.nextTutorialStep,onKeyDown:w.fireClickOnEnter}):void 0,f?_.createElement(w.Button,{icon:"left checkmark",className:"orange right attached "+(t?"":"disabled"),text:lf("Finish"),ariaLabel:lf("Finish the tutorial."),onClick:this.finishTutorial,onKeyDown:w.fireClickOnEnter}):void 0))},e}(a.Component);n.TutorialCard=m;var g=function(n){function e(e){var t=n.call(this,e)||this;return t.prevGalleries=[],t.state={visible:!1},t.close=t.close.bind(t),t}return i(e,n),e.prototype.hide=function(){this.setState({visible:!1})},e.prototype.close=function(){this.setState({visible:!1})},e.prototype.show=function(){this.setState({visible:!0})},e.prototype.start=function(e){pxt.tickEvent("recipe."+e.url),this.hide(),this.props.parent.startTutorial(e.url,void 0,!0)},e.prototype.fetchGallery=function(){var e=this.getData("gallery:"+encodeURIComponent("/recipes"));if(e)if(e instanceof Error);else{var t=this.props.parent.isJavaScriptActive()?"js":this.props.parent.isPythonActive()?"py":"blocks";this.prevGalleries=pxt.Util.concat(e.map(function(e){return e.cards.filter(function(e){return"tutorial"==e.cardType}).filter(function(e){return e.editor==t||"blocks"==t&&!e.editor})}))}return this.prevGalleries||[]},e.prototype.renderCore=function(){var t=this,e=this.state.visible;if(!e)return _.createElement("div",null);var n=this.fetchGallery();return _.createElement(w.Modal,{isOpen:e,className:"recipedialog",size:"large",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Try a Tutorial"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},_.createElement("div",{className:"group"},_.createElement("div",{className:"ui cards centered",role:"listbox"},!n.length&&_.createElement("div",{className:"ui items"},_.createElement("div",{className:"ui item"},lf("Oops, we couldn't find any tutorials for this editor."))),0<n.length?n.map(function(e){return _.createElement(u.CodeCardView,{key:"card"+e.name,name:e.name,ariaLabel:e.name,description:e.description,imageUrl:e.imageUrl,largeImageUrl:e.largeImageUrl,onClick:function(){return t.start(e)}})}):void 0)))},e}(a.Component);n.ChooseRecipeDialog=g;var v=function(n){function e(e){var t=n.call(this,e)||this;return t.flyoutWidth=0,t.flyoutTitle=lf("Toolbox"),t.workspaceTitle=lf("Workspace"),t}return i(e,n),e.prototype.componentWillUpdate=function(){var e=document.querySelector(".blocklyFlyout");e&&(this.flyoutWidth=e.clientWidth)},e.prototype.headerStyle=function(){return{width:this.flyoutWidth}},e.prototype.renderCore=function(){return _.createElement("div",{id:"headers"},_.createElement("div",{id:"flyoutHeader",style:this.headerStyle()},this.flyoutTitle),_.createElement("div",{id:"workspaceHeader"},this.workspaceTitle))},e}(a.Component);n.WorkspaceHeader=v},{"./codecard":13,"./compiler":14,"./core":41,"./data":44,"./hinttooltip":66,"./marked":71,"./sounds":98,"./sui":100,react:284,"react-dom":240}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("react"),o=e("./core"),a=e("./cmds");function r(r){return pxt.tickEvent("webusb.pair"),pxt.targetConfigAsync().then(function(e){return(e.firmwareUrls||{})[pxt.appTarget.simulator.boardDefinition?pxt.appTarget.simulator.boardDefinition.id:""]}).then(function(e){var t=pxt.appTarget.appTheme.boardName||lf("device"),n=i.createElement("div",{className:"ui "+(e?"four":"three")+" column grid stackable"},e?i.createElement("div",{className:"column firmware"},i.createElement("div",{className:"ui"},i.createElement("div",{className:"content"},i.createElement("div",{className:"description"},lf("First time here?"),i.createElement("br",null),i.createElement("a",{href:e,target:"_blank",rel:"noopener noreferrer"},lf("Check your firmware version and update if needed")))))):void 0,i.createElement("div",{className:"column"},i.createElement("div",{className:"ui"},i.createElement("div",{className:"content"},i.createElement("div",{className:"description"},i.createElement("span",{className:"ui yellow circular label"},"1"),i.createElement("strong",null,lf("Connect {0} to computer with USB cable",t)),i.createElement("br",null))))),i.createElement("div",{className:"column"},i.createElement("div",{className:"ui"},i.createElement("div",{className:"content"},i.createElement("div",{className:"description"},i.createElement("span",{className:"ui blue circular label"},"2"),lf("Select the device in the pairing dialog"))))),i.createElement("div",{className:"column"},i.createElement("div",{className:"ui"},i.createElement("div",{className:"content"},i.createElement("div",{className:"description"},i.createElement("span",{className:"ui blue circular label"},"3"),lf('Press "Connect"'))))));return o.confirmAsync({header:lf("Pair your {0}",t),agreeLbl:lf("Let's pair it!"),size:"",className:"webusbpair",jsx:n}).then(function(e){if(!e){if(r)return a.browserDownloadDeployCoreAsync(r);pxt.U.userError(pxt.U.lf("Device not paired"))}return r?pxt.usb.pairAsync().then(function(){return pxt.tickEvent("webusb.pair.success"),a.hidDeployCoreAsync(r)}).catch(function(e){return a.browserDownloadDeployCoreAsync(r)}):pxt.usb.pairAsync()})})}n.showWebUSBPairingInstructionsAsync=r;var s=0;n.webUsbDeployCoreAsync=function(t){return pxt.tickEvent("webusb.deploy"),a.hidDeployCoreAsync(t).catch(function(e){return function(t){if(pxt.tickEvent("webusb.askpair"),3<++s)return pxt.tickEvent("webusb.askpaircancel"),a.browserDownloadDeployCoreAsync(t);var e=pxt.appTarget.appTheme.boardName||lf("device");return o.confirmAsync({header:lf("No device detected..."),jsx:i.createElement("div",null,i.createElement("p",null,i.createElement("strong",null,lf("Do you want to pair your {0} to the editor?",e))),i.createElement("p",null,lf("You will get one-click downloads and data logging.")))}).then(function(e){return e?r(t):(a.setWebUSBPaired(!1),a.browserDownloadDeployCoreAsync(t))})}(t)})}},{"./cmds":12,"./core":41,react:284}],105:[function(e,t,n){"use strict";var C=this&&this.__awaiter||function(o,a,s,l){return new(s||(s=Promise))(function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((l=l.apply(o,a||[])).next())})},S=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var a,r,i,o=e("./db"),c=e("./core"),s=e("./data"),l=e("./browserworkspace"),u=e("./fileworkspace"),p=e("./memoryworkspace"),d=e("./iframeworkspace"),x=e("./cloudsync"),f=e("./idbworkspace"),h=e("./compiler"),T=pxt.Util,m=pxt.Cloud,g=e("crypto-js/sha1"),v=[],y=new T.PromiseQueue;function b(t){return v.filter(function(e){return e.header.id==t||e.header.path==t})[0]}function A(e,t){if(void 0===t&&(t="utf-8"),"base64"==t){var n=atob(e);return g("blob "+n.length+"\0"+n)+""}return g("blob "+T.toUTF8(e).length+"\0"+e)+""}function _(t){void 0===t&&(t=!1),N();var e=v.map(function(e){return e.header}).filter(function(e){return(t||!e.isDeleted)&&!e.isBackup});return e.sort(function(e,t){return t.recentUse-e.recentUse}),e}function w(){N();var e=v.map(function(e){return e.header}),t={};return e.filter(function(e){return e.backupRef}).forEach(function(e){return t[e.backupRef]=!0}),Promise.all(e.filter(function(e){return e.isBackup&&!t[e.id]}).map(function(e){return e.isDeleted=!0,I(e)}))}function k(e){N();var t=b(e);return t&&!t.header.isDeleted?t.header:null}function E(){return pxt.storage.getLocal("pxt_workspace_session_id")!=i}function N(){E()&&pxt.Util.assert(!1,"trying to access outdated session")}function O(e){N();var t=b(e);return t?t.text?Promise.resolve(t.text):y.enqueue(e,function(){return a.getAsync(t.header).then(function(e){return t.text||(t.text=j(e.text)),t.version=e.version,t.text})}):Promise.resolve(null)}function P(t){return void 0!==t.version?Promise.resolve():a.getAsync(t.header).then(function(e){t.version=e.version})}function I(t,n,r){if(N(),T.assert(t.target==pxt.appTarget.id),t.temporary)return Promise.resolve();var i=b(t.id);if(r||(t.recentUse=T.nowSeconds()),(n||t.isDeleted)&&(n&&(i.text=n),r||(t.pubCurrent=!1,t.blobCurrent=!1,t.modificationTime=T.nowSeconds(),t.targetVersion=t.targetVersion||"0.0.0"),t.saveId=null),t.isDeleted&&"DELETED"==t.blobVersion){var e=v.indexOf(i);return T.assert(0<=e),v.splice(e,1),y.enqueue(t.id,function(){return P(i).then(function(){return a.deleteAsync?a.deleteAsync(t,i.version):a.setAsync(t,i.version,{})})})}if(n&&pxt.appTarget.simulator&&pxt.appTarget.simulator.dynamicBoardDefinition){var o=pxt.Package.parseAndValidConfig(n[pxt.CONFIG_NAME]);o&&o.dependencies&&(t.board=Object.keys(o.dependencies).filter(function(e){return!!pxt.bundledSvg(e)})[0])}return y.enqueue(t.id,function(){return P(i).then(function(){return a.setAsync(t,i.version,n?i.text:null).then(function(e){n&&(i.version=e),(n&&!r||t.isDeleted)&&(t.pubCurrent=!1,t.blobCurrent=!1,t.saveId=null,s.invalidate("text:"+t.id),s.invalidate("pkg-git-status:"+t.id)),s.invalidate("header:"+t.id),s.invalidate("header:*")})})})}function D(e,t,n){void 0===n&&(n=!1),e.path=function(e){var t=e.name.replace(/[^a-zA-Z0-9]+/g," ").trim().replace(/ /g,"-");if(t||(t="Untitled"),b(t)){for(var n=2;b(t+"-"+n);)n++;t+="-"+n}return t}(e);var r={header:e,text:t,version:null};return v.push(r),I(e,t,n)}function L(e,t){N(),T.assert(e.target==pxt.appTarget.id);var n=e;n.id=ts.pxtc.Util.guidGen(),n.recentUse=T.nowSeconds(),n.modificationTime=n.recentUse;var r=pxt.Package.parseAndValidConfig(t[pxt.CONFIG_NAME]);return r&&r.preferredEditor&&(n.editor=r.preferredEditor),D(n,t).then(function(){return n})}function R(e){for(var t=-1<e.name.indexOf("#")?e.name.substring(0,e.name.lastIndexOf("#")).trim():e.name,n=T.toDictionary(v.filter(function(e){return!e.header.isDeleted}),function(e){return e.header.name}),r=2;n.hasOwnProperty(t+" #"+r);)r++;return t+" #"+r}function j(t){return t&&["kind.json","yelm.json"].forEach(function(e){!t[pxt.CONFIG_NAME]&&t[e]&&(t[pxt.CONFIG_NAME]=t[e],delete t[e])}),t}n.gitsha=A,n.copyProjectToLegacyEditor=function(e,t){return ee()?l.copyProjectToLegacyEditor(e,t):Promise.reject("Copy operation only works in browser workspace")},n.setupWorkspace=function(e){switch(T.assert(!a,"workspace set twice"),pxt.log("workspace: "+e),r=e){case"fs":case"file":a=u.provider;break;case"mem":case"memory":a=p.provider;break;case"iframe":a=d.provider;break;case"uwp":u.setApiAsync(pxt.winrt.workspace.fileApiAsync),a=pxt.winrt.workspace.getProvider(u.provider);break;case"idb":a=f.provider;break;case"cloud":case"browser":default:a=l.provider}},n.getHeaders=_,n.makeBackupAsync=function(e,t){var n=T.flatClone(e);return n.id=T.guidGen(),delete n._rev,delete n._id,n.isBackup=!0,D(n,t).then(function(){return e.backupRef=n.id,I(n)}).then(function(){return n})},n.restoreFromBackupAsync=function(t){if(!t.backupRef||t.isDeleted)return Promise.resolve();var n=t.backupRef;return O(n).then(function(e){return delete t.backupRef,I(t,e)}).then(function(){var e=k(n);return e.isDeleted=!0,I(e)}).catch(function(){return delete t.backupRef,I(t)})},n.cleanupBackupsAsync=w,n.getHeader=k,n.isSessionOutdated=E,n.initAsync=function(){return a||(a=l.provider),i=ts.pxtc.Util.guidGen(),pxt.storage.setLocal("pxt_workspace_session_id",i),pxt.debug("workspace session: "+i),v=[],Z().then(function(e){return w().then(function(){return e})}).then(function(e){return pxt.perf.recordMilestone("workspace init finished"),e})},n.getTextAsync=O,n.anonymousPublishAsync=function(t,e,n,r){var i,o,a={};if(t.saveId=a,r){var s=/^data:(image\/(png|gif));base64,([a-zA-Z0-9+/]+=*)$/.exec(r);s&&(i=s[3],o=s[1])}var l=JSON.stringify(e,null,2)+"\n",c={name:t.name,target:t.target,targetVersion:t.targetVersion,description:n.description||lf("Made with  in {0}.",pxt.appTarget.title||pxt.appTarget.name),editor:t.editor,text:e,meta:{versions:pxt.appTarget.versions,blocksHeight:n.blocksHeight,blocksWidth:n.blocksWidth},thumbnailBuffer:i,thumbnailMimeType:o};return pxt.debug("publishing script; "+l.length+" bytes"),m.privatePostAsync("scripts",c,!0).then(function(e){return e.shortid&&(e.id=e.shortid),t.pubId=e.shortid,t.pubCurrent=t.saveId===a,t.meta=e.meta,pxt.debug("published; id /"+t.pubId),I(t).then(function(){return e})})},n.saveAsync=I,n.importAsync=D,n.installAsync=L,n.renameAsync=function(e,t){return N(),x.renameAsync(e,t)},n.duplicateAsync=function(e,t,n){var r=b(e.id);T.assert(r.header===e);var i=T.flatClone(e);if(r.header=i,e.id=T.guidGen(),n){e.name=R(e);var o=JSON.parse(t[pxt.CONFIG_NAME]);o.name=e.name,t[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(o)}return delete e._rev,delete e._id,D(e,t).then(function(){return e})},n.createDuplicateName=R,n.saveScreenshotAsync=function(e,t,n){return N(),a.saveScreenshotAsync?a.saveScreenshotAsync(e,t,n):Promise.resolve()},n.fixupFileNames=j;var B,M,F=new T.PromiseQueue,U=new o.Table("script");function q(n){N(),pxt.github.isGithubId(n)&&(n=pxt.github.normalizeRepoId(n));var r=encodeURIComponent(n);return pxt.packagesConfigAsync().then(function(t){return F.enqueue(n,function(){return U.getAsync(r).then(function(e){return e.files},function(e){return(pxt.github.isGithubId(n)?pxt.github.downloadPackageAsync(n,t).then(function(e){return e.files}):m.downloadScriptFilesAsync(n)).catch(c.handleNetworkError).then(function(e){return U.setAsync({id:r,files:e}).then(function(){return e})})}).then(j)})})}n.getPublishedScriptAsync=q,(M=B=n.PullStatus||(n.PullStatus={}))[M.NoSourceControl=0]="NoSourceControl",M[M.UpToDate=1]="UpToDate",M[M.GotChanges=2]="GotChanges",M[M.NeedsCommit=3]="NeedsCommit";var H=pxt.github.GIT_JSON;function z(s,l){return void 0===l&&(l=!1),C(this,void 0,void 0,function(){var t,n,r,i,o,a;return S(this,function(e){switch(e.label){case 0:return[4,O(s.id)];case 1:return t=e.sent(),[4,J(s,t)];case 2:return e.sent(),(n=t[H])?(r=JSON.parse(n),i=pxt.github.parseRepoId(r.repo),[4,pxt.github.getRefAsync(i.fullName,i.tag)]):[2,B.NoSourceControl];case 3:if((o=e.sent())==r.commit.sha)return[2,B.UpToDate];if(l)return[2,B.GotChanges];e.label=4;case 4:return e.trys.push([4,6,,7]),[4,Y(s,{repo:r.repo,sha:o,files:t,tryDiff3:!0})];case 5:return e.sent(),[2,B.GotChanges];case 6:if((a=e.sent()).isMergeError)return[2,B.NeedsCommit];throw a;case 7:return[2]}})})}function V(e){var t=pxt.semver.parse(e.version||"0.0.0");return t.patch++,pxt.semver.stringify(t)}n.hasPullAsync=function(t){return C(this,void 0,void 0,function(){return S(this,function(e){switch(e.label){case 0:return[4,z(t,!0)];case 1:return[2,e.sent()==B.GotChanges]}})})},n.pullAsync=z,n.hasMergeConflictMarkers=function(n){return C(this,void 0,void 0,function(){var t;return S(this,function(e){switch(e.label){case 0:return[4,O(n.id)];case 1:return t=e.sent(),[2,!!Object.keys(t).find(function(e){return pxt.github.hasMergeConflictMarker(t[e])})]}})})},n.prAsync=function(o,a,s){return C(this,void 0,void 0,function(){var t,n,r,i;return S(this,function(e){switch(e.label){case 0:return t=pxt.github.parseRepoId(o.githubId),[4,pxt.github.getNewBranchNameAsync(t.fullName,"merge-")];case 1:return n=e.sent(),[4,pxt.github.createNewBranchAsync(t.fullName,n,a)];case 2:return e.sent(),[4,pxt.github.createPRFromBranchAsync(t.fullName,t.tag,n,s)];case 3:return r=e.sent(),[4,pxt.github.getRefAsync(t.fullName,t.tag)];case 4:return i=e.sent(),[4,Y(o,{repo:o.githubId,sha:i,files:{}})];case 5:return e.sent(),[2,r]}})})},n.bumpedVersion=V,n.bumpAsync=function(r,i){return void 0===i&&(i=""),C(this,void 0,void 0,function(){var t,n;return S(this,function(e){switch(e.label){case 0:return[4,O(r.id)];case 1:return t=e.sent(),(n=JSON.parse(t[pxt.CONFIG_NAME])).version=i||V(n),t[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(n),[4,I(r,t)];case 2:return e.sent(),[4,K(r,{message:n.version,createTag:"v"+n.version})];case 3:return[2,e.sent()]}})})};var W=".makecode/blocks.png",G=".makecode/blocksdiff.png";function K(w,k){return void 0===k&&(k={}),C(this,void 0,void 0,function(){function t(s,l){return C(this,void 0,void 0,function(){var n,r,i,o,a;return S(this,function(e){switch(e.label){case 0:if(n={content:l,encoding:"utf-8"},s==pxt.CONFIG_NAME&&(n.content=$(n.content,!!k.createTag)),(r=/^data:([^;]+);base64,/.exec(l))&&(n.encoding="base64",n.content=l.substr(r[0].length)),i=A(n.content,n.encoding),(o=pxt.github.lookupFile(c.commit,s))&&o.sha==i)return[3,2];if("utf-8"==n.encoding&&pxt.github.hasMergeConflictMarker(n.content))throw(t=new Error("Merge conflict marker error")).isMergeConflictMarkerError=!0,t;return[4,pxt.github.createObjectAsync(u.fullName,"blob",n)];case 1:a=e.sent(),"utf-8"==n.encoding&&T.assert(a==i,"sha not matching "+a+" != "+i),p.tree.push({path:s,mode:"100644",type:"blob",sha:a,url:void 0}),e.label=2;case 2:return[2,a]}var t})})}var n,r,c,u,i,p,o,a,s,l,d,f,h,m,g,v,y,b,_;return S(this,function(e){switch(e.label){case 0:return[4,x.ensureGitHubTokenAsync()];case 1:return e.sent(),[4,O(w.id)];case 2:n=e.sent(),(r=n[H])||T.userError(lf("Not a git extension.")),c=JSON.parse(r),u=pxt.github.parseRepoId(c.repo),i=pxt.Package.parseAndValidConfig(n[pxt.CONFIG_NAME]),p={base_tree:c.commit.tree.sha,tree:[]},o=k.filenamesToCommit||pxt.allPkgFiles(i),a=[H,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE],s=0,l=o.filter(function(e){return a.indexOf(e)<0}),e.label=3;case 3:return s<l.length?(d=l[s],f=n[d],[4,t(d,f)]):[3,6];case 4:e.sent(),e.label=5;case 5:return s++,[3,3];case 6:return 0==p.tree.length&&T.userError(lf("Nothing to commit!")),k&&p.tree.find(function(e){return"main.blocks"==e.path})?k.blocksScreenshotAsync?[4,k.blocksScreenshotAsync()]:[3,9]:[3,12];case 7:return(m=e.sent())?[4,t(W,m)]:[3,9];case 8:e.sent(),e.label=9;case 9:return k.blocksDiffScreenshotAsync?[4,k.blocksDiffScreenshotAsync()]:[3,12];case 10:return(m=e.sent())?[4,t(G,m)]:[3,12];case 11:h=e.sent(),e.label=12;case 12:return[4,pxt.github.createObjectAsync(u.fullName,"tree",p)];case 13:return g=e.sent(),v={message:k.message||lf("Update {0}",p.tree.map(function(e){return e.path}).filter(function(e){return!/\.makecode\//.test(e)}).join(", ")),parents:[c.commit.sha],tree:g},[4,pxt.github.createObjectAsync(u.fullName,"commit",v)];case 14:return y=e.sent(),[4,pxt.github.fastForwardAsync(u.fullName,u.tag,y)];case 15:return b=e.sent(),_=y,b?[3,17]:[4,pxt.github.mergeAsync(u.fullName,u.tag,y)];case 16:_=e.sent(),e.label=17;case 17:return null!=_?[3,18]:[2,y];case 18:return h?[4,pxt.github.postCommitComment(u.fullName,y,"!["+lf("Difference between blocks")+"](https://raw.githubusercontent.com/"+u.fullName+"/"+y+"/"+G+")")]:[3,20];case 19:e.sent(),e.label=20;case 20:return[4,Y(w,{repo:c.repo,sha:_,files:n,saveTag:k.createTag})];case 21:return e.sent(),k.createTag?[4,pxt.github.createTagAsync(u.fullName,k.createTag,_)]:[3,23];case 22:e.sent(),e.label=23;case 23:return[2,""];case 24:return[2]}})})}function X(){var e=new Error("Merge error");return e.isMergeError=!0,e}function Y(x,E){return C(this,void 0,void 0,function(){var t,s,l,c,u,p,d,f,h,m,n,r,i,o,a,g,v,y,b,_,w,k=this;return S(this,function(e){switch(e.label){case 0:return t=E.repo,s=E.sha,l=E.files,c=E.justJSON,u=pxt.github.parseRepoId(t),[4,pxt.github.getCommitAsync(u.fullName,s)];case 1:return p=e.sent(),(d=JSON.parse(l[H]||"{}")).commit||(d={repo:t,commit:null}),h=0,m=!(f={}),n=function(a){return C(k,void 0,void 0,function(){var t,n,r,i,o;return S(this,function(e){switch(e.label){case 0:return f[a]=!0,t=pxt.github.lookupFile(p,a),n=pxt.github.lookupFile(d.commit,a),r=null!=l[a]&&(!n||n.blobContent!=l[a]),t?null!=(i=n?n.blobContent:l[a])&&A(i)==t.sha?(t.blobContent=i,E.tryDiff3||E.justJSON||(l[a]=i),[2,i]):[4,pxt.github.downloadTextAsync(u.fullName,s,a)]:E.tryDiff3&&r?[2,l[a]]:(c||(l[a]=""),[2,""]);case 1:if(i=e.sent(),A(t.blobContent=i)!=t.sha&&T.userError(lf("Corrupt SHA1 on download of '{0}'.",a)),E.tryDiff3&&r)if(a==pxt.CONFIG_NAME){if(!(i=pxt.github.mergeDiff3Config(l[a],n.blobContent,t.blobContent)))throw X()}else if(/\.blocks$/.test(a))o=pxt.blocks.mergeXml(l[a],n.blobContent,t.blobContent),m=m||!o,i=o||"";else{if(!(o=pxt.github.diff3(l[a],n.blobContent,t.blobContent,lf("local changes"),lf("remote changes (pulled from Github)"))))throw X();if(h+=o.numConflicts,o.numConflicts&&!/\.ts$/.test(a))throw X();i=o.merged}return c||(l[a]=i),[2,i]}})})},r=pxt.Package.parseAndValidConfig(l[pxt.CONFIG_NAME]),[4,n(pxt.CONFIG_NAME)];case 2:i=e.sent(),(o=pxt.Package.parseAndValidConfig(i))&&o.files.find(function(e){return/\.ts$/.test(e)})||(x&&T.userError(lf("Invalid pxt.json file.")),pxt.log("github: reconstructing pxt.json"),o=pxt.github.reconstructConfig(l,p,pxt.appTarget.blocksprj||pxt.appTarget.tsprj),l[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(o)),r&&(a=0,Object.keys(o.dependencies).filter(function(e){return/^github:/.test(o.dependencies[e])&&r.dependencies[e]}).forEach(function(e){if(pxt.github.parseRepoId(o.dependencies[e])){var t=r.dependencies[e];o.dependencies[e]=t,a++}}),a&&(l[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(o))),g=0,v=pxt.allPkgFiles(o).slice(1),e.label=3;case 3:return g<v.length?(y=v[g],[4,n(y)]):[3,6];case 4:e.sent(),e.label=5;case 5:return g++,[3,3];case 6:if(o.name||(o.name=(u.project||u.fullName).replace(/[^\w\-]/g,""),c||(l[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(o))),!c){if(m&&h)throw X();for(b=0,_=Object.keys(l);b<_.length;b++)"."==(w=_[b])[0]||f[w]||delete l[w]}return p.tag=E.saveTag,d.commit=p,l[H]=JSON.stringify(d,null,4),x?[3,8]:[4,L({name:o.name,githubId:t,pubId:"",pubCurrent:!1,meta:{},editor:pxt.BLOCKS_PROJECT_NAME,target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target},l)];case 7:return x=e.sent(),[3,10];case 8:return x.name=o.name,[4,I(x,l)];case 9:e.sent(),e.label=10;case 10:return[2,x]}})})}function J(p,d){return C(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c,u;return S(this,function(e){switch(e.label){case 0:if(p.githubCurrent=!1,t=JSON.parse(d[H]||"{}"),p.githubId=t&&t.repo,p.githubTag=t&&t.commit&&t.commit.tag,!p.githubId)return[2];if(!t.commit||!t.commit.tree)return[2];for(r=!(n=!0),i=0,o=Object.keys(d);i<o.length;i++)(a=o[i])!=H&&a!=pxt.SIMSTATE_JSON&&a!=pxt.SERIAL_EDITOR_FILE&&((s=pxt.github.lookupFile(t.commit,a))&&"blob"==s.type?(null==s.blobContent&&(r=!0),l=d[a],a==pxt.CONFIG_NAME&&(l=$(l)),l&&s.sha!=A(l)&&(n=!1)):n=!1);return p.githubCurrent=n,r?[4,Y(p,{repo:t.repo,sha:t.commit.sha,files:d,justJSON:!0})]:[3,2];case 1:e.sent(),e.label=2;case 2:return null!=t.isFork?[3,5]:(c=pxt.github.parseRepoId(t.repo),[4,pxt.github.repoAsync(c.fullName,null)]);case 3:return u=e.sent(),t.isFork=!!u.fork,d[H]=JSON.stringify(t,null,4),[4,I(p,d)];case 4:e.sent(),e.label=5;case 5:return[2]}})})}function $(e,o){var a=pxt.Package.parseAndValidConfig(e);if(!a)return e;delete a.installedVersion,delete a.additionalFilePath,delete a.additionalFilePaths,delete a.targetVersions;for(var t=0,n=Object.keys(a.dependencies).filter(function(e){return/^(file|workspace):/.test(a.dependencies[e])});t<n.length;t++)r(n[t]);return pxt.Package.stringifyConfig(a);function r(e){var t=a.dependencies[e],n=k(t.substring(t.indexOf(":")+1));if(n.githubId){var r=pxt.github.parseRepoId(n.githubId);o&&!/^v\d+/.test(n.githubTag)&&T.userError(lf("You need to create a release for dependency {0}.",e));var i=n.githubTag||r.tag;a.dependencies[e]="github:"+r.fullName+"#"+i}else o&&T.userError(lf("Dependency {0} is a local project.",e))}}function Q(p,d,f){return C(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c,u;return S(this,function(e){switch(e.label){case 0:return[4,x.ensureGitHubTokenAsync()];case 1:return e.sent(),t=pxt.github.parseRepoId(d),n=t.fullName.replace(/.*\//,""),[4,O(p.id)];case 2:return r=e.sent(),i=pxt.template.packageFiles(n),pxt.template.packageFilesFixup(i,{repo:t.fullName}),f?T.jsonMergeFrom(r,i):(pxt.Package.parseAndValidConfig(r[pxt.CONFIG_NAME])||delete r[pxt.CONFIG_NAME],o=i["README.md"],r["README.md"]&&r["README.md"].trim()&&(o=void 0),T.jsonMergeFrom(i,r),r=i,o&&(r["README.md"]=o)),a=pxt.Package.parseAndValidConfig(r[pxt.CONFIG_NAME]),(s=a.files).filter(function(e){return/\.ts$/.test(e)}).length||Object.keys(r).filter(function(e){return/\.(blocks|ts|py|asm|md)$/.test(e)}).filter(function(e){return e!=pxt.CONFIG_NAME}).forEach(function(e){return s.push(e)}),l=a.testFiles||(a.testFiles=[]),r["test.ts"]&&l.indexOf("test.ts")<0&&l.push("test.ts"),r[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(a),[4,I(p,r)];case 3:return e.sent(),[4,K(p,{message:lf("Initial files for MakeCode project"),filenamesToCommit:Object.keys(r)})];case 4:return e.sent(),[4,O(p.id)];case 5:return r=e.sent(),c=pxt.allPkgFiles(pxt.Package.parseAndValidConfig(r[pxt.CONFIG_NAME])),u=[H,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE,pxt.CONFIG_NAME],Object.keys(r).filter(function(e){return u.indexOf(e)<0&&c.indexOf(e)<0}).forEach(function(e){return delete r[e]}),[4,I(p,r)];case 6:return e.sent(),[2,p]}})})}function Z(){return N(),a.listAsync().catch(function(e){return pxt.tickEvent("workspace.syncerror",{ws:r}),pxt.log("Workspace error, switching to memory workspace"),(a=p.provider).listAsync()}).then(function(e){var t=T.toDictionary(v||[],function(e){return e.header.id});v=[];for(var n=0,r=e;n<r.length;n++){var i=r[n],o=t[i.id];o?T.jsonCopyFrom(o.header,i):o={header:i,text:void 0,version:void 0},v.push(o)}s.invalidate("header:"),s.invalidate("text:"),s.invalidate("pkg-git-status:"),x.syncAsync().done()}).then(function(){return a.getSyncState?a.getSyncState():null})}function ee(){return a===l.provider}n.commitAsync=K,n.exportToGithubAsync=function(a,s){return C(this,void 0,void 0,function(){var t,n,r,i,o;return S(this,function(e){switch(e.label){case 0:return t=pxt.github.parseRepoId(s),n=pxt.template.packageFiles(a.name),[4,pxt.github.putFileAsync(t.fullName,".gitignore",n[".gitignore"])];case 1:return e.sent(),[4,pxt.github.getRefAsync(t.fullName,t.tag)];case 2:return r=e.sent(),[4,pxt.github.getCommitAsync(t.fullName,r)];case 3:return i=e.sent(),[4,O(a.id)];case 4:return(o=e.sent())[H]=JSON.stringify({repo:s,commit:i}),[4,I(a,o)];case 5:return e.sent(),[4,Q(a,s,!1)];case 6:return e.sent(),[2]}})})},n.recomputeHeaderFlagsAsync=J,n.prepareConfigForGithub=$,n.initializeGithubRepoAsync=Q,n.importGithubAsync=function(l){return C(this,void 0,void 0,function(){var t,n,r,i,o,a,s;return S(this,function(e){switch(e.label){case 0:t=pxt.github.normalizeRepoId(l).replace(/^github:/,""),n=pxt.github.parseRepoId(t),r="",o=i=!1,e.label=1;case 1:return e.trys.push([1,6,,12]),[4,pxt.github.getRefAsync(n.fullName,n.tag)];case 2:return r=e.sent(),[4,pxt.github.getCommitAsync(n.fullName,r)];case 3:return e.sent().tree.tree.find(function(e){return e.path==pxt.CONFIG_NAME})?[3,5]:(pxt.log("github: detected import non-makecode project"),o=!(i=!0),[4,c.confirmAsync({header:lf("Initialize repository for MakeCode?"),body:lf("We need to add a few files to your repository to make it work with MakeCode.")+" "+lf("Your existing files will not be modified."),agreeLbl:lf("Ok")})]);case 4:if(!e.sent())return[2,Promise.resolve(void 0)];e.label=5;case 5:return[3,12];case 6:return 409!=(a=e.sent()).statusCode?[3,10]:(pxt.log("github: detected import empty project"),[4,x.ensureGitHubTokenAsync()]);case 7:return e.sent(),[4,pxt.github.putFileAsync(n.fullName,".gitignore","# Initial\n")];case 8:return e.sent(),o=i=!0,[4,pxt.github.getRefAsync(n.fullName,n.tag)];case 9:return r=e.sent(),[3,11];case 10:404==a.statusCode&&(c.errorNotification(lf("Sorry, that repository looks invalid.")),T.userError(lf("No such repository or branch."))),e.label=11;case 11:return[3,12];case 12:return[4,Y(null,{repo:t,sha:r,files:{}})];case 13:return(s=e.sent())&&i?[4,Q(s,t,o)]:[3,15];case 14:e.sent(),e.label=15;case 15:return[2,s]}})})},n.downloadFilesByIdAsync=function(e){return m.privateGetAsync(e,!0).then(function(e){return q(e.id)})},n.installByIdAsync=function(n){return m.privateGetAsync(n,!0).then(function(t){return q(t.id).then(function(e){return L({name:t.name,pubId:n,pubCurrent:!0,meta:t.meta,editor:t.editor,target:t.target,targetVersion:t.targetVersion||t.meta&&t.meta.versions&&t.meta.versions.target},e)})})},n.saveToCloudAsync=function(e){return N(),x.saveToCloudAsync(e)},n.resetCloudAsync=function(){return N(),x.resetAsync().then(function(){return Promise.all(v.map(function(e){return e.header}).filter(function(e){return e.cloudSync||e.githubId}).map(function(e){return e.isDeleted=!0,e.blobVersion="DELETED",I(e,null,!0)}))}).then(function(){return s.invalidate("header:*")})},n.syncAsync=Z,n.resetAsync=function(){return N(),v=[],a.resetAsync().then(x.resetAsync).then(o.destroyAsync).then(function(){pxt.storage.clearLocal(),s.clearCache(),m.localToken&&pxt.storage.setLocal("local_token",m.localToken)})},n.loadedAsync=function(){return N(),a.loadedAsync?a.loadedAsync():Promise.resolve()},n.saveAssetAsync=function(e,t,n){return a.saveAssetAsync?a.saveAssetAsync(e,t,n):Promise.reject(new Error(lf("Assets not supported here.")))},n.listAssetsAsync=function(e){return a.listAssetsAsync?a.listAssetsAsync(e):Promise.resolve([])},n.isBrowserWorkspace=ee,n.fireEvent=function(e){if(a.fireEvent)return a.fireEvent(e)},s.mountVirtualApi("header",{getSync:function(e){return"*"==(e=s.stripProtocol(e))?_():k(e)}}),s.mountVirtualApi("headers",{getAsync:function(e){e=s.stripProtocol(e);var n=_();return e?h.projectSearchAsync({term:e,headers:n}).then(function(e){return e}).then(function(e){var t=T.toDictionary(e||[],function(e){return e.id});return n.filter(function(e){return t[e.id]})}):Promise.resolve(n)},expirationTime:function(e){return 5e3},onInvalidated:function(){h.projectSearchClear()}}),s.mountVirtualApi("text",{getAsync:function(e){var t=/^[\w\-]+:([^\/]+)(\/(.*))?/.exec(e);return O(t[1]).then(function(e){return t[3]?e[t[3]]:e})}})},{"./browserworkspace":8,"./cloudsync":11,"./compiler":14,"./core":41,"./data":44,"./db":45,"./fileworkspace":59,"./idbworkspace":67,"./iframeworkspace":68,"./memoryworkspace":72,"crypto-js/sha1":121}],106:[function(e,t,n){t.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},{}],107:[function(e,t,n){function r(){return t.exports=r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}t.exports=r},{}],108:[function(e,t,n){t.exports=function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}},{}],109:[function(e,t,n){t.exports=function(e){return e&&e.__esModule?e:{default:e}}},{}],110:[function(e,t,n){var a=e("../helpers/typeof");function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}t.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}},{"../helpers/typeof":112}],111:[function(e,t,n){t.exports=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],0<=t.indexOf(n)||(i[n]=e[n]);return i}},{}],112:[function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return"function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?t.exports=i=function(e){return r(e)}:t.exports=i=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)},i(e)}t.exports=i},{}],113:[function(e,t,n){"use strict";t.exports=function(r){return function(){var e=arguments.length;if(e){for(var t=[],n=-1;++n<e;)t[n]=arguments[n];return r.call(this,t)}return r.call(this,[])}}},{}],114:[function(e,t,n){"use strict";n.byteLength=function(e){var t=f(e),n=t[0],r=t[1];return 3*(n+r)/4-r},n.toByteArray=function(e){var t,n,r=f(e),i=r[0],o=r[1],a=new d((c=i,u=o,3*(c+u)/4-u)),s=0,l=0<o?i-4:i;var c,u;for(n=0;n<l;n+=4)t=p[e.charCodeAt(n)]<<18|p[e.charCodeAt(n+1)]<<12|p[e.charCodeAt(n+2)]<<6|p[e.charCodeAt(n+3)],a[s++]=t>>16&255,a[s++]=t>>8&255,a[s++]=255&t;return 2===o&&(t=p[e.charCodeAt(n)]<<2|p[e.charCodeAt(n+1)]>>4,a[s++]=255&t),1===o&&(t=p[e.charCodeAt(n)]<<10|p[e.charCodeAt(n+1)]<<4|p[e.charCodeAt(n+2)]>>2,a[s++]=t>>8&255,a[s++]=255&t),a},n.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i=[],o=0,a=n-r;o<a;o+=16383)i.push(l(e,o,a<o+16383?a:o+16383));return 1===r?(t=e[n-1],i.push(s[t>>2]+s[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"=")),i.join("")};for(var s=[],p=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=r.length;i<o;++i)s[i]=r[i],p[r.charCodeAt(i)]=i;function f(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(s[(a=r)>>18&63]+s[a>>12&63]+s[a>>6&63]+s[63&a]);var a;return i.join("")}p["-".charCodeAt(0)]=62,p["_".charCodeAt(0)]=63},{}],115:[function(e,n,r){(function($,C,f){!function(e){if("object"==typeof r&&void 0!==n)n.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:void 0!==C?t=C:"undefined"!=typeof self&&(t=self),t.Promise=e()}}(function(){return function o(a,s,l){function c(t,e){if(!s[t]){if(!a[t]){var n="function"==typeof _dereq_&&_dereq_;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[t]={exports:{}};a[t][0].call(i.exports,function(e){return c(a[t][1][e]||e)},i,i.exports,o,a,s,l)}return s[t].exports}for(var u="function"==typeof _dereq_&&_dereq_,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){"use strict";t.exports=function(e){var r=e._SomePromiseArray;function t(e){var t=new r(e),n=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),n}e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,n){"use strict";var r;try{throw new Error}catch(e){r=e}var i=e("./schedule"),o=e("./queue"),a=e("./util");function s(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new o(16),this._normalQueue=new o(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=i}function l(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function c(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function u(e){this._normalQueue._pushOne(e),this._queueTick()}s.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},s.prototype.hasCustomScheduler=function(){return this._customScheduler},s.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},s.prototype.disableTrampolineIfNecessary=function(){a.hasDevTools&&(this._trampolineEnabled=!1)},s.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},s.prototype.fatalError=function(e,t){t?($.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),$.exit(2)):this.throwLater(e)},s.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},a.hasDevTools?(s.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?l.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},s.prototype.invoke=function(e,t,n){this._trampolineEnabled?c.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},s.prototype.settlePromises=function(e){this._trampolineEnabled?u.call(this,e):this._schedule(function(){e._settlePromises()})}):(s.prototype.invokeLater=l,s.prototype.invoke=c,s.prototype.settlePromises=u),s.prototype._drainQueue=function(e){for(;0<e.length();){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},s.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},s.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},s.prototype._reset=function(){this._isTickUsed=!1},t.exports=s,t.exports.firstLineError=r},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,n){"use strict";t.exports=function(o,a,s,l){var c=!1,n=function(e,t){this._reject(t)},u=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(n,n,null,this,e)},p=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},d=function(e,t){t.promiseRejectionQueued||this._reject(e)};o.prototype.bind=function(e){c||(c=!0,o.prototype._propagateFrom=l.propagateFromFunction(),o.prototype._boundValue=l.boundValueFunction());var t=s(e),n=new o(a);n._propagateFrom(this,1);var r=this._target();if(n._setBoundTo(t),t instanceof o){var i={promiseRejectionQueued:!1,promise:n,target:r,bindingPromise:t};r._then(a,u,void 0,n,i),t._then(p,d,void 0,n,i),n._setOnCancel(t)}else n._resolveCallback(r);return n},o.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},o.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},o.bind=function(e,t){return o.resolve(t).bind(e)}}},{}],4:[function(e,t,n){"use strict";var r;"undefined"!=typeof Promise&&(r=Promise);var i=e("./promise")();i.noConflict=function(){try{Promise===i&&(Promise=r)}catch(e){}return i},t.exports=i},{"./promise":22}],5:[function(e,t,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(i){var o=e("./util"),r=o.canEvaluate;function n(e){return function(e,t){var n;if(null!=e&&(n=e[t]),"function"!=typeof n){var r="Object "+o.classString(e)+" has no method '"+o.toString(t)+"'";throw new i.TypeError(r)}return n}(e,this.pop()).apply(e,this)}function a(e){return e[this]}function s(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}o.isIdentifier,i.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(n,void 0,void 0,t,void 0)},i.prototype.get=function(e){var t;if("number"==typeof e)t=s;else if(r){var n=(void 0)(e);t=null!==n?n:a}else t=a;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(l,e,t){"use strict";e.exports=function(e,t,n,r){var i=l("./util"),o=i.tryCatch,a=i.errorObj,s=e._async;e.prototype.break=e.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),s.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){0<this._length()&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(e,t){if(i.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=o(e).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),s.throwLater(r.e))}}else e._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),s.invoke(this._doInvokeOnCancel,this,e)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){"use strict";t.exports=function(p){var d=e("./util"),f=e("./es5").keys,h=d.tryCatch,m=d.errorObj;return function(l,c,u){return function(e){var t=u._boundValue();e:for(var n=0;n<l.length;++n){var r=l[n];if(r===Error||null!=r&&r.prototype instanceof Error){if(e instanceof r)return h(c).call(t,e)}else if("function"==typeof r){var i=h(r).call(t,e);if(i===m)return i;if(i)return h(c).call(t,e)}else if(d.isObject(e)){for(var o=f(r),a=0;a<o.length;++a){var s=o[a];if(r[s]!=e[s])continue e}return h(c).call(t,e)}}return p}}}},{"./es5":13,"./util":36}],8:[function(e,t,n){"use strict";t.exports=function(o){var a=!1,n=[];function s(){this._trace=new s.CapturedTrace(l())}function l(){var e=n.length-1;if(0<=e)return n[e]}return o.prototype._promiseCreated=function(){},o.prototype._pushContext=function(){},o.prototype._popContext=function(){return null},o._peekContext=o.prototype._peekContext=function(){},s.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,n.push(this._trace))},s.prototype._popContext=function(){if(void 0!==this._trace){var e=n.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},s.CapturedTrace=null,s.create=function(){if(a)return new s},s.deactivateLongStackTraces=function(){},s.activateLongStackTraces=function(){var e=o.prototype._pushContext,t=o.prototype._popContext,n=o._peekContext,r=o.prototype._peekContext,i=o.prototype._promiseCreated;s.deactivateLongStackTraces=function(){o.prototype._pushContext=e,o.prototype._popContext=t,o._peekContext=n,o.prototype._peekContext=r,o.prototype._promiseCreated=i,a=!1},a=!0,o.prototype._pushContext=s.prototype._pushContext,o.prototype._popContext=s.prototype._popContext,o._peekContext=o.prototype._peekContext=l,o.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},s}},{}],9:[function(J,e,t){"use strict";e.exports=function(a,n){var r,i,o,s=a._getDomain,l=a._async,c=J("./errors").Warning,u=J("./util"),p=u.canAttachTrace,d=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,h=/\((?:timers\.js):\d+:\d+\)/,m=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,f=null,g=null,v=!1,e=!(0==u.env("BLUEBIRD_DEBUG")),t=!(0==u.env("BLUEBIRD_WARNINGS")||!e&&!u.env("BLUEBIRD_WARNINGS")),y=!(0==u.env("BLUEBIRD_LONG_STACK_TRACES")||!e&&!u.env("BLUEBIRD_LONG_STACK_TRACES")),b=0!=u.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(t||!!u.env("BLUEBIRD_W_FORGOTTEN_RETURN"));a.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},a.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var e=this;setTimeout(function(){e._notifyUnhandledRejection()},1)}},a.prototype._notifyUnhandledRejectionIsHandled=function(){q("rejectionHandled",r,void 0,this)},a.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},a.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},a.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),q("unhandledRejection",i,e,this)}},a.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},a.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},a.prototype._isUnhandledRejectionNotified=function(){return 0<(262144&this._bitField)},a.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},a.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},a.prototype._isRejectionUnhandled=function(){return 0<(1048576&this._bitField)},a.prototype._warn=function(e,t,n){return B(e,t,n||this)},a.onPossiblyUnhandledRejection=function(e){var t=s();i="function"==typeof e?null===t?e:u.domainBind(t,e):void 0},a.onUnhandledRejectionHandled=function(e){var t=s();r="function"==typeof e?null===t?e:u.domainBind(t,e):void 0};var _=function(){};a.longStackTraces=function(){if(l.haveItemsQueued()&&!Y.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!Y.longStackTraces&&z()){var e=a.prototype._captureStackTrace,t=a.prototype._attachExtraTrace;Y.longStackTraces=!0,_=function(){if(l.haveItemsQueued()&&!Y.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");a.prototype._captureStackTrace=e,a.prototype._attachExtraTrace=t,n.deactivateLongStackTraces(),l.enableTrampoline(),Y.longStackTraces=!1},a.prototype._captureStackTrace=R,a.prototype._attachExtraTrace=j,n.activateLongStackTraces(),l.disableTrampolineIfNecessary()}},a.hasLongStackTraces=function(){return Y.longStackTraces&&z()};var w=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return u.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!u.global.dispatchEvent(n)}}return"function"==typeof Event?(e=new Event("CustomEvent"),u.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!u.global.dispatchEvent(n)}):((e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),u.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!u.global.dispatchEvent(n)})}catch(e){}return function(){return!1}}(),k=u.isNode?function(){return $.emit.apply($,arguments)}:u.global?function(e){var t="on"+e.toLowerCase(),n=u.global[t];return!!n&&(n.apply(u.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function x(e,t){return{promise:t}}var E={promiseCreated:x,promiseFulfilled:x,promiseRejected:x,promiseResolved:x,promiseCancelled:x,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:x},C=function(e){var t=!1;try{t=k.apply(null,arguments)}catch(e){l.throwLater(e),t=!0}var n=!1;try{n=w(e,E[e].apply(null,arguments))}catch(e){l.throwLater(e),n=!0}return n||t};function S(){return!1}function T(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+u.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function A(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?u.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function N(){return this._onCancelField}function O(e){this._onCancelField=e}function P(){this._cancellationParent=void 0,this._onCancelField=void 0}function I(e,t){if(0!=(1&t)){var n=(this._cancellationParent=e)._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}a.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?a.longStackTraces():!e.longStackTraces&&a.hasLongStackTraces()&&_()),"warnings"in e){var t=e.warnings;Y.warnings=!!t,b=Y.warnings,u.isObject(t)&&"wForgottenReturn"in t&&(b=!!t.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!Y.cancellation){if(l.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");a.prototype._clearCancellationData=P,a.prototype._propagateFrom=I,a.prototype._onCancel=N,a.prototype._setOnCancel=O,a.prototype._attachCancellationCallback=A,a.prototype._execute=T,D=I,Y.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!Y.monitoring?(Y.monitoring=!0,a.prototype._fireEvent=C):!e.monitoring&&Y.monitoring&&(Y.monitoring=!1,a.prototype._fireEvent=S)),a},a.prototype._fireEvent=S,a.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},a.prototype._onCancel=function(){},a.prototype._setOnCancel=function(e){},a.prototype._attachCancellationCallback=function(e){},a.prototype._captureStackTrace=function(){},a.prototype._attachExtraTrace=function(){},a.prototype._clearCancellationData=function(){},a.prototype._propagateFrom=function(e,t){};var D=function(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)};function L(){var e=this._boundTo;return void 0!==e&&e instanceof a?e.isFulfilled()?e.value():void 0:e}function R(){this._trace=new K(this._peekContext())}function j(e,t){if(p(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=F(e);u.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),u.notEnumerableProp(e,"__stackCleaned__",!0)}}}function B(e,t,n){if(Y.warnings){var r,i=new c(e);if(t)n._attachExtraTrace(i);else if(Y.longStackTraces&&(r=a._peekContext()))r.attachExtraTrace(i);else{var o=F(i);i.stack=o.message+"\n"+o.stack.join("\n")}C("warning",i)||U(i,"",!0)}}function M(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||f.test(r),o=i&&V(r);i&&!o&&(v&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function F(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&0<t.length?function(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||f.test(r))break}return 0<n&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:M(t)}}function U(e,t,n){if("undefined"!=typeof console){var r;if(u.isObject(e)){var i=e.stack;r=t+g(i,e)}else r=t+String(e);"function"==typeof o?o(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function q(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){l.throwLater(e)}"unhandledRejection"===e?C(e,n,r)||i||U(n,"Unhandled rejection "):C(e,r)}function H(e){var t,n;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():u.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+((n=t).length<41?n:n.substr(0,38)+"...")+">, no stack trace)"}function z(){return"function"==typeof X}var V=function(){return!1},W=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function G(e){var t=e.match(W);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function K(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);X(this,K),32<t&&this.uncycle()}u.inherits(K,Error),(n.CapturedTrace=K).prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;for(r=(e=this._length=r)-1;0<=r;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<e;++r){var a=n[t[r].stack];if(void 0!==a&&a!==r){0<a&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var s=0<r?t[r-1]:this;a<e-1?(s._parent=t[a+1],s._parent.uncycle(),s._length=s._parent._length+1):(s._parent=void 0,s._length=1);for(var l=s._length+1,c=r-2;0<=c;--c)t[c]._length=l,l++;return}}}},K.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=F(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(M(i.stack.split("\n"))),i=i._parent;!function(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],a=-1,s=r.length-1;0<=s;--s)if(r[s]===o){a=s;break}for(s=a;0<=s;--s){var l=r[s];if(t[i]!==l)break;t.pop(),i--}t=r}}(r),function(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}(r),u.notEnumerableProp(e,"stack",function(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}(n,r)),u.notEnumerableProp(e,"__stackCleaned__",!0)}};var X=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():H(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,f=e,g=t;var n=Error.captureStackTrace;return V=function(e){return d.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r,i=new Error;if("string"==typeof i.stack&&0<=i.stack.split("\n")[0].indexOf("stackDetection@"))return f=/@/,g=t,v=!0,function(e){e.stack=(new Error).stack};try{throw new Error}catch(e){r="stack"in e}return"stack"in i||!r||"number"!=typeof Error.stackTraceLimit?(g=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?H(t):t.toString()},null):(f=e,g=t,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(o=function(e){console.warn(e)},u.isNode&&$.stderr.isTTY?o=function(e,t){var n=t?"[33m":"[31m";console.warn(n+e+"[0m\n")}:u.isNode||"string"!=typeof(new Error).stack||(o=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var Y={warnings:t,longStackTraces:!1,cancellation:!1,monitoring:!1};return y&&a.longStackTraces(),{longStackTraces:function(){return Y.longStackTraces},warnings:function(){return Y.warnings},cancellation:function(){return Y.cancellation},monitoring:function(){return Y.monitoring},propagateFromFunction:function(){return D},boundValueFunction:function(){return L},checkForgottenReturns:function(e,t,n,r,i){if(void 0===e&&null!==t&&b){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",a="";if(t._trace){for(var s=t._trace.stack.split("\n"),l=M(s),c=l.length-1;0<=c;--c){var u=l[c];if(!h.test(u)){var p=u.match(m);p&&(o="at "+p[1]+":"+p[2]+":"+p[3]+" ");break}}if(0<l.length){var d=l[0];for(c=0;c<s.length;++c)if(s[c]===d){0<c&&(a="\n"+s[c-1]);break}}}var f="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+a;r._warn(f,!0,t)}},setBounds:function(e,t){if(z()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),a=-1,s=-1,l=0;l<i.length;++l)if(c=G(i[l])){n=c.fileName,a=c.line;break}for(l=0;l<o.length;++l){var c;if(c=G(o[l])){r=c.fileName,s=c.line;break}}a<0||s<0||!n||!r||n!==r||s<=a||(V=function(e){if(d.test(e))return!0;var t=G(e);return!!(t&&t.fileName===n&&a<=t.line&&t.line<=s)})}},warn:B,deprecated:function(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),B(n)},CapturedTrace:K,fireDomEvent:w,fireGlobalEvent:k}}},{"./errors":12,"./util":36}],10:[function(e,t,n){"use strict";t.exports=function(n){function r(){return this.value}function i(){throw this.reason}n.prototype.return=n.prototype.thenReturn=function(e){return e instanceof n&&e.suppressUnhandledRejections(),this._then(r,void 0,void 0,{value:e},void 0)},n.prototype.throw=n.prototype.thenThrow=function(e){return this._then(i,void 0,void 0,{reason:e},void 0)},n.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:e},void 0);var t=arguments[1];return this.caught(e,function(){throw t})},n.prototype.catchReturn=function(e){if(arguments.length<=1)return e instanceof n&&e.suppressUnhandledRejections(),this._then(void 0,r,void 0,{value:e},void 0);var t=arguments[1];return t instanceof n&&t.suppressUnhandledRejections(),this.caught(e,function(){return t})}}},{}],11:[function(e,t,n){"use strict";t.exports=function(e,n){var r=e.reduce,t=e.all;function i(){return t(this)}e.prototype.each=function(e){return r(this,e,n,0)._then(i,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return r(this,e,n,n)},e.each=function(e,t){return r(e,t,n,0)._then(i,void 0,void 0,e,void 0)},e.mapSeries=function(e,t){return r(e,t,n,n)}}},{}],12:[function(e,t,n){"use strict";var r,i,o=e("./es5"),a=o.freeze,s=e("./util"),l=s.inherits,c=s.notEnumerableProp;function u(t,n){function r(e){if(!(this instanceof r))return new r(e);c(this,"message","string"==typeof e?e:n),c(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(r,Error),r}var p=u("Warning","warning"),d=u("CancellationError","cancellation error"),f=u("TimeoutError","timeout error"),h=u("AggregateError","aggregate error");try{r=TypeError,i=RangeError}catch(e){r=u("TypeError","type error"),i=u("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),g=0;g<m.length;++g)"function"==typeof Array.prototype[m[g]]&&(h.prototype[m[g]]=Array.prototype[m[g]]);o.defineProperty(h.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),h.prototype.isOperational=!0;var v=0;function y(e){if(!(this instanceof y))return new y(e);c(this,"name","OperationalError"),c(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(c(this,"message",e.message),c(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}h.prototype.toString=function(){var e=Array(4*v+1).join(" "),t="\n"+e+"AggregateError of:\n";v++,e=Array(4*v+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];t+=(r=i.join("\n"))+"\n"}return v--,t},l(y,Error);var b=Error.__BluebirdErrorTypes__;b||(b=a({CancellationError:d,TimeoutError:f,OperationalError:y,RejectionError:y,AggregateError:h}),o.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:r,RangeError:i,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:p}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,a={}.constructor.prototype,s=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t};t.exports={isArray:function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}},keys:s,names:s,defineProperty:function(e,t,n){return e[t]=n.value,e},getDescriptor:function(e,t){return{value:e[t]}},freeze:function(e){return e},getPrototypeOf:function(e){try{return Object(e).constructor.prototype}catch(e){return a}},isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,n){"use strict";t.exports=function(e,r){var i=e.map;e.prototype.filter=function(e,t){return i(this,e,t,r)},e.filter=function(e,t,n){return i(e,t,n,r)}}},{}],15:[function(e,t,n){"use strict";t.exports=function(s,a,l){var c=e("./util"),u=s.CancellationError,p=c.errorObj,d=e("./catch_filter")(l);function i(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function f(e){this.finallyHandler=e}function h(e,t){return null!=e.cancelPromise&&(1<arguments.length?e.cancelPromise._reject(t):e.cancelPromise._cancel(),!(e.cancelPromise=null))}function m(){return v.call(this,this.promise._target()._settledValue())}function g(e){if(!h(this,e))return p.e=e,p}function v(e){var t=this.promise,n=this.handler;if(!this.called){this.called=!0;var r=this.isFinallyHandler()?n.call(t._boundValue()):n.call(t._boundValue(),e);if(r===l)return r;if(void 0!==r){t._setReturnedNonUndefined();var i=a(r,t);if(i instanceof s){if(null!=this.cancelPromise){if(i._isCancelled()){var o=new u("late cancellation observer");return t._attachExtraTrace(o),p.e=o,p}i.isPending()&&i._attachCancellationCallback(new f(this))}return i._then(m,g,void 0,this,void 0)}}}return t.isRejected()?(h(this),p.e=e,p):(h(this),e)}return i.prototype.isFinallyHandler=function(){return 0===this.type},f.prototype._resultCancelled=function(){h(this.finallyHandler)},s.prototype._passThrough=function(e,t,n,r){return"function"!=typeof e?this.then():this._then(n,r,void 0,new i(this,t,e),void 0)},s.prototype.lastly=s.prototype.finally=function(e){return this._passThrough(e,0,v,v)},s.prototype.tap=function(e){return this._passThrough(e,1,v)},s.prototype.tapCatch=function(e){var t=arguments.length;if(1===t)return this._passThrough(e,1,void 0,v);var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!c.isObject(o))return s.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+c.classString(o)));r[i++]=o}r.length=i;var a=arguments[n];return this._passThrough(d(r,a,this),1,void 0,v)},i}},{"./catch_filter":7,"./util":36}],16:[function(n,e,t){"use strict";e.exports=function(s,r,a,l,e,c){var u=n("./errors").TypeError,t=n("./util"),p=t.errorObj,d=t.tryCatch,f=[];function h(e,t,n,r){if(c.cancellation()){var i=new s(a),o=this._finallyPromise=new s(a);this._promise=i.lastly(function(){return o}),i._captureStackTrace(),i._setOnCancel(this)}else(this._promise=new s(a))._captureStackTrace();this._stack=r,this._generatorFunction=e,this._receiver=t,this._generator=void 0,this._yieldHandlers="function"==typeof n?[n].concat(f):f,this._yieldedPromise=null,this._cancellationPhase=!1}t.inherits(h,e),h.prototype._isResolved=function(){return null===this._promise},h.prototype._cleanup=function(){this._promise=this._generator=null,c.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},h.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=d(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var t=new s.CancellationError("generator .return() sentinel");s.coroutine.returnSentinel=t,this._promise._attachExtraTrace(t),this._promise._pushContext(),e=d(this._generator.throw).call(this._generator,t),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},h.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=d(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},h.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=d(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},h.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof s){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},h.prototype.promise=function(){return this._promise},h.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},h.prototype._continue=function(e){var t=this._promise;if(e===p)return this._cleanup(),this._cancellationPhase?t.cancel():t._rejectCallback(e.e,!1);var n=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?t.cancel():t._resolveCallback(n);var r=l(n,this._promise);if(r instanceof s||null!==(r=function(e,t,n){for(var r=0;r<t.length;++r){n._pushContext();var i=d(t[r])(e);if(n._popContext(),i===p){n._pushContext();var o=s.reject(p.e);return n._popContext(),o}var a=l(i,n);if(a instanceof s)return a}return null}(r,this._yieldHandlers,this._promise))){var i=(r=r._target())._bitField;0==(50397184&i)?(this._yieldedPromise=r)._proxy(this,null):0!=(33554432&i)?s._async.invoke(this._promiseFulfilled,this,r._value()):0!=(16777216&i)?s._async.invoke(this._promiseRejected,this,r._reason()):this._promiseCancelled()}else this._promiseRejected(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},s.coroutine=function(r,e){if("function"!=typeof r)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(e).yieldHandler,o=h,a=(new Error).stack;return function(){var e=r.apply(this,arguments),t=new o(void 0,void 0,i,a),n=t.promise();return t._generator=e,t._promiseFulfilled(void 0),n}},s.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new u("expecting a function but got "+t.classString(e));f.push(e)},s.spawn=function(e){if(c.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return r("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var t=new h(e,this),n=t.promise();return t._run(s.spawn),n}}},{"./errors":12,"./util":36}],17:[function(s,e,t){"use strict";e.exports=function(e,i,t,n,r,o){var a=s("./util");a.canEvaluate,a.tryCatch,a.errorObj,e.join=function(){var e,t=arguments.length-1;0<t&&"function"==typeof arguments[t]&&(e=arguments[t]);var n=[].slice.call(arguments);e&&n.pop();var r=new i(n).promise();return void 0!==e?r.spread(e):r}}},{"./util":36}],18:[function(t,e,n){"use strict";e.exports=function(f,e,o,h,a,m){var s=f._getDomain,l=t("./util"),g=l.tryCatch,v=l.errorObj,c=f._async;function u(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var i=s();this._callback=null===i?t:l.domainBind(i,t),this._preservedValues=r===a?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],c.invoke(this._asyncInit,this,void 0)}function i(e,t,n,r){if("function"!=typeof t)return o("expecting a function but got "+l.classString(t));var i=0;if(void 0!==n){if("object"!=typeof n||null===n)return f.reject(new TypeError("options argument must be an object but it is "+l.classString(n)));if("number"!=typeof n.concurrency)return f.reject(new TypeError("'concurrency' must be a number but it is "+l.classString(n.concurrency)));i=n.concurrency}return new u(e,t,i="number"==typeof i&&isFinite(i)&&1<=i?i:0,r).promise()}l.inherits(u,e),u.prototype._asyncInit=function(){this._init$(void 0,-2)},u.prototype._init=function(){},u.prototype._promiseFulfilled=function(e,t){var n=this._values,r=this.length(),i=this._preservedValues,o=this._limit;if(t<0){if(n[t=-1*t-1]=e,1<=o&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(1<=o&&this._inFlight>=o)return n[t]=e,this._queue.push(t),!1;null!==i&&(i[t]=e);var a=this._promise,s=this._callback,l=a._boundValue();a._pushContext();var c=g(s).call(l,e,t,r),u=a._popContext();if(m.checkForgottenReturns(c,u,null!==i?"Promise.filter":"Promise.map",a),c===v)return this._reject(c.e),!0;var p=h(c,this._promise);if(p instanceof f){var d=(p=p._target())._bitField;if(0==(50397184&d))return 1<=o&&this._inFlight++,(n[t]=p)._proxy(this,-1*(t+1)),!1;if(0==(33554432&d))return 0!=(16777216&d)?this._reject(p._reason()):this._cancel(),!0;c=p._value()}n[t]=c}return++this._totalResolved>=r&&(null!==i?this._filter(n,i):this._resolve(n),!0)},u.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;0<e.length&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},u.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},u.prototype.preservedValues=function(){return this._preservedValues},f.prototype.map=function(e,t){return i(this,e,t,null)},f.map=function(e,t,n,r){return i(e,t,n,r)}}},{"./util":36}],19:[function(t,e,n){"use strict";e.exports=function(a,s,e,l,c){var u=t("./util"),p=u.tryCatch;a.method=function(r){if("function"!=typeof r)throw new a.TypeError("expecting a function but got "+u.classString(r));return function(){var e=new a(s);e._captureStackTrace(),e._pushContext();var t=p(r).apply(this,arguments),n=e._popContext();return c.checkForgottenReturns(t,n,"Promise.method",e),e._resolveFromSyncValue(t),e}},a.attempt=a.try=function(e){if("function"!=typeof e)return l("expecting a function but got "+u.classString(e));var t,n=new a(s);if(n._captureStackTrace(),n._pushContext(),1<arguments.length){c.deprecated("calling Promise.try with more than 1 argument");var r=arguments[1],i=arguments[2];t=u.isArray(r)?p(e).apply(i,r):p(e).call(i,r)}else t=p(e)();var o=n._popContext();return c.checkForgottenReturns(t,o,"Promise.try",n),n._resolveFromSyncValue(t),n},a.prototype._resolveFromSyncValue=function(e){e===u.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){"use strict";var a=e("./util"),s=a.maybeWrapAsError,l=e("./errors").OperationalError,c=e("./es5"),u=/^(?:name|message|stack|cause)$/;t.exports=function(i,o){return function(e,t){if(null!==i){if(e){var n=function(e){var t,n;if((n=e)instanceof Error&&c.getPrototypeOf(n)===Error.prototype){(t=new l(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var r=c.keys(e),i=0;i<r.length;++i){var o=r[i];u.test(o)||(t[o]=e[o])}return t}return a.markAsOriginatingFromRejection(e),e}(s(e));i._attachExtraTrace(n),i._reject(n)}else if(o){var r=[].slice.call(arguments,1);i._fulfill(r)}else i._fulfill(t);i=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,n){"use strict";e.exports=function(e){var r=t("./util"),i=e._async,o=r.tryCatch,a=r.errorObj;function s(e,t){if(!r.isArray(e))return l.call(this,e,t);var n=o(t).apply(this._boundValue(),[null].concat(e));n===a&&i.throwLater(n.e)}function l(e,t){var n=this._boundValue(),r=void 0===e?o(t).call(n,null):o(t).call(n,null,e);r===a&&i.throwLater(r.e)}function c(e,t){if(!e){var n=new Error(e+"");n.cause=e,e=n}var r=o(t).call(this._boundValue(),e);r===a&&i.throwLater(r.e)}e.prototype.asCallback=e.prototype.nodeify=function(e,t){if("function"==typeof e){var n=l;void 0!==t&&Object(t).spread&&(n=s),this._then(n,c,void 0,this,e)}return this}}},{"./util":36}],22:[function(O,P,e){"use strict";P.exports=function(){var l=function(){return new p("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},s=function(){return new S.PromiseInspection(this._target())},a=function(e){return S.reject(new p(e))};function c(){}var f,u={},h=O("./util");f=h.isNode?function(){var e=$.domain;return void 0===e&&(e=null),e}:function(){return null},h.notEnumerableProp(S,"_getDomain",f);var e=O("./es5"),t=O("./async"),m=new t;e.defineProperty(S,"_async",{value:m});var n=O("./errors"),p=S.TypeError=n.TypeError;S.RangeError=n.RangeError;var g=S.CancellationError=n.CancellationError;S.TimeoutError=n.TimeoutError,S.OperationalError=n.OperationalError,S.RejectionError=n.OperationalError,S.AggregateError=n.AggregateError;var v=function(){},d={},y={},b=O("./thenables")(S,v),_=O("./promise_array")(S,v,b,a,c),r=O("./context")(S),i=r.create,w=O("./debuggability")(S,r),k=(w.CapturedTrace,O("./finally")(S,b,y)),x=O("./catch_filter")(y),o=O("./nodeback"),E=h.errorObj,C=h.tryCatch;function S(e){e!==v&&function(e,t){if(null==e||e.constructor!==S)throw new p("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new p("expecting a function but got "+h.classString(t))}(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function T(e){this.promise._resolveCallback(e)}function A(e){this.promise._rejectCallback(e,!1)}function N(e){var t=new S(v);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}return S.prototype.toString=function(){return"[object Promise]"},S.prototype.caught=S.prototype.catch=function(e){var t=arguments.length;if(1<t){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!h.isObject(o))return a("Catch statement predicate: expecting an object but got "+h.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,x(r,e,this))}return this.then(void 0,e)},S.prototype.reflect=function(){return this._then(s,s,void 0,this,void 0)},S.prototype.then=function(e,t){if(w.warnings()&&0<arguments.length&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+h.classString(e);1<arguments.length&&(n+=", "+h.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},S.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},S.prototype.spread=function(e){return"function"!=typeof e?a("expecting a function but got "+h.classString(e)):this.all()._then(e,void 0,void 0,d,void 0)},S.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},S.prototype.all=function(){return 0<arguments.length&&this._warn(".all() was passed arguments but it does not take any"),new _(this).promise()},S.prototype.error=function(e){return this.caught(h.originatesFromRejection,e)},S.getNewLibraryCopy=P.exports,S.is=function(e){return e instanceof S},S.fromNode=S.fromCallback=function(e){var t=new S(v);t._captureStackTrace();var n=1<arguments.length&&!!Object(arguments[1]).multiArgs,r=C(e)(o(t,n));return r===E&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},S.all=function(e){return new _(e).promise()},S.resolve=S.fulfilled=S.cast=function(e){var t=b(e);return t instanceof S||((t=new S(v))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},S.reject=S.rejected=function(e){var t=new S(v);return t._captureStackTrace(),t._rejectCallback(e,!0),t},S.setScheduler=function(e){if("function"!=typeof e)throw new p("expecting a function but got "+h.classString(e));return m.setScheduler(e)},S.prototype._then=function(e,t,n,r,i){var o=void 0!==i,a=o?i:new S(v),s=this._target(),l=s._bitField;o||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&l)?this._boundValue():s===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var c=f();if(0!=(50397184&l)){var u,p,d=s._settlePromiseCtx;0!=(33554432&l)?(p=s._rejectionHandler0,u=e):0!=(16777216&l)?(p=s._fulfillmentHandler0,u=t,s._unsetRejectionIsUnhandled()):(d=s._settlePromiseLateCancellationObserver,p=new g("late cancellation observer"),s._attachExtraTrace(p),u=t),m.invoke(d,s,{handler:null===c?u:"function"==typeof u&&h.domainBind(c,u),promise:a,receiver:r,value:p})}else s._addCallbacks(e,t,a,r,c);return a},S.prototype._length=function(){return 65535&this._bitField},S.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},S.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},S.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},S.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},S.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},S.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},S.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},S.prototype._isFinal=function(){return 0<(4194304&this._bitField)},S.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},S.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},S.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},S.prototype._setAsyncGuaranteed=function(){m.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},S.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==u)return void 0===t&&this._isBound()?this._boundValue():t},S.prototype._promiseAt=function(e){return this[4*e-4+2]},S.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},S.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},S.prototype._boundValue=function(){},S.prototype._migrateCallback0=function(e){e._bitField;var t=e._fulfillmentHandler0,n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=u),this._addCallbacks(t,n,r,i,null)},S.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=u),this._addCallbacks(n,r,i,o,null)},S.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(65531<=o&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:h.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:h.domainBind(i,t));else{var a=4*o-4;this[a+2]=n,this[a+3]=r,"function"==typeof e&&(this[a+0]=null===i?e:h.domainBind(i,e)),"function"==typeof t&&(this[a+1]=null===i?t:h.domainBind(i,t))}return this._setLength(o+1),o},S.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},S.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(l(),!1);var n=b(e,this);if(!(n instanceof S))return this._fulfill(e);t&&this._propagateFrom(n,2);var r=n._target();if(r!==this){var i=r._bitField;if(0==(50397184&i)){var o=this._length();0<o&&r._migrateCallback0(this);for(var a=1;a<o;++a)r._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&i))this._fulfill(r._value());else if(0!=(16777216&i))this._reject(r._reason());else{var s=new g("late cancellation observer");r._attachExtraTrace(s),this._reject(s)}}else this._reject(l())}},S.prototype._rejectCallback=function(e,t,n){var r=h.ensureErrorObject(e),i=r===e;if(!i&&!n&&w.warnings()){var o="a promise was rejected with a non-error: "+h.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},S.prototype._resolveFromExecutor=function(e){if(e!==v){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)}},S.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){var o;r._pushContext(),t===d?n&&"number"==typeof n.length?o=C(e).apply(this._boundValue(),n):(o=E).e=new p("cannot .spread() a non-array: "+h.classString(n)):o=C(e).call(t,n);var a=r._popContext();0==(65536&(i=r._bitField))&&(o===y?r._reject(n):o===E?r._rejectCallback(o.e,!1):(w.checkForgottenReturns(o,a,"",r,this),r._resolveCallback(o)))}},S.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},S.prototype._followee=function(){return this._rejectionHandler0},S.prototype._setFollowee=function(e){this._rejectionHandler0=e},S.prototype._settlePromise=function(e,t,n,r){var i=e instanceof S,o=this._bitField,a=0!=(134217728&o);0!=(65536&o)?(i&&e._invokeInternalOnCancel(),n instanceof k&&n.isFinallyHandler()?(n.cancelPromise=e,C(t).call(n,r)===E&&e._reject(E.e)):t===s?e._fulfill(s.call(n)):n instanceof c?n._promiseCancelled(e):i||e instanceof _?e._cancel():n.cancel()):"function"==typeof t?i?(a&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,r,e)):t.call(n,r,e):n instanceof c?n._isResolved()||(0!=(33554432&o)?n._promiseFulfilled(r,e):n._promiseRejected(r,e)):i&&(a&&e._setAsyncGuaranteed(),0!=(33554432&o)?e._fulfill(r):e._reject(r))},S.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,i=e.value;"function"==typeof t?n instanceof S?this._settlePromiseFromHandler(t,r,i,n):t.call(r,i,n):n instanceof S&&n._reject(i)},S.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},S.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},S.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},S.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=l();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,0<(65535&t)&&(0!=(134217728&t)?this._settlePromises():m.settlePromises(this))}},S.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return m.fatalError(e,h.isNode);0<(65535&t)?m.settlePromises(this):this._ensurePossibleRejectionHandled()}},S.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},S.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},S.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(0<t){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},S.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},S.defer=S.pending=function(){return w.deprecated("Promise.defer","new Promise"),{promise:new S(v),resolve:T,reject:A}},h.notEnumerableProp(S,"_makeSelfResolutionError",l),O("./method")(S,v,b,a,w),O("./bind")(S,v,b,w),O("./cancel")(S,_,a,w),O("./direct_resolve")(S),O("./synchronous_inspection")(S),O("./join")(S,_,b,v,m,f),(S.Promise=S).version="3.5.1",O("./map.js")(S,_,a,b,v,w),O("./call_get.js")(S),O("./using.js")(S,a,b,i,v,w),O("./timers.js")(S,v,w),O("./generators.js")(S,a,v,b,c,w),O("./nodeify.js")(S),O("./promisify.js")(S,v),O("./props.js")(S,_,b,a),O("./race.js")(S,v,b,a),O("./reduce.js")(S,_,a,b,v,w),O("./settle.js")(S,_,w),O("./some.js")(S,_,a),O("./filter.js")(S,v),O("./each.js")(S,v),O("./any.js")(S),h.toFastProperties(S),h.toFastProperties(S.prototype),N({a:1}),N({b:2}),N({c:3}),N(1),N(function(){}),N(void 0),N(!1),N(new S(v)),w.setBounds(t.firstLineError,h.lastLineError),S}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(r,e,t){"use strict";e.exports=function(s,n,l,a,e){var c=r("./util");function t(e){var t=this._promise=new s(n);e instanceof s&&t._propagateFrom(e,3),t._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return c.isArray,c.inherits(t,e),t.prototype.length=function(){return this._length},t.prototype.promise=function(){return this._promise},t.prototype._init=function e(t,n){var r=l(this._values,this._promise);if(r instanceof s){var i=(r=r._target())._bitField;if(this._values=r,0==(50397184&i))return this._promise._setAsyncGuaranteed(),r._then(e,this._reject,void 0,this,n);if(0==(33554432&i))return 0!=(16777216&i)?this._reject(r._reason()):this._cancel();r=r._value()}if(null!==(r=c.asArray(r)))0!==r.length?this._iterate(r):-5===n?this._resolveEmptyArray():this._resolve(function(e){switch(n){case-2:return[];case-3:return{};case-6:return new Map}}());else{var o=a("expecting an array or an iterable object but got "+c.classString(r)).reason();this._promise._rejectCallback(o,!1)}},t.prototype._iterate=function(e){var t=this.getActualLength(e.length);this._length=t,this._values=this.shouldCopyValues()?new Array(t):this._values;for(var n=this._promise,r=!1,i=null,o=0;o<t;++o){var a=l(e[o],n);i=a instanceof s?(a=a._target())._bitField:null,r?null!==i&&a.suppressUnhandledRejections():null!==i?0==(50397184&i)?(a._proxy(this,o),this._values[o]=a):r=0!=(33554432&i)?this._promiseFulfilled(a._value(),o):0!=(16777216&i)?this._promiseRejected(a._reason(),o):this._promiseCancelled(o):r=this._promiseFulfilled(a,o)}r||n._setAsyncGuaranteed()},t.prototype._isResolved=function(){return null===this._values},t.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},t.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},t.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},t.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},t.prototype._promiseCancelled=function(){return this._cancel(),!0},t.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},t.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof s)e.cancel();else for(var t=0;t<e.length;++t)e[t]instanceof s&&e[t].cancel()}},t.prototype.shouldCopyValues=function(){return!0},t.prototype.getActualLength=function(e){return e},t}},{"./util":36}],24:[function(n,e,t){"use strict";e.exports=function(c,u){var f={},h=n("./util"),p=n("./nodeback"),d=h.withAppended,m=h.maybeWrapAsError,e=h.canEvaluate,g=n("./errors").TypeError,v={__isPromisified__:!0},t=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),y=function(e){return h.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e};function a(e){return!t.test(e)}function b(e){try{return!0===e.__isPromisified__}catch(e){return!1}}var _=function(e){return e.replace(/([$])/,"\\$")},w=e?void 0:function(i,o,e,t,n,a){var s=function(){return this}(),l=i;function r(){var e=o;o===f&&(e=this);var t=new c(u);t._captureStackTrace();var n="string"==typeof l&&this!==s?this[l]:i,r=p(t,a);try{n.apply(e,d(arguments,r))}catch(e){t._rejectCallback(m(e),!0,!0)}return t._isFateSealed()||t._setAsyncGuaranteed(),t}return"string"==typeof l&&(i=t),h.notEnumerableProp(r,"__isPromisified__",!0),r};function k(e,t,n,r,i){for(var o=new RegExp(_(t)+"$"),a=function(e,t,n,r){for(var i=h.inheritedDataKeys(e),o=[],a=0;a<i.length;++a){var s=i[a],l=e[s],c=r===y||y(s,l,e);"function"!=typeof l||b(l)||(u=e,p=s,d=t,(f=h.getDataPropertyOrDefault(u,p+d,v))&&b(f))||!r(s,l,e,c)||o.push(s,l)}var u,p,d,f;return function(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),a=0;a<e.length;a+=2)if(e[a]===o)throw new g("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}(o,t,n),o}(e,t,o,n),s=0,l=a.length;s<l;s+=2){var c=a[s],u=a[s+1],p=c+t;if(r===w)e[p]=w(c,f,c,u,t,i);else{var d=r(u,function(){return w(c,f,c,u,t,i)});h.notEnumerableProp(d,"__isPromisified__",!0),e[p]=d}}return h.toFastProperties(e),e}c.promisify=function(e,t){if("function"!=typeof e)throw new g("expecting a function but got "+h.classString(e));if(b(e))return e;var n,r,i,o=(n=e,r=void 0===(t=Object(t)).context?f:t.context,i=!!t.multiArgs,w(n,r,void 0,n,null,i));return h.copyDescriptors(e,o,a),o},c.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new g("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(t=Object(t)).multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var i=t.filter;"function"!=typeof i&&(i=y);var o=t.promisifier;if("function"!=typeof o&&(o=w),!h.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=h.inheritedDataKeys(e),s=0;s<a.length;++s){var l=e[a[s]];"constructor"!==a[s]&&h.isClass(l)&&(k(l.prototype,r,i,o,n),k(l,r,i,o,n))}return k(e,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(p,e,t){"use strict";e.exports=function(r,e,i,o){var s,t=p("./util"),a=t.isObject,l=p("./es5");"function"==typeof Map&&(s=Map);var c=function(){var n=0,r=0;function i(e,t){this[n]=e,this[n+r]=t,n++}return function(e){r=e.size,n=0;var t=new Array(2*e.size);return e.forEach(i,t),t}}();function u(e){var t,n=!1;if(void 0!==s&&e instanceof s)t=c(e),n=!0;else{var r=l.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var a=r[o];t[o]=e[a],t[o+i]=a}}this.constructor$(t),this._isMap=n,this._init$(void 0,n?-6:-3)}function n(e){var t,n=i(e);return a(n)?(t=n instanceof r?n._then(r.props,void 0,void 0,void 0,void 0):new u(n).promise(),n instanceof r&&t._propagateFrom(n,2),t):o("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}t.inherits(u,e),u.prototype._init=function(){},u.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=function(e){for(var t=new s,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t}(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},u.prototype.shouldCopyValues=function(){return!1},u.prototype.getActualLength=function(e){return e>>1},r.prototype.props=function(){return n(this)},r.props=function(e){return n(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,n){"use strict";function r(e){this._capacity=e,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(e){return this._capacity<e},r.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},r.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},r.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,function(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+0],e[o+0]=void 0}(this,0,this,t,this._front+this._length&t-1)},t.exports=r},{}],27:[function(e,t,n){"use strict";t.exports=function(c,u,p,d){var f=e("./util"),h=function(t){return t.then(function(e){return n(e,t)})};function n(e,t){var n=p(e);if(n instanceof c)return h(n);if(null===(e=f.asArray(e)))return d("expecting an array or an iterable object but got "+f.classString(e));var r=new c(u);void 0!==t&&r._propagateFrom(t,3);for(var i=r._fulfill,o=r._reject,a=0,s=e.length;a<s;++a){var l=e[a];(void 0!==l||a in e)&&c.cast(l)._then(i,o,void 0,r,null)}return r}c.race=function(e){return n(e,void 0)},c.prototype.race=function(){return n(this,void 0)}}},{"./util":36}],28:[function(t,e,n){"use strict";e.exports=function(a,e,i,n,o,s){var l=a._getDomain,c=t("./util"),u=c.tryCatch;function p(e,t,n,r){this.constructor$(e);var i=l();this._fn=null===i?t:c.domainBind(i,t),void 0!==n&&(n=a.resolve(n))._attachCancellationCallback(this),this._initialValue=n,this._currentCancellable=null,this._eachValues=r===o?Array(this._length):0===r?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function d(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function f(e,t,n,r){return"function"!=typeof t?i("expecting a function but got "+c.classString(t)):new p(e,t,n,r).promise()}function h(e){this.accum=e,this.array._gotAccum(e);var t=n(this.value,this.array._promise);return t instanceof a?(this.array._currentCancellable=t)._then(r,void 0,void 0,this,void 0):r.call(this,t)}function r(e){var t,n=this.array,r=n._promise,i=u(n._fn);r._pushContext(),(t=void 0!==n._eachValues?i.call(r._boundValue(),e,this.index,this.length):i.call(r._boundValue(),this.accum,e,this.index,this.length))instanceof a&&(n._currentCancellable=t);var o=r._popContext();return s.checkForgottenReturns(t,o,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),t}c.inherits(p,e),p.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},p.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},p.prototype._init=function(){},p.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},p.prototype.shouldCopyValues=function(){return!1},p.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},p.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof a&&this._currentCancellable.cancel(),this._initialValue instanceof a&&this._initialValue.cancel())},p.prototype._iterate=function(e){var t,n,r=(this._values=e).length;if(void 0!==this._initialValue?(t=this._initialValue,n=0):(t=a.resolve(e[0]),n=1),!(this._currentCancellable=t).isRejected())for(;n<r;++n){var i={accum:null,value:e[n],index:n,length:r,array:this};t=t._then(h,void 0,void 0,i,void 0)}void 0!==this._eachValues&&(t=t._then(this._eachComplete,void 0,void 0,this,void 0)),t._then(d,d,void 0,t,this)},a.prototype.reduce=function(e,t){return f(this,e,t,null)},a.reduce=function(e,t,n,r){return f(e,t,n,r)}}},{"./util":36}],29:[function(e,t,n){"use strict";var r,i,o,a,s,l=e("./util"),c=l.getNativePromise();if(l.isNode&&"undefined"==typeof MutationObserver){var u=C.setImmediate,p=$.nextTick;r=l.isRecentNode?function(e){u.call(C,e)}:function(e){p.call($,e)}}else if("function"==typeof c&&"function"==typeof c.resolve){var d=c.resolve();r=function(e){d.then(e)}}else r="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==f?function(e){f(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:(i=document.createElement("div"),a=!(o={attributes:!0}),s=document.createElement("div"),new MutationObserver(function(){i.classList.toggle("foo"),a=!1}).observe(s,o),function(e){var t=new MutationObserver(function(){t.disconnect(),e()});t.observe(i,o),a||(a=!0,s.classList.toggle("foo"))});t.exports=r},{"./util":36}],30:[function(o,e,t){"use strict";e.exports=function(e,t,n){var r=e.PromiseInspection;function i(e){this.constructor$(e)}o("./util").inherits(i,t),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var n=new r;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},i.prototype._promiseRejected=function(e,t){var n=new r;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},e.settle=function(e){return n.deprecated(".settle()",".reflect()"),new i(e).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(u,e,t){"use strict";e.exports=function(e,t,i){var n=u("./util"),r=u("./errors").RangeError,o=u("./errors").AggregateError,a=n.isArray,s={};function l(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function c(e,t){if((0|t)!==t||t<0)return i("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new l(e),r=n.promise();return n.setHowMany(t),n.init(),r}n.inherits(l,t),l.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var e=a(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},l.prototype.init=function(){this._initialized=!0,this._init()},l.prototype.setUnwrap=function(){this._unwrap=!0},l.prototype.howMany=function(){return this._howMany},l.prototype.setHowMany=function(e){this._howMany=e},l.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},l.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},l.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(s),this._checkOutcome())},l.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new o,t=this.length();t<this._values.length;++t)this._values[t]!==s&&e.push(this._values[t]);return 0<e.length?this._reject(e):this._cancel(),!0}return!1},l.prototype._fulfilled=function(){return this._totalResolved},l.prototype._rejected=function(){return this._values.length-this.length()},l.prototype._addRejected=function(e){this._values.push(e)},l.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},l.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},l.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new r(t)},l.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(e,t){return c(e,t)},e.prototype.some=function(e){return c(this,e)},e._SomePromiseArray=l}},{"./errors":12,"./util":36}],32:[function(e,t,n){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return a.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){"use strict";t.exports=function(s,l){var c=e("./util"),u=c.errorObj,i=c.isObject,o={}.hasOwnProperty;return function(e,t){if(i(e)){if(e instanceof s)return e;var n=function(e){try{return e.then}catch(e){return u.e=e,u}}(e);if(n===u){t&&t._pushContext();var r=s.reject(n.e);return t&&t._popContext(),r}if("function"==typeof n)return function(e){try{return o.call(e,"_promise0")}catch(e){return!1}}(e)?(r=new s(l),e._then(r._fulfill,r._reject,void 0,r,null),r):function(e,t,n){var r=new s(l),i=r;n&&n._pushContext(),r._captureStackTrace(),n&&n._popContext();var o=!0,a=c.tryCatch(t).call(e,function(e){r&&(r._resolveCallback(e),r=null)},function(e){r&&(r._rejectCallback(e,o,!0),r=null)});return o=!1,r&&a===u&&(r._rejectCallback(a.e,!0,!0),r=null),i}(e,n,t)}return e}}},{"./util":36}],34:[function(e,t,n){"use strict";t.exports=function(i,o,s){var l=e("./util"),c=i.TimeoutError;function u(e){this.handle=e}u.prototype._resultCancelled=function(){clearTimeout(this.handle)};var a=function(e){return t(+this).thenReturn(e)},t=i.delay=function(e,t){var n,r;return void 0!==t?(n=i.resolve(t)._then(a,null,null,e,void 0),s.cancellation()&&t instanceof i&&n._setOnCancel(t)):(n=new i(o),r=setTimeout(function(){n._fulfill()},+e),s.cancellation()&&n._setOnCancel(new u(r)),n._captureStackTrace()),n._setAsyncGuaranteed(),n};function n(e){return clearTimeout(this.handle),e}function r(e){throw clearTimeout(this.handle),e}i.prototype.delay=function(e){return t(e,this)},i.prototype.timeout=function(e,i){var o,a;e=+e;var t=new u(setTimeout(function(){var e,t,n,r;o.isPending()&&(e=o,n=a,r="string"!=typeof(t=i)?t instanceof Error?t:new c("operation timed out"):new c(t),l.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel())},e));return s.cancellation()?(a=this.then(),(o=a._then(n,r,void 0,t,void 0))._setOnCancel(t)):o=this._then(n,r,void 0,t,void 0),o}}},{"./util":36}],35:[function(o,e,t){"use strict";e.exports=function(d,f,h,t,m,g){var v=o("./util"),n=o("./errors").TypeError,e=o("./util").inherits,y=v.errorObj,b=v.tryCatch,i={};function _(e){setTimeout(function(){throw e},0)}function w(e,t,n){this._data=e,this._promise=t,this._context=n}function r(e,t,n){this.constructor$(e,t,n)}function k(e){return w.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function x(e){this.length=e,this.promise=null,this[e-1]=null}w.prototype.data=function(){return this._data},w.prototype.promise=function(){return this._promise},w.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():i},w.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==i?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},w.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},e(r,w),r.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},x.prototype._resultCancelled=function(){for(var e=this.length,t=0;t<e;++t){var n=this[t];n instanceof d&&n.cancel()}},d.using=function(){var e=arguments.length;if(e<2)return f("you must pass at least 2 arguments to Promise.using");var t,o=arguments[e-1];if("function"!=typeof o)return f("expecting a function but got "+v.classString(o));var a=!0;2===e&&Array.isArray(arguments[0])?(e=(t=arguments[0]).length,a=!1):(t=arguments,e--);for(var n=new x(e),r=0;r<e;++r){var i=t[r];if(w.isDisposer(i)){var s=i;(i=i.promise())._setDisposable(s)}else{var l=h(i);l instanceof d&&(i=l._then(k,null,null,{resources:n,index:r},void 0))}n[r]=i}var c=new Array(n.length);for(r=0;r<c.length;++r)c[r]=d.resolve(n[r]).reflect();var u=d.all(c).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return y.e=n.error(),y;if(!n.isFulfilled())return void u.cancel();e[t]=n.value()}p._pushContext(),o=b(o);var r=a?o.apply(void 0,e):o(e),i=p._popContext();return g.checkForgottenReturns(r,i,"Promise.using",p),r}),p=u.lastly(function(){var i,o,a,s,l,e=new d.PromiseInspection(u);return o=e,a=0,s=(i=n).length,l=new d(m),function e(){if(s<=a)return l._fulfill();var t,n,r=(t=i[a++],(n=h(t))!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&n._setDisposable(t._getDisposer()),n);if(r instanceof d&&r._isDisposable()){try{r=h(r._getDisposer().tryDispose(o),i.promise)}catch(e){return _(e)}if(r instanceof d)return r._then(e,_,null,null,null)}e()}(),l});return(n.promise=p)._setOnCancel(n),p},d.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},d.prototype._isDisposable=function(){return 0<(131072&this._bitField)},d.prototype._getDisposer=function(){return this._disposer},d.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},d.prototype.disposer=function(e){if("function"==typeof e)return new r(e,this,t());throw new n}}},{"./errors":12,"./util":36}],36:[function(e,t,n){"use strict";var r,c=e("./es5"),i="undefined"==typeof navigator,o={e:{}},a="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==C?C:void 0!==this?this:null;function s(){try{var e=r;return r=null,e.apply(this,arguments)}catch(e){return o.e=e,o}}function l(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function u(e,t,n){if(l(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return c.defineProperty(e,t,r),e}var p=function(){var i=[Array.prototype,Object.prototype,Function.prototype],s=function(e){for(var t=0;t<i.length;++t)if(i[t]===e)return!0;return!1};if(c.isES5){var l=Object.getOwnPropertyNames;return function(e){for(var t=[],n=Object.create(null);null!=e&&!s(e);){var r;try{r=l(e)}catch(e){return t}for(var i=0;i<r.length;++i){var o=r[i];if(!n[o]){n[o]=!0;var a=Object.getOwnPropertyDescriptor(e,o);null!=a&&null==a.get&&null==a.set&&t.push(o)}}e=c.getPrototypeOf(e)}return t}}var o={}.hasOwnProperty;return function(e){if(s(e))return[];var t=[];e:for(var n in e)if(o.call(e,n))t.push(n);else{for(var r=0;r<i.length;++r)if(o.call(i[r],n))continue e;t.push(n)}return t}}(),d=/this\s*\.\s*\S+\s*=/;var f=/^[a-z$_][a-z$_0-9]*$/i;function h(e){try{return e+""}catch(e){return"[no string representation]"}}function m(e){return e instanceof Error||null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function g(e){return m(e)&&c.propertyIsWritable(e,"stack")}var v="stack"in new Error?function(e){return g(e)?e:new Error(h(e))}:function(e){if(g(e))return e;try{throw new Error(h(e))}catch(e){return e}};function y(e){return{}.toString.call(e)}var b=function(e){return c.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var _="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};b=function(e){return c.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?_(e):null}}var w=void 0!==$&&"[object process]"===y($).toLowerCase(),k=void 0!==$&&void 0!==$.env;var x,E={isClass:function(e){try{if("function"==typeof e){var t=c.names(e.prototype),n=c.isES5&&1<t.length,r=0<t.length&&!(1===t.length&&"constructor"===t[0]),i=d.test(e+"")&&0<c.names(e).length;if(n||r||i)return!0}return!1}catch(e){return!1}},isIdentifier:function(e){return f.test(e)},inheritedDataKeys:p,getDataPropertyOrDefault:function(e,t,n){if(!c.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0},thrower:function(e){throw e},isArray:c.isArray,asArray:b,notEnumerableProp:u,isPrimitive:l,isObject:function(e){return"function"==typeof e||"object"==typeof e&&null!==e},isError:m,canEvaluate:i,errorObj:o,tryCatch:function(e){return r=e,s},inherits:function(t,n){var r={}.hasOwnProperty;function e(){for(var e in this.constructor=t,(this.constructor$=n).prototype)r.call(n.prototype,e)&&"$"!==e.charAt(e.length-1)&&(this[e+"$"]=n.prototype[e])}return e.prototype=n.prototype,t.prototype=new e,t.prototype},withAppended:function(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i},maybeWrapAsError:function(e){return l(e)?new Error(h(e)):e},toFastProperties:function(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e},filledRange:function(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r},toString:h,canAttachTrace:g,ensureErrorObject:v,originatesFromRejection:function(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)},markAsOriginatingFromRejection:function(e){try{u(e,"isOperational",!0)}catch(e){}},classString:y,copyDescriptors:function(e,t,n){for(var r=c.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{c.defineProperty(t,o,c.getDescriptor(e,o))}catch(e){}}},hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:w,hasEnvVariables:k,env:function(e){return k?$.env[e]:void 0},global:a,getNativePromise:function(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}},domainBind:function(e,t){return e.bind(t)}};E.isRecentNode=E.isNode&&(0===(x=$.versions.node.split(".").map(Number))[0]&&10<x[1]||0<x[0]),E.isNode&&E.toFastProperties($);try{throw new Error}catch(e){E.lastLineError=e}t.exports=E},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("timers").setImmediate)},{_process:234,timers:334}],116:[function(e,t,n){},{}],117:[function(R,e,j){(function(p){"use strict";var s=R("base64-js"),o=R("ieee754"),e="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;j.Buffer=p,j.SlowBuffer=function(e){return+e!=e&&(e=0),p.alloc(+e)},j.INSPECT_MAX_BYTES=50;var n=2147483647;function a(e){if(n<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,p.prototype),t}function p(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return i(e)}return r(e,t,n)}function r(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!p.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|d(e,t),r=a(n),i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return c(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(I(e,ArrayBuffer)||e&&I(e.buffer,ArrayBuffer))return function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,p.prototype),r}(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return p.from(r,t,n);var i=function(e){if(p.isBuffer(e)){var t=0|u(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||D(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return p.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function i(e){return l(e),a(e<0?0:0|u(e))}function c(e){for(var t=e.length<0?0:0|u(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function u(e){if(n<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function d(e,t){if(p.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||I(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=2<arguments.length&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return O(e).length;default:if(i)return r?-1:N(e).length;t=(""+t).toLowerCase(),i=!0}}function f(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function h(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),D(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=p.from(t,r)),p.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){var o,a=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s/=a=2,l/=2,n/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var u=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*a}else-1!==u&&(o-=o-u),u=-1}else for(s<n+l&&(n=s-l),o=n;0<=o;o--){for(var p=!0,d=0;d<l;d++)if(c(e,o+d)!==c(t,d)){p=!1;break}if(p)return o}return-1}function g(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;o/2<r&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(D(s))return a;e[n+a]=s}return a}function v(e,t,n,r){return P(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function y(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,l,c=e[i],u=null,p=239<c?4:223<c?3:191<c?2:1;if(i+p<=n)switch(p){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[i+1]))&&127<(l=(31&c)<<6|63&o)&&(u=l);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&2047<(l=(15&c)<<12|(63&o)<<6|63&a)&&(l<55296||57343<l)&&(u=l);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&65535<(l=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)&&l<1114112&&(u=l)}null===u?(u=65533,p=1):65535<u&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=p}return function(e){var t=e.length;if(t<=b)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=b));return n}(r)}j.kMaxLength=n,(p.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(p.prototype,"parent",{enumerable:!0,get:function(){if(p.isBuffer(this))return this.buffer}}),Object.defineProperty(p.prototype,"offset",{enumerable:!0,get:function(){if(p.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&p[Symbol.species]===p&&Object.defineProperty(p,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),p.poolSize=8192,p.from=function(e,t,n){return r(e,t,n)},Object.setPrototypeOf(p.prototype,Uint8Array.prototype),Object.setPrototypeOf(p,Uint8Array),p.alloc=function(e,t,n){return i=t,o=n,l(r=e),r<=0?a(r):void 0!==i?"string"==typeof o?a(r).fill(i,o):a(r).fill(i):a(r);var r,i,o},p.allocUnsafe=function(e){return i(e)},p.allocUnsafeSlow=function(e){return i(e)},p.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==p.prototype},p.compare=function(e,t){if(I(e,Uint8Array)&&(e=p.from(e,e.offset,e.byteLength)),I(t,Uint8Array)&&(t=p.from(t,t.offset,t.byteLength)),!p.isBuffer(e)||!p.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},p.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},p.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return p.alloc(0);var n;if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;var r=p.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(I(o,Uint8Array)&&(o=p.from(o)),!p.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},p.byteLength=d,p.prototype._isBuffer=!0,p.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},p.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},p.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},p.prototype.toLocaleString=p.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?y(this,0,e):function(e,t,n){var r,i,o,a=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,n);case"utf8":case"utf-8":return y(this,t,n);case"ascii":return _(this,t,n);case"latin1":case"binary":return w(this,t,n);case"base64":return r=this,o=n,0===(i=t)&&o===r.length?s.fromByteArray(r):s.fromByteArray(r.slice(i,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,n);default:if(a)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}.apply(this,arguments)},p.prototype.equals=function(e){if(!p.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===p.compare(this,e)},p.prototype.inspect=function(){var e="",t=j.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},e&&(p.prototype[e]=p.prototype.inspect),p.prototype.compare=function(e,t,n,r,i){if(I(e,Uint8Array)&&(e=p.from(e,e.offset,e.byteLength)),!p.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(i<=r&&n<=t)return 0;if(i<=r)return-1;if(n<=t)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),l=this.slice(r,i),c=e.slice(t,n),u=0;u<s;++u)if(l[u]!==c[u]){o=l[u],a=c[u];break}return o<a?-1:a<o?1:0},p.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},p.prototype.indexOf=function(e,t,n){return h(this,e,t,n,!0)},p.prototype.lastIndexOf=function(e,t,n){return h(this,e,t,n,!1)},p.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i,o,a,s,l,c,u,p,d,f=this.length-t;if((void 0===n||f<n)&&(n=f),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var h=!1;;)switch(r){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return p=t,d=n,P(N(e,(u=this).length-p),u,p,d);case"ascii":return v(this,e,t,n);case"latin1":case"binary":return v(this,e,t,n);case"base64":return s=this,l=t,c=n,P(O(e),s,l,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o=t,a=n,P(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i=n%256,o.push(i),o.push(r);return o}(e,(i=this).length-o),i,o,a);default:if(h)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),h=!0}},p.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var b=4096;function _(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function w(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function k(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||r<n)&&(n=r);for(var i="",o=t;o<n;++o)i+=L[e[o]];return i}function x(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function E(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,n,r,i,o){if(!p.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function S(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function T(e,t,n,r,i){return t=+t,n>>>=0,i||S(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function A(e,t,n,r,i){return t=+t,n>>>=0,i||S(e,0,n,8),o.write(e,t,n,r,52,8),n+8}p.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,p.prototype),r},p.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},p.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e+--t],i=1;0<t&&(i*=256);)r+=this[e+--t]*i;return r},p.prototype.readUInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),this[e]},p.prototype.readUInt16LE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]|this[e+1]<<8},p.prototype.readUInt16BE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]<<8|this[e+1]},p.prototype.readUInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},p.prototype.readUInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},p.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},p.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=t,i=1,o=this[e+--r];0<r&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},p.prototype.readInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},p.prototype.readInt16LE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},p.prototype.readInt16BE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},p.prototype.readInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},p.prototype.readInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},p.prototype.readFloatLE=function(e,t){return e>>>=0,t||E(e,4,this.length),o.read(this,e,!0,23,4)},p.prototype.readFloatBE=function(e,t){return e>>>=0,t||E(e,4,this.length),o.read(this,e,!1,23,4)},p.prototype.readDoubleLE=function(e,t){return e>>>=0,t||E(e,8,this.length),o.read(this,e,!0,52,8)},p.prototype.readDoubleBE=function(e,t){return e>>>=0,t||E(e,8,this.length),o.read(this,e,!1,52,8)},p.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||C(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},p.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||C(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;0<=--i&&(o*=256);)this[t+i]=e/o&255;return t+n},p.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,1,255,0),this[t]=255&e,t+1},p.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},p.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},p.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},p.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},p.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);C(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},p.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);C(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;0<=--o&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},p.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},p.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},p.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},p.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},p.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},p.prototype.writeFloatLE=function(e,t,n){return T(this,e,t,!0,n)},p.prototype.writeFloatBE=function(e,t,n){return T(this,e,t,!1,n)},p.prototype.writeDoubleLE=function(e,t,n){return A(this,e,t,!0,n)},p.prototype.writeDoubleBE=function(e,t,n){return A(this,e,t,!1,n)},p.prototype.copy=function(e,t,n,r){if(!p.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),0<r&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var o=i-1;0<=o;--o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},p.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!p.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=p.isBuffer(e)?e:p.from(e,r),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var t=/[^+/0-9A-Za-z-_]/g;function N(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if(55295<(n=e.charCodeAt(a))&&n<57344){if(!i){if(56319<n){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===r){-1<(t-=3)&&o.push(239,191,189);continue}i=n;continue}if(n<56320){-1<(t-=3)&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&-1<(t-=3)&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function O(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(t,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function P(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function I(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function D(e){return e!=e}var L=function(){for(var e=new Array(256),t=0;t<16;++t)for(var n=16*t,r=0;r<16;++r)e[n+r]="0123456789abcdef"[t]+"0123456789abcdef"[r];return e}()}).call(this,R("buffer").Buffer)},{"base64-js":114,buffer:117,ieee754:172}],118:[function(e,t,n){!function(){"use strict";var a={}.hasOwnProperty;function s(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var r=typeof n;if("string"===r||"number"===r)e.push(n);else if(Array.isArray(n)&&n.length){var i=s.apply(null,n);i&&e.push(i)}else if("object"===r)for(var o in n)a.call(n,o)&&n[o]&&e.push(o)}}return e.join(" ")}void 0!==t&&t.exports?(s.default=s,t.exports=s):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return s}):window.classNames=s}()},{}],119:[function(e,t,n){(function(e){function t(e){return Object.prototype.toString.call(e)}n.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},n.isBoolean=function(e){return"boolean"==typeof e},n.isNull=function(e){return null===e},n.isNullOrUndefined=function(e){return null==e},n.isNumber=function(e){return"number"==typeof e},n.isString=function(e){return"string"==typeof e},n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=function(e){return void 0===e},n.isRegExp=function(e){return"[object RegExp]"===t(e)},n.isObject=function(e){return"object"==typeof e&&null!==e},n.isDate=function(e){return"[object Date]"===t(e)},n.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},n.isFunction=function(e){return"function"==typeof e},n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":176}],120:[function(e,t,n){var r,i;r=this,i=function(){var u,n,e,t,r,p,i,o,a,s,l,c,d=d||(u=Math,n=Object.create||function(){function n(){}return function(e){var t;return n.prototype=e,t=new n,n.prototype=null,t}}(),t=(e={}).lib={},r=t.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},p=t.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var a=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=a<<24-(r+o)%4*8}else for(o=0;o<i;o+=4)t[r+o>>>2]=n[o>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=u.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,n=[],r=function(t){t=t;var n=987654321,r=4294967295;return function(){var e=((n=36969*(65535&n)+(n>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return e/=4294967296,(e+=.5)*(.5<u.random()?1:-1)}},i=0;i<e;i+=4){var o=r(4294967296*(t||u.random()));t=987654071*o(),n.push(4294967296*o()|0)}return new p.init(n,e)}}),i=e.enc={},o=i.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new p.init(n,t/2)}},a=i.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new p.init(n,t)}},s=i.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},l=t.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new p.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=s.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,r=t.sigBytes,i=this.blockSize,o=r/(4*i),a=(o=e?u.ceil(o):u.max((0|o)-this._minBufferSize,0))*i,s=u.min(4*a,r);if(a){for(var l=0;l<a;l+=i)this._doProcessBlock(n,l);var c=n.splice(0,a);t.sigBytes-=s}return new p.init(c,s)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),t.Hasher=l.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new c.HMAC.init(n,t).finalize(e)}}}),c=e.algo={},e);return d},"object"==typeof n?t.exports=n=i():"function"==typeof define&&define.amd?define([],i):r.CryptoJS=i()},{}],121:[function(e,t,n){var r,i;r=this,i=function(e){var t,n,r,i,p,o;return n=(t=e).lib,r=n.WordArray,i=n.Hasher,p=[],o=t.algo.SHA1=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=0;l<80;l++){if(l<16)p[l]=0|e[t+l];else{var c=p[l-3]^p[l-8]^p[l-14]^p[l-16];p[l]=c<<1|c>>>31}var u=(r<<5|r>>>27)+s+p[l];u+=l<20?1518500249+(i&o|~i&a):l<40?1859775393+(i^o^a):l<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,s=a,a=o,o=i<<30|i>>>2,i=r,r=u}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=i._createHelper(o),t.HmacSHA1=i._createHmacHelper(o),e.SHA1},"object"==typeof n?t.exports=n=i(e("./core")):"function"==typeof define&&define.amd?define(["./core"],i):i(r.CryptoJS)},{"./core":120}],122:[function(e,t,n){var r=e("util"),i=e("abstract-leveldown").AbstractIterator;function o(e){i.call(this,e),this._options=e,this._iterator=null,this._operations=[]}r.inherits(o,i),o.prototype.setDb=function(e){var t=this._iterator=e.iterator(this._options);this._operations.forEach(function(e){t[e.method].apply(t,e.args)})},o.prototype._operation=function(e,t){if(this._iterator)return this._iterator[e].apply(this._iterator,t);this._operations.push({method:e,args:t})},"next end".split(" ").forEach(function(e){o.prototype["_"+e]=function(){this._operation(e,arguments)}}),t.exports=o},{"abstract-leveldown":127,util:338}],123:[function(a,s,e){(function(t,n){var e=a("util"),r=a("abstract-leveldown").AbstractLevelDOWN,i=a("./deferred-iterator");function o(e){r.call(this,"string"==typeof e?e:""),this._db=void 0,this._operations=[],this._iterators=[]}e.inherits(o,r),o.prototype.setDb=function(t){this._db=t,this._operations.forEach(function(e){t[e.method].apply(t,e.args)}),this._iterators.forEach(function(e){e.setDb(t)})},o.prototype._open=function(e,t){return n.nextTick(t)},o.prototype._operation=function(e,t){if(this._db)return this._db[e].apply(this._db,t);this._operations.push({method:e,args:t})},"put get del batch approximateSize".split(" ").forEach(function(e){o.prototype["_"+e]=function(){this._operation(e,arguments)}}),o.prototype._isBuffer=function(e){return t.isBuffer(e)},o.prototype._iterator=function(e){if(this._db)return this._db.iterator.apply(this._db,arguments);var t=new i(e);return this._iterators.push(t),t},s.exports=o,s.exports.DeferredIterator=i}).call(this,{isBuffer:a("../is-buffer/index.js")},a("_process"))},{"../is-buffer/index.js":176,"./deferred-iterator":122,_process:234,"abstract-leveldown":127,util:338}],124:[function(e,t,n){(function(n){function e(e){this._db=e,this._operations=[],this._written=!1}e.prototype._serializeKey=function(e){return this._db._serializeKey(e)},e.prototype._serializeValue=function(e){return this._db._serializeValue(e)},e.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},e.prototype.put=function(e,t){this._checkWritten();var n=this._db._checkKey(e,"key",this._db._isBuffer);if(n)throw n;return e=this._serializeKey(e),t=this._serializeValue(t),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},e.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return e=this._serializeKey(e),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},e.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},e.prototype.write=function(e,t){if(this._checkWritten(),"function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("write() requires a callback argument");return"object"!=typeof e&&(e={}),this._written=!0,"function"==typeof this._write?this._write(t):"function"==typeof this._db._batch?this._db._batch(this._operations,e,t):void n.nextTick(t)},t.exports=e}).call(this,e("_process"))},{_process:234}],125:[function(e,t,n){(function(n){function e(e){this.db=e,this._ended=!1,this._nexting=!1}e.prototype.next=function(e){var t=this;if("function"!=typeof e)throw new Error("next() requires a callback argument");return t._ended?e(new Error("cannot call next() after end()")):t._nexting?e(new Error("cannot call next() before previous next() has completed")):(t._nexting=!0,"function"==typeof t._next?t._next(function(){t._nexting=!1,e.apply(null,arguments)}):void n.nextTick(function(){t._nexting=!1,e()}))},e.prototype.end=function(e){if("function"!=typeof e)throw new Error("end() requires a callback argument");return this._ended?e(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(e):void n.nextTick(e))},t.exports=e}).call(this,e("_process"))},{_process:234}],126:[function(o,a,e){(function(t,s){var e=o("xtend"),n=o("./abstract-iterator"),r=o("./abstract-chained-batch");function i(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}i.prototype.open=function(e,t){var n=this,r=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,function(e){if(e)return n.status=r,t(e);n.status="open",t()})):(this.status="open",s.nextTick(t))},i.prototype.close=function(t){var n=this,r=this.status;if("function"!=typeof t)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close(function(e){if(e)return n.status=r,t(e);n.status="closed",t()})):(this.status="closed",s.nextTick(t))},i.prototype.get=function(e,t,n){var r;if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("get() requires a callback argument");return(r=this._checkKey(e,"key"))?n(r):(e=this._serializeKey(e),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,n):void s.nextTick(function(){n(new Error("NotFound"))}))},i.prototype.put=function(e,t,n,r){var i;if("function"==typeof n&&(r=n),"function"!=typeof r)throw new Error("put() requires a callback argument");return(i=this._checkKey(e,"key"))?r(i):(e=this._serializeKey(e),t=this._serializeValue(t),"object"!=typeof n&&(n={}),"function"==typeof this._put?this._put(e,t,n,r):void s.nextTick(r))},i.prototype.del=function(e,t,n){var r;if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("del() requires a callback argument");return(r=this._checkKey(e,"key"))?n(r):(e=this._serializeKey(e),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,n):void s.nextTick(n))},i.prototype.batch=function(e,t,n){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(n=t),"function"==typeof e&&(n=e),"function"!=typeof n)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return n(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var r,i,o=0,a=e.length;o<a;o++)if("object"==typeof(r=e[o])){if(i=this._checkKey(r.type,"type"))return n(i);if(i=this._checkKey(r.key,"key"))return n(i)}if("function"==typeof this._batch)return this._batch(e,t,n);s.nextTick(n)},i.prototype.approximateSize=function(e,t,n){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof n)throw new Error("approximateSize() requires a callback argument");if(e=this._serializeKey(e),t=this._serializeKey(t),"function"==typeof this._approximateSize)return this._approximateSize(e,t,n);s.nextTick(function(){n(null,0)})},i.prototype._setupIteratorOptions=function(t){var n=this;return t=e(t),["start","end","gt","gte","lt","lte"].forEach(function(e){t[e]&&n._isBuffer(t[e])&&0===t[e].length&&delete t[e]}),t.reverse=!!t.reverse,t.keys=0!=t.keys,t.values=0!=t.values,t.limit="limit"in t?t.limit:-1,t.keyAsBuffer=0!=t.keyAsBuffer,t.valueAsBuffer=0!=t.valueAsBuffer,t},i.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new n(this)},i.prototype._chainedBatch=function(){return new r(this)},i.prototype._isBuffer=function(e){return t.isBuffer(e)},i.prototype._serializeKey=function(e){return this._isBuffer(e)?e:String(e)},i.prototype._serializeValue=function(e){return null==e?"":this._isBuffer(e)||s.browser?e:String(e)},i.prototype._checkKey=function(e,t){return null==e?new Error(t+" cannot be `null` or `undefined`"):this._isBuffer(e)&&0===e.length?new Error(t+" cannot be an empty Buffer"):""===String(e)?new Error(t+" cannot be an empty String"):void 0},a.exports=i}).call(this,{isBuffer:o("../../../is-buffer/index.js")},o("_process"))},{"../../../is-buffer/index.js":176,"./abstract-chained-batch":124,"./abstract-iterator":125,_process:234,xtend:341}],127:[function(e,t,n){n.AbstractLevelDOWN=e("./abstract-leveldown"),n.AbstractIterator=e("./abstract-iterator"),n.AbstractChainedBatch=e("./abstract-chained-batch"),n.isLevelDOWN=e("./is-leveldown")},{"./abstract-chained-batch":124,"./abstract-iterator":125,"./abstract-leveldown":126,"./is-leveldown":128}],128:[function(e,t,n){var r=e("./abstract-leveldown");t.exports=function(t){return!(!t||"object"!=typeof t)&&Object.keys(r.prototype).filter(function(e){return"_"!=e[0]&&"approximateSize"!=e}).every(function(e){return"function"==typeof t[e]})}},{"./abstract-leveldown":126}],129:[function(e,t,n){t.exports={elementNames:{altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient",textpath:"textPath"},attributeNames:{definitionurl:"definitionURL",attributename:"attributeName",attributetype:"attributeType",basefrequency:"baseFrequency",baseprofile:"baseProfile",calcmode:"calcMode",clippathunits:"clipPathUnits",diffuseconstant:"diffuseConstant",edgemode:"edgeMode",filterunits:"filterUnits",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",limitingconeangle:"limitingConeAngle",markerheight:"markerHeight",markerunits:"markerUnits",markerwidth:"markerWidth",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",numoctaves:"numOctaves",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",refx:"refX",refy:"refY",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",specularconstant:"specularConstant",specularexponent:"specularExponent",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stitchtiles:"stitchTiles",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textlength:"textLength",viewbox:"viewBox",viewtarget:"viewTarget",xchannelselector:"xChannelSelector",ychannelselector:"yChannelSelector",zoomandpan:"zoomAndPan"}}},{}],130:[function(e,t,n){var l=e("domelementtype"),c=e("entities"),o=e("./foreignNames.json");o.elementNames.__proto__=null;var u={__proto__:o.attributeNames.__proto__=null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0};var i={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},p=t.exports=function(e,t){Array.isArray(e)||e.cheerio||(e=[e]),t=t||{};for(var n="",r=0;r<e.length;r++){var i=e[r];"root"===i.type?n+=p(i.children,t):l.isTag(i)?n+=d(i,t):i.type===l.Directive?n+="<"+i.data+">":i.type===l.Comment?n+="\x3c!--"+i.data+"--\x3e":i.type===l.CDATA?n+="<![CDATA["+i.children[0].data+"]]>":n+=(a=t,s=void 0,s=(o=i).data||"",!a.decodeEntities||o.parent&&o.parent.name in u||(s=c.encodeXML(s)),s)}var o,a,s;return n},a=["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"];function d(e,t){"foreign"===t.xmlMode&&(e.name=o.elementNames[e.name]||e.name,e.parent&&0<=a.indexOf(e.parent.name)&&(t=Object.assign({},t,{xmlMode:!1}))),!t.xmlMode&&0<=["svg","math"].indexOf(e.name)&&(t=Object.assign({},t,{xmlMode:"foreign"}));var n="<"+e.name,r=function(e,t){if(e){var n,r="";for(var i in e)n=e[i],r&&(r+=" "),"foreign"===t.xmlMode&&(i=o.attributeNames[i]||i),r+=i,(null!==n&&""!==n||t.xmlMode)&&(r+='="'+(t.decodeEntities?c.encodeXML(n):n.replace(/\"/g,"&quot;"))+'"');return r}}(e.attribs,t);return r&&(n+=" "+r),!t.xmlMode||e.children&&0!==e.children.length?(n+=">",e.children&&(n+=p(e.children,t)),i[e.name]&&!t.xmlMode||(n+="</"+e.name+">")):n+="/>",n}},{"./foreignNames.json":129,domelementtype:131,entities:135}],131:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isTag=function(e){return"tag"===e.type||"script"===e.type||"style"===e.type},n.Text="text",n.Directive="directive",n.Comment="comment",n.Script="script",n.Style="style",n.Tag="tag",n.CDATA="cdata",n.Doctype="doctype"},{}],132:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=r(e("./maps/entities.json")),l=r(e("./maps/legacy.json")),i=r(e("./maps/xml.json")),o=r(e("./decode_codepoint"));function a(e){var t=Object.keys(e).join("|"),n=u(e),r=new RegExp("&(?:"+(t+="|#[xX][\\da-fA-F]+|#\\d+")+");","g");return function(e){return String(e).replace(r,n)}}n.decodeXML=a(i.default),n.decodeHTMLStrict=a(s.default);var c=function(e,t){return e<t?1:-1};function u(t){return function(e){return"#"===e.charAt(1)?"X"===e.charAt(2)||"x"===e.charAt(2)?o.default(parseInt(e.substr(3),16)):o.default(parseInt(e.substr(2),10)):t[e.slice(1,-1)]}}n.decodeHTML=function(){for(var e=Object.keys(l.default).sort(c),t=Object.keys(s.default).sort(c),n=0,r=0;n<t.length;n++)e[r]===t[n]?(t[n]+=";?",r++):t[n]+=";";var i=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),o=u(s.default);function a(e){return";"!==e.substr(-1)&&(e+=";"),o(e)}return function(e){return String(e).replace(i,a)}}()},{"./decode_codepoint":133,"./maps/entities.json":137,"./maps/legacy.json":138,"./maps/xml.json":139}],133:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("./maps/decode.json"));n.default=function(e){if(55296<=e&&e<=57343||1114111<e)return"";e in i.default&&(e=i.default[e]);var t="";return 65535<e&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)}},{"./maps/decode.json":136}],134:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var i=l(r(e("./maps/xml.json")).default),o=c(i);n.encodeXML=h(i,o);var a=l(r(e("./maps/entities.json")).default),s=c(a);function l(n){return Object.keys(n).sort().reduce(function(e,t){return e[n[t]]="&"+t+";",e},{})}function c(e){var t=[],n=[];return Object.keys(e).forEach(function(e){return 1===e.length?t.push("\\"+e):n.push(e)}),n.unshift("["+t.join("")+"]"),new RegExp(n.join("|"),"g")}n.encodeHTML=h(a,s);var u=/[^\0-\x7F]/g,p=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function d(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}function f(e,t){return"&#x"+(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function h(t,n){return function(e){return e.replace(n,function(e){return t[e]}).replace(p,f).replace(u,d)}}var m=c(i);n.escape=function(e){return e.replace(m,d).replace(p,f).replace(u,d)}},{"./maps/entities.json":137,"./maps/xml.json":139}],135:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./decode"),i=e("./encode");n.decode=function(e,t){return(!t||t<=0?r.decodeXML:r.decodeHTML)(e)},n.decodeStrict=function(e,t){return(!t||t<=0?r.decodeXML:r.decodeHTMLStrict)(e)},n.encode=function(e,t){return(!t||t<=0?i.encodeXML:i.encodeHTML)(e)};var o=e("./encode");n.encodeXML=o.encodeXML,n.encodeHTML=o.encodeHTML,n.escape=o.escape,n.encodeHTML4=o.encodeHTML,n.encodeHTML5=o.encodeHTML;var a=e("./decode");n.decodeXML=a.decodeXML,n.decodeHTML=a.decodeHTML,n.decodeHTMLStrict=a.decodeHTMLStrict,n.decodeHTML4=a.decodeHTML,n.decodeHTML5=a.decodeHTML,n.decodeHTML4Strict=a.decodeHTMLStrict,n.decodeHTML5Strict=a.decodeHTMLStrict,n.decodeXMLStrict=a.decodeXML},{"./decode":132,"./encode":134}],136:[function(e,t,n){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],137:[function(e,t,n){t.exports={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"",in:"",infin:"",infintie:"",inodot:"",intcal:"",int:"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}},{}],138:[function(e,t,n){t.exports={Aacute:"",aacute:"",Acirc:"",acirc:"",acute:"",AElig:"",aelig:"",Agrave:"",agrave:"",amp:"&",AMP:"&",Aring:"",aring:"",Atilde:"",atilde:"",Auml:"",auml:"",brvbar:"",Ccedil:"",ccedil:"",cedil:"",cent:"",copy:"",COPY:"",curren:"",deg:"",divide:"",Eacute:"",eacute:"",Ecirc:"",ecirc:"",Egrave:"",egrave:"",ETH:"",eth:"",Euml:"",euml:"",frac12:"",frac14:"",frac34:"",gt:">",GT:">",Iacute:"",iacute:"",Icirc:"",icirc:"",iexcl:"",Igrave:"",igrave:"",iquest:"",Iuml:"",iuml:"",laquo:"",lt:"<",LT:"<",macr:"",micro:"",middot:"",nbsp:"",not:"",Ntilde:"",ntilde:"",Oacute:"",oacute:"",Ocirc:"",ocirc:"",Ograve:"",ograve:"",ordf:"",ordm:"",Oslash:"",oslash:"",Otilde:"",otilde:"",Ouml:"",ouml:"",para:"",plusmn:"",pound:"",quot:'"',QUOT:'"',raquo:"",reg:"",REG:"",sect:"",shy:"",sup1:"",sup2:"",sup3:"",szlig:"",THORN:"",thorn:"",times:"",Uacute:"",uacute:"",Ucirc:"",ucirc:"",Ugrave:"",ugrave:"",uml:"",Uuml:"",uuml:"",Yacute:"",yacute:"",yen:"",yuml:""}},{}],139:[function(e,t,n){t.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}},{}],140:[function(e,t,n){t.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(e){return"tag"===e.type||"script"===e.type||"style"===e.type}}},{}],141:[function(e,t,n){var i=e("domelementtype"),o=/\s+/g,r=e("./lib/node"),a=e("./lib/element");function s(e,t,n){"object"==typeof e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t=l),this._callback=e,this._options=t||l,this._elementCB=n,this.dom=[],this._done=!1,this._tagStack=[],this._parser=this._parser||null}var l={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1};s.prototype.onparserinit=function(e){this._parser=e},s.prototype.onreset=function(){s.call(this,this._callback,this._options,this._elementCB)},s.prototype.onend=function(){this._done||(this._done=!0,this._parser=null,this._handleCallback(null))},s.prototype._handleCallback=s.prototype.onerror=function(e){if("function"==typeof this._callback)this._callback(e,this.dom);else if(e)throw e},s.prototype.onclosetag=function(){var e=this._tagStack.pop();this._options.withEndIndices&&e&&(e.endIndex=this._parser.endIndex),this._elementCB&&this._elementCB(e)},s.prototype._createDomElement=function(e){if(!this._options.withDomLvl1)return e;var t;for(var n in t="tag"===e.type?Object.create(a):Object.create(r),e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},s.prototype._addDomElement=function(e){var t=this._tagStack[this._tagStack.length-1],n=t?t.children:this.dom,r=n[n.length-1];e.next=null,this._options.withStartIndices&&(e.startIndex=this._parser.startIndex),this._options.withEndIndices&&(e.endIndex=this._parser.endIndex),r?(e.prev=r).next=e:e.prev=null,n.push(e),e.parent=t||null},s.prototype.onopentag=function(e,t){var n={type:"script"===e?i.Script:"style"===e?i.Style:i.Tag,name:e,attribs:t,children:[]},r=this._createDomElement(n);this._addDomElement(r),this._tagStack.push(r)},s.prototype.ontext=function(e){var t,n=this._options.normalizeWhitespace||this._options.ignoreWhitespace;if(!this._tagStack.length&&this.dom.length&&(t=this.dom[this.dom.length-1]).type===i.Text)n?t.data=(t.data+e).replace(o," "):t.data+=e;else if(this._tagStack.length&&(t=this._tagStack[this._tagStack.length-1])&&(t=t.children[t.children.length-1])&&t.type===i.Text)n?t.data=(t.data+e).replace(o," "):t.data+=e;else{n&&(e=e.replace(o," "));var r=this._createDomElement({data:e,type:i.Text});this._addDomElement(r)}},s.prototype.oncomment=function(e){var t=this._tagStack[this._tagStack.length-1];if(t&&t.type===i.Comment)t.data+=e;else{var n={data:e,type:i.Comment},r=this._createDomElement(n);this._addDomElement(r),this._tagStack.push(r)}},s.prototype.oncdatastart=function(){var e={children:[{data:"",type:i.Text}],type:i.CDATA},t=this._createDomElement(e);this._addDomElement(t),this._tagStack.push(t)},s.prototype.oncommentend=s.prototype.oncdataend=function(){this._tagStack.pop()},s.prototype.onprocessinginstruction=function(e,t){var n=this._createDomElement({name:e,data:t,type:i.Directive});this._addDomElement(n)},t.exports=s},{"./lib/element":142,"./lib/node":143,domelementtype:140}],142:[function(e,t,n){var r=e("./node"),i=t.exports=Object.create(r),o={tagName:"name"};Object.keys(o).forEach(function(e){var t=o[e];Object.defineProperty(i,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e}})})},{"./node":143}],143:[function(e,t,n){var r=t.exports={get firstChild(){var e=this.children;return e&&e[0]||null},get lastChild(){var e=this.children;return e&&e[e.length-1]||null},get nodeType(){return o[this.type]||o.element}},i={tagName:"name",childNodes:"children",parentNode:"parent",previousSibling:"prev",nextSibling:"next",nodeValue:"data"},o={element:1,text:3,cdata:4,comment:8};Object.keys(i).forEach(function(e){var t=i[e];Object.defineProperty(r,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e}})})},{}],144:[function(e,t,n){var r=t.exports;[e("./lib/stringify"),e("./lib/traversal"),e("./lib/manipulation"),e("./lib/querying"),e("./lib/legacy"),e("./lib/helpers")].forEach(function(t){Object.keys(t).forEach(function(e){r[e]=t[e].bind(r)})})},{"./lib/helpers":145,"./lib/legacy":146,"./lib/manipulation":147,"./lib/querying":148,"./lib/stringify":149,"./lib/traversal":150}],145:[function(e,t,n){n.removeSubsets=function(e){for(var t,n,r,i=e.length;-1<--i;){for(t=n=e[i],r=!(e[i]=null);n;){if(-1<e.indexOf(n)){r=!1,e.splice(i,1);break}n=n.parent}r&&(e[i]=t)}return e};var u=1,p=2,d=4,f=8,h=16,i=n.compareDocumentPosition=function(e,t){var n,r,i,o,a,s,l=[],c=[];if(e===t)return 0;for(n=e;n;)l.unshift(n),n=n.parent;for(n=t;n;)c.unshift(n),n=n.parent;for(s=0;l[s]===c[s];)s++;return 0===s?u:(i=(r=l[s-1]).children,o=l[s],a=c[s],i.indexOf(o)>i.indexOf(a)?r===t?d|h:d:r===e?p|f:p)};n.uniqueSort=function(e){var t,n,r=e.length;for(e=e.slice();-1<--r;)t=e[r],-1<(n=e.indexOf(t))&&n<r&&e.splice(r,1);return e.sort(function(e,t){var n=i(e,t);return n&p?-1:n&d?1:0}),e}},{}],146:[function(e,t,n){var r=e("domelementtype"),i=n.isTag=r.isTag;n.testElement=function(e,t){for(var n in e)if(e.hasOwnProperty(n))if("tag_name"===n){if(!i(t)||!e.tag_name(t.name))return!1}else if("tag_type"===n){if(!e.tag_type(t.type))return!1}else if("tag_contains"===n){if(i(t)||!e.tag_contains(t.data))return!1}else if(!t.attribs||!e[n](t.attribs[n]))return!1;return!0};var o={tag_name:function(t){return"function"==typeof t?function(e){return i(e)&&t(e.name)}:"*"===t?i:function(e){return i(e)&&e.name===t}},tag_type:function(t){return"function"==typeof t?function(e){return t(e.type)}:function(e){return e.type===t}},tag_contains:function(t){return"function"==typeof t?function(e){return!i(e)&&t(e.data)}:function(e){return!i(e)&&e.data===t}}};function a(t,n){return"function"==typeof n?function(e){return e.attribs&&n(e.attribs[t])}:function(e){return e.attribs&&e.attribs[t]===n}}function s(t,n){return function(e){return t(e)||n(e)}}n.getElements=function(n,e,t,r){var i=Object.keys(n).map(function(e){var t=n[e];return e in o?o[e](t):a(e,t)});return 0===i.length?[]:this.filter(i.reduce(s),e,t,r)},n.getElementById=function(e,t,n){return Array.isArray(t)||(t=[t]),this.findOne(a("id",e),t,!1!==n)},n.getElementsByTagName=function(e,t,n,r){return this.filter(o.tag_name(e),t,n,r)},n.getElementsByTagType=function(e,t,n,r){return this.filter(o.tag_type(e),t,n,r)}},{domelementtype:140}],147:[function(e,t,n){n.removeElement=function(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.children;t.splice(t.lastIndexOf(e),1)}},n.replaceElement=function(e,t){var n=t.prev=e.prev;n&&(n.next=t);var r=t.next=e.next;r&&(r.prev=t);var i=t.parent=e.parent;if(i){var o=i.children;o[o.lastIndexOf(e)]=t}},n.appendChild=function(e,t){if(1!==(t.parent=e).children.push(t)){var n=e.children[e.children.length-2];(n.next=t).prev=n,t.next=null}},n.append=function(e,t){var n=e.parent,r=e.next;if(t.next=r,((t.prev=e).next=t).parent=n,r){if(r.prev=t,n){var i=n.children;i.splice(i.lastIndexOf(r),0,t)}}else n&&n.children.push(t)},n.prepend=function(e,t){var n=e.parent;if(n){var r=n.children;r.splice(r.lastIndexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=n,t.prev=e.prev,(t.next=e).prev=t}},{}],148:[function(e,t,n){var a=e("domelementtype").isTag;function l(e,t,n,r){for(var i,o=[],a=0,s=t.length;a<s&&!(e(t[a])&&(o.push(t[a]),--r<=0))&&(i=t[a].children,!(n&&i&&0<i.length&&(i=l(e,i,n,r),o=o.concat(i),(r-=i.length)<=0)));a++);return o}t.exports={filter:function(e,t,n,r){return Array.isArray(t)||(t=[t]),"number"==typeof r&&isFinite(r)||(r=1/0),l(e,t,!1!==n,r)},find:l,findOneChild:function(e,t){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return t[n];return null},findOne:function e(t,n){for(var r=null,i=0,o=n.length;i<o&&!r;i++)a(n[i])&&(t(n[i])?r=n[i]:0<n[i].children.length&&(r=e(t,n[i].children)));return r},existsOne:function e(t,n){for(var r=0,i=n.length;r<i;r++)if(a(n[r])&&(t(n[r])||0<n[r].children.length&&e(t,n[r].children)))return!0;return!1},findAll:function(e,t){for(var n=[],r=t.slice();r.length;){var i=r.shift();a(i)&&(i.children&&0<i.children.length&&r.unshift.apply(r,i.children),e(i)&&n.push(i))}return n}}},{domelementtype:140}],149:[function(e,t,n){var r=e("domelementtype"),i=e("dom-serializer"),o=r.isTag;t.exports={getInnerHTML:function(e,t){return e.children?e.children.map(function(e){return i(e,t)}).join(""):""},getOuterHTML:i,getText:function e(t){return Array.isArray(t)?t.map(e).join(""):o(t)?"br"===t.name?"\n":e(t.children):t.type===r.CDATA?e(t.children):t.type===r.Text?t.data:""}}},{"dom-serializer":130,domelementtype:140}],150:[function(e,t,n){var r=n.getChildren=function(e){return e.children},i=n.getParent=function(e){return e.parent};n.getSiblings=function(e){var t=i(e);return t?r(t):[e]},n.getAttributeValue=function(e,t){return e.attribs&&e.attribs[t]},n.hasAttrib=function(e,t){return!!e.attribs&&hasOwnProperty.call(e.attribs,t)},n.getName=function(e){return e.name}},{}],151:[function(e,t,n){"use strict";function r(e){if(this._capacity=o(e),this._length=0,this._front=0,this._makeCapacity(),i(e)){for(var t=e.length,n=0;n<t;++n)this[n]=e[n];this._length=t}}r.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,r=this._capacity,i=0;i<e;++i)t[i]=this[n+i&r-1];return t},r.prototype.push=function(e){var t=arguments.length,n=this._length;if(1<t){var r=this._capacity;if(r<n+t){for(var i=0;i<t;++i)this._checkCapacity(n+1),this[o=this._front+n&this._capacity-1]=arguments[i],n++,this._length=n;return n}var o=this._front;for(i=0;i<t;++i)this[o+n&r-1]=arguments[i],o++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[i=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},r.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},r.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},r.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(1<n){if(t+n>(i=this._capacity)){for(var r=n-1;0<=r;r--){this._checkCapacity(t+1);var i=this._capacity;this[a=(this._front-1&i-1^i)-i]=arguments[r],t++,this._length=t,this._front=a}return t}var o=this._front;for(r=n-1;0<=r;r--){var a;this[a=(o-1&i-1^i)-i]=arguments[r],o=a}return this._front=o,this._length=t+n,t+n}return 0===n?t:(this._checkCapacity(t+1),i=this._capacity,this[r=(this._front-1&i-1^i)-i]=e,this._length=t+1,this._front=r,t+1)},r.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},r.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},r.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||n<=t))return this[this._front+t&this._capacity-1]}},r.prototype.isEmpty=function(){return 0===this._length},r.prototype.clear=function(){this._length=0,this._front=0,this._makeCapacity()},r.prototype.valueOf=r.prototype.toString=function(){return this.toArray().toString()},r.prototype.removeFront=r.prototype.shift,r.prototype.removeBack=r.prototype.pop,r.prototype.insertFront=r.prototype.unshift,r.prototype.insertBack=r.prototype.push,r.prototype.enqueue=r.prototype.push,r.prototype.dequeue=r.prototype.shift,r.prototype.toJSON=r.prototype.toArray,Object.defineProperty(r.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),r.prototype._makeCapacity=function(){for(var e=this._capacity,t=0;t<e;++t)this[t]=void 0},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(o(1.5*this._capacity+16))},r.prototype._resizeTo=function(e){var t=this._front,n=this._capacity,r=new Array(n),i=this._length;if(a(this,0,r,0,n),this._capacity=e,this._makeCapacity(),this._front=0,t+i<=n)a(r,t,this,0,i);else{var o=i-(t+i&n-1);a(r,t,this,0,o),a(r,0,this,o,i-o)}};var i=Array.isArray;function a(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t]}function o(e){if("number"!=typeof e){if(!i(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}t.exports=r},{}],152:[function(e,t,n){var r=e("../maps/decode.json");t.exports=function(e){if(55296<=e&&e<=57343||1114111<e)return"";e in r&&(e=r[e]);var t="";return 65535<e&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)}},{"../maps/decode.json":153}],153:[function(e,t,n){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],154:[function(e,t,n){t.exports={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"",in:"",infin:"",infintie:"",inodot:"",intcal:"",int:"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}},{}],155:[function(e,t,n){t.exports={Aacute:"",aacute:"",Acirc:"",acirc:"",acute:"",AElig:"",aelig:"",Agrave:"",agrave:"",amp:"&",AMP:"&",Aring:"",aring:"",Atilde:"",atilde:"",Auml:"",auml:"",brvbar:"",Ccedil:"",ccedil:"",cedil:"",cent:"",copy:"",COPY:"",curren:"",deg:"",divide:"",Eacute:"",eacute:"",Ecirc:"",ecirc:"",Egrave:"",egrave:"",ETH:"",eth:"",Euml:"",euml:"",frac12:"",frac14:"",frac34:"",gt:">",GT:">",Iacute:"",iacute:"",Icirc:"",icirc:"",iexcl:"",Igrave:"",igrave:"",iquest:"",Iuml:"",iuml:"",laquo:"",lt:"<",LT:"<",macr:"",micro:"",middot:"",nbsp:"",not:"",Ntilde:"",ntilde:"",Oacute:"",oacute:"",Ocirc:"",ocirc:"",Ograve:"",ograve:"",ordf:"",ordm:"",Oslash:"",oslash:"",Otilde:"",otilde:"",Ouml:"",ouml:"",para:"",plusmn:"",pound:"",quot:'"',QUOT:'"',raquo:"",reg:"",REG:"",sect:"",shy:"",sup1:"",sup2:"",sup3:"",szlig:"",THORN:"",thorn:"",times:"",Uacute:"",uacute:"",Ucirc:"",ucirc:"",Ugrave:"",ugrave:"",uml:"",Uuml:"",uuml:"",Yacute:"",yacute:"",yen:"",yuml:""}},{}],156:[function(e,t,n){t.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}},{}],157:[function(e,t,n){var r=e("prr");function s(e,t,n){t&&"string"!=typeof t&&(t=t.message||t.name),r(this,{type:e,name:e,cause:"string"!=typeof t?t:n,message:t},"ewr")}function l(e,t){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),s.call(this,"CustomError",e,t)}l.prototype=new Error,t.exports=function(a){var e=function(e,t){return n=a,r=e,(o=function(e,t){s.call(this,r,e,t),"FilesystemError"==r&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(n.errno[this.cause.errno]?n.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,o)}).prototype=(i=t)?new i:new l,o;var n,r,i,o};return{CustomError:l,FilesystemError:e("FilesystemError"),createError:e}}},{prr:238}],158:[function(e,t,n){var r=t.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={},t.exports.code={},r.forEach(function(e){t.exports.errno[e.errno]=e,t.exports.code[e.code]=e}),t.exports.custom=e("./custom")(t.exports),t.exports.create=t.exports.custom.createError},{"./custom":157}],159:[function(e,t,n){var r,i;r=this,i=function(){"use strict";var r=function(){this._listeners={}};r.prototype.addEventListener=function(e,t){this._listeners[e]=this._listeners[e]||[],this._listeners[e].indexOf(t)<0&&this._listeners[e].push(t)},r.prototype.removeEventListener=function(e,t){if(this._listeners[e]){var n=this._listeners[e].indexOf(t);0<=n&&this._listeners[e].splice(n,1)}},r.prototype.dispatchEvent=function(e){if(this._listeners[e.type]&&this._listeners[e.type].length)for(var t=this._listeners[e.type].slice(),n=0,r=t.length;n<r;++n)t[n].call(this,e)};var o=function(e){var t=!1;return{next:function(){return t?{done:!0}:(t=!0,{value:e})}}},n=function(e,t,n){this.target=e,this.type=t,this.data=n},e=function(e,t,n){if(r.call(this),"number"!=typeof t||Math.floor(t)!==t||t<1)throw new Error("Invalid concurrency");this._concurrency=t,this._options=n||{},this._options.promise=this._options.promise||Promise,this._iterator=function(e,t){var n,r,i=typeof e;if("object"===i){if("function"==typeof e.next)return e;if("function"==typeof e.then)return o(e)}return"function"===i?"function"==typeof(n=e).constructor&&"GeneratorFunction"===n.constructor.name?e():(r=e,{next:function(){var e=r();return e?{value:e}:{done:!0}}}):o(t.resolve(e))}(e,this._options.promise),this._done=!1,this._size=0,this._promise=null,this._callbacks=null};return((e.prototype=new r).constructor=e).prototype.concurrency=function(e){return void 0!==e&&(this._concurrency=e,this.active()&&this._proceed()),this._concurrency},e.prototype.size=function(){return this._size},e.prototype.active=function(){return!!this._promise},e.prototype.promise=function(){return this._promise},e.prototype.start=function(){var n=this,e=this._options.promise;return this._promise=new e(function(e,t){n._callbacks={reject:t,resolve:e},n._proceed()}),this._promise},e.prototype._fireEvent=function(e,t){this.dispatchEvent(new n(this,e,t))},e.prototype._settle=function(e){e?this._callbacks.reject(e):this._callbacks.resolve(),this._promise=null,this._callbacks=null},e.prototype._onPooledPromiseFulfilled=function(e,t){this._size--,this.active()&&(this._fireEvent("fulfilled",{promise:e,result:t}),this._proceed())},e.prototype._onPooledPromiseRejected=function(e,t){this._size--,this.active()&&(this._fireEvent("rejected",{promise:e,error:t}),this._settle(t||new Error("Unknown error")))},e.prototype._trackPromise=function(t){var n=this;t.then(function(e){n._onPooledPromiseFulfilled(t,e)},function(e){n._onPooledPromiseRejected(t,e)}).catch(function(e){n._settle(new Error("Promise processing failed: "+e))})},e.prototype._proceed=function(){if(!this._done){for(var e=null;this._size<this._concurrency&&!(e=this._iterator.next()).done;)this._size++,this._trackPromise(e.value);this._done=null===e||!!e.done}this._done&&0===this._size&&this._settle()},e.PromisePoolEvent=n,e.PromisePool=e},"function"==typeof define&&define.amd?define([],i):"object"==typeof n?t.exports=i():(r.PromisePool=i(),r.promisePool=r.PromisePool)},{}],160:[function(e,t,n){var l=Object.create||function(e){var t=function(){};return t.prototype=e,new t},a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=l(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((t.exports=r).EventEmitter=r).prototype._events=void 0,r.prototype._maxListeners=void 0;var i,s=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),i=0===c.x}catch(e){i=!1}function u(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function p(e,t,n,r){var i,o,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=l(null),e._eventsCount=0),a){if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=u(e))&&0<i&&a.length>i){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",s.name,s.message)}}else a=o[t]=n,++e._eventsCount;return e}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=o.call(d,r);return i.listener=n,r.wrapFn=i}function h(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length):[]}function m(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}i?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');s=e}}):r.defaultMaxListeners=s,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return u(this)},r.prototype.emit=function(e){var t,n,r,i,o,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){if(1<arguments.length&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled "error" event. ('+t+")");throw l.context=t,l}if(!(n=a[e]))return!1;var c="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=g(e,r),o=0;o<r;++o)i[o].call(n)}(n,c,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=g(e,i),a=0;a<i;++a)o[a].call(n,r)}(n,c,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=g(e,o),s=0;s<o;++s)a[s].call(n,r,i)}(n,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=g(e,a),l=0;l<a;++l)s[l].call(n,r,i,o)}(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=g(e,i),a=0;a<i;++a)o[a].apply(n,r)}(n,c,this,i)}return!0},r.prototype.on=r.prototype.addListener=function(e,t){return p(this,e,t,!1)},r.prototype.prependListener=function(e,t){return p(this,e,t,!0)},r.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,f(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,f(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=l(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;0<=o;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),r.removeListener&&this.emit("removeListener",e,a||t)}return this},r.prototype.removeAllListeners=function(e){var t,n,r;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=l(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=l(null):delete n[e]),this;if(0===arguments.length){var i,o=a(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=l(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(r=t.length-1;0<=r;r--)this.removeListener(e,t[r]);return this},r.prototype.listeners=function(e){return h(this,e,!0)},r.prototype.rawListeners=function(e){return h(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},r.prototype.listenerCount=m,r.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],161:[function(e,n,t){!function(){"use strict";var e=!("undefined"==typeof window||!window.document||!window.document.createElement),t={canUseDOM:e,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:e&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:e&&!!window.screen};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return t}):void 0!==n&&n.exports?n.exports=t:window.ExecutionEnvironment=t}()},{}],162:[function(e,t,n){"use strict";t.exports=function(e){return new v(e||o,null)};var d=0,f=1;function h(e,t,n,r,i,o){this._color=e,this.key=t,this.value=n,this.left=r,this.right=i,this._count=o}function l(e){return new h(e._color,e.key,e.value,e.left,e.right,e._count)}function m(e,t){return new h(e,t.key,t.value,t.left,t.right,t._count)}function g(e){e._count=1+(e.left?e.left._count:0)+(e.right?e.right._count:0)}function v(e,t){this._compare=e,this.root=t}var r=v.prototype;function a(e,t){this.tree=e,this._stack=t}Object.defineProperty(r,"keys",{get:function(){var n=[];return this.forEach(function(e,t){n.push(e)}),n}}),Object.defineProperty(r,"values",{get:function(){var n=[];return this.forEach(function(e,t){n.push(t)}),n}}),Object.defineProperty(r,"length",{get:function(){return this.root?this.root._count:0}}),r.insert=function(e,t){for(var n=this._compare,r=this.root,i=[],o=[];r;){var a=n(e,r.key);i.push(r),o.push(a),r=a<=0?r.left:r.right}i.push(new h(d,e,t,null,null,1));for(var s=i.length-2;0<=s;--s)r=i[s],o[s]<=0?i[s]=new h(r._color,r.key,r.value,i[s+1],r.right,r._count+1):i[s]=new h(r._color,r.key,r.value,r.left,i[s+1],r._count+1);for(s=i.length-1;1<s;--s){var l=i[s-1];if(r=i[s],l._color===f||r._color===f)break;var c=i[s-2];if(c.left===l)if(l.left===r){if(!(u=c.right)||u._color!==d){c._color=d,c.left=l.right,l._color=f,l.right=c,i[s-2]=l,i[s-1]=r,g(c),g(l),3<=s&&((p=i[s-3]).left===c?p.left=l:p.right=l);break}l._color=f,c.right=m(f,u),c._color=d,s-=1}else{if(!(u=c.right)||u._color!==d){l.right=r.left,c._color=d,c.left=r.right,r._color=f,r.left=l,r.right=c,i[s-2]=r,i[s-1]=l,g(c),g(l),g(r),3<=s&&((p=i[s-3]).left===c?p.left=r:p.right=r);break}l._color=f,c.right=m(f,u),c._color=d,s-=1}else if(l.right===r){if(!(u=c.left)||u._color!==d){c._color=d,c.right=l.left,l._color=f,l.left=c,i[s-2]=l,i[s-1]=r,g(c),g(l),3<=s&&((p=i[s-3]).right===c?p.right=l:p.left=l);break}l._color=f,c.left=m(f,u),c._color=d,s-=1}else{var u;if(!(u=c.left)||u._color!==d){var p;l.left=r.right,c._color=d,c.right=r.left,r._color=f,r.right=l,r.left=c,i[s-2]=r,i[s-1]=l,g(c),g(l),g(r),3<=s&&((p=i[s-3]).right===c?p.right=r:p.left=r);break}l._color=f,c.left=m(f,u),c._color=d,s-=1}}return i[0]._color=f,new v(n,i[0])},r.forEach=function(e,t,n){if(this.root)switch(arguments.length){case 1:return function e(t,n){var r;return n.left&&(r=e(t,n.left))?r:(r=t(n.key,n.value))||(n.right?e(t,n.right):void 0)}(e,this.root);case 2:return function e(t,n,r,i){if(n(t,i.key)<=0){var o;if(i.left&&(o=e(t,n,r,i.left)))return o;if(o=r(i.key,i.value))return o}if(i.right)return e(t,n,r,i.right)}(t,this._compare,e,this.root);case 3:if(0<=this._compare(t,n))return;return function e(t,n,r,i,o){var a,s=r(t,o.key),l=r(n,o.key);if(s<=0){if(o.left&&(a=e(t,n,r,i,o.left)))return a;if(0<l&&(a=i(o.key,o.value)))return a}if(0<l&&o.right)return e(t,n,r,i,o.right)}(t,n,this._compare,e,this.root)}},Object.defineProperty(r,"begin",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.left;return new a(this,e)}}),Object.defineProperty(r,"end",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.right;return new a(this,e)}}),r.at=function(e){if(e<0)return new a(this,[]);for(var t=this.root,n=[];;){if(n.push(t),t.left){if(e<t.left._count){t=t.left;continue}e-=t.left._count}if(!e)return new a(this,n);if(e-=1,!t.right)break;if(e>=t.right._count)break;t=t.right}return new a(this,[])},r.ge=function(e){for(var t=this._compare,n=this.root,r=[],i=0;n;){var o=t(e,n.key);r.push(n),o<=0&&(i=r.length),n=o<=0?n.left:n.right}return r.length=i,new a(this,r)},r.gt=function(e){for(var t=this._compare,n=this.root,r=[],i=0;n;){var o=t(e,n.key);r.push(n),o<0&&(i=r.length),n=o<0?n.left:n.right}return r.length=i,new a(this,r)},r.lt=function(e){for(var t=this._compare,n=this.root,r=[],i=0;n;){var o=t(e,n.key);r.push(n),0<o&&(i=r.length),n=o<=0?n.left:n.right}return r.length=i,new a(this,r)},r.le=function(e){for(var t=this._compare,n=this.root,r=[],i=0;n;){var o=t(e,n.key);r.push(n),0<=o&&(i=r.length),n=o<0?n.left:n.right}return r.length=i,new a(this,r)},r.find=function(e){for(var t=this._compare,n=this.root,r=[];n;){var i=t(e,n.key);if(r.push(n),0===i)return new a(this,r);n=i<=0?n.left:n.right}return new a(this,[])},r.remove=function(e){var t=this.find(e);return t?t.remove():this},r.get=function(e){for(var t=this._compare,n=this.root;n;){var r=t(e,n.key);if(0===r)return n.value;n=r<=0?n.left:n.right}};var i=a.prototype;function c(e,t){e.key=t.key,e.value=t.value,e.left=t.left,e.right=t.right,e._color=t._color,e._count=t._count}function o(e,t){return e<t?-1:t<e?1:0}Object.defineProperty(i,"valid",{get:function(){return 0<this._stack.length}}),Object.defineProperty(i,"node",{get:function(){return 0<this._stack.length?this._stack[this._stack.length-1]:null},enumerable:!0}),i.clone=function(){return new a(this.tree,this._stack.slice())},i.remove=function(){var e=this._stack;if(0===e.length)return this.tree;var t=new Array(e.length),n=e[e.length-1];t[t.length-1]=new h(n._color,n.key,n.value,n.left,n.right,n._count);for(var r=e.length-2;0<=r;--r)(n=e[r]).left===e[r+1]?t[r]=new h(n._color,n.key,n.value,t[r+1],n.right,n._count):t[r]=new h(n._color,n.key,n.value,n.left,t[r+1],n._count);if((n=t[t.length-1]).left&&n.right){var i=t.length;for(n=n.left;n.right;)t.push(n),n=n.right;var o=t[i-1];for(t.push(new h(n._color,o.key,o.value,n.left,n.right,n._count)),t[i-1].key=n.key,t[i-1].value=n.value,r=t.length-2;i<=r;--r)n=t[r],t[r]=new h(n._color,n.key,n.value,n.left,t[r+1],n._count);t[i-1].left=t[i]}if((n=t[t.length-1])._color===d){var a=t[t.length-2];for(a.left===n?a.left=null:a.right===n&&(a.right=null),t.pop(),r=0;r<t.length;++r)t[r]._count--;return new v(this.tree._compare,t[0])}if(n.left||n.right){for(n.left?c(n,n.left):n.right&&c(n,n.right),n._color=f,r=0;r<t.length-1;++r)t[r]._count--;return new v(this.tree._compare,t[0])}if(1===t.length)return new v(this.tree._compare,null);for(r=0;r<t.length;++r)t[r]._count--;var s=t[t.length-2];return function(e){for(var t,n,r,i,o=e.length-1;0<=o;--o){if(t=e[o],0===o)return t._color=f;if((n=e[o-1]).left===t){if((r=n.right).right&&r.right._color===d)return i=(r=n.right=l(r)).right=l(r.right),n.right=r.left,r.left=n,r.right=i,r._color=n._color,t._color=f,n._color=f,i._color=f,g(n),g(r),1<o&&((a=e[o-2]).left===n?a.left=r:a.right=r),e[o-1]=r;if(r.left&&r.left._color===d)return i=(r=n.right=l(r)).left=l(r.left),n.right=i.left,r.left=i.right,i.left=n,i.right=r,i._color=n._color,n._color=f,r._color=f,t._color=f,g(n),g(r),g(i),1<o&&((a=e[o-2]).left===n?a.left=i:a.right=i),e[o-1]=i;if(r._color===f){if(n._color===d)return n._color=f,n.right=m(d,r);n.right=m(d,r);continue}r=l(r),n.right=r.left,r.left=n,r._color=n._color,n._color=d,g(n),g(r),1<o&&((a=e[o-2]).left===n?a.left=r:a.right=r),e[o-1]=r,e[o]=n,o+1<e.length?e[o+1]=t:e.push(t),o+=2}else{if((r=n.left).left&&r.left._color===d)return i=(r=n.left=l(r)).left=l(r.left),n.left=r.right,r.right=n,r.left=i,r._color=n._color,t._color=f,n._color=f,i._color=f,g(n),g(r),1<o&&((a=e[o-2]).right===n?a.right=r:a.left=r),e[o-1]=r;if(r.right&&r.right._color===d)return i=(r=n.left=l(r)).right=l(r.right),n.left=i.right,r.right=i.left,i.right=n,i.left=r,i._color=n._color,n._color=f,r._color=f,t._color=f,g(n),g(r),g(i),1<o&&((a=e[o-2]).right===n?a.right=i:a.left=i),e[o-1]=i;if(r._color===f){if(n._color===d)return n._color=f,n.left=m(d,r);n.left=m(d,r);continue}var a;r=l(r),n.left=r.right,r.right=n,r._color=n._color,n._color=d,g(n),g(r),1<o&&((a=e[o-2]).right===n?a.right=r:a.left=r),e[o-1]=r,e[o]=n,o+1<e.length?e[o+1]=t:e.push(t),o+=2}}}(t),s.left===n?s.left=null:s.right=null,new v(this.tree._compare,t[0])},Object.defineProperty(i,"key",{get:function(){if(0<this._stack.length)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(i,"value",{get:function(){if(0<this._stack.length)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(i,"index",{get:function(){var e=0,t=this._stack;if(0===t.length){var n=this.tree.root;return n?n._count:0}t[t.length-1].left&&(e=t[t.length-1].left._count);for(var r=t.length-2;0<=r;--r)t[r+1]===t[r].right&&(++e,t[r].left&&(e+=t[r].left._count));return e},enumerable:!0}),i.next=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.right)for(t=t.right;t;)e.push(t),t=t.left;else for(e.pop();0<e.length&&e[e.length-1].right===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(i,"hasNext",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].right)return!0;for(var t=e.length-1;0<t;--t)if(e[t-1].left===e[t])return!0;return!1}}),i.update=function(e){var t=this._stack;if(0===t.length)throw new Error("Can't update empty node!");var n=new Array(t.length),r=t[t.length-1];n[n.length-1]=new h(r._color,r.key,e,r.left,r.right,r._count);for(var i=t.length-2;0<=i;--i)(r=t[i]).left===t[i+1]?n[i]=new h(r._color,r.key,r.value,n[i+1],r.right,r._count):n[i]=new h(r._color,r.key,r.value,r.left,n[i+1],r._count);return new v(this.tree._compare,n[0])},i.prev=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.left)for(t=t.left;t;)e.push(t),t=t.right;else for(e.pop();0<e.length&&e[e.length-1].left===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(i,"hasPrev",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].left)return!0;for(var t=e.length-1;0<t;--t)if(e[t-1].right===e[t])return!0;return!1}})},{}],163:[function(e,t,n){"use strict";var r=e("react-is"),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},p={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function d(e){return r.isMemo(e)?o:a[e.$$typeof]||i}a[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0};var f=Object.defineProperty,h=Object.getOwnPropertyNames,m=Object.getOwnPropertySymbols,g=Object.getOwnPropertyDescriptor,v=Object.getPrototypeOf,y=Object.prototype;t.exports=function e(t,n,r){if("string"!=typeof n){if(y){var i=v(n);i&&i!==y&&e(t,i,r)}var o=h(n);m&&(o=o.concat(m(n)));for(var a=d(t),s=d(n),l=0;l<o.length;++l){var c=o[l];if(!(p[c]||r&&r[c]||s&&s[c]||a&&a[c])){var u=g(n,c);try{f(t,c,u)}catch(t){}}}}return t}},{"react-is":244}],164:[function(e,t,n){function r(e){this._cbs=e||{},this.events=[]}t.exports=r;var i=e("./").EVENTS;Object.keys(i).forEach(function(n){if(0===i[n])r.prototype[n="on"+n]=function(){this.events.push([n]),this._cbs[n]&&this._cbs[n]()};else if(1===i[n])r.prototype[n="on"+n]=function(e){this.events.push([n,e]),this._cbs[n]&&this._cbs[n](e)};else{if(2!==i[n])throw Error("wrong number of arguments");r.prototype[n="on"+n]=function(e,t){this.events.push([n,e,t]),this._cbs[n]&&this._cbs[n](e,t)}}}),r.prototype.onreset=function(){this.events=[],this._cbs.onreset&&this._cbs.onreset()},r.prototype.restart=function(){this._cbs.onreset&&this._cbs.onreset();for(var e=0,t=this.events.length;e<t;e++)if(this._cbs[this.events[e][0]]){var n=this.events[e].length;1===n?this._cbs[this.events[e][0]]():2===n?this._cbs[this.events[e][0]](this.events[e][1]):this._cbs[this.events[e][0]](this.events[e][1],this.events[e][2])}}},{"./":171}],165:[function(e,t,n){var i=e("domhandler"),r=e("domutils");function o(e,t){this.init(e,t)}function a(e,t){return r.getElementsByTagName(e,t,!0)}function s(e,t){return r.getElementsByTagName(e,t,!0,1)[0]}function l(e,t,n){return r.getText(r.getElementsByTagName(e,t,n,1)).trim()}function c(e,t,n,r,i){var o=l(n,r,i);o&&(e[t]=o)}e("inherits")(o,i),o.prototype.init=i;var u=function(e){return"rss"===e||"feed"===e||"rdf:RDF"===e};o.prototype.onend=function(){var e,t,n={},r=s(u,this.dom);r&&("feed"===r.name?(t=r.children,n.type="atom",c(n,"id","id",t),c(n,"title","title",t),(e=s("link",t))&&(e=e.attribs)&&(e=e.href)&&(n.link=e),c(n,"description","subtitle",t),(e=l("updated",t))&&(n.updated=new Date(e)),c(n,"author","email",t,!0),n.items=a("entry",t).map(function(e){var t,n={};return c(n,"id","id",e=e.children),c(n,"title","title",e),(t=s("link",e))&&(t=t.attribs)&&(t=t.href)&&(n.link=t),(t=l("summary",e)||l("content",e))&&(n.description=t),(t=l("updated",e))&&(n.pubDate=new Date(t)),n})):(t=s("channel",r.children).children,n.type=r.name.substr(0,3),n.id="",c(n,"title","title",t),c(n,"link","link",t),c(n,"description","description",t),(e=l("lastBuildDate",t))&&(n.updated=new Date(e)),c(n,"author","managingEditor",t,!0),n.items=a("item",r.children).map(function(e){var t,n={};return c(n,"id","guid",e=e.children),c(n,"title","title",e),c(n,"link","link",e),c(n,"description","description",e),(t=l("pubDate",e))&&(n.pubDate=new Date(t)),n}))),this.dom=n,i.prototype._handleCallback.call(this,r?null:Error("couldn't find root of feed"))},t.exports=o},{domhandler:141,domutils:144,inherits:174}],166:[function(e,t,n){var r=e("./Tokenizer.js"),i={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},o={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:i,input:i,output:i,button:i,datalist:i,textarea:i,option:{option:!0},optgroup:{optgroup:!0}},a={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},s={__proto__:null,math:!0,svg:!0},l={__proto__:null,mi:!0,mo:!0,mn:!0,ms:!0,mtext:!0,"annotation-xml":!0,foreignObject:!0,desc:!0,title:!0},c=/\s|\//;function u(e,t){this._options=t||{},this._cbs=e||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this._foreignContext=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(r=this._options.Tokenizer),this._tokenizer=new r(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}e("inherits")(u,e("events").EventEmitter),u.prototype._updatePosition=function(e){null===this.endIndex?this._tokenizer._sectionStart<=e?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},u.prototype.ontext=function(e){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(e)},u.prototype.onopentagname=function(e){if(this._lowerCaseTagNames&&(e=e.toLowerCase()),this._tagname=e,!this._options.xmlMode&&e in o)for(var t;(t=this._stack[this._stack.length-1])in o[e];this.onclosetag(t));!this._options.xmlMode&&e in a||(this._stack.push(e),e in s?this._foreignContext.push(!0):e in l&&this._foreignContext.push(!1)),this._cbs.onopentagname&&this._cbs.onopentagname(e),this._cbs.onopentag&&(this._attribs={})},u.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in a&&this._cbs.onclosetag(this._tagname),this._tagname=""},u.prototype.onclosetag=function(e){if(this._updatePosition(1),this._lowerCaseTagNames&&(e=e.toLowerCase()),(e in s||e in l)&&this._foreignContext.pop(),!this._stack.length||e in a&&!this._options.xmlMode)this._options.xmlMode||"br"!==e&&"p"!==e||(this.onopentagname(e),this._closeCurrentTag());else{var t=this._stack.lastIndexOf(e);if(-1!==t)if(this._cbs.onclosetag)for(t=this._stack.length-t;t--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=t;else"p"!==e||this._options.xmlMode||(this.onopentagname(e),this._closeCurrentTag())}},u.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing||this._foreignContext[this._foreignContext.length-1]?this._closeCurrentTag():this.onopentagend()},u.prototype._closeCurrentTag=function(){var e=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===e&&(this._cbs.onclosetag&&this._cbs.onclosetag(e),this._stack.pop())},u.prototype.onattribname=function(e){this._lowerCaseAttributeNames&&(e=e.toLowerCase()),this._attribname=e},u.prototype.onattribdata=function(e){this._attribvalue+=e},u.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},u.prototype._getInstructionName=function(e){var t=e.search(c),n=t<0?e:e.substr(0,t);return this._lowerCaseTagNames&&(n=n.toLowerCase()),n},u.prototype.ondeclaration=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("!"+t,"!"+e)}},u.prototype.onprocessinginstruction=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("?"+t,"?"+e)}},u.prototype.oncomment=function(e){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(e),this._cbs.oncommentend&&this._cbs.oncommentend()},u.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")},u.prototype.onerror=function(e){this._cbs.onerror&&this._cbs.onerror(e)},u.prototype.onend=function(){if(this._cbs.onclosetag)for(var e=this._stack.length;0<e;this._cbs.onclosetag(this._stack[--e]));this._cbs.onend&&this._cbs.onend()},u.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},u.prototype.parseComplete=function(e){this.reset(),this.end(e)},u.prototype.write=function(e){this._tokenizer.write(e)},u.prototype.end=function(e){this._tokenizer.end(e)},u.prototype.pause=function(){this._tokenizer.pause()},u.prototype.resume=function(){this._tokenizer.resume()},u.prototype.parseChunk=u.prototype.write,u.prototype.done=u.prototype.end,t.exports=u},{"./Tokenizer.js":169,events:160,inherits:174}],167:[function(e,t,n){function r(e){this._cbs=e||{}}t.exports=r;var i=e("./").EVENTS;Object.keys(i).forEach(function(n){if(0===i[n])r.prototype[n="on"+n]=function(){this._cbs[n]&&this._cbs[n]()};else if(1===i[n])r.prototype[n="on"+n]=function(e){this._cbs[n]&&this._cbs[n](e)};else{if(2!==i[n])throw Error("wrong number of arguments");r.prototype[n="on"+n]=function(e,t){this._cbs[n]&&this._cbs[n](e,t)}}})},{"./":171}],168:[function(e,t,n){t.exports=i;var r=e("./WritableStream.js");function i(e){r.call(this,new o(this),e)}function o(e){this.scope=e}e("inherits")(i,r),i.prototype.readable=!0;var a=e("../").EVENTS;Object.keys(a).forEach(function(n){if(0===a[n])o.prototype["on"+n]=function(){this.scope.emit(n)};else if(1===a[n])o.prototype["on"+n]=function(e){this.scope.emit(n,e)};else{if(2!==a[n])throw Error("wrong number of arguments!");o.prototype["on"+n]=function(e,t){this.scope.emit(n,e,t)}}})},{"../":171,"./WritableStream.js":170,inherits:174}],169:[function(e,t,n){t.exports=ge;var o=e("entities/lib/decode_codepoint.js"),r=e("entities/maps/entities.json"),i=e("entities/maps/legacy.json"),a=e("entities/maps/xml.json"),s=0,l=s++,c=s++,u=s++,p=s++,d=s++,f=s++,h=s++,m=s++,g=s++,v=s++,y=s++,b=s++,_=s++,w=s++,k=s++,x=s++,E=s++,C=s++,S=s++,T=s++,A=s++,N=s++,O=s++,P=s++,I=s++,D=s++,L=s++,R=s++,j=s++,B=s++,M=s++,F=s++,U=s++,q=s++,H=s++,z=s++,V=s++,W=s++,G=s++,K=s++,X=s++,Y=s++,J=s++,$=s++,Q=s++,Z=s++,ee=s++,te=s++,ne=s++,re=s++,ie=s++,oe=s++,ae=s++,se=s++,le=s++,ce=0,ue=ce++,pe=ce++,de=ce++;function fe(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function he(t,n,r){var i=t.toLowerCase();return t===i?function(e){e===i?this._state=n:(this._state=r,this._index--)}:function(e){e===i||e===t?this._state=n:(this._state=r,this._index--)}}function me(t,n){var r=t.toLowerCase();return function(e){e===r||e===t?this._state=n:(this._state=u,this._index--)}}function ge(e,t){this._state=l,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=l,this._special=ue,this._cbs=t,this._running=!0,this._ended=!1,this._xmlMode=!(!e||!e.xmlMode),this._decodeEntities=!(!e||!e.decodeEntities)}ge.prototype._stateText=function(e){"<"===e?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=c,this._sectionStart=this._index):this._decodeEntities&&this._special===ue&&"&"===e&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=l,this._state=ie,this._sectionStart=this._index)},ge.prototype._stateBeforeTagName=function(e){"/"===e?this._state=d:"<"===e?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===e||this._special!==ue||fe(e)?this._state=l:"!"===e?(this._state=k,this._sectionStart=this._index+1):"?"===e?(this._state=E,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==e&&"S"!==e?u:M,this._sectionStart=this._index)},ge.prototype._stateInTagName=function(e){("/"===e||">"===e||fe(e))&&(this._emitToken("onopentagname"),this._state=m,this._index--)},ge.prototype._stateBeforeCloseingTagName=function(e){fe(e)||(">"===e?this._state=l:this._special!==ue?"s"===e||"S"===e?this._state=F:(this._state=l,this._index--):(this._state=f,this._sectionStart=this._index))},ge.prototype._stateInCloseingTagName=function(e){(">"===e||fe(e))&&(this._emitToken("onclosetag"),this._state=h,this._index--)},ge.prototype._stateAfterCloseingTagName=function(e){">"===e&&(this._state=l,this._sectionStart=this._index+1)},ge.prototype._stateBeforeAttributeName=function(e){">"===e?(this._cbs.onopentagend(),this._state=l,this._sectionStart=this._index+1):"/"===e?this._state=p:fe(e)||(this._state=g,this._sectionStart=this._index)},ge.prototype._stateInSelfClosingTag=function(e){">"===e?(this._cbs.onselfclosingtag(),this._state=l,this._sectionStart=this._index+1):fe(e)||(this._state=m,this._index--)},ge.prototype._stateInAttributeName=function(e){("="===e||"/"===e||">"===e||fe(e))&&(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=v,this._index--)},ge.prototype._stateAfterAttributeName=function(e){"="===e?this._state=y:"/"===e||">"===e?(this._cbs.onattribend(),this._state=m,this._index--):fe(e)||(this._cbs.onattribend(),this._state=g,this._sectionStart=this._index)},ge.prototype._stateBeforeAttributeValue=function(e){'"'===e?(this._state=b,this._sectionStart=this._index+1):"'"===e?(this._state=_,this._sectionStart=this._index+1):fe(e)||(this._state=w,this._sectionStart=this._index,this._index--)},ge.prototype._stateInAttributeValueDoubleQuotes=function(e){'"'===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=m):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=ie,this._sectionStart=this._index)},ge.prototype._stateInAttributeValueSingleQuotes=function(e){"'"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=m):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=ie,this._sectionStart=this._index)},ge.prototype._stateInAttributeValueNoQuotes=function(e){fe(e)||">"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=m,this._index--):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=ie,this._sectionStart=this._index)},ge.prototype._stateBeforeDeclaration=function(e){this._state="["===e?N:"-"===e?C:x},ge.prototype._stateInDeclaration=function(e){">"===e&&(this._cbs.ondeclaration(this._getSection()),this._state=l,this._sectionStart=this._index+1)},ge.prototype._stateInProcessingInstruction=function(e){">"===e&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=l,this._sectionStart=this._index+1)},ge.prototype._stateBeforeComment=function(e){"-"===e?(this._state=S,this._sectionStart=this._index+1):this._state=x},ge.prototype._stateInComment=function(e){"-"===e&&(this._state=T)},ge.prototype._stateAfterComment1=function(e){this._state="-"===e?A:S},ge.prototype._stateAfterComment2=function(e){">"===e?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=l,this._sectionStart=this._index+1):"-"!==e&&(this._state=S)},ge.prototype._stateBeforeCdata1=he("C",O,x),ge.prototype._stateBeforeCdata2=he("D",P,x),ge.prototype._stateBeforeCdata3=he("A",I,x),ge.prototype._stateBeforeCdata4=he("T",D,x),ge.prototype._stateBeforeCdata5=he("A",L,x),ge.prototype._stateBeforeCdata6=function(e){"["===e?(this._state=R,this._sectionStart=this._index+1):(this._state=x,this._index--)},ge.prototype._stateInCdata=function(e){"]"===e&&(this._state=j)},ge.prototype._stateAfterCdata1=function(e){this._state="]"===e?B:R},ge.prototype._stateAfterCdata2=function(e){">"===e?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=l,this._sectionStart=this._index+1):"]"!==e&&(this._state=R)},ge.prototype._stateBeforeSpecial=function(e){"c"===e||"C"===e?this._state=U:"t"===e||"T"===e?this._state=J:(this._state=u,this._index--)},ge.prototype._stateBeforeSpecialEnd=function(e){this._special!==pe||"c"!==e&&"C"!==e?this._special!==de||"t"!==e&&"T"!==e?this._state=l:this._state=ee:this._state=W},ge.prototype._stateBeforeScript1=me("R",q),ge.prototype._stateBeforeScript2=me("I",H),ge.prototype._stateBeforeScript3=me("P",z),ge.prototype._stateBeforeScript4=me("T",V),ge.prototype._stateBeforeScript5=function(e){("/"===e||">"===e||fe(e))&&(this._special=pe),this._state=u,this._index--},ge.prototype._stateAfterScript1=he("R",G,l),ge.prototype._stateAfterScript2=he("I",K,l),ge.prototype._stateAfterScript3=he("P",X,l),ge.prototype._stateAfterScript4=he("T",Y,l),ge.prototype._stateAfterScript5=function(e){">"===e||fe(e)?(this._special=ue,this._state=f,this._sectionStart=this._index-6,this._index--):this._state=l},ge.prototype._stateBeforeStyle1=me("Y",$),ge.prototype._stateBeforeStyle2=me("L",Q),ge.prototype._stateBeforeStyle3=me("E",Z),ge.prototype._stateBeforeStyle4=function(e){("/"===e||">"===e||fe(e))&&(this._special=de),this._state=u,this._index--},ge.prototype._stateAfterStyle1=he("Y",te,l),ge.prototype._stateAfterStyle2=he("L",ne,l),ge.prototype._stateAfterStyle3=he("E",re,l),ge.prototype._stateAfterStyle4=function(e){">"===e||fe(e)?(this._special=ue,this._state=f,this._sectionStart=this._index-5,this._index--):this._state=l},ge.prototype._stateBeforeEntity=he("#",oe,ae),ge.prototype._stateBeforeNumericEntity=he("X",le,se),ge.prototype._parseNamedEntityStrict=function(){if(this._sectionStart+1<this._index){var e=this._buffer.substring(this._sectionStart+1,this._index),t=this._xmlMode?a:r;t.hasOwnProperty(e)&&(this._emitPartial(t[e]),this._sectionStart=this._index+1)}},ge.prototype._parseLegacyEntity=function(){var e=this._sectionStart+1,t=this._index-e;for(6<t&&(t=6);2<=t;){var n=this._buffer.substr(e,t);if(i.hasOwnProperty(n))return this._emitPartial(i[n]),void(this._sectionStart+=t+1);t--}},ge.prototype._stateInNamedEntity=function(e){";"===e?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(e<"a"||"z"<e)&&(e<"A"||"Z"<e)&&(e<"0"||"9"<e)&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==l?"="!==e&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},ge.prototype._decodeNumericEntity=function(e,t){var n=this._sectionStart+e;if(n!==this._index){var r=this._buffer.substring(n,this._index),i=parseInt(r,t);this._emitPartial(o(i)),this._sectionStart=this._index}else this._sectionStart--;this._state=this._baseState},ge.prototype._stateInNumericEntity=function(e){";"===e?(this._decodeNumericEntity(2,10),this._sectionStart++):(e<"0"||"9"<e)&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},ge.prototype._stateInHexEntity=function(e){";"===e?(this._decodeNumericEntity(3,16),this._sectionStart++):(e<"a"||"f"<e)&&(e<"A"||"F"<e)&&(e<"0"||"9"<e)&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},ge.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._bufferOffset+=this._index,this._index=0):this._running&&(this._state===l?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},ge.prototype.write=function(e){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=e,this._parse()},ge.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var e=this._buffer.charAt(this._index);this._state===l?this._stateText(e):this._state===c?this._stateBeforeTagName(e):this._state===u?this._stateInTagName(e):this._state===d?this._stateBeforeCloseingTagName(e):this._state===f?this._stateInCloseingTagName(e):this._state===h?this._stateAfterCloseingTagName(e):this._state===p?this._stateInSelfClosingTag(e):this._state===m?this._stateBeforeAttributeName(e):this._state===g?this._stateInAttributeName(e):this._state===v?this._stateAfterAttributeName(e):this._state===y?this._stateBeforeAttributeValue(e):this._state===b?this._stateInAttributeValueDoubleQuotes(e):this._state===_?this._stateInAttributeValueSingleQuotes(e):this._state===w?this._stateInAttributeValueNoQuotes(e):this._state===k?this._stateBeforeDeclaration(e):this._state===x?this._stateInDeclaration(e):this._state===E?this._stateInProcessingInstruction(e):this._state===C?this._stateBeforeComment(e):this._state===S?this._stateInComment(e):this._state===T?this._stateAfterComment1(e):this._state===A?this._stateAfterComment2(e):this._state===N?this._stateBeforeCdata1(e):this._state===O?this._stateBeforeCdata2(e):this._state===P?this._stateBeforeCdata3(e):this._state===I?this._stateBeforeCdata4(e):this._state===D?this._stateBeforeCdata5(e):this._state===L?this._stateBeforeCdata6(e):this._state===R?this._stateInCdata(e):this._state===j?this._stateAfterCdata1(e):this._state===B?this._stateAfterCdata2(e):this._state===M?this._stateBeforeSpecial(e):this._state===F?this._stateBeforeSpecialEnd(e):this._state===U?this._stateBeforeScript1(e):this._state===q?this._stateBeforeScript2(e):this._state===H?this._stateBeforeScript3(e):this._state===z?this._stateBeforeScript4(e):this._state===V?this._stateBeforeScript5(e):this._state===W?this._stateAfterScript1(e):this._state===G?this._stateAfterScript2(e):this._state===K?this._stateAfterScript3(e):this._state===X?this._stateAfterScript4(e):this._state===Y?this._stateAfterScript5(e):this._state===J?this._stateBeforeStyle1(e):this._state===$?this._stateBeforeStyle2(e):this._state===Q?this._stateBeforeStyle3(e):this._state===Z?this._stateBeforeStyle4(e):this._state===ee?this._stateAfterStyle1(e):this._state===te?this._stateAfterStyle2(e):this._state===ne?this._stateAfterStyle3(e):this._state===re?this._stateAfterStyle4(e):this._state===ie?this._stateBeforeEntity(e):this._state===oe?this._stateBeforeNumericEntity(e):this._state===ae?this._stateInNamedEntity(e):this._state===se?this._stateInNumericEntity(e):this._state===le?this._stateInHexEntity(e):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},ge.prototype.pause=function(){this._running=!1},ge.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},ge.prototype.end=function(e){this._ended&&this._cbs.onerror(Error(".end() after done!")),e&&this.write(e),this._ended=!0,this._running&&this._finish()},ge.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},ge.prototype._handleTrailingData=function(){var e=this._buffer.substr(this._sectionStart);this._state===R||this._state===j||this._state===B?this._cbs.oncdata(e):this._state===S||this._state===T||this._state===A?this._cbs.oncomment(e):this._state!==ae||this._xmlMode?this._state!==se||this._xmlMode?this._state!==le||this._xmlMode?this._state!==u&&this._state!==m&&this._state!==y&&this._state!==v&&this._state!==g&&this._state!==_&&this._state!==b&&this._state!==w&&this._state!==f&&this._cbs.ontext(e):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},ge.prototype.reset=function(){ge.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},ge.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},ge.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},ge.prototype._emitToken=function(e){this._cbs[e](this._getSection()),this._sectionStart=-1},ge.prototype._emitPartial=function(e){this._baseState!==l?this._cbs.onattribdata(e):this._cbs.ontext(e)}},{"entities/lib/decode_codepoint.js":152,"entities/maps/entities.json":154,"entities/maps/legacy.json":155,"entities/maps/xml.json":156}],170:[function(e,t,n){t.exports=s;var i=e("./Parser.js"),o=e("readable-stream").Writable,a=e("string_decoder").StringDecoder,r=e("buffer").Buffer;function s(e,t){var n=this._parser=new i(e,t),r=this._decoder=new a;o.call(this,{decodeStrings:!1}),this.once("finish",function(){n.end(r.end())})}e("inherits")(s,o),s.prototype._write=function(e,t,n){e instanceof r&&(e=this._decoder.write(e)),this._parser.write(e),n()}},{"./Parser.js":166,buffer:117,inherits:174,"readable-stream":116,string_decoder:313}],171:[function(e,r,t){var i=e("./Parser.js"),o=e("domhandler");function n(e,t){return delete r.exports[e],r.exports[e]=t}r.exports={Parser:i,Tokenizer:e("./Tokenizer.js"),ElementType:e("domelementtype"),DomHandler:o,get FeedHandler(){return n("FeedHandler",e("./FeedHandler.js"))},get Stream(){return n("Stream",e("./Stream.js"))},get WritableStream(){return n("WritableStream",e("./WritableStream.js"))},get ProxyHandler(){return n("ProxyHandler",e("./ProxyHandler.js"))},get DomUtils(){return n("DomUtils",e("domutils"))},get CollectingHandler(){return n("CollectingHandler",e("./CollectingHandler.js"))},DefaultHandler:o,get RssHandler(){return n("RssHandler",this.FeedHandler)},parseDOM:function(e,t){var n=new o(t);return new i(n,t).end(e),n.dom},parseFeed:function(e,t){var n=new r.exports.FeedHandler(t);return new i(n,t).end(e),n.dom},createDomStream:function(e,t,n){var r=new o(e,t,n);return new i(r,t)},EVENTS:{attribute:2,cdatastart:0,cdataend:0,text:1,processinginstruction:2,comment:1,commentend:0,closetag:1,opentag:2,opentagname:1,error:1,end:0}}},{"./CollectingHandler.js":164,"./FeedHandler.js":165,"./Parser.js":166,"./ProxyHandler.js":167,"./Stream.js":168,"./Tokenizer.js":169,"./WritableStream.js":170,domelementtype:140,domhandler:141,domutils:144}],172:[function(e,t,n){n.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,p=n?i-1:0,d=n?-1:1,f=e[t+p];for(p+=d,o=f&(1<<-u)-1,f>>=-u,u+=s;0<u;o=256*o+e[t+p],p+=d,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=r;0<u;a=256*a+e[t+p],p+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=c}return(f?-1:1)*a*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var a,s,l,c=8*o-i-1,u=(1<<c)-1,p=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),2<=(t+=1<=a+p?d/l:d*Math.pow(2,1-p))*l&&(a++,l/=2),u<=a+p?(s=0,a=u):1<=a+p?(s=(t*l-1)*Math.pow(2,i),a+=p):(s=t*Math.pow(2,p-1)*Math.pow(2,i),a=0));8<=i;e[n+f]=255&s,f+=h,s/=256,i-=8);for(a=a<<i|s,c+=i;0<c;e[n+f]=255&a,f+=h,a/=256,c-=8);e[n+f-h]|=128*m}},{}],173:[function(e,u,t){(function(t){"use strict";var n,r,e=t.MutationObserver||t.WebKitMutationObserver;if(e){var i=0,o=new e(c),a=t.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=i=++i%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)};else{var s=new t.MessageChannel;s.port1.onmessage=c,n=function(){s.port2.postMessage(0)}}var l=[];function c(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}u.exports=function(e){1!==l.push(e)||r||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],174:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},{}],175:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,i,o,a,s){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,i,o,a,s],u=0;(l=new Error(t.replace(/%s/g,function(){return c[u++]}))).name="Invariant Violation"}throw l.framesToPop=1,l}}},{}],176:[function(e,t,n){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(r(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&r(t.slice(0,0))||!!e._isBuffer);var t}},{}],177:[function(e,t,n){var r={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},{}],178:[function(e,t,n){(function(){var t=Array.prototype.slice,r=Array.prototype.forEach,i=function(n){if("object"!=typeof n)throw n+" is not an object";var e=t.call(arguments,1);return r.call(e,function(e){if(e)for(var t in e)"object"==typeof e[t]&&n[t]?i.call(n,n[t],e[t]):n[t]=e[t]}),n};this.extend=i}).call(this)},{}],179:[function(e,t,n){var r=e("./lib/encodings");function i(e){this.opts=e||{},this.encodings=r}(t.exports=i).prototype._encoding=function(e){return"string"==typeof e&&(e=r[e]),e||(e=r.id),e},i.prototype._keyEncoding=function(e,t){return this._encoding(t&&t.keyEncoding||e&&e.keyEncoding||this.opts.keyEncoding)},i.prototype._valueEncoding=function(e,t){return this._encoding(t&&(t.valueEncoding||t.encoding)||e&&(e.valueEncoding||e.encoding)||this.opts.valueEncoding||this.opts.encoding)},i.prototype.encodeKey=function(e,t,n){return this._keyEncoding(t,n).encode(e)},i.prototype.encodeValue=function(e,t,n){return this._valueEncoding(t,n).encode(e)},i.prototype.decodeKey=function(e,t){return this._keyEncoding(t).decode(e)},i.prototype.decodeValue=function(e,t){return this._valueEncoding(t).decode(e)},i.prototype.encodeBatch=function(e,n){var r=this;return e.map(function(e){var t={type:e.type,key:r.encodeKey(e.key,n,e)};return r.keyAsBuffer(n,e)&&(t.keyEncoding="binary"),e.prefix&&(t.prefix=e.prefix),"value"in e&&(t.value=r.encodeValue(e.value,n,e),r.valueAsBuffer(n,e)&&(t.valueEncoding="binary")),t})};var o=["lt","gt","lte","gte","start","end"];i.prototype.encodeLtgt=function(t){var n=this,r={};return Object.keys(t).forEach(function(e){r[e]=-1<o.indexOf(e)?n.encodeKey(t[e],t):t[e]}),r},i.prototype.createStreamDecoder=function(n){var r=this;return n.keys&&n.values?function(e,t){return{key:r.decodeKey(e,n),value:r.decodeValue(t,n)}}:n.keys?function(e){return r.decodeKey(e,n)}:n.values?function(e,t){return r.decodeValue(t,n)}:function(){}},i.prototype.keyAsBuffer=function(e){return this._keyEncoding(e).buffer},i.prototype.valueAsBuffer=function(e){return this._valueEncoding(e).buffer}},{"./lib/encodings":180}],180:[function(e,t,i){(function(n){i.utf8=i["utf-8"]={encode:function(e){return r(e)?e:String(e)},decode:e,buffer:!1,type:"utf8"},i.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},i.binary={encode:function(e){return r(e)?e:new n(e)},decode:e,buffer:!0,type:"binary"},i.id={encode:function(e){return e},decode:function(e){return e},buffer:!1,type:"id"};function e(e){return e}function r(e){return null==e||n.isBuffer(e)}["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(t){i[t]={encode:function(e){return r(e)?e:new n(e,t)},decode:function(e){return e.toString(t)},buffer:!0,type:t}})}).call(this,e("buffer").Buffer)},{buffer:117}],181:[function(e,t,n){var r=e("errno").create,i=r("LevelUPError"),o=r("NotFoundError",i);o.prototype.notFound=!0,o.prototype.status=404,t.exports={LevelUPError:i,InitializationError:r("InitializationError",i),OpenError:r("OpenError",i),ReadError:r("ReadError",i),WriteError:r("WriteError",i),NotFoundError:o,EncodingError:r("EncodingError",i)}},{errno:158}],182:[function(e,t,n){var r=e("inherits"),i=e("readable-stream").Readable,o=e("xtend"),a=e("level-errors").EncodingError;function s(e,t){if(!(this instanceof s))return new s(e,t);i.call(this,o(t,{objectMode:!0})),this._iterator=e,this._destroyed=!1,this._decoder=null,t&&t.decoder&&(this._decoder=t.decoder),this.on("end",this._cleanup.bind(this))}r(t.exports=s,i),s.prototype._read=function(){var r=this;this._destroyed||this._iterator.next(function(e,t,n){if(!r._destroyed){if(e)return r.emit("error",e);if(void 0===t&&void 0===n)r.push(null);else{if(!r._decoder)return r.push({key:t,value:n});try{n=r._decoder(t,n)}catch(e){return r.emit("error",new a(e)),void r.push(null)}r.push(n)}}})},s.prototype.destroy=s.prototype._cleanup=function(){var t=this;this._destroyed||(this._destroyed=!0,this._iterator.end(function(e){if(e)return t.emit("error",e);t.emit("close")}))}},{inherits:174,"level-errors":181,"readable-stream":189,xtend:341}],183:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],184:[function(s,l,e){(function(e){l.exports=o;var t=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},n=s("core-util-is");n.inherits=s("inherits");var r=s("./_stream_readable"),i=s("./_stream_writable");function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),i.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",a)}function a(){this.allowHalfOpen||this._writableState.ended||e.nextTick(this.end.bind(this))}n.inherits(o,r),function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}(t(i.prototype),function(e){o.prototype[e]||(o.prototype[e]=i.prototype[e])})}).call(this,s("_process"))},{"./_stream_readable":186,"./_stream_writable":188,_process:234,"core-util-is":119,inherits:174}],185:[function(e,t,n){t.exports=o;var r=e("./_stream_transform"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=e("inherits"),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":187,"core-util-is":119,inherits:174}],186:[function(_,e,t){(function(m){e.exports=n;var g=_("isarray"),d=_("buffer").Buffer;n.ReadableState=t;var v=_("events").EventEmitter;v.listenerCount||(v.listenerCount=function(e,t){return e.listeners(t).length});var o,a=_("stream"),f=_("core-util-is");f.inherits=_("inherits");var y=_("util");function t(e,t){var n=_("./_stream_duplex"),r=(e=e||{}).highWaterMark,i=e.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,t instanceof n&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(o||(o=_("string_decoder/").StringDecoder),this.decoder=new o(e.encoding),this.encoding=e.encoding)}function n(e){if(_("./_stream_duplex"),!(this instanceof n))return new n(e);this._readableState=new t(e,this),this.readable=!0,a.call(this)}function r(e,t,n,r,i){var o,a,s,l,c,u,p=(o=t,a=n,s=null,f.isBuffer(a)||f.isString(a)||f.isNullOrUndefined(a)||o.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s);if(p)e.emit("error",p);else if(f.isNullOrUndefined(n))t.reading=!1,t.ended||function(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,h(e)}(e,t);else if(t.objectMode||n&&0<n.length)if(t.ended&&!i){var d=new Error("stream.push() after EOF");e.emit("error",d)}else t.endEmitted&&i?(d=new Error("stream.unshift() after end event"),e.emit("error",d)):(!t.decoder||i||r||(n=t.decoder.write(n)),i||(t.reading=!1),t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&h(e)),l=e,(c=t).readingMore||(c.readingMore=!0,m.nextTick(function(){!function(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(y("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}(l,c)})));else i||(t.reading=!1);return!(u=t).ended&&(u.needReadable||u.length<u.highWaterMark||0===u.length)}y=y&&y.debuglog?y.debuglog("stream"):function(){},f.inherits(n,a),n.prototype.push=function(e,t){var n=this._readableState;return f.isString(e)&&!n.objectMode&&(t=t||n.defaultEncoding)!==n.encoding&&(e=new d(e,t),t=""),r(this,n,e,t,!1)},n.prototype.unshift=function(e){return r(this,this._readableState,e,"",!0)},n.prototype.setEncoding=function(e){return o||(o=_("string_decoder/").StringDecoder),this._readableState.decoder=new o(e),this._readableState.encoding=e,this};var i=8388608;function s(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:isNaN(e)||f.isNull(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=function(e){if(i<=e)e=i;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function h(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(y("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?m.nextTick(function(){l(e)}):l(e))}function l(e){y("emit readable"),e.emit("readable"),b(e)}function c(n,r){r.resumeScheduled||(r.resumeScheduled=!0,m.nextTick(function(){var e,t;e=n,(t=r).resumeScheduled=!1,e.emit("resume"),b(e),t.flowing&&!t.reading&&e.read(0)}))}function b(e){var t=e._readableState;if(y("flow",t.flowing),t.flowing)do{var n=e.read()}while(null!==n&&t.flowing)}function u(e,t){var n,r=t.buffer,i=t.length,o=!!t.decoder,a=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(a)n=r.shift();else if(!e||i<=e)n=o?r.join(""):d.concat(r,i),r.length=0;else if(e<r[0].length)n=(u=r[0]).slice(0,e),r[0]=u.slice(e);else if(e===r[0].length)n=r.shift();else{n=o?"":new d(e);for(var s=0,l=0,c=r.length;l<c&&s<e;l++){var u=r[0],p=Math.min(e-s,u.length);o?n+=u.slice(0,p):u.copy(n,s,0,p),p<u.length?r[0]=u.slice(p):r.shift(),s+=p}}return n}function p(e){var t=e._readableState;if(0<t.length)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,m.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}n.prototype.read=function(e){y("read",e);var t=this._readableState,n=e;if((!f.isNumber(e)||0<e)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return y("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?p(this):h(this),null;if(0===(e=s(e,t))&&t.ended)return 0===t.length&&p(this),null;var r,i=t.needReadable;return y("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&y("length less than watermark",i=!0),(t.ended||t.reading)&&y("reading or ended",i=!1),i&&(y("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=s(n,t)),r=0<e?u(e,t):null,f.isNull(r)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),n!==e&&t.ended&&0===t.length&&p(this),f.isNull(r)||this.emit("data",r),r},n.prototype._read=function(e){this.emit("error",new Error("not implemented"))},n.prototype.pipe=function(t,e){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t)}r.pipesCount+=1,y("pipe count=%d opts=%j",r.pipesCount,e);var i=e&&!1===e.end||t===m.stdout||t===m.stderr?c:a;function o(e){y("onunpipe"),e===n&&c()}function a(){y("onend"),t.end()}r.endEmitted?m.nextTick(i):n.once("end",i),t.on("unpipe",o);var s,l=(s=n,function(){var e=s._readableState;y("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&v.listenerCount(s,"data")&&(e.flowing=!0,b(s))});function c(){y("cleanup"),t.removeListener("close",d),t.removeListener("finish",f),t.removeListener("drain",l),t.removeListener("error",p),t.removeListener("unpipe",o),n.removeListener("end",a),n.removeListener("end",c),n.removeListener("data",u),!r.awaitDrain||t._writableState&&!t._writableState.needDrain||l()}function u(e){y("ondata"),!1===t.write(e)&&(y("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,n.pause())}function p(e){y("onerror",e),h(),t.removeListener("error",p),0===v.listenerCount(t,"error")&&t.emit("error",e)}function d(){t.removeListener("finish",f),h()}function f(){y("onfinish"),t.removeListener("close",d),h()}function h(){y("unpipe"),n.unpipe(t)}return t.on("drain",l),n.on("data",u),t._events&&t._events.error?g(t._events.error)?t._events.error.unshift(p):t._events.error=[p,t._events.error]:t.on("error",p),t.once("close",d),t.once("finish",f),t.emit("pipe",n),r.flowing||(y("pipe resume"),n.resume()),t},n.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}return-1===(i=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}(t.pipes,e))||(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},n.prototype.addListener=n.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&this.readable){var r=this._readableState;if(!r.readableListening)if(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading)r.length&&h(this);else{var i=this;m.nextTick(function(){y("readable nexttick read 0"),i.read(0)})}}return n},n.prototype.resume=function(){var e=this._readableState;return e.flowing||(y("resume"),e.flowing=!0,e.reading||(y("resume read 0"),this.read(0)),c(this,e)),this},n.prototype.pause=function(){return y("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(y("pause"),this._readableState.flowing=!1,this.emit("pause")),this},n.prototype.wrap=function(t){var n=this._readableState,r=!1,i=this;for(var e in t.on("end",function(){if(y("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&i.push(e)}i.push(null)}),t.on("data",function(e){y("wrapped data"),n.decoder&&(e=n.decoder.write(e)),e&&(n.objectMode||e.length)&&(i.push(e)||(r=!0,t.pause()))}),t)f.isFunction(t[e])&&f.isUndefined(this[e])&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));return function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}(["error","close","destroy","pause","resume"],function(e){t.on(e,i.emit.bind(i,e))}),i._read=function(e){y("wrapped _read",e),r&&(r=!1,t.resume())},i},n._fromList=u}).call(this,_("_process"))},{"./_stream_duplex":184,_process:234,buffer:117,"core-util-is":119,events:160,inherits:174,isarray:183,stream:312,"string_decoder/":190,util:116}],187:[function(e,t,n){t.exports=o;var r=e("./_stream_duplex"),a=e("core-util-is");function i(e,n){this.afterTransform=function(e,t){return function(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,a.isNullOrUndefined(n)||e.push(n),i&&i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(n,e,t)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState=new i(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("prefinish",function(){a.isFunction(this._flush)?this._flush(function(e){s(t,e)}):s(t)})}function s(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=e._transformState;if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}a.inherits=e("inherits"),a.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;a.isNull(t.writechunk)||!t.writecb||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))}},{"./_stream_duplex":184,"core-util-is":119,inherits:174}],188:[function(a,e,t){(function(d){e.exports=i;var u=a("buffer").Buffer;i.WritableState=r;var p=a("core-util-is");p.inherits=a("inherits");var n=a("stream");function f(e,t,n){this.chunk=e,this.encoding=t,this.callback=n}function r(e,t){var n=a("./_stream_duplex"),r=(e=e||{}).highWaterMark,i=e.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.objectMode=!!e.objectMode,t instanceof n&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1;var o=(this.finished=!1)===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(p=n,p.writing=!1,p.writecb=null,p.length-=p.writelen,p.writelen=0,t)a=e,s=n,l=r,c=t,u=i,l?d.nextTick(function(){s.pendingcb--,u(c)}):(s.pendingcb--,u(c)),a._writableState.errorEmitted=!0,a.emit("error",c);else{var o=v(e,n);o||n.corked||n.bufferProcessing||!n.buffer.length||g(e,n),r?d.nextTick(function(){m(e,n,o,i)}):m(e,n,o,i)}var a,s,l,c,u;var p}(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function i(e){var t=a("./_stream_duplex");if(!(this instanceof i||this instanceof t))return new i(e);this._writableState=new r(e,this),this.writable=!0,n.call(this)}function l(e,t,n,r,i){var o,a,s;a=n,s=r,!(o=t).objectMode&&!1!==o.decodeStrings&&p.isString(a)&&(a=new u(a,s)),n=a,p.isBuffer(n)&&(r="buffer");var l=t.objectMode?1:n.length;t.length+=l;var c=t.length<t.highWaterMark;return c||(t.needDrain=!0),t.writing||t.corked?t.buffer.push(new f(n,r,i)):h(e,t,!1,l,n,r,i),c}function h(e,t,n,r,i,o,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function m(e,t,n,r){var i,o;n||(i=e,0===(o=t).length&&o.needDrain&&(o.needDrain=!1,i.emit("drain"))),t.pendingcb--,r(),s(e,t)}function g(e,n){if(n.bufferProcessing=!0,e._writev&&1<n.buffer.length){for(var r=[],t=0;t<n.buffer.length;t++)r.push(n.buffer[t].callback);n.pendingcb++,h(e,n,!0,n.length,n.buffer,"",function(e){for(var t=0;t<r.length;t++)n.pendingcb--,r[t](e)}),n.buffer=[]}else{for(t=0;t<n.buffer.length;t++){var i=n.buffer[t],o=i.chunk,a=i.encoding,s=i.callback,l=n.objectMode?1:o.length;if(h(e,n,!1,l,o,a,s),n.writing){t++;break}}t<n.buffer.length?n.buffer=n.buffer.slice(t):n.buffer.length=0}n.bufferProcessing=!1}function v(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function o(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function s(e,t){var n=v(0,t);return n&&(0===t.pendingcb?(o(e,t),t.finished=!0,e.emit("finish")):o(e,t)),n}p.inherits(i,n),i.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},i.prototype.write=function(e,t,n){var r,i,o,a=this._writableState,s=!1;return p.isFunction(t)&&(n=t,t=null),p.isBuffer(e)?t="buffer":t||(t=a.defaultEncoding),p.isFunction(n)||(n=function(){}),a.ended?(r=this,i=n,o=new Error("write after end"),r.emit("error",o),d.nextTick(function(){i(o)})):function(e,t,n,r){var i=!0;if(!(p.isBuffer(n)||p.isString(n)||p.isNullOrUndefined(n)||t.objectMode)){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),d.nextTick(function(){r(o)}),i=!1}return i}(this,a,e,n)&&(a.pendingcb++,s=l(this,a,e,t,n)),s},i.prototype.cork=function(){this._writableState.corked++},i.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.buffer.length||g(this,e))},i.prototype._write=function(e,t,n){n(new Error("not implemented"))},i.prototype._writev=null,i.prototype.end=function(e,t,n){var r,i,o,a=this._writableState;p.isFunction(e)?(n=e,t=e=null):p.isFunction(t)&&(n=t,t=null),p.isNullOrUndefined(e)||this.write(e,t),a.corked&&(a.corked=1,this.uncork()),a.ending||a.finished||(r=this,o=n,(i=a).ending=!0,s(r,i),o&&(i.finished?d.nextTick(o):r.once("finish",o)),i.ended=!0)}}).call(this,a("_process"))},{"./_stream_duplex":184,_process:234,buffer:117,"core-util-is":119,inherits:174,stream:312}],189:[function(t,n,r){(function(e){(r=n.exports=t("./lib/_stream_readable.js")).Stream=t("stream"),(r.Readable=r).Writable=t("./lib/_stream_writable.js"),r.Duplex=t("./lib/_stream_duplex.js"),r.Transform=t("./lib/_stream_transform.js"),r.PassThrough=t("./lib/_stream_passthrough.js"),e.browser||"disable"!==e.env.READABLE_STREAM||(n.exports=t("stream"))}).call(this,t("_process"))},{"./lib/_stream_duplex.js":184,"./lib/_stream_passthrough.js":185,"./lib/_stream_readable.js":186,"./lib/_stream_transform.js":187,"./lib/_stream_writable.js":188,_process:234,stream:312}],190:[function(e,t,n){var r=e("buffer").Buffer,i=r.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};var o=n.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!i(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=s;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=l;break;default:return void(this.write=a)}this.charBuffer=new r(6),this.charReceived=0,this.charLength=0};function a(e){return e.toString(this.encoding)}function s(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function l(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}o.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!(55296<=(r=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r,i=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),i=(t+=e.toString(this.encoding,0,i)).length-1,55296<=(r=t.charCodeAt(i))&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},o.prototype.detectIncompleteChar=function(e){for(var t=3<=e.length?3:e.length;0<t;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},o.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},{buffer:117}],191:[function(e,t,n){var r=e("./util"),o=e("level-errors").WriteError,a=r.getOptions,i=r.dispatchError;function s(e,t){this._levelup=e,this._codec=t,this.batch=e.db.batch(),this.ops=[],this.length=0}s.prototype.put=function(e,t,n){n=a(n);var r=this._codec.encodeKey(e,n),i=this._codec.encodeValue(t,n);try{this.batch.put(r,i)}catch(e){throw new o(e)}return this.ops.push({type:"put",key:r,value:i}),this.length++,this},s.prototype.del=function(e,t){t=a(t);var n=this._codec.encodeKey(e,t);try{this.batch.del(n)}catch(e){throw new o(e)}return this.ops.push({type:"del",key:n}),this.length++,this},s.prototype.clear=function(){try{this.batch.clear()}catch(e){throw new o(e)}return this.ops=[],this.length=0,this},s.prototype.write=function(t){var n=this._levelup,r=this.ops;try{this.batch.write(function(e){if(e)return i(n,new o(e),t);n.emit("batch",r),t&&t()})}catch(t){throw new o(t)}},t.exports=s},{"./util":193,"level-errors":181}],192:[function(A,N,e){(function(i){var o=A("events").EventEmitter,e=A("util").inherits,t=A("util").deprecate,a=A("xtend"),s=A("prr"),l=A("deferred-leveldown"),n=A("level-iterator-stream"),r=A("level-errors"),c=r.WriteError,u=r.ReadError,p=r.NotFoundError,d=r.OpenError,f=r.EncodingError,h=r.InitializationError,m=A("./util"),g=A("./batch"),v=A("level-codec"),y=m.getOptions,b=m.defaultOptions,_=m.getLevelDOWN,w=m.dispatchError;m.isDefined;function k(e,t){return"function"==typeof e?e:t}function x(e,t,n){if(!(this instanceof x))return new x(e,t,n);var r;if(o.call(this),this.setMaxListeners(1/0),"function"==typeof e?((t="object"==typeof t?t:{}).db=e,e=null):"object"==typeof e&&"function"==typeof e.db&&(t=e,e=null),"function"==typeof t&&(n=t,t={}),(!t||"function"!=typeof t.db)&&"string"!=typeof e){if(r=new h("Must provide a location for the database"),n)return i.nextTick(function(){n(r)});throw r}t=y(t),this.options=a(b,t),this._codec=new v(this.options),this._status="new",s(this,"location",e,"e"),this.open(n)}function E(e,t,n){if(!e._isOpening()&&!e.isOpen())return w(e,new u("Database is not open"),n),!0}function C(e,t,n){w(e,new c(t),n)}function S(e,t,n){w(e,new u(t),n)}function T(n){return function(e,t){_()[n](e,t||function(){})}}e(x,o),x.prototype.open=function(t){var e,n,r=this;return this.isOpen()?(t&&i.nextTick(function(){t(null,r)}),this):this._isOpening()?t&&this.once("open",function(){t(null,r)}):(this.emit("opening"),this._status="opening",this.db=new l(this.location),e=this.options.db||_(),void(n=e(this.location)).open(this.options,function(e){if(e)return w(r,new d(e),t);r.db.setDb(n),r.db=n,r._status="open",t&&t(null,r),r.emit("open"),r.emit("ready")}))},x.prototype.close=function(e){var t=this;if(this.isOpen())this._status="closing",this.db.close(function(){t._status="closed",t.emit("closed"),e&&e.apply(null,arguments)}),this.emit("closing"),this.db=new l(this.location);else{if("closed"==this._status&&e)return i.nextTick(e);"closing"==this._status&&e?this.once("closed",e):this._isOpening()&&this.once("open",function(){t.close(e)})}},x.prototype.isOpen=function(){return"open"==this._status},x.prototype._isOpening=function(){return"opening"==this._status},x.prototype.isClosed=function(){return/^clos/.test(this._status)},x.prototype.get=function(n,r,i){var e,o=this;if(!E(this,0,i=k(r,i))){if(null==n||"function"!=typeof i)return S(this,"get() requires key and callback arguments",i);r=m.getOptions(r),e=this._codec.encodeKey(n,r),r.asBuffer=this._codec.valueAsBuffer(r),this.db.get(e,r,function(e,t){if(e)return e=/notfound/i.test(e)||e.notFound?new p("Key not found in database ["+n+"]",e):new u(e),w(o,e,i);if(i){try{t=o._codec.decodeValue(t,r)}catch(e){return i(new f(e))}i(null,t)}})}},x.prototype.put=function(t,n,e,r){var i,o,a=this;if(r=k(e,r),null==t)return C(this,"put() requires a key argument",r);E(this,0,r)||(e=y(e),i=this._codec.encodeKey(t,e),o=this._codec.encodeValue(n,e),this.db.put(i,o,e,function(e){if(e)return w(a,new c(e),r);a.emit("put",t,n),r&&r()}))},x.prototype.del=function(t,e,n){var r,i=this;if(n=k(e,n),null==t)return C(this,"del() requires a key argument",n);E(this,0,n)||(e=y(e),r=this._codec.encodeKey(t,e),this.db.del(r,e,function(e){if(e)return w(i,new c(e),n);i.emit("del",t),n&&n()}))},x.prototype.batch=function(t,e,n){var r,i=this;return arguments.length?(n=k(e,n),Array.isArray(t)?void(E(this,0,n)||(e=y(e),r=(r=i._codec.encodeBatch(t,e)).map(function(e){return e.type||void 0===e.key||void 0===e.value||(e.type="put"),e}),this.db.batch(r,e,function(e){if(e)return w(i,new c(e),n);i.emit("batch",t),n&&n()}))):C(this,"batch() requires an array argument",n)):new g(this,this._codec)},x.prototype.approximateSize=t(function(e,t,n,r){var i,o,a=this;if(r=k(n,r),n=y(n),null==e||null==t||"function"!=typeof r)return S(this,"approximateSize() requires start, end and callback arguments",r);i=this._codec.encodeKey(e,n),o=this._codec.encodeKey(t,n),this.db.approximateSize(i,o,function(e,t){if(e)return w(a,new d(e),r);r&&r(null,t)})},"db.approximateSize() is deprecated. Use db.db.approximateSize() instead"),x.prototype.readStream=x.prototype.createReadStream=function(e){return(e=a({keys:!0,values:!0},this.options,e)).keyEncoding=e.keyEncoding,e.valueEncoding=e.valueEncoding,(e=this._codec.encodeLtgt(e)).keyAsBuffer=this._codec.keyAsBuffer(e),e.valueAsBuffer=this._codec.valueAsBuffer(e),"number"!=typeof e.limit&&(e.limit=-1),new n(this.db.iterator(e),a(e,{decoder:this._codec.createStreamDecoder(e)}))},x.prototype.keyStream=x.prototype.createKeyStream=function(e){return this.createReadStream(a(e,{keys:!0,values:!1}))},x.prototype.valueStream=x.prototype.createValueStream=function(e){return this.createReadStream(a(e,{keys:!1,values:!0}))},x.prototype.toString=function(){return"LevelUP"},N.exports=x,N.exports.errors=A("level-errors"),N.exports.destroy=t(T("destroy"),"levelup.destroy() is deprecated. Use leveldown.destroy() instead"),N.exports.repair=t(T("repair"),"levelup.repair() is deprecated. Use leveldown.repair() instead")}).call(this,A("_process"))},{"./batch":191,"./util":193,_process:234,"deferred-leveldown":123,events:160,"level-codec":179,"level-errors":181,"level-iterator-stream":182,prr:238,util:338,xtend:341}],193:[function(n,e,t){n("xtend");var r,i=n("level-errors").LevelUPError,o=n("util").format;function a(e){return new i(o("Failed to require LevelDOWN (%s). Try `npm install leveldown` if it's missing",e.message))}e.exports={defaultOptions:{createIfMissing:!0,errorIfExists:!1,keyEncoding:"utf8",valueEncoding:"utf8",compression:!0},getOptions:function(e){return"string"==typeof e&&(e={valueEncoding:e}),"object"!=typeof e&&(e={}),e},getLevelDOWN:function(){if(r)return r;var e,t=n("../package.json").devDependencies.leveldown;try{e=n("leveldown/package").version}catch(e){throw a(e)}if(!n("semver").satisfies(e,t))throw new i("Installed version of LevelDOWN ("+e+") does not match required version ("+t+")");try{return r=n("leveldown")}catch(e){throw a(e)}},dispatchError:function(e,t,n){"function"==typeof n?n(t):e.emit("error",t)},isDefined:function(e){return void 0!==e}}},{"../package.json":194,"level-errors":181,leveldown:116,"leveldown/package":116,semver:116,util:338,xtend:341}],194:[function(e,t,n){t.exports={_from:"levelup@1.3.2",_id:"levelup@1.3.2",_inBundle:!1,_integrity:"sha1-syHTBx8OdcLfry8P6IZOW5o4e8k=",_location:"/levelup",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"levelup@1.3.2",name:"levelup",escapedName:"levelup",rawSpec:"1.3.2",saveSpec:null,fetchSpec:"1.3.2"},_requiredBy:["/pouchdb"],_resolved:"https://registry.npmjs.org/levelup/-/levelup-1.3.2.tgz",_shasum:"b321d3071f0e75c2dfaf2f0fe8864e5b9a387bc9",_spec:"levelup@1.3.2",_where:"/home/travis/build/microsoft/pxt/node_modules/pouchdb",browser:{leveldown:!1,"leveldown/package":!1,semver:!1},bugs:{url:"https://github.com/level/levelup/issues"},bundleDependencies:!1,contributors:[{name:"Rod Vagg",email:"r@va.gg",url:"https://github.com/rvagg"},{name:"John Chesley",email:"john@chesl.es",url:"https://github.com/chesles/"},{name:"Jake Verbaten",email:"raynos2@gmail.com",url:"https://github.com/raynos"},{name:"Dominic Tarr",email:"dominic.tarr@gmail.com",url:"https://github.com/dominictarr"},{name:"Max Ogden",email:"max@maxogden.com",url:"https://github.com/maxogden"},{name:"Lars-Magnus Skog",email:"ralphtheninja@riseup.net",url:"https://github.com/ralphtheninja"},{name:"David Bjrklund",email:"david.bjorklund@gmail.com",url:"https://github.com/kesla"},{name:"Julian Gruber",email:"julian@juliangruber.com",url:"https://github.com/juliangruber"},{name:"Paolo Fragomeni",email:"paolo@async.ly",url:"https://github.com/0x00a"},{name:"Anton Whalley",email:"anton.whalley@nearform.com",url:"https://github.com/No9"},{name:"Matteo Collina",email:"matteo.collina@gmail.com",url:"https://github.com/mcollina"},{name:"Pedro Teixeira",email:"pedro.teixeira@gmail.com",url:"https://github.com/pgte"},{name:"James Halliday",email:"mail@substack.net",url:"https://github.com/substack"},{name:"Jarrett Cruger",email:"jcrugzz@gmail.com",url:"https://github.com/jcrugzz"}],dependencies:{"deferred-leveldown":"~1.2.1","level-codec":"~6.1.0","level-errors":"~1.0.3","level-iterator-stream":"~1.3.0",prr:"~1.0.1",semver:"~5.1.0",xtend:"~4.0.0"},deprecated:!1,description:"Fast & simple storage - a Node.js-style LevelDB wrapper",devDependencies:{async:"~1.5.0",bustermove:"~1.0.0",delayed:"~1.0.1",faucet:"~0.0.1",leveldown:"^1.1.0",memdown:"~1.1.0","msgpack-js":"~0.3.0",referee:"~1.2.0",rimraf:"~2.4.3","slow-stream":"0.0.4",tap:"~2.3.1",tape:"~4.2.1"},homepage:"https://github.com/level/levelup",keywords:["leveldb","stream","database","db","store","storage","json"],license:"MIT",main:"lib/levelup.js",name:"levelup",repository:{type:"git",url:"git+https://github.com/level/levelup.git"},scripts:{test:"tape test/*-test.js | faucet"},version:"1.3.2"}},{}],195:[function(e,t,n){"use strict";var i=e("immediate");function c(){}var u={},o=["REJECTED"],a=["FULFILLED"],r=["PENDING"];function s(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=r,this.queue=[],this.outcome=void 0,e!==c&&f(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function p(t,n,r){i(function(){var e;try{e=n(r)}catch(e){return u.reject(t,e)}e===t?u.reject(t,new TypeError("Cannot resolve promise with itself")):u.resolve(t,e)})}function d(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(t,e){var n=!1;function r(e){n||(n=!0,u.reject(t,e))}function i(e){n||(n=!0,u.resolve(t,e))}var o=h(function(){e(i,r)});"error"===o.status&&r(o.value)}function h(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=s).prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(c);return this.state!==r?p(n,this.state===a?e:t,this.outcome):this.queue.push(new l(n,e,t)),n},l.prototype.callFulfilled=function(e){u.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){p(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){u.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){p(this.promise,this.onRejected,e)},u.resolve=function(e,t){var n=h(d,t);if("error"===n.status)return u.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},u.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},s.resolve=function(e){return e instanceof this?e:u.resolve(new this(c),e)},s.reject=function(e){var t=new this(c);return u.reject(t,e)},s.all=function(e){var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,i=!1;if(!r)return this.resolve([]);for(var o=new Array(r),a=0,t=-1,s=new this(c);++t<r;)l(e[t],t);return s;function l(e,t){n.resolve(e).then(function(e){o[t]=e,++a!==r||i||(i=!0,u.resolve(s,o))},function(e){i||(i=!0,u.reject(s,e))})}},s.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,n=!1;if(!t)return this.resolve([]);for(var r,i=-1,o=new this(c);++i<t;)r=e[i],this.resolve(r).then(function(e){n||(n=!0,u.resolve(o,e))},function(e){n||(n=!0,u.reject(o,e))});return o}},{immediate:173}],196:[function(e,t,n){var r=e("./_root").Symbol;t.exports=r},{"./_root":203}],197:[function(e,t,n){var r=e("./_Symbol"),i=e("./_getRawTag"),o=e("./_objectToString"),a="[object Null]",s="[object Undefined]",l=r?r.toStringTag:void 0;t.exports=function(e){return null==e?void 0===e?s:a:l&&l in Object(e)?i(e):o(e)}},{"./_Symbol":196,"./_getRawTag":200,"./_objectToString":201}],198:[function(e,n,t){(function(e){var t="object"==typeof e&&e&&e.Object===Object&&e;n.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],199:[function(e,t,n){var r=e("./_overArg")(Object.getPrototypeOf,Object);t.exports=r},{"./_overArg":202}],200:[function(e,t,n){var r=e("./_Symbol"),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;t.exports=function(e){var t=o.call(e,s),n=e[s];try{var r=!(e[s]=void 0)}catch(e){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},{"./_Symbol":196}],201:[function(e,t,n){var r=Object.prototype.toString;t.exports=function(e){return r.call(e)}},{}],202:[function(e,t,n){t.exports=function(t,n){return function(e){return t(n(e))}}},{}],203:[function(e,t,n){var r=e("./_freeGlobal"),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();t.exports=o},{"./_freeGlobal":198}],204:[function(e,t,n){t.exports=function(e){return null!=e&&"object"==typeof e}},{}],205:[function(e,t,n){var r=e("./_baseGetTag"),i=e("./_getPrototype"),o=e("./isObjectLike"),a="[object Object]",s=Function.prototype,l=Object.prototype,c=s.toString,u=l.hasOwnProperty,p=c.call(Object);t.exports=function(e){if(!o(e)||r(e)!=a)return!1;var t=i(e);if(null===t)return!0;var n=u.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==p}},{"./_baseGetTag":197,"./_getPrototype":199,"./isObjectLike":204}],206:[function(e,t,p){(function(o){function a(e){return null!=e&&""!==e}p.compare=function(e,t){if(o.isBuffer(e)){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e[r]-t[r];if(i)return i}return e.length-t.length}return e<t?-1:t<e?1:0};var s=p.lowerBound=function(e){return a(e.gt)?e.gt:a(e.gte)?e.gte:a(e.min)?e.min:a(e.start)&&!e.reverse?e.start:a(e.end)&&e.reverse?e.end:void 0};p.lowerBoundInclusive=function(e){return!a(e.gt)},p.upperBoundInclusive=function(e){return!a(e.lt)};var l=p.lowerBoundExclusive=function(e){return!!a(e.gt)},c=p.upperBoundExclusive=function(e){return!!a(e.lt)},u=p.upperBound=function(e){return a(e.lt)?e.lt:a(e.lte)?e.lte:a(e.max)?e.max:a(e.start)&&e.reverse?e.start:a(e.end)&&!e.reverse?e.end:void 0};p.contains=function(e,t,n){n=n||p.compare;var r=s(e);if(a(r)&&((i=n(t,r))<0||0===i&&l(e)))return!1;var i,o=u(e);return!a(o)||!(0<(i=n(t,o))||0===i&&c(e))},p.filter=function(t,n){return function(e){return p.contains(t,e,n)}}}).call(this,{isBuffer:e("../is-buffer/index.js")})},{"../is-buffer/index.js":176}],207:[function(e,v,y){(function(e){!function(e){"use strict";var f={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:h,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:h,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,table:h,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,paragraph:/^([^\n]+(?:\n?(?!hr|heading|lheading| {0,3}>|tag)[^\n]+)+)/,text:/^[^\n]+/};function l(e){this.tokens=[],this.tokens.links={},this.options=e||g.defaults,this.rules=f.normal,this.options.gfm&&(this.options.tables?this.rules=f.tables:this.rules=f.gfm)}f._label=/(?:\\[\[\]]|[^\[\]])+/,f._title=/(?:"(?:\\"|[^"]|"[^"\n]*")*"|'\n?(?:[^'\n]+\n?)*'|\([^()]*\))/,f.def=t(f.def).replace("label",f._label).replace("title",f._title).getRegex(),f.bullet=/(?:[*+-]|\d+\.)/,f.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,f.item=t(f.item,"gm").replace(/bull/g,f.bullet).getRegex(),f.list=t(f.list).replace(/bull/g,f.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+f.def.source+")").getRegex(),f._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b",f.html=t(f.html).replace("comment",/<!--[\s\S]*?-->/).replace("closed",/<(tag)[\s\S]+?<\/\1>/).replace("closing",/<tag(?:"[^"]*"|'[^']*'|\s[^'"\/>\s]*)*?\/?>/).replace(/tag/g,f._tag).getRegex(),f.paragraph=t(f.paragraph).replace("hr",f.hr).replace("heading",f.heading).replace("lheading",f.lheading).replace("tag","<"+f._tag).getRegex(),f.blockquote=t(f.blockquote).replace("paragraph",f.paragraph).getRegex(),f.normal=m({},f),f.gfm=m({},f.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\n? *\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),f.gfm.paragraph=t(f.paragraph).replace("(?!","(?!"+f.gfm.fences.source.replace("\\1","\\2")+"|"+f.list.source.replace("\\1","\\3")+"|").getRegex(),f.tables=m({},f.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),l.rules=f,l.lex=function(e,t){return new l(t).lex(e)},l.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},l.prototype.token=function(e,t){var n,r,i,o,a,s,l,c,u,p,d;for(e=e.replace(/^ +$/gm,"");e;)if((i=this.rules.newline.exec(e))&&(e=e.substring(i[0].length),1<i[0].length&&this.tokens.push({type:"space"})),i=this.rules.code.exec(e))e=e.substring(i[0].length),i=i[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?i:i.replace(/\n+$/,"")});else if(i=this.rules.fences.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"code",lang:i[2],text:i[3]||""});else if(i=this.rules.heading.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"heading",depth:i[1].length,text:i[2]});else if(t&&(i=this.rules.nptable.exec(e))){for(e=e.substring(i[0].length),s={type:"table",header:i[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:i[3].replace(/\n$/,"").split("\n")},c=0;c<s.align.length;c++)/^ *-+: *$/.test(s.align[c])?s.align[c]="right":/^ *:-+: *$/.test(s.align[c])?s.align[c]="center":/^ *:-+ *$/.test(s.align[c])?s.align[c]="left":s.align[c]=null;for(c=0;c<s.cells.length;c++)s.cells[c]=s.cells[c].split(/ *\| */);this.tokens.push(s)}else if(i=this.rules.hr.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"hr"});else if(i=this.rules.blockquote.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"blockquote_start"}),i=i[0].replace(/^ *> ?/gm,""),this.token(i,t),this.tokens.push({type:"blockquote_end"});else if(i=this.rules.list.exec(e)){for(e=e.substring(i[0].length),d=1<(o=i[2]).length,this.tokens.push({type:"list_start",ordered:d,start:d?+o:""}),n=!1,p=(i=i[0].match(this.rules.item)).length,c=0;c<p;c++)l=(s=i[c]).length,~(s=s.replace(/^ *([*+-]|\d+\.) +/,"")).indexOf("\n ")&&(l-=s.length,s=this.options.pedantic?s.replace(/^ {1,4}/gm,""):s.replace(new RegExp("^ {1,"+l+"}","gm"),"")),this.options.smartLists&&c!==p-1&&(o===(a=f.bullet.exec(i[c+1])[0])||1<o.length&&1<a.length||(e=i.slice(c+1).join("\n")+e,c=p-1)),r=n||/\n\n(?!\s*$)/.test(s),c!==p-1&&(n="\n"===s.charAt(s.length-1),r||(r=n)),this.tokens.push({type:r?"loose_item_start":"list_item_start"}),this.token(s,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(i=this.rules.html.exec(e))e=e.substring(i[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===i[1]||"script"===i[1]||"style"===i[1]),text:i[0]});else if(t&&(i=this.rules.def.exec(e)))e=e.substring(i[0].length),i[3]&&(i[3]=i[3].substring(1,i[3].length-1)),u=i[1].toLowerCase(),this.tokens.links[u]||(this.tokens.links[u]={href:i[2],title:i[3]});else if(t&&(i=this.rules.table.exec(e))){for(e=e.substring(i[0].length),s={type:"table",header:i[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:i[3].replace(/(?: *\| *)?\n$/,"").split("\n")},c=0;c<s.align.length;c++)/^ *-+: *$/.test(s.align[c])?s.align[c]="right":/^ *:-+: *$/.test(s.align[c])?s.align[c]="center":/^ *:-+ *$/.test(s.align[c])?s.align[c]="left":s.align[c]=null;for(c=0;c<s.cells.length;c++)s.cells[c]=s.cells[c].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(s)}else if(i=this.rules.lheading.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"heading",depth:"="===i[2]?1:2,text:i[1]});else if(t&&(i=this.rules.paragraph.exec(e)))e=e.substring(i[0].length),this.tokens.push({type:"paragraph",text:"\n"===i[1].charAt(i[1].length-1)?i[1].slice(0,-1):i[1]});else if(i=this.rules.text.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"text",text:i[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var n={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:h,tag:/^<!--[\s\S]*?-->|^<\/?[a-zA-Z0-9\-]+(?:"[^"]*"|'[^']*'|\s[^<'">\/\s]*)*?\/?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^_([^\s_](?:[^_]|__)+?[^\s_])_\b|^\*((?:\*\*|[^*])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`]?)\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:h,text:/^[\s\S]+?(?=[\\<!\[`*]|\b_| {2,}\n|$)/};function r(e,t){if(this.options=t||g.defaults,this.links=e,this.rules=n.normal,this.renderer=this.options.renderer||new i,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=n.breaks:this.rules=n.gfm:this.options.pedantic&&(this.rules=n.pedantic)}function i(e){this.options=e||{}}function o(){}function c(e){this.tokens=[],this.token=null,this.options=e||g.defaults,this.options.renderer=this.options.renderer||new i,this.renderer=this.options.renderer,this.renderer.options=this.options}function u(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function p(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}function t(n,e){return n=n.source,e=e||"",{replace:function(e,t){return t=(t=t.source||t).replace(/(^|[^\[])\^/g,"$1"),n=n.replace(e,t),this},getRegex:function(){return new RegExp(n,e)}}}function a(e,t){return s[" "+e]||(/^[^:]+:\/*[^/]*$/.test(e)?s[" "+e]=e+"/":s[" "+e]=e.replace(/[^/]*$/,"")),e=s[" "+e],"//"===t.slice(0,2)?e.replace(/:[\s\S]*/,":")+t:"/"===t.charAt(0)?e.replace(/(:\/*[^/]*)[\s\S]*/,"$1")+t:e+t}n._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,n._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,n.autolink=t(n.autolink).replace("scheme",n._scheme).replace("email",n._email).getRegex(),n._inside=/(?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]]|\](?=[^\[]*\]))*/,n._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,n.link=t(n.link).replace("inside",n._inside).replace("href",n._href).getRegex(),n.reflink=t(n.reflink).replace("inside",n._inside).getRegex(),n.normal=m({},n),n.pedantic=m({},n.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),n.gfm=m({},n.normal,{escape:t(n.escape).replace("])","~|])").getRegex(),url:t(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("email",n._email).getRegex(),_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:t(n.text).replace("]|","~]|").replace("|","|https?://|ftp://|www\\.|[a-zA-Z0-9.!#$%&'*+/=?^_`{\\|}~-]+@|").getRegex()}),n.breaks=m({},n.gfm,{br:t(n.br).replace("{2,}","*").getRegex(),text:t(n.gfm.text).replace("{2,}","*").getRegex()}),r.rules=n,r.output=function(e,t,n){return new r(t,n).output(e)},r.prototype.output=function(e){for(var t,n,r,i,o="";e;)if(i=this.rules.escape.exec(e))e=e.substring(i[0].length),o+=i[1];else if(i=this.rules.autolink.exec(e))e=e.substring(i[0].length),r="@"===i[2]?"mailto:"+(n=u(this.mangle(i[1]))):n=u(i[1]),o+=this.renderer.link(r,null,n);else if(this.inLink||!(i=this.rules.url.exec(e))){if(i=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(i[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(i[0])&&(this.inLink=!1),e=e.substring(i[0].length),o+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):u(i[0]):i[0];else if(i=this.rules.link.exec(e))e=e.substring(i[0].length),this.inLink=!0,o+=this.outputLink(i,{href:i[2],title:i[3]}),this.inLink=!1;else if((i=this.rules.reflink.exec(e))||(i=this.rules.nolink.exec(e))){if(e=e.substring(i[0].length),t=(i[2]||i[1]).replace(/\s+/g," "),!(t=this.links[t.toLowerCase()])||!t.href){o+=i[0].charAt(0),e=i[0].substring(1)+e;continue}this.inLink=!0,o+=this.outputLink(i,t),this.inLink=!1}else if(i=this.rules.strong.exec(e))e=e.substring(i[0].length),o+=this.renderer.strong(this.output(i[2]||i[1]));else if(i=this.rules.em.exec(e))e=e.substring(i[0].length),o+=this.renderer.em(this.output(i[2]||i[1]));else if(i=this.rules.code.exec(e))e=e.substring(i[0].length),o+=this.renderer.codespan(u(i[2].trim(),!0));else if(i=this.rules.br.exec(e))e=e.substring(i[0].length),o+=this.renderer.br();else if(i=this.rules.del.exec(e))e=e.substring(i[0].length),o+=this.renderer.del(this.output(i[1]));else if(i=this.rules.text.exec(e))e=e.substring(i[0].length),o+=this.renderer.text(u(this.smartypants(i[0])));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else i[0]=this.rules._backpedal.exec(i[0])[0],e=e.substring(i[0].length),"@"===i[2]?r="mailto:"+(n=u(i[0])):(n=u(i[0]),r="www."===i[1]?"http://"+n:n),o+=this.renderer.link(r,null,n);return o},r.prototype.outputLink=function(e,t){var n=u(t.href),r=t.title?u(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(n,r,this.output(e[1])):this.renderer.image(n,r,u(e[1]))},r.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,""):e},r.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,n="",r=e.length,i=0;i<r;i++)t=e.charCodeAt(i),.5<Math.random()&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},i.prototype.code=function(e,t,n){if(this.options.highlight){var r=this.options.highlight(e,t);null!=r&&r!==e&&(n=!0,e=r)}return t?'<pre><code class="'+this.options.langPrefix+u(t,!0)+'">'+(n?e:u(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:u(e,!0))+"\n</code></pre>"},i.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},i.prototype.html=function(e){return e},i.prototype.heading=function(e,t,n){return"<h"+t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},i.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},i.prototype.list=function(e,t,n){var r=t?"ol":"ul";return"<"+r+(t&&1!==n?' start="'+n+'"':"")+">\n"+e+"</"+r+">\n"},i.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},i.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},i.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},i.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},i.prototype.tablecell=function(e,t){var n=t.header?"th":"td";return(t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">")+e+"</"+n+">\n"},i.prototype.strong=function(e){return"<strong>"+e+"</strong>"},i.prototype.em=function(e){return"<em>"+e+"</em>"},i.prototype.codespan=function(e){return"<code>"+e+"</code>"},i.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},i.prototype.del=function(e){return"<del>"+e+"</del>"},i.prototype.link=function(e,t,n){if(this.options.sanitize){try{var r=decodeURIComponent(p(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return n}if(0===r.indexOf("javascript:")||0===r.indexOf("vbscript:")||0===r.indexOf("data:"))return n}this.options.baseUrl&&!d.test(e)&&(e=a(this.options.baseUrl,e));var i='<a href="'+e+'"';return t&&(i+=' title="'+t+'"'),i+">"+n+"</a>"},i.prototype.image=function(e,t,n){this.options.baseUrl&&!d.test(e)&&(e=a(this.options.baseUrl,e));var r='<img src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+(this.options.xhtml?"/>":">")},i.prototype.text=function(e){return e},o.prototype.strong=o.prototype.em=o.prototype.codespan=o.prototype.del=o.prototype.text=function(e){return e},o.prototype.link=o.prototype.image=function(e,t,n){return""+n},o.prototype.br=function(){return""},c.parse=function(e,t){return new c(t).parse(e)},c.prototype.parse=function(e){this.inline=new r(e.links,this.options),this.inlineText=new r(e.links,m({},this.options,{renderer:new o})),this.tokens=e.reverse();for(var t="";this.next();)t+=this.tok();return t},c.prototype.next=function(){return this.token=this.tokens.pop()},c.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},c.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},c.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,p(this.inlineText.output(this.token.text)));case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,n,r,i="",o="";for(n="",e=0;e<this.token.header.length;e++)n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(i+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",r=0;r<t.length;r++)n+=this.renderer.tablecell(this.inline.output(t[r]),{header:!1,align:this.token.align[r]});o+=this.renderer.tablerow(n)}return this.renderer.table(i,o);case"blockquote_start":for(o="";"blockquote_end"!==this.next().type;)o+=this.tok();return this.renderer.blockquote(o);case"list_start":o="";for(var a=this.token.ordered,s=this.token.start;"list_end"!==this.next().type;)o+=this.tok();return this.renderer.list(o,a,s);case"list_item_start":for(o="";"list_item_end"!==this.next().type;)o+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(o);case"loose_item_start":for(o="";"list_item_end"!==this.next().type;)o+=this.tok();return this.renderer.listitem(o);case"html":var l=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(l);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}};var s={},d=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function h(){}function m(e){for(var t,n,r=1;r<arguments.length;r++)for(n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function g(e,n,r){if(null==e)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if(r||"function"==typeof n){r||(r=n,n=null);var i,o,a=(n=m({},g.defaults,n||{})).highlight,t=0;try{i=l.lex(e,n)}catch(e){return r(e)}o=i.length;var s=function(t){if(t)return n.highlight=a,r(t);var e;try{e=c.parse(i,n)}catch(e){t=e}return n.highlight=a,t?r(t):r(null,e)};if(!a||a.length<3)return s();if(delete n.highlight,!o)return s();for(;t<i.length;t++)!function(n){"code"!==n.type?--o||s():a(n.text,n.lang,function(e,t){return e?s(e):null==t||t===n.text?--o||s():(n.text=t,n.escaped=!0,void(--o||s()))})}(i[t])}else try{return n&&(n=m({},g.defaults,n)),c.parse(l.lex(e,n),n)}catch(e){if(e.message+="\nPlease report this to https://github.com/markedjs/marked.",(n||g.defaults).silent)return"<p>An error occurred:</p><pre>"+u(e.message+"",!0)+"</pre>";throw e}}h.exec=h,g.options=g.setOptions=function(e){return m(g.defaults,e),g},g.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new i,xhtml:!1,baseUrl:null},g.Parser=c,g.parser=c.parse,g.Renderer=i,g.TextRenderer=o,g.Lexer=l,g.lexer=l.lex,g.InlineLexer=r,g.inlineLexer=r.output,g.parse=g,void 0!==v&&"object"==typeof y?v.exports=g:"function"==typeof define&&define.amd?define(function(){return g}):e.marked=g}(this||("undefined"!=typeof window?window:e))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],208:[function(v,y,e){(function(e,t,o){var n=v("inherits"),r=v("abstract-leveldown").AbstractLevelDOWN,i=v("abstract-leveldown").AbstractIterator,a=v("ltgt"),u=t.setImmediate||e.nextTick,s=v("functional-red-black-tree"),l={};function c(e){return"string"==typeof e?"$"+e:JSON.stringify(e)}function p(e){return 0<a.compare(e,this._end)}function d(e){return 0<=a.compare(e,this._end)}function f(e){return a.compare(e,this._end)<0}function h(e){return a.compare(e,this._end)<=0}function m(e,t){i.call(this,e),this._limit=t.limit,-1===this._limit&&(this._limit=1/0);var n=e._store[e._location];this.keyAsBuffer=!1!==t.keyAsBuffer,this.valueAsBuffer=!1!==t.valueAsBuffer,this._reverse=t.reverse,this._options=t,this._done=0,this._reverse?(this._incr="prev",this._start=a.upperBound(t),this._end=a.lowerBound(t),void 0===this._start?this._tree=n.end:a.upperBoundInclusive(t)?this._tree=n.le(this._start):this._tree=n.lt(this._start),this._end&&(a.lowerBoundInclusive(t)?this._test=d:this._test=p)):(this._incr="next",this._start=a.lowerBound(t),this._end=a.upperBound(t),void 0===this._start?this._tree=n.begin:a.lowerBoundInclusive(t)?this._tree=n.ge(this._start):this._tree=n.gt(this._start),this._end&&(a.upperBoundInclusive(t)?this._test=h:this._test=f))}function g(e){if(!(this instanceof g))return new g(e);r.call(this,"string"==typeof e?e:""),this._location=this.location?c(this.location):"_tree",this._store=this.location?l:this,this._store[this._location]=this._store[this._location]||s(a.compare)}n(m,i),m.prototype._next=function(e){var t,n;return this._done++>=this._limit?u(e):this._tree.valid?(t=this._tree.key,n=this._tree.value,this._test(t)?(this.keyAsBuffer&&(t=new o(t)),this.valueAsBuffer&&(n=new o(n)),this._tree[this._incr](),void u(function(){e(null,t,n)})):u(e)):u(e)},m.prototype._test=function(){return!0},g.clearGlobalStore=function(e){e?Object.keys(l).forEach(function(e){delete l[e]}):l={}},n(g,r),g.prototype._open=function(e,t){var n=this;u(function(){t(null,n)})},g.prototype._put=function(e,t,n,r){null!=t||(t="");var i=this._store[this._location].find(e);i.valid?this._store[this._location]=i.update(t):this._store[this._location]=this._store[this._location].insert(e,t),u(r)},g.prototype._get=function(e,t,n){var r=this._store[this._location].get(e);if(void 0===r){var i=new Error("NotFound");return u(function(){n(i)})}!1===t.asBuffer||this._isBuffer(r)||(r=new o(String(r))),u(function(){n(null,r)})},g.prototype._del=function(e,t,n){this._store[this._location]=this._store[this._location].remove(e),u(n)},g.prototype._batch=function(e,t,n){for(var r,i,o,a,s=-1,l=e.length,c=this._store[this._location];++s<l;)if(e[s]){if(i=this._isBuffer(e[s].key)?e[s].key:String(e[s].key),r=this._checkKey(i,"key"))return u(function(){n(r)});if(a=c.find(i),"put"===e[s].type){if(o=this._isBuffer(e[s].value)?e[s].value:String(e[s].value),r=this._checkKey(o,"value"))return u(function(){n(r)});c=a.valid?a.update(o):c.insert(i,o)}else c=a.remove()}this._store[this._location]=c,u(n)},g.prototype._iterator=function(e){return new m(this,e)},g.prototype._isBuffer=function(e){return o.isBuffer(e)},g.destroy=function(e,t){var n=c(e);n in l&&delete l[n],u(t)},y.exports=g}).call(this,v("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},v("buffer").Buffer)},{_process:234,"abstract-leveldown":212,buffer:117,"functional-red-black-tree":162,inherits:174,ltgt:206}],209:[function(e,t,n){(function(n){function e(e){this._db=e,this._operations=[],this._written=!1}e.prototype._serializeKey=function(e){return this._db._serializeKey(e)},e.prototype._serializeValue=function(e){return this._db._serializeValue(e)},e.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},e.prototype.put=function(e,t){this._checkWritten();var n=this._db._checkKey(e,"key",this._db._isBuffer);if(n)throw n;return e=this._serializeKey(e),t=this._serializeValue(t),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},e.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return e=this._serializeKey(e),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},e.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},e.prototype.write=function(e,t){if(this._checkWritten(),"function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("write() requires a callback argument");return"object"!=typeof e&&(e={}),this._written=!0,"function"==typeof this._write?this._write(t):"function"==typeof this._db._batch?this._db._batch(this._operations,e,t):void n.nextTick(t)},t.exports=e}).call(this,e("_process"))},{_process:234}],210:[function(e,t,n){(function(n){function e(e){this.db=e,this._ended=!1,this._nexting=!1}e.prototype.next=function(e){var t=this;if("function"!=typeof e)throw new Error("next() requires a callback argument");return t._ended?e(new Error("cannot call next() after end()")):t._nexting?e(new Error("cannot call next() before previous next() has completed")):(t._nexting=!0,"function"==typeof t._next?t._next(function(){t._nexting=!1,e.apply(null,arguments)}):void n.nextTick(function(){t._nexting=!1,e()}))},e.prototype.end=function(e){if("function"!=typeof e)throw new Error("end() requires a callback argument");return this._ended?e(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(e):void n.nextTick(e))},t.exports=e}).call(this,e("_process"))},{_process:234}],211:[function(o,a,e){(function(t,s){var e=o("xtend"),n=o("./abstract-iterator"),r=o("./abstract-chained-batch");function i(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}i.prototype.open=function(e,t){var n=this,r=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,function(e){if(e)return n.status=r,t(e);n.status="open",t()})):(this.status="open",s.nextTick(t))},i.prototype.close=function(t){var n=this,r=this.status;if("function"!=typeof t)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close(function(e){if(e)return n.status=r,t(e);n.status="closed",t()})):(this.status="closed",s.nextTick(t))},i.prototype.get=function(e,t,n){var r;if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("get() requires a callback argument");return(r=this._checkKey(e,"key"))?n(r):(e=this._serializeKey(e),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,n):void s.nextTick(function(){n(new Error("NotFound"))}))},i.prototype.put=function(e,t,n,r){var i;if("function"==typeof n&&(r=n),"function"!=typeof r)throw new Error("put() requires a callback argument");return(i=this._checkKey(e,"key"))?r(i):(e=this._serializeKey(e),t=this._serializeValue(t),"object"!=typeof n&&(n={}),"function"==typeof this._put?this._put(e,t,n,r):void s.nextTick(r))},i.prototype.del=function(e,t,n){var r;if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("del() requires a callback argument");return(r=this._checkKey(e,"key"))?n(r):(e=this._serializeKey(e),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,n):void s.nextTick(n))},i.prototype.batch=function(e,t,n){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(n=t),"function"==typeof e&&(n=e),"function"!=typeof n)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return n(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var r,i,o=0,a=e.length;o<a;o++)if("object"==typeof(r=e[o])){if(i=this._checkKey(r.type,"type"))return n(i);if(i=this._checkKey(r.key,"key"))return n(i)}if("function"==typeof this._batch)return this._batch(e,t,n);s.nextTick(n)},i.prototype.approximateSize=function(e,t,n){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof n)throw new Error("approximateSize() requires a callback argument");if(e=this._serializeKey(e),t=this._serializeKey(t),"function"==typeof this._approximateSize)return this._approximateSize(e,t,n);s.nextTick(function(){n(null,0)})},i.prototype._setupIteratorOptions=function(t){var n=this;return t=e(t),["start","end","gt","gte","lt","lte"].forEach(function(e){t[e]&&n._isBuffer(t[e])&&0===t[e].length&&delete t[e]}),t.reverse=!!t.reverse,t.keys=0!=t.keys,t.values=0!=t.values,t.limit="limit"in t?t.limit:-1,t.keyAsBuffer=0!=t.keyAsBuffer,t.valueAsBuffer=0!=t.valueAsBuffer,t},i.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new n(this)},i.prototype._chainedBatch=function(){return new r(this)},i.prototype._isBuffer=function(e){return t.isBuffer(e)},i.prototype._serializeKey=function(e){return this._isBuffer(e)?e:String(e)},i.prototype._serializeValue=function(e){return null==e?"":this._isBuffer(e)||s.browser?e:String(e)},i.prototype._checkKey=function(e,t){return null==e?new Error(t+" cannot be `null` or `undefined`"):this._isBuffer(e)&&0===e.length?new Error(t+" cannot be an empty Buffer"):""===String(e)?new Error(t+" cannot be an empty String"):void 0},a.exports=i}).call(this,{isBuffer:o("../../../is-buffer/index.js")},o("_process"))},{"../../../is-buffer/index.js":176,"./abstract-chained-batch":209,"./abstract-iterator":210,_process:234,xtend:341}],212:[function(e,t,n){n.AbstractLevelDOWN=e("./abstract-leveldown"),n.AbstractIterator=e("./abstract-iterator"),n.AbstractChainedBatch=e("./abstract-chained-batch"),n.isLevelDOWN=e("./is-leveldown")},{"./abstract-chained-batch":209,"./abstract-iterator":210,"./abstract-leveldown":211,"./is-leveldown":213}],213:[function(e,t,n){var r=e("./abstract-leveldown");t.exports=function(t){return!(!t||"object"!=typeof t)&&Object.keys(r.prototype).filter(function(e){return"_"!=e[0]&&"approximateSize"!=e}).every(function(e){return"function"==typeof t[e]})}},{"./abstract-leveldown":211}],214:[function(e,t,n){"use strict";var l=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,r,i=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),o=1;o<arguments.length;o++){for(var a in n=Object(arguments[o]))c.call(n,a)&&(i[a]=n[a]);if(l){r=l(n);for(var s=0;s<r.length;s++)u.call(n,r[s])&&(i[r[s]]=n[r[s]])}}return i}},{}],215:[function(e,t,s){"use strict";var c=-324,u=3,p="",d=e("./utils");function n(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",o=(r?-n:n)-c,a=d.padLeft(o.toString(),"0",u);i+=p+a;var s=Math.abs(parseFloat(t[0]));r&&(s=10-s);var l=s.toFixed(20);return l=l.replace(/\.?0+$/,""),i+=p+l}(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,o="";if(t)for(;++r<i;)o+=s.toIndexableString(n[r]);else for(;++r<i;){var a=n[r];o+=s.toIndexableString(a)+s.toIndexableString(e[a])}return o}return""}function f(e,t){var n,r=t;if("1"===e[t])n=0,t++;else{var i="0"===e[t];t++;var o="",a=e.substring(t,t+u),s=parseInt(a,10)+c;for(i&&(s=-s),t+=u;;){var l=e[t];if("\0"===l)break;o+=l,t++}n=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),i&&(n-=10),0!==s&&(n=parseFloat(n+"e"+s))}return{num:n,length:t-r}}function h(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,o=r.index;Array.isArray(i)?i.push(n):o===e.length-2?i[e.pop()]=n:e.push(n)}}function a(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}s.collate=function(e,t){if(e===t)return 0;e=s.normalizeKey(e),t=s.normalizeKey(t);var n,r,i=a(e),o=a(t);if(i-o!=0)return i-o;if(null===e)return 0;switch(typeof e){case"number":return e-t;case"boolean":return e===t?0:e<t?-1:1;case"string":return(n=e)===(r=t)?0:r<n?1:-1}return Array.isArray(e)?function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=s.collate(e[r],t[r]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}(e,t):function(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),o=0;o<i;o++){var a=s.collate(n[o],r[o]);if(0!==a)return a;if(0!==(a=s.collate(e[n[o]],t[r[o]])))return a}return n.length===r.length?0:n.length>r.length?1:-1}(e,t)},s.normalizeKey=function(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=s.normalizeKey(t[r])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var i in e={},t)if(t.hasOwnProperty(i)){var o=t[i];void 0!==o&&(e[i]=s.normalizeKey(o))}}}return e},s.toIndexableString=function(e){return a(e=s.normalizeKey(e))+p+n(e)+"\0"},s.parseIndexableString=function(e){for(var t=[],n=[],r=0;;){var i=e[r++];if("\0"!==i)switch(i){case"1":t.push(null);break;case"2":t.push("1"===e[r]),r++;break;case"3":var o=f(e,r);t.push(o.num),r+=o.length;break;case"4":for(var a="";;){var s=e[r];if("\0"===s)break;a+=s,r++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(a);break;case"5":var l={element:[],index:t.length};t.push(l.element),n.push(l);break;case"6":var c={element:{},index:t.length};t.push(c.element),n.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===t.length)return t.pop();h(t,n)}}}},{"./utils":216}],216:[function(e,t,n){"use strict";function r(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}n.padLeft=function(e,t,n){return r(e,t,n)+e},n.padRight=function(e,t,n){return e+r(e,t,n)},n.stringLexCompare=function(e,t){var n,r=e.length,i=t.length;for(n=0;n<r;n++){if(n===i)return 1;var o=e.charAt(n),a=t.charAt(n);if(o!==a)return o<a?-1:1}return r<i?-1:0},n.intToDecimalForm=function(e){for(var t=e<0,n="";n=(t?-Math.ceil(e%10):Math.floor(e%10))+n,e=t?Math.ceil(e/10):Math.floor(e/10););return t&&"0"!==n&&(n="-"+n),n}},{}],217:[function(e,t,n){"use strict";function r(){this.store={}}function i(e){if(this.store=new r,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}n.Map=r,n.Set=i,r.prototype.mangle=function(e){if("string"!=typeof e)throw new TypeError("key must be a string but Got "+e);return"$"+e},r.prototype.unmangle=function(e){return e.substring(1)},r.prototype.get=function(e){var t=this.mangle(e);if(t in this.store)return this.store[t]},r.prototype.set=function(e,t){var n=this.mangle(e);return this.store[n]=t,!0},r.prototype.has=function(e){return this.mangle(e)in this.store},r.prototype.delete=function(e){var t=this.mangle(e);return t in this.store&&(delete this.store[t],!0)},r.prototype.forEach=function(e){for(var t=Object.keys(this.store),n=0,r=t.length;n<r;n++){var i=t[n];e(this.store[i],i=this.unmangle(i))}},i.prototype.add=function(e){return this.store.set(e,!0)},i.prototype.has=function(e){return this.store.has(e)},i.prototype.delete=function(e){return this.store.delete(e)}},{}],218:[function(e,t,n){t.exports=e("../lib/extras/memory")},{"../lib/extras/memory":219}],219:[function(Ve,e,t){(function(f,e,P){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var h=t(Ve("levelup")),m=t(Ve("sublevel-pouchdb")),b=Ve("through2"),g=t(Ve("argsarray")),I=Ve("pouchdb-collections"),v=t(Ve("double-ended-queue")),n=t(Ve("lie")),r=t(Ve("debug")),i=Ve("events"),o=t(Ve("inherits")),d=t(Ve("spark-md5")),a=t(Ve("vuvuzela")),s=Ve("js-extend"),l=t(Ve("memdown")),y={toSublevel:function(e,t,n){f.nextTick(function(){n()})},localAndMetaStores:function(e,t,n){f.nextTick(function(){n()})}},D="function"==typeof Promise?Promise:n;function c(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}var u=Function.prototype.toString,p=u.call(Object);function _(e){var t,n,r,i;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=_(e[n]);return t}if(e instanceof Date)return e.toISOString();if((i=e)instanceof ArrayBuffer||"undefined"!=typeof Blob&&i instanceof Blob)return c(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==p}(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=_(e[n]);void 0!==o&&(t[n]=o)}return t}var w;r("pouchdb:api");function k(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}if(k())w=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),w=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){w=!1}function x(){return w}function E(){var t;i.EventEmitter.call(this),this._listeners={},t=this,k()?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&t.emit(e.dbName.newValue)}):x()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(e){t.emit(e.key)}):window.attachEvent("storage",function(e){t.emit(e.key)}))}function C(e){Error.call(this,e.reason),this.status=e.status,this.name=e.error,this.message=e.reason,this.error=!0}o(E,i.EventEmitter),E.prototype.addListener=function(e,t,n,r){if(!this._listeners[t]){var i=this,o=!1;this._listeners[t]=a,this.on(e,a)}function a(){if(i._listeners[t])if(o)o="waiting";else{o=!0;var e=function(e,t){for(var n={},r=0,i=t.length;r<i;r++){var o=t[r];o in e&&(n[o]=e[o])}return n}(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);n.changes(e).on("change",function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,r.onChange(e))}).on("complete",function(){"waiting"===o&&setTimeout(function(){a()},0),o=!1}).on("error",function(){o=!1})}}},E.prototype.removeListener=function(e,t){t in this._listeners&&i.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t])},E.prototype.notifyLocalWindows=function(e){k()?chrome.storage.local.set({dbName:e}):x()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},E.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)},o(C,Error),C.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new C({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),new C({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"});var L=new C({status:404,error:"not_found",reason:"missing"}),R=new C({status:409,error:"conflict",reason:"Document update conflict"}),S=new C({status:400,error:"bad_request",reason:"_id field must contain a string"}),T=new C({status:412,error:"missing_id",reason:"_id is required for puts"}),A=new C({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),j=new C({status:412,error:"precondition_failed",reason:"Database not open"}),B=(new C({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),new C({status:500,error:"badarg",reason:"Some query argument is invalid"})),N=(new C({status:400,error:"invalid_request",reason:"Request was invalid"}),new C({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),new C({status:500,error:"doc_validation",reason:"Bad special document member"})),O=new C({status:400,error:"bad_request",reason:"Something wrong with the request"}),M=(new C({status:400,error:"bad_request",reason:"Document must be a JSON object"}),new C({status:404,error:"not_found",reason:"Database not found"}),new C({status:500,error:"indexed_db_went_bad",reason:"unknown"}),new C({status:500,error:"web_sql_went_bad",reason:"unknown"}),new C({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),new C({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),new C({status:400,error:"bad_request",reason:"Invalid rev format"})),F=(new C({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),new C({status:412,error:"missing_stub"}));new C({status:413,error:"invalid_url",reason:"Provided URL is invalid"});function U(n,e){function t(e){for(var t in n)"function"!=typeof n[t]&&(this[t]=n[t]);void 0!==e&&(this.reason=e)}return t.prototype=C.prototype,new t(e)}function q(r){var i={},o=r.filter&&"function"==typeof r.filter;return i.query=r.query_params,function(e){e.doc||(e.doc={});var t=o&&function(e,t,n){try{return!e(t,n)}catch(e){var r="Filter function threw: "+e.toString();return U(O,r)}}(r.filter,e.doc,i);if("object"==typeof t)return t;if(t)return!1;if(r.include_docs){if(!r.attachments)for(var n in e.doc._attachments)e.doc._attachments.hasOwnProperty(n)&&(e.doc._attachments[n].stub=!0)}else delete e.doc;return!0}}var H=function(){}.name?function(e){return e.name}:function(e){return e.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]};var z="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");function V(e){return 0|Math.random()*e}function W(e,t){t=t||z.length;var n="",r=-1;if(e){for(;++r<e;)n+=z[V(t)];return n}for(;++r<36;)switch(r){case 8:case 13:case 18:case 23:n+="-";break;case 19:n+=z[3&V(16)|8];break;default:n+=z[V(16)]}return n}function G(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}var K=G(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),X=G(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Y(e){if(!/^\d+\-./.test(e))return U(M);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function J(e,t){var n,r,i,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=W()),r=W(32,16).toLowerCase(),e._rev){if((i=Y(e._rev)).error)return i;e._rev_tree=[{pos:i.prefix,ids:[i.id,{status:"missing"},[[r,o,[]]]]}],n=i.prefix+1}else e._rev_tree=[{pos:1,ids:[r,o,[]]}],n=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],o=1,a=r.length;o<a;o++)i=[r[o],{status:"missing"},[i]];return[{pos:n,ids:i}]}(e._revisions,o),n=e._revisions.start,r=e._revisions.ids[0]),!e._rev_tree){if((i=Y(e._rev)).error)return i;n=i.prefix,r=i.id,e._rev_tree=[{pos:n,ids:[r,o,[]]}]}(function(e){var t;if(e?"string"!=typeof e?t=U(S):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=U(A)):t=U(T),t)throw t})(e._id),e._rev=n+"-"+r;var a={metadata:{},data:{}};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var l="_"===s[0];if(l&&!K[s]){var c=U(N,s);throw c.message=N.message+": "+s,c}l&&!X[s]?a.metadata[s.slice(1)]=e[s]:a.data[s]=e[s]}return a}function $(e){for(var t,n,r,i,o=e.rev_tree.slice();i=o.pop();){var a=i.ids,s=a[2],l=i.pos;if(s.length)for(var c=0,u=s.length;c<u;c++)o.push({pos:l+1,ids:s[c]});else{var p=!!a[1].deleted,d=a[0];t&&!(r!==p?r:n!==l?n<l:t<d)||(t=d,n=l,r=p)}}return n+"-"+t}function Q(e,t){for(var n,r=e.slice();n=r.pop();)for(var i=n.pos,o=n.ids,a=o[2],s=t(0===a.length,i,o[0],n.ctx,o[1]),l=0,c=a.length;l<c;l++)r.push({pos:i+1,ids:a[l],ctx:s})}function Z(e,t){return e.pos-t.pos}function ee(e){for(var t=$(e),n=function(e){var o=[];Q(e,function(e,t,n,r,i){e&&o.push({rev:t+"-"+n,pos:t,opts:i})}),o.sort(Z).reverse();for(var t=0,n=o.length;t<n;t++)delete o[t].pos;return o}(e.rev_tree),r=[],i=0,o=n.length;i<o;i++){var a=n[i];a.rev===t||a.opts.deleted||r.push(a.rev)}return r}function te(e,t){return e.pos-t.pos}function ne(e,t){for(var n,r,i=t,o=e.length;i<o;i++){var a=e[i],s=[a.id,a.opts,[]];r?(r[2].push(s),r=s):n=r=s}return n}function re(e,t){return e[0]<t[0]?-1:1}function ie(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;0<n.length;){var i=n.pop(),o=i.tree1,a=i.tree2;(o[1].status||a[1].status)&&(o[1].status="available"===o[1].status||"available"===a[1].status?"available":"missing");for(var s=0;s<a[2].length;s++)if(o[2][0]){for(var l=!1,c=0;c<o[2].length;c++)o[2][c][0]===a[2][s][0]&&(n.push({tree1:o[2][c],tree2:a[2][s]}),l=!0);l||(r="new_branch",u=o[2],p=a[2][s],void 0,d=function(e,t,n){for(var r,i=0,o=e.length;i<o;)n(e[r=i+o>>>1],t)<0?i=r+1:o=r;return i}(u,p,re),u.splice(d,0,p))}else r="new_leaf",o[2][0]=a[2][s]}var u,p,d;return{conflicts:r,tree:e}}function oe(e,t,n){var r,i=[],o=!1,a=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,l=e.length;s<l;s++){var c=e[s];if(c.pos===t.pos&&c.ids[0]===t.ids[0])r=ie(c.ids,t.ids),i.push({pos:c.pos,ids:r.tree}),o=o||r.conflicts,a=!0;else if(!0!==n){var u=c.pos<t.pos?c:t,p=c.pos<t.pos?t:c,d=p.pos-u.pos,f=[],h=[];for(h.push({ids:u.ids,diff:d,parent:null,parentIdx:null});0<h.length;){var m=h.pop();if(0!==m.diff)for(var g=m.ids[2],v=0,y=g.length;v<y;v++)h.push({ids:g[v],diff:m.diff-1,parent:m.ids,parentIdx:v});else m.ids[0]===p.ids[0]&&f.push(m)}var b=f[0];b?(r=ie(b.ids,p.ids),b.parent[2][b.parentIdx]=r.tree,i.push({pos:u.pos,ids:u.ids}),o=o||r.conflicts,a=!0):i.push(c)}else i.push(c)}return a||i.push(t),i.sort(te),{tree:i,conflicts:o||"internal_node"}}function ae(e,t,n){var r=oe(e,t),i=function(e,t){for(var n,r=function(e){for(var t,n=[],r=e.slice();t=r.pop();){var i=t.pos,o=t.ids,a=o[0],s=o[1],l=o[2],c=0===l.length,u=t.history?t.history.slice():[];u.push({id:a,opts:s}),c&&n.push({pos:i+1-u.length,ids:u});for(var p=0,d=l.length;p<d;p++)r.push({pos:i+1,ids:l[p],history:u})}return n.reverse()}(e),i={},o=0,a=r.length;o<a;o++){for(var s=r[o],l=s.ids,c=Math.max(0,l.length-t),u={pos:s.pos+c,ids:ne(l,c)},p=0;p<c;p++){var d=s.pos+p+"-"+l[p].id;i[d]=!0}n=n?oe(n,u,!0).tree:[u]}return Q(n,function(e,t,n){delete i[t+"-"+n]}),{tree:n,revs:Object.keys(i)}}(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function se(e){return e.ids}function le(e,t){t||(t=$(e));for(var n,r=t.substring(t.indexOf("-")+1),i=e.rev_tree.map(se);n=i.pop();){if(n[0]===r)return!!n[1].deleted;i=i.concat(n[2])}}function ce(e){return/^_local/.test(e)}var ue=function(e){return atob(e)},pe=function(e){return btoa(e)};function de(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(e){if("TypeError"!==e.name)throw e;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<t.length;i+=1)r.append(t[i]);return r.getBlob(n.type)}}function fe(e,t){return de([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}(e)],{type:t})}function he(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}var me=e.setImmediate||e.setTimeout,ge=32768;function ve(t,e,n,r,i){var o,a,s;(0<n||r<e.size)&&(a=n,s=r,e=(o=e).webkitSlice?o.webkitSlice(a,s):o.slice(a,s)),function(e,n){if("undefined"==typeof FileReader)return n((new FileReaderSync).readAsArrayBuffer(e));var t=new FileReader;t.onloadend=function(e){var t=e.target.result||new ArrayBuffer(0);n(t)},t.readAsArrayBuffer(e)}(e,function(e){t.append(e),i()})}function ye(e,t,n,r,i){(0<n||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function be(t,n){var e="string"==typeof t,r=e?t.length:t.size,i=Math.min(ge,r),o=Math.ceil(r/i),a=0,s=e?new d:new d.ArrayBuffer,l=e?ye:ve;function c(){me(p)}function u(){var e,t=(e=s.end(!0),pe(e));n(t),s.destroy()}function p(){var e=a*i;l(s,t,e,e+i,++a<o?c:u)}p()}function _e(e,t,n,r,i,o,a,s){if(function(e,t){for(var n,r=e.slice(),i=t.split("-"),o=parseInt(i[0],10),a=i[1];n=r.pop();){if(n.pos===o&&n.ids[0]===a)return!0;for(var s=n.ids[2],l=0,c=s.length;l<c;l++)r.push({pos:n.pos+1,ids:s[l]})}return!1}(t.rev_tree,n.metadata.rev))return r[i]=n,o();var l=t.winningRev||$(t),c="deleted"in t?t.deleted:le(t,l),u="deleted"in n.metadata?n.metadata.deleted:le(n.metadata),p=/^1-/.test(n.metadata.rev);if(c&&!u&&s&&p){var d=n.data;d._rev=l,d._id=n.metadata.id,n=J(d,s)}var f=ae(t.rev_tree,n.metadata.rev_tree[0],e);if(s&&(c&&u||!c&&"new_leaf"!==f.conflicts||c&&!u&&"new_branch"===f.conflicts)){var h=U(R);return r[i]=h,o()}var m=n.metadata.rev;n.metadata.rev_tree=f.tree,n.stemmedRevs=f.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var g=$(n.metadata),v=le(n.metadata,g),y=c===v?0:c<v?-1:1;a(n,g,v,m===g?v:le(n.metadata,m),!0,y,i,o)}function we(e,t){return de([new Uint8Array(e)],{type:t})}function ke(e,t){!function(e,n){if("undefined"==typeof FileReader)return n(he((new FileReaderSync).readAsArrayBuffer(e)));var t=new FileReader,r="function"==typeof t.readAsBinaryString;t.onloadend=function(e){var t=e.target.result||"";if(r)return n(t);n(he(t))},r?t.readAsBinaryString(e):t.readAsArrayBuffer(e)}(e,t)}function xe(e,t){var n=t.prefix()[0],r=e._cache,i=r.get(n);return i||(i=new I.Map,r.set(n,i)),i}function Ee(){this._batch=[],this._cache=new I.Map}Ee.prototype.get=function(e,n,r){var i=xe(this,e),t=i.get(n);return t?f.nextTick(function(){r(null,t)}):null===t?f.nextTick(function(){r({name:"NotFoundError"})}):void e.get(n,function(e,t){if(e)return"NotFoundError"===e.name&&i.set(n,null),r(e);i.set(n,t),r(null,t)})},Ee.prototype.batch=function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t],i=xe(this,r.prefix);"put"===r.type?i.set(r.key,r.value):i.set(r.key,null)}this._batch=this._batch.concat(e)},Ee.prototype.execute=function(e,t){for(var n=new I.Set,r=[],i=this._batch.length-1;0<=i;i--){var o=this._batch[i],a=o.prefix.prefix()[0]+""+o.key;n.has(a)||(n.add(a),r.push(o))}e.batch(r,t)};var Ce="document-store",Se="by-sequence",Te="attach-store",Ae="attach-binary-store",Ne="local-store",Oe="meta-store",Pe=new I.Map,Ie="_local_last_update_seq",De="_local_doc_count",Le="_local_uuid",Re="md5-",je={encode:function(t){try{return JSON.stringify(t)}catch(e){return a.stringify(t)}},decode:function(e){return e.length<5e4?JSON.parse(e):function(t){try{return JSON.parse(t)}catch(e){return a.parse(t)}}(e)},buffer:!1,type:"cheap-json"},Be=new E;function Me(e){return"winningRev"in e?e.winningRev:$(e)}function Fe(e,t){return"deleted"in e?e.deleted:le(e,t)}function Ue(e,n,r){var i=[];return e.forEach(function(n){n.doc&&n.doc._attachments&&Object.keys(n.doc._attachments).forEach(function(e){var t=n.doc._attachments[e];"data"in t||i.push(t)})}),D.all(i.map(function(e){return t=n,a=r,s=(o=e).content_type,new D(function(r,i){t.binaryStore.get(o.digest,function(e,t){var n;if(e){if("NotFoundError"!==e.name)return i(e);n=a.binary?fe("",s):""}else n=a.binary?we(t,s):t.toString("base64");delete o.stub,delete o.length,o.data=n,r()})});var o,t,a,s}))}function qe(t,n){var r,S,T=this,A={},p=(t=_(t)).revs_limit,N=t.name;void 0===t.createIfMissing&&(t.createIfMissing=!0);var i,o=t.db,e=H(o);function a(){A.docStore=S.sublevel(Ce,{valueEncoding:je}),A.bySeqStore=S.sublevel(Se,{valueEncoding:"json"}),A.attachmentStore=S.sublevel(Te,{valueEncoding:"json"}),A.binaryStore=S.sublevel(Ae,{valueEncoding:"binary"}),A.localStore=S.sublevel(Ne,{valueEncoding:"json"}),A.metaStore=S.sublevel(Oe,{valueEncoding:"json"}),y.localAndMetaStores(S,A,function(){A.metaStore.get(Ie,function(e,t){void 0===S._updateSeq&&(S._updateSeq=t||0),A.metaStore.get(De,function(e,t){S._docCount=e?0:t,A.metaStore.get(Le,function(e,t){r=e?W():t,A.metaStore.put(Le,r,function(){f.nextTick(function(){n(null,T)})})})})})})}function s(e,t){try{e.apply(null,t)}catch(e){t[t.length-1](e)}}function l(){var e,t,n,o=S._queue.peekFront();"read"===o.type?function(e){for(var r=[o],t=1,n=S._queue.get(t);void 0!==n&&"read"===n.type;)r.push(n),t++,n=S._queue.get(t);var i=0;r.forEach(function(e){var t=e.args,n=t[t.length-1];t[t.length-1]=g(function(e){n.apply(null,e),++i===r.length&&f.nextTick(function(){r.forEach(function(){S._queue.shift()}),S._queue.length&&l()})}),s(e.fun,t)})}():(t=(e=o).args,n=t[t.length-1],t[t.length-1]=g(function(e){n.apply(null,e),f.nextTick(function(){S._queue.shift(),S._queue.length&&l()})}),s(e.fun,t))}function c(t){return g(function(e){S._queue.push({fun:t,args:e,type:"write"}),1===S._queue.length&&f.nextTick(l)})}function u(t){return g(function(e){S._queue.push({fun:t,args:e,type:"read"}),1===S._queue.length&&f.nextTick(l)})}function O(e){return("0000000000000000"+e).slice(-16)}function d(e,t){o.destroy(e,t)}Pe.has(e)?i=Pe.get(e):(i=new I.Map,Pe.set(e,i)),i.has(N)?(S=i.get(N),a()):i.set(N,m(h(N,t,function(e){if(e)return i.delete(N),n(e);(S=i.get(N))._docCount=-1,S._queue=new v,t.migrate?y.toSublevel(N,S,a):a()}))),T.type=function(){return"leveldb"},T._id=function(e){e(null,r)},T._info=function(e){var t={doc_count:S._docCount,update_seq:S._updateSeq,backend_adapter:H(o)};return f.nextTick(function(){e(null,t)})},T._get=u(function(e,i,o){i=_(i),A.docStore.get(e,function(e,n){if(e||!n)return o(U(L,"missing"));var r=Me(n);if(Fe(n,r)&&!i.rev)return o(U(L,"deleted"));r=i.rev?i.rev:r;var t=n.rev_map[r];A.bySeqStore.get(O(t),function(e,t){if(!t)return o(U(L));if("_id"in t&&t._id!==n.id)return o(new Error("wrong doc returned"));if(t._id=n.id,"_rev"in t){if(t._rev!==r)return o(new Error("wrong doc returned"))}else t._rev=r;return o(null,{doc:t,metadata:n})})})}),T._getAttachment=function(e,t,n,r,i){var o=n.digest,a=n.content_type;A.binaryStore.get(o,function(e,t){if(e)return"NotFoundError"!==e.name?i(e):i(null,r.binary?de([""],{type:a}):"");r.binary?i(null,we(t,a)):i(null,t.toString("base64"))})},T._bulkDocs=c(function(e,t,y){var n=t.new_edits,b=new Array(e.docs.length),_=new I.Map,w=new I.Map,k=new Ee,x=0,E=S._updateSeq,s=e.docs,r=s.map(function(e){if(e._id&&ce(e._id))return e;var t=J(e,n);return t.metadata&&!t.metadata.rev_map&&(t.metadata.rev_map={}),t}),i=r.filter(function(e){return e.error});if(i.length)return y(i[0]);function o(e,t){var n=D.resolve();e.forEach(function(e,r){n=n.then(function(){return new D(function(t,n){T._doCompactionNoLock(r,e,{ctx:k},function(e){if(e)return n(e);t()})})})}),n.then(function(){t()},t)}function a(){o(w,function(e){if(e&&u(e),T.auto_compaction)return t=u,n=new I.Map,_.forEach(function(e,t){var o;n.set(t,(o=[],Q(e.rev_tree,function(e,t,n,r,i){"available"!==i.status||e||(o.push(t+"-"+n),i.status="missing")}),o))}),void o(n,t);var t,n;u()})}function l(n,r,e,t,i,o,a,s){x+=o;var l=null,c=0;n.metadata.winningRev=r,n.metadata.deleted=e,n.data._id=n.metadata.id,n.data._rev=n.metadata.rev,t&&(n.data._deleted=!0),n.stemmedRevs.length&&w.set(n.metadata.id,n.stemmedRevs);var u=n.data._attachments?Object.keys(n.data._attachments):[];function p(e){c++,l||(e?s(l=e):c===u.length&&v())}function d(o,a,s){return function(e){var t,n,r,i;be(e,(t=o,n=a,r=e,i=s,function(e){!function(e,n,t,r,i){var o=e.data._attachments[t];delete o.data,o.digest=n,o.length=r.length;var a=e.metadata.id,s=e.metadata.rev;o.revpos=parseInt(s,10),C(a,s,n,function(e,t){return e?i(e):0===r.length?i(e):t?(k.batch([{type:"put",prefix:A.binaryStore,key:n,value:new P(r,"binary")}]),void i()):i(e)})}(t,Re+e,n,r,i)}))}}for(var f=0;f<u.length;f++){var h,m=u[f],g=n.data._attachments[m];if(g.stub)C(n.data._id,n.data._rev,g.digest,p);else if("string"==typeof g.data){try{h=ue(g.data)}catch(n){return void y(U(B,"Attachment is not a valid base64 string"))}d(n,m,p)(h)}else ke(g.data,d(n,m,p))}function v(){var e=n.metadata.rev_map[n.metadata.rev];if(e)return s();e=++E,n.metadata.rev_map[n.metadata.rev]=n.metadata.seq=e;var t=[{key:O(e),value:n.data,prefix:A.bySeqStore,type:"put"},{key:n.metadata.id,value:n.metadata,prefix:A.docStore,type:"put"}];k.batch(t),b[a]={ok:!0,id:n.metadata.id,rev:r},_.set(n.metadata.id,n.metadata),s()}u.length||v()}var c={};function C(r,i,o,t){function e(t){var e=[r,i].join("@"),n={};return t?t.refs&&(n.refs=t.refs,n.refs[e]=!0):(n.refs={},n.refs[e]=!0),new D(function(e){k.batch([{type:"put",prefix:A.attachmentStore,key:o,value:n}]),e(!t)})}var n=c[o]||D.resolve();c[o]=n.then(function(){return new D(function(n,r){k.get(A.attachmentStore,o,function(e,t){if(e&&"NotFoundError"!==e.name)return r(e);n(t)})}).then(e).then(function(e){t(null,e)},t)})}function u(e){if(e)return f.nextTick(function(){y(e)});k.batch([{prefix:A.metaStore,type:"put",key:Ie,value:E},{prefix:A.metaStore,type:"put",key:De,value:S._docCount+x}]),k.execute(S,function(e){if(e)return y(e);S._docCount+=x,S._updateSeq=E,Be.notify(N),f.nextTick(function(){y(null,b)})})}if(!r.length)return y(null,[]);!function(t){var i=[];if(s.forEach(function(n){n&&n._attachments&&Object.keys(n._attachments).forEach(function(e){var t=n._attachments[e];t.stub&&i.push(t.digest)})}),!i.length)return t();var o,a=0;i.forEach(function(e){var n,r;n=e,r=function(e){e&&!o&&(o=e),++a===i.length&&t(o)},k.get(A.attachmentStore,n,function(e){if(e){var t=U(F,"unknown stub attachment with digest "+n);r(t)}else r()})})}(function(e){if(e)return y(e);!function(e){var r,t=0;function i(){if(++t===s.length)return e(r)}s.forEach(function(n){if(n._id&&ce(n._id))return i();k.get(A.docStore,n._id,function(e,t){e?"NotFoundError"!==e.name&&(r=e):_.set(n._id,t),i()})})}(function(e){if(e)return y(e);!function(l,e,i,c,o,u,p,d,t){l=l||1e3;var f=d.new_edits,a=new I.Map,n=0,s=e.length;function h(){++n===s&&t&&t()}e.forEach(function(e,n){if(e._id&&ce(e._id)){var t=e._deleted?"_removeLocal":"_putLocal";i[t](e,{ctx:o},function(e,t){u[n]=e||t,h()})}else{var r=e.metadata.id;a.has(r)?(s--,a.get(r).push([e,n])):a.set(r,[[e,n]])}}),a.forEach(function(i,o){var a=0;function s(){++a<i.length?e():h()}function e(){var e=i[a],t=e[0],n=e[1];if(c.has(o))_e(l,c.get(o),t,u,n,s,p,f);else{var r=ae([],t.metadata.rev_tree[0],l);t.metadata.rev_tree=r.tree,t.stemmedRevs=r.stemmedRevs||[],function(e,t,n){var r=$(e.metadata),i=le(e.metadata,r);if("was_delete"in d&&i)return u[t]=U(L,"deleted"),n();if(f&&"missing"===e.metadata.rev_tree[0].ids[1].status){var o=U(R);return u[t]=o,n()}p(e,r,i,i,!1,i?0:1,t,n)}(t,n,s)}}e()})}(p,r,T,_,k,b,l,t,a)})})}),T._allDocs=u(function(d,o){var e;d=_(d),e=function(e,t){if(e)return o(e);var l,n={},c=d.skip||0;if(d.startkey&&(n.gte=d.startkey),d.endkey&&(n.lte=d.endkey),d.key&&(n.gte=n.lte=d.key),d.descending){n.reverse=!0;var r=n.lte;n.lte=n.gte,n.gte=r}if("number"==typeof d.limit&&(l=d.limit),0===l||"start"in n&&"end"in n&&n.start>n.end)return o(null,{total_rows:t,offset:d.skip,rows:[]});var u=[],p=A.docStore.readStream(n),i=b.obj(function(e,t,r){var i=e.value,o=Me(i),a=Fe(i,o);if(a){if("ok"!==d.deleted)return void r()}else{if(0<c--)return void r();if("number"==typeof l&&l--<=0)return p.unpipe(),p.destroy(),void r()}function n(e){var t={id:i.id,key:i.id,value:{rev:o}};if(d.include_docs)for(var n in t.doc=e,t.doc._rev=t.value.rev,d.conflicts&&(t.doc._conflicts=ee(i)),t.doc._attachments)t.doc._attachments.hasOwnProperty(n)&&(t.doc._attachments[n].stub=!0);if(!1===d.inclusive_end&&i.id===d.endkey)return r();if(a){if("ok"!==d.deleted)return r();t.value.deleted=!0,t.doc=null}u.push(t),r()}if(d.include_docs){var s=i.rev_map[o];A.bySeqStore.get(O(s),function(e,t){n(t)})}else n()},function(e){D.resolve().then(function(){if(d.include_docs&&d.attachments)return Ue(u,A,d)}).then(function(){o(null,{total_rows:t,offset:d.skip,rows:u})},o),e()}).on("unpipe",function(){i.end()});p.on("error",o),p.pipe(i)},S.isClosed()?e(new Error("database is closed")):e(null,S._docCount)}),T._changes=function(l){if((l=_(l)).continuous){var e=N+":"+W();return Be.addListener(N,e,T,l),Be.notify(N),{cancel:function(){Be.removeListener(N,e)}}}var c,u=l.descending,p=[],d=l.since||0,f=0,t={reverse:u};"limit"in l&&0<l.limit&&(c=l.limit),t.reverse||(t.start=O(l.since||0));var h,m=l.doc_ids&&new I.Set(l.doc_ids),g=q(l),v=new I.Map;function y(){l.done=!0,h&&l.limit&&l.limit<p.length&&(p.length=l.limit),n.unpipe(r),n.destroy(),l.continuous||l.cancelled||(l.include_docs&&l.attachments?Ue(p,A,l).then(function(){l.complete(null,{results:p,last_seq:d})}):l.complete(null,{results:p,last_seq:d}))}h="return_docs"in l?l.return_docs:!("returnDocs"in l)||l.returnDocs;var n=A.bySeqStore.readStream(t),r=b.obj(function(e,t,i){if(c&&c<=f)return y(),i();if(l.cancelled||l.done)return i();var n,r,o=(n=e.key,parseInt(n,10)),a=e.value;if(o===l.since&&!u)return i();if(m&&!m.has(a._id))return i();function s(r){var e=Me(r);function n(e){var t=l.processChange(e,r,l);t.seq=r.seq;var n=g(t);if("object"==typeof n)return l.complete(n);n&&(f++,l.attachments&&l.include_docs?Ue([t],A,l).then(function(){l.onChange(t)}):l.onChange(t),h&&p.push(t)),i()}if(r.seq!==o)return i();if(d=o,e===a._rev)return n(a);var t=r.rev_map[e];A.bySeqStore.get(O(t),function(e,t){n(t)})}if(r=v.get(a._id))return s(r);A.docStore.get(a._id,function(e,t){if(l.cancelled||l.done||S.isClosed()||ce(t.id))return i();v.set(a._id,t),s(t)})},function(e){if(l.cancelled)return e();h&&l.limit&&l.limit<p.length&&(p.length=l.limit),e()}).on("unpipe",function(){r.end(),y()});return n.pipe(r),{cancel:function(){l.cancelled=!0,y()}}},T._close=function(t){if(S.isClosed())return t(U(j));S.close(function(e){e?t(e):(i.delete(N),t())})},T._getRevisionTree=function(e,n){A.docStore.get(e,function(e,t){e?n(U(L)):n(null,t.rev_tree)})},T._doCompaction=c(function(e,t,n,r){T._doCompactionNoLock(e,t,n,r)}),T._doCompactionNoLock=function(c,u,p,d){if("function"==typeof p&&(d=p,p={}),!u.length)return d();var f=p.ctx||new Ee;f.get(A.docStore,c,function(e,n){if(e)return d(e);var t=u.map(function(e){var t=n.rev_map[e];return delete n.rev_map[e],t});Q(n.rev_tree,function(e,t,n,r,i){var o=t+"-"+n;-1!==u.indexOf(o)&&(i.status="missing")});var s=[];s.push({key:n.id,value:n,type:"put",prefix:A.docStore});var r,i={},o=0;function a(e){if(e&&(r=e),++o===u.length){if(r)return d(r);!function(){var t=Object.keys(i);if(!t.length)return l();var n,r=0;function o(e){e&&(n=e),++r===t.length&&l(n)}var a=new I.Map;u.forEach(function(e){a.set(c+"@"+e,!0)}),t.forEach(function(i){f.get(A.attachmentStore,i,function(e,t){if(e)return"NotFoundError"===e.name?o():o(e);var n=Object.keys(t.refs||{}).filter(function(e){return!a.has(e)}),r={};n.forEach(function(e){r[e]=!0}),n.length?s.push({key:i,type:"put",value:{refs:r},prefix:A.attachmentStore}):s=s.concat([{key:i,type:"del",prefix:A.attachmentStore},{key:i,type:"del",prefix:A.binaryStore}]),o()})})}()}}function l(e){return e?d(e):(f.batch(s),p.ctx?d():void f.execute(S,d))}t.forEach(function(e){s.push({key:O(e),type:"del",prefix:A.bySeqStore}),f.get(A.bySeqStore,O(e),function(e,n){if(e)return"NotFoundError"===e.name?a():a(e);Object.keys(n._attachments||{}).forEach(function(e){var t=n._attachments[e].digest;i[t]=!0}),a()})})})},T._getLocal=function(e,n){A.localStore.get(e,function(e,t){e?n(U(L)):n(null,t)})},T._putLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),t.ctx?T._putLocalNoLock(e,t,n):T._putLocalWithLock(e,t,n)},T._putLocalWithLock=c(function(e,t,n){T._putLocalNoLock(e,t,n)}),T._putLocalNoLock=function(i,o,a){delete i._revisions;var s=i._rev,l=i._id,c=o.ctx||new Ee;c.get(A.localStore,l,function(e,t){if(e&&s)return a(U(R));if(t&&t._rev!==s)return a(U(R));i._rev=s?"0-"+(parseInt(s.split("-")[1],10)+1):"0-1";var n=[{type:"put",prefix:A.localStore,key:l,value:i}];c.batch(n);var r={ok:!0,id:i._id,rev:i._rev};if(o.ctx)return a(null,r);c.execute(S,function(e){if(e)return a(e);a(null,r)})})},T._removeLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),t.ctx?T._removeLocalNoLock(e,t,n):T._removeLocalWithLock(e,t,n)},T._removeLocalWithLock=c(function(e,t,n){T._removeLocalNoLock(e,t,n)}),T._removeLocalNoLock=function(r,i,o){var a=i.ctx||new Ee;a.get(A.localStore,r._id,function(e,t){if(e)return"NotFoundError"!==e.name?o(e):o(U(L));if(t._rev!==r._rev)return o(U(R));a.batch([{prefix:A.localStore,type:"del",key:r._id}]);var n={ok:!0,id:r._id,rev:"0-0"};if(i.ctx)return o(null,n);a.execute(S,function(e){if(e)return o(e);o(null,n)})})},T._destroy=function(e,t){var n,r=H(o);if(!Pe.has(r))return d(N,t);(n=Pe.get(r)).has(N)?(Be.removeAllListeners(N),n.get(N).close(function(){n.delete(N),d(N,t)})):d(N,t)}}function He(e,t){var n=s.extend({db:l},e);qe.call(this,n,t)}He.valid=function(){return!0},He.use_prefix=!1;var ze="undefined"!=typeof PouchDB?PouchDB:Ve("pouchdb");ze?ze.adapter("memory",He,!0):function(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}("error",'memory adapter plugin error: Cannot find global "PouchDB" object! Did you remember to include pouchdb.js?')}).call(this,Ve("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},Ve("buffer").Buffer)},{_process:234,argsarray:113,buffer:117,debug:221,"double-ended-queue":151,events:160,inherits:223,"js-extend":178,levelup:192,lie:195,memdown:208,pouchdb:220,"pouchdb-collections":217,"spark-md5":311,"sublevel-pouchdb":316,through2:232,vuvuzela:339}],220:[function(Rr,jr,e){(function(p,t){"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var k=Rr("js-extend"),c=e(Rr("debug")),n=e(Rr("inherits")),r=e(Rr("lie")),C=Rr("pouchdb-collections"),d=e(Rr("argsarray")),s=Rr("events"),l=e(Rr("scope-eval")),f=e(Rr("spark-md5")),i=e(Rr("vuvuzela")),h=e(Rr("es6-promise-pool")),x=Rr("pouchdb-collate"),j="function"==typeof Promise?Promise:r;function a(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}var u=Function.prototype.toString,m=u.call(Object);function B(e){var t,n,r,i;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=B(e[n]);return t}if(e instanceof Date)return e.toISOString();if((i=e)instanceof ArrayBuffer||"undefined"!=typeof Blob&&i instanceof Blob)return a(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==m}(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=B(e[n]);void 0!==o&&(t[n]=o)}return t}function g(t){var n=!1;return d(function(e){if(n)throw new Error("once called more than once");n=!0,t.apply(this,e)})}function E(a){return d(function(i){var t,o=this,n="function"==typeof(i=B(i))[i.length-1]&&i.pop();n&&(t=function(e,t){p.nextTick(function(){n(e,t)})});var e=new j(function(n,r){var e;try{var t=g(function(e,t){e?r(e):n(t)});i.push(t),(e=a.apply(o,i))&&"function"==typeof e.then&&n(e)}catch(e){r(e)}});return t&&e.then(function(e){t(null,e)},t),e})}var v=c("pouchdb:api");function _(o,e){return E(d(function(r){if(this._closed)return j.reject(new Error("database is closed"));if(this._destroyed)return j.reject(new Error("database is destroyed"));var i=this;return function(r,i,e){if(v.enabled){for(var t=[r._db_name,i],n=0;n<e.length-1;n++)t.push(e[n]);v.apply(null,t);var o=e[e.length-1];e[e.length-1]=function(e,t){var n=[r._db_name,i];n=n.concat(e?["error",e]:["success",t]),v.apply(null,n),o(e,t)}}}(i,o,r),this.taskqueue.isReady?e.apply(this,r):new j(function(t,n){i.taskqueue.addTask(function(e){e?n(e):t(i[o].apply(i,r))})})}))}function w(e,t){for(var n={},r=0,i=t.length;r<i;r++){var o=t[r];o in e&&(n[o]=e[o])}return n}var o,y=6;function b(e){return e}function S(e){return[{ok:e}]}function T(i,o,u){var p={};o.docs.forEach(function(e){e.id in p?p[e.id].push(e):p[e.id]=[e]});var d=Object.keys(p).length,f=0,h=new Array(d);var n=Object.keys(p),a=0;!function c(){if(!(a>=n.length)){var e=Math.min(a+y,n.length),t=n.slice(a,e);r=a,t.forEach(function(a,e){var s=r+e,t=p[a],n=w(t[0],["atts_since","attachments"]);n.open_revs=t.map(function(e){return e.rev}),n.open_revs=n.open_revs.filter(b);var l=b;0===n.open_revs.length&&(delete n.open_revs,l=S),["revs","attachments","binary","ajax"].forEach(function(e){e in o&&(n[e]=o[e])}),i.get(a,n,function(e,t){var n,r,i,o;n=e?[{error:e}]:l(t),r=a,i=n,h[s]={id:r,docs:i},++f===d&&(o=[],h.forEach(function(t){t.docs.forEach(function(e){o.push({id:t.id,docs:[e]})})}),u(null,{results:o})),c()})}),a+=t.length}var r}()}function A(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}if(A())o=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),o=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){o=!1}function N(){return o}function O(){var t;s.EventEmitter.call(this),this._listeners={},t=this,A()?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&t.emit(e.dbName.newValue)}):N()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(e){t.emit(e.key)}):window.attachEvent("storage",function(e){t.emit(e.key)}))}function P(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function M(e){var t,n,r=0;return e||(r=2e3),t=e,n=r,t=parseInt(t,10)||0,(n=parseInt(n,10))!=n||n<=t?n=(t||1)<<1:n+=1,6e5<n&&(t=3e5,n=6e5),~~((n-t)*Math.random()+t)}function I(e,t){P("info","The above "+e+" is totally normal. "+t)}function D(e){Error.call(this,e.reason),this.status=e.status,this.name=e.error,this.message=e.reason,this.error=!0}n(O,s.EventEmitter),O.prototype.addListener=function(e,t,n,r){if(!this._listeners[t]){var i=this,o=!1;this._listeners[t]=a,this.on(e,a)}function a(){if(i._listeners[t])if(o)o="waiting";else{o=!0;var e=w(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);n.changes(e).on("change",function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,r.onChange(e))}).on("complete",function(){"waiting"===o&&setTimeout(function(){a()},0),o=!1}).on("error",function(){o=!1})}}},O.prototype.removeListener=function(e,t){t in this._listeners&&s.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t])},O.prototype.notifyLocalWindows=function(e){A()?chrome.storage.local.set({dbName:e}):N()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},O.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)},n(D,Error),D.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new D({status:401,error:"unauthorized",reason:"Name or password is incorrect."});var L=new D({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),R=new D({status:404,error:"not_found",reason:"missing"}),F=new D({status:409,error:"conflict",reason:"Document update conflict"}),U=new D({status:400,error:"bad_request",reason:"_id field must contain a string"}),q=new D({status:412,error:"missing_id",reason:"_id is required for puts"}),H=new D({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),z=new D({status:412,error:"precondition_failed",reason:"Database not open"}),V=new D({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),W=new D({status:500,error:"badarg",reason:"Some query argument is invalid"}),G=(new D({status:400,error:"invalid_request",reason:"Request was invalid"}),new D({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"})),K=new D({status:500,error:"doc_validation",reason:"Bad special document member"}),X=new D({status:400,error:"bad_request",reason:"Something wrong with the request"}),Y=new D({status:400,error:"bad_request",reason:"Document must be a JSON object"}),J=(new D({status:404,error:"not_found",reason:"Database not found"}),new D({status:500,error:"indexed_db_went_bad",reason:"unknown"})),$=new D({status:500,error:"web_sql_went_bad",reason:"unknown"}),Q=(new D({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),new D({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),new D({status:400,error:"bad_request",reason:"Invalid rev format"})),Z=(new D({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),new D({status:412,error:"missing_stub"}));new D({status:413,error:"invalid_url",reason:"Provided URL is invalid"});function ee(n,e){function t(e){for(var t in n)"function"!=typeof n[t]&&(this[t]=n[t]);void 0!==e&&(this.reason=e)}return t.prototype=D.prototype,new t(e)}function te(e){if("object"!=typeof e){var t=e;(e=V).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function ne(r){var i={},o=r.filter&&"function"==typeof r.filter;return i.query=r.query_params,function(e){e.doc||(e.doc={});var t=o&&function(e,t,n){try{return!e(t,n)}catch(e){var r="Filter function threw: "+e.toString();return ee(X,r)}}(r.filter,e.doc,i);if("object"==typeof t)return t;if(t)return!1;if(r.include_docs){if(!r.attachments)for(var n in e.doc._attachments)e.doc._attachments.hasOwnProperty(n)&&(e.doc._attachments[n].stub=!0)}else delete e.doc;return!0}}function re(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function ie(e){var t;if(e?"string"!=typeof e?t=ee(U):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=ee(H)):t=ee(q),t)throw t}function oe(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function ae(e){var t=oe(e);return t?t.join("/"):null}var se=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],le="queryKey",ce=/(?:^|&)([^&=]*)=?([^&]*)/g,ue=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function pe(c,u,p){return new j(function(s,l){c.get(u,function(e,t){if(e){if(404!==e.status)return l(e);t={}}var n,r,i,o=t._rev,a=p(t);if(!a)return s({updated:!1,rev:o});a._id=u,a._rev=o,s((r=a,i=p,(n=c).put(r).then(function(e){return{updated:!0,rev:e.rev}},function(e){if(409!==e.status)throw e;return pe(n,r._id,i)})))})})}var de="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");function fe(e){return 0|Math.random()*e}function he(e,t){t=t||de.length;var n="",r=-1;if(e){for(;++r<e;)n+=de[fe(t)];return n}for(;++r<36;)switch(r){case 8:case 13:case 18:case 23:n+="-";break;case 19:n+=de[3&fe(16)|8];break;default:n+=de[fe(16)]}return n}function me(e){for(var t,n,r,i,o=e.rev_tree.slice();i=o.pop();){var a=i.ids,s=a[2],l=i.pos;if(s.length)for(var c=0,u=s.length;c<u;c++)o.push({pos:l+1,ids:s[c]});else{var p=!!a[1].deleted,d=a[0];t&&!(r!==p?r:n!==l?n<l:t<d)||(t=d,n=l,r=p)}}return n+"-"+t}function ge(e,t){for(var n,r=e.slice();n=r.pop();)for(var i=n.pos,o=n.ids,a=o[2],s=t(0===a.length,i,o[0],n.ctx,o[1]),l=0,c=a.length;l<c;l++)r.push({pos:i+1,ids:a[l],ctx:s})}function ve(e,t){return e.pos-t.pos}function ye(e){var o=[];ge(e,function(e,t,n,r,i){e&&o.push({rev:t+"-"+n,pos:t,opts:i})}),o.sort(ve).reverse();for(var t=0,n=o.length;t<n;t++)delete o[t].pos;return o}function be(e){for(var t=me(e),n=ye(e.rev_tree),r=[],i=0,o=n.length;i<o;i++){var a=n[i];a.rev===t||a.opts.deleted||r.push(a.rev)}return r}function _e(e){var o=[];return ge(e.rev_tree,function(e,t,n,r,i){"available"!==i.status||e||(o.push(t+"-"+n),i.status="missing")}),o}function we(e){for(var t,n=[],r=e.slice();t=r.pop();){var i=t.pos,o=t.ids,a=o[0],s=o[1],l=o[2],c=0===l.length,u=t.history?t.history.slice():[];u.push({id:a,opts:s}),c&&n.push({pos:i+1-u.length,ids:u});for(var p=0,d=l.length;p<d;p++)r.push({pos:i+1,ids:l[p],history:u})}return n.reverse()}function ke(e,t){return e.pos-t.pos}function xe(e,t){for(var n,r,i=t,o=e.length;i<o;i++){var a=e[i],s=[a.id,a.opts,[]];r?(r[2].push(s),r=s):n=r=s}return n}function Ee(e,t){return e[0]<t[0]?-1:1}function Ce(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;0<n.length;){var i=n.pop(),o=i.tree1,a=i.tree2;(o[1].status||a[1].status)&&(o[1].status="available"===o[1].status||"available"===a[1].status?"available":"missing");for(var s=0;s<a[2].length;s++)if(o[2][0]){for(var l=!1,c=0;c<o[2].length;c++)o[2][c][0]===a[2][s][0]&&(n.push({tree1:o[2][c],tree2:a[2][s]}),l=!0);l||(r="new_branch",u=o[2],p=a[2][s],void 0,d=function(e,t,n){for(var r,i=0,o=e.length;i<o;)n(e[r=i+o>>>1],t)<0?i=r+1:o=r;return i}(u,p,Ee),u.splice(d,0,p))}else r="new_leaf",o[2][0]=a[2][s]}var u,p,d;return{conflicts:r,tree:e}}function Se(e,t,n){var r,i=[],o=!1,a=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,l=e.length;s<l;s++){var c=e[s];if(c.pos===t.pos&&c.ids[0]===t.ids[0])r=Ce(c.ids,t.ids),i.push({pos:c.pos,ids:r.tree}),o=o||r.conflicts,a=!0;else if(!0!==n){var u=c.pos<t.pos?c:t,p=c.pos<t.pos?t:c,d=p.pos-u.pos,f=[],h=[];for(h.push({ids:u.ids,diff:d,parent:null,parentIdx:null});0<h.length;){var m=h.pop();if(0!==m.diff)for(var g=m.ids[2],v=0,y=g.length;v<y;v++)h.push({ids:g[v],diff:m.diff-1,parent:m.ids,parentIdx:v});else m.ids[0]===p.ids[0]&&f.push(m)}var b=f[0];b?(r=Ce(b.ids,p.ids),b.parent[2][b.parentIdx]=r.tree,i.push({pos:u.pos,ids:u.ids}),o=o||r.conflicts,a=!0):i.push(c)}else i.push(c)}return a||i.push(t),i.sort(ke),{tree:i,conflicts:o||"internal_node"}}function Te(e,t,n){var r=Se(e,t),i=function(e,t){for(var n,r=we(e),i={},o=0,a=r.length;o<a;o++){for(var s=r[o],l=s.ids,c=Math.max(0,l.length-t),u={pos:s.pos+c,ids:xe(l,c)},p=0;p<c;p++){var d=s.pos+p+"-"+l[p].id;i[d]=!0}n=n?Se(n,u,!0).tree:[u]}return ge(n,function(e,t,n){delete i[t+"-"+n]}),{tree:n,revs:Object.keys(i)}}(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Ae(e){return e.ids}function Ne(e,t){t||(t=me(e));for(var n,r=t.substring(t.indexOf("-")+1),i=e.rev_tree.map(Ae);n=i.pop();){if(n[0]===r)return!!n[1].deleted;i=i.concat(n[2])}}function Oe(e){return/^_local/.test(e)}function Pe(i,t,n){s.EventEmitter.call(this);var o=this;this.db=i;var r=(t=t?B(t):{}).complete=g(function(e,t){var n,r;e?(r="error",0<("listenerCount"in(n=o)?n.listenerCount(r):s.EventEmitter.listenerCount(n,r))&&o.emit("error",e)):o.emit("complete",t),o.removeAllListeners(),i.removeListener("destroyed",a)});function a(){o.cancel()}n&&(o.on("complete",function(e){n(null,e)}),o.on("error",n)),i.once("destroyed",a),t.onChange=function(e){t.isCancelled||(function(e,t){try{e.emit("change",t)}catch(e){P("error",'Error in .on("change", function):',e)}}(o,e),o.startSeq&&o.startSeq<=e.seq&&(o.startSeq=!1))};var e=new j(function(n,r){t.complete=function(e,t){e?r(e):n(t)}});o.once("cancel",function(){i.removeListener("destroyed",a),t.complete(null,{status:"cancelled"})}),this.then=e.then.bind(e),this.catch=e.catch.bind(e),this.then(function(e){r(null,e)},r),i.taskqueue.isReady?o.doChanges(t):i.taskqueue.addTask(function(){o.isCancelled?o.emit("cancel"):o.doChanges(t)})}function Ie(e,t,n){var r=[{rev:e._rev}];"all_docs"===n.style&&(r=ye(t.rev_tree).map(function(e){return{rev:e.rev}}));var i={id:t.id,changes:r,doc:e};return Ne(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=be(t),i.doc._conflicts.length||delete i.doc._conflicts),i}function De(e,t){return e<t?-1:t<e?1:0}function Le(n){return function(e,t){e||t[0]&&t[0].error?n(e||t[0]):n(null,t.length?t[0]:t)}}function Re(e,t){var n=De(e._id,t._id);return 0!==n?n:De(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function je(){s.EventEmitter.call(this)}function Be(){this.isReady=!1,this.failed=!1,this.queue=[]}function Me(e){e&&t.debug&&P("error",e)}function Fe(o,a,s){if(!(this instanceof Fe))return new Fe(o,a,s);var l=this;if("function"!=typeof a&&void 0!==a||(s=a,a={}),o&&"object"==typeof o&&(a=o,o=void 0),void 0===s)s=Me;else{var e=s;s=function(){return P("warn","Using a callback for new PouchDB()is deprecated."),e.apply(null,arguments)}}o=o||a.name,delete(a=B(a)).name,this.__opts=a;var t=s;l.auto_compaction=a.auto_compaction,l.prefix=Fe.prefix,je.call(l),l.taskqueue=new Be;var n=new j(function(n,r){var t,i;if(s=function(e,t){if(e)return r(e);delete t.then,n(t)},a=B(a),function(){try{if("string"!=typeof o)throw(i=new Error("Missing/invalid DB name")).code=400,i;var e=(a.prefix||"")+o;if(t=Fe.parseAdapter(e,a),a.originalName=o,a.name=t.name,a.adapter=a.adapter||t.adapter,l._adapter=a.adapter,c("pouchdb:adapter")("Picked adapter: "+a.adapter),l._db_name=o,!Fe.adapters[a.adapter])throw(i=new Error("Adapter is missing")).code=404,i;if(!Fe.adapters[a.adapter].valid())throw(i=new Error("Invalid Adapter")).code=404,i}catch(e){l.taskqueue.fail(e)}}(),i)return r(i);l.adapter=a.adapter,l.replicate={},l.replicate.from=function(e,t,n){return l.constructor.replicate(e,l,t,n)},l.replicate.to=function(e,t,n){return l.constructor.replicate(l,e,t,n)},l.sync=function(e,t,n){return l.constructor.sync(l,e,t,n)},l.replicate.sync=l.sync,Fe.adapters[a.adapter].call(l,a,function(e){if(e)return l.taskqueue.fail(e),void s(e);(function(e,t){var n=t.originalName,r=e.constructor,i=r._destructionListeners;function o(){r.emit("destroyed",n)}e.once("destroyed",o),i.has(n)||i.set(n,[]),i.get(n).push(function(){e.removeListener("destroyed",o),e.emit("destroyed",e)})})(l,a),l.emit("created",l),Fe.emit("created",a.originalName),l.taskqueue.ready(l),s(null,l)})});n.then(function(e){t(null,e)},t),l.then=n.then.bind(n),l.catch=n.catch.bind(n)}n(Pe,s.EventEmitter),Pe.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Pe.prototype.doChanges=function(t){var n=this,r=t.complete;if("live"in(t=B(t))&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=Ie,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"!==t.since){if(t.continuous&&"now"!==t.since&&this.db.info().then(function(e){n.startSeq=e.update_seq},function(e){if("idbNull"!==e.id)throw e}),t.view&&!t.filter&&(t.filter="_view"),t.filter&&"string"==typeof t.filter&&("_view"===t.filter?t.view=ae(t.view):t.filter=ae(t.filter),"http"!==this.db.type()&&!t.doc_ids))return this.filterChanges(t);"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=r;var i=this.db._changes(t);if(i&&"function"==typeof i.cancel){var o=n.cancel;n.cancel=d(function(e){i.cancel(),o.apply(this,e)})}}else this.db.info().then(function(e){n.isCancelled?r(null,{status:"cancelled"}):(t.since=e.update_seq,n.doChanges(t))},r)},Pe.prototype.filterChanges=function(r){var i=this,o=r.complete;if("_view"===r.filter){if(!r.view||"string"!=typeof r.view){var e=ee(X,"`view` filter parameter not found or invalid.");return o(e)}var a=oe(r.view);this.db.get("_design/"+a[0],function(e,t){if(i.isCancelled)return o(null,{status:"cancelled"});if(e)return o(te(e));var n=t&&t.views&&t.views[a[1]]&&t.views[a[1]].map;if(!n)return o(ee(R,t.views?"missing json key: "+a[1]:"missing json key: views"));r.filter=new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+n+";","view(doc);","if (emitted) {","  return true;","}"].join("\n")),i.doChanges(r)})}else{var s=oe(r.filter);if(!s)return i.doChanges(r);this.db.get("_design/"+s[0],function(e,t){if(i.isCancelled)return o(null,{status:"cancelled"});if(e)return o(te(e));var n=t&&t.filters&&t.filters[s[1]];if(!n)return o(ee(R,t&&t.filters?"missing json key: "+s[1]:"missing json key: filters"));r.filter=l("return "+n+";",{}),i.doChanges(r)})}},n(je,s.EventEmitter),je.prototype.post=_("post",function(e,t,n){if("function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e))return n(ee(Y));this.bulkDocs({docs:[e]},t,Le(n))}),je.prototype.put=_("put",d(function(e){var t,n,r,i,o=!1,a=e.shift(),s="_id"in a;if("object"!=typeof a||Array.isArray(a))return(i=e.pop())(ee(Y));function l(){o||(P("warn","db.put(doc, id, rev) has been deprecated and will be removed in a future release, please use db.put({_id: id, _rev: rev}) instead"),o=!0)}for(;"string"!=(n=typeof(t=e.shift()))||s?"string"!==n||!s||"_rev"in a?"object"===n?r=t:"function"===n&&(i=t):(l(),a._rev=t):(l(),a._id=t,s=!0),e.length;);if(r=r||{},ie(a._id),Oe(a._id)&&"function"==typeof this._putLocal)return a._deleted?this._removeLocal(a,i):this._putLocal(a,i);this.bulkDocs({docs:[a]},r,Le(i))})),je.prototype.putAttachment=_("putAttachment",function(t,n,r,i,o){var a=this;function s(e){var t="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[n]={content_type:o,data:i,revpos:++t},a.put(e)}return"function"==typeof o&&(o=i,i=r,r=null),void 0===o&&(o=i,i=r,r=null),a.get(t).then(function(e){if(e._rev!==r)throw ee(F);return s(e)},function(e){if(e.reason===R.message)return s({_id:t});throw e})}),je.prototype.removeAttachment=_("removeAttachment",function(e,n,r,i){var o=this;o.get(e,function(e,t){if(e)i(e);else if(t._rev===r){if(!t._attachments)return i();delete t._attachments[n],0===Object.keys(t._attachments).length&&delete t._attachments,o.put(t,i)}else i(ee(F))})}),je.prototype.remove=_("remove",function(e,t,n,r){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(i=e,"function"==typeof t?(r=t,n={}):(r=n,n=t)),(n=n||{}).was_delete=!0;var o={_id:i._id,_rev:i._rev||n.rev,_deleted:!0};if(Oe(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(i,r);this.bulkDocs({docs:[o]},n,Le(r))}),je.prototype.revsDiff=_("revsDiff",function(o,e,a){"function"==typeof e&&(a=e,e={});var c=Object.keys(o);if(!c.length)return a(null,{});var u=0,p=new C.Map;function d(e,t){p.has(e)||p.set(e,{missing:[]}),p.get(e).missing.push(t)}c.map(function(i){this._getRevisionTree(i,function(e,t){if(e&&404===e.status&&"missing"===e.message)p.set(i,{missing:o[i]});else{if(e)return a(e);n=t,l=o[s=i].slice(0),ge(n,function(e,t,n,r,i){var o=t+"-"+n,a=l.indexOf(o);-1!==a&&(l.splice(a,1),"available"!==i.status&&d(s,o))}),l.forEach(function(e){d(s,e)})}var s,n,l;if(++u===c.length){var r={};return p.forEach(function(e,t){r[t]=e}),a(null,r)}})},this)}),je.prototype.bulkGet=_("bulkGet",function(e,t){T(this,e,t)}),je.prototype.compactDocument=_("compactDocument",function(r,i,c){var u=this;this._getRevisionTree(r,function(e,t){if(e)return c(e);var o,a,n=(o={},a=[],ge(t,function(e,t,n,r){var i=t+"-"+n;return e&&(o[i]=0),void 0!==r&&a.push({from:r,to:i}),i}),a.reverse(),a.forEach(function(e){void 0===o[e.from]?o[e.from]=1+o[e.to]:o[e.from]=Math.min(o[e.from],1+o[e.to])}),o),s=[],l=[];Object.keys(n).forEach(function(e){n[e]>i&&s.push(e)}),ge(t,function(e,t,n,r,i){var o=t+"-"+n;"available"===i.status&&-1!==s.indexOf(o)&&l.push(o)}),u._doCompaction(r,l,c)})}),je.prototype.compact=_("compact",function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:t}),1===this._compactionQueue.length&&function n(r){var e=r._compactionQueue[0],t=e.opts,i=e.callback;r.get("_local/compaction").catch(function(){return!1}).then(function(e){e&&e.last_seq&&(t.last_seq=e.last_seq),r._compact(t,function(e,t){e?i(e):i(null,t),p.nextTick(function(){r._compactionQueue.shift(),r._compactionQueue.length&&n(r)})})})}(this)}),je.prototype._compact=function(e,n){var r=this,t={return_docs:!1,last_seq:e.last_seq||0},i=[];r.changes(t).on("change",function(e){i.push(r.compactDocument(e.id,0))}).on("complete",function(e){var t=e.last_seq;j.all(i).then(function(){return pe(r,"_local/compaction",function(e){return(!e.last_seq||e.last_seq<t)&&(e.last_seq=t,e)})}).then(function(){n(null,{ok:!0})}).catch(n)}).on("error",n)},je.prototype.get=_("get",function(e,f,h){if("function"==typeof f&&(h=f,f={}),"string"!=typeof e)return h(ee(U));if(Oe(e)&&"function"==typeof this._getLocal)return this._getLocal(e,h);var n=[],m=this;function r(){var r=[],i=n.length;if(!i)return h(null,r);n.forEach(function(n){m.get(e,{rev:n,revs:f.revs,attachments:f.attachments},function(e,t){e?r.push({missing:n}):r.push({ok:t}),--i||h(null,r)})})}if(!f.open_revs)return this._get(e,f,function(e,t){if(e)return h(e);var i=t.doc,n=t.metadata,o=t.ctx;if(f.conflicts){var r=be(n);r.length&&(i._conflicts=r)}if(Ne(n,i._rev)&&(i._deleted=!0),f.revs||f.revs_info){var a=function(e,t){for(var n=0;n<e.length;n++)if(!0===t(e[n],n))return e[n]}(we(n.rev_tree),function(e){return-1!==e.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])}),s=a.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])+1,l=a.ids.length-s;if(a.ids.splice(s,l),a.ids.reverse(),f.revs&&(i._revisions={start:a.pos+a.ids.length-1,ids:a.ids.map(function(e){return e.id})}),f.revs_info){var c=a.pos+a.ids.length;i._revs_info=a.ids.map(function(e){return{rev:--c+"-"+e.id,status:e.opts.status}})}}if(f.attachments&&i._attachments){var u=i._attachments,p=Object.keys(u).length;if(0===p)return h(null,i);Object.keys(u).forEach(function(r){this._getAttachment(i._id,r,u[r],{rev:i._rev,binary:f.binary,ctx:o},function(e,t){var n=i._attachments[r];n.data=t,delete n.stub,delete n.length,--p||h(null,i)})},m)}else{if(i._attachments)for(var d in i._attachments)i._attachments.hasOwnProperty(d)&&(i._attachments[d].stub=!0);h(null,i)}});if("all"===f.open_revs)this._getRevisionTree(e,function(e,t){if(e)return h(e);n=ye(t).map(function(e){return e.rev}),r()});else{if(!Array.isArray(f.open_revs))return h(ee(V,"function_clause"));n=f.open_revs;for(var t=0;t<n.length;t++){var i=n[t];if("string"!=typeof i||!/^\d+-/.test(i))return h(ee(Q))}r()}}),je.prototype.getAttachment=_("getAttachment",function(n,r,i,o){var a=this;i instanceof Function&&(o=i,i={}),this._get(n,i,function(e,t){return e?o(e):t.doc._attachments&&t.doc._attachments[r]?(i.ctx=t.ctx,i.binary=!0,void a._getAttachment(n,r,t.doc._attachments[r],i,o)):o(ee(R))})}),je.prototype.allDocs=_("allDocs",function(t,e){if("function"==typeof t&&(e=t,t={}),t.skip=void 0!==t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return e(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(e){return e in t})[0];if(n)return void e(ee(G,"Query parameter `"+n+"` is not compatible with multi-get"));if("http"!==this.type())return function(e,n,t){var r="limit"in n?n.keys.slice(n.skip,n.limit+n.skip):0<n.skip?n.keys.slice(n.skip):n.keys;if(n.descending&&r.reverse(),!r.length)return e._allDocs({limit:0},t);var o={offset:n.skip};return j.all(r.map(function(i){var t=k.extend({key:i,deleted:"ok"},n);return["limit","skip","keys"].forEach(function(e){delete t[e]}),new j(function(n,r){e._allDocs(t,function(e,t){if(e)return r(e);o.total_rows=t.total_rows,n(t.rows[0]||{key:i,error:"not_found"})})})})).then(function(e){return o.rows=e,o})}(this,t,e)}return this._allDocs(t,e)}),je.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),new Pe(this,e,t)},je.prototype.close=_("close",function(e){return this._closed=!0,this._close(e)}),je.prototype.info=_("info",function(n){var r=this;this._info(function(e,t){if(e)return n(e);t.db_name=t.db_name||r._db_name,t.auto_compaction=!(!r.auto_compaction||"http"===r.type()),t.adapter=r.type(),n(null,t)})}),je.prototype.id=_("id",function(e){return this._id(e)}),je.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},je.prototype.bulkDocs=_("bulkDocs",function(e,n,r){if("function"==typeof n&&(r=n,n={}),n=n||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return r(ee(L));for(var t=0;t<e.docs.length;++t)if("object"!=typeof e.docs[t]||Array.isArray(e.docs[t]))return r(ee(Y));var i;return e.docs.forEach(function(e){e._attachments&&Object.keys(e._attachments).forEach(function(e){var t;i=i||"_"===(t=e).charAt(0)&&t+"is not a valid attachment name, attachment names cannot start with '_'"})}),i?r(ee(X,i)):("new_edits"in n||(n.new_edits=!("new_edits"in e)||e.new_edits),n.new_edits||"http"===this.type()||e.docs.sort(Re),function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var o=r[i];n._attachments[o]=w(n._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}(e.docs),this._bulkDocs(e,n,function(e,t){if(e)return r(e);n.new_edits||(t=t.filter(function(e){return e.error})),r(null,t)}))}),je.prototype.registerDependentDatabase=_("registerDependentDatabase",function(t,e){var n=new this.constructor(t,this.__opts);pe(this,"_local/_pouch_dependentDbs",function(e){return e.dependentDbs=e.dependentDbs||{},!e.dependentDbs[t]&&(e.dependentDbs[t]=!0,e)}).then(function(){e(null,{db:n})}).catch(e)}),je.prototype.destroy=_("destroy",function(e,o){"function"==typeof e&&(o=e,e={});var a=this,s=!("use_prefix"in a)||a.use_prefix;function l(){a._destroy(e,function(e,t){if(e)return o(e);a._destroyed=!0,a.emit("destroyed"),o(null,t||{ok:!0})})}if("http"===a.type())return l();a.get("_local/_pouch_dependentDbs",function(e,t){if(e)return 404!==e.status?o(e):l();var n=t.dependentDbs,r=a.constructor,i=Object.keys(n).map(function(e){var t=s?e.replace(new RegExp("^"+r.prefix),""):e;return new r(t,a.__opts).destroy()});j.all(i).then(l,o)})}),Be.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},Be.prototype.fail=function(e){this.failed=e,this.execute()},Be.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},Be.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},n(Fe,je),Fe.debug=c,Fe.adapters={},Fe.preferredAdapters=[],Fe.prefix="_pouch_";var Ue=new s.EventEmitter;(function(t){Object.keys(s.EventEmitter.prototype).forEach(function(e){"function"==typeof s.EventEmitter.prototype[e]&&(t[e]=Ue[e].bind(Ue))});var n=t._destructionListeners=new C.Map;t.on("destroyed",function(e){n.get(e).forEach(function(e){e()}),n.delete(e)})})(Fe),Fe.parseAdapter=function(e,t){var n,r,i=e.match(/([a-z\-]*):\/\/(.*)/);if(i){if(e=/http(s?)/.test(i[1])?i[1]+"://"+i[2]:i[2],n=i[1],!Fe.adapters[n].valid())throw"Invalid adapter";return{name:e,adapter:i[1]}}var o="idb"in Fe.adapters&&"websql"in Fe.adapters&&N()&&localStorage["_pouch__websqldb_"+Fe.prefix+e];if(t.adapter)r=t.adapter;else if(void 0!==t&&t.db)r="leveldb";else for(var a=0;a<Fe.preferredAdapters.length;++a)if((r=Fe.preferredAdapters[a])in Fe.adapters){if(o&&"idb"===r){P("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}return{name:(n=Fe.adapters[r])&&"use_prefix"in n&&!n.use_prefix?e:Fe.prefix+e,adapter:r}},Fe.adapter=function(e,t,n){t.valid()&&(Fe.adapters[e]=t,n&&Fe.preferredAdapters.push(e))},Fe.plugin=function(t){return"function"==typeof t?t(Fe):Object.keys(t).forEach(function(e){Fe.prototype[e]=t[e]}),Fe},Fe.defaults=function(r){function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);"function"!=typeof t&&void 0!==t||(n=t,t={}),e&&"object"==typeof e&&(t=e,e=void 0),t=k.extend({},r,t),Fe.call(this,e,t,n)}return n(i,Fe),i.preferredAdapters=Fe.preferredAdapters.slice(),Object.keys(Fe).forEach(function(e){e in i||(i[e]=Fe[e])}),i};function qe(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}Fe.version="5.4.5";var He=qe(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),ze=qe(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Ve(e){if(!/^\d+\-./.test(e))return ee(Q);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function We(e,t){var n,r,i,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=he()),r=he(32,16).toLowerCase(),e._rev){if((i=Ve(e._rev)).error)return i;e._rev_tree=[{pos:i.prefix,ids:[i.id,{status:"missing"},[[r,o,[]]]]}],n=i.prefix+1}else e._rev_tree=[{pos:1,ids:[r,o,[]]}],n=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],o=1,a=r.length;o<a;o++)i=[r[o],{status:"missing"},[i]];return[{pos:n,ids:i}]}(e._revisions,o),n=e._revisions.start,r=e._revisions.ids[0]),!e._rev_tree){if((i=Ve(e._rev)).error)return i;n=i.prefix,r=i.id,e._rev_tree=[{pos:n,ids:[r,o,[]]}]}ie(e._id),e._rev=n+"-"+r;var a={metadata:{},data:{}};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var l="_"===s[0];if(l&&!He[s]){var c=ee(K,s);throw c.message=K.message+": "+s,c}l&&!ze[s]?a.metadata[s.slice(1)]=e[s]:a.data[s]=e[s]}return a}var Ge=function(e){return atob(e)},Ke=function(e){return btoa(e)};function Xe(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(e){if("TypeError"!==e.name)throw e;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<t.length;i+=1)r.append(t[i]);return r.getBlob(n.type)}}function Ye(e,t){return Xe([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}(e)],{type:t})}function Je(e,t){return Ye(Ge(e),t)}function $e(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}function Qe(e,n){if("undefined"==typeof FileReader)return n($e((new FileReaderSync).readAsArrayBuffer(e)));var t=new FileReader,r="function"==typeof t.readAsBinaryString;t.onloadend=function(e){var t=e.target.result||"";if(r)return n(t);n($e(t))},r?t.readAsBinaryString(e):t.readAsArrayBuffer(e)}function Ze(e,t){Qe(e,function(e){t(e)})}function et(e,t){Ze(e,function(e){t(Ke(e))})}function tt(e,n){if("undefined"==typeof FileReader)return n((new FileReaderSync).readAsArrayBuffer(e));var t=new FileReader;t.onloadend=function(e){var t=e.target.result||new ArrayBuffer(0);n(t)},t.readAsArrayBuffer(e)}var nt=t.setImmediate||t.setTimeout,rt=32768;function it(t,e,n,r,i){var o,a,s;(0<n||r<e.size)&&(a=n,s=r,e=(o=e).webkitSlice?o.webkitSlice(a,s):o.slice(a,s)),tt(e,function(e){t.append(e),i()})}function ot(e,t,n,r,i){(0<n||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function at(t,n){var e="string"==typeof t,r=e?t.length:t.size,i=Math.min(rt,r),o=Math.ceil(r/i),a=0,s=e?new f:new f.ArrayBuffer,l=e?ot:it;function c(){nt(p)}function u(){var e,t=(e=s.end(!0),Ke(e));n(t),s.destroy()}function p(){var e=a*i;l(s,t,e,e+i,++a<o?c:u)}p()}function st(t,e,n){var r=function(e){try{return Ge(e)}catch(e){return{error:ee(W,"Attachment is not a valid base64 string")}}}(t.data);if(r.error)return n(r.error);t.length=r.length,t.data="blob"===e?Ye(r,t.content_type):"base64"===e?Ke(r):r,at(r,function(e){t.digest="md5-"+e,n()})}function lt(e,t,n){if(e.stub)return n();var r,i,o;"string"==typeof e.data?st(e,t,n):(i=t,o=n,at((r=e).data,function(e){r.digest="md5-"+e,r.length=r.data.size||r.data.length||0,"binary"===i?Ze(r.data,function(e){r.data=e,o()}):"base64"===i?et(r.data,function(e){r.data=e,o()}):o()}))}function ct(e,o,t){if(!e.length)return t();var a,n=0;function s(){n++,e.length===n&&(a?t(a):t())}e.forEach(function(e){var t=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],n=0;if(!t.length)return s();function r(e){a=e,++n===t.length&&s()}for(var i in e.data._attachments)e.data._attachments.hasOwnProperty(i)&&lt(e.data._attachments[i],o,r)})}function ut(e,t,n,r,i,o,a,s){if(function(e,t){for(var n,r=e.slice(),i=t.split("-"),o=parseInt(i[0],10),a=i[1];n=r.pop();){if(n.pos===o&&n.ids[0]===a)return!0;for(var s=n.ids[2],l=0,c=s.length;l<c;l++)r.push({pos:n.pos+1,ids:s[l]})}return!1}(t.rev_tree,n.metadata.rev))return r[i]=n,o();var l=t.winningRev||me(t),c="deleted"in t?t.deleted:Ne(t,l),u="deleted"in n.metadata?n.metadata.deleted:Ne(n.metadata),p=/^1-/.test(n.metadata.rev);if(c&&!u&&s&&p){var d=n.data;d._rev=l,d._id=n.metadata.id,n=We(d,s)}var f=Te(t.rev_tree,n.metadata.rev_tree[0],e);if(s&&(c&&u||!c&&"new_leaf"!==f.conflicts||c&&!u&&"new_branch"===f.conflicts)){var h=ee(F);return r[i]=h,o()}var m=n.metadata.rev;n.metadata.rev_tree=f.tree,n.stemmedRevs=f.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var g=me(n.metadata),v=Ne(n.metadata,g),y=c===v?0:c<v?-1:1;a(n,g,v,m===g?v:Ne(n.metadata,m),!0,y,i,o)}function pt(l,e,i,c,o,u,p,d,t){l=l||1e3;var f=d.new_edits,a=new C.Map,n=0,s=e.length;function h(){++n===s&&t&&t()}e.forEach(function(e,n){if(e._id&&Oe(e._id)){var t=e._deleted?"_removeLocal":"_putLocal";i[t](e,{ctx:o},function(e,t){u[n]=e||t,h()})}else{var r=e.metadata.id;a.has(r)?(s--,a.get(r).push([e,n])):a.set(r,[[e,n]])}}),a.forEach(function(i,o){var a=0;function s(){++a<i.length?e():h()}function e(){var e=i[a],t=e[0],n=e[1];if(c.has(o))ut(l,c.get(o),t,u,n,s,p,f);else{var r=Te([],t.metadata.rev_tree[0],l);t.metadata.rev_tree=r.tree,t.stemmedRevs=r.stemmedRevs||[],function(e,t,n){var r=me(e.metadata),i=Ne(e.metadata,r);if("was_delete"in d&&i)return u[t]=ee(R,"deleted"),n();if(f&&"missing"===e.metadata.rev_tree[0].ids[1].status){var o=ee(F);return u[t]=o,n()}p(e,r,i,i,!1,i?0:1,t,n)}(t,n,s)}}e()})}var dt=5,ft="document-store",ht="by-sequence",mt="attach-store",gt="attach-seq-store",vt="meta-store",yt="local-store",bt="detect-blob-support";function _t(e){return e.length<5e4?JSON.parse(e):function(t){try{return JSON.parse(t)}catch(e){return i.parse(t)}}(e)}function wt(t){try{return JSON.stringify(t)}catch(e){return i.stringify(t)}}var kt={running:!1,queue:[]};function xt(n){return function(e){var t="unknown_error";e.target&&e.target.error&&(t=e.target.error.name||e.target.error.message),n(ee(J,t,e.type))}}function Et(e,t,n){return{data:wt(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Ct(e){if(!e)return null;var t=_t(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function St(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function Tt(e,t,n,r){n?r(e?"string"!=typeof e?e:Je(e,t):Xe([""],{type:t})):e?"string"!=typeof e?Qe(e,function(e){r(Ke(e))}):r(e):r("")}function At(i,o,a,e){var t=Object.keys(i._attachments||{});if(!t.length)return e&&e();var n=0;function s(){++n===t.length&&e&&e()}t.forEach(function(e){var t,n,r;o.attachments&&o.include_docs?(t=e,n=i._attachments[t],r=n.digest,a.objectStore(mt).get(r).onsuccess=function(e){n.body=e.target.result.body,s()}):(i._attachments[e].stub=!0,s())})}function Nt(e,a){return j.all(e.map(function(o){if(o.doc&&o.doc._attachments){var e=Object.keys(o.doc._attachments);return j.all(e.map(function(n){var r=o.doc._attachments[n];if("body"in r){var e=r.body,i=r.content_type;return new j(function(t){Tt(e,i,a,function(e){o.doc._attachments[n]=k.extend(w(r,["digest","content_type"]),{data:e}),t()})})}}))}}))}function Ot(e,r,t){var i=[],o=t.objectStore(ht),n=t.objectStore(mt),a=t.objectStore(gt),s=e.length;function l(){--s||i.length&&i.forEach(function(t){a.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::",!1,!1)).onsuccess=function(e){e.target.result||n.delete(t)}})}e.forEach(function(e){var t=o.index("_doc_id_rev"),n=r+"::"+e;t.getKey(n).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return l();o.delete(t),a.index("seq").openCursor(IDBKeyRange.only(t)).onsuccess=function(e){var t=e.target.result;if(t){var n=t.value.digestSeq.split("::")[0];i.push(n),a.delete(t.primaryKey),t.continue()}else l()}}})}function Pt(e,t,n){try{return{txn:e.transaction(t,n)}}catch(e){return{error:e}}}function It(e,w,k,t){function n(o,e){var t="startkey"in o&&o.startkey,n="endkey"in o&&o.endkey,r="key"in o&&o.key,a=o.skip||0,s="number"==typeof o.limit?o.limit:-1,i=!1!==o.inclusive_end,l="descending"in o&&o.descending?"prev":null,c=function(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(e){return{error:e}}return null}(t,n,i,r,l);if(c&&c.error)return function(e,t,n,r){if("DataError"===n.name&&0===n.code)return r(null,{total_rows:e._meta.docCount,offset:t.skip,rows:[]});r(ee(J,n.name,n.message))}(w,o,c.error,e);var u=[ft,ht];o.attachments&&u.push(mt);var p=Pt(k,u,"readonly");if(p.error)return e(p.error);var d=p.txn,f=d.objectStore(ft),h=d.objectStore(ht),m=l?f.openCursor(c,l):f.openCursor(c),g=h.index("_doc_id_rev"),v=[],y=0;function b(t,n,e){var r=t.id+"::"+e;g.get(r).onsuccess=function(e){n.doc=St(e.target.result),o.conflicts&&(n.doc._conflicts=be(t)),At(n.doc,o,d)}}function _(){e(null,{total_rows:y,offset:o.skip,rows:v})}d.oncomplete=function(){o.attachments?Nt(v,o.binary).then(_):_()},m.onsuccess=function(e){y=w._meta.docCount;var t=e.target.result;if(t){var n=Ct(t.value);!function(e,t,n){var r={id:n.id,key:n.id,value:{rev:t}},i=n.deleted;if("ok"===o.deleted)v.push(r),i?(r.value.deleted=!0,r.doc=null):o.include_docs&&b(n,r,t);else if(!i&&a--<=0&&(v.push(r),o.include_docs&&b(n,r,t),0==--s))return;e.continue()}(t,n.winningRev,n)}}}!function(e,t){if(0===e.limit)return t(null,{total_rows:w._meta.docCount,offset:e.skip,rows:[]});n(e,t)}(e,t)}var Dt,Lt=new C.Map,Rt=new O,jt=new C.Map;function Bt(t,e){var n=this;kt.queue.push({action:function(e){!function(b,r,l){var _=r.name,w=null;function a(e,i){var o=e.objectStore(ft);o.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),o.openCursor().onsuccess=function(e){var t=e.target.result;if(t){var n=t.value,r=Ne(n);n.deletedOrLocal=r?"1":"0",o.put(n),t.continue()}else i()}}function s(e,d){var f=e.objectStore(yt),h=e.objectStore(ft),m=e.objectStore(ht);h.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var t=n.value,r=t.id,i=Oe(r),o=me(t);if(i){var a=r+"::"+o,s=r+"::",l=r+"::~",c=m.index("_doc_id_rev"),u=IDBKeyRange.bound(s,l,!1,!1),p=c.openCursor(u);p.onsuccess=function(e){if(p=e.target.result){var t=p.value;t._doc_id_rev===a&&f.put(t),m.delete(p.primaryKey),p.continue()}else h.delete(n.primaryKey),n.continue()}}else n.continue()}else d&&d()}}function c(e,c){var t=e.objectStore(ht),n=e.objectStore(mt),u=e.objectStore(gt);n.count().onsuccess=function(e){if(!e.target.result)return c();t.openCursor().onsuccess=function(e){var t=e.target.result;if(!t)return c();for(var n=t.value,r=t.primaryKey,i=Object.keys(n._attachments||{}),o={},a=0;a<i.length;a++)o[n._attachments[i[a]].digest]=!0;var s=Object.keys(o);for(a=0;a<s.length;a++){var l=s[a];u.put({seq:r,digestSeq:l+"::"+r})}t.continue()}}}function u(e){var l=e.objectStore(ht),c=e.objectStore(ft);c.openCursor().onsuccess=function(e){var t=e.target.result;if(t){var n,r,i,o,a=(n=t.value).data?Ct(n):(n.deleted="1"===n.deletedOrLocal,n);if(a.winningRev=a.winningRev||me(a),a.seq)return s();r=a.id+"::",i=a.id+"::",o=0,l.index("_doc_id_rev").openCursor(IDBKeyRange.bound(r,i)).onsuccess=function(e){var t=e.target.result;if(!t)return a.seq=o,s();var n=t.primaryKey;o<n&&(o=n),t.continue()}}function s(){var e=Et(a,a.winningRev,a.deleted);c.put(e).onsuccess=function(){t.continue()}}}}b._meta=null,b.type=function(){return"idb"},b._id=E(function(e){e(null,b._meta.instanceId)}),b._bulkDocs=function(e,t,n){!function(a,e,s,p,t,n,r){for(var d,f,h,m,g,i,l=e.docs,c=0,o=0,u=l.length;o<u;o++){var v=l[o];v._id&&Oe(v._id)||(v=l[o]=We(v,s.new_edits)).error&&!i&&(i=v)}if(i)return r(i);var y=new Array(l.length),b=new C.Map,_=!1,w=p._meta.blobSupport?"blob":"base64";function k(){_||(n.notify(p._meta.name),p._meta.docCount+=c,r(null,y))}function x(e,t,n,r,i,o,a,s){c+=o,e.metadata.winningRev=t,e.metadata.deleted=n;var l=e.data;if(l._id=e.metadata.id,l._rev=e.metadata.rev,r&&(l._deleted=!0),l._attachments&&Object.keys(l._attachments).length)return function(s,l,e,t,n,r){var i=s.data,c=0,o=Object.keys(i._attachments);function u(){c===o.length&&E(s,l,e,t,n,r)}function p(){c++,u()}o.forEach(function(e){var n,r,i,t=s.data._attachments[e];if(t.stub)c++,u();else{var o=t.data;delete t.data,t.revpos=parseInt(l,10);var a=t.digest;n=a,r=o,i=p,m.count(n).onsuccess=function(e){if(e.target.result)return i();var t={digest:n,body:r};m.put(t).onsuccess=i}}})}(e,t,n,i,a,s);E(e,t,n,i,a,s)}function E(r,i,o,a,e,t){var n=r.data,s=r.metadata;function l(e){var t=r.stemmedRevs||[];a&&p.auto_compaction&&(t=t.concat(_e(r.metadata))),t&&t.length&&Ot(t,r.metadata.id,d),s.seq=e.target.result,delete s.rev;var n=Et(s,i,o);f.put(n).onsuccess=c}function c(){y[e]={ok:!0,id:s.id,rev:i},b.set(r.metadata.id,r.metadata),function(e,t,n){var r,i,o,a=0,s=Object.keys(e.data._attachments||{});if(!s.length)return n();function l(){++a===s.length&&n()}for(var c=0;c<s.length;c++)r=s[c],o=void 0,i=e.data._attachments[r].digest,(o=g.put({seq:t,digestSeq:i+"::"+t})).onsuccess=l,o.onerror=function(e){e.preventDefault(),e.stopPropagation(),l()}}(r,s.seq,t)}n._doc_id_rev=s.id+"::"+s.rev,delete n._id,delete n._rev;var u=h.put(n);u.onsuccess=l,u.onerror=function(e){e.preventDefault(),e.stopPropagation(),h.index("_doc_id_rev").getKey(n._doc_id_rev).onsuccess=function(e){h.put(n,e.target.result).onsuccess=l}}}ct(l,w,function(e){if(e)return r(e);!function(){var e=Pt(t,[ft,ht,mt,yt,gt],"readwrite");if(e.error)return r(e.error);(d=e.txn).onabort=xt(r),d.ontimeout=xt(r),d.oncomplete=k,f=d.objectStore(ft),h=d.objectStore(ht),m=d.objectStore(mt),g=d.objectStore(gt),function(t){var i=[];if(l.forEach(function(n){n.data&&n.data._attachments&&Object.keys(n.data._attachments).forEach(function(e){var t=n.data._attachments[e];t.stub&&i.push(t.digest)})}),!i.length)return t();var o,a=0;i.forEach(function(e){var n,r;n=e,r=function(e){e&&!o&&(o=e),++a===i.length&&t(o)},m.get(n).onsuccess=function(e){if(e.target.result)r();else{var t=ee(Z,"unknown stub attachment with digest "+n);t.status=412,r(t)}}})}(function(e){if(e)return _=!0,r(e);!function(){if(l.length)for(var e=0,t=0,n=l.length;t<n;t++){var r=l[t];r._id&&Oe(r._id)?i():f.get(r.metadata.id).onsuccess=o}function i(){++e===l.length&&pt(a.revs_limit,l,p,b,d,y,x,s)}function o(e){var t=Ct(e.target.result);t&&b.set(t.id,t),i()}}()})}()})}(r,e,t,b,w,Rt,n)},b._get=function(e,i,t){var o,a,s,l=i.ctx;if(!l){var n=Pt(w,[ft,ht,mt],"readonly");if(n.error)return t(n.error);l=n.txn}function c(){t(s,{doc:o,metadata:a,ctx:l})}l.objectStore(ft).get(e).onsuccess=function(e){if(!(a=Ct(e.target.result)))return s=ee(R,"missing"),c();if(Ne(a)&&!i.rev)return s=ee(R,"deleted"),c();var t=l.objectStore(ht),n=i.rev||a.winningRev,r=a.id+"::"+n;t.index("_doc_id_rev").get(r).onsuccess=function(e){if((o=e.target.result)&&(o=St(o)),!o)return s=ee(R,"missing"),c();c()}}},b._getAttachment=function(e,t,n,r,i){var o;if(r.ctx)o=r.ctx;else{var a=Pt(w,[ft,ht,mt],"readonly");if(a.error)return i(a.error);o=a.txn}var s=n.digest,l=n.content_type;o.objectStore(mt).get(s).onsuccess=function(e){Tt(e.target.result.body,l,r.binary,function(e){i(null,e)})}},b._info=function(e){if(null===w||!Lt.has(_)){var t=new Error("db isn't open");return t.id="idbNull",e(t)}var n,r,i=Pt(w,[ht],"readonly");if(i.error)return e(i.error);var o=i.txn;o.objectStore(ht).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;n=t?t.key:0,r=b._meta.docCount},o.oncomplete=function(){e(null,{doc_count:r,update_seq:n,idb_attachment_format:b._meta.blobSupport?"binary":"base64"})}},b._allDocs=function(e,t){It(e,b,w,t)},b._changes=function(s){if((s=B(s)).continuous){var e=_+":"+he();return Rt.addListener(_,e,b,s),Rt.notify(_),{cancel:function(){Rt.removeListener(_,e)}}}var l=s.doc_ids&&new C.Set(s.doc_ids);s.since=s.since||0;var c,u=s.since,p="limit"in s?s.limit:-1;0===p&&(p=1),c="return_docs"in s?s.return_docs:!("returnDocs"in s)||s.returnDocs;var d,n,f,h,m=[],g=0,v=ne(s),y=new C.Map;function r(e){var t=e.target.result;t&&function(r){var i,t=St(r.value),n=r.key;if(l&&!l.has(t._id))return r.continue();function o(){return i.seq!==n?r.continue():(u=n,i.winningRev===t._rev?a(t):(e=t._id+"::"+i.winningRev,void(h.get(e).onsuccess=function(e){a(St(e.target.result))})));var e}function a(e){var t=s.processChange(e,i,s);t.seq=i.seq;var n=v(t);if("object"==typeof n)return s.complete(n);n&&(g++,c&&m.push(t),s.attachments&&s.include_docs?At(e,s,d,function(){Nt([t],s.binary).then(function(){s.onChange(t)})}):s.onChange(t)),g!==p&&r.continue()}if(i=y.get(t._id))return o();f.get(t._id).onsuccess=function(e){i=Ct(e.target.result),y.set(t._id,i),o()}}(t)}function i(){function e(){s.complete(null,{results:m,last_seq:u})}!s.continuous&&s.attachments?Nt(m).then(e):e()}!function(){var e=[ft,ht];s.attachments&&e.push(mt);var t=Pt(w,e,"readonly");if(t.error)return s.complete(t.error);(d=t.txn).onabort=xt(s.complete),d.oncomplete=i,n=d.objectStore(ht),f=d.objectStore(ft),h=n.index("_doc_id_rev"),(s.descending?n.openCursor(null,"prev"):n.openCursor(IDBKeyRange.lowerBound(s.since,!0))).onsuccess=r}()},b._close=function(e){if(null===w)return e(ee(z));w.close(),Lt.delete(_),w=null,e()},b._getRevisionTree=function(e,n){var t=Pt(w,[ft],"readonly");if(t.error)return n(t.error);t.txn.objectStore(ft).get(e).onsuccess=function(e){var t=Ct(e.target.result);t?n(null,t.rev_tree):n(ee(R))}},b._doCompaction=function(i,a,e){var t=Pt(w,[ft,ht,mt,gt],"readwrite");if(t.error)return e(t.error);var o=t.txn;o.objectStore(ft).get(i).onsuccess=function(e){var t=Ct(e.target.result);ge(t.rev_tree,function(e,t,n,r,i){var o=t+"-"+n;-1!==a.indexOf(o)&&(i.status="missing")}),Ot(a,i,o);var n=t.winningRev,r=t.deleted;o.objectStore(ft).put(Et(t,n,r))},o.onabort=xt(e),o.oncomplete=function(){e()}},b._getLocal=function(e,n){var t=Pt(w,[yt],"readonly");if(t.error)return n(t.error);var r=t.txn.objectStore(yt).get(e);r.onerror=xt(n),r.onsuccess=function(e){var t=e.target.result;t?(delete t._doc_id_rev,n(null,t)):n(ee(R))}},b._putLocal=function(n,r,i){"function"==typeof r&&(i=r,r={}),delete n._revisions;var o=n._rev,e=n._id;n._rev=o?"0-"+(parseInt(o.split("-")[1],10)+1):"0-1";var a,t=r.ctx;if(!t){var s=Pt(w,[yt],"readwrite");if(s.error)return i(s.error);(t=s.txn).onerror=xt(i),t.oncomplete=function(){a&&i(null,a)}}var l,c=t.objectStore(yt);o?(l=c.get(e)).onsuccess=function(e){var t=e.target.result;t&&t._rev===o?c.put(n).onsuccess=function(){a={ok:!0,id:n._id,rev:n._rev},r.ctx&&i(null,a)}:i(ee(F))}:((l=c.add(n)).onerror=function(e){i(ee(F)),e.preventDefault(),e.stopPropagation()},l.onsuccess=function(){a={ok:!0,id:n._id,rev:n._rev},r.ctx&&i(null,a)})},b._removeLocal=function(n,r,i){"function"==typeof r&&(i=r,r={});var o,e=r.ctx;if(!e){var t=Pt(w,[yt],"readwrite");if(t.error)return i(t.error);(e=t.txn).oncomplete=function(){o&&i(null,o)}}var a=n._id,s=e.objectStore(yt),l=s.get(a);l.onerror=xt(i),l.onsuccess=function(e){var t=e.target.result;t&&t._rev===n._rev?(s.delete(a),o={ok:!0,id:a,rev:"0-0"},r.ctx&&i(null,o)):i(ee(R))}},b._destroy=function(e,t){Rt.removeAllListeners(_);var n=jt.get(_);n&&n.result&&(n.result.close(),Lt.delete(_));var r=indexedDB.deleteDatabase(_);r.onsuccess=function(){jt.delete(_),N()&&_ in localStorage&&delete localStorage[_],t(null,{ok:!0})},r.onerror=xt(t)};var e,t=Lt.get(_);if(t)return w=t.idb,b._meta=t.global,p.nextTick(function(){l(null,b)});e=r.storage?function(e,t){try{return indexedDB.open(e,{version:dt,storage:t})}catch(t){return indexedDB.open(e,dt)}}(_,r.storage):indexedDB.open(_,dt),jt.set(_,e),e.onupgradeneeded=function(e){var t=e.target.result;if(e.oldVersion<1)return function(e){var t=e.createObjectStore(ft,{keyPath:"id"});e.createObjectStore(ht,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(mt,{keyPath:"digest"}),e.createObjectStore(vt,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(bt),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(yt,{keyPath:"_id"});var n=e.createObjectStore(gt,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var n,r=e.currentTarget.transaction;e.oldVersion<3&&t.createObjectStore(yt,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.oldVersion<4&&((n=t.createObjectStore(gt,{autoIncrement:!0})).createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0}));var i=[a,s,c,u],o=e.oldVersion;!function e(){var t=i[o-1];o++,t&&t(r,e)}()},e.onsuccess=function(e){(w=e.target.result).onversionchange=function(){w.close(),Lt.delete(_)},w.onabort=function(e){P("error","Database has a global failure",e.target.error),w.close(),Lt.delete(_)};var i=w.transaction([vt,bt,ft],"readwrite"),o=null,a=null,s=null;i.objectStore(vt).get(vt).onsuccess=function(e){var t,n=function(){null!==o&&null!==a&&null!==s&&(b._meta={name:_,instanceId:s,blobSupport:o,docCount:a},Lt.set(_,{idb:w,global:b._meta}),l(null,b))},r=e.target.result||{id:vt};_+"_id"in r?(s=r[_+"_id"],n()):(s=he(),r[_+"_id"]=s,i.objectStore(vt).put(r).onsuccess=function(){n()}),Dt||(t=i,Dt=new j(function(n){var e=Xe([""]);t.objectStore(bt).put(e,"key"),t.onabort=function(e){e.preventDefault(),e.stopPropagation(),n(!1)},t.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),t=navigator.userAgent.match(/Edge\//);n(t||!e||43<=parseInt(e[1],10))}}).catch(function(){return!1})),Dt.then(function(e){o=e,n()}),i.objectStore(ft).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){a=e.target.result,n()}}},e.onerror=function(){var e="Failed to open indexedDB, are you in private browsing mode?";P("error",e),l(ee(J,e))}}(n,t,e)},callback:e}),function n(r){if(!kt.running&&kt.queue.length){kt.running=!0;var i=kt.queue.shift();i.action(function(e,t){(function(e,t,n,r){try{e.apply(t,n)}catch(e){r.emit("error",e)}})(i.callback,this,[e,t],r),kt.running=!1,p.nextTick(function(){n(r)})})}}(n.constructor)}function Mt(e){return e<65?e-48:e-55}function Ft(e,t){return"UTF-8"===t?(n=function(e,t,n){for(var r="";t<n;)r+=String.fromCharCode(Mt(e.charCodeAt(t++))<<4|Mt(e.charCodeAt(t++)));return r}(e,0,e.length),decodeURIComponent(escape(n))):function(e,t,n){for(var r="";t<n;)r+=String.fromCharCode(Mt(e.charCodeAt(t+2))<<12|Mt(e.charCodeAt(t+3))<<8|Mt(e.charCodeAt(t))<<4|Mt(e.charCodeAt(t+1))),t+=4;return r}(e,0,e.length);var n}function Ut(e){return"'"+e+"'"}Bt.valid=function(){return!("undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform))&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var qt=7,Ht=Ut("document-store"),zt=Ut("by-sequence"),Vt=Ut("attach-store"),Wt=Ut("local-store"),Gt=Ut("metadata-store"),Kt=Ut("attach-seq-store");function Xt(e){return delete e._id,delete e._rev,JSON.stringify(e)}function Yt(e,t,n){return(e=JSON.parse(e))._id=t,e._rev=n,e}function Jt(e){for(var t="(";e--;)t+="?",e&&(t+=",");return t+")"}function $t(e,t,n,r,i){return"SELECT "+e+" FROM "+("string"==typeof t?t:t.join(" JOIN "))+(n?" ON "+n:"")+(r?" WHERE "+("string"==typeof r?r:r.join(" AND ")):"")+(i?" ORDER BY "+i:"")}function Qt(e,n,r){if(e.length){var t=0,o=[];e.forEach(function(e){var t="SELECT seq FROM "+zt+" WHERE doc_id=? AND rev=?";r.executeSql(t,[n,e],function(e,t){if(!t.rows.length)return i();var n=t.rows.item(0).seq;o.push(n),e.executeSql("DELETE FROM "+zt+" WHERE seq=?",[n],i)})})}function i(){++t===e.length&&function(){if(o.length){var e="SELECT DISTINCT digest AS digest FROM "+Kt+" WHERE seq IN "+Jt(o.length);r.executeSql(e,o,function(e,t){for(var i=[],n=0;n<t.rows.length;n++)i.push(t.rows.item(n).digest);if(i.length){var r="DELETE FROM "+Kt+" WHERE seq IN ("+o.map(function(){return"?"}).join(",")+")";e.executeSql(r,o,function(e){var t="SELECT digest FROM "+Kt+" WHERE digest IN ("+i.map(function(){return"?"}).join(",")+")";e.executeSql(t,i,function(t,e){for(var n=new C.Set,r=0;r<e.rows.length;r++)n.add(e.rows.item(r).digest);i.forEach(function(e){n.has(e)||(t.executeSql("DELETE FROM "+Kt+" WHERE digest=?",[e]),t.executeSql("DELETE FROM "+Vt+" WHERE digest=?",[e]))})})})}})}}()}}function Zt(r){return function(e){P("error","WebSQL threw an error",e);var t=e&&e.constructor.toString().match(/function ([^\(]+)/),n=(t&&t[1]||e.type,e.target||e.message);r(ee($,n))}}function en(e,t,n,g,r,i,o){var v,a=n.new_edits,l=t.docs.map(function(e){return e._id&&Oe(e._id)?e:We(e,a)}),s=l.filter(function(e){return e.error});if(s.length)return o(s[0]);var c,y=new Array(l.length),b=new C.Map;function u(){if(c)return o(c);i.notify(g._name),g._docCount=-1,o(null,y)}function p(p,s,e,n,l,t,c,u){function r(){var c=p.data,o=n?1:0,a=c._id,s=c._rev,l=Xt(c),e="INSERT INTO "+zt+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",t=[a,s,l,o];function u(e,t){var n,r,i,o=0,a=Object.keys(c._attachments||{});if(!a.length)return t();function s(){return++o===a.length&&t(),!1}for(var l=0;l<a.length;l++)n=a[l],r="INSERT INTO "+Kt+" (digest, seq) VALUES (?,?)",i=[c._attachments[n].digest,e],v.executeSql(r,i,s,s)}v.executeSql(e,t,function(e,t){var n=t.insertId;u(n,function(){m(e,n)})},function(){var e=$t("seq",zt,null,"doc_id=? AND rev=?");return v.executeSql(e,[a,s],function(e,t){var n=t.rows.item(0).seq,r="UPDATE "+zt+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",i=[l,o,a,s];e.executeSql(r,i,function(e){u(n,function(){m(e,n)})})}),!1})}function d(e){i||(e?u(i=e):f===o.length&&r())}var i=null,f=0;p.data._id=p.metadata.id,p.data._rev=p.metadata.rev;var o=Object.keys(p.data._attachments||{});function h(e){f++,d(e)}function m(e,t){var n=p.metadata.id,r=p.stemmedRevs||[];l&&g.auto_compaction&&(r=_e(p.metadata).concat(r)),r.length&&Qt(r,n,e),p.metadata.seq=t,delete p.metadata.rev;var i=l?"UPDATE "+Ht+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+zt+" WHERE doc_id="+Ht+".id AND rev=?) WHERE id=?":"INSERT INTO "+Ht+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",o=wt(p.metadata),a=l?[o,t,s,n]:[n,t,t,o];e.executeSql(i,a,function(){y[c]={ok:!0,id:p.metadata.id,rev:s},b.set(n,p.metadata),u()})}n&&(p.data._deleted=!0),o.forEach(function(e){var r,i,o,a,t=p.data._attachments[e];if(t.stub)f++,d();else{var n=t.data;delete t.data,t.revpos=parseInt(s,10),r=t.digest,i=n,o=h,a="SELECT digest FROM "+Vt+" WHERE digest=?",v.executeSql(a,[r],function(e,t){if(t.rows.length)return o();var n;a="INSERT INTO "+Vt+" (digest, body, escaped) VALUES (?,?,1)",e.executeSql(a,[r,(n=i,n.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,""))],function(){o()},function(){return o(),!1})})}}),o.length||r()}function d(){pt(e.revs_limit,l,g,b,v,y,p,n)}ct(l,"binary",function(e){if(e)return o(e);r.transaction(function(e){v=e,function(n){var o=[];if(l.forEach(function(n){n.data&&n.data._attachments&&Object.keys(n.data._attachments).forEach(function(e){var t=n.data._attachments[e];t.stub&&o.push(t.digest)})}),!o.length)return n();var a,s=0;o.forEach(function(e){var r,i,t;r=e,i=function(e){e&&!a&&(a=e),++s===o.length&&n(a)},t="SELECT count(*) as cnt FROM "+Vt+" WHERE digest=?",v.executeSql(t,[r],function(e,t){if(0===t.rows.item(0).cnt){var n=ee(Z,"unknown stub attachment with digest "+r);i(n)}else i()})})}(function(e){e?c=e:function(e){if(!l.length)return e();var t=0;function i(){++t===l.length&&e()}l.forEach(function(e){if(e._id&&Oe(e._id))return i();var r=e.metadata.id;v.executeSql("SELECT json FROM "+Ht+" WHERE id = ?",[r],function(e,t){if(t.rows.length){var n=_t(t.rows.item(0).json);b.set(r,n)}i()})})}(d)})},Zt(o),u)})}var tn=new C.Map;var nn=new O;function rn(o,a,s,l,e){var t=Object.keys(o._attachments||{});if(!t.length)return e&&e();var n=0;function c(){++n===t.length&&e&&e()}t.forEach(function(e){var n,r,i,t;a.attachments&&a.include_docs?(r=e,i=(n=o)._attachments[r],t={binary:a.binary,ctx:l},s._getAttachment(n._id,r,i,t,function(e,t){n._attachments[r]=k.extend(w(i,["digest","content_type"]),{data:t}),c()})):(o._attachments[e].stub=!0,c())})}var on=1,an="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+zt+" (seq, deleted)",sn="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+zt+" (doc_id, rev)",ln="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+Ht+" (winningseq)",cn="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+Kt+" (seq)",un="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+Kt+" (digest, seq)",pn=zt+".seq = "+Ht+".winningseq",dn=zt+".seq AS seq, "+zt+".deleted AS deleted, "+zt+".json AS data, "+zt+".rev AS rev, "+Ht+".json AS metadata";function fn(r,e){var u,t,v=this,p=null,n="size"in(t=r)?1e6*t.size:"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?5e6:1,i=[];v._docCount=-1,v._name=r.name;var o,a,s=(o=k.extend({},r,{version:on,description:r.name,size:n}),(a=tn.get(o.name))||(a=function(e){try{return{db:(t=e,t.websql(t.name,t.version,t.description,t.size))}}catch(e){return{error:e}}var t}(o),tn.set(o.name,a),a.db&&(a.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)),a);if(s.error)return Zt(e)(s.error);var y=s.db;function d(t,l){t.executeSql(ln),t.executeSql("ALTER TABLE "+zt+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){t.executeSql(an),t.executeSql("ALTER TABLE "+Ht+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){t.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+Ht+" (local, id)");var e="SELECT "+Ht+".winningseq AS seq, "+Ht+".json AS metadata FROM "+zt+" JOIN "+Ht+" ON "+zt+".seq = "+Ht+".winningseq";t.executeSql(e,[],function(e,t){for(var n=[],r=[],i=0;i<t.rows.length;i++){var o=t.rows.item(i),a=o.seq,s=JSON.parse(o.metadata);Ne(s)&&n.push(a),Oe(s.id)&&r.push(s.id)}e.executeSql("UPDATE "+Ht+"SET local = 1 WHERE id IN "+Jt(r.length),r,function(){e.executeSql("UPDATE "+zt+" SET deleted = 1 WHERE seq IN "+Jt(n.length),n,l)})})})})}function f(t,o){var e="CREATE TABLE IF NOT EXISTS "+Wt+" (id UNIQUE, rev, json)";t.executeSql(e,[],function(){var e="SELECT "+Ht+".id AS id, "+zt+".json AS data FROM "+zt+" JOIN "+Ht+" ON "+zt+".seq = "+Ht+".winningseq WHERE local = 1";t.executeSql(e,[],function(r,e){for(var i=[],t=0;t<e.rows.length;t++)i.push(e.rows.item(t));!function t(){if(!i.length)return o(r);var n=i.shift(),e=JSON.parse(n.data)._rev;r.executeSql("INSERT INTO "+Wt+" (id, rev, json) VALUES (?,?,?)",[n.id,e,n.data],function(e){e.executeSql("DELETE FROM "+Ht+" WHERE id=?",[n.id],function(e){e.executeSql("DELETE FROM "+zt+" WHERE seq=?",[n.seq],function(){t()})})})}()})})}function h(s,l){var e="ALTER TABLE "+zt+" ADD COLUMN doc_id";s.executeSql(e,[],function(e){var t="ALTER TABLE "+zt+" ADD COLUMN rev";e.executeSql(t,[],function(e){e.executeSql(sn,[],function(e){var t="SELECT hex(doc_id_rev) as hex FROM "+zt;e.executeSql(t,[],function(e,t){for(var n=[],r=0;r<t.rows.length;r++)n.push(t.rows.item(r));var a;a=n,function e(){if(!a.length)return l(s);var t=Ft(a.shift().hex,u),n=t.lastIndexOf("::"),r=t.substring(0,n),i=t.substring(n+2),o="UPDATE "+zt+" SET doc_id=?, rev=? WHERE doc_id_rev=?";s.executeSql(o,[r,i,t],function(){e()})}()})})})})}function m(e,h){function t(e){var t="SELECT COUNT(*) AS cnt FROM "+Vt;e.executeSql(t,[],function(t,e){if(!e.rows.item(0).cnt)return h(t);var n=0;!function f(){var e=$t(dn+", "+Ht+".id AS id",[Ht,zt],pn,null,Ht+".id ");e+=" LIMIT 10 OFFSET "+n,n+=10,t.executeSql(e,[],function(n,e){if(!e.rows.length)return h(n);for(var t,r,i,o={},a=0;a<e.rows.length;a++)for(var s=e.rows.item(a),l=Yt(s.data,s.id,s.rev),c=Object.keys(l._attachments||{}),u=0;u<c.length;u++){t=l._attachments[c[u]].digest,r=s.seq,i=void 0,-1===(i=o[t]=o[t]||[]).indexOf(r)&&i.push(r)}var p=[];if(Object.keys(o).forEach(function(t){o[t].forEach(function(e){p.push([t,e])})}),!p.length)return f();var d=0;p.forEach(function(e){var t="INSERT INTO "+Kt+" (digest, seq) VALUES (?,?)";n.executeSql(t,e,function(){++d===p.length&&f()})})})}()})}var n="CREATE TABLE IF NOT EXISTS "+Kt+" (digest, seq INTEGER)";e.executeSql(n,[],function(e){e.executeSql(un,[],function(e){e.executeSql(cn,[],t)})})}function g(e,t){var n="ALTER TABLE "+Vt+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";e.executeSql(n,[],t)}function b(e,n){var t="ALTER TABLE "+Ht+" ADD COLUMN max_seq INTEGER";e.executeSql(t,[],function(e){var t="UPDATE "+Ht+" SET max_seq=(SELECT MAX(seq) FROM "+zt+" WHERE doc_id=id)";e.executeSql(t,[],function(e){var t="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+Ht+" (max_seq)";e.executeSql(t,[],n)})})}function _(){for(;0<i.length;)i.pop()(null,p)}function l(n,t){if(0===t){var e="CREATE TABLE IF NOT EXISTS "+Gt+" (dbid, db_version INTEGER)",r="CREATE TABLE IF NOT EXISTS "+Vt+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",i="CREATE TABLE IF NOT EXISTS "+Kt+" (digest, seq INTEGER)",o="CREATE TABLE IF NOT EXISTS "+Ht+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",a="CREATE TABLE IF NOT EXISTS "+zt+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",s="CREATE TABLE IF NOT EXISTS "+Wt+" (id UNIQUE, rev, json)";n.executeSql(r),n.executeSql(s),n.executeSql(i,[],function(){n.executeSql(cn),n.executeSql(un)}),n.executeSql(o,[],function(){n.executeSql(ln),n.executeSql(a,[],function(){n.executeSql(an),n.executeSql(sn),n.executeSql(e,[],function(){var e="INSERT INTO "+Gt+" (db_version, dbid) VALUES (?,?)";p=he();var t=[qt,p];n.executeSql(e,t,function(){_()})})})})}else{var l=[d,f,h,m,g,b,function(){t<qt&&n.executeSql("UPDATE "+Gt+" SET db_version = "+qt);var e="SELECT dbid FROM "+Gt;n.executeSql(e,[],function(e,t){p=t.rows.item(0).dbid,_()})}],c=t,u=function(e){l[c-1](e,u),c++};u(n)}}function w(e,n){if(-1!==v._docCount)return n(v._docCount);var t=$t("COUNT("+Ht+".id) AS 'num'",[Ht,zt],pn,zt+".deleted=0");e.executeSql(t,[],function(e,t){v._docCount=t.rows.item(0).num,n(v._docCount)})}"function"!=typeof y.readTransaction&&(y.readTransaction=y.transaction),y.transaction(function(i){i.executeSql('SELECT HEX("a") AS hex',[],function(e,t){var n,r=t.rows.item(0).hex;u=2===r.length?"UTF-8":"UTF-16",n="SELECT sql FROM sqlite_master WHERE tbl_name = "+Gt,i.executeSql(n,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+Gt,[],function(e,t){var n=t.rows.item(0).db_version;l(e,n)}):e.executeSql("ALTER TABLE "+Gt+" ADD COLUMN db_version INTEGER",[],function(){l(e,1)}):l(e,0)})})},Zt(e),function(){N()&&(window.localStorage["_pouch__websqldb_"+v._name]=!0),e(null,v)}),v.type=function(){return"websql"},v._id=E(function(e){e(null,p)}),v._info=function(i){y.readTransaction(function(t){w(t,function(r){var e="SELECT MAX(seq) AS seq FROM "+zt;t.executeSql(e,[],function(e,t){var n=t.rows.item(0).seq||0;i(null,{doc_count:r,update_seq:n,sqlite_plugin:y._sqlitePlugin,websql_encoding:u})})})},Zt(i))},v._bulkDocs=function(e,t,n){en(r,e,t,v,y,nn,n)},v._get=function(t,r,n){var i,o,a,e,s,l=r.ctx;if(!l)return y.readTransaction(function(e){v._get(t,k.extend({ctx:e},r),n)});function c(){n(a,{doc:i,metadata:o,ctx:l})}r.rev?(e=$t(dn,[Ht,zt],Ht+".id="+zt+".doc_id",[zt+".doc_id=?",zt+".rev=?"]),s=[t,r.rev]):(e=$t(dn,[Ht,zt],pn,Ht+".id=?"),s=[t]),l.executeSql(e,s,function(e,t){if(!t.rows.length)return a=ee(R,"missing"),c();var n=t.rows.item(0);if(o=_t(n.metadata),n.deleted&&!r.rev)return a=ee(R,"deleted"),c();i=Yt(n.data,o.id,n.rev),c()})},v._allDocs=function(u,e){var r,p=[],t="startkey"in u&&u.startkey,n="endkey"in u&&u.endkey,i="key"in u&&u.key,o="descending"in u&&u.descending,a="limit"in u?u.limit:-1,s="skip"in u?u.skip:0,l=!1!==u.inclusive_end,c=[],d=[];if(!1!==i)d.push(Ht+".id = ?"),c.push(i);else if(!1!==t||!1!==n){if(!1!==t&&(d.push(Ht+".id "+(o?"<=":">=")+" ?"),c.push(t)),!1!==n){var f=o?">":"<";l&&(f+="="),d.push(Ht+".id "+f+" ?"),c.push(n)}!1!==i&&(d.push(Ht+".id = ?"),c.push(i))}"ok"!==u.deleted&&d.push(zt+".deleted = 0"),y.readTransaction(function(n){w(n,function(e){if(r=e,0!==a){var t=$t(dn,[Ht,zt],pn,d,Ht+".id "+(o?"DESC":"ASC"));t+=" LIMIT "+a+" OFFSET "+s,n.executeSql(t,c,function(e,t){for(var n=0,r=t.rows.length;n<r;n++){var i=t.rows.item(n),o=_t(i.metadata),a=o.id,s=Yt(i.data,a,i.rev),l=s._rev,c={id:a,key:a,value:{rev:l}};if(u.include_docs&&(c.doc=s,c.doc._rev=l,u.conflicts&&(c.doc._conflicts=be(o)),rn(c.doc,u,v,e)),i.deleted){if("ok"!==u.deleted)continue;c.value.deleted=!0,c.doc=null}p.push(c)}})}})},Zt(e),function(){e(null,{total_rows:r,offset:u.skip,rows:p})})},v._changes=function(d){if((d=B(d)).continuous){var e=v._name+":"+he();return nn.addListener(v._name,e,v,d),nn.notify(v._name),{cancel:function(){nn.removeListener(v._name,e)}}}var a=d.descending;d.since=d.since&&!a?d.since:0;var f,h="limit"in d?d.limit:-1;0===h&&(h=1),f="return_docs"in d?d.return_docs:!("returnDocs"in d)||d.returnDocs;var m=[],g=0;!function(){var e=Ht+".json AS metadata, "+Ht+".max_seq AS maxSeq, "+zt+".json AS winningDoc, "+zt+".rev AS winningRev ",t=Ht+" JOIN "+zt,n=Ht+".id="+zt+".doc_id AND "+Ht+".winningseq="+zt+".seq",r=["maxSeq > ?"],i=[d.since];d.doc_ids&&(r.push(Ht+".id IN "+Jt(d.doc_ids.length)),i=i.concat(d.doc_ids));var o=$t(e,t,n,r,"maxSeq "+(a?"DESC":"ASC")),u=ne(d);d.view||d.filter||(o+=" LIMIT "+h);var p=d.since||0;y.readTransaction(function(e){e.executeSql(o,i,function(e,t){function n(e){return function(){d.onChange(e)}}for(var r=0,i=t.rows.length;r<i;r++){var o=t.rows.item(r),a=_t(o.metadata);p=o.maxSeq;var s=Yt(o.winningDoc,a.id,o.winningRev),l=d.processChange(s,a,d);l.seq=o.maxSeq;var c=u(l);if("object"==typeof c)return d.complete(c);if(c&&(g++,f&&m.push(l),d.attachments&&d.include_docs?rn(s,d,v,e,n(l)):n(l)()),g===h)break}})},Zt(d.complete),function(){d.continuous||d.complete(null,{results:m,last_seq:p})})}()},v._close=function(e){e()},v._getAttachment=function(e,t,n,i,o){var a,r=i.ctx,s=n.digest,l=n.content_type,c="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+Vt+" WHERE digest=?";r.executeSql(c,[s],function(e,t){var n=t.rows.item(0),r=n.escaped?n.body.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""):Ft(n.body,u);a=i.binary?Ye(r,l):Ke(r),o(null,a)})},v._getRevisionTree=function(n,r){y.readTransaction(function(e){var t="SELECT json AS metadata FROM "+Ht+" WHERE id = ?";e.executeSql(t,[n],function(e,t){if(t.rows.length){var n=_t(t.rows.item(0).metadata);r(null,n.rev_tree)}else r(ee(R))})})},v._doCompaction=function(i,a,e){if(!a.length)return e();y.transaction(function(e){var t="SELECT json AS metadata FROM "+Ht+" WHERE id = ?";e.executeSql(t,[i],function(e,t){var n=_t(t.rows.item(0).metadata);ge(n.rev_tree,function(e,t,n,r,i){var o=t+"-"+n;-1!==a.indexOf(o)&&(i.status="missing")});var r="UPDATE "+Ht+" SET json = ? WHERE id = ?";e.executeSql(r,[wt(n),i])}),Qt(a,i,e)},Zt(e),function(){e()})},v._getLocal=function(i,o){y.readTransaction(function(e){var t="SELECT json, rev FROM "+Wt+" WHERE id=?";e.executeSql(t,[i],function(e,t){if(t.rows.length){var n=t.rows.item(0),r=Yt(n.json,i,n.rev);o(null,r)}else o(ee(R))})})},v._putLocal=function(e,r,i){"function"==typeof r&&(i=r,r={}),delete e._revisions;var o,a=e._rev,s=e._id;o=e._rev=a?"0-"+(parseInt(a.split("-")[1],10)+1):"0-1";var l,c=Xt(e);function t(e){var t,n;a?(t="UPDATE "+Wt+" SET rev=?, json=? WHERE id=? AND rev=?",n=[o,c,s,a]):(t="INSERT INTO "+Wt+" (id, rev, json) VALUES (?,?,?)",n=[s,o,c]),e.executeSql(t,n,function(e,t){t.rowsAffected?(l={ok:!0,id:s,rev:o},r.ctx&&i(null,l)):i(ee(F))},function(){return i(ee(F)),!1})}r.ctx?t(r.ctx):y.transaction(t,Zt(i),function(){l&&i(null,l)})},v._removeLocal=function(r,i,o){var a;function e(e){var t="DELETE FROM "+Wt+" WHERE id=? AND rev=?",n=[r._id,r._rev];e.executeSql(t,n,function(e,t){if(!t.rowsAffected)return o(ee(R));a={ok:!0,id:r._id,rev:"0-0"},i.ctx&&o(null,a)})}"function"==typeof i&&(o=i,i={}),i.ctx?e(i.ctx):y.transaction(e,Zt(o),function(){a&&o(null,a)})},v._destroy=function(e,t){nn.removeAllListeners(v._name),y.transaction(function(t){[Ht,zt,Vt,Gt,Wt,Kt].forEach(function(e){t.executeSql("DROP TABLE IF EXISTS "+e,[])})},Zt(t),function(){N()&&(delete window.localStorage["_pouch__websqldb_"+v._name],delete window.localStorage[v._name]),t(null,{ok:!0})})}}function hn(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var e=N(),t="_pouch__websqldb_valid_"+navigator.userAgent;if(e&&localStorage[t])return"1"===localStorage[t];var n=function(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(e){return!1}}();return e&&(localStorage[t]=n?"1":"0"),n}function mn(){return"undefined"!=typeof openDatabase&&("undefined"!=typeof sqlitePlugin||hn())}function gn(e,t){var o,n=(o=e,function(e,t,n,r){if("undefined"!=typeof sqlitePlugin){var i=k.extend({},o,{name:e,version:t,description:n,size:r});return sqlitePlugin.openDatabase(i)}return openDatabase(e,t,n,r)}),r=k.extend({websql:n},e);"undefined"==typeof cordova||mn()||P("error","PouchDB error: you must install a SQLite plugin in order for PouchDB to work on this platform. Options:\n - https://github.com/nolanlawson/cordova-plugin-sqlite-2\n - https://github.com/litehelpers/Cordova-sqlite-storage\n - https://github.com/Microsoft/cordova-plugin-websql"),fn.call(this,r,t)}function vn(t,n){var e,r,i,o=new Headers,a={method:t.method,credentials:"include",headers:o};return t.json&&(o.set("Accept","application/json"),o.set("Content-Type",t.headers["Content-Type"]||"application/json")),t.body&&t.body instanceof Blob?tt(t.body,function(e){a.body=e}):t.body&&t.processData&&"string"!=typeof t.body?a.body=JSON.stringify(t.body):a.body="body"in t?t.body:null,Object.keys(t.headers).forEach(function(e){t.headers.hasOwnProperty(e)&&o.set(e,t.headers[e])}),e=function(){for(var n={},e=new j(function(e,t){n.resolve=e,n.reject=t}),t=new Array(arguments.length),r=0;r<t.length;r++)t[r]=arguments[r];return n.promise=e,j.resolve().then(function(){return fetch.apply(null,t)}).then(function(e){n.resolve(e)}).catch(function(e){n.reject(e)}),n}(t.url,a),0<t.timeout&&(r=setTimeout(function(){e.reject(new Error("Load timeout for resource: "+t.url))},t.timeout)),e.promise.then(function(e){return i={statusCode:e.status},0<t.timeout&&clearTimeout(r),200<=i.statusCode&&i.statusCode<300?t.binary?e.blob():e.text():e.json()}).then(function(e){200<=i.statusCode&&i.statusCode<300?n(null,i,e):n(e,i)}).catch(function(e){n(e,i)}),{abort:e.reject}}gn.valid=function(){return"undefined"!=typeof cordova||mn()},gn.use_prefix=!0;var yn=function(){try{return new XMLHttpRequest,!0}catch(e){return!1}}();function bn(e,t){return yn||e.xhr?function(r,i){var o,e,a=!1,t=function(){a=!0,o.abort()};o=r.xhr?new r.xhr:new XMLHttpRequest;try{o.open(r.method,r.url)}catch(r){return i(new Error(r.name||"Url is invalid"))}for(var n in o.withCredentials=!("withCredentials"in r)||r.withCredentials,"GET"===r.method?delete r.headers["Content-Type"]:r.json&&(r.headers.Accept="application/json",r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.body&&r.processData&&"string"!=typeof r.body&&(r.body=JSON.stringify(r.body))),r.binary&&(o.responseType="arraybuffer"),"body"in r||(r.body=null),r.headers)r.headers.hasOwnProperty(n)&&o.setRequestHeader(n,r.headers[n]);return 0<r.timeout&&(e=setTimeout(t,r.timeout),o.onprogress=function(){clearTimeout(e),4!==o.readyState&&(e=setTimeout(t,r.timeout))},void 0!==o.upload&&(o.upload.onprogress=o.onprogress)),o.onreadystatechange=function(){if(4===o.readyState){var e={statusCode:o.status};if(200<=o.status&&o.status<300){var t;t=r.binary?Xe([o.response||""],{type:o.getResponseHeader("Content-Type")}):o.responseText,i(null,e,t)}else{var n={};if(a)(n=new Error("ETIMEDOUT")).code="ETIMEDOUT";else try{n=JSON.parse(o.response)}catch(e){}n.status=o.status,i(n)}}},r.body&&r.body instanceof Blob?tt(r.body,function(e){o.send(e)}):o.send(r.body),{abort:function(){o.abort()}}}(e,t):vn(e,t)}var _n=function(){};function wn(e,t){var a,s,n=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",r=-1!==n.indexOf("safari")&&-1===n.indexOf("chrome"),i=-1!==n.indexOf("msie"),o=-1!==n.indexOf("edge"),l=r||(i||o)&&"GET"===e.method,c=!("cache"in e)||e.cache;if(!/^blob:/.test(e.url)&&(l||!c)){var u=-1!==e.url.indexOf("?");e.url+=(u?"&":"?")+"_nonce="+Date.now()}return s=t,a=B(a=e),(a=k.extend({method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},a)).json&&(a.binary||(a.headers.Accept="application/json"),a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"),a.binary&&(a.encoding=null,a.json=!1),a.processData||(a.json=!1),bn(a,function(e,t,n){if(e)return s(te(e));var r,i=t.headers&&t.headers["content-type"],o=n||"";if(!a.binary&&(a.json||!a.processData)&&"object"!=typeof o&&(/json/.test(i)||/^[\s]*\{/.test(o)&&/\}[\s]*$/.test(o)))try{o=JSON.parse(o.toString())}catch(e){}200<=t.statusCode&&t.statusCode<300?function(e,t,n){if(!a.binary&&a.json&&"string"==typeof e)try{e=JSON.parse(e)}catch(e){return n(e)}Array.isArray(e)&&(e=e.map(function(e){return e.error||e.missing?te(e):e})),a.binary&&_n(e,t),n(null,e,t)}(o,t,s):((r=te(o)).status=t.statusCode,s(r))})}var kn=25,xn=50,En={},Cn=1800,Sn=c("pouchdb:http");function Tn(e){var n=e.doc&&e.doc._attachments;n&&Object.keys(n).forEach(function(e){var t=n[e];t.data=Je(t.data,t.content_type)})}function An(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function Nn(n){return n._attachments&&Object.keys(n._attachments)?j.all(Object.keys(n._attachments).map(function(e){var t=n._attachments[e];if(t.data&&"string"!=typeof t.data)return new j(function(e){et(t.data,e)}).then(function(e){t.data=e})})):j.resolve()}function On(e){var t=function(e){for(var t=ue.exec(e),r={},n=14;n--;){var i=se[n],o=t[n]||"",a=-1!==["user","password"].indexOf(i);r[i]=a?decodeURIComponent(o):o}return r[le]={},r[se[12]].replace(ce,function(e,t,n){t&&(r[le][t]=n)}),r}(e);(t.user||t.password)&&(t.auth={username:t.user,password:t.password});var n=t.path.replace(/(^\/|\/$)/g,"").split("/");return t.db=n.pop(),-1===t.db.indexOf("%")&&(t.db=encodeURIComponent(t.db)),t.path=n.join("/"),t}function Pn(e,t){return In(e,e.db+"/"+t)}function In(e,t){var n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function Dn(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function Ln(e,t){var o=this,n=On;e.getHost&&(n=e.getHost);var r,g=n(e.name,e),i=Pn(g,""),v=(e=B(e)).ajax||{};if(o.getUrl=function(){return i},o.getHeaders=function(){return v.headers||{}},e.auth||g.auth){var a=e.auth||g.auth,s=a.username+":"+a.password,l=Ke(unescape(encodeURIComponent(s)));v.headers=v.headers||{},v.headers.Authorization="Basic "+l}function y(e,t,n){var r=e.ajax||{},i=k.extend(B(v),r,t);return Sn(i.method+" "+i.url),o._ajax(i,n)}function c(e,t){return new j(function(n,r){y(e,t,function(e,t){if(e)return r(e);n(t)})})}function u(e,n){return _(e,d(function(t){b().then(function(){return n.apply(this,t)}).catch(function(e){t.pop()(e)})}))}function b(){return e.skipSetup||e.skip_setup?j.resolve():r||((r=c({},{method:"GET",url:i}).catch(function(e){return e&&e.status&&404===e.status?(I(404,"PouchDB is just detecting if the remote exists."),c({},{method:"PUT",url:i})):j.reject(e)}).catch(function(e){return!(!e||!e.status||412!==e.status)||j.reject(e)})).catch(function(){r=null}),r)}function p(e){return e.split("/").map(encodeURIComponent).join("/")}o._ajax=wn,setTimeout(function(){t(null,o)}),o.type=function(){return"http"},o.id=u("id",function(r){y({},{method:"GET",url:In(g,"")},function(e,t){var n=t&&t.uuid?t.uuid+g.db:Pn(g,"");r(null,n)})}),o.request=u("request",function(e,t){e.url=Pn(g,e.url),y({},e,t)}),o.compact=u("compact",function(r,i){"function"==typeof r&&(i=r,r={}),y(r=B(r),{url:Pn(g,"_compact"),method:"POST"},function(){!function n(){o.info(function(e,t){t&&!t.compact_running?i(null,{ok:!0}):setTimeout(n,r.interval||200)})}()})}),o.bulkGet=_("bulkGet",function(s,l){var c=this;function e(e){var t={};s.revs&&(t.revs=!0),s.attachments&&(t.attachments=!0),y({},{url:Pn(g,"_bulk_get"+Dn(t)),method:"POST",body:{docs:s.docs}},e)}function r(){var e=xn,r=Math.ceil(s.docs.length/e),i=0,o=new Array(r);function t(n){return function(e,t){o[n]=t.results,++i===r&&l(null,{results:re(o)})}}for(var n=0;n<r;n++){var a=w(s,["revs","attachments"]);a.ajax=v,a.docs=s.docs.slice(n*e,Math.min(s.docs.length,(n+1)*e)),T(c,a,t(n))}}var i=In(g,""),t=En[i];"boolean"!=typeof t?e(function(e,t){if(e){var n=Math.floor(e.status/100);4===n||5===n?(En[i]=!1,I(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),r()):l(e)}else En[i]=!0,l(null,t)}):t?e(l):r()}),o._info=function(n){b().then(function(){y({},{method:"GET",url:Pn(g,"")},function(e,t){if(e)return n(e);t.host=Pn(g,""),n(null,t)})}).catch(n)},o.get=u("get",function(e,a,n){"function"==typeof a&&(n=a,a={});var t={};(a=B(a)).revs&&(t.revs=!0),a.revs_info&&(t.revs_info=!0),a.open_revs&&("all"!==a.open_revs&&(a.open_revs=JSON.stringify(a.open_revs)),t.open_revs=a.open_revs),a.rev&&(t.rev=a.rev),a.conflicts&&(t.conflicts=a.conflicts),e=An(e);var r={method:"GET",url:Pn(g,e+Dn(t))};function i(r){var i=r._attachments,o=i&&Object.keys(i);if(i&&o.length)return new h(function(){if(!o.length)return null;var e=o.pop(),t=i[e],n=An(r._id)+"/"+p(e)+"?rev="+r._rev;return c(a,{method:"GET",url:Pn(g,n),binary:!0}).then(function(t){return a.binary?t:new j(function(e){et(t,e)})}).then(function(e){delete t.stub,delete t.length,t.data=e})},5,{promise:j}).start()}c(a,r).then(function(t){return j.resolve().then(function(){if(a.attachments)return e=t,Array.isArray(e)?j.all(e.map(function(e){if(e.ok)return i(e.ok)})):i(e);var e}).then(function(){n(null,t)})}).catch(n)}),o.remove=u("remove",function(e,t,n,r){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(i=e,"function"==typeof t?(r=t,n={}):(r=n,n=t));var o=i._rev||n.rev;y(n,{method:"DELETE",url:Pn(g,An(i._id))+"?rev="+o},r)}),o.getAttachment=u("getAttachment",function(e,t,n,r){"function"==typeof n&&(r=n,n={});var i=n.rev?"?rev="+n.rev:"";y(n,{method:"GET",url:Pn(g,An(e))+"/"+p(t)+i,binary:!0},r)}),o.removeAttachment=u("removeAttachment",function(e,t,n,r){y({},{method:"DELETE",url:Pn(g,An(e)+"/"+p(t))+"?rev="+n},r)}),o.putAttachment=u("putAttachment",function(e,t,n,r,i,o){"function"==typeof i&&(o=i,i=r,r=n,n=null);var a=An(e)+"/"+p(t),s=Pn(g,a);if(n&&(s+="?rev="+n),"string"==typeof r){var l;try{l=Ge(r)}catch(e){return o(ee(W,"Attachment is not a valid base64 string"))}r=l?Ye(l,i):""}y({},{headers:{"Content-Type":i},method:"PUT",url:s,processData:!1,body:r,timeout:v.timeout||6e4},o)}),o._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,b().then(function(){return j.all(e.docs.map(Nn))}).then(function(){y(t,{method:"POST",url:Pn(g,"_bulk_docs"),body:e},function(e,t){if(e)return n(e);t.forEach(function(e){e.ok=!0}),n(null,t)})}).catch(n)},o.allDocs=u("allDocs",function(t,n){"function"==typeof t&&(n=t,t={});var e,r={},i="GET";(t=B(t)).conflicts&&(r.conflicts=!0),t.descending&&(r.descending=!0),t.include_docs&&(r.include_docs=!0),t.attachments&&(r.attachments=!0),t.key&&(r.key=JSON.stringify(t.key)),t.start_key&&(t.startkey=t.start_key),t.startkey&&(r.startkey=JSON.stringify(t.startkey)),t.end_key&&(t.endkey=t.end_key),t.endkey&&(r.endkey=JSON.stringify(t.endkey)),void 0!==t.inclusive_end&&(r.inclusive_end=!!t.inclusive_end),void 0!==t.limit&&(r.limit=t.limit),void 0!==t.skip&&(r.skip=t.skip);var o=Dn(r);if(void 0!==t.keys){var a="keys="+encodeURIComponent(JSON.stringify(t.keys));a.length+o.length+1<=Cn?o+="&"+a:(i="POST",e={keys:t.keys})}c(t,{method:i,url:Pn(g,"_all_docs"+o),body:e}).then(function(e){t.include_docs&&t.attachments&&t.binary&&e.rows.forEach(Tn),n(null,e)}).catch(n)}),o._changes=function(i){var o="batch_size"in i?i.batch_size:kn;(i=B(i)).timeout="timeout"in i?i.timeout:"timeout"in v?v.timeout:3e4;var a,r=i.timeout?{timeout:i.timeout-5e3}:{},s=void 0!==i.limit&&i.limit;a="return_docs"in i?i.return_docs:!("returnDocs"in i)||i.returnDocs;var l=s;if(i.style&&(r.style=i.style),(i.include_docs||i.filter&&"function"==typeof i.filter)&&(r.include_docs=!0),i.attachments&&(r.attachments=!0),i.continuous&&(r.feed="longpoll"),i.conflicts&&(r.conflicts=!0),i.descending&&(r.descending=!0),"heartbeat"in i?i.heartbeat&&(r.heartbeat=i.heartbeat):r.heartbeat=1e4,i.filter&&"string"==typeof i.filter&&(r.filter=i.filter),i.view&&"string"==typeof i.view&&(r.filter="_view",r.view=i.view),i.query_params&&"object"==typeof i.query_params)for(var e in i.query_params)i.query_params.hasOwnProperty(e)&&(r[e]=i.query_params[e]);var c,u,p,d="GET";if(i.doc_ids){r.filter="_doc_ids";var t=JSON.stringify(i.doc_ids);t.length<Cn?r.doc_ids=t:(d="POST",c={doc_ids:i.doc_ids})}var f=function(e,t){if(!i.aborted){r.since=e,"object"==typeof r.since&&(r.since=JSON.stringify(r.since)),i.descending?s&&(r.limit=l):r.limit=!s||o<l?o:l;var n={method:d,url:Pn(g,"_changes"+Dn(r)),timeout:i.timeout,body:c};p=e,i.aborted||b().then(function(){u=y(i,n,t)}).catch(t)}},h={results:[]},m=function(e,t){if(!i.aborted){var n=0;if(t&&t.results)n=t.results.length,h.last_seq=t.last_seq,i.query_params,t.results=t.results.filter(function(e){l--;var t=ne(i)(e);return t&&(i.include_docs&&i.attachments&&i.binary&&Tn(e),a&&h.results.push(e),i.onChange(e)),t});else if(e)return i.aborted=!0,void i.complete(e);t&&t.last_seq&&(p=t.last_seq);var r=s&&l<=0||t&&n<o||i.descending;(!i.continuous||s&&l<=0)&&r?i.complete(null,h):setTimeout(function(){f(p,m)},0)}};return f(i.since||0,m),{cancel:function(){i.aborted=!0,u&&u.abort()}}},o.revsDiff=u("revsDiff",function(e,t,n){"function"==typeof t&&(n=t,t={}),y(t,{method:"POST",url:Pn(g,"_revs_diff"),body:e},n)}),o._close=function(e){e()},o._destroy=function(e,n){y(e,{url:Pn(g,""),method:"DELETE"},function(e,t){if(e&&e.status&&404!==e.status)return n(e);n(null,t)})}}function Rn(){this.promise=new j(function(e){e()})}function jn(e){var i,o=e.db,a=e.viewName,s=e.map,l=e.reduce,n=e.temporary,c=s.toString()+(l&&l.toString())+"undefined";if(!n&&(i=o._cachedViews=o._cachedViews||{})[c])return i[c];var t=o.info().then(function(e){var t,r=e.db_name+"-mrview-"+(n?"temp":(t=c,f.hash(t)));return pe(o,"_local/mrviews",function(e){e.views=e.views||{};var t=a;-1===t.indexOf("/")&&(t=a+"/"+a);var n=e.views[t]=e.views[t]||{};if(!n[r])return n[r]=!0,e}).then(function(){return o.registerDependentDatabase(r).then(function(e){var t=e.db;t.auto_compaction=!0;var n={name:r,db:t,sourceDB:o,adapter:o.adapter,mapFun:s,reduceFun:l};return n.db.get("_local/lastSeq").catch(function(e){if(404!==e.status)throw e}).then(function(e){return n.seq=e?e.seq:0,i&&n.db.once("destroyed",function(){delete i[c]}),n})})})});return i&&(i[c]=t),t}function Bn(e,t,n,r,i,o){return l("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:n,log:r,isArray:i,toJSON:o})}Ln.valid=function(){return!0},Rn.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},Rn.prototype.finish=function(){return this.promise};var Mn=function(e,t){return t&&e.then(function(e){p.nextTick(function(){t(null,e)})},function(e){p.nextTick(function(){t(e)})}),e},Fn=function(e,t){return e.then(function(e){return t().then(function(){return e})},function(e){return t().then(function(){throw e})})},Un=function(n,r){return function(){var e=arguments,t=this;return n.add(function(){return r.apply(t,e)})}},qn=function(e){for(var t={},n=0,r=e.length;n<r;n++)t["$"+e[n]]=!0;var i=Object.keys(t),o=new Array(i.length);for(n=0,r=i.length;n<r;n++)o[n]=i[n].substring(1);return o},Hn={},zn=new Rn,Vn=50,Wn=P.bind(null,"log");function Gn(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function Kn(e,t,n){try{return{output:t.apply(null,n)}}catch(t){return function(e,t){try{e.emit("error",t)}catch(e){P("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),P("error",t)}}(e,t),{error:t}}}function Xn(e,t){var n=x.collate(e.key,t.key);return 0!==n?n:x.collate(e.value,t.value)}function Yn(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function Jn(t){return function(e){return t.include_docs&&t.attachments&&t.binary&&e.rows.forEach(function(e){var n=e.doc&&e.doc._attachments;n&&Object.keys(n).forEach(function(e){var t=n[e];n[e].data=Je(t.data,t.content_type)})}),e}}function $n(e){return new fr("builtin "+e+" function requires map values to be numbers or number arrays")}function Qn(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if("number"!=typeof i){if(!Array.isArray(i))throw $n("_sum");t="number"==typeof t?[t]:t;for(var o=0,a=i.length;o<a;o++){var s=i[o];if("number"!=typeof s)throw $n("_sum");void 0===t[o]?t.push(s):t[o]+=s}}else"number"==typeof t?t+=i:t[0]+=i}return t}var Zn={_sum:function(e,t){return Qn(t)},_count:function(e,t){return t.length},_stats:function(e,t){return{sum:Qn(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];t+=i*i}return t}(t)}}};function er(e,t,n,r){var i=t[e];void 0!==i&&(r&&(i=encodeURIComponent(JSON.stringify(i))),n.push(e+"="+i))}function tr(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function nr(n,e){var t=n.descending?"endkey":"startkey",r=n.descending?"startkey":"endkey";if(void 0!==n[t]&&void 0!==n[r]&&0<x.collate(n[t],n[r]))throw new pr("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(e.reduce&&!1!==n.reduce){if(n.include_docs)throw new pr("{include_docs:true} is invalid for reduce");if(n.keys&&1<n.keys.length&&!n.group&&!n.group_level)throw new pr("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(e){var t=function(e){if(e){if("number"!=typeof e)return new pr('Invalid value for integer: "'+e+'"');if(e<0)return new pr('Invalid value for positive integer: "'+e+'"')}}(n[e]);if(t)throw t})}function rr(t){return function(e){if(404===e.status)return t;throw e}}function ir(s,l,r){return s.db.get("_local/lastSeq").catch(rr({_id:"_local/lastSeq",seq:0})).then(function(n){var e=Object.keys(l);return j.all(e.map(function(e){return n=s,o={_id:i="_local/doc_"+(t=e),keys:[]},a=l[t],c=a.indexableKeysToKeyValues,(r=a.changes,1===r.length&&/^1-/.test(r[0].rev)?j.resolve(o):n.db.get(i).catch(rr(o))).then(function(t){return(e=t,e.keys.length?n.db.allDocs({keys:e.keys,include_docs:!0}):j.resolve({rows:[]})).then(function(e){return function(e,t){for(var r=[],i={},n=0,o=t.rows.length;n<o;n++){var a=t.rows[n].doc;if(a&&(r.push(a),i[a._id]=!0,a._deleted=!c[a._id],!a._deleted)){var s=c[a._id];"value"in s&&(a.value=s.value)}}var l=Object.keys(c);return l.forEach(function(e){if(!i[e]){var t={_id:e},n=c[e];"value"in n&&(t.value=n.value),r.push(t)}}),e.keys=qn(l.concat(e.keys)),r.push(e),r}(t,e)});var e});var t,n,r,i,o,a,c})).then(function(e){var t=re(e);return n.seq=r,t.push(n),s.db.bulkDocs({docs:t})})})}function or(e){var t="string"==typeof e?e:e.name,n=Hn[t];return n||(n=Hn[t]=new Rn),n}function ar(e){return Un(or(e),function(){return function(g){var v,y,b;function t(e,t){var n={id:y._id,key:x.normalizeKey(e)};null!=t&&(n.value=x.normalizeKey(t)),v.push(n)}if("function"==typeof g.mapFun&&2===g.mapFun.length){var n=g.mapFun;b=function(e){return n(e,t)}}else b=Bn(g.mapFun.toString(),t,Qn,Wn,Array.isArray,JSON.parse);var _=g.seq||0,w=new Rn;return new j(function(e,t){function m(){w.finish().then(function(){g.seq=_,e()})}!function h(){g.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:_,limit:Vn}).on("complete",function(e){var t,n,r=e.results;if(!r.length)return m();for(var i={},o=0,a=r.length;o<a;o++){var s=r[o];if("_"!==s.doc._id[0]){v=[],(y=s.doc)._deleted||Kn(g.sourceDB,b,[y]),v.sort(Xn);for(var l,c={},u=0,p=v.length;u<p;u++){var d=v[u],f=[d.key,d.id];0===x.collate(d.key,l)&&f.push(u),c[x.toIndexableString(f)]=d,l=d.key}i[s.doc._id]={indexableKeysToKeyValues:c,changes:s.changes}}_=s.seq}return w.add((t=i,n=_,function(){return ir(g,t,n)})),r.length<Vn?m():h()}).on("error",function(e){t(e)})}()})}(e)})()}function sr(e,t){return Un(or(e),function(){return function(r,i){var o,a=r.reduceFun&&!1!==i.reduce,s=i.skip||0;function t(e){return e.include_docs=!0,r.db.allDocs(e).then(function(e){return o=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(t<n||n<t))return e.doc.value}var r=x.parseIndexableString(e.doc._id);return{key:r[0],id:r[1],value:"value"in e.doc?e.doc.value:null}})})}function e(t){var n;if(n=a?function(e,t,n){0===n.group_level&&delete n.group_level;var r,i=n.group||n.group_level;r=Zn[e.reduceFun]?Zn[e.reduceFun]:Bn(e.reduceFun.toString(),null,Qn,Wn,Array.isArray,JSON.parse);var o,a,s,l=[],c=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;t.forEach(function(e){var t=l[l.length-1],n=i?e.key:null;if(i&&Array.isArray(n)&&(n=n.slice(0,c)),t&&0===x.collate(t.groupKey,n))return t.keys.push([e.key,e.id]),void t.values.push(e.value);l.push({keys:[[e.key,e.id]],values:[e.value],groupKey:n})}),t=[];for(var u=0,p=l.length;u<p;u++){var d=l[u],f=Kn(e.sourceDB,r,[d.keys,d.values,!1]);if(f.error&&f.error instanceof fr)throw f.error;t.push({value:f.error?null:f.output,key:d.groupKey})}return{rows:(o=t,a=n.limit,s=n.skip,s=s||0,"number"==typeof a?o.slice(s,a+s):0<s?o.slice(s):o)}}(r,t,i):{total_rows:o,offset:s,rows:t},i.include_docs){var e=qn(t.map(Yn));return r.sourceDB.allDocs({keys:e,include_docs:!0,conflicts:i.conflicts,attachments:i.attachments,binary:i.binary}).then(function(e){var r={};return e.rows.forEach(function(e){e.doc&&(r["$"+e.id]=e.doc)}),t.forEach(function(e){var t=Yn(e),n=r["$"+t];n&&(e.doc=n)}),n})}return n}if(void 0===i.keys||i.keys.length||(i.limit=0,delete i.keys),void 0!==i.keys){var n=i.keys.map(function(e){return t({startkey:x.toIndexableString([e]),endkey:x.toIndexableString([e,{}])})});return j.all(n).then(re).then(e)}var l={descending:i.descending};if(i.start_key&&(i.startkey=i.start_key),i.end_key&&(i.endkey=i.end_key),void 0!==i.startkey&&(l.startkey=i.descending?x.toIndexableString([i.startkey,{}]):x.toIndexableString([i.startkey])),void 0!==i.endkey){var c=!1!==i.inclusive_end;i.descending&&(c=!c),l.endkey=x.toIndexableString(c?[i.endkey,{}]:[i.endkey])}if(void 0!==i.key){var u=x.toIndexableString([i.key]),p=x.toIndexableString([i.key,{}]);l.descending?(l.endkey=u,l.startkey=p):(l.startkey=u,l.endkey=p)}return a||("number"==typeof i.limit&&(l.limit=i.limit),l.skip=s),t(l).then(e)}(e,t)})()}var lr,cr=(lr=function(){var n,e;return"http"===this.type()?this.request({method:"POST",url:"_view_cleanup"}):"function"==typeof this._viewCleanup?(e=this,new j(function(n,r){e._viewCleanup(function(e,t){if(e)return r(e);n(t)})})):(n=this).get("_local/mrviews").then(function(s){var l={};Object.keys(s.views).forEach(function(e){var t=Gn(e),n="_design/"+t[0],r=t[1];l[n]=l[n]||{},l[n][r]=!0});var e={keys:Object.keys(l),include_docs:!0};return n.allDocs(e).then(function(e){var a={};e.rows.forEach(function(i){var o=i.key.substring(8);Object.keys(l[i.key]).forEach(function(e){var t=o+"/"+e;s.views[t]||(t=e);var n=Object.keys(s.views[t]),r=i.doc&&i.doc.views&&i.doc.views[e];n.forEach(function(e){a[e]=a[e]||r})})});var t=Object.keys(a).filter(function(e){return!a[e]}).map(function(e){return Un(or(e),function(){return new n.constructor(e,n.__opts).destroy()})()});return j.all(t).then(function(){return{ok:!0}})})},rr({ok:!0}))},d(function(e){var t=e.pop(),n=lr.apply(this,e);return"function"==typeof t&&Mn(n,t),n}));function ur(n,e,r){if("http"===n.type())return function(e,t,n){var r,i=[],o="GET";if(er("reduce",n,i),er("include_docs",n,i),er("attachments",n,i),er("limit",n,i),er("descending",n,i),er("group",n,i),er("group_level",n,i),er("skip",n,i),er("stale",n,i),er("conflicts",n,i),er("startkey",n,i,!0),er("start_key",n,i,!0),er("endkey",n,i,!0),er("end_key",n,i,!0),er("inclusive_end",n,i),er("key",n,i,!0),i=""===(i=i.join("&"))?"":"?"+i,void 0!==n.keys){var a="keys="+encodeURIComponent(JSON.stringify(n.keys));a.length+i.length+1<=2e3?i+=("?"===i[0]?"&":"?")+a:(o="POST","string"==typeof t?r={keys:n.keys}:t.keys=n.keys)}if("string"==typeof t){var s=Gn(t);return e.request({method:o,url:"_design/"+s[0]+"/_view/"+s[1]+i,body:r}).then(Jn(n))}return r=r||{},Object.keys(t).forEach(function(e){Array.isArray(t[e])?r[e]=t[e]:r[e]=t[e].toString()}),e.request({method:"POST",url:"_temp_view"+i,body:r}).then(Jn(n))}(n,e,r);if("function"==typeof n._query)return t=n,i=e,o=r,new j(function(n,r){t._query(i,o,function(e,t){if(e)return r(e);n(t)})});var t,i,o;if("string"!=typeof e){nr(r,e);var a={db:n,viewName:"temp_view/temp_view",map:e.map,reduce:e.reduce,temporary:!0};return zn.add(function(){return jn(a).then(function(e){return Fn(ar(e).then(function(){return sr(e,r)}),function(){return e.db.destroy()})})}),zn.finish()}var s=e,l=Gn(s),c=l[0],u=l[1];return n.get("_design/"+c).then(function(e){var t=e.views&&e.views[u];if(!t||"string"!=typeof t.map)throw new dr("ddoc "+c+" has no view named "+u);return nr(r,t),jn({db:n,viewName:s,map:t.map,reduce:t.reduce}).then(function(e){return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&p.nextTick(function(){ar(e)}),sr(e,r)):ar(e).then(function(){return sr(e,r)})})})}function pr(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,pr)}catch(e){}}function dr(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,dr)}catch(e){}}function fr(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,fr)}catch(e){}}n(pr,Error),n(dr,Error),n(fr,Error);var hr={query:function(e,t,n){var r;"function"==typeof t&&(n=t,t={}),t=t?((r=t).group_level=tr(r.group_level),r.limit=tr(r.limit),r.skip=tr(r.skip),r):{},"function"==typeof e&&(e={map:e});var i=this,o=j.resolve().then(function(){return ur(i,e,t)});return Mn(o,n),o},viewCleanup:cr};function mr(e){return/^1-/.test(e)}function gr(t,n){var e=Object.keys(n._attachments);return j.all(e.map(function(e){return t.getAttachment(n._id,e,{rev:n._rev})}))}function vr(r,l,i,o){i=B(i);var a=[],c=!0;return j.resolve().then(function(){var e,t=Object.keys(i).filter(function(e){var t=i[e].missing;return 1===t.length&&mr(t[0])});if(0<t.length)return e=t,r.allDocs({keys:e,include_docs:!0}).then(function(e){if(o.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){var t;e.deleted||!e.doc||!mr(e.value.rev)||(t=e.doc)._attachments&&0<Object.keys(t._attachments).length||(a.push(e.doc),delete i[e.id])})})}).then(function(){var e,n,t=(e=i,n=[],Object.keys(e).forEach(function(t){e[t].missing.forEach(function(e){n.push({id:t,rev:e})})}),{docs:n,revs:!0});if(t.docs.length)return r.bulkGet(t).then(function(e){if(o.cancelled)throw new Error("cancelled");return j.all(e.results.map(function(e){return j.all(e.docs.map(function(e){var o,a,s,t,n,i=e.ok;return e.error&&(c=!1),i&&i._attachments?(o=l,a=r,s=i,t="http"===a.type()&&"http"!==o.type(),n=Object.keys(s._attachments),t?o.get(s._id).then(function(i){return j.all(n.map(function(e){return n=s,r=e,(t=i)._attachments&&t._attachments[r]&&t._attachments[r].digest===n._attachments[r].digest?o.getAttachment(i._id,e):a.getAttachment(s._id,e);var t,n,r}))}).catch(function(e){if(404!==e.status)throw e;return gr(a,s)}):gr(a,s)).then(function(e){var r=Object.keys(i._attachments);return e.forEach(function(e,t){var n=i._attachments[r[t]];delete n.stub,delete n.length,n.data=e}),i}):i}))})).then(function(e){a=a.concat(re(e).filter(Boolean))})})}).then(function(){return{ok:c,docs:a}})}var yr=1,br="pouchdb",_r=5,wr=0;function kr(t,n,r,i,o){return t.get(n).catch(function(e){if(404===e.status)return"http"===t.type()&&I(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:i,_id:n,history:[],replicator:br,version:yr};throw e}).then(function(e){if(!o.cancelled)return e.history=(e.history||[]).filter(function(e){return e.session_id!==i}),e.history.unshift({last_seq:r,session_id:i}),e.history=e.history.slice(0,_r),e.version=yr,e.replicator=br,e.session_id=i,e.last_seq=r,t.put(e).catch(function(e){if(409===e.status)return kr(t,n,r,i,o);throw e})})}function xr(e,t,n,r){this.src=e,this.target=t,this.id=n,this.returnValue=r}xr.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then(function(){return n.updateSource(e,t)})},xr.prototype.updateTarget=function(e,t){return kr(this.target,this.id,e,t,this.returnValue)},xr.prototype.updateSource=function(e,t){var n=this;return this.readOnlySource?j.resolve(!0):kr(this.src,this.id,e,t,this.returnValue).catch(function(e){if(Sr(e))return n.readOnlySource=!0;throw e})};var Er={undefined:function(e,t){return 0===x.collate(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return(n=t,r=e,n.session_id===r.session_id?{last_seq:n.last_seq,history:n.history}:function e(t,n){var r=t[0],i=t.slice(1),o=n[0],a=n.slice(1);return r&&0!==n.length?Cr(r.session_id,n)?{last_seq:r.last_seq,history:t}:Cr(o.session_id,i)?{last_seq:o.last_seq,history:a}:e(i,a):{last_seq:wr,history:[]}}(n.history,r.history)).last_seq;var n,r}};function Cr(e,t){var n=t[0],r=t.slice(1);return!(!e||0===t.length)&&(e===n.session_id||Cr(e,r))}function Sr(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}xr.prototype.getCheckpoint=function(){var t=this;return t.target.get(t.id).then(function(n){return t.readOnlySource?j.resolve(n.last_seq):t.src.get(t.id).then(function(e){return n.version!==e.version?wr:(t=n.version?n.version.toString():"undefined")in Er?Er[t](n,e):wr;var t},function(e){if(404===e.status&&n.last_seq)return t.src.put({_id:t.id,last_seq:wr}).then(function(){return wr},function(e){return Sr(e)?(t.readOnlySource=!0,n.last_seq):wr});throw e})}).catch(function(e){if(404!==e.status)throw e;return wr})};var Tr=0;function Ar(e,t,n){var r,i=n.doc_ids?n.doc_ids.sort(x.collate):"",o=n.filter?n.filter.toString():"",a="",s="";return n.filter&&n.query_params&&(a=JSON.stringify((r=n.query_params,Object.keys(r).sort(x.collate).reduce(function(e,t){return e[t]=r[t],e},{})))),n.filter&&"_view"===n.filter&&(s=n.view.toString()),j.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+o+s+a+i;return new j(function(e){at(t,e)})}).then(function(e){return"_local/"+e.replace(/\//g,".").replace(/\+/g,"_")})}function Nr(r,n,i,a,s){var l,o,c=[],u={seq:0,changes:[],docs:[]},p=!1,d=!1,f=!1,h=0,m=i.continuous||i.live||!1,t=i.batch_size||100,g=i.batches_limit||10,v=!1,y=i.doc_ids,b=[],_=[],w=he();s=s||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var k={};function e(){return o?j.resolve():Ar(r,n,i).then(function(e){o=new xr(r,n,e,a)})}function x(){if(_=[],0!==l.docs.length){var o=l.docs;return n.bulkDocs({docs:o,new_edits:!1}).then(function(e){if(a.cancelled)throw N(),new Error("cancelled");var t=[],n={};e.forEach(function(e){e.error&&(s.doc_write_failures++,t.push(e),n[e.id]=e)}),b=b.concat(t),s.docs_written+=l.docs.length-t.length;var r=t.filter(function(e){return"unauthorized"!==e.name&&"forbidden"!==e.name});if(o.forEach(function(e){var t=n[e._id];t?a.emit("denied",B(t)):_.push(e)}),0<r.length){var i=new Error("bulkDocs error");throw i.other_errors=t,A("target.bulkDocs failed to write docs",i),new Error("bulkWrite partial failure")}},function(e){throw s.doc_write_failures+=o.length,e})}}function E(){if(l.error)throw new Error("There was a problem getting docs.");s.last_seq=h=l.seq;var e=B(s);return _.length&&(e.docs=_,a.emit("change",e)),p=!0,o.writeCheckpoint(l.seq,w).then(function(){if(p=!1,a.cancelled)throw N(),new Error("cancelled");l=void 0,D()}).catch(R)}function C(){return vr(r,n,l.diffs,a).then(function(e){l.error=!e.ok,e.docs.forEach(function(e){delete l.diffs[e._id],s.docs_read++,l.docs.push(e)})})}function S(){var t;a.cancelled||l||(0!==c.length?(l=c.shift(),(t={},l.changes.forEach(function(e){"_user/"!==e.id&&(t[e.id]=e.changes.map(function(e){return e.rev}))}),n.revsDiff(t).then(function(e){if(a.cancelled)throw N(),new Error("cancelled");l.diffs=e})).then(C).then(x).then(E).then(S).catch(function(e){A("batch processing terminated with error",e)})):T(!0))}function T(e){0!==u.changes.length?(e||d||u.changes.length>=t)&&(c.push(u),u={seq:0,changes:[],docs:[]},"pending"!==a.state&&"stopped"!==a.state||(a.state="active",a.emit("active")),S()):0!==c.length||l||((m&&k.live||d)&&(a.state="pending",a.emit("paused")),d&&N())}function A(e,t){f||(t.message||(t.message=e),s.ok=!1,s.status="aborting",s.errors.push(t),b=b.concat(t),c=[],u={seq:0,changes:[],docs:[]},N())}function N(){if(!(f||a.cancelled&&(s.status="cancelled",p)))if(s.status=s.status||"complete",s.end_time=new Date,s.last_seq=h,f=!0,0<b.filter(function(e){return"unauthorized"!==e.name&&"forbidden"!==e.name}).length){var e=b.pop();0<b.length&&(e.other_errors=b),e.result=s,function(e,t,n,r){if(!1===e.retry)return t.emit("error",n),t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=M),t.emit("requestError",n),"active"===t.state||"pending"===t.state){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=Tr};t.once("paused",function(){t.removeListener("active",i)}),t.once("active",i)}e.current_back_off=e.current_back_off||Tr,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}(i,a,e,function(){Nr(r,n,i,a)})}else s.errors=b,a.emit("complete",s),a.removeAllListeners()}function O(e){if(a.cancelled)return N();ne(i)(e)&&(u.seq=e.seq,u.changes.push(e),T(0===c.length&&k.live))}function P(e){if(v=!1,a.cancelled)return N();if(0<e.results.length)k.since=e.last_seq,D(),T(!0);else{var t=function(){m?(k.live=!0,D()):d=!0,T(!0)};l||0!==e.results.length?t():(p=!0,o.writeCheckpoint(e.last_seq,w).then(function(){p=!1,s.last_seq=h=e.last_seq,t()}).catch(R))}}function I(e){if(v=!1,a.cancelled)return N();A("changes rejected",e)}function D(){if(!v&&!d&&c.length<g){v=!0,a._changes&&(a.removeListener("cancel",a._abortChanges),a._changes.cancel()),a.once("cancel",t);var e=r.changes(k).on("change",O);e.then(n,n),e.then(P).catch(I),i.retry&&(a._changes=e,a._abortChanges=t)}function t(){e.cancel()}function n(){a.removeListener("cancel",t)}}function L(){e().then(function(){if(!a.cancelled)return o.getCheckpoint().then(function(e){k={since:h=e,limit:t,batch_size:t,style:"all_docs",doc_ids:y,return_docs:!0},i.filter&&("string"!=typeof i.filter?k.include_docs=!0:k.filter=i.filter),"heartbeat"in i&&(k.heartbeat=i.heartbeat),"timeout"in i&&(k.timeout=i.timeout),i.query_params&&(k.query_params=i.query_params),i.view&&(k.view=i.view),D()});N()}).catch(function(e){A("getCheckpoint rejected with ",e)})}function R(e){throw p=!1,A("writeCheckpoint completed with error",e),e}a.ready(r,n),a.cancelled?N():(a._addedListeners||(a.once("cancel",N),"function"==typeof i.complete&&(a.once("error",i.complete),a.once("complete",function(e){i.complete(null,e)})),a._addedListeners=!0),void 0===i.since?L():e().then(function(){return p=!0,o.writeCheckpoint(i.since,w)}).then(function(){p=!1,a.cancelled?N():(h=i.since,L())}).catch(R))}function Or(){s.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var n=this,r=new j(function(e,t){n.once("complete",e),n.once("error",t)});n.then=function(e,t){return r.then(e,t)},n.catch=function(e){return r.catch(e)},n.catch(function(){})}function Pr(e,t){var n=t.PouchConstructor;return"string"==typeof e?new n(e,t):e}function Ir(e,t,n,r){if("function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw ee(X,"`doc_ids` filter parameter is not a list.");n.complete=r,(n=B(n)).continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var i=new Or(n);return Nr(Pr(e,n),Pr(t,n),n,i),i}function Dr(e,t,n,r){return"function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),(n=B(n)).PouchConstructor=n.PouchConstructor||this,new Lr(e=Pr(e,n),t=Pr(t,n),n,r)}function Lr(e,t,n,r){var i=this;this.canceled=!1;var o=n.push?k.extend({},n,n.push):n,a=n.pull?k.extend({},n,n.pull):n;function s(e){i.emit("change",{direction:"pull",change:e})}function l(e){i.emit("change",{direction:"push",change:e})}function c(e){i.emit("denied",{direction:"push",doc:e})}function u(e){i.emit("denied",{direction:"pull",doc:e})}function p(){i.pushPaused=!0,i.pullPaused&&i.emit("paused")}function d(){i.pullPaused=!0,i.pushPaused&&i.emit("paused")}function f(){i.pushPaused=!1,i.pullPaused&&i.emit("active",{direction:"push"})}function h(){i.pullPaused=!1,i.pushPaused&&i.emit("active",{direction:"pull"})}this.push=Ir(e,t,o),this.pull=Ir(t,e,a),this.pushPaused=!0,this.pullPaused=!0;var m={};function g(n){return function(e,t){("change"===e&&(t===s||t===l)||"denied"===e&&(t===u||t===c)||"paused"===e&&(t===d||t===p)||"active"===e&&(t===h||t===f))&&(e in m||(m[e]={}),m[e][n]=!0,2===Object.keys(m[e]).length&&i.removeAllListeners(e))}}n.live&&(this.push.on("complete",i.pull.cancel.bind(i.pull)),this.pull.on("complete",i.push.cancel.bind(i.push))),this.on("newListener",function(e){"change"===e?(i.pull.on("change",s),i.push.on("change",l)):"denied"===e?(i.pull.on("denied",u),i.push.on("denied",c)):"active"===e?(i.pull.on("active",h),i.push.on("active",f)):"paused"===e&&(i.pull.on("paused",d),i.push.on("paused",p))}),this.on("removeListener",function(e){"change"===e?(i.pull.removeListener("change",s),i.push.removeListener("change",l)):"denied"===e?(i.pull.removeListener("denied",u),i.push.removeListener("denied",c)):"active"===e?(i.pull.removeListener("active",h),i.push.removeListener("active",f)):"paused"===e&&(i.pull.removeListener("paused",d),i.push.removeListener("paused",p))}),this.pull.on("removeListener",g("pull")),this.push.on("removeListener",g("push"));var v=j.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return i.emit("complete",t),r&&r(null,t),i.removeAllListeners(),t},function(e){if(i.cancel(),r?r(e):i.emit("error",e),i.removeAllListeners(),r)throw e});this.then=function(e,t){return v.then(e,t)},this.catch=function(e){return v.catch(e)}}n(Or,s.EventEmitter),Or.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Or.prototype.ready=function(e,t){var n=this;function r(){n.cancel()}n._readyCalled||(n._readyCalled=!0,e.once("destroyed",r),t.once("destroyed",r),n.once("complete",function(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)}))},n(Lr,s.EventEmitter),Lr.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Fe.plugin(function(e){e.adapter("idb",Bt,!0)}).plugin(function(e){e.adapter("websql",gn,!0)}).plugin(function(e){e.adapter("http",Ln,!1),e.adapter("https",Ln,!1)}).plugin(hr).plugin(function(e){e.replicate=Ir,e.sync=Dr}),jr.exports=Fe}).call(this,Rr("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:234,argsarray:113,debug:221,"es6-promise-pool":159,events:160,inherits:223,"js-extend":178,lie:195,"pouchdb-collate":215,"pouchdb-collections":217,"scope-eval":310,"spark-md5":311,vuvuzela:339}],221:[function(e,t,o){function n(){var e;try{e=o.storage.debug}catch(e){}return e}(o=t.exports=e("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},o.formatArgs=function(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+o.humanize(this.diff),!t)return e;var n="color: "+this.color,r=0,i=0;return(e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1)))[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++r)}),e.splice(i,0,n),e},o.save=function(e){try{null==e?o.storage.removeItem("debug"):o.storage.debug=e}catch(e){}},o.load=n,o.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)},o.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),o.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],o.formatters.j=function(e){return JSON.stringify(e)},o.enable(n())},{"./debug":222}],222:[function(e,t,s){(s=t.exports=function(e){function t(){}function n(){var i=n,e=+new Date,t=e-(l||e);i.diff=t,i.prev=l,i.curr=e,l=e,null==i.useColors&&(i.useColors=s.useColors()),null==i.color&&i.useColors&&(i.color=s.colors[c++%s.colors.length]);var o=Array.prototype.slice.call(arguments);o[0]=s.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var a=0;o[0]=o[0].replace(/%([a-z%])/g,function(e,t){if("%%"===e)return e;a++;var n=s.formatters[t];if("function"==typeof n){var r=o[a];e=n.call(i,r),o.splice(a,1),a--}return e}),"function"==typeof s.formatArgs&&(o=s.formatArgs.apply(i,o)),(n.log||s.log||console.log.bind(console)).apply(i,o)}n.enabled=!(t.enabled=!1);var r=s.enabled(e)?n:t;return r.namespace=e,r}).coerce=function(e){return e instanceof Error?e.stack||e.message:e},s.disable=function(){s.enable("")},s.enable=function(e){s.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,r=0;r<n;r++)t[r]&&("-"===(e=t[r].replace(/\*/g,".*?"))[0]?s.skips.push(new RegExp("^"+e.substr(1)+"$")):s.names.push(new RegExp("^"+e+"$")))},s.enabled=function(e){var t,n;for(t=0,n=s.skips.length;t<n;t++)if(s.skips[t].test(e))return!1;for(t=0,n=s.names.length;t<n;t++)if(s.names[t].test(e))return!0;return!1},s.humanize=e("ms"),s.names=[],s.skips=[],s.formatters={};var l,c=0},{ms:224}],223:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],224:[function(e,t,n){var i=1e3,o=60*i,a=60*o,s=24*a,l=365.25*s;function c(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}t.exports=function(e,t){return t=t||{},"string"==typeof e?function(e){if(!(1e4<(e=""+e).length)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*l;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"hrs":case"hr":case"h":return n*a;case"minutes":case"minute":case"mins":case"min":case"m":return n*o;case"seconds":case"second":case"secs":case"sec":case"s":return n*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}(e):t.long?c(r=e,s,"day")||c(r,a,"hour")||c(r,o,"minute")||c(r,i,"second")||r+" ms":s<=(n=e)?Math.round(n/s)+"d":a<=n?Math.round(n/a)+"h":o<=n?Math.round(n/o)+"m":i<=n?Math.round(n/i)+"s":n+"ms";var n,r}},{}],225:[function(e,t,n){(function(s){"use strict";!s.version||0===s.version.indexOf("v0.")||0===s.version.indexOf("v1.")&&0!==s.version.indexOf("v1.8.")?t.exports=function(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,a=arguments.length;switch(a){case 0:case 1:return s.nextTick(e);case 2:return s.nextTick(function(){e.call(null,t)});case 3:return s.nextTick(function(){e.call(null,t,n)});case 4:return s.nextTick(function(){e.call(null,t,n,r)});default:for(i=new Array(a-1),o=0;o<i.length;)i[o++]=arguments[o];return s.nextTick(function(){e.apply(null,i)})}}:t.exports=s.nextTick}).call(this,e("_process"))},{_process:234}],226:[function(e,t,n){"use strict";var r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=p;var i=e("process-nextick-args"),o=e("core-util-is");o.inherits=e("inherits");var a=e("./_stream_readable"),s=e("./_stream_writable");o.inherits(p,a);for(var l=r(s.prototype),c=0;c<l.length;c++){var u=l[c];p.prototype[u]||(p.prototype[u]=s.prototype[u])}function p(e){if(!(this instanceof p))return new p(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||i(f,this)}function f(e){e.end()}},{"./_stream_readable":227,"./_stream_writable":229,"core-util-is":119,inherits:223,"process-nextick-args":225}],227:[function(C,S,e){(function(g){"use strict";S.exports=r;var v=C("process-nextick-args"),y=C("isarray"),h=C("buffer").Buffer;r.ReadableState=n;C("events");var i,b=function(e,t){return e.listeners(t).length};!function(){try{i=C("stream")}catch(e){}finally{i||(i=C("events").EventEmitter)}}(),h=C("buffer").Buffer;var e=C("core-util-is");e.inherits=C("inherits");var o,a,t=C("util"),_=void 0;function n(e,t){a=a||C("./_stream_duplex"),e=e||{},this.objectMode=!!e.objectMode,t instanceof a&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(o||(o=C("string_decoder/").StringDecoder),this.decoder=new o(e.encoding),this.encoding=e.encoding)}function r(e){if(a=a||C("./_stream_duplex"),!(this instanceof r))return new r(e);this._readableState=new n(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),i.call(this)}function s(e,t,n,r,i){var o,a,s,l,c,u,p=(o=t,a=n,s=null,h.isBuffer(a)||"string"==typeof a||null==a||o.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s);if(p)e.emit("error",p);else if(null===n)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,m(e)}}(e,t);else if(t.objectMode||n&&0<n.length)if(t.ended&&!i){var d=new Error("stream.push() after EOF");e.emit("error",d)}else if(t.endEmitted&&i)d=new Error("stream.unshift() after end event"),e.emit("error",d);else{var f;!t.decoder||i||r||(n=t.decoder.write(n),f=!t.objectMode&&0===n.length),i||(t.reading=!1),f||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&m(e))),l=e,(c=t).readingMore||(c.readingMore=!0,v(w,l,c))}else i||(t.reading=!1);return!(u=t).ended&&(u.needReadable||u.length<u.highWaterMark||0===u.length)}_=t&&t.debuglog?t.debuglog("stream"):function(){},e.inherits(r,i),r.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=new h(e,t),t=""),s(this,n,e,t,!1)},r.prototype.unshift=function(e){return s(this,this._readableState,e,"",!0)},r.prototype.isPaused=function(){return!1===this._readableState.flowing},r.prototype.setEncoding=function(e){return o||(o=C("string_decoder/").StringDecoder),this._readableState.decoder=new o(e),this._readableState.encoding=e,this};var l=8388608;function c(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=(l<=(n=e)?n=l:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e);var n}function m(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(_("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?v(u,e):u(e))}function u(e){_("emit readable"),e.emit("readable"),k(e)}function w(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(_("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function p(e){_("readable nexttick read 0"),e.read(0)}function d(e,t){t.reading||(_("resume read 0"),e.read(0)),t.resumeScheduled=!1,e.emit("resume"),k(e),t.flowing&&!t.reading&&e.read(0)}function k(e){var t=e._readableState;if(_("flow",t.flowing),t.flowing)do{var n=e.read()}while(null!==n&&t.flowing)}function f(e,t){var n,r=t.buffer,i=t.length,o=!!t.decoder,a=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(a)n=r.shift();else if(!e||i<=e)n=o?r.join(""):1===r.length?r[0]:h.concat(r,i),r.length=0;else if(e<r[0].length)n=(u=r[0]).slice(0,e),r[0]=u.slice(e);else if(e===r[0].length)n=r.shift();else{n=o?"":new h(e);for(var s=0,l=0,c=r.length;l<c&&s<e;l++){var u=r[0],p=Math.min(e-s,u.length);o?n+=u.slice(0,p):u.copy(n,s,0,p),p<u.length?r[0]=u.slice(p):r.shift(),s+=p}}return n}function x(e){var t=e._readableState;if(0<t.length)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,v(E,t,e))}function E(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}r.prototype.read=function(e){_("read",e);var t=this._readableState,n=e;if(("number"!=typeof e||0<e)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return _("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):m(this),null;if(0===(e=c(e,t))&&t.ended)return 0===t.length&&x(this),null;var r,i=t.needReadable;return _("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&_("length less than watermark",i=!0),(t.ended||t.reading)&&_("reading or ended",i=!1),i&&(_("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=c(n,t)),null===(r=0<e?f(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),n!==e&&t.ended&&0===t.length&&x(this),null!==r&&this.emit("data",r),r},r.prototype._read=function(e){this.emit("error",new Error("not implemented"))},r.prototype.pipe=function(t,e){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t)}r.pipesCount+=1,_("pipe count=%d opts=%j",r.pipesCount,e);var i=e&&!1===e.end||t===g.stdout||t===g.stderr?u:a;function o(e){_("onunpipe"),e===n&&u()}function a(){_("onend"),t.end()}r.endEmitted?v(i):n.once("end",i),t.on("unpipe",o);var s,l=(s=n,function(){var e=s._readableState;_("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&b(s,"data")&&(e.flowing=!0,k(s))});t.on("drain",l);var c=!1;function u(){_("cleanup"),t.removeListener("close",f),t.removeListener("finish",h),t.removeListener("drain",l),t.removeListener("error",d),t.removeListener("unpipe",o),n.removeListener("end",a),n.removeListener("end",u),n.removeListener("data",p),c=!0,!r.awaitDrain||t._writableState&&!t._writableState.needDrain||l()}function p(e){_("ondata"),!1===t.write(e)&&(1!==r.pipesCount||r.pipes[0]!==t||1!==n.listenerCount("data")||c||(_("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++),n.pause())}function d(e){_("onerror",e),m(),t.removeListener("error",d),0===b(t,"error")&&t.emit("error",e)}function f(){t.removeListener("finish",h),m()}function h(){_("onfinish"),t.removeListener("close",f),m()}function m(){_("unpipe"),n.unpipe(t)}return n.on("data",p),t._events&&t._events.error?y(t._events.error)?t._events.error.unshift(d):t._events.error=[d,t._events.error]:t.on("error",d),t.once("close",f),t.once("finish",h),t.emit("pipe",n),r.flowing||(_("pipe resume"),n.resume()),t},r.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var o=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},r.prototype.addListener=r.prototype.on=function(e,t){var n=i.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&!this._readableState.endEmitted){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&m(this):v(p,this))}return n},r.prototype.resume=function(){var e,t,n=this._readableState;return n.flowing||(_("resume"),n.flowing=!0,e=this,(t=n).resumeScheduled||(t.resumeScheduled=!0,v(d,e,t))),this},r.prototype.pause=function(){return _("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(_("pause"),this._readableState.flowing=!1,this.emit("pause")),this},r.prototype.wrap=function(t){var n=this._readableState,r=!1,i=this;for(var e in t.on("end",function(){if(_("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&i.push(e)}i.push(null)}),t.on("data",function(e){_("wrapped data"),n.decoder&&(e=n.decoder.write(e)),(!n.objectMode||null!=e)&&(n.objectMode||e&&e.length)&&(i.push(e)||(r=!0,t.pause()))}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));return function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}(["error","close","destroy","pause","resume"],function(e){t.on(e,i.emit.bind(i,e))}),i._read=function(e){_("wrapped _read",e),r&&(r=!1,t.resume())},i},r._fromList=f}).call(this,C("_process"))},{"./_stream_duplex":226,_process:234,buffer:117,"core-util-is":119,events:160,inherits:223,isarray:177,"process-nextick-args":225,stream:312,"string_decoder/":231,util:116}],228:[function(e,t,n){"use strict";t.exports=a;var r=e("./_stream_duplex"),i=e("core-util-is");function o(n){this.afterTransform=function(e,t){return function(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,(r.writecb=null)!==n&&void 0!==n&&e.push(n),i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(n,e,t)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function a(e){if(!(this instanceof a))return new a(e);r.call(this,e),this._transformState=new o(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e){s(t,e)}):s(t)})}function s(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=e._transformState;if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(a,r),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,n){throw new Error("not implemented")},a.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":226,"core-util-is":119,inherits:223}],229:[function(w,k,e){(function(e,t){"use strict";k.exports=s;var d=w("process-nextick-args"),f=!e.browser&&-1<["v0.10","v0.9."].indexOf(e.version.slice(0,5))?t:d,p=w("buffer").Buffer;s.WritableState=a;var n=w("core-util-is");n.inherits=w("inherits");var r,o,i={deprecate:w("util-deprecate")};function l(){}function h(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function a(e,t){o=o||w("./_stream_duplex"),e=e||{},this.objectMode=!!e.objectMode,t instanceof o&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1;var i=(this.finished=!1)===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(p=n,p.writing=!1,p.writecb=null,p.length-=p.writelen,p.writelen=0,t)a=e,s=n,l=r,c=t,u=i,--s.pendingcb,l?d(u,c):u(c),a._writableState.errorEmitted=!0,a.emit("error",c);else{var o=y(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||v(e,n),r?f(g,e,n,o,i):g(e,n,o,i)}var a,s,l,c,u;var p}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new _(this),this.corkedRequestsFree.next=new _(this)}function s(e){if(o=o||w("./_stream_duplex"),!(this instanceof s||this instanceof o))return new s(e);this._writableState=new a(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),r.call(this)}function c(e,t,n,r,i){var o,a,s;a=n,s=r,(o=t).objectMode||!1===o.decodeStrings||"string"!=typeof a||(a=new p(a,s)),n=a,p.isBuffer(n)&&(r="buffer");var l=t.objectMode?1:n.length;t.length+=l;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest=new h(n,r,i),u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else m(e,t,!1,l,n,r,i);return c}function m(e,t,n,r,i,o,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function g(e,t,n,r){var i,o;n||(i=e,0===(o=t).length&&o.needDrain&&(o.needDrain=!1,i.emit("drain"))),t.pendingcb--,r(),b(e,t)}function v(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0;n;)n=(i[a]=n).next,a+=1;m(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,t.corkedRequestsFree=o.next,o.next=null}else{for(;n;){var s=n.chunk,l=n.encoding,c=n.callback;if(m(e,t,!1,t.objectMode?1:s.length,s,l,c),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function u(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function b(e,t){var n=y(t);return n&&(0===t.pendingcb?(u(e,t),t.finished=!0,e.emit("finish")):u(e,t)),n}function _(r){var i=this;this.next=null,this.entry=null,this.finish=function(e){var t=i.entry;for(i.entry=null;t;){var n=t.callback;r.pendingcb--,n(e),t=t.next}r.corkedRequestsFree?r.corkedRequestsFree.next=i:r.corkedRequestsFree=i}}!function(){try{r=w("stream")}catch(e){}finally{r||(r=w("events").EventEmitter)}}(),p=w("buffer").Buffer,n.inherits(s,r),a.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(a.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}(),s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},s.prototype.write=function(e,t,n){var r,i,o,a=this._writableState,s=!1;return"function"==typeof t&&(n=t,t=null),p.isBuffer(e)?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof n&&(n=l),a.ended?(r=this,i=n,o=new Error("write after end"),r.emit("error",o),d(i,o)):function(e,t,n,r){var i=!0;if(!p.isBuffer(n)&&"string"!=typeof n&&null!=n&&!t.objectMode){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),d(r,o),i=!1}return i}(this,a,e,n)&&(a.pendingcb++,s=c(this,a,e,t,n)),s},s.prototype.cork=function(){this._writableState.corked++},s.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||v(this,e))},s.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);this._writableState.defaultEncoding=e},s.prototype._write=function(e,t,n){n(new Error("not implemented"))},s.prototype._writev=null,s.prototype.end=function(e,t,n){var r,i,o,a=this._writableState;"function"==typeof e?(n=e,t=e=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),a.corked&&(a.corked=1,this.uncork()),a.ending||a.finished||(r=this,o=n,(i=a).ending=!0,b(r,i),o&&(i.finished?d(o):r.once("finish",o)),i.ended=!0,r.writable=!1)}}).call(this,w("_process"),w("timers").setImmediate)},{"./_stream_duplex":226,_process:234,buffer:117,"core-util-is":119,events:160,inherits:223,"process-nextick-args":225,stream:312,timers:334,"util-deprecate":335}],230:[function(e,t,n){t.exports=e("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":228}],231:[function(e,t,n){var r=e("buffer").Buffer,i=r.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};var o=n.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!i(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=s;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=l;break;default:return void(this.write=a)}this.charBuffer=new r(6),this.charReceived=0,this.charLength=0};function a(e){return e.toString(this.encoding)}function s(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function l(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}o.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!(55296<=(r=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r,i=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),i=(t+=e.toString(this.encoding,0,i)).length-1,55296<=(r=t.charCodeAt(i))&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},o.prototype.detectIncompleteChar=function(e){for(var t=3<=e.length?3:e.length;0<t;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},o.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},{buffer:117}],232:[function(r,l,e){(function(n){var t=r("readable-stream/transform"),i=r("util").inherits,o=r("xtend");function a(e){t.call(this,e),this._destroyed=!1}function s(e,t,n){n(null,e)}function e(r){return function(e,t,n){return"function"==typeof e&&(n=t,t=e,e={}),"function"!=typeof t&&(t=s),"function"!=typeof n&&(n=null),r(e,t,n)}}i(a,t),a.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;n.nextTick(function(){e&&t.emit("error",e),t.emit("close")})}},l.exports=e(function(e,t,n){var r=new a(e);return r._transform=t,n&&(r._flush=n),r}),l.exports.ctor=e(function(t,e,n){function r(e){if(!(this instanceof r))return new r(e);this.options=o(t,e),a.call(this,this.options)}return i(r,a),r.prototype._transform=e,n&&(r.prototype._flush=n),r}),l.exports.obj=e(function(e,t,n){var r=new a(o({objectMode:!0,highWaterMark:16},e));return r._transform=t,n&&(r._flush=n),r})}).call(this,r("_process"))},{_process:234,"readable-stream/transform":230,util:338,xtend:341}],233:[function(e,t,n){(function(s){"use strict";void 0===s||!s.version||0===s.version.indexOf("v0.")||0===s.version.indexOf("v1.")&&0!==s.version.indexOf("v1.8.")?t.exports={nextTick:function(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,a=arguments.length;switch(a){case 0:case 1:return s.nextTick(e);case 2:return s.nextTick(function(){e.call(null,t)});case 3:return s.nextTick(function(){e.call(null,t,n)});case 4:return s.nextTick(function(){e.call(null,t,n,r)});default:for(i=new Array(a-1),o=0;o<i.length;)i[o++]=arguments[o];return s.nextTick(function(){e.apply(null,i)})}}}:t.exports=s}).call(this,e("_process"))},{_process:234}],234:[function(e,t,n){var r,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var c,u=[],p=!1,d=-1;function f(){p&&c&&(p=!1,c.length?u=c.concat(u):d=-1,u.length&&h())}function h(){if(!p){var e=l(f);p=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,p=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||p||l(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],235:[function(e,t,n){"use strict";var s=e("./lib/ReactPropTypesSecret");function r(){}function i(){}i.resetWarningCache=r,t.exports=function(){function e(e,t,n,r,i,o){if(o!==s){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}var n={array:e.isRequired=e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:r};return n.PropTypes=n}},{"./lib/ReactPropTypesSecret":237}],236:[function(e,t,n){t.exports=e("./factoryWithThrowingShims")()},{"./factoryWithThrowingShims":235}],237:[function(e,t,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}],238:[function(e,t,n){var r,i;r=this,i=function(){var u="function"==typeof Object.defineProperty?function(e,t,n){return Object.defineProperty(e,t,n),e}:function(e,t,n){return e[t]=n.value,e};return function(e,t,n,r){var i,o,a,s,l,c;if(o=n,l=!(s="object"==typeof(a=r))&&"string"==typeof a,r={enumerable:(c=function(e){return s?!!a[e]:!!l&&-1<a.indexOf(e[0])})("enumerable"),configurable:c("configurable"),writable:c("writable"),value:o},"object"==typeof t){for(i in t)Object.hasOwnProperty.call(t,i)&&(r.value=t[i],u(e,i,r));return e}return u(e,t,r)}},void 0!==t&&t.exports?t.exports=i():r.prr=i()},{}],239:[function(e,t,n){"use strict";var i=e("react"),m=e("object-assign"),o=e("scheduler");function L(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!i)throw Error(L(227));var c=null,u={};function a(){if(c)for(var e in u){var t=u[e],n=c.indexOf(e);if(!(-1<n))throw Error(L(96,e));if(!d[n]){if(!t.extractEvents)throw Error(L(97,e));for(var r in n=(d[n]=t).eventTypes){var i=void 0,o=n[r],a=t,s=r;if(f.hasOwnProperty(s))throw Error(L(99,s));var l=(f[s]=o).phasedRegistrationNames;if(l){for(i in l)l.hasOwnProperty(i)&&p(l[i],a,s);i=!0}else o.registrationName?(p(o.registrationName,a,s),i=!0):i=!1;if(!i)throw Error(L(98,r,e))}}}}function p(e,t,n){if(g[e])throw Error(L(100,e));g[e]=t,s[e]=t.eventTypes[n].dependencies}var d=[],f={},g={},s={};var h=!1,v=null,y=!1,b=null,_={onError:function(e){h=!0,v=e}};function w(e,t,n,r,i,o,a,s,l){h=!1,v=null,function(e,t,n,r,i,o,a,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}.apply(_,arguments)}var l=null,r=null,k=null;function x(e,t,n){var r=e.type||"unknown-event";e.currentTarget=k(n),function(e,t,n,r,i,o,a,s,l){if(w.apply(this,arguments),h){if(!h)throw Error(L(198));var c=v;h=!1,v=null,y||(y=!0,b=c)}}(r,t,void 0,e),e.currentTarget=null}function E(e,t){if(null==t)throw Error(L(30));return null==e?t:Array.isArray(e)?(Array.isArray(t)?e.push.apply(e,t):e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function C(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var S=null;function T(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)x(e,t[r],n[r]);else t&&x(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function A(e){if(null!==e&&(S=E(S,e)),e=S,S=null,e){if(C(e,T),S)throw Error(L(95));if(y)throw e=b,y=!1,b=null,e}}var N={injectEventPluginOrder:function(e){if(c)throw Error(L(101));c=Array.prototype.slice.call(e),a()},injectEventPluginsByName:function(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(!u.hasOwnProperty(t)||u[t]!==r){if(u[t])throw Error(L(102,t));u[t]=r,n=!0}}n&&a()}};function O(e,t){var n=e.stateNode;if(!n)return null;var r=l(n);if(!r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(L(231,t,typeof n));return n}var P=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;P.hasOwnProperty("ReactCurrentDispatcher")||(P.ReactCurrentDispatcher={current:null}),P.hasOwnProperty("ReactCurrentBatchConfig")||(P.ReactCurrentBatchConfig={suspense:null});var I=/^(.*)[\\\/]/,D="function"==typeof Symbol&&Symbol.for,R=D?Symbol.for("react.element"):60103,j=D?Symbol.for("react.portal"):60106,B=D?Symbol.for("react.fragment"):60107,M=D?Symbol.for("react.strict_mode"):60108,F=D?Symbol.for("react.profiler"):60114,U=D?Symbol.for("react.provider"):60109,q=D?Symbol.for("react.context"):60110,H=D?Symbol.for("react.concurrent_mode"):60111,z=D?Symbol.for("react.forward_ref"):60112,V=D?Symbol.for("react.suspense"):60113,W=D?Symbol.for("react.suspense_list"):60120,G=D?Symbol.for("react.memo"):60115,K=D?Symbol.for("react.lazy"):60116;D&&Symbol.for("react.fundamental"),D&&Symbol.for("react.responder"),D&&Symbol.for("react.scope");var X="function"==typeof Symbol&&Symbol.iterator;function Y(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=X&&e[X]||e["@@iterator"])?e:null}function J(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case B:return"Fragment";case j:return"Portal";case F:return"Profiler";case M:return"StrictMode";case V:return"Suspense";case W:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case q:return"Context.Consumer";case U:return"Context.Provider";case z:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case G:return J(e.type);case K:if(e=1===e._status?e._result:null)return J(e)}return null}function $(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=e._debugOwner,i=e._debugSource,o=J(e.type);n=null,r&&(n=J(r.type)),r=o,o="",i?o=" (at "+i.fileName.replace(I,"")+":"+i.lineNumber+")":n&&(o=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+o}t+=n,e=e.return}while(e);return t}var Q=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Z=null,ee=null,te=null;function ne(e){if(e=r(e)){if("function"!=typeof Z)throw Error(L(280));var t=l(e.stateNode);Z(e.stateNode,e.type,t)}}function re(e){ee?te?te.push(e):te=[e]:ee=e}function ie(){if(ee){var e=ee,t=te;if(te=ee=null,ne(e),t)for(e=0;e<t.length;e++)ne(t[e])}}function oe(e,t){return e(t)}function ae(e,t,n,r){return e(t,n,r)}function se(){}var le=oe,ce=!1,ue=!1;function pe(){null===ee&&null===te||(se(),ie())}new Map;var de=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fe=Object.prototype.hasOwnProperty,he={},me={};function ge(e,t,n,r,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o}var ve={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ve[e]=new ge(e,0,!1,e,null,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ve[t]=new ge(t,1,!1,e[1],null,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){ve[e]=new ge(e,2,!1,e.toLowerCase(),null,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ve[e]=new ge(e,2,!1,e,null,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ve[e]=new ge(e,3,!1,e.toLowerCase(),null,!1)}),["checked","multiple","muted","selected"].forEach(function(e){ve[e]=new ge(e,3,!0,e,null,!1)}),["capture","download"].forEach(function(e){ve[e]=new ge(e,4,!1,e,null,!1)}),["cols","rows","size","span"].forEach(function(e){ve[e]=new ge(e,6,!1,e,null,!1)}),["rowSpan","start"].forEach(function(e){ve[e]=new ge(e,5,!1,e.toLowerCase(),null,!1)});var ye=/[\-:]([a-z])/g;function be(e){return e[1].toUpperCase()}function _e(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function we(e,t,n,r){var i,o=ve.hasOwnProperty(t)?ve[t]:null;(null!==o?0===o.type:!r&&2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]))||(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||t<1}return!1}(t,n,o,r)&&(n=null),r||null===o?(i=t,(fe.call(me,i)||!fe.call(he,i)&&(de.test(i)?me[i]=!0:!(he[i]=!0)))&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n))):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,r=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}function ke(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function xe(e){e._valueTracker||(e._valueTracker=function(e){var t=ke(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Ee(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=ke(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Ce(e,t){var n=t.checked;return m({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Se(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=_e(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Te(e,t){null!=(t=t.checked)&&we(e,"checked",t,!1)}function Ae(e,t){Te(e,t);var n=_e(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?Oe(e,t.type,n):t.hasOwnProperty("defaultValue")&&Oe(e,t.type,_e(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Ne(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Oe(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function Pe(e,t){return e=m({children:void 0},t),n=t.children,r="",i.Children.forEach(n,function(e){null!=e&&(r+=e)}),(t=r)&&(e.children=t),e;var n,r}function Ie(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+_e(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function De(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(L(91));return m({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Le(e,t){var n=t.value;if(null==n){if(n=t.defaultValue,null!=(t=t.children)){if(null!=n)throw Error(L(92));if(Array.isArray(t)){if(!(t.length<=1))throw Error(L(93));t=t[0]}n=t}null==n&&(n="")}e._wrapperState={initialValue:_e(n)}}function Re(e,t){var n=_e(t.value),r=_e(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function je(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(ye,be);ve[t]=new ge(t,1,!1,e,null,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(ye,be);ve[t]=new ge(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(ye,be);ve[t]=new ge(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)}),["tabIndex","crossOrigin"].forEach(function(e){ve[e]=new ge(e,1,!1,e.toLowerCase(),null,!1)}),ve.xlinkHref=new ge("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach(function(e){ve[e]=new ge(e,1,!1,e.toLowerCase(),null,!0)});var Be={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function Me(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Fe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Me(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var Ue,qe,He=(qe=function(e,t){if(e.namespaceURI!==Be.svg||"innerHTML"in e)e.innerHTML=t;else{for((Ue=Ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return qe(e,t)})}:qe);function ze(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function Ve(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Ge={},Ke={};function Xe(e){if(Ge[e])return Ge[e];if(!We[e])return e;var t,n=We[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ke)return Ge[e]=n[t];return e}Q&&(Ke=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);var Ye=Xe("animationend"),Je=Xe("animationiteration"),$e=Xe("animationstart"),Qe=Xe("transitionend"),Ze="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" ");function et(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else for(e=t;0!=(1026&(t=e).effectTag)&&(n=t.return),e=t.return;);return 3===t.tag?n:null}function tt(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function nt(e){if(et(e)!==e)throw Error(L(188))}function rt(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=et(e)))throw Error(L(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return nt(i),e;if(o===r)return nt(i),t;o=o.sibling}throw Error(L(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,s=i.child;s;){if(s===n){a=!0,n=i,r=o;break}if(s===r){a=!0,r=i,n=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===n){a=!0,n=o,r=i;break}if(s===r){a=!0,r=o,n=i;break}s=s.sibling}if(!a)throw Error(L(189))}}if(n.alternate!==r)throw Error(L(190))}if(3!==n.tag)throw Error(L(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t=(t.child.return=t).child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var it,ot,at,st=!1,lt=[],ct=null,ut=null,pt=null,dt=new Map,ft=new Map,ht=[],mt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),gt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function vt(e,t,n,r){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:r}}function yt(e,t){switch(e){case"focus":case"blur":ct=null;break;case"dragenter":case"dragleave":ut=null;break;case"mouseover":case"mouseout":pt=null;break;case"pointerover":case"pointerout":dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ft.delete(t.pointerId)}}function bt(e,t,n,r,i){return null===e||e.nativeEvent!==i?(e=vt(t,n,r,i),null!==t&&null!==(t=pr(t))&&ot(t)):e.eventSystemFlags|=r,e}function _t(e){var t=ur(e.target);if(null!==t){var n=et(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=tt(n)))return e.blockedOn=t,void o.unstable_runWithPriority(e.priority,function(){at(n)})}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function wt(e){if(null!==e.blockedOn)return!1;var t=Nn(e.topLevelType,e.eventSystemFlags,e.nativeEvent);if(null!==t){var n=pr(t);return null!==n&&ot(n),e.blockedOn=t,!1}return!0}function kt(e,t,n){wt(e)&&n.delete(t)}function xt(){for(st=!1;0<lt.length;){var e=lt[0];if(null!==e.blockedOn){null!==(e=pr(e.blockedOn))&&it(e);break}var t=Nn(e.topLevelType,e.eventSystemFlags,e.nativeEvent);null!==t?e.blockedOn=t:lt.shift()}null!==ct&&wt(ct)&&(ct=null),null!==ut&&wt(ut)&&(ut=null),null!==pt&&wt(pt)&&(pt=null),dt.forEach(kt),ft.forEach(kt)}function Et(e,t){e.blockedOn===t&&(e.blockedOn=null,st||(st=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,xt)))}function Ct(t){function e(e){return Et(e,t)}if(0<lt.length){Et(lt[0],t);for(var n=1;n<lt.length;n++){var r=lt[n];r.blockedOn===t&&(r.blockedOn=null)}}for(null!==ct&&Et(ct,t),null!==ut&&Et(ut,t),null!==pt&&Et(pt,t),dt.forEach(e),ft.forEach(e),n=0;n<ht.length;n++)(r=ht[n]).blockedOn===t&&(r.blockedOn=null);for(;0<ht.length&&null===(n=ht[0]).blockedOn;)_t(n),null===n.blockedOn&&ht.shift()}function St(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function Tt(e){for(;(e=e.return)&&5!==e.tag;);return e||null}function At(e,t,n){(t=O(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=E(n._dispatchListeners,t),n._dispatchInstances=E(n._dispatchInstances,e))}function Nt(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=Tt(t);for(t=n.length;0<t--;)At(n[t],"captured",e);for(t=0;t<n.length;t++)At(n[t],"bubbled",e)}}function Ot(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=O(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=E(n._dispatchListeners,t),n._dispatchInstances=E(n._dispatchInstances,e))}function Pt(e){e&&e.dispatchConfig.registrationName&&Ot(e._targetInst,null,e)}function It(e){C(e,Nt)}function Dt(){return!0}function Lt(){return!1}function Rt(e,t,n,r){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(n):"target"===i?this.target=r:this[i]=n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Dt:Lt,this.isPropagationStopped=Lt,this}function jt(e,t,n,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,n,r),i}return new this(e,t,n,r)}function Bt(e){if(!(e instanceof this))throw Error(L(279));e.destructor(),this.eventPool.length<10&&this.eventPool.push(e)}function Mt(e){e.eventPool=[],e.getPooled=jt,e.release=Bt}m(Rt.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Dt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Dt)},persist:function(){this.isPersistent=Dt},isPersistent:Lt,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Lt,this._dispatchInstances=this._dispatchListeners=null}}),Rt.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},Rt.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var i=new t;return m(i,n.prototype),((n.prototype=i).constructor=n).Interface=m({},r.Interface,e),n.extend=r.extend,Mt(n),n},Mt(Rt);var Ft=Rt.extend({animationName:null,elapsedTime:null,pseudoElement:null}),Ut=Rt.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),qt=Rt.extend({view:null,detail:null}),Ht=qt.extend({relatedTarget:null});function zt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var Vt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Wt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Kt(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Gt[e])&&!!t[e]}function Xt(){return Kt}for(var Yt=qt.extend({key:function(e){if(e.key){var t=Vt[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=zt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Wt[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Xt,charCode:function(e){return"keypress"===e.type?zt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?zt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Jt=0,$t=0,Qt=!1,Zt=!1,en=qt.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Xt,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Jt;return Jt=e.screenX,Qt?"mousemove"===e.type?e.screenX-t:0:(Qt=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=$t;return $t=e.screenY,Zt?"mousemove"===e.type?e.screenY-t:0:(Zt=!0,0)}}),tn=en.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),nn=en.extend({dataTransfer:null}),rn=qt.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Xt}),on=Rt.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),an=en.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),sn=[["blur","blur",0],["cancel","cancel",0],["click","click",0],["close","close",0],["contextmenu","contextMenu",0],["copy","copy",0],["cut","cut",0],["auxclick","auxClick",0],["dblclick","doubleClick",0],["dragend","dragEnd",0],["dragstart","dragStart",0],["drop","drop",0],["focus","focus",0],["input","input",0],["invalid","invalid",0],["keydown","keyDown",0],["keypress","keyPress",0],["keyup","keyUp",0],["mousedown","mouseDown",0],["mouseup","mouseUp",0],["paste","paste",0],["pause","pause",0],["play","play",0],["pointercancel","pointerCancel",0],["pointerdown","pointerDown",0],["pointerup","pointerUp",0],["ratechange","rateChange",0],["reset","reset",0],["seeked","seeked",0],["submit","submit",0],["touchcancel","touchCancel",0],["touchend","touchEnd",0],["touchstart","touchStart",0],["volumechange","volumeChange",0],["drag","drag",1],["dragenter","dragEnter",1],["dragexit","dragExit",1],["dragleave","dragLeave",1],["dragover","dragOver",1],["mousemove","mouseMove",1],["mouseout","mouseOut",1],["mouseover","mouseOver",1],["pointermove","pointerMove",1],["pointerout","pointerOut",1],["pointerover","pointerOver",1],["scroll","scroll",1],["toggle","toggle",1],["touchmove","touchMove",1],["wheel","wheel",1],["abort","abort",2],[Ye,"animationEnd",2],[Je,"animationIteration",2],[$e,"animationStart",2],["canplay","canPlay",2],["canplaythrough","canPlayThrough",2],["durationchange","durationChange",2],["emptied","emptied",2],["encrypted","encrypted",2],["ended","ended",2],["error","error",2],["gotpointercapture","gotPointerCapture",2],["load","load",2],["loadeddata","loadedData",2],["loadedmetadata","loadedMetadata",2],["loadstart","loadStart",2],["lostpointercapture","lostPointerCapture",2],["playing","playing",2],["progress","progress",2],["seeking","seeking",2],["stalled","stalled",2],["suspend","suspend",2],["timeupdate","timeUpdate",2],[Qe,"transitionEnd",2],["waiting","waiting",2]],ln={},cn={},un=0;un<sn.length;un++){var pn=sn[un],dn=pn[0],fn=pn[1],hn=pn[2],mn="on"+(fn[0].toUpperCase()+fn.slice(1)),gn={phasedRegistrationNames:{bubbled:mn,captured:mn+"Capture"},dependencies:[dn],eventPriority:hn};ln[fn]=gn,cn[dn]=gn}var vn={eventTypes:ln,getEventPriority:function(e){return void 0!==(e=cn[e])?e.eventPriority:2},extractEvents:function(e,t,n,r){var i=cn[e];if(!i)return null;switch(e){case"keypress":if(0===zt(n))return null;case"keydown":case"keyup":e=Yt;break;case"blur":case"focus":e=Ht;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=en;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=nn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=rn;break;case Ye:case Je:case $e:e=Ft;break;case Qe:e=on;break;case"scroll":e=qt;break;case"wheel":e=an;break;case"copy":case"cut":case"paste":e=Ut;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=tn;break;default:e=Rt}return It(t=e.getPooled(i,t,n,r)),t}},yn=o.unstable_UserBlockingPriority,bn=o.unstable_runWithPriority,_n=vn.getEventPriority,wn=10,kn=[];function xn(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r=n;if(3===r.tag)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=3!==r.tag?null:r.stateNode.containerInfo}if(!r)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=ur(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var i=St(e.nativeEvent);r=e.topLevelType;for(var o=e.nativeEvent,a=e.eventSystemFlags,s=null,l=0;l<d.length;l++){var c=d[l];c&&(c=c.extractEvents(r,t,o,i,a))&&(s=E(s,c))}A(s)}}var En=!0;function Cn(e,t){Sn(t,e,!1)}function Sn(e,t,n){switch(_n(t)){case 0:var r=function(e,t,n){ce||se();var r=An,i=ce;ce=!0;try{ae(r,e,t,n)}finally{(ce=i)||pe()}}.bind(null,t,1);break;case 1:r=function(e,t,n){bn(yn,An.bind(null,e,t,n))}.bind(null,t,1);break;default:r=An.bind(null,t,1)}n?e.addEventListener(t,r,!0):e.addEventListener(t,r,!1)}function Tn(e,t,n,r){if(kn.length){var i=kn.pop();i.topLevelType=e,i.eventSystemFlags=t,i.nativeEvent=n,i.targetInst=r,e=i}else e={topLevelType:e,eventSystemFlags:t,nativeEvent:n,targetInst:r,ancestors:[]};try{if(t=xn,n=e,ue)t(n,void 0);else{ue=!0;try{le(t,n,void 0)}finally{ue=!1,pe()}}}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,kn.length<wn&&kn.push(e)}}function An(e,t,n){if(En)if(0<lt.length&&-1<mt.indexOf(e))e=vt(null,e,t,n),lt.push(e);else{var r=Nn(e,t,n);null===r?yt(e,n):-1<mt.indexOf(e)?(e=vt(r,e,t,n),lt.push(e)):function(e,t,n,r){switch(t){case"focus":return ct=bt(ct,e,t,n,r),!0;case"dragenter":return ut=bt(ut,e,t,n,r),!0;case"mouseover":return pt=bt(pt,e,t,n,r),!0;case"pointerover":var i=r.pointerId;return dt.set(i,bt(dt.get(i)||null,e,t,n,r)),!0;case"gotpointercapture":return i=r.pointerId,ft.set(i,bt(ft.get(i)||null,e,t,n,r)),!0}return!1}(r,e,t,n)||(yt(e,n),Tn(e,t,n,null))}}function Nn(e,t,n){var r=St(n);if(null!==(r=ur(r))){var i=et(r);if(null===i)r=null;else{var o=i.tag;if(13===o){if(null!==(r=tt(i)))return r;r=null}else if(3===o){if(i.stateNode.hydrate)return 3===i.tag?i.stateNode.containerInfo:null;r=null}else i!==r&&(r=null)}}return Tn(e,t,n,r),null}function On(e){if(!Q)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}var Pn=new("function"==typeof WeakMap?WeakMap:Map);function In(e){var t=Pn.get(e);return void 0===t&&(t=new Set,Pn.set(e,t)),t}function Dn(e,t,n){if(!n.has(e)){switch(e){case"scroll":Sn(t,"scroll",!0);break;case"focus":case"blur":Sn(t,"focus",!0),Sn(t,"blur",!0),n.add("blur"),n.add("focus");break;case"cancel":case"close":On(e)&&Sn(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Ze.indexOf(e)&&Cn(e,t)}n.add(e)}}var Ln={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Rn=["Webkit","ms","Moz","O"];function jn(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||Ln.hasOwnProperty(e)&&Ln[e]?(""+t).trim():t+"px"}function Bn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=jn(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(Ln).forEach(function(t){Rn.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ln[e]=Ln[t]})});var Mn=m({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Fn(e,t){if(t){if(Mn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(L(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(L(60));if(!("object"==typeof t.dangerouslySetInnerHTML&&"__html"in t.dangerouslySetInnerHTML))throw Error(L(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(L(62,""))}}function Un(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function qn(e,t){var n=In(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=s[t];for(var r=0;r<t.length;r++)Dn(t[r],e,n)}function Hn(){}function zn(t){if(void 0===(t=t||("undefined"!=typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function Vn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Wn(e,t){var n,r=Vn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&t<=n)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Vn(r)}}function Gn(){for(var e=window,t=zn();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=zn((e=t.contentWindow).document)}return t}function Kn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var Xn="$",Yn="/$",Jn="$?",$n="$!",Qn=null,Zn=null;function er(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function tr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var nr="function"==typeof setTimeout?setTimeout:void 0,rr="function"==typeof clearTimeout?clearTimeout:void 0;function ir(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function or(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if(n===Xn||n===$n||n===Jn){if(0===t)return e;t--}else n===Yn&&t++}e=e.previousSibling}return null}var ar=Math.random().toString(36).slice(2),sr="__reactInternalInstance$"+ar,lr="__reactEventHandlers$"+ar,cr="__reactContainere$"+ar;function ur(e){var t=e[sr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[cr]||n[sr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=or(e);null!==e;){if(n=e[sr])return n;e=or(e)}return t}n=(e=n).parentNode}return null}function pr(e){return!(e=e[sr]||e[cr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function dr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(L(33))}function fr(e){return e[lr]||null}var hr=null,mr=null,gr=null;function vr(){if(gr)return gr;var e,t,n=mr,r=n.length,i="value"in hr?hr.value:hr.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return gr=i.slice(e,1<t?1-t:void 0)}var yr=Rt.extend({data:null}),br=Rt.extend({data:null}),_r=[9,13,27,32],wr=Q&&"CompositionEvent"in window,kr=null;Q&&"documentMode"in document&&(kr=document.documentMode);var xr=Q&&"TextEvent"in window&&!kr,Er=Q&&(!wr||kr&&8<kr&&kr<=11),Cr=String.fromCharCode(32),Sr={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},Tr=!1;function Ar(e,t){switch(e){case"keyup":return-1!==_r.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function Nr(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Or=!1;var Pr={eventTypes:Sr,extractEvents:function(e,t,n,r){var i;if(wr)e:{switch(e){case"compositionstart":var o=Sr.compositionStart;break e;case"compositionend":o=Sr.compositionEnd;break e;case"compositionupdate":o=Sr.compositionUpdate;break e}o=void 0}else Or?Ar(e,n)&&(o=Sr.compositionEnd):"keydown"===e&&229===n.keyCode&&(o=Sr.compositionStart);return o?(Er&&"ko"!==n.locale&&(Or||o!==Sr.compositionStart?o===Sr.compositionEnd&&Or&&(i=vr()):(mr="value"in(hr=r)?hr.value:hr.textContent,Or=!0)),o=yr.getPooled(o,t,n,r),i?o.data=i:null!==(i=Nr(n))&&(o.data=i),It(o),i=o):i=null,(e=xr?function(e,t){switch(e){case"compositionend":return Nr(t);case"keypress":return 32!==t.which?null:(Tr=!0,Cr);case"textInput":return(e=t.data)===Cr&&Tr?null:e;default:return null}}(e,n):function(e,t){if(Or)return"compositionend"===e||!wr&&Ar(e,t)?(e=vr(),gr=mr=hr=null,Or=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Er&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))?((t=br.getPooled(Sr.beforeInput,t,n,r)).data=e,It(t)):t=null,null===i?t:null===t?i:[i,t]}},Ir={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Ir[e.type]:"textarea"===t}var Lr={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function Rr(e,t,n){return(e=Rt.getPooled(Lr.change,e,t,n)).type="change",re(n),It(e),e}var jr=null,Br=null;function Mr(e){A(e)}function Fr(e){if(Ee(dr(e)))return e}function Ur(e,t){if("change"===e)return t}var qr=!1;function Hr(){jr&&(jr.detachEvent("onpropertychange",zr),Br=jr=null)}function zr(e){if("value"===e.propertyName&&Fr(Br))if(e=Rr(Br,e,St(e)),ce)A(e);else{ce=!0;try{oe(Mr,e)}finally{ce=!1,pe()}}}function Vr(e,t,n){"focus"===e?(Hr(),Br=n,(jr=t).attachEvent("onpropertychange",zr)):"blur"===e&&Hr()}function Wr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Fr(Br)}function Gr(e,t){if("click"===e)return Fr(t)}function Kr(e,t){if("input"===e||"change"===e)return Fr(t)}Q&&(qr=On("input")&&(!document.documentMode||9<document.documentMode));var Xr,Yr={eventTypes:Lr,_isInputEventSupported:qr,extractEvents:function(e,t,n,r){var i=t?dr(t):window,o=i.nodeName&&i.nodeName.toLowerCase();if("select"===o||"input"===o&&"file"===i.type)var a=Ur;else if(Dr(i))if(qr)a=Kr;else{a=Wr;var s=Vr}else(o=i.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(a=Gr);if(a&&(a=a(e,t)))return Rr(a,n,r);s&&s(e,i,t),"blur"===e&&(e=i._wrapperState)&&e.controlled&&"number"===i.type&&Oe(i,"number",i.value)}},Jr={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},$r={eventTypes:Jr,extractEvents:function(e,t,n,r,i){var o="mouseover"===e||"pointerover"===e,a="mouseout"===e||"pointerout"===e;if(o&&0==(32&i)&&(n.relatedTarget||n.fromElement)||!a&&!o)return null;if(i=r.window===r?r:(i=r.ownerDocument)?i.defaultView||i.parentWindow:window,a?(a=t,null!==(t=(t=n.relatedTarget||n.toElement)?ur(t):null)&&(t!==(o=et(t))||5!==t.tag&&6!==t.tag)&&(t=null)):a=null,a===t)return null;if("mouseout"===e||"mouseover"===e)var s=en,l=Jr.mouseLeave,c=Jr.mouseEnter,u="mouse";else"pointerout"!==e&&"pointerover"!==e||(s=tn,l=Jr.pointerLeave,c=Jr.pointerEnter,u="pointer");if(e=null==a?i:dr(a),i=null==t?i:dr(t),(l=s.getPooled(l,a,n,r)).type=u+"leave",l.target=e,l.relatedTarget=i,(r=s.getPooled(c,t,n,r)).type=u+"enter",r.target=i,r.relatedTarget=e,u=t,(s=a)&&u)e:{for(e=u,a=0,t=c=s;t;t=Tt(t))a++;for(t=0,i=e;i;i=Tt(i))t++;for(;0<a-t;)c=Tt(c),a--;for(;0<t-a;)e=Tt(e),t--;for(;a--;){if(c===e||c===e.alternate)break e;c=Tt(c),e=Tt(e)}c=null}else c=null;for(e=c,c=[];s&&s!==e&&(null===(a=s.alternate)||a!==e);)c.push(s),s=Tt(s);for(s=[];u&&u!==e&&(null===(a=u.alternate)||a!==e);)s.push(u),u=Tt(u);for(u=0;u<c.length;u++)Ot(c[u],"bubbled",l);for(u=s.length;0<u--;)Ot(s[u],"captured",r);return n===Xr?(Xr=null,[l]):(Xr=n,[l,r])}};var Qr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Zr=Object.prototype.hasOwnProperty;function ei(e,t){if(Qr(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Zr.call(t,n[r])||!Qr(e[n[r]],t[n[r]]))return!1;return!0}var ti=Q&&"documentMode"in document&&document.documentMode<=11,ni={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},ri=null,ii=null,oi=null,ai=!1;function si(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return ai||null==ri||ri!==zn(n)?null:(n="selectionStart"in(n=ri)&&Kn(n)?{start:n.selectionStart,end:n.selectionEnd}:{anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},oi&&ei(oi,n)?null:(oi=n,(e=Rt.getPooled(ni.select,ii,e,t)).type="select",e.target=ri,It(e),e))}var li={eventTypes:ni,extractEvents:function(e,t,n,r){var i,o=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;if(!(i=!o)){e:{o=In(o),i=s.onSelect;for(var a=0;a<i.length;a++)if(!o.has(i[a])){o=!1;break e}o=!0}i=!o}if(i)return null;switch(o=t?dr(t):window,e){case"focus":(Dr(o)||"true"===o.contentEditable)&&(ri=o,ii=t,oi=null);break;case"blur":oi=ii=ri=null;break;case"mousedown":ai=!0;break;case"contextmenu":case"mouseup":case"dragend":return ai=!1,si(n,r);case"selectionchange":if(ti)break;case"keydown":case"keyup":return si(n,r)}return null}};N.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),l=fr,r=pr,k=dr,N.injectEventPluginsByName({SimpleEventPlugin:vn,EnterLeaveEventPlugin:$r,ChangeEventPlugin:Yr,SelectEventPlugin:li,BeforeInputEventPlugin:Pr}),new Set;var ci=[],ui=-1;function pi(e){ui<0||(e.current=ci[ui],ci[ui]=null,ui--)}function di(e,t){ci[++ui]=e.current,e.current=t}var fi={},hi={current:fi},mi={current:!1},gi=fi;function vi(e,t){var n=e.type.contextTypes;if(!n)return fi;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function yi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function bi(e){pi(mi),pi(hi)}function _i(e){pi(mi),pi(hi)}function wi(e,t,n){if(hi.current!==fi)throw Error(L(168));di(hi,t),di(mi,n)}function ki(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in e))throw Error(L(108,J(t)||"Unknown",i));return m({},n,{},r)}function xi(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||fi,gi=hi.current,di(hi,t),di(mi,mi.current),!0}function Ei(e,t,n){var r=e.stateNode;if(!r)throw Error(L(169));n?(t=ki(e,t,gi),r.__reactInternalMemoizedMergedChildContext=t,pi(mi),pi(hi),di(hi,t)):pi(mi),di(mi,n)}var Ci=o.unstable_runWithPriority,Si=o.unstable_scheduleCallback,Ti=o.unstable_cancelCallback,Ai=o.unstable_shouldYield,Ni=o.unstable_requestPaint,Oi=o.unstable_now,Pi=o.unstable_getCurrentPriorityLevel,Ii=o.unstable_ImmediatePriority,Di=o.unstable_UserBlockingPriority,Li=o.unstable_NormalPriority,Ri=o.unstable_LowPriority,ji=o.unstable_IdlePriority,Bi={},Mi=void 0!==Ni?Ni:function(){},Fi=null,Ui=null,qi=!1,Hi=Oi(),zi=Hi<1e4?Oi:function(){return Oi()-Hi};function Vi(){switch(Pi()){case Ii:return 99;case Di:return 98;case Li:return 97;case Ri:return 96;case ji:return 95;default:throw Error(L(332))}}function Wi(e){switch(e){case 99:return Ii;case 98:return Di;case 97:return Li;case 96:return Ri;case 95:return ji;default:throw Error(L(332))}}function Gi(e,t){return e=Wi(e),Ci(e,t)}function Ki(e,t,n){return e=Wi(e),Si(e,t,n)}function Xi(e){return null===Fi?(Fi=[e],Ui=Si(Ii,Ji)):Fi.push(e),Bi}function Yi(){if(null!==Ui){var e=Ui;Ui=null,Ti(e)}Ji()}function Ji(){if(!qi&&null!==Fi){qi=!0;var t=0;try{var n=Fi;Gi(99,function(){for(;t<n.length;t++)for(var e=n[t];null!==(e=e(!0)););}),Fi=null}catch(n){throw null!==Fi&&(Fi=Fi.slice(t+1)),Si(Ii,Yi),n}finally{qi=!1}}}var $i=3;function Qi(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function Zi(e,t){if(e&&e.defaultProps)for(var n in t=m({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var eo={current:null},to=null,no=null,ro=null;function io(){ro=no=to=null}function oo(e,t){var n=e.type._context;di(eo,n._currentValue),n._currentValue=t}function ao(e){var t=eo.current;pi(eo),e.type._context._currentValue=t}function so(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function lo(e,t){ro=no=null,null!==(e=(to=e).dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(za=!0),e.firstContext=null)}function co(e,t){if(ro!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(ro=e,t=1073741823),t={context:e,observedBits:t,next:null},null===no){if(null===to)throw Error(L(308));no=t,to.dependencies={expirationTime:0,firstContext:t,responders:null}}else no=no.next=t;return e._currentValue}var uo=!1;function po(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function fo(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function ho(e,t){return{expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function mo(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function go(e,t){var n=e.alternate;if(null===n){var r=e.updateQueue,i=null;null===r&&(r=e.updateQueue=po(e.memoizedState))}else r=e.updateQueue,i=n.updateQueue,null===r?null===i?(r=e.updateQueue=po(e.memoizedState),i=n.updateQueue=po(n.memoizedState)):r=e.updateQueue=fo(i):null===i&&(i=n.updateQueue=fo(r));null===i||r===i?mo(r,t):null===r.lastUpdate||null===i.lastUpdate?(mo(r,t),mo(i,t)):(mo(r,t),i.lastUpdate=t)}function vo(e,t){var n=e.updateQueue;null===(n=null===n?e.updateQueue=po(e.memoizedState):yo(e,n)).lastCapturedUpdate?n.firstCapturedUpdate=n.lastCapturedUpdate=t:(n.lastCapturedUpdate.next=t,n.lastCapturedUpdate=t)}function yo(e,t){var n=e.alternate;return null!==n&&t===n.updateQueue&&(t=e.updateQueue=fo(t)),t}function bo(e,t,n,r,i,o){switch(n.tag){case 1:return"function"==typeof(e=n.payload)?e.call(o,r,i):e;case 3:e.effectTag=-4097&e.effectTag|64;case 0:if(null===(i="function"==typeof(e=n.payload)?e.call(o,r,i):e)||void 0===i)break;return m({},r,i);case 2:uo=!0}return r}function _o(e,t,n,r,i){uo=!1;for(var o=(t=yo(e,t)).baseState,a=null,s=0,l=t.firstUpdate,c=o;null!==l;){var u=l.expirationTime;u<i?(null===a&&(a=l,o=c),s<u&&(s=u)):(El(u,l.suspenseConfig),c=bo(e,0,l,c,n,r),null!==l.callback&&(e.effectTag|=32,(l.nextEffect=null)===t.lastEffect?t.firstEffect=t.lastEffect=l:(t.lastEffect.nextEffect=l,t.lastEffect=l))),l=l.next}for(u=null,l=t.firstCapturedUpdate;null!==l;){var p=l.expirationTime;p<i?(null===u&&(u=l,null===a&&(o=c)),s<p&&(s=p)):(c=bo(e,0,l,c,n,r),null!==l.callback&&(e.effectTag|=32,(l.nextEffect=null)===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=l:(t.lastCapturedEffect.nextEffect=l,t.lastCapturedEffect=l))),l=l.next}null===a&&(t.lastUpdate=null),null===u?t.lastCapturedUpdate=null:e.effectTag|=32,null===a&&null===u&&(o=c),t.baseState=o,t.firstUpdate=a,t.firstCapturedUpdate=u,Cl(s),e.expirationTime=s,e.memoizedState=c}function wo(e,t,n){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),ko(t.firstEffect,n),t.firstEffect=t.lastEffect=null,ko(t.firstCapturedEffect,n),t.firstCapturedEffect=t.lastCapturedEffect=null}function ko(e,t){for(;null!==e;){var n=e.callback;if(null!==n){e.callback=null;var r=t;if("function"!=typeof n)throw Error(L(191,n));n.call(r)}e=e.nextEffect}}var xo=P.ReactCurrentBatchConfig,Eo=(new i.Component).refs;function Co(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:m({},t,n),e.memoizedState=n,null!==(r=e.updateQueue)&&0===e.expirationTime&&(r.baseState=n)}var So={isMounted:function(e){return!!(e=e._reactInternalFiber)&&et(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=dl(),i=xo.suspense;(i=ho(r=fl(r,e,i),i)).payload=t,null!=n&&(i.callback=n),go(e,i),hl(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=dl(),i=xo.suspense;(i=ho(r=fl(r,e,i),i)).tag=1,i.payload=t,null!=n&&(i.callback=n),go(e,i),hl(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=dl(),r=xo.suspense;(r=ho(n=fl(n,e,r),r)).tag=2,null!=t&&(r.callback=t),go(e,r),hl(e,n)}};function To(e,t,n,r,i,o,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!(t.prototype&&t.prototype.isPureReactComponent&&ei(n,r)&&ei(i,o))}function Ao(e,t,n){var r=!1,i=fi,o=t.contextType;return"object"==typeof o&&null!==o?o=co(o):(i=yi(t)?gi:hi.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?vi(e,i):fi),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=So,(e.stateNode=t)._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function No(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&So.enqueueReplaceState(t,t.state,null)}function Oo(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Eo;var o=t.contextType;"object"==typeof o&&null!==o?i.context=co(o):(o=yi(t)?gi:hi.current,i.context=vi(e,o)),null!==(o=e.updateQueue)&&(_o(e,o,n,i,r),i.state=e.memoizedState),"function"==typeof(o=t.getDerivedStateFromProps)&&(Co(e,t,o,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&So.enqueueReplaceState(i,i.state,null),null!==(o=e.updateQueue)&&(_o(e,o,n,i,r),i.state=e.memoizedState)),"function"==typeof i.componentDidMount&&(e.effectTag|=4)}var Po=Array.isArray;function Io(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(L(309));var r=n.stateNode}if(!r)throw Error(L(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===Eo&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!=typeof e)throw Error(L(284));if(!n._owner)throw Error(L(290,e))}return e}function Do(e,t){if("textarea"!==e.type)throw Error(L(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Lo(p){function d(e,t){if(p){var n=e.lastEffect;null!==n?(n.nextEffect=t,e.lastEffect=t):e.firstEffect=e.lastEffect=t,t.nextEffect=null,t.effectTag=8}}function f(e,t){if(!p)return null;for(;null!==t;)d(e,t),t=t.sibling;return null}function h(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t,n){return(e=zl(e,t)).index=0,e.sibling=null,e}function m(e,t,n){return e.index=n,p?null!==(n=e.alternate)?(n=n.index)<t?(e.effectTag=2,t):n:(e.effectTag=2,t):t}function s(e){return p&&null===e.alternate&&(e.effectTag=2),e}function o(e,t,n,r){return null===t||6!==t.tag?(t=Gl(n,e.mode,r)).return=e:(t=a(t,n)).return=e,t}function l(e,t,n,r){return null!==t&&t.elementType===n.type?(r=a(t,n.props)).ref=Io(e,t,n):(r=Vl(n.type,n.key,n.props,null,e.mode,r)).ref=Io(e,t,n),r.return=e,r}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?(t=Kl(n,e.mode,r)).return=e:(t=a(t,n.children||[])).return=e,t}function u(e,t,n,r,i){return null===t||7!==t.tag?(t=Wl(n,e.mode,r,i)).return=e:(t=a(t,n)).return=e,t}function g(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=Gl(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case R:return(n=Vl(t.type,t.key,t.props,null,e.mode,n)).ref=Io(e,null,t),n.return=e,n;case j:return(t=Kl(t,e.mode,n)).return=e,t}if(Po(t)||Y(t))return(t=Wl(t,e.mode,n,null)).return=e,t;Do(e,t)}return null}function v(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==i?null:o(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case R:return n.key===i?n.type===B?u(e,t,n.props.children,r,i):l(e,t,n,r):null;case j:return n.key===i?c(e,t,n,r):null}if(Po(n)||Y(n))return null!==i?null:u(e,t,n,r,null);Do(e,n)}return null}function y(e,t,n,r,i){if("string"==typeof r||"number"==typeof r)return o(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case R:return e=e.get(null===r.key?n:r.key)||null,r.type===B?u(t,e,r.props.children,i,r.key):l(t,e,r,i);case j:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(Po(r)||Y(r))return u(t,e=e.get(n)||null,r,i,null);Do(t,r)}return null}return function(e,t,n,r){var i="object"==typeof n&&null!==n&&n.type===B&&null===n.key;i&&(n=n.props.children);var o="object"==typeof n&&null!==n;if(o)switch(n.$$typeof){case R:e:{for(o=n.key,i=t;null!==i;){if(i.key===o){if(7===i.tag?n.type===B:i.elementType===n.type){f(e,i.sibling),(t=a(i,n.type===B?n.props.children:n.props)).ref=Io(e,i,n),t.return=e,e=t;break e}f(e,i);break}d(e,i),i=i.sibling}n.type===B?((t=Wl(n.props.children,e.mode,r,n.key)).return=e,e=t):((r=Vl(n.type,n.key,n.props,null,e.mode,r)).ref=Io(e,t,n),r.return=e,e=r)}return s(e);case j:e:{for(i=n.key;null!==t;){if(t.key===i){if(4===t.tag&&t.stateNode.containerInfo===n.containerInfo&&t.stateNode.implementation===n.implementation){f(e,t.sibling),(t=a(t,n.children||[])).return=e,e=t;break e}f(e,t);break}d(e,t),t=t.sibling}(t=Kl(n,e.mode,r)).return=e,e=t}return s(e)}if("string"==typeof n||"number"==typeof n)return n=""+n,null!==t&&6===t.tag?(f(e,t.sibling),(t=a(t,n)).return=e):(f(e,t),(t=Gl(n,e.mode,r)).return=e),s(e=t);if(Po(n))return function(t,e,n,r){for(var i=null,o=null,a=e,s=e=0,l=null;null!==a&&s<n.length;s++){a.index>s?(l=a,a=null):l=a.sibling;var c=v(t,a,n[s],r);if(null===c){null===a&&(a=l);break}p&&a&&null===c.alternate&&d(t,a),e=m(c,e,s),null===o?i=c:o.sibling=c,o=c,a=l}if(s===n.length)return f(t,a),i;if(null===a){for(;s<n.length;s++)null!==(a=g(t,n[s],r))&&(e=m(a,e,s),null===o?i=a:o.sibling=a,o=a);return i}for(a=h(t,a);s<n.length;s++)null!==(l=y(a,t,s,n[s],r))&&(p&&null!==l.alternate&&a.delete(null===l.key?s:l.key),e=m(l,e,s),null===o?i=l:o.sibling=l,o=l);return p&&a.forEach(function(e){return d(t,e)}),i}(e,t,n,r);if(Y(n))return function(t,e,n,r){var i=Y(n);if("function"!=typeof i)throw Error(L(150));if(null==(n=i.call(n)))throw Error(L(151));for(var o=i=null,a=e,s=e=0,l=null,c=n.next();null!==a&&!c.done;s++,c=n.next()){a.index>s?(l=a,a=null):l=a.sibling;var u=v(t,a,c.value,r);if(null===u){null===a&&(a=l);break}p&&a&&null===u.alternate&&d(t,a),e=m(u,e,s),null===o?i=u:o.sibling=u,o=u,a=l}if(c.done)return f(t,a),i;if(null===a){for(;!c.done;s++,c=n.next())null!==(c=g(t,c.value,r))&&(e=m(c,e,s),null===o?i=c:o.sibling=c,o=c);return i}for(a=h(t,a);!c.done;s++,c=n.next())null!==(c=y(a,t,s,c.value,r))&&(p&&null!==c.alternate&&a.delete(null===c.key?s:c.key),e=m(c,e,s),null===o?i=c:o.sibling=c,o=c);return p&&a.forEach(function(e){return d(t,e)}),i}(e,t,n,r);if(o&&Do(e,n),void 0===n&&!i)switch(e.tag){case 1:case 0:throw e=e.type,Error(L(152,e.displayName||e.name||"Component"))}return f(e,t)}}var Ro=Lo(!0),jo=Lo(!1),Bo={},Mo={current:Bo},Fo={current:Bo},Uo={current:Bo};function qo(e){if(e===Bo)throw Error(L(174));return e}function Ho(e,t){di(Uo,t),di(Fo,e),di(Mo,Bo);var n=t.nodeType;switch(n){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Fe(null,"");break;default:t=Fe(t=(n=8===n?t.parentNode:t).namespaceURI||null,n=n.tagName)}pi(Mo),di(Mo,t)}function zo(e){pi(Mo),pi(Fo),pi(Uo)}function Vo(e){qo(Uo.current);var t=qo(Mo.current),n=Fe(t,e.type);t!==n&&(di(Fo,e),di(Mo,n))}function Wo(e){Fo.current===e&&(pi(Mo),pi(Fo))}var Go={current:0};function Ko(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||n.data===Jn||n.data===$n))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.effectTag))return t}else if(null!==t.child){t=(t.child.return=t).child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Xo(e,t){return{responder:e,props:t}}var Yo=P.ReactCurrentDispatcher,Jo=P.ReactCurrentBatchConfig,$o=0,Qo=null,Zo=null,ea=null,ta=null,na=null,ra=null,ia=0,oa=null,aa=0,sa=!1,la=null,ca=0;function ua(){throw Error(L(321))}function pa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Qr(e[n],t[n]))return!1;return!0}function da(e,t,n,r,i,o){if($o=o,Qo=t,ea=null!==e?e.memoizedState:null,Yo.current=null===ea?Pa:Ia,t=n(r,i),sa){for(;sa=!1,ca+=1,ea=null!==e?e.memoizedState:null,ra=ta,oa=na=Zo=null,Yo.current=Ia,t=n(r,i),sa;);la=null,ca=0}if(Yo.current=Oa,(e=Qo).memoizedState=ta,e.expirationTime=ia,e.updateQueue=oa,e.effectTag|=aa,e=null!==Zo&&null!==Zo.next,ra=na=ta=ea=Zo=Qo=null,oa=null,aa=ia=$o=0,e)throw Error(L(300));return t}function fa(){Yo.current=Oa,ra=na=ta=ea=Zo=Qo=null,sa=!1,la=oa=null,ca=aa=ia=$o=0}function ha(){var e={memoizedState:null,baseState:null,queue:null,baseUpdate:null,next:null};return null===na?ta=na=e:na=na.next=e,na}function ma(){if(null!==ra)ra=(na=ra).next,ea=null!==(Zo=ea)?Zo.next:null;else{if(null===ea)throw Error(L(310));var e={memoizedState:(Zo=ea).memoizedState,baseState:Zo.baseState,queue:Zo.queue,baseUpdate:Zo.baseUpdate,next:null};na=null===na?ta=e:na.next=e,ea=Zo.next}return na}function ga(e,t){return"function"==typeof t?t(e):t}function va(e){var t=ma(),n=t.queue;if(null===n)throw Error(L(311));if(n.lastRenderedReducer=e,0<ca){var r=n.dispatch;if(null!==la){var i=la.get(n);if(void 0!==i){la.delete(n);for(var o=t.memoizedState;o=e(o,i.action),null!==(i=i.next););return Qr(o,t.memoizedState)||(za=!0),t.memoizedState=o,t.baseUpdate===n.last&&(t.baseState=o),[n.lastRenderedState=o,r]}}return[t.memoizedState,r]}r=n.last;var a=t.baseUpdate;if(o=t.baseState,null!==a?(null!==r&&(r.next=null),r=a.next):r=null!==r?r.next:null,null!==r){var s=i=null,l=r,c=!1;do{var u=l.expirationTime;u<$o?(c||(c=!0,s=a,i=o),ia<u&&Cl(ia=u)):(El(u,l.suspenseConfig),o=l.eagerReducer===e?l.eagerState:e(o,l.action)),l=(a=l).next}while(null!==l&&l!==r);c||(s=a,i=o),Qr(o,t.memoizedState)||(za=!0),t.memoizedState=o,t.baseUpdate=s,t.baseState=i,n.lastRenderedState=o}return[t.memoizedState,n.dispatch]}function ya(e){var t=ha();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={last:null,dispatch:null,lastRenderedReducer:ga,lastRenderedState:e}).dispatch=Na.bind(null,Qo,e),[t.memoizedState,e]}function ba(e){return va(ga)}function _a(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===oa?(oa={lastEffect:null}).lastEffect=e.next=e:null===(t=oa.lastEffect)?oa.lastEffect=e.next=e:(n=t.next,(t.next=e).next=n,oa.lastEffect=e),e}function wa(e,t,n,r){var i=ha();aa|=e,i.memoizedState=_a(t,n,void 0,void 0===r?null:r)}function ka(e,t,n,r){var i=ma();r=void 0===r?null:r;var o=void 0;if(null!==Zo){var a=Zo.memoizedState;if(o=a.destroy,null!==r&&pa(r,a.deps))return void _a(0,n,o,r)}aa|=e,i.memoizedState=_a(t,n,o,r)}function xa(e,t){return wa(516,192,e,t)}function Ea(e,t){return ka(516,192,e,t)}function Ca(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Sa(){}function Ta(e,t){return ha().memoizedState=[e,void 0===t?null:t],e}function Aa(e,t){var n=ma();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&pa(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Na(e,t,n){if(!(ca<25))throw Error(L(301));var r=e.alternate;if(e===Qo||null!==r&&r===Qo)if(sa=!0,e={expirationTime:$o,suspenseConfig:null,action:n,eagerReducer:null,eagerState:null,next:null},null===la&&(la=new Map),void 0===(n=la.get(t)))la.set(t,e);else{for(t=n;null!==t.next;)t=t.next;t.next=e}else{var i=dl(),o=xo.suspense;o={expirationTime:i=fl(i,e,o),suspenseConfig:o,action:n,eagerReducer:null,eagerState:null,next:null};var a=t.last;if(null===a)o.next=o;else{var s=a.next;null!==s&&(o.next=s),a.next=o}if(t.last=o,0===e.expirationTime&&(null===r||0===r.expirationTime)&&null!==(r=t.lastRenderedReducer))try{var l=t.lastRenderedState,c=r(l,n);if(o.eagerReducer=r,o.eagerState=c,Qr(c,l))return}catch(e){}hl(e,i)}}var Oa={readContext:co,useCallback:ua,useContext:ua,useEffect:ua,useImperativeHandle:ua,useLayoutEffect:ua,useMemo:ua,useReducer:ua,useRef:ua,useState:ua,useDebugValue:ua,useResponder:ua,useDeferredValue:ua,useTransition:ua},Pa={readContext:co,useCallback:Ta,useContext:co,useEffect:xa,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,wa(4,36,Ca.bind(null,t,e),n)},useLayoutEffect:function(e,t){return wa(4,36,e,t)},useMemo:function(e,t){var n=ha();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ha();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={last:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Na.bind(null,Qo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ha().memoizedState=e},useState:ya,useDebugValue:Sa,useResponder:Xo,useDeferredValue:function(t,n){var e=ya(t),r=e[0],i=e[1];return xa(function(){o.unstable_next(function(){var e=Jo.suspense;Jo.suspense=void 0===n?null:n;try{i(t)}finally{Jo.suspense=e}})},[t,n]),r},useTransition:function(n){var e=ya(!1),t=e[0],r=e[1];return[Ta(function(t){r(!0),o.unstable_next(function(){var e=Jo.suspense;Jo.suspense=void 0===n?null:n;try{r(!1),t()}finally{Jo.suspense=e}})},[n,t]),t]}},Ia={readContext:co,useCallback:Aa,useContext:co,useEffect:Ea,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,ka(4,36,Ca.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ka(4,36,e,t)},useMemo:function(e,t){var n=ma();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&pa(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)},useReducer:va,useRef:function(){return ma().memoizedState},useState:ba,useDebugValue:Sa,useResponder:Xo,useDeferredValue:function(t,n){var e=ba(),r=e[0],i=e[1];return Ea(function(){o.unstable_next(function(){var e=Jo.suspense;Jo.suspense=void 0===n?null:n;try{i(t)}finally{Jo.suspense=e}})},[t,n]),r},useTransition:function(n){var e=ba(),t=e[0],r=e[1];return[Aa(function(t){r(!0),o.unstable_next(function(){var e=Jo.suspense;Jo.suspense=void 0===n?null:n;try{r(!1),t()}finally{Jo.suspense=e}})},[n,t]),t]}},Da=null,La=null,Ra=!1;function ja(e,t){var n=ql(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ba(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Ma(e){if(Ra){var t=La;if(t){var n=t;if(!Ba(e,t)){if(!(t=ir(n.nextSibling))||!Ba(e,t))return e.effectTag=-1025&e.effectTag|2,Ra=!1,void(Da=e);ja(Da,n)}Da=e,La=ir(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,Ra=!1,Da=e}}function Fa(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Da=e}function Ua(e){if(e!==Da)return!1;if(!Ra)return Fa(e),!(Ra=!0);var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!tr(t,e.memoizedProps))for(t=La;t;)ja(e,t),t=ir(t.nextSibling);if(Fa(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(L(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if(n===Yn){if(0===t){La=ir(e.nextSibling);break e}t--}else n!==Xn&&n!==$n&&n!==Jn||t++}e=e.nextSibling}La=null}}else La=Da?ir(e.stateNode.nextSibling):null;return!0}function qa(){La=Da=null,Ra=!1}var Ha=P.ReactCurrentOwner,za=!1;function Va(e,t,n,r){t.child=null===e?jo(t,null,n,r):Ro(t,e.child,n,r)}function Wa(e,t,n,r,i){n=n.render;var o=t.ref;return lo(t,i),r=da(e,t,n,r,o,i),null===e||za?(t.effectTag|=1,Va(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),ls(e,t,i))}function Ga(e,t,n,r,i,o){if(null===e){var a=n.type;return"function"!=typeof a||Hl(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Vl(n.type,null,r,null,t.mode,o)).ref=t.ref,(e.return=t).child=e):(t.tag=15,t.type=a,Ka(e,t,a,r,i,o))}return a=e.child,i<o&&(i=a.memoizedProps,(n=null!==(n=n.compare)?n:ei)(i,r)&&e.ref===t.ref)?ls(e,t,o):(t.effectTag|=1,(e=zl(a,r)).ref=t.ref,(e.return=t).child=e)}function Ka(e,t,n,r,i,o){return null!==e&&ei(e.memoizedProps,r)&&e.ref===t.ref&&(za=!1,i<o)?ls(e,t,o):Ya(e,t,n,r,o)}function Xa(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Ya(e,t,n,r,i){var o=yi(n)?gi:hi.current;return o=vi(t,o),lo(t,i),n=da(e,t,n,r,o,i),null===e||za?(t.effectTag|=1,Va(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),ls(e,t,i))}function Ja(e,t,n,r,i){if(yi(n)){var o=!0;xi(t)}else o=!1;if(lo(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),Ao(t,n,r),Oo(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,c=n.contextType;c="object"==typeof c&&null!==c?co(c):vi(t,c=yi(n)?gi:hi.current);var u=n.getDerivedStateFromProps,p="function"==typeof u||"function"==typeof a.getSnapshotBeforeUpdate;p||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==r||l!==c)&&No(t,a,r,c),uo=!1;var d=t.memoizedState;l=a.state=d;var f=t.updateQueue;null!==f&&(_o(t,f,r,a,i),l=t.memoizedState),s!==r||d!==l||mi.current||uo?("function"==typeof u&&(Co(t,n,u,r),l=t.memoizedState),(s=uo||To(t,n,s,r,d,l,c))?(p||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.effectTag|=4)):("function"==typeof a.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=s):("function"==typeof a.componentDidMount&&(t.effectTag|=4),r=!1)}else a=t.stateNode,s=t.memoizedProps,a.props=t.type===t.elementType?s:Zi(t.type,s),l=a.context,c="object"==typeof(c=n.contextType)&&null!==c?co(c):vi(t,c=yi(n)?gi:hi.current),(p="function"==typeof(u=n.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==r||l!==c)&&No(t,a,r,c),uo=!1,l=t.memoizedState,d=a.state=l,null!==(f=t.updateQueue)&&(_o(t,f,r,a,i),d=t.memoizedState),s!==r||l!==d||mi.current||uo?("function"==typeof u&&(Co(t,n,u,r),d=t.memoizedState),(u=uo||To(t,n,s,r,l,d,c))?(p||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,d,c),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,d,c)),"function"==typeof a.componentDidUpdate&&(t.effectTag|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=d),a.props=r,a.state=d,a.context=c,r=u):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),r=!1);return $a(e,t,n,r,o,i)}function $a(e,t,n,r,i,o){Xa(e,t);var a=0!=(64&t.effectTag);if(!r&&!a)return i&&Ei(t,n,!1),ls(e,t,o);r=t.stateNode,Ha.current=t;var s=a&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&a?(t.child=Ro(t,e.child,null,o),t.child=Ro(t,null,s,o)):Va(e,t,s,o),t.memoizedState=r.state,i&&Ei(t,n,!0),t.child}function Qa(e){var t=e.stateNode;t.pendingContext?wi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&wi(0,t.context,!1),Ho(e,t.containerInfo)}var Za,es,ts,ns,rs={dehydrated:null,retryTime:0};function is(e,t,n){var r,i=t.mode,o=t.pendingProps,a=Go.current,s=!1;if((r=0!=(64&t.effectTag))||(r=0!=(2&a)&&(null===e||null!==e.memoizedState)),r?(s=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(a|=1),di(Go,1&a),null===e){if(void 0!==o.fallback&&Ma(t),s){if(s=o.fallback,0==(2&((o=Wl(null,i,0,null)).return=t).mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(n=Wl(s,i,n,null)).return=t,o.sibling=n,t.memoizedState=rs,t.child=o,n}return i=o.children,t.memoizedState=null,t.child=jo(t,null,i,n)}if(null!==e.memoizedState){if(i=(e=e.child).sibling,s){if(o=o.fallback,0==(2&((n=zl(e,e.pendingProps)).return=t).mode)&&(s=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=s;null!==s;)s.return=n,s=s.sibling;return(i=zl(i,o,i.expirationTime)).return=t,n.sibling=i,n.childExpirationTime=0,t.memoizedState=rs,t.child=n,i}return n=Ro(t,e.child,o.children,n),t.memoizedState=null,t.child=n}if(e=e.child,s){if(s=o.fallback,(o=Wl(null,i,0,null)).return=t,null!==(o.child=e)&&(e.return=o),0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(n=Wl(s,i,n,null)).return=t,(o.sibling=n).effectTag|=2,o.childExpirationTime=0,t.memoizedState=rs,t.child=o,n}return t.memoizedState=null,t.child=Ro(t,e,o.children,n)}function os(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),so(e.return,t)}function as(e,t,n,r,i,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,last:r,tail:n,tailExpiration:0,tailMode:i,lastEffect:o}:(a.isBackwards=t,a.rendering=null,a.last=r,a.tail=n,a.tailExpiration=0,a.tailMode=i,a.lastEffect=o)}function ss(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Va(e,t,r.children,n),0!=(2&(r=Go.current)))r=1&r|2,t.effectTag|=64;else{if(null!==e&&0!=(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&os(e,n);else if(19===e.tag)os(e,n);else if(null!==e.child){e=(e.child.return=e).child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(di(Go,r),0==(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Ko(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),as(t,!1,i,n,o,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Ko(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}as(t,!0,n,null,o,t.lastEffect);break;case"together":as(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ls(e,t,n){null!==e&&(t.dependencies=e.dependencies);var r=t.expirationTime;if(0!==r&&Cl(r),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(L(153));if(null!==t.child){for(n=zl(e=t.child,e.pendingProps,e.expirationTime),(t.child=n).return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=zl(e,e.pendingProps,e.expirationTime)).return=t;n.sibling=null}return t.child}function cs(e){e.effectTag|=4}function us(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function ps(e){switch(e.tag){case 1:yi(e.type)&&bi();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(zo(),_i(),0!=(64&(t=e.effectTag)))throw Error(L(285));return e.effectTag=-4097&t|64,e;case 5:return Wo(e),null;case 13:return pi(Go),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return pi(Go),null;case 4:return zo(),null;case 10:return ao(e),null;default:return null}}function ds(e,t){return{value:e,source:t,stack:$(t)}}Za=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n=(n.child.return=n).child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},es=function(){},ts=function(e,t,n,r,i){var o=e.memoizedProps;if(o!==r){var a,s,l=t.stateNode;switch(qo(Mo.current),e=null,n){case"input":o=Ce(l,o),r=Ce(l,r),e=[];break;case"option":o=Pe(l,o),r=Pe(l,r),e=[];break;case"select":o=m({},o,{value:void 0}),r=m({},r,{value:void 0}),e=[];break;case"textarea":o=De(l,o),r=De(l,r),e=[];break;default:"function"!=typeof o.onClick&&"function"==typeof r.onClick&&(l.onclick=Hn)}for(a in Fn(n,r),n=null,o)if(!r.hasOwnProperty(a)&&o.hasOwnProperty(a)&&null!=o[a])if("style"===a)for(s in l=o[a])l.hasOwnProperty(s)&&(n||(n={}),n[s]="");else"dangerouslySetInnerHTML"!==a&&"children"!==a&&"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(g.hasOwnProperty(a)?e||(e=[]):(e=e||[]).push(a,null));for(a in r){var c=r[a];if(l=null!=o?o[a]:void 0,r.hasOwnProperty(a)&&c!==l&&(null!=c||null!=l))if("style"===a)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(e||(e=[]),e.push(a,n)),n=c;else"dangerouslySetInnerHTML"===a?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(e=e||[]).push(a,""+c)):"children"===a?l===c||"string"!=typeof c&&"number"!=typeof c||(e=e||[]).push(a,""+c):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&(g.hasOwnProperty(a)?(null!=c&&qn(i,a),e||l===c||(e=[])):(e=e||[]).push(a,c))}n&&(e=e||[]).push("style",n),i=e,(t.updateQueue=i)&&cs(t)}},ns=function(e,t,n,r){n!==r&&cs(t)};var fs="function"==typeof WeakSet?WeakSet:Set;function hs(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=$(n)),null!==n&&J(n.type),t=t.value,null!==e&&1===e.tag&&J(e.type);try{console.error(t)}catch(e){setTimeout(function(){throw e})}}function ms(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){jl(e,t)}else t.current=null}function gs(e,t){switch(t.tag){case 0:case 11:case 15:vs(2,0,t);break;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Zi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}break;case 3:case 5:case 6:case 4:case 17:break;default:throw Error(L(163))}}function vs(e,t,n){if(null!==(n=null!==(n=n.updateQueue)?n.lastEffect:null)){var r=n=n.next;do{if(0!=(r.tag&e)){var i=r.destroy;(r.destroy=void 0)!==i&&i()}0!=(r.tag&t)&&(i=r.create,r.destroy=i()),r=r.next}while(r!==n)}}function ys(e,r,t){switch("function"==typeof Fl&&Fl(r),r.tag){case 0:case 11:case 14:case 15:if(null!==(e=r.updateQueue)&&null!==(e=e.lastEffect)){var i=e.next;Gi(97<t?97:t,function(){var e=i;do{var t=e.destroy;if(void 0!==t){var n=r;try{t()}catch(e){jl(n,e)}}e=e.next}while(e!==i)})}break;case 1:ms(r),"function"==typeof(t=r.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){jl(e,t)}}(r,t);break;case 5:ms(r);break;case 4:ks(e,r,t)}}function bs(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,(e.memoizedProps=null)!==t&&bs(t)}function _s(e){return 5===e.tag||3===e.tag||4===e.tag}function ws(e){e:{for(var t=e.return;null!==t;){if(_s(t)){var n=t;break e}t=t.return}throw Error(L(160))}switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(L(161))}16&n.effectTag&&(ze(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||_s(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n=(n.child.return=n).child}if(!(2&n.effectTag)){n=n.stateNode;break e}}for(var i=e;;){var o=5===i.tag||6===i.tag;if(o){var a=o?i.stateNode:i.stateNode.instance;if(n)if(r){var s=a;a=n,8===(o=t).nodeType?o.parentNode.insertBefore(s,a):o.insertBefore(s,a)}else t.insertBefore(a,n);else r?(8===(s=t).nodeType?(o=s.parentNode).insertBefore(a,s):(o=s).appendChild(a),null!==(s=s._reactRootContainer)&&void 0!==s||null!==o.onclick||(o.onclick=Hn)):t.appendChild(a)}else if(4!==i.tag&&null!==i.child){i=(i.child.return=i).child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function ks(e,t,n){for(var r,i,o=t,a=!1;;){if(!a){a=o.return;e:for(;;){if(null===a)throw Error(L(160));switch(r=a.stateNode,a.tag){case 5:i=!1;break e;case 3:case 4:r=r.containerInfo,i=!0;break e}a=a.return}a=!0}if(5===o.tag||6===o.tag){e:for(var s=e,l=o,c=n,u=l;;)if(ys(s,u,c),null!==u.child&&4!==u.tag)u.child.return=u,u=u.child;else{if(u===l)break;for(;null===u.sibling;){if(null===u.return||u.return===l)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}i?(s=r,l=o.stateNode,8===s.nodeType?s.parentNode.removeChild(l):s.removeChild(l)):r.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){r=o.stateNode.containerInfo,i=!0,o=(o.child.return=o).child;continue}}else if(ys(e,o,n),null!==o.child){o=(o.child.return=o).child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(a=!1)}o.sibling.return=o.return,o=o.sibling}}function xs(e,t){switch(t.tag){case 0:case 11:case 14:case 15:vs(4,8,t);break;case 1:break;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,i=null!==e?e.memoizedProps:r;e=t.type;var o=t.updateQueue;if((t.updateQueue=null)!==o){for(n[lr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&Te(n,r),Un(e,i),t=Un(e,r),i=0;i<o.length;i+=2){var a=o[i],s=o[i+1];"style"===a?Bn(n,s):"dangerouslySetInnerHTML"===a?He(n,s):"children"===a?ze(n,s):we(n,a,s,t)}switch(e){case"input":Ae(n,r);break;case"textarea":Re(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(e=r.value)?Ie(n,!!r.multiple,e,!1):t!==!!r.multiple&&(null!=r.defaultValue?Ie(n,!!r.multiple,r.defaultValue,!0):Ie(n,!!r.multiple,r.multiple?[]:"",!1))}}}break;case 6:if(null===t.stateNode)throw Error(L(162));t.stateNode.nodeValue=t.memoizedProps;break;case 3:(t=t.stateNode).hydrate&&(t.hydrate=!1,Ct(t.containerInfo));break;case 12:break;case 13:if(null===(n=t).memoizedState?r=!1:(r=!0,n=t.child,Zs=zi()),null!==n)e:for(e=n;;){if(5===e.tag)o=e.stateNode,r?"function"==typeof(o=o.style).setProperty?o.setProperty("display","none","important"):o.display="none":(o=e.stateNode,i=void 0!==(i=e.memoizedProps.style)&&null!==i&&i.hasOwnProperty("display")?i.display:null,o.style.display=jn("display",i));else if(6===e.tag)e.stateNode.nodeValue=r?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(o=e.child.sibling).return=e,e=o;continue}if(null!==e.child){e=(e.child.return=e).child;continue}}if(e===n)break e;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}Es(t);break;case 19:Es(t);break;case 17:case 20:case 21:break;default:throw Error(L(163))}}function Es(n){var e=n.updateQueue;if(null!==e){n.updateQueue=null;var r=n.stateNode;null===r&&(r=n.stateNode=new fs),e.forEach(function(e){var t=function(e,t){var n=e.stateNode;null!==n&&n.delete(t),0==(t=0)&&(t=fl(t=dl(),e,null)),null!==(e=ml(e,t))&&vl(e)}.bind(null,n,e);r.has(e)||(r.add(e),e.then(t,t))})}}var Cs="function"==typeof WeakMap?WeakMap:Map;function Ss(e,t,n){(n=ho(n,null)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){nl||(nl=!0,rl=r),hs(e,t)},n}function Ts(t,n,e){(e=ho(e,null)).tag=3;var r=t.type.getDerivedStateFromError;if("function"==typeof r){var i=n.value;e.payload=function(){return hs(t,n),r(i)}}var o=t.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(e.callback=function(){"function"!=typeof r&&(null===il?il=new Set([this]):il.add(this),hs(t,n));var e=n.stack;this.componentDidCatch(n.value,{componentStack:null!==e?e:""})}),e}var As,Ns=Math.ceil,Os=P.ReactCurrentDispatcher,Ps=P.ReactCurrentOwner,Is=0,Ds=8,Ls=16,Rs=32,js=0,Bs=1,Ms=2,Fs=3,Us=4,qs=5,Hs=Is,zs=null,Vs=null,Ws=0,Gs=js,Ks=null,Xs=1073741823,Ys=1073741823,Js=null,$s=0,Qs=!1,Zs=0,el=500,tl=null,nl=!1,rl=null,il=null,ol=!1,al=null,sl=90,ll=null,cl=0,ul=null,pl=0;function dl(){return(Hs&(Ls|Rs))!==Is?1073741821-(zi()/10|0):0!==pl?pl:pl=1073741821-(zi()/10|0)}function fl(e,t,n){if(0==(2&(t=t.mode)))return 1073741823;var r=Vi();if(0==(4&t))return 99===r?1073741823:1073741822;if((Hs&Ls)!==Is)return Ws;if(null!==n)e=Qi(e,0|n.timeoutMs||5e3,250);else switch(r){case 99:e=1073741823;break;case 98:e=Qi(e,150,100);break;case 97:case 96:e=Qi(e,5e3,250);break;case 95:e=2;break;default:throw Error(L(326))}return null!==zs&&e===Ws&&--e,e}function hl(e,t){if(50<cl)throw cl=0,ul=null,Error(L(185));if(null!==(e=ml(e,t))){var n=Vi();1073741823===t?(Hs&Ds)!==Is&&(Hs&(Ls|Rs))===Is?yl(e):(vl(e),Hs===Is&&Yi()):vl(e),(4&Hs)===Is||98!==n&&99!==n||(null===ll?ll=new Map([[e,t]]):(void 0===(n=ll.get(e))||t<n)&&ll.set(e,t))}}function ml(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,i=null;if(null===r&&3===e.tag)i=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){i=r.stateNode;break}r=r.return}return null!==i&&(zs===i&&(Cl(t),Gs===Us&&Jl(i,Ws)),$l(i,t)),i}function gl(e){var t=e.lastExpiredTime;return 0!==t?t:Yl(e,t=e.firstPendingTime)?(t=e.lastPingedTime)>(e=e.nextKnownPendingLevel)?t:e:t}function vl(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=Xi(yl.bind(null,e));else{var t=gl(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var r=dl();if(r=1073741823===t?99:1===t||2===t?95:(r=10*(1073741821-t)-10*(1073741821-r))<=0?99:r<=250?98:r<=5250?97:95,null!==n){var i=e.callbackPriority;if(e.callbackExpirationTime===t&&r<=i)return;n!==Bi&&Ti(n)}e.callbackExpirationTime=t,e.callbackPriority=r,t=1073741823===t?Xi(yl.bind(null,e)):Ki(r,function e(t,n){if(pl=0,n)return Ql(t,n=dl()),vl(t),null;var r=gl(t);if(0!==r){if(n=t.callbackNode,(Hs&(Ls|Rs))!==Is)throw Error(L(327));if(Dl(),t===zs&&r===Ws||wl(t,r),null!==Vs){var i=Hs;Hs|=Ls;for(var o=xl();;)try{Tl();break}catch(n){kl(t,n)}if(io(),Hs=i,Os.current=o,Gs===Bs)throw n=Ks,wl(t,r),Jl(t,r),vl(t),n;if(null===Vs)switch(o=t.finishedWork=t.current.alternate,t.finishedExpirationTime=r,i=Gs,zs=null,i){case js:case Bs:throw Error(L(345));case Ms:Ql(t,2<r?2:r);break;case Fs:if(Jl(t,r),r===(i=t.lastSuspendedTime)&&(t.nextKnownPendingLevel=Ol(o)),1073741823===Xs&&10<(o=Zs+el-zi())){if(Qs){var a=t.lastPingedTime;if(0===a||r<=a){t.lastPingedTime=r,wl(t,r);break}}if(0!==(a=gl(t))&&a!==r)break;if(0!==i&&i!==r){t.lastPingedTime=i;break}t.timeoutHandle=nr(Pl.bind(null,t),o);break}Pl(t);break;case Us:if(Jl(t,r),r===(i=t.lastSuspendedTime)&&(t.nextKnownPendingLevel=Ol(o)),Qs&&(0===(o=t.lastPingedTime)||r<=o)){t.lastPingedTime=r,wl(t,r);break}if(0!==(o=gl(t))&&o!==r)break;if(0!==i&&i!==r){t.lastPingedTime=i;break}if(1073741823!==Ys?i=10*(1073741821-Ys)-zi():1073741823===Xs?i=0:(i=10*(1073741821-Xs)-5e3,r=10*(1073741821-r)-(o=zi()),(i=o-i)<0&&(i=0),r<(i=(i<120?120:i<480?480:i<1080?1080:i<1920?1920:i<3e3?3e3:i<4320?4320:1960*Ns(i/1960))-i)&&(i=r)),10<i){t.timeoutHandle=nr(Pl.bind(null,t),i);break}Pl(t);break;case qs:if(1073741823!==Xs&&null!==Js){a=Xs;var s=Js;if((i=0|s.busyMinDurationMs)<=0?i=0:(o=0|s.busyDelayMs,i=(a=zi()-(10*(1073741821-a)-(0|s.timeoutMs||5e3)))<=o?0:o+i-a),10<i){Jl(t,r),t.timeoutHandle=nr(Pl.bind(null,t),i);break}}Pl(t);break;default:throw Error(L(329))}if(vl(t),t.callbackNode===n)return e.bind(null,t)}}return null}.bind(null,e),{timeout:10*(1073741821-t)-zi()}),e.callbackNode=t}}}function yl(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,e.finishedExpirationTime===t)Pl(e);else{if((Hs&(Ls|Rs))!==Is)throw Error(L(327));if(Dl(),e===zs&&t===Ws||wl(e,t),null!==Vs){var n=Hs;Hs|=Ls;for(var r=xl();;)try{Sl();break}catch(t){kl(e,t)}if(io(),Hs=n,Os.current=r,Gs===Bs)throw n=Ks,wl(e,t),Jl(e,t),vl(e),n;if(null!==Vs)throw Error(L(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,zs=null,Pl(e),vl(e)}}return null}function bl(e,t){var n=Hs;Hs|=1;try{return e(t)}finally{(Hs=n)===Is&&Yi()}}function _l(e,t){var n=Hs;Hs&=-2,Hs|=Ds;try{return e(t)}finally{(Hs=n)===Is&&Yi()}}function wl(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Vs)for(n=Vs.return;null!==n;){var r=n;switch(r.tag){case 1:var i=r.type.childContextTypes;null!=i&&bi();break;case 3:zo(),_i();break;case 5:Wo(r);break;case 4:zo();break;case 13:case 19:pi(Go);break;case 10:ao(r)}n=n.return}Vs=zl((zs=e).current,null),Ws=t,Gs=js,Ys=Xs=1073741823,Js=Ks=null,$s=0,Qs=!1}function kl(e,t){for(;;){try{if(io(),fa(),null===Vs||null===Vs.return)return Gs=Bs,Ks=t,null;e:{var n=e,r=Vs.return,i=Vs,o=t;if(t=Ws,i.effectTag|=2048,i.firstEffect=i.lastEffect=null,null!==o&&"object"==typeof o&&"function"==typeof o.then){var a=o,s=0!=(1&Go.current),l=r;do{var c;if(c=13===l.tag){var u=l.memoizedState;if(null!==u)c=null!==u.dehydrated;else{var p=l.memoizedProps;c=void 0!==p.fallback&&(!0!==p.unstable_avoidThisFallback||!s)}}if(c){var d=l.updateQueue;if(null===d){var f=new Set;f.add(a),l.updateQueue=f}else d.add(a);if(0==(2&l.mode)){if(l.effectTag|=64,i.effectTag&=-2981,1===i.tag)if(null===i.alternate)i.tag=17;else{var h=ho(1073741823,null);h.tag=2,go(i,h)}i.expirationTime=1073741823;break e}o=void 0,i=t;var m=n.pingCache;if(null===m?(m=n.pingCache=new Cs,o=new Set,m.set(a,o)):void 0===(o=m.get(a))&&(o=new Set,m.set(a,o)),!o.has(i)){o.add(i);var g=Bl.bind(null,n,a,i);a.then(g,g)}l.effectTag|=4096,l.expirationTime=t;break e}l=l.return}while(null!==l);o=Error((J(i.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+$(i))}Gs!==qs&&(Gs=Ms),o=ds(o,i),l=r;do{switch(l.tag){case 3:a=o,l.effectTag|=4096,l.expirationTime=t,vo(l,Ss(l,a,t));break e;case 1:a=o;var v=l.type,y=l.stateNode;if(0==(64&l.effectTag)&&("function"==typeof v.getDerivedStateFromError||null!==y&&"function"==typeof y.componentDidCatch&&(null===il||!il.has(y)))){l.effectTag|=4096,l.expirationTime=t,vo(l,Ts(l,a,t));break e}}l=l.return}while(null!==l)}Vs=Nl(Vs)}catch(e){t=e;continue}break}}function xl(){var e=Os.current;return Os.current=Oa,null===e?Oa:e}function El(e,t){e<Xs&&2<e&&(Xs=e),null!==t&&e<Ys&&2<e&&(Ys=e,Js=t)}function Cl(e){$s<e&&($s=e)}function Sl(){for(;null!==Vs;)Vs=Al(Vs)}function Tl(){for(;null!==Vs&&!Ai();)Vs=Al(Vs)}function Al(e){var t=As(e.alternate,e,Ws);return e.memoizedProps=e.pendingProps,null===t&&(t=Nl(e)),Ps.current=null,t}function Nl(e){Vs=e;do{var t=Vs.alternate;if(e=Vs.return,0==(2048&Vs.effectTag)){e:{var n=t,r=Ws,i=(t=Vs).pendingProps;switch(t.tag){case 2:case 16:break;case 15:case 0:break;case 1:yi(t.type)&&bi();break;case 3:zo(),_i(),(i=t.stateNode).pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(null===n||null===n.child)&&Ua(t)&&cs(t),es(t);break;case 5:Wo(t),r=qo(Uo.current);var o=t.type;if(null!==n&&null!=t.stateNode)ts(n,t,o,i,r),n.ref!==t.ref&&(t.effectTag|=128);else if(i){var a=qo(Mo.current);if(Ua(t)){var s=(i=t).stateNode;n=i.type;var l=i.memoizedProps,c=r;switch(s[sr]=i,s[lr]=l,o=void 0,r=s,n){case"iframe":case"object":case"embed":Cn("load",r);break;case"video":case"audio":for(s=0;s<Ze.length;s++)Cn(Ze[s],r);break;case"source":Cn("error",r);break;case"img":case"image":case"link":Cn("error",r),Cn("load",r);break;case"form":Cn("reset",r),Cn("submit",r);break;case"details":Cn("toggle",r);break;case"input":Se(r,l),Cn("invalid",r),qn(c,"onChange");break;case"select":r._wrapperState={wasMultiple:!!l.multiple},Cn("invalid",r),qn(c,"onChange");break;case"textarea":Le(r,l),Cn("invalid",r),qn(c,"onChange")}for(o in Fn(n,l),s=null,l)l.hasOwnProperty(o)&&(a=l[o],"children"===o?"string"==typeof a?r.textContent!==a&&(s=["children",a]):"number"==typeof a&&r.textContent!==""+a&&(s=["children",""+a]):g.hasOwnProperty(o)&&null!=a&&qn(c,o));switch(n){case"input":xe(r),Ne(r,l,!0);break;case"textarea":xe(r),je(r);break;case"select":case"option":break;default:"function"==typeof l.onClick&&(r.onclick=Hn)}o=s,i.updateQueue=o,(i=null!==o)&&cs(t)}else{n=t,c=o,l=i,s=9===r.nodeType?r:r.ownerDocument,a===Be.html&&(a=Me(c)),a===Be.html?"script"===c?((l=s.createElement("div")).innerHTML="<script><\/script>",s=l.removeChild(l.firstChild)):"string"==typeof l.is?s=s.createElement(c,{is:l.is}):(s=s.createElement(c),"select"===c&&(c=s,l.multiple?c.multiple=!0:l.size&&(c.size=l.size))):s=s.createElementNS(a,c),(l=s)[sr]=n,l[lr]=i,Za(l,t,!1,!1),t.stateNode=l;var u=r,p=Un(c=o,n=i);switch(c){case"iframe":case"object":case"embed":Cn("load",l),r=n;break;case"video":case"audio":for(r=0;r<Ze.length;r++)Cn(Ze[r],l);r=n;break;case"source":Cn("error",l),r=n;break;case"img":case"image":case"link":Cn("error",l),Cn("load",l),r=n;break;case"form":Cn("reset",l),Cn("submit",l),r=n;break;case"details":Cn("toggle",l),r=n;break;case"input":Se(l,n),r=Ce(l,n),Cn("invalid",l),qn(u,"onChange");break;case"option":r=Pe(l,n);break;case"select":l._wrapperState={wasMultiple:!!n.multiple},r=m({},n,{value:void 0}),Cn("invalid",l),qn(u,"onChange");break;case"textarea":Le(l,n),r=De(l,n),Cn("invalid",l),qn(u,"onChange");break;default:r=n}Fn(c,r),s=void 0,a=c;var d=l,f=r;for(s in f)if(f.hasOwnProperty(s)){var h=f[s];"style"===s?Bn(d,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&He(d,h):"children"===s?"string"==typeof h?("textarea"!==a||""!==h)&&ze(d,h):"number"==typeof h&&ze(d,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(g.hasOwnProperty(s)?null!=h&&qn(u,s):null!=h&&we(d,s,h,p))}switch(c){case"input":xe(l),Ne(l,n,!1);break;case"textarea":xe(l),je(l);break;case"option":null!=n.value&&l.setAttribute("value",""+_e(n.value));break;case"select":(r=l).multiple=!!n.multiple,null!=(l=n.value)?Ie(r,!!n.multiple,l,!1):null!=n.defaultValue&&Ie(r,!!n.multiple,n.defaultValue,!0);break;default:"function"==typeof r.onClick&&(l.onclick=Hn)}(i=er(o,i))&&cs(t)}null!==t.ref&&(t.effectTag|=128)}else if(null===t.stateNode)throw Error(L(166));break;case 6:if(n&&null!=t.stateNode)ns(n,t,n.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(L(166));r=qo(Uo.current),qo(Mo.current),Ua(t)?(o=(i=t).stateNode,r=i.memoizedProps,o[sr]=i,(i=o.nodeValue!==r)&&cs(t)):(o=t,(i=(9===r.nodeType?r:r.ownerDocument).createTextNode(i))[sr]=o,t.stateNode=i)}break;case 11:break;case 13:if(pi(Go),i=t.memoizedState,0!=(64&t.effectTag)){t.expirationTime=r;break e}i=null!==i,o=!1,null===n?void 0!==t.memoizedProps.fallback&&Ua(t):(o=null!==(r=n.memoizedState),i||null===r||null!==(r=n.child.sibling)&&(null!==(l=t.firstEffect)?(t.firstEffect=r).nextEffect=l:(t.firstEffect=t.lastEffect=r,r.nextEffect=null),r.effectTag=8)),i&&!o&&0!=(2&t.mode)&&(null===n&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Go.current)?Gs===js&&(Gs=Fs):(Gs!==js&&Gs!==Fs||(Gs=Us),0!==$s&&null!==zs&&(Jl(zs,Ws),$l(zs,$s)))),(i||o)&&(t.effectTag|=4);break;case 7:case 8:case 12:break;case 4:zo(),es(t);break;case 10:ao(t);break;case 9:case 14:break;case 17:yi(t.type)&&bi();break;case 19:if(pi(Go),null===(i=t.memoizedState))break;if(o=0!=(64&t.effectTag),null===(l=i.rendering)){if(o)us(i,!1);else if(Gs!==js||null!==n&&0!=(64&n.effectTag))for(n=t.child;null!==n;){if(null!==(l=Ko(n))){for(t.effectTag|=64,us(i,!1),null!==(o=l.updateQueue)&&(t.updateQueue=o,t.effectTag|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,i=r,o=t.child;null!==o;)n=i,(r=o).effectTag&=2,r.nextEffect=null,r.firstEffect=null,(r.lastEffect=null)===(l=r.alternate)?(r.childExpirationTime=0,r.expirationTime=n,r.child=null,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null):(r.childExpirationTime=l.childExpirationTime,r.expirationTime=l.expirationTime,r.child=l.child,r.memoizedProps=l.memoizedProps,r.memoizedState=l.memoizedState,r.updateQueue=l.updateQueue,n=l.dependencies,r.dependencies=null===n?null:{expirationTime:n.expirationTime,firstContext:n.firstContext,responders:n.responders}),o=o.sibling;di(Go,1&Go.current|2),t=t.child;break e}n=n.sibling}}else{if(!o)if(null!==(n=Ko(l))){if(t.effectTag|=64,o=!0,null!==(r=n.updateQueue)&&(t.updateQueue=r,t.effectTag|=4),us(i,!0),null===i.tail&&"hidden"===i.tailMode){null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null);break}}else zi()>i.tailExpiration&&1<r&&(t.effectTag|=64,us(i,!(o=!0)),t.expirationTime=t.childExpirationTime=r-1);i.isBackwards?(l.sibling=t.child,t.child=l):(null!==(r=i.last)?r.sibling=l:t.child=l,i.last=l)}if(null!==i.tail){0===i.tailExpiration&&(i.tailExpiration=zi()+500),r=i.tail,i.rendering=r,i.tail=r.sibling,i.lastEffect=t.lastEffect,r.sibling=null,i=Go.current,di(Go,i=o?1&i|2:1&i),t=r;break e}break;case 20:case 21:break;default:throw Error(L(156,t.tag))}t=null}if(i=Vs,1===Ws||1!==i.childExpirationTime){for(o=0,r=i.child;null!==r;)o<(n=r.expirationTime)&&(o=n),o<(l=r.childExpirationTime)&&(o=l),r=r.sibling;i.childExpirationTime=o}if(null!==t)return t;null!==e&&0==(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=Vs.firstEffect),null!==Vs.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=Vs.firstEffect),e.lastEffect=Vs.lastEffect),1<Vs.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=Vs:e.firstEffect=Vs,e.lastEffect=Vs))}else{if(null!==(t=ps(Vs)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=Vs.sibling))return t;Vs=e}while(null!==Vs);return Gs===js&&(Gs=qs),null}function Ol(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function Pl(e){var t=Vi();return Gi(99,function(e,t){if(Dl(),(Hs&(Ls|Rs))!==Is)throw Error(L(327));var n=e.finishedWork,r=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(L(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var i=Ol(n);if(e.firstPendingTime=i,r<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:r<=e.firstSuspendedTime&&(e.firstSuspendedTime=r-1),r<=e.lastPingedTime&&(e.lastPingedTime=0),r<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===zs&&(Vs=zs=null,Ws=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){var o=Hs;Hs|=Rs,Ps.current=null,Qn=En;var a=Gn();if(Kn(a)){if("selectionStart"in a)var s={start:a.selectionStart,end:a.selectionEnd};else e:{var l=(s=(s=a.ownerDocument)&&s.defaultView||window).getSelection&&s.getSelection();if(l&&0!==l.rangeCount){s=l.anchorNode;var c=l.anchorOffset,u=l.focusNode;l=l.focusOffset;try{s.nodeType,u.nodeType}catch(e){s=null;break e}var p=0,d=-1,f=-1,h=0,m=0,g=a,v=null;t:for(;;){for(var y;g!==s||0!==c&&3!==g.nodeType||(d=p+c),g!==u||0!==l&&3!==g.nodeType||(f=p+l),3===g.nodeType&&(p+=g.nodeValue.length),null!==(y=g.firstChild);)v=g,g=y;for(;;){if(g===a)break t;if(v===s&&++h===c&&(d=p),v===u&&++m===l&&(f=p),null!==(y=g.nextSibling))break;v=(g=v).parentNode}g=y}s=-1===d||-1===f?null:{start:d,end:f}}else s=null}s=s||{start:0,end:0}}else s=null;En=!(Zn={focusedElem:a,selectionRange:s}),tl=i;do{try{Il()}catch(e){if(null===tl)throw Error(L(330));jl(tl,e),tl=tl.nextEffect}}while(null!==tl);tl=i;do{try{for(a=e,s=t;null!==tl;){var b=tl.effectTag;if(16&b&&ze(tl.stateNode,""),128&b){var _=tl.alternate;if(null!==_){var w=_.ref;null!==w&&("function"==typeof w?w(null):w.current=null)}}switch(1038&b){case 2:ws(tl),tl.effectTag&=-3;break;case 6:ws(tl),tl.effectTag&=-3,xs(tl.alternate,tl);break;case 1024:tl.effectTag&=-1025;break;case 1028:tl.effectTag&=-1025,xs(tl.alternate,tl);break;case 4:xs(tl.alternate,tl);break;case 8:ks(a,c=tl,s),bs(c)}tl=tl.nextEffect}}catch(e){if(null===tl)throw Error(L(330));jl(tl,e),tl=tl.nextEffect}}while(null!==tl);if(w=Zn,_=Gn(),b=w.focusedElem,s=w.selectionRange,_!==b&&b&&b.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(b.ownerDocument.documentElement,b)){null!==s&&Kn(b)&&(_=s.start,void 0===(w=s.end)&&(w=_),"selectionStart"in b?(b.selectionStart=_,b.selectionEnd=Math.min(w,b.value.length)):(w=(_=b.ownerDocument||document)&&_.defaultView||window).getSelection&&(w=w.getSelection(),c=b.textContent.length,a=Math.min(s.start,c),s=void 0===s.end?a:Math.min(s.end,c),!w.extend&&s<a&&(c=s,s=a,a=c),c=Wn(b,a),u=Wn(b,s),c&&u&&(1!==w.rangeCount||w.anchorNode!==c.node||w.anchorOffset!==c.offset||w.focusNode!==u.node||w.focusOffset!==u.offset)&&((_=_.createRange()).setStart(c.node,c.offset),w.removeAllRanges(),s<a?(w.addRange(_),w.extend(u.node,u.offset)):(_.setEnd(u.node,u.offset),w.addRange(_))))),_=[];for(w=b;w=w.parentNode;)1===w.nodeType&&_.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"==typeof b.focus&&b.focus(),b=0;b<_.length;b++)(w=_[b]).element.scrollLeft=w.left,w.element.scrollTop=w.top}En=!!Qn,Qn=Zn=null,e.current=n,tl=i;do{try{for(b=r;null!==tl;){var k=tl.effectTag;if(36&k){var x=tl.alternate;switch(w=b,(_=tl).tag){case 0:case 11:case 15:vs(16,32,_);break;case 1:var E=_.stateNode;if(4&_.effectTag)if(null===x)E.componentDidMount();else{var C=_.elementType===_.type?x.memoizedProps:Zi(_.type,x.memoizedProps);E.componentDidUpdate(C,x.memoizedState,E.__reactInternalSnapshotBeforeUpdate)}var S=_.updateQueue;null!==S&&wo(0,S,E);break;case 3:var T=_.updateQueue;if(null!==T){if((a=null)!==_.child)switch(_.child.tag){case 5:a=_.child.stateNode;break;case 1:a=_.child.stateNode}wo(0,T,a)}break;case 5:var A=_.stateNode;null===x&&4&_.effectTag&&er(_.type,_.memoizedProps)&&A.focus();break;case 6:case 4:case 12:break;case 13:if(null===_.memoizedState){var N=_.alternate;if(null!==N){var O=N.memoizedState;if(null!==O){var P=O.dehydrated;null!==P&&Ct(P)}}}break;case 19:case 17:case 20:case 21:break;default:throw Error(L(163))}}if(128&k){_=void 0;var I=tl.ref;if(null!==I){var D=tl.stateNode;switch(tl.tag){case 5:_=D;break;default:_=D}"function"==typeof I?I(_):I.current=_}}tl=tl.nextEffect}}catch(e){if(null===tl)throw Error(L(330));jl(tl,e),tl=tl.nextEffect}}while(null!==tl);tl=null,Mi(),Hs=o}else e.current=n;if(ol)ol=!1,al=e,sl=t;else for(tl=i;null!==tl;)t=tl.nextEffect,tl.nextEffect=null,tl=t;if(0===(t=e.firstPendingTime)&&(il=null),1073741823===t?e===ul?cl++:(cl=0,ul=e):cl=0,"function"==typeof Ml&&Ml(n.stateNode,r),vl(e),nl)throw nl=!1,e=rl,rl=null,e;return(Hs&Ds)!==Is||Yi(),null}.bind(null,e,t)),null}function Il(){for(;null!==tl;){var e=tl.effectTag;0!=(256&e)&&gs(tl.alternate,tl),0==(512&e)||ol||(ol=!0,Ki(97,function(){return Dl(),null})),tl=tl.nextEffect}}function Dl(){if(90!==sl){var e=97<sl?97:sl;return sl=90,Gi(e,Ll)}}function Ll(){if(null===al)return!1;var e=al;if(al=null,(Hs&(Ls|Rs))!==Is)throw Error(L(331));var t=Hs;for(Hs|=Rs,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!=(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:vs(128,0,n),vs(0,64,n)}}catch(t){if(null===e)throw Error(L(330));jl(e,t)}n=e.nextEffect,e.nextEffect=null,e=n}return Hs=t,Yi(),!0}function Rl(e,t,n){go(e,t=Ss(e,t=ds(n,t),1073741823)),null!==(e=ml(e,1073741823))&&vl(e)}function jl(e,t){if(3===e.tag)Rl(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Rl(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===il||!il.has(r))){go(n,e=Ts(n,e=ds(t,e),1073741823)),null!==(n=ml(n,1073741823))&&vl(n);break}}n=n.return}}function Bl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),zs===e&&Ws===n?Gs===Us||Gs===Fs&&1073741823===Xs&&zi()-Zs<el?wl(e,Ws):Qs=!0:Yl(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,e.finishedExpirationTime===n&&(e.finishedExpirationTime=0,e.finishedWork=null),vl(e)))}As=function(e,t,n){var r=t.expirationTime;if(null!==e){var i=t.pendingProps;if(e.memoizedProps!==i||mi.current)za=!0;else{if(r<n){switch(za=!1,t.tag){case 3:Qa(t),qa();break;case 5:if(Vo(t),4&t.mode&&1!==n&&i.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:yi(t.type)&&xi(t);break;case 4:Ho(t,t.stateNode.containerInfo);break;case 10:oo(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&n<=r?is(e,t,n):(di(Go,1&Go.current),null!==(t=ls(e,t,n))?t.sibling:null);di(Go,1&Go.current);break;case 19:if(r=t.childExpirationTime>=n,0!=(64&e.effectTag)){if(r)return ss(e,t,n);t.effectTag|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null),di(Go,Go.current),!r)return null}return ls(e,t,n)}za=!1}}else za=!1;switch(t.expirationTime=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,i=vi(t,hi.current),lo(t,n),i=da(null,t,r,e,i,n),t.effectTag|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof){if(t.tag=1,fa(),yi(r)){var o=!0;xi(t)}else o=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null;var a=r.getDerivedStateFromProps;"function"==typeof a&&Co(t,r,a,e),i.updater=So,Oo((t.stateNode=i)._reactInternalFiber=t,r,e,n),t=$a(null,t,r,!0,o,n)}else t.tag=0,Va(null,t,i,n),t=t.child;return t;case 16:if(i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(t){if(-1===t._status){t._status=0;var e=t._ctor;e=e(),(t._result=e).then(function(e){0===t._status&&(e=e.default,t._status=1,t._result=e)},function(e){0===t._status&&(t._status=2,t._result=e)})}}(i),1!==i._status)throw i._result;switch(i=i._result,t.type=i,o=t.tag=function(e){if("function"==typeof e)return Hl(e)?1:0;if(null!=e){if((e=e.$$typeof)===z)return 11;if(e===G)return 14}return 2}(i),e=Zi(i,e),o){case 0:t=Ya(null,t,i,e,n);break;case 1:t=Ja(null,t,i,e,n);break;case 11:t=Wa(null,t,i,e,n);break;case 14:t=Ga(null,t,i,Zi(i.type,e),r,n);break;default:throw Error(L(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ya(e,t,r,i=t.elementType===r?i:Zi(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ja(e,t,r,i=t.elementType===r?i:Zi(r,i),n);case 3:if(Qa(t),null===(r=t.updateQueue))throw Error(L(282));if(i=null!==(i=t.memoizedState)?i.element:null,_o(t,r,t.pendingProps,null,n),(r=t.memoizedState.element)===i)qa(),t=ls(e,t,n);else{if((i=t.stateNode.hydrate)&&(La=ir(t.stateNode.containerInfo.firstChild),Da=t,i=Ra=!0),i)for(n=jo(t,null,r,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else Va(e,t,r,n),qa();t=t.child}return t;case 5:return Vo(t),null===e&&Ma(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,a=i.children,tr(r,i)?a=null:null!==o&&tr(r,o)&&(t.effectTag|=16),Xa(e,t),4&t.mode&&1!==n&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Va(e,t,a,n),t=t.child),t;case 6:return null===e&&Ma(t),null;case 13:return is(e,t,n);case 4:return Ho(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ro(t,null,r,n):Va(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Wa(e,t,r,i=t.elementType===r?i:Zi(r,i),n);case 7:return Va(e,t,t.pendingProps,n),t.child;case 8:case 12:return Va(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,oo(t,o=i.value),null!==a){var s=a.value;if(0==(o=Qr(s,o)?0:0|("function"==typeof r._calculateChangedBits?r._calculateChangedBits(s,o):1073741823))){if(a.children===i.children&&!mi.current){t=ls(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r&&0!=(c.observedBits&o)){1===s.tag&&((c=ho(n,null)).tag=2,go(s,c)),s.expirationTime<n&&(s.expirationTime=n),null!==(c=s.alternate)&&c.expirationTime<n&&(c.expirationTime=n),so(s.return,n),l.expirationTime<n&&(l.expirationTime=n);break}c=c.next}}else a=10===s.tag&&s.type===t.type?null:s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}}Va(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(o=t.pendingProps).children,lo(t,n),r=r(i=co(i,o.unstable_observedBits)),t.effectTag|=1,Va(e,t,r,n),t.child;case 14:return o=Zi(i=t.type,t.pendingProps),Ga(e,t,i,o=Zi(i.type,o),r,n);case 15:return Ka(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Zi(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,yi(r)?(e=!0,xi(t)):e=!1,lo(t,n),Ao(t,r,i),Oo(t,r,i,n),$a(null,t,r,!0,e,n);case 19:return ss(e,t,n)}throw Error(L(156,t.tag))};var Ml=null,Fl=null;function Ul(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function ql(e,t,n,r){return new Ul(e,t,n,r)}function Hl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zl(e,t){var n=e.alternate;return null===n?((n=ql(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,(n.alternate=e).alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Vl(e,t,n,r,i,o){var a=2;if("function"==typeof(r=e))Hl(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case B:return Wl(n.children,i,o,t);case H:a=8,i|=7;break;case M:a=8,i|=1;break;case F:return(e=ql(12,n,t,8|i)).elementType=F,e.type=F,e.expirationTime=o,e;case V:return(e=ql(13,n,t,i)).type=V,e.elementType=V,e.expirationTime=o,e;case W:return(e=ql(19,n,t,i)).elementType=W,e.expirationTime=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case U:a=10;break e;case q:a=9;break e;case z:a=11;break e;case G:a=14;break e;case K:a=16,r=null;break e}throw Error(L(130,null==e?e:typeof e,""))}return(t=ql(a,n,t,i)).elementType=e,t.type=r,t.expirationTime=o,t}function Wl(e,t,n,r){return(e=ql(7,e,r,t)).expirationTime=n,e}function Gl(e,t,n){return(e=ql(6,e,null,t)).expirationTime=n,e}function Kl(e,t,n){return(t=ql(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Xl(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Yl(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&t<=n&&e<=t}function Jl(e,t){var n=e.firstSuspendedTime,r=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(t<r||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function $l(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(n<=t?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Ql(e,t){var n=e.lastExpiredTime;(0===n||t<n)&&(e.lastExpiredTime=t)}function Zl(e,t,n,r){var i=t.current,o=dl(),a=xo.suspense;o=fl(o,i,a);e:if(n){t:{if(et(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(L(170));var s=n;do{switch(s.tag){case 3:s=s.stateNode.context;break t;case 1:if(yi(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break t}}s=s.return}while(null!==s);throw Error(L(171))}if(1===n.tag){var l=n.type;if(yi(l)){n=ki(n,l,s);break e}}n=s}else n=fi;return null===t.context?t.context=n:t.pendingContext=n,(t=ho(o,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),go(i,t),hl(i,o),o}function ec(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function tc(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function nc(e,t){tc(e,t),(e=e.alternate)&&tc(e,t)}function rc(e,t,n){var r,i,o=new Xl(e,t,n=null!=n&&!0===n.hydrate),a=ql(3,null,null,2===t?7:1===t?3:0);(o.current=a).stateNode=o,e[cr]=o.current,n&&0!==t&&(r=9===e.nodeType?e:e.ownerDocument,i=In(r),mt.forEach(function(e){Dn(e,r,i)}),gt.forEach(function(e){Dn(e,r,i)})),this._internalRoot=o}function ic(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function oc(e,t,n,r,i){var o=n._reactRootContainer;if(o){var a=o._internalRoot;if("function"==typeof i){var s=i;i=function(){var e=ec(a);s.call(e)}}Zl(t,a,e,i)}else{if(o=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new rc(e,0,t?{hydrate:!0}:void 0)}(n,r),a=o._internalRoot,"function"==typeof i){var l=i;i=function(){var e=ec(a);l.call(e)}}_l(function(){Zl(t,a,e,i)})}return ec(a)}function ac(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!ic(t))throw Error(L(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:j,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}it=function(e){if(13===e.tag){var t=Qi(dl(),150,100);hl(e,t),nc(e,t)}},ot=function(e){if(13===e.tag){dl();var t=$i++;hl(e,t),nc(e,t)}},at=function(e){if(13===e.tag){var t=dl();hl(e,t=fl(t,e,null)),nc(e,t)}},Z=function(e,t,n){switch(t){case"input":if(Ae(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=fr(r);if(!i)throw Error(L(90));Ee(r),Ae(r,i)}}}break;case"textarea":Re(e,n);break;case"select":null!=(t=n.value)&&Ie(e,!!n.multiple,t,!1)}},rc.prototype.render=function(e,t){Zl(e,this._internalRoot,null,void 0===t?null:t)},rc.prototype.unmount=function(e){Zl(null,this._internalRoot,null,void 0===e?null:e)},ae=function(e,t,n,r){var i=Hs;Hs|=4;try{return Gi(98,e.bind(null,t,n,r))}finally{(Hs=i)===Is&&Yi()}},se=function(){(Hs&(1|Ls|Rs))===Is&&(function(){if(null!==ll){var e=ll;ll=null,e.forEach(function(e,t){Ql(t,e),vl(t)}),Yi()}}(),Dl())};var sc,lc,cc={createPortal:ac,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"==typeof e.render)throw Error(L(188));throw Error(L(268,Object.keys(e)))}return null===(e=rt(t))?null:e.stateNode},hydrate:function(e,t,n){if(!ic(t))throw Error(L(200));return oc(null,e,t,!0,n)},render:function(e,t,n){if(!ic(t))throw Error(L(200));return oc(null,e,t,!1,n)},unstable_renderSubtreeIntoContainer:function(e,t,n,r){if(!ic(n))throw Error(L(200));if(null==e||void 0===e._reactInternalFiber)throw Error(L(38));return oc(e,t,n,!1,r)},unmountComponentAtNode:function(e){if(!ic(e))throw Error(L(40));return!!e._reactRootContainer&&(_l(function(){oc(null,null,e,!1,function(){e._reactRootContainer=null})}),!0)},unstable_createPortal:function(){return ac.apply(void 0,arguments)},unstable_batchedUpdates:oe=bl,flushSync:function(e,t){if((Hs&(Ls|Rs))!==Is)throw Error(L(187));var n=Hs;Hs|=1;try{return Gi(99,e.bind(null,t))}finally{Hs=n,Yi()}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[pr,dr,fr,N.injectEventPluginsByName,f,It,function(e){C(e,Pt)},re,ie,An,A,Dl,{current:!(le=function(e,t){var n=Hs;Hs|=2;try{return e(t)}finally{(Hs=n)===Is&&Yi()}})}]}};lc=(sc={findFiberByHostInstance:ur,bundleType:0,version:"16.11.0",rendererPackageName:"react-dom"}).findFiberByHostInstance,function(e){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t.isDisabled&&t.supportsFiber)try{var n=t.inject(e);Ml=function(e){try{t.onCommitFiberRoot(n,e,void 0,64==(64&e.current.effectTag))}catch(e){}},Fl=function(e){try{t.onCommitFiberUnmount(n,e)}catch(e){}}}catch(e){}}}(m({},sc,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:P.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=rt(e))?null:e.stateNode},findFiberByHostInstance:function(e){return lc?lc(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}));var uc=cc;t.exports=uc.default||uc},{"object-assign":214,react:284,scheduler:242}],240:[function(e,t,n){"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),t.exports=e("./cjs/react-dom.production.min.js")},{"./cjs/react-dom.production.min.js":239}],241:[function(e,t,s){"use strict";var o,l,c,u,n;if(Object.defineProperty(s,"__esModule",{value:!0}),"undefined"==typeof window||"function"!=typeof MessageChannel){var r=null,i=null,a=function(){if(null!==r)try{var e=s.unstable_now();r(!0,e),r=null}catch(e){throw setTimeout(a,0),e}},p=Date.now();s.unstable_now=function(){return Date.now()-p},o=function(e){null!==r?setTimeout(o,0,e):(r=e,setTimeout(a,0))},l=function(e,t){i=setTimeout(e,t)},c=function(){clearTimeout(i)},u=function(){return!1},n=s.unstable_forceFrameRate=function(){}}else{var d=window.performance,f=window.Date,h=window.setTimeout,m=window.clearTimeout,g=window.requestAnimationFrame,v=window.cancelAnimationFrame;if("undefined"!=typeof console&&("function"!=typeof g&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof v&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")),"object"==typeof d&&"function"==typeof d.now)s.unstable_now=function(){return d.now()};else{var y=f.now();s.unstable_now=function(){return f.now()-y}}var b=!1,_=null,w=-1,k=5,x=0;u=function(){return s.unstable_now()>=x},n=function(){},s.unstable_forceFrameRate=function(e){e<0||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):k=0<e?Math.floor(1e3/e):33.33};var E=new MessageChannel,C=E.port2;E.port1.onmessage=function(){if(null!==_){var e=s.unstable_now();x=e+k;try{_(!0,e)?C.postMessage(null):(b=!1,_=null)}catch(e){throw C.postMessage(null),e}}else b=!1},o=function(e){_=e,b||(b=!0,C.postMessage(null))},l=function(e,t){w=h(function(){e(s.unstable_now())},t)},c=function(){m(w),w=-1}}function S(e,t){var n=e.length;e.push(t);e:for(;;){var r=Math.floor((n-1)/2),i=e[r];if(!(void 0!==i&&0<N(i,t)))break e;e[r]=t,e[n]=i,n=r}}function T(e){return void 0===(e=e[0])?null:e}function A(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var o=2*(r+1)-1,a=e[o],s=o+1,l=e[s];if(void 0!==a&&N(a,n)<0)void 0!==l&&N(l,a)<0?(e[r]=l,e[s]=n,r=s):(e[r]=a,e[o]=n,r=o);else{if(!(void 0!==l&&N(l,n)<0))break e;e[r]=l,e[s]=n,r=s}}}return t}return null}function N(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var O=[],P=[],I=1,D=null,L=3,R=!1,j=!1,B=!1;function M(e){for(var t=T(P);null!==t;){if(null===t.callback)A(P);else{if(!(t.startTime<=e))break;A(P),t.sortIndex=t.expirationTime,S(O,t)}t=T(P)}}function F(e){if(B=!1,M(e),!j)if(null!==T(O))j=!0,o(U);else{var t=T(P);null!==t&&l(F,t.startTime-e)}}function U(e,t){j=!1,B&&(B=!1,c()),R=!0;var n=L;try{for(M(t),D=T(O);null!==D&&(!(D.expirationTime>t)||e&&!u());){var r=D.callback;if(null!==r){D.callback=null,L=D.priorityLevel;var i=r(D.expirationTime<=t);t=s.unstable_now(),"function"==typeof i?D.callback=i:D===T(O)&&A(O),M(t)}else A(O);D=T(O)}if(null!==D)var o=!0;else{var a=T(P);null!==a&&l(F,a.startTime-t),o=!1}return o}finally{D=null,L=n,R=!1}}function q(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var H=n;s.unstable_ImmediatePriority=1,s.unstable_UserBlockingPriority=2,s.unstable_NormalPriority=3,s.unstable_IdlePriority=5,s.unstable_LowPriority=4,s.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=L;L=e;try{return t()}finally{L=n}},s.unstable_next=function(e){switch(L){case 1:case 2:case 3:var t=3;break;default:t=L}var n=L;L=t;try{return e()}finally{L=n}},s.unstable_scheduleCallback=function(e,t,n){var r=s.unstable_now();if("object"==typeof n&&null!==n){var i=n.delay;i="number"==typeof i&&0<i?r+i:r,n="number"==typeof n.timeout?n.timeout:q(e)}else n=q(e),i=r;return e={id:I++,callback:t,priorityLevel:e,startTime:i,expirationTime:n=i+n,sortIndex:-1},r<i?(e.sortIndex=i,S(P,e),null===T(O)&&e===T(P)&&(B?c():B=!0,l(F,i-r))):(e.sortIndex=n,S(O,e),j||R||(j=!0,o(U))),e},s.unstable_cancelCallback=function(e){e.callback=null},s.unstable_wrapCallback=function(t){var n=L;return function(){var e=L;L=n;try{return t.apply(this,arguments)}finally{L=e}}},s.unstable_getCurrentPriorityLevel=function(){return L},s.unstable_shouldYield=function(){var e=s.unstable_now();M(e);var t=T(O);return t!==D&&null!==D&&null!==t&&null!==t.callback&&t.startTime<=e&&t.expirationTime<D.expirationTime||u()},s.unstable_requestPaint=H,s.unstable_continueExecution=function(){j||R||(j=!0,o(U))},s.unstable_pauseExecution=function(){},s.unstable_getFirstCallbackNode=function(){return T(O)},s.unstable_Profiling=null},{}],242:[function(e,t,n){"use strict";t.exports=e("./cjs/scheduler.production.min.js")},{"./cjs/scheduler.production.min.js":241}],243:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&Symbol.for,i=r?Symbol.for("react.element"):60103,o=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,l=r?Symbol.for("react.profiler"):60114,c=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,p=r?Symbol.for("react.async_mode"):60111,d=r?Symbol.for("react.concurrent_mode"):60111,f=r?Symbol.for("react.forward_ref"):60112,h=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.suspense_list"):60120,g=r?Symbol.for("react.memo"):60115,v=r?Symbol.for("react.lazy"):60116,y=r?Symbol.for("react.fundamental"):60117,b=r?Symbol.for("react.responder"):60118,_=r?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case p:case d:case a:case l:case s:case h:return e;default:switch(e=e&&e.$$typeof){case u:case f:case v:case g:case c:return e;default:return t}}case o:return t}}}function k(e){return w(e)===d}n.typeOf=w,n.AsyncMode=p,n.ConcurrentMode=d,n.ContextConsumer=u,n.ContextProvider=c,n.Element=i,n.ForwardRef=f,n.Fragment=a,n.Lazy=v,n.Memo=g,n.Portal=o,n.Profiler=l,n.StrictMode=s,n.Suspense=h,n.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===d||e===l||e===s||e===h||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===g||e.$$typeof===c||e.$$typeof===u||e.$$typeof===f||e.$$typeof===y||e.$$typeof===b||e.$$typeof===_)},n.isAsyncMode=function(e){return k(e)||w(e)===p},n.isConcurrentMode=k,n.isContextConsumer=function(e){return w(e)===u},n.isContextProvider=function(e){return w(e)===c},n.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},n.isForwardRef=function(e){return w(e)===f},n.isFragment=function(e){return w(e)===a},n.isLazy=function(e){return w(e)===v},n.isMemo=function(e){return w(e)===g},n.isPortal=function(e){return w(e)===o},n.isProfiler=function(e){return w(e)===l},n.isStrictMode=function(e){return w(e)===s},n.isSuspense=function(e){return w(e)===h}},{}],244:[function(e,t,n){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":243}],245:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bodyOpenClassName=n.portalClassName=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("react"),l=f(i),c=f(e("react-dom")),o=f(e("prop-types")),u=f(e("./ModalPortal")),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../helpers/ariaAppHider")),d=e("../helpers/safeHTMLElement"),a=f(d);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var m=n.portalClassName="ReactModalPortal",g=n.bodyOpenClassName="ReactModal__Body--open",v=void 0!==c.default.createPortal,y=v?c.default.createPortal:c.default.unstable_renderSubtreeIntoContainer;function b(e){return e()}var _=function(e){function a(){var e,t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=n=h(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(i))),n.removePortal=function(){!v&&c.default.unmountComponentAtNode(n.node),b(n.props.parentSelector).removeChild(n.node)},n.portalRef=function(e){n.portal=e},n.renderPortal=function(e){var t=y(n,l.default.createElement(u.default,s({defaultStyles:a.defaultStyles},e)),n.node);n.portalRef(t)},h(n,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,i.Component),r(a,[{key:"componentDidMount",value:function(){d.canUseDOM&&(v||(this.node=document.createElement("div")),this.node.className=this.props.portalClassName,b(this.props.parentSelector).appendChild(this.node),!v&&this.renderPortal(this.props))}},{key:"componentWillReceiveProps",value:function(e){if(d.canUseDOM){var t=e.isOpen;if(this.props.isOpen||t){var n=b(this.props.parentSelector),r=b(e.parentSelector);r!==n&&(n.removeChild(this.node),r.appendChild(this.node)),!v&&this.renderPortal(e)}}}},{key:"componentWillUpdate",value:function(e){d.canUseDOM&&e.portalClassName!==this.props.portalClassName&&(this.node.className=e.portalClassName)}},{key:"componentWillUnmount",value:function(){if(d.canUseDOM&&this.node&&this.portal){var e=this.portal.state,t=Date.now(),n=e.isOpen&&this.props.closeTimeoutMS&&(e.closesAt||t+this.props.closeTimeoutMS);n?(e.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,n-t)):this.removePortal()}}},{key:"render",value:function(){return d.canUseDOM&&v?(!this.node&&v&&(this.node=document.createElement("div")),y(l.default.createElement(u.default,s({ref:this.portalRef,defaultStyles:a.defaultStyles},this.props)),this.node)):null}}],[{key:"setAppElement",value:function(e){p.setElement(e)}}]),a}();_.propTypes={isOpen:o.default.bool.isRequired,style:o.default.shape({content:o.default.object,overlay:o.default.object}),portalClassName:o.default.string,bodyOpenClassName:o.default.string,htmlOpenClassName:o.default.string,className:o.default.oneOfType([o.default.string,o.default.shape({base:o.default.string.isRequired,afterOpen:o.default.string.isRequired,beforeClose:o.default.string.isRequired})]),overlayClassName:o.default.oneOfType([o.default.string,o.default.shape({base:o.default.string.isRequired,afterOpen:o.default.string.isRequired,beforeClose:o.default.string.isRequired})]),appElement:o.default.instanceOf(a.default),onAfterOpen:o.default.func,onRequestClose:o.default.func,closeTimeoutMS:o.default.number,ariaHideApp:o.default.bool,shouldFocusAfterRender:o.default.bool,shouldCloseOnOverlayClick:o.default.bool,shouldReturnFocusAfterClose:o.default.bool,parentSelector:o.default.func,aria:o.default.object,role:o.default.string,contentLabel:o.default.string,shouldCloseOnEsc:o.default.bool,overlayRef:o.default.func,contentRef:o.default.func},_.defaultProps={isOpen:!1,portalClassName:m,bodyOpenClassName:g,ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,parentSelector:function(){return document.body}},_.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}},n.default=_},{"../helpers/ariaAppHider":247,"../helpers/safeHTMLElement":250,"./ModalPortal":246,"prop-types":236,react:284,"react-dom":240}],246:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("react"),s=m(o),l=m(e("prop-types")),c=h(e("../helpers/focusManager")),u=m(e("../helpers/scopeTab")),p=h(e("../helpers/ariaAppHider")),d=h(e("../helpers/classList")),f=m(e("../helpers/safeHTMLElement"));function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}var g={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},v=9,y=27,b=0,_=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.setFocusAfterRender=function(e){o.focusAfterRender=o.props.shouldFocusAfterRender&&e},o.setOverlayRef=function(e){o.overlay=e,o.props.overlayRef&&o.props.overlayRef(e)},o.setContentRef=function(e){o.content=e,o.props.contentRef&&o.props.contentRef(e)},o.afterClose=function(){var e=o.props,t=e.appElement,n=e.ariaHideApp,r=e.htmlOpenClassName,i=e.bodyOpenClassName;d.remove(document.body,i),r&&d.remove(document.getElementsByTagName("html")[0],r),n&&0<b&&0==(b-=1)&&p.show(t),o.props.shouldFocusAfterRender&&(o.props.shouldReturnFocusAfterClose?(c.returnFocus(),c.teardownScopedFocus()):c.popWithoutFocus())},o.open=function(){o.beforeOpen(),o.state.afterOpen&&o.state.beforeClose?(clearTimeout(o.closeTimer),o.setState({beforeClose:!1})):(o.props.shouldFocusAfterRender&&(c.setupScopedFocus(o.node),c.markForFocusLater()),o.setState({isOpen:!0},function(){o.setState({afterOpen:!0}),o.props.isOpen&&o.props.onAfterOpen&&o.props.onAfterOpen()}))},o.close=function(){0<o.props.closeTimeoutMS?o.closeWithTimeout():o.closeWithoutTimeout()},o.focusContent=function(){return o.content&&!o.contentHasFocus()&&o.content.focus()},o.closeWithTimeout=function(){var e=Date.now()+o.props.closeTimeoutMS;o.setState({beforeClose:!0,closesAt:e},function(){o.closeTimer=setTimeout(o.closeWithoutTimeout,o.state.closesAt-Date.now())})},o.closeWithoutTimeout=function(){o.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},o.afterClose)},o.handleKeyDown=function(e){e.keyCode===v&&(0,u.default)(o.content,e),o.props.shouldCloseOnEsc&&e.keyCode===y&&(e.stopPropagation(),o.requestClose(e))},o.handleOverlayOnClick=function(e){null===o.shouldClose&&(o.shouldClose=!0),o.shouldClose&&o.props.shouldCloseOnOverlayClick&&(o.ownerHandlesClose()?o.requestClose(e):o.focusContent()),o.shouldClose=null,o.moveFromContentToOverlay=null},o.handleOverlayOnMouseUp=function(){null===o.moveFromContentToOverlay&&(o.shouldClose=!1),o.props.shouldCloseOnOverlayClick&&(o.shouldClose=!0)},o.handleContentOnMouseUp=function(){o.shouldClose=!1},o.handleOverlayOnMouseDown=function(e){o.props.shouldCloseOnOverlayClick||e.target!=o.overlay||e.preventDefault(),o.moveFromContentToOverlay=!1},o.handleContentOnClick=function(){o.shouldClose=!1},o.handleContentOnMouseDown=function(){o.shouldClose=!1,o.moveFromContentToOverlay=!1},o.requestClose=function(e){return o.ownerHandlesClose()&&o.props.onRequestClose(e)},o.ownerHandlesClose=function(){return o.props.onRequestClose},o.shouldBeClosed=function(){return!o.state.isOpen&&!o.state.beforeClose},o.contentHasFocus=function(){return document.activeElement===o.content||o.content.contains(document.activeElement)},o.buildClassName=function(e,t){var n="object"===(void 0===t?"undefined":i(t))?t:{base:g[e],afterOpen:g[e]+"--after-open",beforeClose:g[e]+"--before-close"},r=n.base;return o.state.afterOpen&&(r=r+" "+n.afterOpen),o.state.beforeClose&&(r=r+" "+n.beforeClose),"string"==typeof t&&t?r+" "+t:r},o.ariaAttributes=function(n){return Object.keys(n).reduce(function(e,t){return e["aria-"+t]=n[t],e},{})},o.state={afterOpen:!1,beforeClose:!1},o.shouldClose=null,o.moveFromContentToOverlay=null,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:"componentDidMount",value:function(){this.props.isOpen&&(this.setFocusAfterRender(!0),this.open())}},{key:"componentWillReceiveProps",value:function(e){!this.props.isOpen&&e.isOpen?(this.setFocusAfterRender(!0),this.open()):this.props.isOpen&&!e.isOpen&&this.close()}},{key:"componentDidUpdate",value:function(){this.focusAfterRender&&(this.focusContent(),this.setFocusAfterRender(!1))}},{key:"componentWillUnmount",value:function(){this.afterClose(),clearTimeout(this.closeTimer)}},{key:"beforeOpen",value:function(){var e=this.props,t=e.appElement,n=e.ariaHideApp,r=e.htmlOpenClassName,i=e.bodyOpenClassName;d.add(document.body,i),r&&d.add(document.getElementsByTagName("html")[0],r),n&&(b+=1,p.hide(t))}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.overlayClassName,r=e.defaultStyles,i=t?{}:r.content,o=n?{}:r.overlay;return this.shouldBeClosed()?null:s.default.createElement("div",{ref:this.setOverlayRef,className:this.buildClassName("overlay",n),style:a({},o,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown,onMouseUp:this.handleOverlayOnMouseUp,"aria-modal":"true"},s.default.createElement("div",a({ref:this.setContentRef,style:a({},i,this.props.style.content),className:this.buildClassName("content",t),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.ariaAttributes(this.props.aria||{})),this.props.children))}}]),t}();_.defaultProps={style:{overlay:{},content:{}}},_.propTypes={isOpen:l.default.bool.isRequired,defaultStyles:l.default.shape({content:l.default.object,overlay:l.default.object}),style:l.default.shape({content:l.default.object,overlay:l.default.object}),className:l.default.oneOfType([l.default.string,l.default.object]),overlayClassName:l.default.oneOfType([l.default.string,l.default.object]),bodyOpenClassName:l.default.string,htmlOpenClassName:l.default.string,ariaHideApp:l.default.bool,appElement:l.default.instanceOf(f.default),onAfterOpen:l.default.func,onRequestClose:l.default.func,closeTimeoutMS:l.default.number,shouldFocusAfterRender:l.default.bool,shouldCloseOnOverlayClick:l.default.bool,shouldReturnFocusAfterClose:l.default.bool,role:l.default.string,contentLabel:l.default.string,aria:l.default.object,children:l.default.node,shouldCloseOnEsc:l.default.bool,overlayRef:l.default.func,contentRef:l.default.func},n.default=_,t.exports=n.default},{"../helpers/ariaAppHider":247,"../helpers/classList":248,"../helpers/focusManager":249,"../helpers/safeHTMLElement":250,"../helpers/scopeTab":251,"prop-types":236,react:284}],247:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.assertNodeList=s,n.setElement=function(e){var t=e;if("string"==typeof t){var n=document.querySelectorAll(t);s(n,t),t="length"in n?n[0]:n}return a=t||a},n.validateElement=l,n.hide=function(e){l(e)&&(e||a).setAttribute("aria-hidden","true")},n.show=function(e){l(e)&&(e||a).removeAttribute("aria-hidden")},n.documentNotReadyOrSSRTesting=function(){a=null},n.resetForTesting=function(){a=null};var r,i=e("warning"),o=(r=i)&&r.__esModule?r:{default:r};var a=null;function s(e,t){if(!e||!e.length)throw new Error("react-modal: No elements were found for selector "+t+".")}function l(e){return!(!e&&!a&&((0,o.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),1))}},{warning:340}],248:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dumpClassLists=function(){};var o={},a={};n.add=function(e,t){return r=e.classList,i="html"==e.nodeName.toLowerCase()?o:a,void t.split(" ").forEach(function(e){var t,n;(t=i)[n=e]||(t[n]=0),t[n]+=1,r.add(e)});var r,i},n.remove=function(e,t){return r=e.classList,i="html"==e.nodeName.toLowerCase()?o:a,void t.split(" ").forEach(function(e){var t,n;(t=i)[n=e]&&(t[n]-=1),0===i[e]&&r.remove(e)});var r,i}},{}],249:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.handleBlur=c,n.handleFocus=u,n.markForFocusLater=function(){a.push(document.activeElement)},n.returnFocus=function(){var t=null;try{return void(0!==a.length&&(t=a.pop()).focus())}catch(e){console.warn(["You tried to return focus to",t,"but it is not in the DOM anymore"].join(" "))}},n.popWithoutFocus=function(){0<a.length&&a.pop()},n.setupScopedFocus=function(e){s=e,window.addEventListener?(window.addEventListener("blur",c,!1),document.addEventListener("focus",u,!0)):(window.attachEvent("onBlur",c),document.attachEvent("onFocus",u))},n.teardownScopedFocus=function(){s=null,window.addEventListener?(window.removeEventListener("blur",c),document.removeEventListener("focus",u)):(window.detachEvent("onBlur",c),document.detachEvent("onFocus",u))};var r,i=e("../helpers/tabbable"),o=(r=i)&&r.__esModule?r:{default:r};var a=[],s=null,l=!1;function c(){l=!0}function u(){if(l){if(l=!1,!s)return;setTimeout(function(){s.contains(document.activeElement)||((0,o.default)(s)[0]||s).focus()},0)}}},{"../helpers/tabbable":252}],250:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.canUseDOM=void 0;var r,i=e("exenv");var o=((r=i)&&r.__esModule?r:{default:r}).default,a=o.canUseDOM?window.HTMLElement:{};n.canUseDOM=o.canUseDOM;n.default=a},{exenv:161}],251:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){var n=(0,c.default)(e);if(n.length){var r,i=t.shiftKey,o=n[0],a=n[n.length-1];if(e===document.activeElement){if(!i)return;r=a}if(a!==document.activeElement||i||(r=o),o===document.activeElement&&i&&(r=a),r)return t.preventDefault(),void r.focus();var s=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent);if(null!=s&&"Chrome"!=s[1]&&null==/\biPod\b|\biPad\b/g.exec(navigator.userAgent)){var l=n.indexOf(document.activeElement);-1<l&&(l+=i?-1:1),t.preventDefault(),n[l].focus()}}else t.preventDefault()};var r,i=e("./tabbable"),c=(r=i)&&r.__esModule?r:{default:r};t.exports=n.default},{"./tabbable":252}],252:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return[].slice.call(e.querySelectorAll("*"),0).filter(a)};var r=/input|select|textarea|button|object/;function i(e){var t=e.offsetWidth<=0&&e.offsetHeight<=0;if(t&&!e.innerHTML)return!0;var n=window.getComputedStyle(e);return t?"visible"!==n.getPropertyValue("overflow"):"none"==n.getPropertyValue("display")}function o(e,t){var n=e.nodeName.toLowerCase();return(r.test(n)&&!e.disabled||"a"===n&&e.href||t)&&function(e){for(var t=e;t&&t!==document.body;){if(i(t))return!1;t=t.parentNode}return!0}(e)}function a(e){var t=e.getAttribute("tabindex");null===t&&(t=void 0);var n=isNaN(t);return(n||0<=t)&&o(e,!n)}t.exports=n.default},{}],253:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("./components/Modal"),o=(r=i)&&r.__esModule?r:{default:r};n.default=o.default,t.exports=n.default},{"./components/Modal":245}],254:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault");n.__esModule=!0,n.createProvider=i,n.default=void 0;var o=r(e("@babel/runtime/helpers/inheritsLoose")),a=e("react"),s=r(e("prop-types")),l=e("../utils/PropTypes");r(e("../utils/warning"));function i(i){var e;void 0===i&&(i="store");var n=i+"Subscription",t=function(r){(0,o.default)(t,r);var e=t.prototype;function t(e,t){var n;return(n=r.call(this,e,t)||this)[i]=e.store,n}return e.getChildContext=function(){var e;return(e={})[i]=this[i],e[n]=null,e},e.render=function(){return a.Children.only(this.props.children)},t}(a.Component);return t.propTypes={store:l.storeShape.isRequired,children:s.default.element.isRequired},t.childContextTypes=((e={})[i]=l.storeShape.isRequired,e[n]=l.subscriptionShape,e),t}var c=i();n.default=c},{"../utils/PropTypes":264,"../utils/warning":269,"@babel/runtime/helpers/inheritsLoose":108,"@babel/runtime/helpers/interopRequireDefault":109,"prop-types":236,react:284}],255:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault");n.__esModule=!0,n.default=function(a,e){var t,n;void 0===e&&(e={});var r=e,i=r.getDisplayName,s=void 0===i?function(e){return"ConnectAdvanced("+e+")"}:i,o=r.methodName,l=void 0===o?"connectAdvanced":o,c=r.renderCountProp,u=void 0===c?void 0:c,p=r.shouldHandleStateChanges,d=void 0===p||p,f=r.storeKey,h=void 0===f?"store":f,m=r.withRef,g=void 0!==m&&m,v=(0,C.default)(r,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef"]),y=h+"Subscription",b=I++,_=((t={})[h]=P.storeShape,t[y]=P.subscriptionShape,t),w=((n={})[y]=P.subscriptionShape,n);return function(n){(0,T.default)((0,N.isValidElementType)(n),"You must pass a component to the function returned by "+l+". Instead received "+JSON.stringify(n));var e=n.displayName||n.name||"Component",i=s(e),o=(0,E.default)({},v,{getDisplayName:s,methodName:l,renderCountProp:u,shouldHandleStateChanges:d,storeKey:h,withRef:g,displayName:i,wrappedComponentName:e,WrappedComponent:n}),t=function(r){function e(e,t){var n;return(n=r.call(this,e,t)||this).version=b,n.state={},n.renderCount=0,n.store=e[h]||t[h],n.propsMode=Boolean(e[h]),n.setWrappedInstance=n.setWrappedInstance.bind((0,x.default)((0,x.default)(n))),(0,T.default)(n.store,'Could not find "'+h+'" in either the context or props of "'+i+'". Either wrap the root component in a <Provider>, or explicitly pass "'+h+'" as a prop to "'+i+'".'),n.initSelector(),n.initSubscription(),n}(0,k.default)(e,r);var t=e.prototype;return t.getChildContext=function(){var e,t=this.propsMode?null:this.subscription;return(e={})[y]=t||this.context[y],e},t.componentDidMount=function(){d&&(this.subscription.trySubscribe(),this.selector.run(this.props),this.selector.shouldComponentUpdate&&this.forceUpdate())},t.componentWillReceiveProps=function(e){this.selector.run(e)},t.shouldComponentUpdate=function(){return this.selector.shouldComponentUpdate},t.componentWillUnmount=function(){this.subscription&&this.subscription.tryUnsubscribe(),this.subscription=null,this.notifyNestedSubs=L,this.store=null,this.selector.run=L,this.selector.shouldComponentUpdate=!1},t.getWrappedInstance=function(){return(0,T.default)(g,"To access the wrapped instance, you need to specify { withRef: true } in the options argument of the "+l+"() call."),this.wrappedInstance},t.setWrappedInstance=function(e){this.wrappedInstance=e},t.initSelector=function(){var n,r,i,e=a(this.store.dispatch,o);this.selector=(n=e,r=this.store,i={run:function(e){try{var t=n(r.getState(),e);(t!==i.props||i.error)&&(i.shouldComponentUpdate=!0,i.props=t,i.error=null)}catch(e){i.shouldComponentUpdate=!0,i.error=e}}}),this.selector.run(this.props)},t.initSubscription=function(){if(d){var e=(this.propsMode?this.props:this.context)[y];this.subscription=new O.default(this.store,e,this.onStateChange.bind(this)),this.notifyNestedSubs=this.subscription.notifyNestedSubs.bind(this.subscription)}},t.onStateChange=function(){this.selector.run(this.props),this.selector.shouldComponentUpdate?(this.componentDidUpdate=this.notifyNestedSubsOnComponentDidUpdate,this.setState(D)):this.notifyNestedSubs()},t.notifyNestedSubsOnComponentDidUpdate=function(){this.componentDidUpdate=void 0,this.notifyNestedSubs()},t.isSubscribed=function(){return Boolean(this.subscription)&&this.subscription.isSubscribed()},t.addExtraProps=function(e){if(!(g||u||this.propsMode&&this.subscription))return e;var t=(0,E.default)({},e);return g&&(t.ref=this.setWrappedInstance),u&&(t[u]=this.renderCount++),this.propsMode&&this.subscription&&(t[y]=this.subscription),t},t.render=function(){var e=this.selector;if(e.shouldComponentUpdate=!1,e.error)throw e.error;return(0,A.createElement)(n,this.addExtraProps(e.props))},e}(A.Component);return t.WrappedComponent=n,t.displayName=i,t.childContextTypes=w,t.contextTypes=_,t.propTypes=_,(0,S.default)(t,n)}};var k=r(e("@babel/runtime/helpers/inheritsLoose")),x=r(e("@babel/runtime/helpers/assertThisInitialized")),E=r(e("@babel/runtime/helpers/extends")),C=r(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),S=r(e("hoist-non-react-statics")),T=r(e("invariant")),A=e("react"),N=e("react-is"),O=r(e("../utils/Subscription")),P=e("../utils/PropTypes"),I=0,D={};function L(){}},{"../utils/PropTypes":264,"../utils/Subscription":265,"@babel/runtime/helpers/assertThisInitialized":106,"@babel/runtime/helpers/extends":107,"@babel/runtime/helpers/inheritsLoose":108,"@babel/runtime/helpers/interopRequireDefault":109,"@babel/runtime/helpers/objectWithoutPropertiesLoose":111,"hoist-non-react-statics":163,invariant:175,react:284,"react-is":244}],256:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault");n.__esModule=!0,n.createConnect=i,n.default=void 0;var E=r(e("@babel/runtime/helpers/extends")),C=r(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),s=r(e("../components/connectAdvanced")),S=r(e("../utils/shallowEqual")),l=r(e("./mapDispatchToProps")),c=r(e("./mapStateToProps")),u=r(e("./mergeProps")),p=r(e("./selectorFactory"));function T(n,e,r){for(var t=e.length-1;0<=t;t--){var i=e[t](n);if(i)return i}return function(e,t){throw new Error("Invalid value of type "+typeof n+" for "+r+" argument when connecting component "+t.wrappedComponentName+".")}}function A(e,t){return e===t}function i(e){var t=void 0===e?{}:e,n=t.connectHOC,b=void 0===n?s.default:n,r=t.mapStateToPropsFactories,_=void 0===r?c.default:r,i=t.mapDispatchToPropsFactories,w=void 0===i?l.default:i,o=t.mergePropsFactories,k=void 0===o?u.default:o,a=t.selectorFactory,x=void 0===a?p.default:a;return function(e,t,n,r){void 0===r&&(r={});var i=r,o=i.pure,a=void 0===o||o,s=i.areStatesEqual,l=void 0===s?A:s,c=i.areOwnPropsEqual,u=void 0===c?S.default:c,p=i.areStatePropsEqual,d=void 0===p?S.default:p,f=i.areMergedPropsEqual,h=void 0===f?S.default:f,m=(0,C.default)(i,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),g=T(e,_,"mapStateToProps"),v=T(t,w,"mapDispatchToProps"),y=T(n,k,"mergeProps");return b(x,(0,E.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:g,initMapDispatchToProps:v,initMergeProps:y,pure:a,areStatesEqual:l,areOwnPropsEqual:u,areStatePropsEqual:d,areMergedPropsEqual:h},m))}}var o=i();n.default=o},{"../components/connectAdvanced":255,"../utils/shallowEqual":267,"./mapDispatchToProps":257,"./mapStateToProps":258,"./mergeProps":259,"./selectorFactory":260,"@babel/runtime/helpers/extends":107,"@babel/runtime/helpers/interopRequireDefault":109,"@babel/runtime/helpers/objectWithoutPropertiesLoose":111}],257:[function(e,t,n){"use strict";n.__esModule=!0,n.whenMapDispatchToPropsIsFunction=o,n.whenMapDispatchToPropsIsMissing=a,n.whenMapDispatchToPropsIsObject=s,n.default=void 0;var r=e("redux"),i=e("./wrapMapToProps");function o(e){return"function"==typeof e?(0,i.wrapMapToPropsFunc)(e,"mapDispatchToProps"):void 0}function a(e){return e?void 0:(0,i.wrapMapToPropsConstant)(function(e){return{dispatch:e}})}function s(t){return t&&"object"==typeof t?(0,i.wrapMapToPropsConstant)(function(e){return(0,r.bindActionCreators)(t,e)}):void 0}var l=[o,a,s];n.default=l},{"./wrapMapToProps":262,redux:305}],258:[function(e,t,n){"use strict";n.__esModule=!0,n.whenMapStateToPropsIsFunction=i,n.whenMapStateToPropsIsMissing=o,n.default=void 0;var r=e("./wrapMapToProps");function i(e){return"function"==typeof e?(0,r.wrapMapToPropsFunc)(e,"mapStateToProps"):void 0}function o(e){return e?void 0:(0,r.wrapMapToPropsConstant)(function(){return{}})}var a=[i,o];n.default=a},{"./wrapMapToProps":262}],259:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault");n.__esModule=!0,n.defaultMergeProps=o,n.wrapMergePropsFunc=a,n.whenMergePropsIsFunction=s,n.whenMergePropsIsOmitted=l,n.default=void 0;var i=r(e("@babel/runtime/helpers/extends"));r(e("../utils/verifyPlainObject"));function o(e,t,n){return(0,i.default)({},n,e,t)}function a(l){return function(e,t){t.displayName;var i,o=t.pure,a=t.areMergedPropsEqual,s=!1;return function(e,t,n){var r=l(e,t,n);return s?o&&a(r,i)||(i=r):(s=!0,i=r),i}}}function s(e){return"function"==typeof e?a(e):void 0}function l(e){return e?void 0:function(){return o}}var c=[s,l];n.default=c},{"../utils/verifyPlainObject":268,"@babel/runtime/helpers/extends":107,"@babel/runtime/helpers/interopRequireDefault":109}],260:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault");n.__esModule=!0,n.impureFinalPropsSelectorFactory=u,n.pureFinalPropsSelectorFactory=p,n.default=function(e,t){var n=t.initMapStateToProps,r=t.initMapDispatchToProps,i=t.initMergeProps,o=(0,c.default)(t,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),a=n(e,o),s=r(e,o),l=i(e,o);return(o.pure?p:u)(a,s,l,e,o)};var c=r(e("@babel/runtime/helpers/objectWithoutPropertiesLoose"));r(e("./verifySubselectors"));function u(n,r,i,o){return function(e,t){return i(n(e,t),r(o,t),t)}}function p(l,c,u,p,e){var d,f,h,m,g,v=e.areStatesEqual,y=e.areOwnPropsEqual,b=e.areStatePropsEqual,_=!1;return function(e,t){return _?(n=e,a=!y(r=t,f),s=!v(n,d),d=n,f=r,a&&s?(h=l(d,f),c.dependsOnOwnProps&&(m=c(p,f)),g=u(h,m,f)):a?(l.dependsOnOwnProps&&(h=l(d,f)),c.dependsOnOwnProps&&(m=c(p,f)),g=u(h,m,f)):(s&&(i=l(d,f),o=!b(i,h),h=i,o&&(g=u(h,m,f))),g)):(h=l(d=e,f=t),m=c(p,f),g=u(h,m,f),_=!0,g);var n,r,i,o,a,s}}},{"./verifySubselectors":261,"@babel/runtime/helpers/interopRequireDefault":109,"@babel/runtime/helpers/objectWithoutPropertiesLoose":111}],261:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault");n.__esModule=!0,n.default=function(e,t,n,r){o(e,"mapStateToProps",r),o(t,"mapDispatchToProps",r),o(n,"mergeProps",r)};var i=r(e("../utils/warning"));function o(e,t,n){if(!e)throw new Error("Unexpected value for "+t+" in "+n+".");"mapStateToProps"!==t&&"mapDispatchToProps"!==t||e.hasOwnProperty("dependsOnOwnProps")||(0,i.default)("The selector for "+t+" of "+n+" did not specify a value for dependsOnOwnProps.")}},{"../utils/warning":269,"@babel/runtime/helpers/interopRequireDefault":109}],262:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault");n.__esModule=!0,n.wrapMapToPropsConstant=function(i){return function(e,t){var n=i(e,t);function r(){return n}return r.dependsOnOwnProps=!1,r}},n.getDependsOnOwnProps=o,n.wrapMapToPropsFunc=function(i,e){return function(e,t){t.displayName;var r=function(e,t){return r.dependsOnOwnProps?r.mapToProps(e,t):r.mapToProps(e)};return r.dependsOnOwnProps=!0,r.mapToProps=function(e,t){r.mapToProps=i,r.dependsOnOwnProps=o(i);var n=r(e,t);return"function"==typeof n&&(r.mapToProps=n,r.dependsOnOwnProps=o(n),n=r(e,t)),n},r}};r(e("../utils/verifyPlainObject"));function o(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}},{"../utils/verifyPlainObject":268,"@babel/runtime/helpers/interopRequireDefault":109}],263:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault"),i=e("@babel/runtime/helpers/interopRequireWildcard");n.__esModule=!0;var o=i(e("./components/Provider"));n.Provider=o.default,n.createProvider=o.createProvider;var a=r(e("./components/connectAdvanced"));n.connectAdvanced=a.default;var s=r(e("./connect/connect"));n.connect=s.default},{"./components/Provider":254,"./components/connectAdvanced":255,"./connect/connect":256,"@babel/runtime/helpers/interopRequireDefault":109,"@babel/runtime/helpers/interopRequireWildcard":110}],264:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault");n.__esModule=!0,n.storeShape=n.subscriptionShape=void 0;var i=r(e("prop-types")),o=i.default.shape({trySubscribe:i.default.func.isRequired,tryUnsubscribe:i.default.func.isRequired,notifyNestedSubs:i.default.func.isRequired,isSubscribed:i.default.func.isRequired});n.subscriptionShape=o;var a=i.default.shape({subscribe:i.default.func.isRequired,dispatch:i.default.func.isRequired,getState:i.default.func.isRequired});n.storeShape=a},{"@babel/runtime/helpers/interopRequireDefault":109,"prop-types":236}],265:[function(e,t,n){"use strict";n.__esModule=!0,n.default=void 0;var i=null,r={notify:function(){}};var o=function(){function e(e,t,n){this.store=e,this.parentSub=t,this.onStateChange=n,this.unsubscribe=null,this.listeners=r}var t=e.prototype;return t.addNestedSub=function(e){return this.trySubscribe(),this.listeners.subscribe(e)},t.notifyNestedSubs=function(){this.listeners.notify()},t.isSubscribed=function(){return Boolean(this.unsubscribe)},t.trySubscribe=function(){var n,r;this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.onStateChange):this.store.subscribe(this.onStateChange),this.listeners=(n=[],r=[],{clear:function(){n=r=i},notify:function(){for(var e=n=r,t=0;t<e.length;t++)e[t]()},get:function(){return r},subscribe:function(e){var t=!0;return r===n&&(r=n.slice()),r.push(e),function(){t&&n!==i&&(t=!1,r===n&&(r=n.slice()),r.splice(r.indexOf(e),1))}}}))},t.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=r)},e}();n.default=o},{}],266:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n}},{}],267:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e,t){if(a(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++)if(!o.call(t,n[i])||!a(e[n[i]],t[n[i]]))return!1;return!0};var o=Object.prototype.hasOwnProperty;function a(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}},{}],268:[function(e,t,n){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault");n.__esModule=!0,n.default=function(e,t,n){(0,i.default)(e)||(0,o.default)(n+"() in "+t+" must return a plain object. Instead received "+e+".")};var i=r(e("./isPlainObject")),o=r(e("./warning"))},{"./isPlainObject":266,"./warning":269,"@babel/runtime/helpers/interopRequireDefault":109}],269:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},{}],270:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={GLOBAL:{HIDE:"__react_tooltip_hide_event",REBUILD:"__react_tooltip_rebuild_event",SHOW:"__react_tooltip_show_event"}}},{}],271:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.isCustomEvent=function(e){return this.state.event||!!e.getAttribute("data-event")},e.prototype.customBindListener=function(n){var r=this,e=this.state,t=e.event,i=e.eventOff,o=n.getAttribute("data-event")||t,a=n.getAttribute("data-event-off")||i;o.split(" ").forEach(function(e){n.removeEventListener(e,c.get(n,e));var t=s.bind(r,a);c.set(n,e,t),n.addEventListener(e,t,!1)}),a&&a.split(" ").forEach(function(e){n.removeEventListener(e,r.hideTooltip),n.addEventListener(e,r.hideTooltip,!1)})},e.prototype.customUnbindListener=function(e){var t=this.state,n=t.event,r=t.eventOff,i=n||e.getAttribute("data-event"),o=r||e.getAttribute("data-event-off");e.removeEventListener(i,c.get(e,n)),o&&e.removeEventListener(o,this.hideTooltip)}};var s=function(e,t){var n=this.state.show,r=this.props.id,i=t.currentTarget.getAttribute("data-iscapture"),o=i&&"true"===i||this.props.isCapture,a=t.currentTarget.getAttribute("currentItem");o||t.stopPropagation(),n&&"true"===a?e||this.hideTooltip(t):(t.currentTarget.setAttribute("currentItem","true"),l(t.currentTarget,this.getTargetArray(r)),this.showTooltip(t))},l=function(e,t){for(var n=0;n<t.length;n++)e!==t[n]?t[n].setAttribute("currentItem","false"):t[n].setAttribute("currentItem","true")},c={id:"9b69f92e-d3fe-498b-b1b4-c5e63a51b0cf",set:function(e,t,n){var r,i,o;this.id in e?e[this.id][t]=n:Object.defineProperty(e,this.id,{configurable:!0,value:(r={},i=t,o=n,i in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o,r)})},get:function(e,t){var n=e[this.id];if(void 0!==n)return n[t]}}},{}],272:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.getEffect=function(e){return e.getAttribute("data-effect")||this.props.effect||"float"}}},{}],273:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.isCapture=function(e){return e&&"true"===e.getAttribute("data-iscapture")||this.props.isCapture||!1}}},{}],274:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.hide=function(e){a(o.default.GLOBAL.HIDE,{target:e})},e.rebuild=function(){a(o.default.GLOBAL.REBUILD)},e.show=function(e){a(o.default.GLOBAL.SHOW,{target:e})},e.prototype.globalRebuild=function(){this.mount&&(this.unbindListener(),this.bindListener())},e.prototype.globalShow=function(e){if(this.mount){var t={currentTarget:e.detail.target};this.showTooltip(t,!0)}},e.prototype.globalHide=function(e){if(this.mount){var t=!!(e&&e.detail&&e.detail.target);this.hideTooltip({currentTarget:t&&e.detail.target},t)}}};var r,i=e("../constant"),o=(r=i)&&r.__esModule?r:{default:r};var a=function(e,t){var n=void 0;"function"==typeof window.CustomEvent?n=new window.CustomEvent(e,{detail:t}):((n=document.createEvent("Event")).initEvent(e,!1,!0),n.detail=t),window.dispatchEvent(n)}},{"../constant":270}],275:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.bindRemovalTracker=function(){var i=this,e=r();if(null!=e){var t=new e(function(e){for(var t=0;t<e.length;t++)for(var n=e[t],r=0;r<n.removedNodes.length;r++)if(n.removedNodes[r]===i.state.currentTarget)return void i.hideTooltip()});t.observe(window.document,{childList:!0,subtree:!0}),this.removalTracker=t}},e.prototype.unbindRemovalTracker=function(){this.removalTracker&&(this.removalTracker.disconnect(),this.removalTracker=null)}};var r=function(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}},{}],276:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.bindWindowEvents=function(e){window.removeEventListener(o.default.GLOBAL.HIDE,this.globalHide),window.addEventListener(o.default.GLOBAL.HIDE,this.globalHide,!1),window.removeEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild),window.addEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild,!1),window.removeEventListener(o.default.GLOBAL.SHOW,this.globalShow),window.addEventListener(o.default.GLOBAL.SHOW,this.globalShow,!1),e&&(window.removeEventListener("resize",this.onWindowResize),window.addEventListener("resize",this.onWindowResize,!1))},e.prototype.unbindWindowEvents=function(){window.removeEventListener(o.default.GLOBAL.HIDE,this.globalHide),window.removeEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild),window.removeEventListener(o.default.GLOBAL.SHOW,this.globalShow),window.removeEventListener("resize",this.onWindowResize)},e.prototype.onWindowResize=function(){this.mount&&this.hideTooltip()}};var r,i=e("../constant"),o=(r=i)&&r.__esModule?r:{default:r}},{"../constant":270}],277:[function(e,t,n){"use strict";var r,i,o,p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),d=E(e("react")),s=E(e("prop-types")),y=E(e("react-dom")),f=E(e("classnames")),h=E(e("sanitize-html-react")),l=E(e("./decorators/staticMethods")),c=E(e("./decorators/windowListener")),u=E(e("./decorators/customEvent")),m=E(e("./decorators/isCapture")),g=E(e("./decorators/getEffect")),v=E(e("./decorators/trackRemoval")),b=E(e("./utils/getPosition")),_=E(e("./utils/getTipContent")),w=e("./utils/aria"),k=E(e("./utils/nodeListToArray")),x=E(e("./style"));function E(e){return e&&e.__esModule?e:{default:e}}var C=(0,l.default)(r=(0,c.default)(r=(0,u.default)(r=(0,m.default)(r=(0,g.default)(r=(0,v.default)((o=i=function(e){function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.state={place:e.place||"top",desiredPlace:e.place||"top",type:"dark",effect:"float",show:!1,border:!1,offset:{},extraClass:"",html:!1,delayHide:0,delayShow:0,event:e.event||null,eventOff:e.eventOff||null,currentEvent:null,currentTarget:null,ariaProps:(0,w.parseAria)(e),isEmptyTip:!1,disable:!1,originTooltip:null,isMultiline:!1},t.bind(["showTooltip","updateTooltip","hideTooltip","getTooltipContent","globalRebuild","globalShow","globalHide","onWindowResize","mouseOnToolTip"]),t.mount=!0,t.delayShowLoop=null,t.delayHideLoop=null,t.delayReshow=null,t.intervalUpdateContent=null,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,d.default.Component),a(u,[{key:"bind",value:function(e){var t=this;e.forEach(function(e){t[e]=t[e].bind(t)})}},{key:"componentDidMount",value:function(){var e=this.props,t=e.insecure,n=e.resizeHide;t&&this.setStyleHeader(),this.bindListener(),this.bindWindowEvents(n)}},{key:"componentWillReceiveProps",value:function(e){var t=this.state.ariaProps,n=(0,w.parseAria)(e);Object.keys(n).some(function(e){return n[e]!==t[e]})&&this.setState({ariaProps:n})}},{key:"componentWillUnmount",value:function(){this.mount=!1,this.clearTimer(),this.unbindListener(),this.removeScrollListener(),this.unbindWindowEvents()}},{key:"mouseOnToolTip",value:function(){return!(!this.state.show||!this.tooltipRef)&&(this.tooltipRef.matches||(this.tooltipRef.matches=this.tooltipRef.msMatchesSelector),this.tooltipRef.matches(":hover"))}},{key:"getTargetArray",value:function(e){var t=void 0;if(e){var n=e.replace(/\\/g,"\\\\").replace(/"/g,'\\"');t=document.querySelectorAll('[data-tip][data-for="'+n+'"]')}else t=document.querySelectorAll("[data-tip]:not([data-for])");return(0,k.default)(t)}},{key:"bindListener",value:function(){var r=this,e=this.props,t=e.id,n=e.globalEventOff,i=e.isCapture;this.getTargetArray(t).forEach(function(e){var t=r.isCapture(e),n=r.getEffect(e);null===e.getAttribute("currentItem")&&e.setAttribute("currentItem","false"),r.unbindBasicListener(e),r.isCustomEvent(e)?r.customBindListener(e):(e.addEventListener("mouseenter",r.showTooltip,t),"float"===n&&e.addEventListener("mousemove",r.updateTooltip,t),e.addEventListener("mouseleave",r.hideTooltip,t))}),n&&(window.removeEventListener(n,this.hideTooltip),window.addEventListener(n,this.hideTooltip,i)),this.bindRemovalTracker()}},{key:"unbindListener",value:function(){var t=this,e=this.props,n=e.id,r=e.globalEventOff;this.getTargetArray(n).forEach(function(e){t.unbindBasicListener(e),t.isCustomEvent(e)&&t.customUnbindListener(e)}),r&&window.removeEventListener(r,this.hideTooltip),this.unbindRemovalTracker()}},{key:"unbindBasicListener",value:function(e){var t=this.isCapture(e);e.removeEventListener("mouseenter",this.showTooltip,t),e.removeEventListener("mousemove",this.updateTooltip,t),e.removeEventListener("mouseleave",this.hideTooltip,t)}},{key:"getTooltipContent",value:function(){var e=this.props,t=e.getContent,n=e.children,r=void 0;return t&&(r=Array.isArray(t)?t[0]&&t[0](this.state.originTooltip):t(this.state.originTooltip)),(0,_.default)(this.state.originTooltip,n,r,this.state.isMultiline)}},{key:"isEmptyTip",value:function(e){return"string"==typeof e&&""===e||null===e}},{key:"showTooltip",value:function(t,e){if(!e||this.getTargetArray(this.props.id).some(function(e){return e===t.currentTarget})){var n=this.props,r=n.multiline,i=n.getContent,o=t.currentTarget.getAttribute("data-tip"),a=t.currentTarget.getAttribute("data-multiline")||r||!1,s=t instanceof window.FocusEvent||e,l=!0;t.currentTarget.getAttribute("data-scroll-hide")?l="true"===t.currentTarget.getAttribute("data-scroll-hide"):null!=this.props.scrollHide&&(l=this.props.scrollHide);var c=t.currentTarget.getAttribute("data-place")||this.props.place||"top",u=s?"solid":this.getEffect(t.currentTarget),p=t.currentTarget.getAttribute("data-offset")||this.props.offset||{},d=(0,b.default)(t,t.currentTarget,y.default.findDOMNode(this),c,c,u,p),f=d.isNewState?d.newState.place:c;this.clearTimer();var h=t.currentTarget,m=this.state.show?h.getAttribute("data-delay-update")||this.props.delayUpdate:0,g=this,v=function(){g.setState({originTooltip:o,isMultiline:a,desiredPlace:c,place:f,type:h.getAttribute("data-type")||g.props.type||"dark",effect:u,offset:p,html:h.getAttribute("data-html")?"true"===h.getAttribute("data-html"):g.props.html||!1,delayShow:h.getAttribute("data-delay-show")||g.props.delayShow||0,delayHide:h.getAttribute("data-delay-hide")||g.props.delayHide||0,delayUpdate:h.getAttribute("data-delay-update")||g.props.delayUpdate||0,border:h.getAttribute("data-border")?"true"===h.getAttribute("data-border"):g.props.border||!1,extraClass:h.getAttribute("data-class")||g.props.class||g.props.className||"",disable:h.getAttribute("data-tip-disable")?"true"===h.getAttribute("data-tip-disable"):g.props.disable||!1,currentTarget:h},function(){l&&g.addScrollListener(g.state.currentTarget),g.updateTooltip(t),i&&Array.isArray(i)&&(g.intervalUpdateContent=setInterval(function(){if(g.mount){var e=g.props.getContent,t=(0,_.default)(o,"",e[0](),a),n=g.isEmptyTip(t);g.setState({isEmptyTip:n}),g.updatePosition()}},i[1]))})};m?this.delayReshow=setTimeout(v,m):v()}}},{key:"updateTooltip",value:function(t){var n=this,e=this.state,r=e.delayShow,i=e.disable,o=this.props.afterShow,a=this.getTooltipContent(),s=parseInt(r,10),l=t.currentTarget||t.target;if(!this.mouseOnToolTip()&&!this.isEmptyTip(a)&&!i){var c=function(){if(Array.isArray(a)&&0<a.length||a){var e=!n.state.show;n.setState({currentEvent:t,currentTarget:l,show:!0},function(){n.updatePosition(),e&&o&&o()})}};clearTimeout(this.delayShowLoop),r?this.delayShowLoop=setTimeout(c,s):c()}}},{key:"listenForTooltipExit",value:function(){this.state.show&&this.tooltipRef&&this.tooltipRef.addEventListener("mouseleave",this.hideTooltip)}},{key:"removeListenerForTooltipExit",value:function(){this.state.show&&this.tooltipRef&&this.tooltipRef.removeEventListener("mouseleave",this.hideTooltip)}},{key:"hideTooltip",value:function(t,e){var n=this,r=this.state,i=r.delayHide,o=r.disable,a=this.props.afterHide,s=this.getTooltipContent();if(this.mount&&!this.isEmptyTip(s)&&!o){if(e&&(!this.getTargetArray(this.props.id).some(function(e){return e===t.currentTarget})||!this.state.show))return;var l=function(){var e=n.state.show;n.mouseOnToolTip()?n.listenForTooltipExit():(n.removeListenerForTooltipExit(),n.setState({show:!1},function(){n.removeScrollListener(),e&&a&&a()}))};this.clearTimer(),i?this.delayHideLoop=setTimeout(l,parseInt(i,10)):l()}}},{key:"addScrollListener",value:function(e){var t=this.isCapture(e);window.addEventListener("scroll",this.hideTooltip,t)}},{key:"removeScrollListener",value:function(){window.removeEventListener("scroll",this.hideTooltip)}},{key:"updatePosition",value:function(){var e=this,t=this.state,n=t.currentEvent,r=t.currentTarget,i=t.place,o=t.desiredPlace,a=t.effect,s=t.offset,l=y.default.findDOMNode(this),c=(0,b.default)(n,r,l,i,o,a,s);if(c.isNewState)return this.setState(c.newState,function(){e.updatePosition()});l.style.left=c.position.left+"px",l.style.top=c.position.top+"px"}},{key:"setStyleHeader",value:function(){var e=document.getElementsByTagName("head")[0];if(!e.querySelector('style[id="react-tooltip"]')){var t=document.createElement("style");t.id="react-tooltip",t.innerHTML=x.default,"undefined"!=typeof __webpack_nonce__&&__webpack_nonce__&&t.setAttribute("nonce",__webpack_nonce__),e.insertBefore(t,e.firstChild)}}},{key:"clearTimer",value:function(){clearTimeout(this.delayShowLoop),clearTimeout(this.delayHideLoop),clearTimeout(this.delayReshow),clearInterval(this.intervalUpdateContent)}},{key:"render",value:function(){var t=this,e=this.state,n=e.extraClass,r=e.html,i=e.ariaProps,o=e.disable,a=this.getTooltipContent(),s=this.isEmptyTip(a),l=(0,f.default)("__react_component_tooltip",{show:this.state.show&&!o&&!s},{border:this.state.border},{"place-top":"top"===this.state.place},{"place-bottom":"bottom"===this.state.place},{"place-left":"left"===this.state.place},{"place-right":"right"===this.state.place},{"type-dark":"dark"===this.state.type},{"type-success":"success"===this.state.type},{"type-warning":"warning"===this.state.type},{"type-error":"error"===this.state.type},{"type-info":"info"===this.state.type},{"type-light":"light"===this.state.type},{allow_hover:this.props.delayUpdate}),c=this.props.wrapper;return u.supportedWrappers.indexOf(c)<0&&(c=u.defaultProps.wrapper),r?d.default.createElement(c,p({className:l+" "+n,id:this.props.id,ref:function(e){return t.tooltipRef=e}},i,{"data-id":"tooltip",dangerouslySetInnerHTML:{__html:(0,h.default)(a,this.props.sanitizeHtmlOptions)}})):d.default.createElement(c,p({className:l+" "+n,id:this.props.id},i,{ref:function(e){return t.tooltipRef=e},"data-id":"tooltip"}),a)}}]),u}(),i.propTypes={children:s.default.any,place:s.default.string,type:s.default.string,effect:s.default.string,offset:s.default.object,multiline:s.default.bool,border:s.default.bool,insecure:s.default.bool,class:s.default.string,className:s.default.string,id:s.default.string,html:s.default.bool,delayHide:s.default.number,delayUpdate:s.default.number,delayShow:s.default.number,event:s.default.string,eventOff:s.default.string,watchWindow:s.default.bool,isCapture:s.default.bool,globalEventOff:s.default.string,getContent:s.default.any,afterShow:s.default.func,afterHide:s.default.func,disable:s.default.bool,scrollHide:s.default.bool,resizeHide:s.default.bool,wrapper:s.default.string,sanitizeHtmlOptions:s.default.any},i.defaultProps={insecure:!0,resizeHide:!0,wrapper:"div"},i.supportedWrappers=["div","span"],i.displayName="ReactTooltip",r=o))||r)||r)||r)||r)||r)||r;t.exports=C},{"./decorators/customEvent":271,"./decorators/getEffect":272,"./decorators/isCapture":273,"./decorators/staticMethods":274,"./decorators/trackRemoval":275,"./decorators/windowListener":276,"./style":278,"./utils/aria":279,"./utils/getPosition":280,"./utils/getTipContent":281,"./utils/nodeListToArray":282,classnames:118,"prop-types":236,react:284,"react-dom":240,"sanitize-html-react":309}],278:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default='.__react_component_tooltip{border-radius:3px;display:inline-block;font-size:13px;left:-999em;opacity:0;padding:8px 21px;position:fixed;pointer-events:none;transition:opacity 0.3s ease-out;top:-999em;visibility:hidden;z-index:999}.__react_component_tooltip.allow_hover{pointer-events:auto}.__react_component_tooltip:before,.__react_component_tooltip:after{content:"";width:0;height:0;position:absolute}.__react_component_tooltip.show{opacity:0.9;margin-top:0px;margin-left:0px;visibility:visible}.__react_component_tooltip.type-dark{color:#fff;background-color:#222}.__react_component_tooltip.type-dark.place-top:after{border-top-color:#222;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-dark.place-bottom:after{border-bottom-color:#222;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-dark.place-left:after{border-left-color:#222;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-dark.place-right:after{border-right-color:#222;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-dark.border{border:1px solid #fff}.__react_component_tooltip.type-dark.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-dark.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-dark.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-dark.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-success{color:#fff;background-color:#8DC572}.__react_component_tooltip.type-success.place-top:after{border-top-color:#8DC572;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-success.place-bottom:after{border-bottom-color:#8DC572;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-success.place-left:after{border-left-color:#8DC572;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-success.place-right:after{border-right-color:#8DC572;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-success.border{border:1px solid #fff}.__react_component_tooltip.type-success.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-success.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-success.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-success.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-warning{color:#fff;background-color:#F0AD4E}.__react_component_tooltip.type-warning.place-top:after{border-top-color:#F0AD4E;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-warning.place-bottom:after{border-bottom-color:#F0AD4E;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-warning.place-left:after{border-left-color:#F0AD4E;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-warning.place-right:after{border-right-color:#F0AD4E;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-warning.border{border:1px solid #fff}.__react_component_tooltip.type-warning.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-warning.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-warning.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-warning.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-error{color:#fff;background-color:#BE6464}.__react_component_tooltip.type-error.place-top:after{border-top-color:#BE6464;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-error.place-bottom:after{border-bottom-color:#BE6464;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-error.place-left:after{border-left-color:#BE6464;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-error.place-right:after{border-right-color:#BE6464;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-error.border{border:1px solid #fff}.__react_component_tooltip.type-error.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-error.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-error.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-error.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-info{color:#fff;background-color:#337AB7}.__react_component_tooltip.type-info.place-top:after{border-top-color:#337AB7;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-info.place-bottom:after{border-bottom-color:#337AB7;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-info.place-left:after{border-left-color:#337AB7;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-info.place-right:after{border-right-color:#337AB7;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-info.border{border:1px solid #fff}.__react_component_tooltip.type-info.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-info.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-info.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-info.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-light{color:#222;background-color:#fff}.__react_component_tooltip.type-light.place-top:after{border-top-color:#fff;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-light.place-bottom:after{border-bottom-color:#fff;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-light.place-left:after{border-left-color:#fff;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-light.place-right:after{border-right-color:#fff;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-light.border{border:1px solid #222}.__react_component_tooltip.type-light.border.place-top:before{border-top:8px solid #222}.__react_component_tooltip.type-light.border.place-bottom:before{border-bottom:8px solid #222}.__react_component_tooltip.type-light.border.place-left:before{border-left:8px solid #222}.__react_component_tooltip.type-light.border.place-right:before{border-right:8px solid #222}.__react_component_tooltip.place-top{margin-top:-10px}.__react_component_tooltip.place-top:before{border-left:10px solid transparent;border-right:10px solid transparent;bottom:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-top:after{border-left:8px solid transparent;border-right:8px solid transparent;bottom:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-bottom{margin-top:10px}.__react_component_tooltip.place-bottom:before{border-left:10px solid transparent;border-right:10px solid transparent;top:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-bottom:after{border-left:8px solid transparent;border-right:8px solid transparent;top:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-left{margin-left:-10px}.__react_component_tooltip.place-left:before{border-top:6px solid transparent;border-bottom:6px solid transparent;right:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-left:after{border-top:5px solid transparent;border-bottom:5px solid transparent;right:-6px;top:50%;margin-top:-4px}.__react_component_tooltip.place-right{margin-left:10px}.__react_component_tooltip.place-right:before{border-top:6px solid transparent;border-bottom:6px solid transparent;left:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-right:after{border-top:5px solid transparent;border-bottom:5px solid transparent;left:-6px;top:50%;margin-top:-4px}.__react_component_tooltip .multi-line{display:block;padding:2px 0px;text-align:center}'},{}],279:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.parseAria=function(t){var n={};return Object.keys(t).filter(function(e){return/(^aria-\w+$|^role$)/.test(e)}).forEach(function(e){n[e]=t[e]}),n}},{}],280:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n,r,i,o,a){for(var s=R(n),l=s.width,c=s.height,u=R(t),p=u.width,d=u.height,f=j(e,t,o),h=f.mouseX,m=f.mouseY,g=B(o,p,d,l,c),v=M(a),y=v.extraOffset_X,b=v.extraOffset_Y,_=window.innerWidth,w=window.innerHeight,k=F(n),x=k.parentTop,E=k.parentLeft,C=function(e){var t=g[e].l;return h+t+y},S=function(e){var t=g[e].t;return m+t+b},T=function(e){return C(e)<0||(n=g[e].r,_<h+n+y)||S(e)<0||(t=g[e].b,w<m+t+b);var t,n},A=function(e){return!T(e)},N=["top","bottom","left","right"],O=[],P=0;P<4;P++){var I=N[P];A(I)&&O.push(I)}var D=!1,L=void 0;return A(i)&&i!==r?(D=!0,L=i):0<O.length&&T(i)&&T(r)&&(D=!0,L=O[0]),D?{isNewState:!0,newState:{place:L}}:{isNewState:!1,position:{left:parseInt(C(r)-E,10),top:parseInt(S(r)-x,10)}}};var R=function(e){var t=e.getBoundingClientRect(),n=t.height,r=t.width;return{height:parseInt(n,10),width:parseInt(r,10)}},j=function(e,t,n){var r=t.getBoundingClientRect(),i=r.top,o=r.left,a=R(t),s=a.width,l=a.height;return"float"===n?{mouseX:e.clientX,mouseY:e.clientY}:{mouseX:o+s/2,mouseY:i+l/2}},B=function(e,t,n,r,i){var o=void 0,a=void 0,s=void 0,l=void 0;return"float"===e?(o={l:-r/2,r:r/2,t:-(i+3+2),b:-3},s={l:-r/2,r:r/2,t:15,b:i+3+2+12},l={l:-(r+3+2),r:-3,t:-i/2,b:i/2},a={l:3,r:r+3+2,t:-i/2,b:i/2}):"solid"===e&&(o={l:-r/2,r:r/2,t:-(n/2+i+2),b:-n/2},s={l:-r/2,r:r/2,t:n/2,b:n/2+i+2},l={l:-(r+t/2+2),r:-t/2,t:-i/2,b:i/2},a={l:t/2,r:r+t/2+2,t:-i/2,b:i/2}),{top:o,bottom:s,left:l,right:a}},M=function(e){var t=0,n=0;for(var r in"[object String]"===Object.prototype.toString.apply(e)&&(e=JSON.parse(e.toString().replace(/\'/g,'"'))),e)"top"===r?n-=parseInt(e[r],10):"bottom"===r?n+=parseInt(e[r],10):"left"===r?t-=parseInt(e[r],10):"right"===r&&(t+=parseInt(e[r],10));return{extraOffset_X:t,extraOffset_Y:n}},F=function(e){for(var t=e;t&&"none"===window.getComputedStyle(t).getPropertyValue("transform");)t=t.parentElement;return{parentTop:t&&t.getBoundingClientRect().top||0,parentLeft:t&&t.getBoundingClientRect().left||0}}},{}],281:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n,r){if(t)return t;if(null!=n)return n;if(null===n)return null;var i=/<br\s*\/?>/;return r&&"false"!==r&&i.test(e)?e.split(i).map(function(e,t){return o.default.createElement("span",{key:t,className:"multi-line"},e)}):e};var r,i=e("react"),o=(r=i)&&r.__esModule?r:{default:r}},{react:284}],282:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){var e=t.length;return t.hasOwnProperty?Array.prototype.slice.call(t):new Array(e).fill().map(function(e){return t[e]})}},{}],283:[function(e,t,n){"use strict";var u=e("object-assign"),r="function"==typeof Symbol&&Symbol.for,p=r?Symbol.for("react.element"):60103,c=r?Symbol.for("react.portal"):60106,i=r?Symbol.for("react.fragment"):60107,o=r?Symbol.for("react.strict_mode"):60108,a=r?Symbol.for("react.profiler"):60114,s=r?Symbol.for("react.provider"):60109,l=r?Symbol.for("react.context"):60110,d=r?Symbol.for("react.concurrent_mode"):60111,f=r?Symbol.for("react.forward_ref"):60112,h=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,v="function"==typeof Symbol&&Symbol.iterator;function y(e){for(var t=arguments.length-1,n="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=0;r<t;r++)n+="&args[]="+encodeURIComponent(arguments[r+1]);!function(e,t,n,r,i,o,a,s){if(!e){if((e=void 0)===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,r,i,o,a,s],c=0;(e=Error(t.replace(/%s/g,function(){return l[c++]}))).name="Invariant Violation"}throw e.framesToPop=1,e}}(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",n)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_={};function w(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||b}function k(){}function x(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||b}w.prototype.isReactComponent={},w.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e&&y("85"),this.updater.enqueueSetState(this,e,t,"setState")},w.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},k.prototype=w.prototype;var E=x.prototype=new k;E.constructor=x,u(E,w.prototype),E.isPureReactComponent=!0;var C={current:null},S={current:null},T=Object.prototype.hasOwnProperty,A={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,n){var r=void 0,i={},o=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)T.call(t,r)&&!A.hasOwnProperty(r)&&(i[r]=t[r]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var l=Array(s),c=0;c<s;c++)l[c]=arguments[c+2];i.children=l}if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===i[r]&&(i[r]=s[r]);return{$$typeof:p,type:e,key:o,ref:a,props:i,_owner:S.current}}function O(e){return"object"==typeof e&&null!==e&&e.$$typeof===p}var P=/\/+/g,I=[];function D(e,t,n,r){if(I.length){var i=I.pop();return i.result=e,i.keyPrefix=t,i.func=n,i.context=r,i.count=0,i}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function L(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,I.length<10&&I.push(e)}function R(e,t,n){return null==e?0:function e(t,n,r,i){var o=typeof t;"undefined"!==o&&"boolean"!==o||(t=null);var a=!1;if(null===t)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case p:case c:a=!0}}if(a)return r(i,t,""===n?"."+j(t,0):n),1;if(a=0,n=""===n?".":n+":",Array.isArray(t))for(var s=0;s<t.length;s++){var l=n+j(o=t[s],s);a+=e(o,l,r,i)}else if("function"==typeof(l=null===t||"object"!=typeof t?null:"function"==typeof(l=v&&t[v]||t["@@iterator"])?l:null))for(t=l.call(t),s=0;!(o=t.next()).done;)a+=e(o=o.value,l=n+j(o,s++),r,i);else"object"===o&&y("31","[object Object]"==(r=""+t)?"object with keys {"+Object.keys(t).join(", ")+"}":r,"");return a}(e,"",t,n)}function j(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(n=e.key,r={"=":"=0",":":"=2"},"$"+(""+n).replace(/[=:]/g,function(e){return r[e]})):t.toString(36);var n,r}function B(e,t){e.func.call(e.context,t,e.count++)}function M(e,t,n){var r,i,o=e.result,a=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?F(e,o,n,function(e){return e}):null!=e&&(O(e)&&(i=a+(!(r=e).key||t&&t.key===e.key?"":(""+e.key).replace(P,"$&/")+"/")+n,e={$$typeof:p,type:r.type,key:i,ref:r.ref,props:r.props,_owner:r._owner}),o.push(e))}function F(e,t,n,r,i){var o="";null!=n&&(o=(""+n).replace(P,"$&/")+"/"),R(e,M,t=D(t,o,r,i)),L(t)}function U(){var e=C.current;return null===e&&y("307"),e}var q={Children:{map:function(e,t,n){if(null==e)return e;var r=[];return F(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;R(e,B,t=D(null,null,t,n)),L(t)},count:function(e){return R(e,function(){return null},null)},toArray:function(e){var t=[];return F(e,t,null,function(e){return e}),t},only:function(e){return O(e)||y("143"),e}},createRef:function(){return{current:null}},Component:w,PureComponent:x,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:l,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:f,render:e}},lazy:function(e){return{$$typeof:g,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:m,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return U().useCallback(e,t)},useContext:function(e,t){return U().useContext(e,t)},useEffect:function(e,t){return U().useEffect(e,t)},useImperativeHandle:function(e,t,n){return U().useImperativeHandle(e,t,n)},useDebugValue:function(){},useLayoutEffect:function(e,t){return U().useLayoutEffect(e,t)},useMemo:function(e,t){return U().useMemo(e,t)},useReducer:function(e,t,n){return U().useReducer(e,t,n)},useRef:function(e){return U().useRef(e)},useState:function(e){return U().useState(e)},Fragment:i,StrictMode:o,Suspense:h,createElement:N,cloneElement:function(e,t,n){null==e&&y("267",e);var r=void 0,i=u({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=t){void 0!==t.ref&&(a=t.ref,s=S.current),void 0!==t.key&&(o=""+t.key);var l=void 0;for(r in e.type&&e.type.defaultProps&&(l=e.type.defaultProps),t)T.call(t,r)&&!A.hasOwnProperty(r)&&(i[r]=void 0===t[r]&&void 0!==l?l[r]:t[r])}if(1==(r=arguments.length-2))i.children=n;else if(1<r){l=Array(r);for(var c=0;c<r;c++)l[c]=arguments[c+2];i.children=l}return{$$typeof:p,type:e.type,key:o,ref:a,props:i,_owner:s}},createFactory:function(e){var t=N.bind(null,e);return t.type=e,t},isValidElement:O,version:"16.8.3",unstable_ConcurrentMode:d,unstable_Profiler:a,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:C,ReactCurrentOwner:S,assign:u}},H=q;t.exports=H.default||H},{"object-assign":214}],284:[function(e,t,n){"use strict";t.exports=e("./cjs/react.production.min.js")},{"./cjs/react.production.min.js":283}],285:[function(e,t,n){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":286}],286:[function(e,t,n){"use strict";var r=e("process-nextick-args"),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=p;var o=e("core-util-is");o.inherits=e("inherits");var a=e("./_stream_readable"),s=e("./_stream_writable");o.inherits(p,a);for(var l=i(s.prototype),c=0;c<l.length;c++){var u=l[c];p.prototype[u]||(p.prototype[u]=s.prototype[u])}function p(e){if(!(this instanceof p))return new p(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(p.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(p.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),p.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},{"./_stream_readable":288,"./_stream_writable":290,"core-util-is":119,inherits:174,"process-nextick-args":233}],287:[function(e,t,n){"use strict";t.exports=o;var r=e("./_stream_transform"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=e("inherits"),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":289,"core-util-is":119,inherits:174}],288:[function(D,L,e){(function(m,e){"use strict";var g=D("process-nextick-args");L.exports=u;var a,v=D("isarray");u.ReadableState=o;D("events").EventEmitter;var y=function(e,t){return e.listeners(t).length},i=D("./internal/streams/stream"),f=D("safe-buffer").Buffer,h=e.Uint8Array||function(){};var t=D("core-util-is");t.inherits=D("inherits");var n=D("util"),b=void 0;b=n&&n.debuglog?n.debuglog("stream"):function(){};var s,l=D("./internal/streams/BufferList"),r=D("./internal/streams/destroy");t.inherits(u,i);var c=["error","close","destroy","pause","resume"];function o(e,t){e=e||{};var n=t instanceof(a=a||D("./_stream_duplex"));this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,i=e.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(i||0===i)?i:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new l,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(s||(s=D("string_decoder/").StringDecoder),this.decoder=new s(e.encoding),this.encoding=e.encoding)}function u(e){if(a=a||D("./_stream_duplex"),!(this instanceof u))return new u(e);this._readableState=new o(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),i.call(this)}function p(e,t,n,r,i){var o,a,s,l,c,u,p,d=e._readableState;return null===t?(d.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,k(e)}}(e,d)):(i||(s=d,u=l=t,f.isBuffer(u)||u instanceof h||"string"==typeof l||void 0===l||s.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),o=c),o?e.emit("error",o):d.objectMode||t&&0<t.length?("string"==typeof t||d.objectMode||Object.getPrototypeOf(t)===f.prototype||(a=t,t=f.from(a)),r?d.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):_(e,d,t,!0):d.ended?e.emit("error",new Error("stream.push() after EOF")):(d.reading=!1,d.decoder&&!n?(t=d.decoder.write(t),d.objectMode||0!==t.length?_(e,d,t,!1):E(e,d)):_(e,d,t,!1))):r||(d.reading=!1)),!(p=d).ended&&(p.needReadable||p.length<p.highWaterMark||0===p.length)}function _(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&k(e)),E(e,t)}Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),u.prototype.destroy=r.destroy,u.prototype._undestroy=r.undestroy,u.prototype._destroy=function(e,t){this.push(null),t(e)},u.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=f.from(e,t),t=""),n=!0),p(this,e,t,!1,n)},u.prototype.unshift=function(e){return p(this,e,null,!0,!1)},u.prototype.isPaused=function(){return!1===this._readableState.flowing},u.prototype.setEncoding=function(e){return s||(s=D("string_decoder/").StringDecoder),this._readableState.decoder=new s(e),this._readableState.encoding=e,this};var d=8388608;function w(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=(d<=(n=e)?n=d:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var n}function k(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(b("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?g.nextTick(x,e):x(e))}function x(e){b("emit readable"),e.emit("readable"),A(e)}function E(e,t){t.readingMore||(t.readingMore=!0,g.nextTick(C,e,t))}function C(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(b("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function S(e){b("readable nexttick read 0"),e.read(0)}function T(e,t){t.reading||(b("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),A(e),t.flowing&&!t.reading&&e.read(0)}function A(e){var t=e._readableState;for(b("flow",t.flowing);t.flowing&&null!==e.read(););}function N(e,t){return 0===t.length?null:(t.objectMode?a=t.buffer.shift():!e||e>=t.length?(a=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):(n=e,r=t.buffer,i=t.decoder,n<r.head.data.length?(o=r.head.data.slice(0,n),r.head.data=r.head.data.slice(n)):o=n===r.head.data.length?r.shift():i?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(a===o.length?i+=o:i+=o.slice(0,e),0==(e-=a)){a===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n).data=o.slice(a);break}++r}return t.length-=r,i}(n,r):function(e,t){var n=f.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,a=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,a),0==(e-=a)){a===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r).data=o.slice(a);break}++i}return t.length-=i,n}(n,r),a=o),a);var n,r,i,o,a}function O(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,g.nextTick(P,t,e))}function P(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function I(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}u.prototype.read=function(e){b("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return b("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?O(this):k(this),null;if(0===(e=w(e,t))&&t.ended)return 0===t.length&&O(this),null;var r,i=t.needReadable;return b("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&b("length less than watermark",i=!0),t.ended||t.reading?b("reading or ended",i=!1):i&&(b("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=w(n,t))),null===(r=0<e?N(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&O(this)),null!==r&&this.emit("data",r),r},u.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},u.prototype.pipe=function(r,e){var i=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=r;break;case 1:o.pipes=[o.pipes,r];break;default:o.pipes.push(r)}o.pipesCount+=1,b("pipe count=%d opts=%j",o.pipesCount,e);var t=e&&!1===e.end||r===m.stdout||r===m.stderr?h:a;function a(){b("onend"),r.end()}o.endEmitted?g.nextTick(t):i.once("end",t),r.on("unpipe",function e(t,n){b("onunpipe"),t===i&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,b("cleanup"),r.removeListener("close",d),r.removeListener("finish",f),r.removeListener("drain",s),r.removeListener("error",p),r.removeListener("unpipe",e),i.removeListener("end",a),i.removeListener("end",h),i.removeListener("data",u),l=!0,!o.awaitDrain||r._writableState&&!r._writableState.needDrain||s())});var n,s=(n=i,function(){var e=n._readableState;b("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&y(n,"data")&&(e.flowing=!0,A(n))});r.on("drain",s);var l=!1,c=!1;function u(e){b("ondata"),(c=!1)!==r.write(e)||c||((1===o.pipesCount&&o.pipes===r||1<o.pipesCount&&-1!==I(o.pipes,r))&&!l&&(b("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,c=!0),i.pause())}function p(e){b("onerror",e),h(),r.removeListener("error",p),0===y(r,"error")&&r.emit("error",e)}function d(){r.removeListener("finish",f),h()}function f(){b("onfinish"),r.removeListener("close",d),h()}function h(){b("unpipe"),i.unpipe(r)}return i.on("data",u),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?v(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(r,"error",p),r.once("close",d),r.once("finish",f),r.emit("pipe",i),o.flowing||(b("pipe resume"),i.resume()),r},u.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var a=I(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},u.prototype.addListener=u.prototype.on=function(e,t){var n=i.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&k(this):g.nextTick(S,this))}return n},u.prototype.resume=function(){var e,t,n=this._readableState;return n.flowing||(b("resume"),n.flowing=!0,e=this,(t=n).resumeScheduled||(t.resumeScheduled=!0,g.nextTick(T,e,t))),this},u.prototype.pause=function(){return b("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(b("pause"),this._readableState.flowing=!1,this.emit("pause")),this},u.prototype.wrap=function(t){var n=this,r=this._readableState,i=!1;for(var e in t.on("end",function(){if(b("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),t.on("data",function(e){b("wrapped data"),r.decoder&&(e=r.decoder.write(e)),(!r.objectMode||null!=e)&&(r.objectMode||e&&e.length)&&(n.push(e)||(i=!0,t.pause()))}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var o=0;o<c.length;o++)t.on(c[o],this.emit.bind(this,c[o]));return this._read=function(e){b("wrapped _read",e),i&&(i=!1,t.resume())},this},Object.defineProperty(u.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),u._fromList=N}).call(this,D("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":286,"./internal/streams/BufferList":291,"./internal/streams/destroy":292,"./internal/streams/stream":293,_process:234,"core-util-is":119,events:160,inherits:174,isarray:177,"process-nextick-args":233,"safe-buffer":294,"string_decoder/":295,util:116}],289:[function(e,t,n){"use strict";t.exports=o;var r=e("./_stream_duplex"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState={afterTransform:function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,(n.writecb=null)!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var n=this;"function"==typeof this._flush?this._flush(function(e,t){s(n,e,t)}):s(this,null,null)}function s(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},{"./_stream_duplex":286,"core-util-is":119,inherits:174}],290:[function(E,C,e){(function(e,t,n){"use strict";var v=E("process-nextick-args");function p(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}C.exports=u;var s,d=!e.browser&&-1<["v0.10","v0.9."].indexOf(e.version.slice(0,5))?n:v.nextTick;u.WritableState=c;var r=E("core-util-is");r.inherits=E("inherits");var i={deprecate:E("util-deprecate")},o=E("./internal/streams/stream"),y=E("safe-buffer").Buffer,b=t.Uint8Array||function(){};var a,l=E("./internal/streams/destroy");function _(){}function c(e,t){s=s||E("./_stream_duplex"),e=e||{};var n=t instanceof s;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=e.writableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(i||0===i)?i:o,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var a=(this.destroyed=!1)===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(p=n,p.writing=!1,p.writecb=null,p.length-=p.writelen,p.writelen=0,t)a=e,s=n,l=r,c=t,u=i,--s.pendingcb,l?(v.nextTick(u,c),v.nextTick(x,a,s),a._writableState.errorEmitted=!0,a.emit("error",c)):(u(c),a._writableState.errorEmitted=!0,a.emit("error",c),x(a,s));else{var o=g(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||m(e,n),r?d(h,e,n,o,i):h(e,n,o,i)}var a,s,l,c,u;var p}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new p(this)}function u(e){if(s=s||E("./_stream_duplex"),!(a.call(u,this)||this instanceof s))return new u(e);this._writableState=new c(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),o.call(this)}function w(e,t,n,r,i,o){if(!n){var a=(l=r,c=i,(s=t).objectMode||!1===s.decodeStrings||"string"!=typeof l||(l=y.from(l,c)),l);r!==a&&(n=!0,i="buffer",r=a)}var s,l,c,u=t.objectMode?1:r.length;t.length+=u;var p=t.length<t.highWaterMark;if(p||(t.needDrain=!0),t.writing||t.corked){var d=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},d?d.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else f(e,t,!1,u,r,i,o);return p}function f(e,t,n,r,i,o,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function h(e,t,n,r){var i,o;n||(i=e,0===(o=t).length&&o.needDrain&&(o.needDrain=!1,i.emit("drain"))),t.pendingcb--,r(),x(e,t)}function m(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,s=!0;n;)(i[a]=n).isBuf||(s=!1),n=n.next,a+=1;i.allBuffers=s,f(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new p(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,c=n.encoding,u=n.callback;if(f(e,t,!1,t.objectMode?1:l.length,l,c,u),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function g(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function k(t,n){t._final(function(e){n.pendingcb--,e&&t.emit("error",e),n.prefinished=!0,t.emit("prefinish"),x(t,n)})}function x(e,t){var n,r,i=g(t);return i&&(n=e,(r=t).prefinished||r.finalCalled||("function"==typeof n._final?(r.pendingcb++,r.finalCalled=!0,v.nextTick(k,n,r)):(r.prefinished=!0,n.emit("prefinish"))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),i}r.inherits(u,o),c.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(c.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(u,Symbol.hasInstance,{value:function(e){return!!a.call(this,e)||this===u&&e&&e._writableState instanceof c}})):a=function(e){return e instanceof this},u.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},u.prototype.write=function(e,t,n){var r,i,o,a,s,l,c,u,p,d,f,h=this._writableState,m=!1,g=!h.objectMode&&(r=e,y.isBuffer(r)||r instanceof b);return g&&!y.isBuffer(e)&&(f=e,e=y.from(f)),"function"==typeof t&&(n=t,t=null),g?t="buffer":t||(t=h.defaultEncoding),"function"!=typeof n&&(n=_),h.ended?(u=this,p=n,d=new Error("write after end"),u.emit("error",d),v.nextTick(p,d)):(g||(i=this,o=h,s=n,c=!(l=!0),null===(a=e)?c=new TypeError("May not write null values to stream"):"string"==typeof a||void 0===a||o.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c&&(i.emit("error",c),v.nextTick(s,c),l=!1),l))&&(h.pendingcb++,m=w(this,h,g,e,t,n)),m},u.prototype.cork=function(){this._writableState.corked++},u.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||m(this,e))},u.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),u.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},u.prototype._writev=null,u.prototype.end=function(e,t,n){var r,i,o,a=this._writableState;"function"==typeof e?(n=e,t=e=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),a.corked&&(a.corked=1,this.uncork()),a.ending||a.finished||(r=this,o=n,(i=a).ending=!0,x(r,i),o&&(i.finished?v.nextTick(o):r.once("finish",o)),i.ended=!0,r.writable=!1)},Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),u.prototype.destroy=l.destroy,u.prototype._undestroy=l.undestroy,u.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,E("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},E("timers").setImmediate)},{"./_stream_duplex":286,"./internal/streams/destroy":292,"./internal/streams/stream":293,_process:234,"core-util-is":119,inherits:174,"process-nextick-args":233,"safe-buffer":294,timers:334,"util-deprecate":335}],291:[function(e,t,n){"use strict";var s=e("safe-buffer").Buffer,r=e("util");t.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};0<this.length?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return s.alloc(0);if(1===this.length)return this.head.data;for(var t=s.allocUnsafe(e>>>0),n=this.head,r=0;n;)i=n.data,o=t,a=r,i.copy(o,a),r+=n.data.length,n=n.next;var i,o,a;return t},e}(),r&&r.inspect&&r.inspect.custom&&(t.exports.prototype[r.inspect.custom]=function(){var e=r.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":294,util:116}],292:[function(e,t,n){"use strict";var o=e("process-nextick-args");function a(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var n=this,r=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return r||i?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||o.nextTick(a,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(o.nextTick(a,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":233}],293:[function(e,t,n){t.exports=e("events").EventEmitter},{events:160}],294:[function(e,t,n){var r=e("buffer"),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,n),n.Buffer=a),o(i,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},{buffer:117}],295:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=p,t=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(1<e.lastNeed&&1<t.length){if(128!=(192&t[1]))return e.lastNeed=1,"";if(2<e.lastNeed&&2<t.length&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(55296<=r&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function p(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}(n.StringDecoder=o).prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=a(t[r]);return 0<=i?(0<i&&(e.lastNeed=i-1),i):--r<n||-2===i?0:0<=(i=a(t[r]))?(0<i&&(e.lastNeed=i-2),i):--r<n||-2===i?0:0<=(i=a(t[r]))?(0<i&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":294}],296:[function(e,t,n){t.exports=e("./readable").PassThrough},{"./readable":297}],297:[function(e,t,n){(((n=t.exports=e("./lib/_stream_readable.js")).Stream=n).Readable=n).Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":286,"./lib/_stream_passthrough.js":287,"./lib/_stream_readable.js":288,"./lib/_stream_transform.js":289,"./lib/_stream_writable.js":290}],298:[function(e,t,n){t.exports=e("./readable").Transform},{"./readable":297}],299:[function(e,t,n){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":290}],300:[function(e,t,n){"use strict";n.__esModule=!0;var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};n.default=function(){for(var e=arguments.length,l=Array(e),t=0;t<e;t++)l[t]=arguments[t];return function(s){return function(e,t,n){var r,i=s(e,t,n),o=i.dispatch,a={getState:i.getState,dispatch:function(e){return o(e)}};return r=l.map(function(e){return e(a)}),o=u.default.apply(void 0,r)(i.dispatch),c({},i,{dispatch:o})}}};var r,i=e("./compose"),u=(r=i)&&r.__esModule?r:{default:r}},{"./compose":303}],301:[function(e,t,n){"use strict";function s(e,t){return function(){return t(e.apply(void 0,arguments))}}n.__esModule=!0,n.default=function(e,t){if("function"==typeof e)return s(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var n=Object.keys(e),r={},i=0;i<n.length;i++){var o=n[i],a=e[o];"function"==typeof a&&(r[o]=s(a,t))}return r}},{}],302:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e){for(var t=Object.keys(e),f={},n=0;n<t.length;n++){var r=t[n];"function"==typeof e[r]&&(f[r]=e[r])}var h=Object.keys(f),m=void 0;try{i=f,Object.keys(i).forEach(function(e){var t=i[e];if(void 0===t(void 0,{type:o.ActionTypes.INIT}))throw new Error('Reducer "'+e+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===t(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+e+"\" returned undefined when probed with a random type. Don't try to handle "+o.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}catch(e){m=e}var i;return function(){var e,t,n,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1];if(m)throw m;for(var o=!1,a={},s=0;s<h.length;s++){var l=h[s],c=f[l],u=r[l],p=c(u,i);if(void 0===p){var d=(e=l,n=void 0,"Given action "+((n=(t=i)&&t.type)&&'"'+n.toString()+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.');throw new Error(d)}a[l]=p,o=o||p!==u}return o?a:r}};var o=e("./createStore");r(e("lodash/isPlainObject")),r(e("./utils/warning"));function r(e){return e&&e.__esModule?e:{default:e}}},{"./createStore":304,"./utils/warning":306,"lodash/isPlainObject":205}],303:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}},{}],304:[function(e,t,n){"use strict";n.__esModule=!0,n.ActionTypes=void 0,n.default=function e(t,n,r){var i;if("function"==typeof n&&void 0===r&&(r=n,n=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(e)(t,n)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var o=t,a=n,s=[],l=s,c=!1;function u(){l===s&&(l=s.slice())}function p(){return a}function d(t){if("function"!=typeof t)throw new Error("Expected listener to be a function.");var n=!0;return u(),l.push(t),function(){if(n){n=!1,u();var e=l.indexOf(t);l.splice(e,1)}}}function f(e){if(!(0,h.default)(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,a=o(a,e)}finally{c=!1}for(var t=s=l,n=0;n<t.length;n++)(0,t[n])();return e}return f({type:g.INIT}),(i={dispatch:f,subscribe:d,getState:p,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");o=e,f({type:g.INIT})}})[m.default]=function(){var e,n=d;return(e={subscribe:function(e){if("object"!=typeof e)throw new TypeError("Expected the observer to be an object.");function t(){e.next&&e.next(p())}return t(),{unsubscribe:n(t)}}})[m.default]=function(){return this},e},i};var h=r(e("lodash/isPlainObject")),m=r(e("symbol-observable"));function r(e){return e&&e.__esModule?e:{default:e}}var g=n.ActionTypes={INIT:"@@redux/INIT"}},{"lodash/isPlainObject":205,"symbol-observable":332}],305:[function(e,t,n){"use strict";n.__esModule=!0,n.compose=n.applyMiddleware=n.bindActionCreators=n.combineReducers=n.createStore=void 0;var r=l(e("./createStore")),i=l(e("./combineReducers")),o=l(e("./bindActionCreators")),a=l(e("./applyMiddleware")),s=l(e("./compose"));l(e("./utils/warning"));function l(e){return e&&e.__esModule?e:{default:e}}n.createStore=r.default,n.combineReducers=i.default,n.bindActionCreators=o.default,n.applyMiddleware=a.default,n.compose=s.default},{"./applyMiddleware":300,"./bindActionCreators":301,"./combineReducers":302,"./compose":303,"./createStore":304,"./utils/warning":306}],306:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},{}],307:[function(e,t,n){t.exports=function(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}},{}],308:[function(e,t,n){var r=e("buffer"),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,n),n.Buffer=a),a.prototype=Object.create(i.prototype),o(i,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},{buffer:117}],309:[function(e,t,n){var r=e("htmlparser2"),i=e("xtend"),o=e("regexp-quote");function _(t,n){t&&Object.keys(t).forEach(function(e){n(t[e],e)})}function w(e,t){return{}.hasOwnProperty.call(e,t)}function k(e,a,t){var s="";a?(a=i(k.defaults,a)).parser?a.parser=i(x,a.parser):a.parser=x:(a=k.defaults).parser=x;var l,c,u=a.nonTextTags||["script","style","textarea"];a.allowedAttributes&&(l={},c={},_(a.allowedAttributes,function(e,t){l[t]=[];var n=[];e.forEach(function(e){0<=e.indexOf("*")?n.push(o(e).replace(/\\\*/g,".*")):l[t].push(e)}),c[t]=new RegExp("^("+n.join("|")+")$")}));var p={};_(a.allowedClasses,function(e,t){l&&(w(l,t)||(l[t]=[]),l[t].push("class")),p[t]=e});var d,f={};_(a.transformTags,function(e,t){var n;"function"==typeof e?n=e:"string"==typeof e&&(n=k.simpleTransform(e)),"*"===t?d=n:f[t]=n});var h=0,m=[],g={},v={},y=!1,b=0,n=new r.Parser({onopentag:function(r,e){if(y)b++;else{var o=new function(e,t){var n=this;this.tag=e,this.attribs=t||{},this.tagPosition=s.length,this.text="",this.updateParentNodeText=function(){m.length&&(m[m.length-1].text+=n.text)}}(r,e);m.push(o);var t,n=!1,i=!!o.text;w(f,r)&&(t=f[r](r,e),o.attribs=e=t.attribs,void 0!==t.text&&(o.innerText=t.text),r!==t.tagName&&(o.name=r=t.tagName,v[h]=t.tagName)),d&&(t=d(r,e),o.attribs=e=t.attribs,r!==t.tagName&&(o.name=r=t.tagName,v[h]=t.tagName)),a.allowedTags&&-1===a.allowedTags.indexOf(r)&&(n=!0,-1!==u.indexOf(r)&&(y=!0,b=1),g[h]=!0),h++,n||(s+="<"+r,(!l||w(l,r)||l["*"])&&_(e,function(i,e){if(!l||w(l,r)&&-1!==l[r].indexOf(e)||l["*"]&&-1!==l["*"].indexOf(e)||w(c,r)&&c[r].test(e)||c["*"]&&c["*"].test(e)){if(("href"===e||"src"===e)&&function(e,t){var n=i.replace(/[\x00-\x20]+/g,"").replace(/<\!\-\-.*?\-\-\>/g,"").match(/^([a-zA-Z]+)\:/);if(!n)return!1;var r=n[1].toLowerCase();return w(a.allowedSchemesByTag,e)?-1===a.allowedSchemesByTag[e].indexOf(r):!a.allowedSchemes||-1===a.allowedSchemes.indexOf(r)}(r))return void delete o.attribs[e];if("class"===e&&!(t=i,n=p[r],i=n?(t=t.split(/\s+/)).filter(function(e){return-1!==n.indexOf(e)}).join(" "):t).length)return void delete o.attribs[e];s+=" "+e,i.length&&(s+='="'+i+'"')}else delete o.attribs[e];var t,n}),-1!==a.selfClosing.indexOf(r)?s+=" />":(s+=">",!o.innerText||i||a.textFilter||(s+=o.innerText)))}},ontext:function(e){if(!y){var t,n=m[m.length-1];n&&(t=n.tag,e=void 0!==n.innerText?n.innerText:e),"script"===t||"style"===t?s+=e:a.textFilter?s+=a.textFilter(e):s+=e,m.length&&(m[m.length-1].text+=e)}},onclosetag:function(e){if(y){if(--b)return;y=!1}var t=m.pop();if(t){if(y=!1,g[--h])return delete g[h],void t.updateParentNodeText();v[h]&&(e=v[h],delete v[h]),a.exclusiveFilter&&a.exclusiveFilter(t)?s=s.substr(0,t.tagPosition):(t.updateParentNodeText(),-1===a.selfClosing.indexOf(e)&&(s+="</"+e+">"))}}},a.parser);return n.write(e),n.end(),s}t.exports=k;var x={decodeEntities:!0};k.defaults={allowedTags:["h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre"],allowedAttributes:{a:["href","name","target"],img:["src"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto"],allowedSchemesByTag:{}},k.simpleTransform=function(r,i,o){return o=void 0===o||o,i=i||{},function(e,t){var n;if(o)for(n in i)t[n]=i[n];else t=i;return{tagName:r,attribs:t}}}},{htmlparser2:171,"regexp-quote":307,xtend:341}],310:[function(e,t,n){(function(){var a={}.hasOwnProperty,s=[].slice;t.exports=function(e,t){var n,r,i,o;for(n in r=[],o=[],t)a.call(t,n)&&(i=t[n],"this"!==n&&(r.push(n),o.push(i)));return Function.apply(null,s.call(r).concat([e])).apply(t.this,o)}}).call(this)},{}],311:[function(e,n,r){!function(e){if("object"==typeof r)n.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;try{t=window}catch(e){t=self}t.SparkMD5=e()}}(function(u){"use strict";var a=function(e,t){return e+t&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function s(e,t,n,r,i,o){return t=a(a(t,e),a(r,o)),a(t<<i|t>>>32-i,n)}function l(e,t,n,r,i,o,a){return s(t&n|~t&r,e,t,i,o,a)}function c(e,t,n,r,i,o,a){return s(t&r|n&~r,e,t,i,o,a)}function p(e,t,n,r,i,o,a){return s(t^n^r,e,t,i,o,a)}function d(e,t,n,r,i,o,a){return s(n^(t|~r),e,t,i,o,a)}function f(e,t){var n=e[0],r=e[1],i=e[2],o=e[3];r=d(r=d(r=d(r=d(r=p(r=p(r=p(r=p(r=c(r=c(r=c(r=c(r=l(r=l(r=l(r=l(r,i=l(i,o=l(o,n=l(n,r,i,o,t[0],7,-680876936),r,i,t[1],12,-389564586),n,r,t[2],17,606105819),o,n,t[3],22,-1044525330),i=l(i,o=l(o,n=l(n,r,i,o,t[4],7,-176418897),r,i,t[5],12,1200080426),n,r,t[6],17,-1473231341),o,n,t[7],22,-45705983),i=l(i,o=l(o,n=l(n,r,i,o,t[8],7,1770035416),r,i,t[9],12,-1958414417),n,r,t[10],17,-42063),o,n,t[11],22,-1990404162),i=l(i,o=l(o,n=l(n,r,i,o,t[12],7,1804603682),r,i,t[13],12,-40341101),n,r,t[14],17,-1502002290),o,n,t[15],22,1236535329),i=c(i,o=c(o,n=c(n,r,i,o,t[1],5,-165796510),r,i,t[6],9,-1069501632),n,r,t[11],14,643717713),o,n,t[0],20,-373897302),i=c(i,o=c(o,n=c(n,r,i,o,t[5],5,-701558691),r,i,t[10],9,38016083),n,r,t[15],14,-660478335),o,n,t[4],20,-405537848),i=c(i,o=c(o,n=c(n,r,i,o,t[9],5,568446438),r,i,t[14],9,-1019803690),n,r,t[3],14,-187363961),o,n,t[8],20,1163531501),i=c(i,o=c(o,n=c(n,r,i,o,t[13],5,-1444681467),r,i,t[2],9,-51403784),n,r,t[7],14,1735328473),o,n,t[12],20,-1926607734),i=p(i,o=p(o,n=p(n,r,i,o,t[5],4,-378558),r,i,t[8],11,-2022574463),n,r,t[11],16,1839030562),o,n,t[14],23,-35309556),i=p(i,o=p(o,n=p(n,r,i,o,t[1],4,-1530992060),r,i,t[4],11,1272893353),n,r,t[7],16,-155497632),o,n,t[10],23,-1094730640),i=p(i,o=p(o,n=p(n,r,i,o,t[13],4,681279174),r,i,t[0],11,-358537222),n,r,t[3],16,-722521979),o,n,t[6],23,76029189),i=p(i,o=p(o,n=p(n,r,i,o,t[9],4,-640364487),r,i,t[12],11,-421815835),n,r,t[15],16,530742520),o,n,t[2],23,-995338651),i=d(i,o=d(o,n=d(n,r,i,o,t[0],6,-198630844),r,i,t[7],10,1126891415),n,r,t[14],15,-1416354905),o,n,t[5],21,-57434055),i=d(i,o=d(o,n=d(n,r,i,o,t[12],6,1700485571),r,i,t[3],10,-1894986606),n,r,t[10],15,-1051523),o,n,t[1],21,-2054922799),i=d(i,o=d(o,n=d(n,r,i,o,t[8],6,1873313359),r,i,t[15],10,-30611744),n,r,t[6],15,-1560198380),o,n,t[13],21,1309151649),i=d(i,o=d(o,n=d(n,r,i,o,t[4],6,-145523070),r,i,t[11],10,-1120210379),n,r,t[2],15,718787259),o,n,t[9],21,-343485551),e[0]=a(n,e[0]),e[1]=a(r,e[1]),e[2]=a(i,e[2]),e[3]=a(o,e[3])}function h(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function m(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function i(e){var t,n,r,i,o,a,s=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)f(l,h(e.substring(t-64,t)));for(n=(e=e.substring(t-64)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)r[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),55<t)for(f(l,r),t=0;t<16;t+=1)r[t]=0;return i=(i=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,r[14]=o,r[15]=a,f(l,r),l}function n(e){var t,n="";for(t=0;t<4;t+=1)n+=r[e>>8*t+4&15]+r[e>>8*t&15];return n}function g(e){var t;for(t=0;t<e.length;t+=1)e[t]=n(e[t]);return e.join("")}function o(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function v(e){var t,n=[],r=e.length;for(t=0;t<r-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function y(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==g(i("hello"))&&(a=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function c(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(e,t){var n,r,i,o,a=this.byteLength,s=c(e,a),l=a;return t!==u&&(l=c(t,a)),l<s?new ArrayBuffer(0):(n=l-s,r=new ArrayBuffer(n),i=new Uint8Array(r),o=new Uint8Array(this,s,n),i.set(o),r)}}(),y.prototype.append=function(e){return this.appendBinary(o(e)),this},y.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;t<=n;t+=64)f(this._hash,h(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},y.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),n=g(this._hash),e&&(n=v(n)),this.reset(),n},y.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},y.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},y.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},y.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},y.prototype._finish=function(e,t){var n,r,i,o=t;if(e[o>>2]|=128<<(o%4<<3),55<o)for(f(this._hash,e),o=0;o<16;o+=1)e[o]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(n[2],16),i=parseInt(n[1],16)||0,e[14]=r,e[15]=i,f(this._hash,e)},y.hash=function(e,t){return y.hashBinary(o(e),t)},y.hashBinary=function(e,t){var n=g(i(e));return t?v(n):n},(y.ArrayBuffer=function(){this.reset()}).prototype.append=function(e){var t,n,r,i,o=(n=this._buff.buffer,r=e,!0,(i=new Uint8Array(n.byteLength+r.byteLength)).set(new Uint8Array(n)),i.set(new Uint8Array(r),n.byteLength),i),a=o.length;for(this._length+=e.byteLength,t=64;t<=a;t+=64)f(this._hash,m(o.subarray(t-64,t)));return this._buff=t-64<a?new Uint8Array(o.buffer.slice(t-64)):new Uint8Array(0),this},y.ArrayBuffer.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,i),n=g(this._hash),e&&(n=v(n)),this.reset(),n},y.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},y.ArrayBuffer.prototype.getState=function(){var e,t=y.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},y.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var n,r=e.length,i=new ArrayBuffer(r),o=new Uint8Array(i);for(n=0;n<r;n+=1)o[n]=e.charCodeAt(n);return o}(e.buff),y.prototype.setState.call(this,e)},y.ArrayBuffer.prototype.destroy=y.prototype.destroy,y.ArrayBuffer.prototype._finish=y.prototype._finish,y.ArrayBuffer.hash=function(e,t){var n=g(function(e){var t,n,r,i,o,a,s=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)f(l,m(e.subarray(t-64,t)));for(n=(e=t-64<s?e.subarray(t-64):new Uint8Array(0)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)r[t>>2]|=e[t]<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),55<t)for(f(l,r),t=0;t<16;t+=1)r[t]=0;return i=(i=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,r[14]=o,r[15]=a,f(l,r),l}(new Uint8Array(e)));return t?v(n):n},y})},{}],312:[function(e,t,n){t.exports=r;var u=e("events").EventEmitter;function r(){u.call(this)}e("inherits")(r,u),r.Readable=e("readable-stream/readable.js"),r.Writable=e("readable-stream/writable.js"),r.Duplex=e("readable-stream/duplex.js"),r.Transform=e("readable-stream/transform.js"),r.PassThrough=e("readable-stream/passthrough.js"),(r.Stream=r).prototype.pipe=function(t,e){var n=this;function r(e){t.writable&&!1===t.write(e)&&n.pause&&n.pause()}function i(){n.readable&&n.resume&&n.resume()}n.on("data",r),t.on("drain",i),t._isStdio||e&&!1===e.end||(n.on("end",a),n.on("close",s));var o=!1;function a(){o||(o=!0,t.end())}function s(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function l(e){if(c(),0===u.listenerCount(this,"error"))throw e}function c(){n.removeListener("data",r),t.removeListener("drain",i),n.removeListener("end",a),n.removeListener("close",s),n.removeListener("error",l),t.removeListener("error",l),n.removeListener("end",c),n.removeListener("close",c),t.removeListener("close",c)}return n.on("error",l),t.on("error",l),n.on("end",c),n.on("close",c),t.on("close",c),t.emit("pipe",n),t}},{events:160,inherits:174,"readable-stream/duplex.js":285,"readable-stream/passthrough.js":296,"readable-stream/readable.js":297,"readable-stream/transform.js":298,"readable-stream/writable.js":299}],313:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=p,t=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(1<e.lastNeed&&1<t.length){if(128!=(192&t[1]))return e.lastNeed=1,"";if(2<e.lastNeed&&2<t.length&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(55296<=r&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function p(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}(n.StringDecoder=o).prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=a(t[r]);return 0<=i?(0<i&&(e.lastNeed=i-1),i):--r<n||-2===i?0:0<=(i=a(t[r]))?(0<i&&(e.lastNeed=i-2),i):--r<n||-2===i?0:0<=(i=a(t[r]))?(0<i&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":308}],314:[function(e,t,n){t.exports={encode:function(e){return""+e[0]+""+e[1]},decode:function(e){var t=e.toString(),n=t.indexOf("",1);return[t.substring(1,n),t.substring(n+1)]},lowerBound:"\0",upperBound:""}},{}],315:[function(e,t,n){var r=e("errno").create,i=r("LevelUPError"),o=r("NotFoundError",i);o.prototype.notFound=!0,o.prototype.status=404,t.exports={LevelUPError:i,InitializationError:r("InitializationError",i),OpenError:r("OpenError",i),ReadError:r("ReadError",i),WriteError:r("WriteError",i),NotFoundError:o,EncodingError:r("EncodingError",i)}},{errno:321}],316:[function(e,t,n){var r=e("./nut"),i=e("./shell"),o=new(e("level-codec")),a=e("./read-stream"),s=e("./codec/legacy");t.exports=function(e){return i(r(e,s,o),[],a,e.options)}},{"./codec/legacy":314,"./nut":317,"./read-stream":318,"./shell":319,"level-codec":179}],317:[function(e,t,n){var p=e("ltgt");function d(e){return"function"==typeof e}t.exports=function(l,o,c,e){var a=[],s=!1;function u(e,t,n,r){return o.encode([e,c.encodeKey(t,n,r)])}return d(l.isOpen)&&l.isOpen()?s=!0:l.open(function(){for(s=!0;a.length;)a.shift()()}),{apply:function(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];(s=(a=i).prefix)&&s.options&&(a.keyEncoding=a.keyEncoding||s.options.keyEncoding,a.valueEncoding=a.valueEncoding||s.options.valueEncoding),i.prefix=null==(o=i.prefix)?o:d(o.prefix)?o.prefix():o}var o,a,s;if("object"!=typeof(t=t||{}))throw new Error("opts must be object, was:"+t);"function"==typeof t&&(n=t,t={}),e.length?(l.db||l).batch(e.map(function(e){return{key:u(e.prefix,e.key,t,e),value:"del"!==e.type?c.encodeValue(e.value,t,e):void 0,type:e.type||(void 0===e.value?"del":"put")}}),t,function(e){if(e)return n(e);n()}):n()},get:function(e,t,n,r){return n.asBuffer=c.valueAsBuffer(n),(l.db||l).get(u(t,e,n),n,function(e,t){e?r(e):r(null,c.decodeValue(t,n))})},createDecoder:function(n){return function(e,t){return{key:c.decodeKey(o.decode(e)[1],n),value:c.decodeValue(t,n)}}},isOpen:function(){return l.db&&d(l.db.isOpen)?l.db.isOpen():l.isOpen()},isClosed:function(){return l.db&&d(l.db.isClosed)?l.db.isClosed():l.isClosed()},close:function(e){return l.close(e)},iterator:function(e,t){var n=function(e){var t={};for(var n in e)t[n]=e[n];return t}(e||{}),r=e.prefix||[];function i(t){return{next:function(e){return t.next(e)},end:function(e){t.end(e)}}}if(p.toLtgt(e,n,function(e){return u(r,e,n,{})},o.lowerBound,o.upperBound),n.prefix=null,n.keyAsBuffer=n.valueAsBuffer=!1,"number"!=typeof n.limit&&(n.limit=-1),n.keyAsBuffer=o.buffer,n.valueAsBuffer=c.valueAsBuffer(n),s)return i((l.db||l).iterator(n));a.push(function(){t(null,i((l.db||l).iterator(n)))})}}}},{ltgt:323}],318:[function(e,t,n){var r=e("readable-stream").Readable,i=e("inherits"),o=e("./errors").EncodingError;function a(e,t){if(!(this instanceof a))return new a(e,t);r.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this._waiting=!1,this._options=e,this._makeData=t}i(a,r),a.prototype.setIterator=function(e){return this._iterator=e,this._destroyed?e.end(function(){}):this._waiting?(this._waiting=!1,this._read()):this},a.prototype._read=function(){var r=this;if(!r._destroyed)return r._iterator?void r._iterator.next(function(e,t,n){if(e||void 0===t&&void 0===n)return e||r._destroyed||r.push(null),r._cleanup(e);try{n=r._makeData(t,n)}catch(e){return r._cleanup(new o(e))}r._destroyed||r.push(n)}):this._waiting=!0},a.prototype._cleanup=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;e&&t.emit("error",e),t._iterator?t._iterator.end(function(){t._iterator=null,t.emit("close")}):t.emit("close")}},a.prototype.destroy=function(){this._cleanup()},a.prototype.toString=function(){return"LevelUP.ReadStream"},t.exports=a},{"./errors":315,inherits:174,"readable-stream":330}],319:[function(r,i,e){(function(t){var e=r("events").EventEmitter,u=r("./errors"),n=i.exports=function(i,o,r,a){var s=new e;function l(e){e&&s.emit("error",e)}function c(e){var t={};if(a)for(var n in a)null!=a[n]&&(t[n]=a[n]);if(e)for(var n in e)null!=e[n]&&(t[n]=e[n]);return t}return s.sublevels={},s.options=a,s.version="6.5.4",s.methods={},o=o||[],s.put=function(t,n,e,r){"function"==typeof e&&(r=e,e={}),r||(r=l),i.apply([{key:t,value:n,prefix:o.slice(),type:"put"}],c(e),function(e){if(e||(s.emit("put",t,n),r(null)),e)return r(e)})},s.prefix=function(){return o.slice()},s.del=function(t,e,n){"function"==typeof e&&(n=e,e={}),n||(n=l),i.apply([{key:t,prefix:o.slice(),type:"del"}],c(e),function(e){if(e||(s.emit("del",t),n(null)),e)return n(e)})},s.batch=function(t,e,n){"function"==typeof e&&(n=e,e={}),n||(n=l),t=t.map(function(e){return{key:e.key,value:e.value,prefix:e.prefix||o,keyEncoding:e.keyEncoding,valueEncoding:e.valueEncoding,type:e.type}}),i.apply(t,c(e),function(e){if(e||(s.emit("batch",t),n(null)),e)return n(e)})},s.get=function(e,t,n){"function"==typeof t&&(n=t,t={}),i.get(e,o,c(t),function(e,t){e?n(new u.NotFoundError("Key not found in database",e)):n(null,t)})},s.clone=function(e){return n(i,o,r,c(e))},s.sublevel=function(e,t){return s.sublevels[e]=s.sublevels[e]||n(i,o.concat(e),r,c(t))},s.readStream=s.createReadStream=function(e){var n;(e=c(e)).prefix=o;var t=i.iterator(e,function(e,t){n.setIterator(t)});return n=r(e,i.createDecoder(e)),t&&n.setIterator(t),n},s.valueStream=s.createValueStream=function(e){return(e=e||{}).values=!0,e.keys=!1,s.createReadStream(e)},s.keyStream=s.createKeyStream=function(e){return(e=e||{}).values=!1,e.keys=!0,s.createReadStream(e)},s.close=function(e){e=e||function(){},o.length?t.nextTick(e):i.close(e)},s.isOpen=i.isOpen,s.isClosed=i.isClosed,s}}).call(this,r("_process"))},{"./errors":315,_process:234,events:160}],320:[function(e,t,n){var r=e("prr");function s(e,t,n){r(this,{type:e,name:e,cause:"string"!=typeof t?t:n,message:t&&"string"!=typeof t?t.message:t},"ewr")}function l(e,t){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee),s.call(this,"CustomError",e,t)}l.prototype=new Error,t.exports=function(a){var e=function(e,t){return n=a,r=e,(o=function(e,t){s.call(this,r,e,t),"FilesystemError"==r&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(n.errno[this.cause.errno]?n.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee)}).prototype=(i=t)?new i:new l,o;var n,r,i,o};return{CustomError:l,FilesystemError:e("FilesystemError"),createError:e}}},{prr:324}],321:[function(e,t,n){var r=t.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={},t.exports.code={},r.forEach(function(e){t.exports.errno[e.errno]=e,t.exports.code[e.code]=e}),t.exports.custom=e("./custom")(t.exports),t.exports.create=t.exports.custom.createError},{"./custom":320}],322:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],323:[function(e,t,f){(function(o){function l(e,t){return Object.hasOwnProperty.call(e,t)}function a(e){return void 0!==e&&""!==e}function l(e,t){return Object.hasOwnProperty.call(e,t)}function t(e,t){return Object.hasOwnProperty.call(e,t)&&t}f.compare=function(e,t){if(o.isBuffer(e)){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e[r]-t[r];if(i)return i}return e.length-t.length}return e<t?-1:t<e?1:0};var n=f.lowerBoundKey=function(e){return t(e,"gt")||t(e,"gte")||t(e,"min")||(e.reverse?t(e,"end"):t(e,"start"))||void 0},s=f.lowerBound=function(e){var t=n(e);return t&&e[t]};f.lowerBoundInclusive=function(e){return!l(e,"gt")},f.upperBoundInclusive=function(e){return!(l(e,"lt")||!e.minEx)};var c=f.lowerBoundExclusive=function(e){return!(!l(e,"gt")&&!e.minEx)},u=f.upperBoundExclusive=function(e){return!!l(e,"lt")},r=f.upperBoundKey=function(e){return t(e,"lt")||t(e,"lte")||t(e,"max")||(e.reverse?t(e,"start"):t(e,"end"))||void 0},p=f.upperBound=function(e){var t=r(e);return t&&e[t]};function d(e){return e}f.toLtgt=function(e,t,n,r,i){t=t||{},n=n||d;var o=3<arguments.length,a=f.lowerBoundKey(e),s=f.upperBoundKey(e);return a?"gt"===a?t.gt=n(e.gt,!1):t.gte=n(e[a],!1):o&&(t.gte=n(r,!1)),s?"lt"===s?t.lt=n(e.lt,!0):t.lte=n(e[s],!0):o&&(t.lte=n(i,!0)),null!=e.reverse&&(t.reverse=!!e.reverse),l(t,"max")&&delete t.max,l(t,"min")&&delete t.min,l(t,"start")&&delete t.start,l(t,"end")&&delete t.end,t},f.contains=function(e,t,n){n=n||f.compare;var r=s(e);if(a(r)&&((i=n(t,r))<0||0===i&&c(e)))return!1;var i,o=p(e);return!a(o)||!(0<(i=n(t,o))||0===i&&u(e))},f.filter=function(t,n){return function(e){return f.contains(t,e,n)}}}).call(this,{isBuffer:e("../../../is-buffer/index.js")})},{"../../../is-buffer/index.js":176}],324:[function(e,t,n){var r,i;r=this,i=function(){var u="function"==typeof Object.defineProperty?function(e,t,n){return Object.defineProperty(e,t,n),e}:function(e,t,n){return e[t]=n.value,e};return function(e,t,n,r){var i,o,a,s,l,c;if(o=n,l=!(s="object"==typeof(a=r))&&"string"==typeof a,r={enumerable:(c=function(e){return s?!!a[e]:!!l&&-1<a.indexOf(e[0])})("enumerable"),configurable:c("configurable"),writable:c("writable"),value:o},"object"==typeof t){for(i in t)Object.hasOwnProperty.call(t,i)&&(r.value=t[i],u(e,i,r));return e}return u(e,t,r)}},void 0!==t&&t.exports?t.exports=i():r.prr=i()},{}],325:[function(s,l,e){(function(e){l.exports=o;var t=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},n=s("core-util-is");n.inherits=s("inherits");var r=s("./_stream_readable"),i=s("./_stream_writable");function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),i.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",a)}function a(){this.allowHalfOpen||this._writableState.ended||e.nextTick(this.end.bind(this))}n.inherits(o,r),function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}(t(i.prototype),function(e){o.prototype[e]||(o.prototype[e]=i.prototype[e])})}).call(this,s("_process"))},{"./_stream_readable":327,"./_stream_writable":329,_process:234,"core-util-is":119,inherits:174}],326:[function(e,t,n){t.exports=o;var r=e("./_stream_transform"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=e("inherits"),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":328,"core-util-is":119,inherits:174}],327:[function(d,w,e){(function(h){w.exports=n;var m=d("isarray"),f=d("buffer").Buffer;n.ReadableState=t;var g=d("events").EventEmitter;g.listenerCount||(g.listenerCount=function(e,t){return e.listeners(t).length});var r,i=d("stream"),e=d("core-util-is");function t(e,t){var n=(e=e||{}).highWaterMark;this.highWaterMark=n||0===n?n:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(r||(r=d("string_decoder/").StringDecoder),this.decoder=new r(e.encoding),this.encoding=e.encoding)}function n(e){if(!(this instanceof n))return new n(e);this._readableState=new t(e,this),this.readable=!0,i.call(this)}function o(e,t,n,r,i){var o,a,s,l,c,u,p=(o=t,a=n,s=null,f.isBuffer(a)||"string"==typeof a||null==a||o.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s);if(p)e.emit("error",p);else if(null==n)t.reading=!1,t.ended||function(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,0<t.length?v(e):_(e)}(e,t);else if(t.objectMode||n&&0<n.length)if(t.ended&&!i){var d=new Error("stream.push() after EOF");e.emit("error",d)}else t.endEmitted&&i?(d=new Error("stream.unshift() after end event"),e.emit("error",d)):(!t.decoder||i||r||(n=t.decoder.write(n)),t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):(t.reading=!1,t.buffer.push(n)),t.needReadable&&v(e),l=e,(c=t).readingMore||(c.readingMore=!0,h.nextTick(function(){!function(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}(l,c)})));else i||(t.reading=!1);return!(u=t).ended&&(u.needReadable||u.length<u.highWaterMark||0===u.length)}e.inherits=d("inherits"),e.inherits(n,i),n.prototype.push=function(e,t){var n=this._readableState;return"string"!=typeof e||n.objectMode||(t=t||n.defaultEncoding)!==n.encoding&&(e=new f(e,t),t=""),o(this,n,e,t,!1)},n.prototype.unshift=function(e){return o(this,this._readableState,e,"",!0)},n.prototype.setEncoding=function(e){r||(r=d("string_decoder/").StringDecoder),this._readableState.decoder=new r(e),this._readableState.encoding=e};var a=8388608;function s(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=function(e){if(a<=e)e=a;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function v(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?h.nextTick(function(){l(e)}):l(e))}function l(e){e.emit("readable")}function y(e){var r,i=e._readableState;function t(e,t,n){!1===e.write(r)&&i.awaitDrain++}for(i.awaitDrain=0;i.pipesCount&&null!==(r=e.read());)if(1===i.pipesCount?t(i.pipes):p(i.pipes,t),e.emit("data",r),0<i.awaitDrain)return;if(0===i.pipesCount)return i.flowing=!1,void(0<g.listenerCount(e,"data")&&c(e));i.ranOut=!0}function b(){this._readableState.ranOut&&(this._readableState.ranOut=!1,y(this))}function c(t,e){if(t._readableState.flowing)throw new Error("Cannot switch to old mode now.");var n=e||!1,r=!1;t.readable=!0,t.pipe=i.prototype.pipe,t.on=t.addListener=i.prototype.on,t.on("readable",function(){var e;for(r=!0;!n&&null!==(e=t.read());)t.emit("data",e);null===e&&(r=!1,t._readableState.needReadable=!0)}),t.pause=function(){n=!0,this.emit("pause")},t.resume=function(){n=!1,r?h.nextTick(function(){t.emit("readable")}):this.read(0),this.emit("resume")},t.emit("readable")}function u(e,t){var n,r=t.buffer,i=t.length,o=!!t.decoder,a=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(a)n=r.shift();else if(!e||i<=e)n=o?r.join(""):f.concat(r,i),r.length=0;else if(e<r[0].length)n=(u=r[0]).slice(0,e),r[0]=u.slice(e);else if(e===r[0].length)n=r.shift();else{n=o?"":new f(e);for(var s=0,l=0,c=r.length;l<c&&s<e;l++){var u=r[0],p=Math.min(e-s,u.length);o?n+=u.slice(0,p):u.copy(n,s,0,p),p<u.length?r[0]=u.slice(p):r.shift(),s+=p}}return n}function _(e){var t=e._readableState;if(0<t.length)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,h.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function p(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}n.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var n,r=e;if(("number"!=typeof e||0<e)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return v(this),null;if(0===(e=s(e,t))&&t.ended)return n=null,0<t.length&&t.decoder&&(n=u(e,t),t.length-=n.length),0===t.length&&_(this),n;var i=t.needReadable;return t.length-e<=t.highWaterMark&&(i=!0),(t.ended||t.reading)&&(i=!1),i&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=s(r,t)),null===(n=0<e?u(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&_(this),n},n.prototype._read=function(e){this.emit("error",new Error("not implemented"))},n.prototype.pipe=function(t,e){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t)}r.pipesCount+=1;var i=e&&!1===e.end||t===h.stdout||t===h.stderr?c:a;function o(e){e===n&&c()}function a(){t.end()}r.endEmitted?h.nextTick(i):n.once("end",i),t.on("unpipe",o);var s,l=(s=n,function(){var e=s._readableState;e.awaitDrain--,0===e.awaitDrain&&y(s)});function c(){t.removeListener("close",p),t.removeListener("finish",d),t.removeListener("drain",l),t.removeListener("error",u),t.removeListener("unpipe",o),n.removeListener("end",a),n.removeListener("end",c),t._writableState&&!t._writableState.needDrain||l()}function u(e){f(),t.removeListener("error",u),0===g.listenerCount(t,"error")&&t.emit("error",e)}function p(){t.removeListener("finish",d),f()}function d(){t.removeListener("close",p),f()}function f(){n.unpipe(t)}return t.on("drain",l),t._events&&t._events.error?m(t._events.error)?t._events.error.unshift(u):t._events.error=[u,t._events.error]:t.on("error",u),t.once("close",p),t.once("finish",d),t.emit("pipe",n),r.flowing||(this.on("readable",b),r.flowing=!0,h.nextTick(function(){y(n)})),t},n.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",b),t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",b),t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}return-1===(i=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}(t.pipes,e))||(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},n.prototype.addListener=n.prototype.on=function(e,t){var n=i.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||c(this),"readable"===e&&this.readable){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&v(this):this.read(0))}return n},n.prototype.resume=function(){c(this),this.read(0),this.emit("resume")},n.prototype.pause=function(){c(this,!0),this.emit("pause")},n.prototype.wrap=function(t){var n=this._readableState,r=!1,i=this;for(var e in t.on("end",function(){if(n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&i.push(e)}i.push(null)}),t.on("data",function(e){n.decoder&&(e=n.decoder.write(e)),(!n.objectMode||null!=e)&&(n.objectMode||e&&e.length)&&(i.push(e)||(r=!0,t.pause()))}),t)"function"==typeof t[e]&&void 0===this[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));return p(["error","close","destroy","pause","resume"],function(e){t.on(e,i.emit.bind(i,e))}),i._read=function(e){r&&(r=!1,t.resume())},i},n._fromList=u}).call(this,d("_process"))},{_process:234,buffer:117,"core-util-is":119,events:160,inherits:174,isarray:322,stream:312,"string_decoder/":331}],328:[function(e,t,n){t.exports=a;var r=e("./_stream_duplex"),i=e("core-util-is");function o(e,n){this.afterTransform=function(e,t){return function(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,(r.writecb=null)!==n&&void 0!==n&&e.push(n),i&&i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(n,e,t)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function a(e){if(!(this instanceof a))return new a(e);r.call(this,e),this._transformState=new o(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){s(t,e)}):s(t)})}function s(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=(e._readableState,e._transformState);if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(a,r),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,n){throw new Error("not implemented")},a.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":325,"core-util-is":119,inherits:174}],329:[function(o,t,e){(function(p){t.exports=i;var u=o("buffer").Buffer;i.WritableState=r;var e=o("core-util-is");e.inherits=o("inherits");var n=o("stream");function d(e,t,n){this.chunk=e,this.encoding=t,this.callback=n}function r(e,t){var n=(e=e||{}).highWaterMark;this.highWaterMark=n||0===n?n:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1;var r=(this.finished=!1)===e.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(u=n,u.writing=!1,u.writecb=null,u.length-=u.writelen,u.writelen=0,t)a=e,s=r,l=t,c=i,s?p.nextTick(function(){c(l)}):c(l),a._writableState.errorEmitted=!0,a.emit("error",l);else{var o=m(e,n);o||n.bufferProcessing||!n.buffer.length||function(e,t){t.bufferProcessing=!0;for(var n=0;n<t.buffer.length;n++){var r=t.buffer[n],i=r.chunk,o=r.encoding,a=r.callback;if(f(e,t,t.objectMode?1:i.length,i,o,a),t.writing){n++;break}}t.bufferProcessing=!1,n<t.buffer.length?t.buffer=t.buffer.slice(n):t.buffer.length=0}(e,n),r?p.nextTick(function(){h(e,n,o,i)}):h(e,n,o,i)}var a,s,l,c;var u}(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function i(e){var t=o("./_stream_duplex");if(!(this instanceof i||this instanceof t))return new i(e);this._writableState=new r(e,this),this.writable=!0,n.call(this)}function l(e,t,n,r,i){var o,a,s;a=n,s=r,(o=t).objectMode||!1===o.decodeStrings||"string"!=typeof a||(a=new u(a,s)),n=a,u.isBuffer(n)&&(r="buffer");var l=t.objectMode?1:n.length;t.length+=l;var c=t.length<t.highWaterMark;return c||(t.needDrain=!0),t.writing?t.buffer.push(new d(n,r,i)):f(e,t,l,n,r,i),c}function f(e,t,n,r,i,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,e._write(r,i,t.onwrite),t.sync=!1}function h(e,t,n,r){var i,o;n||(i=e,0===(o=t).length&&o.needDrain&&(o.needDrain=!1,i.emit("drain"))),r(),n&&s(e,t)}function m(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function s(e,t){var n=m(0,t);return n&&(t.finished=!0,e.emit("finish")),n}e.inherits(i,n),i.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},i.prototype.write=function(e,t,n){var r,i,o,a=this._writableState,s=!1;return"function"==typeof t&&(n=t,t=null),u.isBuffer(e)?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof n&&(n=function(){}),a.ended?(r=this,i=n,o=new Error("write after end"),r.emit("error",o),p.nextTick(function(){i(o)})):function(e,t,n,r){var i=!0;if(!u.isBuffer(n)&&"string"!=typeof n&&null!=n&&!t.objectMode){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),p.nextTick(function(){r(o)}),i=!1}return i}(this,a,e,n)&&(s=l(this,a,e,t,n)),s},i.prototype._write=function(e,t,n){n(new Error("not implemented"))},i.prototype.end=function(e,t,n){var r,i,o,a=this._writableState;"function"==typeof e?(n=e,t=e=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),a.ending||a.finished||(r=this,o=n,(i=a).ending=!0,s(r,i),o&&(i.finished?p.nextTick(o):r.once("finish",o)),i.ended=!0)}}).call(this,o("_process"))},{"./_stream_duplex":325,_process:234,buffer:117,"core-util-is":119,inherits:174,stream:312}],330:[function(e,t,n){var r=e("stream");(n=t.exports=e("./lib/_stream_readable.js")).Stream=r,(n.Readable=n).Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":325,"./lib/_stream_passthrough.js":326,"./lib/_stream_readable.js":327,"./lib/_stream_transform.js":328,"./lib/_stream_writable.js":329,stream:312}],331:[function(e,t,n){var r=e("buffer").Buffer,i=r.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};var o=n.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!i(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=s;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=l;break;default:return void(this.write=a)}this.charBuffer=new r(6),this.charReceived=0,this.charLength=0};function a(e){return e.toString(this.encoding)}function s(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function l(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}o.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!(55296<=(r=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r,i=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),i=(t+=e.toString(this.encoding,0,i)).length-1,55296<=(r=t.charCodeAt(i))&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},o.prototype.detectIncompleteChar=function(e){for(var t=3<=e.length?3:e.length;0<t;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},o.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},{buffer:117}],332:[function(a,s,l){(function(e){"use strict";Object.defineProperty(l,"__esModule",{value:!0});var t,n,r=a("./ponyfill.js"),i=(n=r)&&n.__esModule?n:{default:n};t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:void 0!==s?s:Function("return this")();var o=(0,i.default)(t);l.default=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ponyfill.js":333}],333:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}},{}],334:[function(l,e,c){(function(e,t){var r=l("process/browser.js").nextTick,n=Function.prototype.apply,i=Array.prototype.slice,o={},a=0;function s(e,t){this._id=e,this._clearFn=t}c.setTimeout=function(){return new s(n.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new s(n.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(e){e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},c.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},c._unrefActive=c.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},c.setImmediate="function"==typeof e?e:function(e){var t=a++,n=!(arguments.length<2)&&i.call(arguments,1);return o[t]=!0,r(function(){o[t]&&(n?e.apply(null,n):e.call(null),c.clearImmediate(t))}),t},c.clearImmediate="function"==typeof t?t:function(e){delete o[e]}}).call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":234,timers:334}],335:[function(e,t,n){(function(n){function r(e){try{if(!n.localStorage)return!1}catch(e){return!1}var t=n.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}t.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],336:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],337:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],338:[function(d,e,O){(function(r,i){var s=/%[sdj%]/g;O.format=function(e){if(!x(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(l(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,o=String(e).replace(s,function(e){if("%%"===e)return"%";if(i<=n)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),a=r[n];n<i;a=r[++n])w(a)||!u(a)?o+=" "+a:o+=" "+l(a);return o},O.deprecate=function(e,t){if(E(i.process))return function(){return O.deprecate(e,t).apply(this,arguments)};if(!0===r.noDeprecation)return e;var n=!1;return function(){if(!n){if(r.throwDeprecation)throw new Error(t);r.traceDeprecation?console.trace(t):console.error(t),n=!0}return e.apply(this,arguments)}};var e,o={};function l(e,t){var n={seen:[],stylize:c};return 3<=arguments.length&&(n.depth=arguments[2]),4<=arguments.length&&(n.colors=arguments[3]),_(t)?n.showHidden=t:t&&O._extend(n,t),E(n.showHidden)&&(n.showHidden=!1),E(n.depth)&&(n.depth=2),E(n.colors)&&(n.colors=!1),E(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=a),g(n,e,n.depth)}function a(e,t){var n=l.styles[t];return n?"["+l.colors[n][0]+"m"+e+"["+l.colors[n][1]+"m":e}function c(e,t){return e}function g(t,n,r){if(t.customInspect&&n&&A(n.inspect)&&n.inspect!==O.inspect&&(!n.constructor||n.constructor.prototype!==n)){var e=n.inspect(r,t);return x(e)||(e=g(t,e,r)),e}var i=function(e,t){if(E(t))return e.stylize("undefined","undefined");if(x(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return k(t)?e.stylize(""+t,"number"):_(t)?e.stylize(""+t,"boolean"):w(t)?e.stylize("null","null"):void 0}(t,n);if(i)return i;var o,a=Object.keys(n),s=(o={},a.forEach(function(e,t){o[e]=!0}),o);if(t.showHidden&&(a=Object.getOwnPropertyNames(n)),T(n)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return v(n);if(0===a.length){if(A(n)){var l=n.name?": "+n.name:"";return t.stylize("[Function"+l+"]","special")}if(C(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(S(n))return t.stylize(Date.prototype.toString.call(n),"date");if(T(n))return v(n)}var c,u,p,d,f="",h=!1,m=["{","}"];return b(n)&&(h=!0,m=["[","]"]),A(n)&&(f=" [Function"+(n.name?": "+n.name:"")+"]"),C(n)&&(f=" "+RegExp.prototype.toString.call(n)),S(n)&&(f=" "+Date.prototype.toUTCString.call(n)),T(n)&&(f=" "+v(n)),0!==a.length||h&&0!=n.length?r<0?C(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),c=h?function(t,n,r,i,e){for(var o=[],a=0,s=n.length;a<s;++a)N(n,String(a))?o.push(y(t,n,r,i,String(a),!0)):o.push("");return e.forEach(function(e){e.match(/^\d+$/)||o.push(y(t,n,r,i,e,!0))}),o}(t,n,r,s,a):a.map(function(e){return y(t,n,r,s,e,h)}),t.seen.pop(),p=f,d=m,60<(u=c).reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)?d[0]+(""===p?"":p+"\n ")+" "+u.join(",\n  ")+" "+d[1]:d[0]+p+" "+u.join(", ")+" "+d[1]):m[0]+f+m[1]}function v(e){return"["+Error.prototype.toString.call(e)+"]"}function y(e,t,n,r,i,o){var a,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),N(r,i)||(a="["+i+"]"),s||(e.seen.indexOf(l.value)<0?-1<(s=w(n)?g(e,l.value,null):g(e,l.value,n-1)).indexOf("\n")&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),E(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function b(e){return Array.isArray(e)}function _(e){return"boolean"==typeof e}function w(e){return null===e}function k(e){return"number"==typeof e}function x(e){return"string"==typeof e}function E(e){return void 0===e}function C(e){return u(e)&&"[object RegExp]"===t(e)}function u(e){return"object"==typeof e&&null!==e}function S(e){return u(e)&&"[object Date]"===t(e)}function T(e){return u(e)&&("[object Error]"===t(e)||e instanceof Error)}function A(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function n(e){return e<10?"0"+e.toString(10):e.toString(10)}O.debuglog=function(t){if(E(e)&&(e=r.env.NODE_DEBUG||""),t=t.toUpperCase(),!o[t])if(new RegExp("\\b"+t+"\\b","i").test(e)){var n=r.pid;o[t]=function(){var e=O.format.apply(O,arguments);console.error("%s %d: %s",t,n,e)}}else o[t]=function(){};return o[t]},(O.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},O.isArray=b,O.isBoolean=_,O.isNull=w,O.isNullOrUndefined=function(e){return null==e},O.isNumber=k,O.isString=x,O.isSymbol=function(e){return"symbol"==typeof e},O.isUndefined=E,O.isRegExp=C,O.isObject=u,O.isDate=S,O.isError=T,O.isFunction=A,O.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},O.isBuffer=d("./support/isBuffer");var p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)}O.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[n(e.getHours()),n(e.getMinutes()),n(e.getSeconds())].join(":"),[e.getDate(),p[e.getMonth()],t].join(" ")),O.format.apply(O,arguments))},O.inherits=d("inherits"),O._extend=function(e,t){if(!t||!u(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,d("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":337,_process:234,inherits:336}],339:[function(e,t,n){"use strict";function f(e,t,n){var r=n[n.length-1];e===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,o=r.index;Array.isArray(i)?i.push(e):o===t.length-2?i[t.pop()]=e:t.push(e)}n.stringify=function(e){var t=[];t.push({obj:e});for(var n,r,i,o,a,s,l,c,u,p,d="";n=t.pop();)if(r=n.obj,d+=n.prefix||"",i=n.val||"")d+=i;else if("object"!=typeof r)d+=void 0===r?null:JSON.stringify(r);else if(null===r)d+="null";else if(Array.isArray(r)){for(t.push({val:"]"}),o=r.length-1;0<=o;o--)a=0===o?"":",",t.push({obj:r[o],prefix:a});t.push({val:"["})}else{for(l in s=[],r)r.hasOwnProperty(l)&&s.push(l);for(t.push({val:"}"}),o=s.length-1;0<=o;o--)u=r[c=s[o]],p=0<o?",":"",p+=JSON.stringify(c)+":",t.push({obj:u,prefix:p});t.push({val:"{"})}return d},n.parse=function(e){for(var t,n,r,i,o,a,s,l,c,u=[],p=[],d=0;;)if("}"!==(t=e[d++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":d+=3,f(null,u,p);break;case"t":d+=3,f(!0,u,p);break;case"f":d+=4,f(!1,u,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(n="",d--;;){if(r=e[d++],!/[\d\.\-e\+]/.test(r)){d--;break}n+=r}f(parseFloat(n),u,p);break;case'"':for(i="",o=void 0,a=0;'"'!==(s=e[d++])||"\\"===o&&a%2==1;)i+=s,"\\"===(o=s)?a++:a=0;f(JSON.parse('"'+i+'"'),u,p);break;case"[":l={element:[],index:u.length},u.push(l.element),p.push(l);break;case"{":c={element:{},index:u.length},u.push(c.element),p.push(c);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===u.length)return u.pop();f(u.pop(),u,p)}}},{}],340:[function(e,t,n){"use strict";t.exports=function(){}},{}],341:[function(e,t,n){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)i.call(n,r)&&(e[r]=n[r])}return e};var i=Object.prototype.hasOwnProperty},{}]},{},[2]);